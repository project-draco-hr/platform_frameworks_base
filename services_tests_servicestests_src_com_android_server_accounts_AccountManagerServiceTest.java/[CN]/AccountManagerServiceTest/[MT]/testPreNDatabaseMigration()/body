{
  String preNDatabaseName=mAms.getPreNDatabaseName(UserHandle.USER_SYSTEM);
  Context originalContext=((MyMockContext)getContext()).mTestContext;
  PreNTestDatabaseHelper.createV4Database(originalContext,preNDatabaseName);
  int n=readNumberOfAccountsFromDbFile(originalContext,preNDatabaseName);
  assertEquals("pre-N database should have 1 account",1,n);
  unlockSystemUser();
  Account[] accounts=mAms.getAccounts(null,mContext.getOpPackageName());
  assertEquals("1 account should be migrated",1,accounts.length);
  assertEquals(PreNTestDatabaseHelper.ACCOUNT_NAME,accounts[0].name);
  assertEquals(PreNTestDatabaseHelper.ACCOUNT_PASSWORD,mAms.getPassword(accounts[0]));
  assertEquals("Authtoken should be migrated",PreNTestDatabaseHelper.TOKEN_STRING,mAms.peekAuthToken(accounts[0],PreNTestDatabaseHelper.TOKEN_TYPE));
  assertFalse("pre-N database file should be removed but was found at " + preNDatabaseName,new File(preNDatabaseName).exists());
  String deDatabaseName=mAms.getDeDatabaseName(UserHandle.USER_SYSTEM);
  String ceDatabaseName=mAms.getCeDatabaseName(UserHandle.USER_SYSTEM);
  assertTrue("DE database file should be created at " + deDatabaseName,new File(deDatabaseName).exists());
  assertTrue("CE database file should be created at " + ceDatabaseName,new File(ceDatabaseName).exists());
}
