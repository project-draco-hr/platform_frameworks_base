{
  long currentTime=AnimationUtils.currentAnimationTimeMillis();
  int numDelayedAnims=mDelayedAnims.size();
  for (int i=0; i < numDelayedAnims; ++i) {
    ValueAnimator anim=mDelayedAnims.get(i);
    if (anim.delayedAnimationFrame(currentTime)) {
      mReadyAnims.add(anim);
    }
  }
  int numReadyAnims=mReadyAnims.size();
  if (numReadyAnims > 0) {
    for (int i=0; i < numReadyAnims; ++i) {
      ValueAnimator anim=mReadyAnims.get(i);
      anim.startAnimation(this);
      anim.mRunning=true;
      mDelayedAnims.remove(anim);
    }
    mReadyAnims.clear();
  }
  int numAnims=mAnimations.size();
  int i=0;
  while (i < numAnims) {
    ValueAnimator anim=mAnimations.get(i);
    if (anim.animationFrame(currentTime)) {
      mEndingAnims.add(anim);
    }
    if (mAnimations.size() == numAnims) {
      ++i;
    }
 else {
      --numAnims;
      mEndingAnims.remove(anim);
    }
  }
  if (mEndingAnims.size() > 0) {
    for (i=0; i < mEndingAnims.size(); ++i) {
      mEndingAnims.get(i).endAnimation(this);
    }
    mEndingAnims.clear();
  }
  if (!mAnimations.isEmpty() || !mDelayedAnims.isEmpty()) {
    if (!mIsChoreographed) {
      mIsChoreographed=true;
      mChoreographer.addOnAnimateListener(this);
    }
    mChoreographer.scheduleAnimation();
  }
 else {
    if (mIsChoreographed) {
      mIsChoreographed=false;
      mChoreographer.removeOnAnimateListener(this);
    }
  }
}
