{
  ArrayList<ComponentName> installedComponents=getInstalledComponents();
  final int installedCount=installedComponents.size();
  for (int i=0; i < installedCount; i++) {
    ComponentName serviceName=installedComponents.get(i);
    if (!mDisabledServices.contains(serviceName)) {
      if (!mActiveServices.containsKey(serviceName)) {
        RemotePrintService service=new RemotePrintService(mContext,serviceName,mUserId,mSpooler,this);
        addServiceLocked(service);
      }
    }
 else {
      RemotePrintService service=mActiveServices.remove(serviceName);
      if (service != null) {
        removeServiceLocked(service);
      }
    }
  }
  Iterator<Map.Entry<ComponentName,RemotePrintService>> iterator=mActiveServices.entrySet().iterator();
  while (iterator.hasNext()) {
    Map.Entry<ComponentName,RemotePrintService> entry=iterator.next();
    ComponentName serviceName=entry.getKey();
    RemotePrintService service=entry.getValue();
    if (!installedComponents.contains(serviceName)) {
      removeServiceLocked(service);
      iterator.remove();
    }
  }
  onPrintServicesChanged();
}
