{
synchronized (mLock) {
    List<PrintServiceInfo> selectedServices=null;
    final int installedServiceCount=mInstalledServices.size();
    for (int i=0; i < installedServiceCount; i++) {
      PrintServiceInfo installedService=mInstalledServices.get(i);
      ComponentName componentName=new ComponentName(installedService.getResolveInfo().serviceInfo.packageName,installedService.getResolveInfo().serviceInfo.name);
      installedService.setIsEnabled(mActiveServices.containsKey(componentName));
      if (installedService.isEnabled()) {
        if ((selectionFlags & PrintManager.ENABLED_SERVICES) == 0) {
          continue;
        }
      }
 else {
        if ((selectionFlags & PrintManager.DISABLED_SERVICES) == 0) {
          continue;
        }
      }
      if (selectedServices == null) {
        selectedServices=new ArrayList<>();
      }
      selectedServices.add(installedService);
    }
    return selectedServices;
  }
}
