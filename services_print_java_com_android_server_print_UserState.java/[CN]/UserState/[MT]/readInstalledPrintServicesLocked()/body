{
  Set<PrintServiceInfo> tempPrintServices=new HashSet<PrintServiceInfo>();
  List<ResolveInfo> installedServices=mContext.getPackageManager().queryIntentServicesAsUser(mQueryIntent,GET_SERVICES | GET_META_DATA | MATCH_DEBUG_TRIAGED_MISSING,mUserId);
  final int installedCount=installedServices.size();
  for (int i=0, count=installedCount; i < count; i++) {
    ResolveInfo installedService=installedServices.get(i);
    if (!android.Manifest.permission.BIND_PRINT_SERVICE.equals(installedService.serviceInfo.permission)) {
      ComponentName serviceName=new ComponentName(installedService.serviceInfo.packageName,installedService.serviceInfo.name);
      Slog.w(LOG_TAG,"Skipping print service " + serviceName.flattenToShortString() + " since it does not require permission "+ android.Manifest.permission.BIND_PRINT_SERVICE);
      continue;
    }
    tempPrintServices.add(PrintServiceInfo.create(installedService,mContext));
  }
  boolean someServiceChanged=false;
  if (tempPrintServices.size() != mInstalledServices.size()) {
    someServiceChanged=true;
  }
 else {
    for (    PrintServiceInfo newService : tempPrintServices) {
      final int oldServiceIndex=mInstalledServices.indexOf(newService);
      if (oldServiceIndex < 0) {
        someServiceChanged=true;
        break;
      }
      PrintServiceInfo oldService=mInstalledServices.get(oldServiceIndex);
      if (!TextUtils.equals(oldService.getAddPrintersActivityName(),newService.getAddPrintersActivityName()) || !TextUtils.equals(oldService.getAdvancedOptionsActivityName(),newService.getAdvancedOptionsActivityName()) || !TextUtils.equals(oldService.getSettingsActivityName(),newService.getSettingsActivityName())) {
        someServiceChanged=true;
        break;
      }
    }
  }
  if (someServiceChanged) {
    mInstalledServices.clear();
    mInstalledServices.addAll(tempPrintServices);
    return true;
  }
  return false;
}
