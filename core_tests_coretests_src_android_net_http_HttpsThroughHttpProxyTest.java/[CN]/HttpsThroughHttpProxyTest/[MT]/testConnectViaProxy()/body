{
  MockWebServer proxy=new MockWebServer();
  MockResponse mockResponse=new MockResponse().setResponseCode(200).setBody("this response comes via a proxy");
  proxy.enqueue(mockResponse);
  proxy.play();
  HttpClient httpProxyClient=new DefaultHttpClient();
  httpProxyClient.getParams().setParameter(ConnRoutePNames.DEFAULT_PROXY,new HttpHost("localhost",proxy.getPort()));
  HttpResponse response=httpProxyClient.execute(new HttpGet("http://android.com/foo"));
  assertEquals("this response comes via a proxy",contentToString(response));
  RecordedRequest request=proxy.takeRequest();
  assertEquals("GET http://android.com/foo HTTP/1.1",request.getRequestLine());
  assertContains(request.getHeaders(),"Host: android.com");
}
