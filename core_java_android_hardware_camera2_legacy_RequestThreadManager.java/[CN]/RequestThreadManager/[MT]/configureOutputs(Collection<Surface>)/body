{
  stopPreview();
  if (mGLThreadManager != null) {
    mGLThreadManager.waitUntilStarted();
    mGLThreadManager.ignoreNewFrames();
    mGLThreadManager.waitUntilIdle();
  }
  mPreviewOutputs.clear();
  mCallbackOutputs.clear();
  mPreviewTexture=null;
  mInFlightPreview=null;
  mInFlightJpeg=null;
  for (  Surface s : outputs) {
    int format=LegacyCameraDevice.nativeDetectSurfaceType(s);
switch (format) {
case CameraMetadataNative.NATIVE_JPEG_FORMAT:
      mCallbackOutputs.add(s);
    break;
default :
  mPreviewOutputs.add(s);
break;
}
}
if (mGLThreadManager == null) {
mGLThreadManager=new GLThreadManager(mCameraId);
mGLThreadManager.start();
}
mGLThreadManager.waitUntilStarted();
mGLThreadManager.setConfigurationAndWait(mPreviewOutputs);
mGLThreadManager.allowNewFrames();
mPreviewTexture=mGLThreadManager.getCurrentSurfaceTexture();
mPreviewTexture.setOnFrameAvailableListener(mPreviewCallback);
}
