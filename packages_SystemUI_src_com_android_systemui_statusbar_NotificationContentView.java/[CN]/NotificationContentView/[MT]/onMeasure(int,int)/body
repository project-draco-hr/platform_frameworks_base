{
  int heightMode=MeasureSpec.getMode(heightMeasureSpec);
  boolean hasFixedHeight=heightMode == MeasureSpec.EXACTLY;
  boolean isHeightLimited=heightMode == MeasureSpec.AT_MOST;
  int maxSize=Integer.MAX_VALUE;
  if (hasFixedHeight || isHeightLimited) {
    maxSize=MeasureSpec.getSize(heightMeasureSpec);
  }
  int maxChildHeight=0;
  if (mContractedChild != null) {
    int size=Math.min(maxSize,mSmallHeight);
    mContractedChild.measure(widthMeasureSpec,MeasureSpec.makeMeasureSpec(size,MeasureSpec.EXACTLY));
    maxChildHeight=Math.max(maxChildHeight,mContractedChild.getMeasuredHeight());
  }
  if (mExpandedChild != null) {
    int size=maxSize;
    ViewGroup.LayoutParams layoutParams=mExpandedChild.getLayoutParams();
    if (layoutParams.height >= 0) {
      size=Math.min(maxSize,layoutParams.height);
    }
    int spec=size == Integer.MAX_VALUE ? MeasureSpec.makeMeasureSpec(0,MeasureSpec.UNSPECIFIED) : MeasureSpec.makeMeasureSpec(size,MeasureSpec.AT_MOST);
    mExpandedChild.measure(widthMeasureSpec,spec);
    maxChildHeight=Math.max(maxChildHeight,mExpandedChild.getMeasuredHeight());
  }
  if (mHeadsUpChild != null) {
    int size=Math.min(maxSize,mHeadsUpHeight);
    ViewGroup.LayoutParams layoutParams=mHeadsUpChild.getLayoutParams();
    if (layoutParams.height >= 0) {
      size=Math.min(maxSize,layoutParams.height);
    }
    mHeadsUpChild.measure(widthMeasureSpec,MeasureSpec.makeMeasureSpec(size,MeasureSpec.AT_MOST));
    maxChildHeight=Math.max(maxChildHeight,mHeadsUpChild.getMeasuredHeight());
  }
  int ownHeight=Math.min(maxChildHeight,maxSize);
  int width=MeasureSpec.getSize(widthMeasureSpec);
  setMeasuredDimension(width,ownHeight);
}
