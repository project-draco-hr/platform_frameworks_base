{
  if (mUserExpanding) {
    int height=!mIsChildInGroup || isGroupExpanded() || mContainingNotification.isExpanded() ? mContainingNotification.getMaxContentHeight() : mContainingNotification.getShowingLayout().getMinHeight();
    int expandedVisualType=getVisualTypeForHeight(height);
    int collapsedVisualType=getVisualTypeForHeight(mContainingNotification.getMinExpandHeight());
    return mTransformationStartVisibleType == collapsedVisualType ? expandedVisualType : collapsedVisualType;
  }
  int viewHeight=Math.min(mContentHeight,mContainingNotification.getIntrinsicHeight());
  return getVisualTypeForHeight(viewHeight);
}
