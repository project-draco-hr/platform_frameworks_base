{
  int visibleType=calculateVisibleType();
  if (visibleType != mVisibleType) {
    mTransformationStartVisibleType=mVisibleType;
    final TransformableView shownView=getTransformableViewForVisibleType(visibleType);
    final TransformableView hiddenView=getTransformableViewForVisibleType(mTransformationStartVisibleType);
    shownView.transformFrom(hiddenView,0.0f);
    getViewForVisibleType(visibleType).setVisibility(View.VISIBLE);
    hiddenView.transformTo(shownView,0.0f);
    mVisibleType=visibleType;
    updateBackgroundColor(true);
  }
  if (mTransformationStartVisibleType != UNDEFINED && mVisibleType != mTransformationStartVisibleType && getViewForVisibleType(mTransformationStartVisibleType) != null) {
    final TransformableView shownView=getTransformableViewForVisibleType(mVisibleType);
    final TransformableView hiddenView=getTransformableViewForVisibleType(mTransformationStartVisibleType);
    float transformationAmount=calculateTransformationAmount();
    shownView.transformFrom(hiddenView,transformationAmount);
    hiddenView.transformTo(shownView,transformationAmount);
    updateBackgroundTransformation(transformationAmount);
  }
 else {
    updateViewVisibilities(visibleType);
    updateBackgroundColor(false);
  }
}
