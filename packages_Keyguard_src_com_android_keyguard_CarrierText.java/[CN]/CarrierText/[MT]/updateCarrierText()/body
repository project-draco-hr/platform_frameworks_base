{
  boolean allSimsMissing=true;
  CharSequence displayText=null;
  List<SubscriptionInfo> subs=mKeyguardUpdateMonitor.getSubscriptionInfo(false);
  final int N=subs.size();
  if (DEBUG)   Log.d(TAG,"updateCarrierText(): " + N);
  for (int i=0; i < N; i++) {
    State simState=mKeyguardUpdateMonitor.getSimState(subs.get(i).getSubscriptionId());
    CharSequence carrierName=subs.get(i).getCarrierName();
    CharSequence carrierTextForSimState=getCarrierTextForSimState(simState,carrierName);
    if (DEBUG)     Log.d(TAG,"Handling " + simState + " "+ carrierName);
    if (carrierTextForSimState != null) {
      allSimsMissing=false;
      displayText=concatenate(displayText,carrierTextForSimState);
    }
  }
  if (allSimsMissing) {
    if (N != 0) {
      displayText=makeCarrierStringOnEmergencyCapable(getContext().getText(R.string.keyguard_missing_sim_message_short),subs.get(0).getCarrierName());
    }
 else {
      displayText=makeCarrierStringOnEmergencyCapable(getContext().getText(R.string.keyguard_missing_sim_message_short),getContext().getText(com.android.internal.R.string.emergency_calls_only));
    }
  }
  setText(displayText);
}
