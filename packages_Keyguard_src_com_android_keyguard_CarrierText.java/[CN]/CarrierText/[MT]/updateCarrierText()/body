{
  boolean allSimsMissing=true;
  CharSequence displayText=null;
  List<SubscriptionInfo> subs=mKeyguardUpdateMonitor.getSubscriptionInfo(false);
  final int N=subs.size();
  if (DEBUG)   Log.d(TAG,"updateCarrierText(): " + N);
  for (int i=0; i < N; i++) {
    State simState=mKeyguardUpdateMonitor.getSimState(subs.get(i).getSubscriptionId());
    CharSequence carrierName=subs.get(i).getCarrierName();
    CharSequence carrierTextForSimState=getCarrierTextForSimState(simState,carrierName);
    if (DEBUG)     Log.d(TAG,"Handling " + simState + " "+ carrierName);
    if (carrierTextForSimState != null) {
      allSimsMissing=false;
      displayText=concatenate(displayText,carrierTextForSimState);
    }
  }
  if (allSimsMissing) {
    if (N != 0) {
      displayText=makeCarrierStringOnEmergencyCapable(getContext().getText(R.string.keyguard_missing_sim_message_short),subs.get(0).getCarrierName());
    }
 else {
      CharSequence text=getContext().getText(com.android.internal.R.string.emergency_calls_only);
      Intent i=getContext().registerReceiver(null,new IntentFilter(TelephonyIntents.SPN_STRINGS_UPDATED_ACTION));
      if (i != null) {
        String spn="";
        String plmn="";
        if (i.getBooleanExtra(TelephonyIntents.EXTRA_SHOW_SPN,false)) {
          spn=i.getStringExtra(TelephonyIntents.EXTRA_SPN);
        }
        if (i.getBooleanExtra(TelephonyIntents.EXTRA_SHOW_PLMN,false)) {
          plmn=i.getStringExtra(TelephonyIntents.EXTRA_PLMN);
        }
        if (DEBUG)         Log.d(TAG,"Getting plmn/spn sticky brdcst " + plmn + "/"+ spn);
        text=concatenate(plmn,spn);
      }
      displayText=makeCarrierStringOnEmergencyCapable(getContext().getText(R.string.keyguard_missing_sim_message_short),text);
    }
  }
  setText(displayText);
}
