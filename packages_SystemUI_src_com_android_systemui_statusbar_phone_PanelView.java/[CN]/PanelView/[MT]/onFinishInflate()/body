{
  super.onFinishInflate();
  loadDimens();
  mHandleView=findViewById(R.id.handle);
  LOG("handle view: " + mHandleView);
  if (mHandleView != null) {
    mHandleView.setOnTouchListener(new View.OnTouchListener(){
      @Override public boolean onTouch(      View v,      MotionEvent event){
        final float y=event.getY();
        final float rawY=event.getRawY();
        LOG("handle.onTouch: a=%s y=%.1f rawY=%.1f off=%.1f",MotionEvent.actionToString(event.getAction()),y,rawY,mTouchOffset);
        PanelView.this.getLocationOnScreen(mAbsPos);
switch (event.getAction()) {
case MotionEvent.ACTION_DOWN:
          mTracking=true;
        mHandleView.setPressed(true);
      mInitialTouchY=y;
    mVelocityTracker=VelocityTracker.obtain();
  trackMovement(event);
mBar.onTrackingStarted(PanelView.this);
mTouchOffset=(rawY - mAbsPos[1]) - PanelView.this.getExpandedHeight();
break;
case MotionEvent.ACTION_MOVE:
PanelView.this.setExpandedHeightInternal(rawY - mAbsPos[1] - mTouchOffset);
mBar.panelExpansionChanged(PanelView.this,mExpandedFraction);
trackMovement(event);
break;
case MotionEvent.ACTION_UP:
case MotionEvent.ACTION_CANCEL:
mFinalTouchY=y;
mTracking=false;
mHandleView.setPressed(false);
mBar.onTrackingStopped(PanelView.this);
trackMovement(event);
mVelocityTracker.computeCurrentVelocity(1000);
float yVel=mVelocityTracker.getYVelocity();
boolean negative=yVel < 0;
float xVel=mVelocityTracker.getXVelocity();
if (xVel < 0) {
xVel=-xVel;
}
if (xVel > mFlingGestureMaxXVelocityPx) {
xVel=mFlingGestureMaxXVelocityPx;
}
float vel=(float)Math.hypot(yVel,xVel);
if (vel > mFlingGestureMaxOutputVelocityPx) {
vel=mFlingGestureMaxOutputVelocityPx;
}
final float deltaY=(float)Math.abs(mFinalTouchY - mInitialTouchY);
if (deltaY < mFlingGestureMinDistPx || vel < mFlingGestureMinDistPx) {
vel=0;
}
if (negative) {
vel=-vel;
}
LOG("gesture: dy=%f vraw=(%f,%f) vnorm=(%f,%f) vlinear=%f",deltaY,mVelocityTracker.getXVelocity(),mVelocityTracker.getYVelocity(),xVel,yVel,vel);
fling(vel,true);
mVelocityTracker.recycle();
mVelocityTracker=null;
break;
}
return true;
}
}
);
}
}
