{
  if (!mTimeAnimator.isStarted()) {
    mTimeAnimator=new TimeAnimator();
    mTimeAnimator.setTimeListener(mAnimationCallback);
    mTimeAnimator.start();
  }
 else {
    final float dt=dtms * 0.001f;
    LOG("tick: v=%.2fpx/s dt=%.4fs",mVel,dt);
    LOG("tick: before: h=%d",(int)mExpandedHeight);
    final float fh=getFullHeight();
    final boolean closing=mExpandedHeight > 0 && mVel < 0;
    boolean braking=false;
    if (BRAKES) {
      if (closing) {
        braking=mExpandedHeight <= mCollapseBrakingDistancePx;
        mAccel=braking ? 10 * mCollapseAccelPx : -mCollapseAccelPx;
      }
 else {
        braking=mExpandedHeight >= (fh - mExpandBrakingDistancePx);
        mAccel=braking ? 10 * -mExpandAccelPx : mExpandAccelPx;
      }
    }
 else {
      mAccel=closing ? -mCollapseAccelPx : mExpandAccelPx;
    }
    mVel+=mAccel * dt;
    if (braking) {
      if (closing && mVel > -mBrakingSpeedPx) {
        mVel=-mBrakingSpeedPx;
      }
 else       if (!closing && mVel < mBrakingSpeedPx) {
        mVel=mBrakingSpeedPx;
      }
    }
 else {
      if (closing && mVel > -mFlingCollapseMinVelocityPx) {
        mVel=-mFlingCollapseMinVelocityPx;
      }
 else       if (!closing && mVel > mFlingGestureMaxOutputVelocityPx) {
        mVel=mFlingGestureMaxOutputVelocityPx;
      }
    }
    float h=mExpandedHeight + mVel * dt;
    LOG("tick: new h=%d closing=%s",(int)h,closing ? "true" : "false");
    setExpandedHeightInternal(h);
    mBar.panelExpansionChanged(PanelView.this,mExpandedFraction);
    if (mVel == 0 || (closing && mExpandedHeight == 0) || (!closing && mExpandedHeight == getFullHeight())) {
      mTimeAnimator.end();
    }
  }
}
