{
  float vel=0;
  float yVel=0, xVel=0;
  boolean negative=false;
  if (mVelocityTracker == null) {
    return 0;
  }
  mVelocityTracker.computeCurrentVelocity(1000);
  yVel=mVelocityTracker.getYVelocity();
  negative=yVel < 0;
  xVel=mVelocityTracker.getXVelocity();
  if (xVel < 0) {
    xVel=-xVel;
  }
  if (xVel > mFlingGestureMaxXVelocityPx) {
    xVel=mFlingGestureMaxXVelocityPx;
  }
  vel=(float)Math.hypot(yVel,xVel);
  if (vel > mFlingGestureMaxOutputVelocityPx) {
    vel=mFlingGestureMaxOutputVelocityPx;
  }
  final float deltaY=Math.abs(mFinalTouchY - mInitialTouchY);
  if (deltaY < mFlingGestureMinDistPx || vel < mFlingExpandMinVelocityPx) {
    vel=0;
  }
  if (negative) {
    vel=-vel;
  }
  if (DEBUG) {
    logf("gesture: dy=%f vel=(%f,%f) vlinear=%f",deltaY,xVel,yVel,vel);
  }
  return vel;
}
