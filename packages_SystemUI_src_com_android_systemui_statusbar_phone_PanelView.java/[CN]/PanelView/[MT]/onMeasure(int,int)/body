{
  super.onMeasure(widthMeasureSpec,heightMeasureSpec);
  if (DEBUG)   logf("onMeasure(%d, %d) -> (%d, %d)",widthMeasureSpec,heightMeasureSpec,getMeasuredWidth(),getMeasuredHeight());
  int newHeight=getMeasuredHeight();
  if (newHeight != mMaxPanelHeight) {
    mMaxPanelHeight=newHeight;
    if (!mTracking && !mRubberbanding && !mTimeAnimator.isStarted()&& mExpandedHeight > 0 && mExpandedHeight != mMaxPanelHeight && mMaxPanelHeight > 0) {
      mExpandedHeight=mMaxPanelHeight;
    }
  }
  heightMeasureSpec=MeasureSpec.makeMeasureSpec(getDesiredMeasureHeight(),MeasureSpec.AT_MOST);
  setMeasuredDimension(widthMeasureSpec,heightMeasureSpec);
}
