{
  HierarchicalState destState=null;
  while (mDestState != null) {
    if (mDbg)     Log.d(TAG,"handleMessage: new destination call exit");
    destState=mDestState;
    mDestState=null;
    StateInfo commonStateInfo=setupTempStateStackWithStatesToEnter(destState);
    invokeExitMethods(commonStateInfo);
    int stateStackEnteringIndex=moveTempStateStackToStateStack();
    invokeEnterMethods(stateStackEnteringIndex);
    moveDeferredMessageAtFrontOfQueue();
  }
  if (destState != null) {
    if (destState == mQuittingState) {
      mHsm.quitting();
      if (mHsm.mHsmThread != null) {
        getLooper().quit();
        mHsm.mHsmThread=null;
      }
    }
 else     if (destState == mHaltingState) {
      mHsm.halting();
    }
  }
}
