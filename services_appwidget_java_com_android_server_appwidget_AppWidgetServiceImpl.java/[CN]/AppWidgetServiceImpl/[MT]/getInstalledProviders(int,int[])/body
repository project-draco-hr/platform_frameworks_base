{
  final int userId=UserHandle.getCallingUserId();
  if (DEBUG) {
    Slog.i(TAG,"getInstalledProvidersForProfiles() " + userId);
  }
  if (profileIds != null && profileIds.length > 0) {
    profileIds=mSecurityPolicy.resolveCallerEnabledGroupProfiles(profileIds);
  }
 else {
    profileIds=new int[]{userId};
  }
  if (profileIds.length == 0) {
    return null;
  }
synchronized (mLock) {
    ensureGroupStateLoadedLocked(userId);
    ArrayList<AppWidgetProviderInfo> result=new ArrayList<>();
    final int providerCount=mProviders.size();
    for (int i=0; i < providerCount; i++) {
      Provider provider=mProviders.get(i);
      AppWidgetProviderInfo info=provider.info;
      if (provider.zombie || (info.widgetCategory & categoryFilter) == 0) {
        continue;
      }
      final int providerProfileId=info.getProfile().getIdentifier();
      final int profileCount=profileIds.length;
      for (int j=0; j < profileCount; j++) {
        final int profileId=profileIds[j];
        if (providerProfileId == profileId) {
          if (mSecurityPolicy.isProviderInCallerOrInProfileAndWhitelListed(provider.id.componentName.getPackageName(),providerProfileId)) {
            result.add(cloneIfLocalBinder(info));
          }
          break;
        }
      }
    }
    return result;
  }
}
