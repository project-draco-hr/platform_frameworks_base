{
  List<LoadedWidgetState> loadedWidgets=new ArrayList<>();
  int version=0;
  final int profileIdCount=profileIds.length;
  for (int i=0; i < profileIdCount; i++) {
    final int profileId=profileIds[i];
    AtomicFile file=getSavedStateFile(profileId);
    try {
      FileInputStream stream=file.openRead();
      version=readProfileStateFromFileLocked(stream,profileId,loadedWidgets);
      IoUtils.closeQuietly(stream);
    }
 catch (    FileNotFoundException e) {
      Slog.w(TAG,"Failed to read state: " + e);
    }
  }
  if (version >= 0) {
    bindLoadedWidgets(loadedWidgets);
    performUpgradeLocked(version);
  }
 else {
    Slog.w(TAG,"Failed to read state, clearing widgets and hosts.");
    mWidgets.clear();
    mHosts.clear();
    final int N=mProviders.size();
    for (int i=0; i < N; i++) {
      mProviders.get(i).widgets.clear();
    }
  }
}
