{
  if (!mUserManager.isUserUnlockingOrUnlocked(userId)) {
    throw new IllegalStateException("User " + userId + " must be unlocked for widgets to be available");
  }
  if (isProfileWithLockedParent(userId)) {
    throw new IllegalStateException("Profile " + userId + " must have unlocked parent");
  }
  final int[] profileIds=mSecurityPolicy.getEnabledGroupProfileIds(userId);
  int newMemberCount=0;
  final int profileIdCount=profileIds.length;
  for (int i=0; i < profileIdCount; i++) {
    final int profileId=profileIds[i];
    if (mLoadedUserIds.indexOfKey(profileId) >= 0) {
      profileIds[i]=LOADED_PROFILE_ID;
    }
 else {
      newMemberCount++;
    }
  }
  if (newMemberCount <= 0) {
    return;
  }
  int newMemberIndex=0;
  final int[] newProfileIds=new int[newMemberCount];
  for (int i=0; i < profileIdCount; i++) {
    final int profileId=profileIds[i];
    if (profileId != LOADED_PROFILE_ID) {
      mLoadedUserIds.put(profileId,profileId);
      newProfileIds[newMemberIndex]=profileId;
      newMemberIndex++;
    }
  }
  clearProvidersAndHostsTagsLocked();
  loadGroupWidgetProvidersLocked(newProfileIds);
  loadGroupStateLocked(newProfileIds);
}
