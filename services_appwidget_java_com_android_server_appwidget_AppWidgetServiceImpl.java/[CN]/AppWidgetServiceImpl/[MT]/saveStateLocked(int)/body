{
  tagProvidersAndHosts();
  final int[] profileIds=mSecurityPolicy.getEnabledGroupProfileIds(userId);
  final int profileCount=profileIds.length;
  for (int i=0; i < profileCount; i++) {
    final int profileId=profileIds[i];
    AtomicFile file=getSavedStateFile(profileId);
    FileOutputStream stream;
    try {
      stream=file.startWrite();
      if (writeProfileStateToFileLocked(stream,profileId)) {
        file.finishWrite(stream);
      }
 else {
        file.failWrite(stream);
        Slog.w(TAG,"Failed to save state, restoring backup.");
      }
    }
 catch (    IOException e) {
      Slog.w(TAG,"Failed open state file for write: " + e);
    }
  }
}
