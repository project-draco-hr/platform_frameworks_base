{
  Provider provider=null;
  ActivityInfo activityInfo=ri.activityInfo;
  XmlResourceParser parser=null;
  try {
    parser=activityInfo.loadXmlMetaData(mContext.getPackageManager(),AppWidgetManager.META_DATA_APPWIDGET_PROVIDER);
    if (parser == null) {
      Slog.w(TAG,"No " + AppWidgetManager.META_DATA_APPWIDGET_PROVIDER + " meta-data for "+ "AppWidget provider '"+ providerId+ '\'');
      return null;
    }
    AttributeSet attrs=Xml.asAttributeSet(parser);
    int type;
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT && type != XmlPullParser.START_TAG) {
    }
    String nodeName=parser.getName();
    if (!"appwidget-provider".equals(nodeName)) {
      Slog.w(TAG,"Meta-data does not start with appwidget-provider tag for" + " AppWidget provider " + providerId.componentName + " for user "+ providerId.uid);
      return null;
    }
    provider=new Provider();
    provider.id=providerId;
    AppWidgetProviderInfo info=provider.info=new AppWidgetProviderInfo();
    info.provider=providerId.componentName;
    info.providerInfo=activityInfo;
    final Resources resources;
    final long identity=Binder.clearCallingIdentity();
    try {
      final PackageManager pm=mContext.getPackageManager();
      final int userId=UserHandle.getUserId(providerId.uid);
      final ApplicationInfo app=pm.getApplicationInfoAsUser(activityInfo.packageName,0,userId);
      resources=pm.getResourcesForApplication(app);
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
    TypedArray sa=resources.obtainAttributes(attrs,com.android.internal.R.styleable.AppWidgetProviderInfo);
    TypedValue value=sa.peekValue(com.android.internal.R.styleable.AppWidgetProviderInfo_minWidth);
    info.minWidth=value != null ? value.data : 0;
    value=sa.peekValue(com.android.internal.R.styleable.AppWidgetProviderInfo_minHeight);
    info.minHeight=value != null ? value.data : 0;
    value=sa.peekValue(com.android.internal.R.styleable.AppWidgetProviderInfo_minResizeWidth);
    info.minResizeWidth=value != null ? value.data : info.minWidth;
    value=sa.peekValue(com.android.internal.R.styleable.AppWidgetProviderInfo_minResizeHeight);
    info.minResizeHeight=value != null ? value.data : info.minHeight;
    info.updatePeriodMillis=sa.getInt(com.android.internal.R.styleable.AppWidgetProviderInfo_updatePeriodMillis,0);
    info.initialLayout=sa.getResourceId(com.android.internal.R.styleable.AppWidgetProviderInfo_initialLayout,0);
    info.initialKeyguardLayout=sa.getResourceId(com.android.internal.R.styleable.AppWidgetProviderInfo_initialKeyguardLayout,0);
    String className=sa.getString(com.android.internal.R.styleable.AppWidgetProviderInfo_configure);
    if (className != null) {
      info.configure=new ComponentName(providerId.componentName.getPackageName(),className);
    }
    info.label=activityInfo.loadLabel(mContext.getPackageManager()).toString();
    info.icon=ri.getIconResource();
    info.previewImage=sa.getResourceId(com.android.internal.R.styleable.AppWidgetProviderInfo_previewImage,0);
    info.autoAdvanceViewId=sa.getResourceId(com.android.internal.R.styleable.AppWidgetProviderInfo_autoAdvanceViewId,-1);
    info.resizeMode=sa.getInt(com.android.internal.R.styleable.AppWidgetProviderInfo_resizeMode,AppWidgetProviderInfo.RESIZE_NONE);
    info.widgetCategory=sa.getInt(com.android.internal.R.styleable.AppWidgetProviderInfo_widgetCategory,AppWidgetProviderInfo.WIDGET_CATEGORY_HOME_SCREEN);
    sa.recycle();
  }
 catch (  IOException|PackageManager.NameNotFoundException|XmlPullParserException e) {
    Slog.w(TAG,"XML parsing failed for AppWidget provider " + providerId.componentName + " for user "+ providerId.uid,e);
    return null;
  }
 finally {
    if (parser != null) {
      parser.close();
    }
  }
  return provider;
}
