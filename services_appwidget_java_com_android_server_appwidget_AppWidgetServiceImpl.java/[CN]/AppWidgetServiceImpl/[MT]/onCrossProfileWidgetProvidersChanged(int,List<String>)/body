{
  final int parentId=mSecurityPolicy.getProfileParent(userId);
  if (parentId != userId) {
synchronized (mLock) {
      boolean providersChanged=false;
      ArraySet<String> previousPackages=new ArraySet<String>();
      final int providerCount=mProviders.size();
      for (int i=0; i < providerCount; ++i) {
        Provider provider=mProviders.get(i);
        if (provider.getUserId() == userId) {
          previousPackages.add(provider.id.componentName.getPackageName());
        }
      }
      final int packageCount=packages.size();
      for (int i=0; i < packageCount; i++) {
        String packageName=packages.get(i);
        previousPackages.remove(packageName);
        providersChanged|=updateProvidersForPackageLocked(packageName,userId,null);
      }
      final int removedCount=previousPackages.size();
      for (int i=0; i < removedCount; ++i) {
        removeWidgetsForPackageLocked(previousPackages.valueAt(i),userId,parentId);
      }
      if (providersChanged || removedCount > 0) {
        saveGroupStateAsync(userId);
        scheduleNotifyGroupHostsForProvidersChangedLocked(userId);
      }
    }
  }
}
