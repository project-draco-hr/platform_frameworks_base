{
  if (provider.info.updatePeriodMillis > 0) {
    boolean alreadyRegistered=provider.broadcast != null;
    Intent intent=new Intent(AppWidgetManager.ACTION_APPWIDGET_UPDATE);
    intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_IDS,appWidgetIds);
    intent.setComponent(provider.info.provider);
    long token=Binder.clearCallingIdentity();
    try {
      provider.broadcast=PendingIntent.getBroadcastAsUser(mContext,1,intent,PendingIntent.FLAG_UPDATE_CURRENT,provider.info.getProfile());
    }
  finally {
      Binder.restoreCallingIdentity(token);
    }
    if (!alreadyRegistered) {
      long period=provider.info.updatePeriodMillis;
      if (period < MIN_UPDATE_PERIOD) {
        period=MIN_UPDATE_PERIOD;
      }
      final long oldId=Binder.clearCallingIdentity();
      try {
        mAlarmManager.setInexactRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP,SystemClock.elapsedRealtime() + period,period,provider.broadcast);
      }
  finally {
        Binder.restoreCallingIdentity(oldId);
      }
    }
  }
}
