{
  final int parentId=getGroupParent(userId);
  final List<UserInfo> profiles;
  final long identity=Binder.clearCallingIdentity();
  try {
    profiles=mUserManager.getProfiles(parentId);
  }
  finally {
    Binder.restoreCallingIdentity(identity);
  }
  int enabledProfileCount=0;
  final int profileCount=profiles.size();
  for (int i=0; i < profileCount; i++) {
    if (profiles.get(i).isEnabled()) {
      enabledProfileCount++;
    }
  }
  int enabledProfileIndex=0;
  final int[] profileIds=new int[enabledProfileCount];
  for (int i=0; i < profileCount; i++) {
    UserInfo profile=profiles.get(i);
    if (profile.isEnabled()) {
      profileIds[enabledProfileIndex]=profile.getUserHandle().getIdentifier();
      enabledProfileIndex++;
    }
  }
  return profileIds;
}
