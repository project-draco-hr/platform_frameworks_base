{
  final int parentId=UserHandle.getCallingUserId();
  int enabledProfileCount=0;
  final int profileCount=profileIds.length;
  for (int i=0; i < profileCount; i++) {
    final int profileId=profileIds[i];
    if (!isParentOrProfile(parentId,profileId)) {
      throw new SecurityException("Not the current user or" + " a child profile: " + profileId);
    }
    if (!isProfileEnabled(profileId)) {
      profileIds[i]=DISABLED_PROFILE;
    }
 else {
      enabledProfileCount++;
    }
  }
  int resolvedProfileIndex=0;
  final int[] resolvedProfiles=new int[enabledProfileCount];
  for (int i=0; i < profileCount; i++) {
    final int profileId=profileIds[i];
    if (profileId != DISABLED_PROFILE) {
      resolvedProfiles[resolvedProfileIndex]=profileId;
      resolvedProfileIndex++;
    }
  }
  return resolvedProfiles;
}
