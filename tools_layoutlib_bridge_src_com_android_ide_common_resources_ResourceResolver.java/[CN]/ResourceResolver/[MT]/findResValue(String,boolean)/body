{
  if (reference == null) {
    return null;
  }
  if (reference.startsWith(PREFIX_THEME_REF)) {
    if (mTheme == null) {
      return null;
    }
    boolean frameworkOnly=false;
    if (reference.startsWith(PREFIX_ANDROID_THEME_REF)) {
      frameworkOnly=true;
      reference=reference.substring(PREFIX_ANDROID_THEME_REF.length());
    }
 else {
      reference=reference.substring(PREFIX_THEME_REF.length());
    }
    String[] segments=reference.split("\\/");
    String referenceName=null;
    if (segments.length == 2) {
      if (RES_ATTR.equals(segments[0])) {
        referenceName=segments[1];
      }
 else {
        return null;
      }
    }
 else {
      referenceName=segments[0];
    }
    if (referenceName.startsWith(PREFIX_ANDROID)) {
      frameworkOnly=true;
      referenceName=referenceName.substring(PREFIX_ANDROID.length());
    }
    if (frameworkOnly) {
      return findItemInStyle(mTheme,referenceName);
    }
    return findItemInStyle(mTheme,referenceName);
  }
 else   if (reference.startsWith(PREFIX_RESOURCE_REF)) {
    boolean frameworkOnly=false;
    if (REFERENCE_NULL.equals(reference)) {
      return null;
    }
    if (reference.startsWith(PREFIX_ANDROID_RESOURCE_REF)) {
      frameworkOnly=true;
      reference=reference.substring(PREFIX_ANDROID_RESOURCE_REF.length());
    }
 else {
      reference=reference.substring(PREFIX_RESOURCE_REF.length());
    }
    String[] segments=reference.split("\\/");
    if (segments[1].startsWith(PREFIX_ANDROID)) {
      frameworkOnly=true;
      segments[1]=segments[1].substring(PREFIX_ANDROID.length());
    }
    return findResValue(segments[0],segments[1],forceFrameworkOnly ? true : frameworkOnly);
  }
  return null;
}
