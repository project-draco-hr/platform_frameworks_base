{
  if (keys == null) {
    throw new NullPointerException("Provided keys cannot be null");
  }
  ArraySet<Long> addedKeyIds=new ArraySet<Long>(keys.size());
  for (  PublicKey k : keys) {
    long id=addPublicKeyLPw(k);
    addedKeyIds.add(id);
  }
  long existingKeySetId=getIdFromKeyIdsLPr(addedKeyIds);
  if (existingKeySetId != KEYSET_NOT_FOUND) {
    return mKeySets.get(existingKeySetId);
  }
  KeySet ks=new KeySet(new Binder());
  long id=getFreeKeySetIDLPw();
  mKeySets.put(id,ks);
  mKeySetMapping.put(id,addedKeyIds);
  for (  String pkgName : mPackages.keySet()) {
    PackageSetting p=mPackages.get(pkgName);
    if (p.keySetData != null) {
      long pProperSigning=p.keySetData.getProperSigningKeySet();
      if (pProperSigning != PackageKeySetData.KEYSET_UNASSIGNED) {
        Set<Long> pSigningKeys=mKeySetMapping.get(pProperSigning);
        if (pSigningKeys.containsAll(addedKeyIds)) {
          p.keySetData.addSigningKeySet(id);
        }
      }
    }
  }
  return ks;
}
