{
  if ((packageName == null) || (signingKeys == null)) {
    Slog.w(TAG,"Got null argument for a signing keyset, ignoring!");
    return;
  }
synchronized (mLockObject) {
    KeySet ks=addKeySetLocked(signingKeys);
    long id=getIdByKeySetLocked(ks);
    Set<Long> publicKeyIds=mKeySetMapping.get(id);
    if (publicKeyIds == null) {
      throw new NullPointerException("Got invalid KeySet id");
    }
    PackageSetting pkg=mPackages.get(packageName);
    if (pkg == null) {
      throw new NullPointerException("No such package!");
    }
    pkg.keySetData.setProperSigningKeySet(id);
    for (int keySetIndex=0; keySetIndex < mKeySets.size(); keySetIndex++) {
      long keySetID=mKeySets.keyAt(keySetIndex);
      Set<Long> definedKeys=mKeySetMapping.get(keySetID);
      if (publicKeyIds.containsAll(definedKeys)) {
        pkg.keySetData.addSigningKeySet(keySetID);
      }
    }
  }
}
