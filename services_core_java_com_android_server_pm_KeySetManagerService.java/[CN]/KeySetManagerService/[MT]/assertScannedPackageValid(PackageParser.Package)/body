{
  if (pkg == null || pkg.packageName == null) {
    throw new PackageManagerException(INSTALL_FAILED_INVALID_APK,"Passed invalid package to keyset validation.");
  }
  ArraySet<PublicKey> signingKeys=pkg.mSigningKeys;
  if (signingKeys == null || !(signingKeys.size() > 0) || signingKeys.contains(null)) {
    throw new PackageManagerException(INSTALL_FAILED_INVALID_APK,"Package has invalid signing-key-set.");
  }
  ArrayMap<String,ArraySet<PublicKey>> definedMapping=pkg.mKeySetMapping;
  if (definedMapping != null) {
    if (definedMapping.containsKey(null) || definedMapping.containsValue(null)) {
      throw new PackageManagerException(INSTALL_FAILED_INVALID_APK,"Package has null defined key set.");
    }
    int defMapSize=definedMapping.size();
    for (int i=0; i < defMapSize; i++) {
      if (!(definedMapping.valueAt(i).size() > 0) || definedMapping.valueAt(i).contains(null)) {
        throw new PackageManagerException(INSTALL_FAILED_INVALID_APK,"Package has null/no public keys for defined key-sets.");
      }
    }
  }
  ArraySet<String> upgradeAliases=pkg.mUpgradeKeySets;
  if (upgradeAliases != null) {
    if (definedMapping == null || !(definedMapping.keySet().containsAll(upgradeAliases))) {
      throw new PackageManagerException(INSTALL_FAILED_INVALID_APK,"Package has upgrade-key-sets without corresponding definitions.");
    }
  }
}
