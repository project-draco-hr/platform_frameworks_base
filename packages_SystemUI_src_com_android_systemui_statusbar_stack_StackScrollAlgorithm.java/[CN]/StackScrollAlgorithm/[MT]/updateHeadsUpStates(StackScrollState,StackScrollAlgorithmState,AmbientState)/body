{
  int childCount=algorithmState.visibleChildren.size();
  ExpandableNotificationRow topHeadsUpEntry=null;
  for (int i=0; i < childCount; i++) {
    View child=algorithmState.visibleChildren.get(i);
    if (!(child instanceof ExpandableNotificationRow)) {
      break;
    }
    ExpandableNotificationRow row=(ExpandableNotificationRow)child;
    if (!row.isHeadsUp()) {
      break;
    }
 else     if (topHeadsUpEntry == null) {
      topHeadsUpEntry=row;
    }
    StackViewState childState=resultState.getViewStateForView(row);
    boolean isTopEntry=topHeadsUpEntry == row;
    if (mIsExpanded) {
      if (isTopEntry) {
        childState.height+=row.getHeadsUpHeight() - mCollapsedSize;
      }
      childState.height=Math.max(childState.height,row.getHeadsUpHeight());
      float bottomPosition=ambientState.getMaxHeadsUpTranslation() - childState.height;
      childState.yTranslation=Math.min(childState.yTranslation,bottomPosition);
    }
    if (row.isPinned()) {
      childState.yTranslation=Math.max(childState.yTranslation,mNotificationsTopPadding);
      childState.height=row.getHeadsUpHeight();
      if (!isTopEntry) {
        StackViewState topState=resultState.getViewStateForView(topHeadsUpEntry);
        childState.height=row.getHeadsUpHeight();
        childState.yTranslation=topState.yTranslation + topState.height - childState.height;
      }
    }
  }
}
