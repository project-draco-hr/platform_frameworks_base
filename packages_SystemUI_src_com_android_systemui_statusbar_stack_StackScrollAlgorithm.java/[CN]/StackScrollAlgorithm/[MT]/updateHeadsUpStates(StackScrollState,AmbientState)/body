{
  TreeSet<HeadsUpManager.HeadsUpEntry> headsUpEntries=ambientState.getSortedHeadsUpEntries();
  for (  HeadsUpManager.HeadsUpEntry entry : headsUpEntries) {
    ExpandableNotificationRow row=entry.entry.row;
    StackViewState childState=resultState.getViewStateForView(row);
    ExpandableNotificationRow topHeadsUpEntry=ambientState.getTopHeadsUpEntry();
    boolean isTopEntry=topHeadsUpEntry == row;
    if (!row.isInShade()) {
      childState.yTranslation=0;
      childState.height=row.getHeadsUpHeight();
      if (!isTopEntry) {
        StackViewState topState=resultState.getViewStateForView(topHeadsUpEntry);
        childState.height=row.getHeadsUpHeight();
        childState.yTranslation=topState.yTranslation + topState.height - childState.height;
      }
    }
 else     if (mIsExpanded) {
      if (isTopEntry) {
        childState.height+=row.getHeadsUpHeight() - mCollapsedSize;
      }
      childState.height=Math.max(childState.height,row.getHeadsUpHeight());
      float bottomPosition=ambientState.getMaxHeadsUpTranslation() - childState.height;
      childState.yTranslation=Math.min(childState.yTranslation,bottomPosition);
    }
  }
}
