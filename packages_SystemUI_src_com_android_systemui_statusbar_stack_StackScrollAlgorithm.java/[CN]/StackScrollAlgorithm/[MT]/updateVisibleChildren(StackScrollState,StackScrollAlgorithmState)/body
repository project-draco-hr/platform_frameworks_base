{
  ViewGroup hostView=resultState.getHostView();
  int childCount=hostView.getChildCount();
  state.visibleChildren.clear();
  state.visibleChildren.ensureCapacity(childCount);
  int notGoneIndex=0;
  for (int i=0; i < childCount; i++) {
    ExpandableView v=(ExpandableView)hostView.getChildAt(i);
    if (v.getVisibility() != View.GONE) {
      StackViewState viewState=resultState.getViewStateForView(v);
      viewState.notGoneIndex=notGoneIndex;
      state.visibleChildren.add(v);
      notGoneIndex++;
      if (v instanceof ExpandableNotificationRow) {
        ExpandableNotificationRow row=(ExpandableNotificationRow)v;
        List<ExpandableNotificationRow> children=row.getNotificationChildren();
        if (row.areChildrenExpanded() && children != null) {
          for (          ExpandableNotificationRow childRow : children) {
            if (childRow.getVisibility() != View.GONE) {
              StackViewState childState=resultState.getViewStateForView(childRow);
              childState.notGoneIndex=notGoneIndex;
              notGoneIndex++;
            }
          }
        }
      }
    }
  }
}
