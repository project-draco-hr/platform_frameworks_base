{
  boolean dismissAllInProgress=ambientState.isDismissAllInProgress();
  float drawStart=ambientState.getTopPadding() + ambientState.getStackTranslation();
  float previousNotificationEnd=0;
  float previousNotificationStart=0;
  boolean previousNotificationIsSwiped=false;
  int childCount=algorithmState.visibleChildren.size();
  for (int i=0; i < childCount; i++) {
    ExpandableView child=algorithmState.visibleChildren.get(i);
    StackViewState state=resultState.getViewStateForView(child);
    if (!child.mustStayOnScreen()) {
      previousNotificationEnd=Math.max(drawStart,previousNotificationEnd);
      previousNotificationStart=Math.max(drawStart,previousNotificationStart);
    }
    float newYTranslation=state.yTranslation;
    float newHeight=state.height;
    float newNotificationEnd=newYTranslation + newHeight;
    float clipHeight;
    if (previousNotificationIsSwiped) {
      clipHeight=newHeight;
    }
 else {
      clipHeight=newNotificationEnd - previousNotificationEnd;
      clipHeight=Math.max(0.0f,clipHeight);
    }
    updateChildClippingAndBackground(state,newHeight,clipHeight,newHeight - (previousNotificationStart - newYTranslation));
    if (dismissAllInProgress) {
      state.clipTopAmount=Math.max(child.getMinClipTopAmount(),state.clipTopAmount);
    }
    if (!child.isTransparent()) {
      if ((dismissAllInProgress && canChildBeDismissed(child))) {
        previousNotificationIsSwiped=true;
      }
 else {
        previousNotificationIsSwiped=ambientState.getDraggedViews().contains(child);
        previousNotificationEnd=newNotificationEnd;
        previousNotificationStart=newYTranslation + state.clipTopAmount;
      }
    }
  }
}
