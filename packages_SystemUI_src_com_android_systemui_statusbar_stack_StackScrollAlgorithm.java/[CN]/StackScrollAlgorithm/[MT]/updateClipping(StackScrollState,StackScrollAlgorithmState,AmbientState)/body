{
  boolean dismissAllInProgress=ambientState.isDismissAllInProgress();
  float previousNotificationEnd=0;
  float previousNotificationStart=0;
  boolean previousNotificationIsSwiped=false;
  int childCount=algorithmState.visibleChildren.size();
  for (int i=0; i < childCount; i++) {
    ExpandableView child=algorithmState.visibleChildren.get(i);
    StackViewState state=resultState.getViewStateForView(child);
    float newYTranslation=state.yTranslation + state.height * (1f - state.scale) / 2f;
    float newHeight=state.height * state.scale;
    float newNotificationEnd=newYTranslation + newHeight;
    float clipHeight;
    if (previousNotificationIsSwiped) {
      clipHeight=newHeight;
    }
 else {
      clipHeight=newNotificationEnd - previousNotificationEnd;
      clipHeight=Math.max(0.0f,clipHeight);
      if (clipHeight != 0.0f) {
        float clippingCorrection=state.dimmed ? 0 : mRoundedRectCornerRadius * state.scale;
        clipHeight+=clippingCorrection;
      }
    }
    updateChildClippingAndBackground(state,newHeight,clipHeight,newHeight - (previousNotificationStart - newYTranslation));
    if (dismissAllInProgress) {
      state.clipTopAmount=Math.max(child.getMinClipTopAmount(),state.clipTopAmount);
    }
    if (!child.isTransparent()) {
      if ((dismissAllInProgress && canChildBeDismissed(child))) {
        previousNotificationIsSwiped=true;
      }
 else {
        previousNotificationIsSwiped=ambientState.getDraggedViews().contains(child);
        previousNotificationEnd=newNotificationEnd;
        previousNotificationStart=newYTranslation + state.clipTopAmount * state.scale;
      }
    }
  }
}
