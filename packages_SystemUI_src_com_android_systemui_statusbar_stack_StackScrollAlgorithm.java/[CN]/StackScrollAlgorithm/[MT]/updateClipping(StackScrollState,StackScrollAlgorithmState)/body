{
  float previousNotificationEnd=0;
  float previousNotificationStart=0;
  boolean previousNotificationIsSwiped=false;
  int childCount=algorithmState.visibleChildren.size();
  for (int i=0; i < childCount; i++) {
    ExpandableView child=algorithmState.visibleChildren.get(i);
    StackScrollState.ViewState state=resultState.getViewStateForView(child);
    float newYTranslation=state.yTranslation + state.height * (1f - state.scale) / 2f;
    float newHeight=state.height * state.scale;
    float newNotificationEnd=newYTranslation + newHeight;
    float clippingCorrection=state.dimmed ? 0 : mRoundedRectCornerRadius * state.scale;
    float clipHeight=previousNotificationIsSwiped ? newHeight : newNotificationEnd - (previousNotificationEnd - clippingCorrection);
    updateChildClippingAndBackground(state,newHeight,clipHeight,newHeight - (previousNotificationStart - newYTranslation));
    if (!child.isTransparent()) {
      previousNotificationStart=newYTranslation + state.clipTopAmount * state.scale;
      previousNotificationEnd=newNotificationEnd;
      previousNotificationIsSwiped=child.getTranslationX() != 0;
    }
  }
}
