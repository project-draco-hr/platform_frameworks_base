{
  float previousNotificationEnd=0;
  float previousNotificationStart=0;
  boolean previousNotificationIsSwiped=false;
  int childCount=algorithmState.visibleChildren.size();
  for (int i=0; i < childCount; i++) {
    ExpandableView child=algorithmState.visibleChildren.get(i);
    StackScrollState.ViewState state=resultState.getViewStateForView(child);
    float newYTranslation=state.yTranslation;
    int newHeight=state.height;
    float newNotificationEnd=newYTranslation + newHeight;
    float clippingCorrection=state.dimmed ? 0 : mRoundedRectCornerRadius;
    float clipHeight=previousNotificationIsSwiped ? newHeight : newNotificationEnd - (previousNotificationEnd - clippingCorrection);
    updateChildClippingAndBackground(state,newHeight,clipHeight,(int)(newHeight - (previousNotificationStart - newYTranslation)));
    if (!child.isTransparent()) {
      previousNotificationStart=newYTranslation + child.getClipTopAmount();
      previousNotificationEnd=newNotificationEnd;
      previousNotificationIsSwiped=child.getTranslationX() != 0;
    }
  }
}
