{
  int childCount=algorithmState.visibleChildren.size();
  int childrenOnTop=0;
  for (int i=childCount - 1; i >= 0; i--) {
    ExpandableView child=algorithmState.visibleChildren.get(i);
    StackViewState childViewState=resultState.getViewStateForView(child);
    if (i > (childCount - 1 - algorithmState.itemsInBottomStack)) {
      float numItemsAbove=i - (childCount - 1 - algorithmState.itemsInBottomStack);
      childViewState.zTranslation=mZBasicHeight - numItemsAbove * mZDistanceBetweenElements;
    }
 else     if (child.mustStayOnScreen() && childViewState.yTranslation < ambientState.getTopPadding() + ambientState.getStackTranslation()) {
      childrenOnTop++;
      childViewState.zTranslation=mZBasicHeight + childrenOnTop * mZDistanceBetweenElements;
    }
 else {
      childViewState.zTranslation=mZBasicHeight;
    }
  }
}
