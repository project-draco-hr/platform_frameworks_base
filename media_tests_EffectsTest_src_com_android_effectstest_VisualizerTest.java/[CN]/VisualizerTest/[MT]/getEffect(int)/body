{
synchronized (sInstances) {
    if (sInstances.containsKey(session)) {
      mVisualizer=sInstances.get(session);
    }
 else {
      try {
        mVisualizer=new Visualizer(session);
      }
 catch (      UnsupportedOperationException e) {
        Log.e(TAG,"Visualizer library not loaded");
        throw (new RuntimeException("Cannot initialize effect"));
      }
catch (      RuntimeException e) {
        throw e;
      }
      sInstances.put(session,mVisualizer);
    }
  }
  mReleaseButton.setEnabled(false);
  mOnOffButton.setEnabled(false);
  if (mVisualizer != null) {
    mCaptureSize=mVisualizer.getCaptureSize();
    mReleaseButton.setChecked(true);
    mReleaseButton.setEnabled(true);
    mEnabled=mVisualizer.getEnabled();
    mOnOffButton.setChecked(mEnabled);
    mOnOffButton.setEnabled(true);
    mCallbackButton.setEnabled(!mEnabled);
  }
}
