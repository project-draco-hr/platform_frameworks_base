{
synchronized (mEnabledFunctions) {
    if (enabled) {
      if (!mEnabledFunctions.contains(function)) {
        mEnabledFunctions.add(function);
      }
      mDisabledFunctions.remove(function);
    }
 else {
      if (!mDisabledFunctions.contains(function)) {
        mDisabledFunctions.add(function);
      }
      mEnabledFunctions.remove(function);
    }
  }
  if (enabled && UsbManager.USB_FUNCTION_ACCESSORY.equals(function)) {
    String[] strings=nativeGetAccessoryStrings();
    if (strings != null) {
      Log.d(TAG,"entering USB accessory mode");
      mCurrentAccessory=new UsbAccessory(strings);
      Intent intent=new Intent(UsbManager.ACTION_USB_ACCESSORY_ATTACHED);
      intent.putExtra(UsbManager.EXTRA_ACCESSORY,mCurrentAccessory);
      if (strings[0] != null) {
        intent.putExtra(UsbManager.EXTRA_ACCESSORY_MANUFACTURER,strings[0]);
      }
      if (strings[1] != null) {
        intent.putExtra(UsbManager.EXTRA_ACCESSORY_PRODUCT,strings[1]);
      }
      if (strings[2] != null) {
        intent.putExtra(UsbManager.EXTRA_ACCESSORY_TYPE,strings[2]);
      }
      if (strings[3] != null) {
        intent.putExtra(UsbManager.EXTRA_ACCESSORY_VERSION,strings[3]);
      }
      mContext.sendBroadcast(intent);
    }
 else {
      Log.e(TAG,"nativeGetAccessoryStrings failed");
    }
  }
}
