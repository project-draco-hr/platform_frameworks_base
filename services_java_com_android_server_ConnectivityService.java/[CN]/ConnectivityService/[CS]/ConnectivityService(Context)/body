{
  if (DBG)   Log.v(TAG,"ConnectivityService starting up");
  mContext=context;
  mNetTrackers=new NetworkStateTracker[2];
  Handler handler=new MyHandler();
  mNetworkPreference=getPersistedNetworkPreference();
  if (DBG)   Log.v(TAG,"Starting Wifi Service.");
  mWifiStateTracker=new WifiStateTracker(context,handler);
  WifiService wifiService=new WifiService(context,mWifiStateTracker);
  ServiceManager.addService(Context.WIFI_SERVICE,wifiService);
  mNetTrackers[ConnectivityManager.TYPE_WIFI]=mWifiStateTracker;
  mMobileDataStateTracker=new MobileDataStateTracker(context,handler);
  mNetTrackers[ConnectivityManager.TYPE_MOBILE]=mMobileDataStateTracker;
  mActiveNetwork=null;
  mNumDnsEntries=0;
  mTestMode=SystemProperties.get("cm.test.mode").equals("true") && SystemProperties.get("ro.build.type").equals("eng");
  for (  NetworkStateTracker t : mNetTrackers)   t.startMonitoring();
  mWifiWatchdogService=new WifiWatchdogService(context,mWifiStateTracker);
}
