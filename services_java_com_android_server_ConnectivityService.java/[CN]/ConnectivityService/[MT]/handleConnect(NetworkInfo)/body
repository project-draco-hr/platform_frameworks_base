{
  final int newNetType=info.getType();
  setupDataActivityTracking(newNetType);
  boolean isFailover=info.isFailover();
  final NetworkStateTracker thisNet=mNetTrackers[newNetType];
  final String thisIface=thisNet.getLinkProperties().getInterfaceName();
  if (mNetConfigs[newNetType].isDefault()) {
    if (mActiveDefaultNetwork != -1 && mActiveDefaultNetwork != newNetType) {
      if (isNewNetTypePreferredOverCurrentNetType(newNetType)) {
        NetworkStateTracker otherNet=mNetTrackers[mActiveDefaultNetwork];
        if (DBG) {
          log("Policy requires " + otherNet.getNetworkInfo().getTypeName() + " teardown");
        }
        if (!teardown(otherNet)) {
          loge("Network declined teardown request");
          teardown(thisNet);
          return;
        }
      }
 else {
        if (VDBG) {
          log("Not broadcasting CONNECT_ACTION " + "to torn down network " + info.getTypeName());
        }
        teardown(thisNet);
        return;
      }
    }
synchronized (ConnectivityService.this) {
      if (mNetTransitionWakeLock.isHeld()) {
        mHandler.sendMessageDelayed(mHandler.obtainMessage(EVENT_CLEAR_NET_TRANSITION_WAKELOCK,mNetTransitionWakeLockSerialNumber,0),1000);
      }
    }
    mActiveDefaultNetwork=newNetType;
    mDefaultInetConditionPublished=0;
    mDefaultConnectionSequence++;
    mInetConditionChangeInFlight=false;
  }
  thisNet.setTeardownRequested(false);
  updateNetworkSettings(thisNet);
  handleConnectivityChange(newNetType,false);
  sendConnectedBroadcastDelayed(info,getConnectivityChangeDelay());
  if (thisIface != null) {
    try {
      BatteryStatsService.getService().noteNetworkInterfaceType(thisIface,newNetType);
    }
 catch (    RemoteException e) {
    }
  }
}
