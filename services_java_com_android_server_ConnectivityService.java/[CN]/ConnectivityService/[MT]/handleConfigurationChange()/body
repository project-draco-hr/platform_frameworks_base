{
  int index=1;
  String lastDns="";
  int numConnectedNets=0;
  int incrValue=ConnectivityManager.TYPE_MOBILE - ConnectivityManager.TYPE_WIFI;
  int stopValue=ConnectivityManager.TYPE_MOBILE + incrValue;
  for (int net=ConnectivityManager.TYPE_WIFI; net != stopValue; net+=incrValue) {
    NetworkStateTracker nt=mNetTrackers[net];
    if (nt.getNetworkInfo().isConnected() && !mTeardownRequested[nt.getNetworkInfo().getType()]) {
      ++numConnectedNets;
      String[] dnsList=nt.getNameServers();
      for (int i=0; i < dnsList.length && dnsList[i] != null; i++) {
        if (!dnsList[i].equals(lastDns)) {
          SystemProperties.set("net.dns" + index++,dnsList[i]);
          lastDns=dnsList[i];
        }
      }
    }
  }
  for (int i=index; i <= mNumDnsEntries; i++) {
    SystemProperties.set("net.dns" + i,"");
  }
  mNumDnsEntries=index - 1;
  SystemProperties.set("net.dnschange",String.valueOf(mDnsChangeCounter++));
  return numConnectedNets;
}
