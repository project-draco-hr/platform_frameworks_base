{
  if ((ifaceName == null) || (lp == null) || (r == null)) {
    if (DBG)     log("modifyRoute got unexpected null: " + ifaceName + ", "+ lp+ ", "+ r);
    return false;
  }
  if (cycleCount > MAX_HOSTROUTE_CYCLE_COUNT) {
    loge("Error modifying route - too much recursion");
    return false;
  }
  if (r.isHostRoute() == false) {
    RouteInfo bestRoute=RouteInfo.selectBestRoute(lp.getRoutes(),r.getGateway());
    if (bestRoute != null) {
      if (bestRoute.getGateway().equals(r.getGateway())) {
        bestRoute=RouteInfo.makeHostRoute(r.getGateway());
      }
 else {
        bestRoute=RouteInfo.makeHostRoute(r.getGateway(),bestRoute.getGateway());
      }
      modifyRoute(ifaceName,lp,bestRoute,cycleCount + 1,doAdd,toDefaultTable);
    }
  }
  if (doAdd) {
    if (VDBG)     log("Adding " + r + " for interface "+ ifaceName);
    try {
      if (toDefaultTable) {
        mAddedRoutes.add(r);
        mNetd.addRoute(ifaceName,r);
      }
 else {
        mNetd.addSecondaryRoute(ifaceName,r);
      }
    }
 catch (    Exception e) {
      if (DBG)       loge("Exception trying to add a route: " + e);
      return false;
    }
  }
 else {
    if (toDefaultTable) {
      mAddedRoutes.remove(r);
      if (mAddedRoutes.contains(r) == false) {
        if (VDBG)         log("Removing " + r + " for interface "+ ifaceName);
        try {
          mNetd.removeRoute(ifaceName,r);
        }
 catch (        Exception e) {
          if (VDBG)           loge("Exception trying to remove a route: " + e);
          return false;
        }
      }
 else {
        if (VDBG)         log("not removing " + r + " as it's still in use");
      }
    }
 else {
      if (VDBG)       log("Removing " + r + " for interface "+ ifaceName);
      try {
        mNetd.removeSecondaryRoute(ifaceName,r);
      }
 catch (      Exception e) {
        if (VDBG)         loge("Exception trying to remove a route: " + e);
        return false;
      }
    }
  }
  return true;
}
