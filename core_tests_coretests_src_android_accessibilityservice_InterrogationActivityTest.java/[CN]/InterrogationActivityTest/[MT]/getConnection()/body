{
  if (sConnection == null) {
    IEventListener listener=new IEventListener.Stub(){
      public void setConnection(      IAccessibilityServiceConnection connection){
      }
      public void onInterrupt(){
      }
      public void onAccessibilityEvent(      AccessibilityEvent event){
        if (event.getEventType() == AccessibilityEvent.TYPE_VIEW_FOCUSED) {
          sLastFocusAccessibilityEvent=AccessibilityEvent.obtain(event);
        }
synchronized (sConnection) {
          sConnection.notifyAll();
        }
      }
    }
;
    AccessibilityManager accessibilityManager=AccessibilityManager.getInstance(getInstrumentation().getContext());
synchronized (this) {
      if (!accessibilityManager.isEnabled()) {
        accessibilityManager.addAccessibilityStateChangeListener(new AccessibilityManager.AccessibilityStateChangeListener(){
          public void onAccessibilityStateChanged(          boolean enabled){
synchronized (this) {
              notifyAll();
            }
          }
        }
);
        IAccessibilityManager manager=IAccessibilityManager.Stub.asInterface(ServiceManager.getService(Context.ACCESSIBILITY_SERVICE));
        sConnection=manager.registerEventListener(listener);
        wait(TIMEOUT_PROPAGATE_ACCESSIBLITY_SETTING);
      }
 else {
        IAccessibilityManager manager=IAccessibilityManager.Stub.asInterface(ServiceManager.getService(Context.ACCESSIBILITY_SERVICE));
        sConnection=manager.registerEventListener(listener);
      }
    }
  }
  return sConnection;
}
