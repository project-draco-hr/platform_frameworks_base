{
  Context context=getInstrumentation().getContext();
  AccessibilityManager accessibilityManager=AccessibilityManager.getInstance(context);
  if (accessibilityManager.isEnabled() == state) {
    return;
  }
synchronized (this) {
    final boolean currentState=Settings.Secure.getInt(context.getContentResolver(),Settings.Secure.ACCESSIBILITY_ENABLED) == 1;
    if (currentState != state) {
      accessibilityManager.addAccessibilityStateChangeListener(new AccessibilityManager.AccessibilityStateChangeListener(){
        public void onAccessibilityStateChanged(        boolean enabled){
synchronized (this) {
            notifyAll();
          }
        }
      }
);
      Settings.Secure.putInt(context.getContentResolver(),Settings.Secure.ACCESSIBILITY_ENABLED,state ? 1 : 0);
    }
    try {
      wait(TIMEOUT_PROPAGATE_ACCESSIBLITY_SETTING);
    }
 catch (    InterruptedException ie) {
    }
  }
  if (accessibilityManager.isEnabled() != state) {
    throw new IllegalStateException("Could not set accessibility state to: " + state);
  }
}
