{
  final String action=intent.getAction();
  if (action.equals(Intent.ACTION_SCREEN_ON) || action.equals(Intent.ACTION_DREAMING_STOPPED)) {
    if (mIdle) {
      if (DEBUG) {
        Slog.v(TAG,"exiting idle : " + action);
      }
      mAlarm.cancel(mIdleTriggerIntent);
      mIdle=false;
      reportNewIdleState(mIdle);
    }
  }
 else   if (action.equals(Intent.ACTION_SCREEN_OFF) || action.equals(Intent.ACTION_DREAMING_STARTED)) {
    final long nowElapsed=SystemClock.elapsedRealtime();
    final long when=nowElapsed + INACTIVITY_IDLE_THRESHOLD;
    if (DEBUG) {
      Slog.v(TAG,"Scheduling idle : " + action + " now:"+ nowElapsed+ " when="+ when);
    }
    mAlarm.setWindow(AlarmManager.ELAPSED_REALTIME_WAKEUP,when,IDLE_WINDOW_SLOP,mIdleTriggerIntent);
  }
 else   if (action.equals(ACTION_TRIGGER_IDLE)) {
    if (!mIdle) {
      if (DEBUG) {
        Slog.v(TAG,"Idle trigger fired @ " + SystemClock.elapsedRealtime());
      }
      mIdle=true;
      reportNewIdleState(mIdle);
    }
  }
}
