{
  final String action=intent.getAction();
  if (action.equals(Intent.ACTION_SCREEN_ON) || action.equals(Intent.ACTION_DREAMING_STOPPED)) {
    if (DEBUG) {
      Slog.v(TAG,"exiting idle : " + action);
    }
    mScreenOn=true;
    mAlarm.cancel(mIdleTriggerIntent);
    if (mIdle) {
      mIdle=false;
      reportNewIdleState(mIdle);
    }
  }
 else   if (action.equals(Intent.ACTION_SCREEN_OFF) || action.equals(Intent.ACTION_DREAMING_STARTED)) {
    final long nowElapsed=SystemClock.elapsedRealtime();
    final long when=nowElapsed + mInactivityIdleThreshold;
    if (DEBUG) {
      Slog.v(TAG,"Scheduling idle : " + action + " now:"+ nowElapsed+ " when="+ when);
    }
    mScreenOn=false;
    mAlarm.setWindow(AlarmManager.ELAPSED_REALTIME_WAKEUP,when,mIdleWindowSlop,mIdleTriggerIntent);
  }
 else   if (action.equals(ActivityManagerService.ACTION_TRIGGER_IDLE)) {
    if (!mIdle && !mScreenOn) {
      if (DEBUG) {
        Slog.v(TAG,"Idle trigger fired @ " + SystemClock.elapsedRealtime());
      }
      mIdle=true;
      reportNewIdleState(mIdle);
    }
  }
}
