{
  if (DBG)   Log.d(TAG,"testStateMachineSharedThread E");
  HandlerThread smThread=new HandlerThread("testStateMachineSharedThread");
  smThread.start();
  StateMachineSharedThread sms[]=new StateMachineSharedThread[10];
  for (int i=0; i < sms.length; i++) {
    sms[i]=new StateMachineSharedThread("sm",smThread.getLooper(),sms.length);
    sms[i].start();
  }
synchronized (waitObject) {
    for (    StateMachineSharedThread sm : sms) {
      for (int i=1; i <= 4; i++) {
        sm.sendMessage(i);
      }
    }
    try {
      waitObject.wait();
    }
 catch (    InterruptedException e) {
      Log.e(TAG,"testStateMachineSharedThread: exception while waiting " + e.getMessage());
    }
  }
  for (  StateMachineSharedThread sm : sms) {
    assertTrue(sm.getProcessedMessagesCount() == 4);
    for (int i=0; i < sm.getProcessedMessagesCount(); i++) {
      ProcessedMessageInfo pmi=sm.getProcessedMessageInfo(i);
      assertEquals(i + 1,pmi.getWhat());
      assertEquals(sm.mS1,pmi.getState());
      assertEquals(sm.mS1,pmi.getOriginalState());
    }
  }
  if (DBG)   Log.d(TAG,"testStateMachineSharedThread X");
}
