{
  if (!checkin) {
    pw.print("  ");
    TimeUtils.formatDuration(rec.time - now,pw,TimeUtils.HUNDRED_DAY_FIELD_LEN);
    pw.print(" ");
  }
 else {
    if (lastTime < 0) {
      pw.print("@");
      pw.print(rec.time - now);
    }
 else {
      pw.print(rec.time - lastTime);
    }
    lastTime=rec.time;
  }
  if (rec.cmd == HistoryItem.CMD_START) {
    if (checkin) {
      pw.print(":");
    }
    pw.println("START");
  }
 else   if (rec.cmd == HistoryItem.CMD_OVERFLOW) {
    if (checkin) {
      pw.print(":");
    }
    pw.println("*OVERFLOW*");
  }
 else {
    if (!checkin) {
      if (rec.batteryLevel < 10)       pw.print("00");
 else       if (rec.batteryLevel < 100)       pw.print("0");
      pw.print(rec.batteryLevel);
      pw.print(" ");
      if (rec.states < 0x10)       pw.print("0000000");
 else       if (rec.states < 0x100)       pw.print("000000");
 else       if (rec.states < 0x1000)       pw.print("00000");
 else       if (rec.states < 0x10000)       pw.print("0000");
 else       if (rec.states < 0x100000)       pw.print("000");
 else       if (rec.states < 0x1000000)       pw.print("00");
 else       if (rec.states < 0x10000000)       pw.print("0");
      pw.print(Integer.toHexString(rec.states));
    }
 else {
      if (oldLevel != rec.batteryLevel) {
        oldLevel=rec.batteryLevel;
        pw.print(",Bl=");
        pw.print(rec.batteryLevel);
      }
    }
    if (oldStatus != rec.batteryStatus) {
      oldStatus=rec.batteryStatus;
      pw.print(checkin ? ",Bs=" : " status=");
switch (oldStatus) {
case BatteryManager.BATTERY_STATUS_UNKNOWN:
        pw.print(checkin ? "?" : "unknown");
      break;
case BatteryManager.BATTERY_STATUS_CHARGING:
    pw.print(checkin ? "c" : "charging");
  break;
case BatteryManager.BATTERY_STATUS_DISCHARGING:
pw.print(checkin ? "d" : "discharging");
break;
case BatteryManager.BATTERY_STATUS_NOT_CHARGING:
pw.print(checkin ? "n" : "not-charging");
break;
case BatteryManager.BATTERY_STATUS_FULL:
pw.print(checkin ? "f" : "full");
break;
default :
pw.print(oldStatus);
break;
}
}
if (oldHealth != rec.batteryHealth) {
oldHealth=rec.batteryHealth;
pw.print(checkin ? ",Bh=" : " health=");
switch (oldHealth) {
case BatteryManager.BATTERY_HEALTH_UNKNOWN:
pw.print(checkin ? "?" : "unknown");
break;
case BatteryManager.BATTERY_HEALTH_GOOD:
pw.print(checkin ? "g" : "good");
break;
case BatteryManager.BATTERY_HEALTH_OVERHEAT:
pw.print(checkin ? "h" : "overheat");
break;
case BatteryManager.BATTERY_HEALTH_DEAD:
pw.print(checkin ? "d" : "dead");
break;
case BatteryManager.BATTERY_HEALTH_OVER_VOLTAGE:
pw.print(checkin ? "v" : "over-voltage");
break;
case BatteryManager.BATTERY_HEALTH_UNSPECIFIED_FAILURE:
pw.print(checkin ? "f" : "failure");
break;
default :
pw.print(oldHealth);
break;
}
}
if (oldPlug != rec.batteryPlugType) {
oldPlug=rec.batteryPlugType;
pw.print(checkin ? ",Bp=" : " plug=");
switch (oldPlug) {
case 0:
pw.print(checkin ? "n" : "none");
break;
case BatteryManager.BATTERY_PLUGGED_AC:
pw.print(checkin ? "a" : "ac");
break;
case BatteryManager.BATTERY_PLUGGED_USB:
pw.print(checkin ? "u" : "usb");
break;
case BatteryManager.BATTERY_PLUGGED_WIRELESS:
pw.print(checkin ? "w" : "wireless");
break;
default :
pw.print(oldPlug);
break;
}
}
if (oldTemp != rec.batteryTemperature) {
oldTemp=rec.batteryTemperature;
pw.print(checkin ? ",Bt=" : " temp=");
pw.print(oldTemp);
}
if (oldVolt != rec.batteryVoltage) {
oldVolt=rec.batteryVoltage;
pw.print(checkin ? ",Bv=" : " volt=");
pw.print(oldVolt);
}
printBitDescriptions(pw,oldState,rec.states,HISTORY_STATE_DESCRIPTIONS,!checkin);
if (rec.eventCode != HistoryItem.EVENT_NONE) {
switch (rec.eventCode) {
case HistoryItem.EVENT_PROC_STARTED:
pw.print(checkin ? ",PrSt=" : " procstart=");
break;
case HistoryItem.EVENT_PROC_FINISHED:
pw.print(checkin ? ",PrFn=" : " procfin=");
break;
default :
if (checkin) {
pw.print(",?cmd_");
pw.print(rec.eventCode);
pw.print("=");
}
 else {
pw.print(" cmd_");
pw.print(rec.eventCode);
pw.print("=");
}
break;
}
if (checkin) {
pw.print(rec.eventUid);
}
 else {
UserHandle.formatUid(pw,rec.eventUid);
}
pw.print(":");
if (checkin) {
pw.print(rec.eventNameIdx);
}
 else {
pw.print(rec.eventName);
}
}
pw.println();
}
oldState=rec.states;
}
