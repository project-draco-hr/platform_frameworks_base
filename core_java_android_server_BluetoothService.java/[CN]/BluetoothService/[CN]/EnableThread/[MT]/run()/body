{
  boolean res=(enableNative() == 0);
  if (res) {
    int retryCount=2;
    boolean running=false;
    while ((retryCount-- > 0) && !running) {
      mEventLoop.start();
      int pollCount=5;
      while ((pollCount-- > 0) && !running) {
        if (mEventLoop.isEventLoopRunning()) {
          running=true;
          break;
        }
        try {
          Thread.sleep(100);
        }
 catch (        InterruptedException e) {
        }
      }
    }
    if (!running) {
      log("bt EnableThread giving up");
      res=false;
      disableNative();
    }
  }
  if (res) {
    if (!setupNativeDataNative()) {
      return;
    }
    if (mSaveSetting) {
      persistBluetoothOnSetting(true);
    }
    mIsDiscovering=false;
    mBondState.readAutoPairingData();
    mBondState.loadBondState();
    initProfileState();
    if (mContext.getResources().getBoolean(com.android.internal.R.bool.config_voice_capable)) {
      mHandler.sendMessageDelayed(mHandler.obtainMessage(MESSAGE_REGISTER_SDP_RECORDS,1,-1),3000);
    }
 else {
      mHandler.sendMessageDelayed(mHandler.obtainMessage(MESSAGE_REGISTER_SDP_RECORDS,4,-1),3000);
    }
    setBluetoothTetheringNative(true,BluetoothPan.NAP_ROLE,BluetoothPan.NAP_BRIDGE);
    long ident=Binder.clearCallingIdentity();
    try {
      mBatteryStats.noteBluetoothOn();
    }
 catch (    RemoteException e) {
    }
 finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
  mEnableThread=null;
  setBluetoothState(res ? BluetoothAdapter.STATE_ON : BluetoothAdapter.STATE_OFF);
  if (res) {
    String[] propVal={"Pairable",getProperty("Pairable")};
    mEventLoop.onPropertyChanged(propVal);
  }
  if (mIsAirplaneSensitive && isAirplaneModeOn() && !mIsAirplaneToggleable) {
    disable(false);
  }
}
