{
  if (updateCountersAndCheckForConnectionStateChange(device,state,prevState)) {
    state=getAdapterConnectionState(state);
    prevState=getAdapterConnectionState(prevState);
    Intent intent=new Intent(BluetoothAdapter.ACTION_CONNECTION_STATE_CHANGED);
    intent.putExtra(BluetoothDevice.EXTRA_DEVICE,device);
    intent.putExtra(BluetoothAdapter.EXTRA_CONNECTION_STATE,state);
    intent.putExtra(BluetoothAdapter.EXTRA_PREVIOUS_CONNECTION_STATE,prevState);
    mContext.sendBroadcast(intent,BLUETOOTH_PERM);
    log("CONNECTION_STATE_CHANGE: " + device + ": "+ prevState+ "-> "+ state);
  }
}
