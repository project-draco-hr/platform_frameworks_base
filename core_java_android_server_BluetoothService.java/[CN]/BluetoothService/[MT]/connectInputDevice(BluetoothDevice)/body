{
  mContext.enforceCallingOrSelfPermission(BLUETOOTH_ADMIN_PERM,"Need BLUETOOTH_ADMIN permission");
  String objectPath=getObjectPathFromAddress(device.getAddress());
  if (objectPath == null || getInputDeviceState(device) != BluetoothInputDevice.STATE_DISCONNECTED || getInputDevicePriority(device) == BluetoothInputDevice.PRIORITY_OFF) {
    return false;
  }
  BluetoothClass btClass=new BluetoothClass(getRemoteClass(device.getAddress()));
  int btDeviceClass=btClass.getDeviceClass();
  if (btDeviceClass != BluetoothClass.Device.PERIPHERAL_KEYBOARD && btDeviceClass != BluetoothClass.Device.PERIPHERAL_KEYBOARD_POINTING) {
    log("Input device btDeviceClass: " + btDeviceClass + " Not a keyboard");
    return false;
  }
  BluetoothDeviceProfileState state=mDeviceProfileState.get(device.getAddress());
  if (state != null) {
    Message msg=new Message();
    msg.arg1=BluetoothDeviceProfileState.CONNECT_HID_OUTGOING;
    msg.obj=state;
    mHidProfileState.sendMessage(msg);
    return true;
  }
  return false;
}
