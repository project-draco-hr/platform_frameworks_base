{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.WRITE_SECURE_SETTINGS,"Need WRITE_SECURE_SETTINGS permission");
  boolean pairable=false;
  boolean discoverable=false;
switch (mode) {
case BluetoothAdapter.SCAN_MODE_NONE:
    mHandler.removeMessages(MESSAGE_DISCOVERABLE_TIMEOUT);
  pairable=false;
discoverable=false;
break;
case BluetoothAdapter.SCAN_MODE_CONNECTABLE:
mHandler.removeMessages(MESSAGE_DISCOVERABLE_TIMEOUT);
pairable=true;
discoverable=false;
break;
case BluetoothAdapter.SCAN_MODE_CONNECTABLE_DISCOVERABLE:
mHandler.removeMessages(MESSAGE_DISCOVERABLE_TIMEOUT);
pairable=true;
discoverable=true;
Message msg=mHandler.obtainMessage(MESSAGE_DISCOVERABLE_TIMEOUT);
mHandler.sendMessageDelayed(msg,duration * 1000);
if (DBG) Log.d(TAG,"BT Discoverable for " + duration + " seconds");
break;
default :
Log.w(TAG,"Requested invalid scan mode " + mode);
return false;
}
setPropertyBoolean("Pairable",pairable);
setPropertyBoolean("Discoverable",discoverable);
return true;
}
