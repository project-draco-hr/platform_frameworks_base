{
  if (mBluetoothState != BluetoothAdapter.STATE_TURNING_OFF) {
    return;
  }
  mEventLoop.stop();
  tearDownNativeDataNative();
  disableNative();
  for (  String address : mBondState.listInState(BluetoothDevice.BOND_BONDING)) {
    mBondState.setBondState(address,BluetoothDevice.BOND_NONE,BluetoothDevice.UNBOND_REASON_AUTH_CANCELED);
  }
  for (  String address : mBondState.listInState(BluetoothDevice.BOND_BONDED)) {
    removeProfileState(address);
  }
  Intent intent=new Intent(BluetoothAdapter.ACTION_SCAN_MODE_CHANGED);
  intent.putExtra(BluetoothAdapter.EXTRA_SCAN_MODE,BluetoothAdapter.SCAN_MODE_NONE);
  mContext.sendBroadcast(intent,BLUETOOTH_PERM);
  mIsDiscovering=false;
  mAdapterProperties.clear();
  mServiceRecordToPid.clear();
  mProfilesConnected=0;
  mProfilesConnecting=0;
  mProfilesDisconnecting=0;
  mAdapterConnectionState=BluetoothAdapter.STATE_DISCONNECTED;
  if (saveSetting) {
    persistBluetoothOnSetting(false);
  }
  setBluetoothState(BluetoothAdapter.STATE_OFF);
  long ident=Binder.clearCallingIdentity();
  try {
    mBatteryStats.noteBluetoothOff();
  }
 catch (  RemoteException e) {
  }
 finally {
    Binder.restoreCallingIdentity(ident);
  }
  if (mRestart) {
    mRestart=false;
    enable();
  }
}
