{
  final int callingUserId=UserHandle.getCallingUserId();
  final boolean accessAll=(mContext.checkPermission(android.Manifest.permission.ACCESS_ALL_EXTERNAL_STORAGE,Binder.getCallingPid(),Binder.getCallingUid()) == PERMISSION_GRANTED);
synchronized (mVolumesLock) {
    final ArrayList<StorageVolume> filtered=Lists.newArrayList();
    for (    StorageVolume volume : mVolumes) {
      final UserHandle owner=volume.getOwner();
      final boolean ownerMatch=owner == null || owner.getIdentifier() == callingUserId;
      if (accessAll || ownerMatch) {
        filtered.add(volume);
      }
    }
    return filtered.toArray(new StorageVolume[filtered.size()]);
  }
}
