{
  mCallbacks.notifyVolumeStateChanged(vol.clone(),oldState,newState);
  final String oldStateEnv=VolumeInfo.getEnvironmentForState(oldState);
  final String newStateEnv=VolumeInfo.getEnvironmentForState(newState);
  if (!Objects.equals(oldStateEnv,newStateEnv)) {
    for (    int userId : mStartedUsers) {
      if (vol.isVisibleToUser(userId)) {
        final StorageVolume userVol=vol.buildStorageVolume(mContext,userId);
        mHandler.obtainMessage(H_VOLUME_BROADCAST,userVol).sendToTarget();
        mCallbacks.notifyStorageStateChanged(userVol.getPath(),oldStateEnv,newStateEnv);
      }
    }
  }
  if (vol.type == VolumeInfo.TYPE_PUBLIC && vol.state == VolumeInfo.STATE_UNMOUNTING) {
    mObbActionHandler.sendMessage(mObbActionHandler.obtainMessage(OBB_FLUSH_MOUNT_STATE,vol.path));
  }
}
