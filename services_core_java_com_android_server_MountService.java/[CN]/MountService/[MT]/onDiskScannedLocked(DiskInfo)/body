{
  int volumeCount=0;
  for (int i=0; i < mVolumes.size(); i++) {
    final VolumeInfo vol=mVolumes.valueAt(i);
    if (Objects.equals(disk.id,vol.getDiskId())) {
      volumeCount++;
    }
  }
  final Intent intent=new Intent(DiskInfo.ACTION_DISK_SCANNED);
  intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT | Intent.FLAG_RECEIVER_INCLUDE_BACKGROUND);
  intent.putExtra(DiskInfo.EXTRA_DISK_ID,disk.id);
  intent.putExtra(DiskInfo.EXTRA_VOLUME_COUNT,volumeCount);
  mHandler.obtainMessage(H_INTERNAL_BROADCAST,intent).sendToTarget();
  final CountDownLatch latch=mDiskScanLatches.remove(disk.id);
  if (latch != null) {
    latch.countDown();
  }
  disk.volumeCount=volumeCount;
  mCallbacks.notifyDiskScanned(disk,volumeCount);
}
