{
  Slog.d(TAG,"Thinking about reset, mSystemReady=" + mSystemReady + ", mDaemonConnected="+ mDaemonConnected);
  if (mSystemReady && mDaemonConnected) {
    killMediaProvider();
    mDisks.clear();
    mVolumes.clear();
    final VolumeInfo internal=new VolumeInfo(VolumeInfo.ID_PRIVATE_INTERNAL,VolumeInfo.TYPE_PRIVATE,null,null);
    internal.state=VolumeInfo.STATE_MOUNTED;
    internal.path=Environment.getDataDirectory().getAbsolutePath();
    mVolumes.put(internal.id,internal);
    try {
      mConnector.execute("volume","reset");
      final UserManager um=mContext.getSystemService(UserManager.class);
      final List<UserInfo> users=um.getUsers();
      for (      UserInfo user : users) {
        mConnector.execute("volume","user_added",user.id,user.serialNumber);
      }
      for (      int userId : mStartedUsers) {
        mConnector.execute("volume","user_started",userId);
      }
    }
 catch (    NativeDaemonConnectorException e) {
      Slog.w(TAG,"Failed to reset vold",e);
    }
  }
}
