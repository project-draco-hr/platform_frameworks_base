{
  for (  int userId : mStartedUsers) {
    if (vol.isVisibleToUser(userId)) {
      final StorageVolume userVol=vol.buildVolumeForUser(userId);
      mHandler.obtainMessage(H_VOLUME_BROADCAST,userVol).sendToTarget();
    }
  }
  if (vol.isPrimary() && vol.type == Volume.TYPE_PUBLIC) {
    if (vol.state == Volume.STATE_MOUNTED) {
      mPms.updateExternalMediaStatus(true,false);
    }
 else     if (vol.state == Volume.STATE_UNMOUNTING) {
      mPms.updateExternalMediaStatus(false,false);
      mObbActionHandler.sendMessage(mObbActionHandler.obtainMessage(OBB_FLUSH_MOUNT_STATE,vol.path));
    }
  }
  final String oldEnvState=sStateToEnvironment.get(oldState);
  final String newEnvState=sStateToEnvironment.get(newState);
synchronized (mListeners) {
    for (int i=mListeners.size() - 1; i >= 0; i--) {
      MountServiceBinderListener bl=mListeners.get(i);
      try {
        bl.mListener.onStorageStateChanged(vol.path,oldEnvState,newEnvState);
      }
 catch (      RemoteException rex) {
        Slog.e(TAG,"Listener dead");
        mListeners.remove(i);
      }
catch (      Exception ex) {
        Slog.e(TAG,"Listener failed",ex);
      }
    }
  }
}
