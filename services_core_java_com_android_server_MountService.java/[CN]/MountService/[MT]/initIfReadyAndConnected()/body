{
  Slog.d(TAG,"Thinking about init, mSystemReady=" + mSystemReady + ", mDaemonConnected="+ mDaemonConnected);
  if (mSystemReady && mDaemonConnected && !StorageManager.isNativeFileBasedEncryptionEnabled()) {
    final boolean initLocked=StorageManager.isEmulatedFileBasedEncryptionEnabled();
    Slog.d(TAG,"Setting up emulation state, initlocked=" + initLocked);
    final List<UserInfo> users=mContext.getSystemService(UserManager.class).getUsers();
    for (    UserInfo user : users) {
      try {
        if (initLocked) {
          mCryptConnector.execute("cryptfs","lock_user_key",user.id);
        }
 else {
          mCryptConnector.execute("cryptfs","unlock_user_key",user.id,user.serialNumber,"!","!");
        }
      }
 catch (      NativeDaemonConnectorException e) {
        Slog.w(TAG,"Failed to init vold",e);
      }
    }
  }
}
