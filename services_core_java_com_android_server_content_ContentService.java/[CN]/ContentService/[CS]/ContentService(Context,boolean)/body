{
  mContext=context;
  mFactoryTest=factoryTest;
  PackageManagerInternal packageManagerInternal=LocalServices.getService(PackageManagerInternal.class);
  packageManagerInternal.setSyncAdapterPackagesprovider(new PackageManagerInternal.SyncAdapterPackagesProvider(){
    @Override public String[] getPackages(    String authority,    int userId){
      return getSyncAdapterPackagesForAuthorityAsUser(authority,userId);
    }
  }
);
  final IntentFilter packageFilter=new IntentFilter();
  packageFilter.addAction(Intent.ACTION_PACKAGE_ADDED);
  packageFilter.addAction(Intent.ACTION_PACKAGE_CHANGED);
  packageFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  packageFilter.addAction(Intent.ACTION_PACKAGE_DATA_CLEARED);
  packageFilter.addDataScheme("package");
  mContext.registerReceiverAsUser(mCacheReceiver,UserHandle.ALL,packageFilter,null,null);
  final IntentFilter localeFilter=new IntentFilter();
  localeFilter.addAction(Intent.ACTION_LOCALE_CHANGED);
  mContext.registerReceiverAsUser(mCacheReceiver,UserHandle.ALL,localeFilter,null,null);
}
