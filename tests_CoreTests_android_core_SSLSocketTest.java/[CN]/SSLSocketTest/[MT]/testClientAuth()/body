{
  try {
    TestServer server=new TestServer(8088,true,TestServer.CLIENT_AUTH_WANTED);
    TestClient client=new TestClient(8088,true);
    Thread serverThread=new Thread(server);
    Thread clientThread=new Thread(client);
    serverThread.start();
    clientThread.start();
    serverThread.join();
    clientThread.join();
    if (server.getException() != null) {
      throw new RuntimeException(server.getException());
    }
    if (client.getException() != null) {
      throw new RuntimeException(client.getException());
    }
    X509Certificate[] clientChain=client.getChain();
    assertTrue("Client cert chain must not be null",clientChain != null);
    assertTrue("Client cert chain must not be empty",clientChain.length != 0);
    assertEquals("CN=Test Server, OU=Android, O=Google, L=MTV, ST=California, C=US",clientChain[0].getSubjectDN().toString());
    X509Certificate[] serverChain=server.getChain();
    assertTrue("Server cert chain must not be null",serverChain != null);
    assertTrue("Server cert chain must not be empty",serverChain.length != 0);
    assertEquals("CN=Test Client, OU=Android, O=Google, L=MTV, ST=California, C=US",serverChain[0].getSubjectDN().toString());
  }
 catch (  Exception ex) {
    throw new RuntimeException(ex);
  }
}
