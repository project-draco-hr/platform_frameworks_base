{
  Thread thread=new Thread(){
    @Override public void run(){
      try {
        handshakeSocket=(SSLSocket)clientFactory.createSocket("www.heise.de",80);
        handshakeSocket.startHandshake();
      }
 catch (      Exception ex) {
        handshakeException=ex;
      }
    }
  }
;
  thread.start();
  try {
    Thread.sleep(5000);
    try {
      handshakeSocket.close();
    }
 catch (    Exception ex) {
      throw new RuntimeException(ex);
    }
    thread.join(5000);
  }
 catch (  InterruptedException ex) {
  }
  if (handshakeException == null) {
    fail("SSL handshake should have failed.");
  }
}
