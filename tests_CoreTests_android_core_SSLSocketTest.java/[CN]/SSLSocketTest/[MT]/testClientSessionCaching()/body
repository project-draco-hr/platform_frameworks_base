{
  OpenSSLContextImpl context=OpenSSLContextImpl.getPreferred();
  FakeClientSessionCache fakeCache=new FakeClientSessionCache();
  context.engineInit(null,null,null);
  context.engineGetClientSessionContext().setPersistentCache(fakeCache);
  SSLSocketFactory socketFactory=context.engineGetSocketFactory();
  context.engineGetClientSessionContext().setSessionCacheSize(2);
  makeRequests(socketFactory);
  List<String> smallCacheOps=Arrays.asList("get www.fortify.net","put www.fortify.net","get www.paypal.com","put www.paypal.com","get www.yellownet.ch","put www.yellownet.ch","get www.fortify.net","get www.paypal.com","get www.yellownet.ch");
  assertEquals(smallCacheOps,fakeCache.ops);
  fakeCache=new FakeClientSessionCache();
  context.engineInit(null,null,null);
  context.engineGetClientSessionContext().setPersistentCache(fakeCache);
  socketFactory=context.engineGetSocketFactory();
  context.engineGetClientSessionContext().setSessionCacheSize(3);
  makeRequests(socketFactory);
  List<String> bigCacheOps=Arrays.asList("get www.fortify.net","put www.fortify.net","get www.paypal.com","put www.paypal.com","get www.yellownet.ch","put www.yellownet.ch");
  assertEquals(bigCacheOps,fakeCache.ops);
  fakeCache=new FakeClientSessionCache();
  context.engineInit(null,null,null);
  context.engineGetClientSessionContext().setPersistentCache(fakeCache);
  socketFactory=context.engineGetSocketFactory();
  context.engineGetClientSessionContext().setSessionCacheSize(4);
  makeRequests(socketFactory);
  assertEquals(bigCacheOps,fakeCache.ops);
}
