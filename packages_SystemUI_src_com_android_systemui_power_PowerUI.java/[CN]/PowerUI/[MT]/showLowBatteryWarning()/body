{
  Slog.i(TAG,((mBatteryLevelTextView == null) ? "showing" : "updating") + " low battery warning: level=" + mBatteryLevel+ " ["+ findBatteryLevelBucket(mBatteryLevel)+ "]");
  CharSequence levelText=mContext.getString(R.string.battery_low_percent_format,mBatteryLevel);
  if (mBatteryLevelTextView != null) {
    mBatteryLevelTextView.setText(levelText);
  }
 else {
    View v=View.inflate(mContext,R.layout.battery_low,null);
    mBatteryLevelTextView=(TextView)v.findViewById(R.id.level_percent);
    mBatteryLevelTextView.setText(levelText);
    AlertDialog.Builder b=new AlertDialog.Builder(mContext);
    b.setCancelable(true);
    b.setTitle(R.string.battery_low_title);
    b.setView(v);
    b.setIconAttribute(android.R.attr.alertDialogIcon);
    b.setPositiveButton(android.R.string.ok,null);
    final Intent intent=new Intent(Intent.ACTION_POWER_USAGE_SUMMARY);
    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS| Intent.FLAG_ACTIVITY_NO_HISTORY);
    if (intent.resolveActivity(mContext.getPackageManager()) != null) {
      b.setNegativeButton(R.string.battery_low_why,new DialogInterface.OnClickListener(){
        public void onClick(        DialogInterface dialog,        int which){
          mContext.startActivity(intent);
          dismissLowBatteryWarning();
        }
      }
);
    }
    AlertDialog d=b.create();
    d.setOnDismissListener(new DialogInterface.OnDismissListener(){
      public void onDismiss(      DialogInterface dialog){
        mLowBatteryDialog=null;
        mBatteryLevelTextView=null;
      }
    }
);
    d.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
    d.show();
    mLowBatteryDialog=d;
  }
}
