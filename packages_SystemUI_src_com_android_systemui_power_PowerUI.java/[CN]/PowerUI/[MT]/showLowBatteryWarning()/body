{
  CharSequence levelText=mContext.getString(R.string.battery_low_percent_format,mBatteryLevel);
  if (mBatteryLevelTextView != null) {
    mBatteryLevelTextView.setText(levelText);
  }
 else {
    View v=View.inflate(mContext,R.layout.battery_low,null);
    mBatteryLevelTextView=(TextView)v.findViewById(R.id.level_percent);
    mBatteryLevelTextView.setText(levelText);
    AlertDialog.Builder b=new AlertDialog.Builder(mContext);
    b.setCancelable(true);
    b.setTitle(R.string.battery_low_title);
    b.setView(v);
    b.setIconAttribute(android.R.attr.alertDialogIcon);
    b.setPositiveButton(android.R.string.ok,null);
    final Intent intent=new Intent(Intent.ACTION_POWER_USAGE_SUMMARY);
    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS| Intent.FLAG_ACTIVITY_NO_HISTORY);
    if (intent.resolveActivity(mContext.getPackageManager()) != null) {
      b.setNegativeButton(R.string.battery_low_why,new DialogInterface.OnClickListener(){
        public void onClick(        DialogInterface dialog,        int which){
          mContext.startActivity(intent);
          if (mLowBatteryDialog != null) {
            mLowBatteryDialog.dismiss();
          }
        }
      }
);
    }
    AlertDialog d=b.create();
    d.setOnDismissListener(new DialogInterface.OnDismissListener(){
      public void onDismiss(      DialogInterface dialog){
        mLowBatteryDialog=null;
        mBatteryLevelTextView=null;
      }
    }
);
    d.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
    d.show();
    mLowBatteryDialog=d;
  }
  if (false) {
    final ContentResolver cr=mContext.getContentResolver();
    if (Settings.System.getInt(cr,Settings.System.POWER_SOUNDS_ENABLED,1) == 1) {
      final String soundPath=Settings.System.getString(cr,Settings.System.LOW_BATTERY_SOUND);
      if (soundPath != null) {
        final Uri soundUri=Uri.parse("file://" + soundPath);
        if (soundUri != null) {
          final Ringtone sfx=RingtoneManager.getRingtone(mContext,soundUri);
          if (sfx != null) {
            sfx.setStreamType(AudioManager.STREAM_SYSTEM);
            sfx.play();
          }
        }
      }
    }
  }
}
