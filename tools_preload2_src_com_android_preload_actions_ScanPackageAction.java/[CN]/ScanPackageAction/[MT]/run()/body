{
  Main.getUI().showWaitDialog();
  try {
    Client client=Main.getUI().getSelectedClient();
    if (client != null) {
      work(client);
    }
 else {
      Client[] clients=clientUtils.findAllClients(device);
      if (clients.length > 0) {
        ClientWrapper[] clientWrappers=new ClientWrapper[clients.length];
        for (int i=0; i < clientWrappers.length; i++) {
          clientWrappers[i]=new ClientWrapper(clients[i]);
        }
        Main.getUI().hideWaitDialog();
        ClientWrapper ret=Main.getUI().showChoiceDialog("Choose a package to scan","Choose package",clientWrappers);
        if (ret != null) {
          work(ret.client);
        }
      }
    }
  }
  finally {
    Main.getUI().hideWaitDialog();
  }
}
