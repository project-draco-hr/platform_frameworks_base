{
  if (DEBUG_VISIBILITY) {
    RuntimeException e=null;
    if (!WindowManagerService.HIDE_STACK_CRAWLS) {
      e=new RuntimeException();
      e.fillInStackTrace();
    }
    Slog.v(WindowManagerService.TAG,"performShow on " + this + ": readyToShow="+ mWin.mReadyToShow+ " readyForDisplay="+ mWin.isReadyForDisplay()+ " starting="+ (mWin.mAttrs.type == TYPE_APPLICATION_STARTING),e);
  }
  if (mWin.mReadyToShow && mWin.isReadyForDisplay()) {
    if (SHOW_TRANSACTIONS || WindowManagerService.DEBUG_ORIENTATION)     WindowManagerService.logSurface(mWin,"SHOW (performShowLocked)",null);
    if (DEBUG_VISIBILITY)     Slog.v(WindowManagerService.TAG,"Showing " + this + " during animation: policyVis="+ mWin.mPolicyVisibility+ " attHidden="+ mWin.mAttachedHidden+ " tok.hiddenRequested="+ (mWin.mAppToken != null ? mWin.mAppToken.hiddenRequested : false)+ " tok.hidden="+ (mWin.mAppToken != null ? mWin.mAppToken.hidden : false)+ " animating="+ mAnimating+ " tok animating="+ (mWin.mAppToken != null ? mWin.mAppToken.animating : false));
    if (!showSurfaceRobustlyLocked()) {
      return false;
    }
    mService.enableScreenIfNeededLocked();
    applyEnterAnimationLocked();
    mLastAlpha=-1;
    mWin.mHasDrawn=true;
    mWin.mLastHidden=false;
    mWin.mReadyToShow=false;
    int i=mWin.mChildWindows.size();
    while (i > 0) {
      i--;
      WindowState c=mWin.mChildWindows.get(i);
      if (c.mAttachedHidden) {
        c.mAttachedHidden=false;
        if (c.mWinAnimator.mSurface != null) {
          c.mWinAnimator.performShowLocked();
          mService.mLayoutNeeded=true;
        }
      }
    }
    if (mWin.mAttrs.type != TYPE_APPLICATION_STARTING && mWin.mAppToken != null) {
      mWin.mAppToken.firstWindowDrawn=true;
      if (mWin.mAppToken.startingData != null) {
        if (WindowManagerService.DEBUG_STARTING_WINDOW || WindowManagerService.DEBUG_ANIM)         Slog.v(WindowManagerService.TAG,"Finish starting " + mWin.mToken + ": first real window is shown, no animation");
        if (mAnimation != null) {
          mAnimation.cancel();
          mAnimation=null;
          mAnimating=true;
        }
        mService.mFinishedStarting.add(mWin.mAppToken);
        mService.mH.sendEmptyMessage(H.FINISHED_STARTING);
      }
      mWin.mAppToken.updateReportedVisibilityLocked();
    }
    return true;
  }
  return false;
}
