{
  if (mWin.mAppToken != null && mWin == mWin.mAppToken.startingWindow) {
    mWin.mAppToken.startingDisplayed=false;
  }
  if (mSurface != null) {
    int i=mWin.mChildWindows.size();
    while (i > 0) {
      i--;
      WindowState c=mWin.mChildWindows.get(i);
      c.mAttachedHidden=true;
    }
    try {
      if (DEBUG_VISIBILITY) {
        RuntimeException e=null;
        if (!WindowManagerService.HIDE_STACK_CRAWLS) {
          e=new RuntimeException();
          e.fillInStackTrace();
        }
        Slog.w(TAG,"Window " + this + " destroying surface "+ mSurface+ ", session "+ mSession,e);
      }
      if (mSurfaceDestroyDeferred) {
        if (mSurface != null && mPendingDestroySurface != mSurface) {
          if (mPendingDestroySurface != null) {
            if (SHOW_TRANSACTIONS || SHOW_SURFACE_ALLOC) {
              RuntimeException e=null;
              if (!WindowManagerService.HIDE_STACK_CRAWLS) {
                e=new RuntimeException();
                e.fillInStackTrace();
              }
              WindowManagerService.logSurface(mWin,"DESTROY PENDING",e);
            }
            mPendingDestroySurface.destroy();
          }
          mPendingDestroySurface=mSurface;
        }
      }
 else {
        if (SHOW_TRANSACTIONS || SHOW_SURFACE_ALLOC) {
          RuntimeException e=null;
          if (!WindowManagerService.HIDE_STACK_CRAWLS) {
            e=new RuntimeException();
            e.fillInStackTrace();
          }
          WindowManagerService.logSurface(mWin,"DESTROY",e);
        }
        mSurface.destroy();
      }
      mAnimator.hideWallpapersLocked(mWin);
    }
 catch (    RuntimeException e) {
      Slog.w(TAG,"Exception thrown when destroying Window " + this + " surface "+ mSurface+ " session "+ mSession+ ": "+ e.toString());
    }
    mSurfaceShown=false;
    mSurface=null;
    mWin.mHasSurface=false;
    mDrawState=NO_SURFACE;
  }
}
