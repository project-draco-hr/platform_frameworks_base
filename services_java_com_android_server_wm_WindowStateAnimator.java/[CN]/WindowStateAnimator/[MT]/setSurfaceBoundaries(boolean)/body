{
  final WindowState w=mWin;
  int width, height;
  if ((w.mAttrs.flags & LayoutParams.FLAG_SCALED) != 0) {
    width=w.mRequestedWidth;
    height=w.mRequestedHeight;
  }
 else {
    width=w.mCompatFrame.width();
    height=w.mCompatFrame.height();
  }
  if (width < 1) {
    width=1;
  }
  if (height < 1) {
    height=1;
  }
  final boolean surfaceResized=mSurfaceW != width || mSurfaceH != height;
  if (surfaceResized) {
    mSurfaceW=width;
    mSurfaceH=height;
  }
  final float left=w.mShownFrame.left;
  final float top=w.mShownFrame.top;
  if (mSurfaceX != left || mSurfaceY != top) {
    try {
      if (WindowManagerService.SHOW_TRANSACTIONS)       WindowManagerService.logSurface(w,"POS " + left + ", "+ top,null);
      mSurfaceX=left;
      mSurfaceY=top;
      mSurface.setPosition(left,top);
    }
 catch (    RuntimeException e) {
      Slog.w(TAG,"Error positioning surface of " + w + " pos=("+ left+ ","+ top+ ")",e);
      if (!recoveringMemory) {
        mService.reclaimSomeSurfaceMemoryLocked(this,"position",true);
      }
    }
  }
  if (surfaceResized) {
    try {
      if (WindowManagerService.SHOW_TRANSACTIONS)       WindowManagerService.logSurface(w,"SIZE " + width + "x"+ height,null);
      mSurfaceResized=true;
      mSurface.setSize(width,height);
      mAnimator.mPendingLayoutChanges|=WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER;
      if ((w.mAttrs.flags & LayoutParams.FLAG_DIM_BEHIND) != 0) {
        mAnimator.startDimming(this,w.mExiting ? 0 : w.mAttrs.dimAmount,mService.mAppDisplayWidth,mService.mAppDisplayHeight);
      }
    }
 catch (    RuntimeException e) {
      Slog.e(TAG,"Error resizing surface of " + w + " size=("+ width+ "x"+ height+ ")",e);
      if (!recoveringMemory) {
        mService.reclaimSomeSurfaceMemoryLocked(this,"size",true);
      }
    }
  }
  updateSurfaceWindowCrop(recoveringMemory);
}
