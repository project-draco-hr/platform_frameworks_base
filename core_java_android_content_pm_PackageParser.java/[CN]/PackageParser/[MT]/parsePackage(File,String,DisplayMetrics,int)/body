{
  mParseError=PackageManager.INSTALL_SUCCEEDED;
  mArchiveSourcePath=sourceFile.getPath();
  if (!sourceFile.isFile()) {
    Log.w(TAG,"Skipping dir: " + mArchiveSourcePath);
    mParseError=PackageManager.INSTALL_PARSE_FAILED_NOT_APK;
    return null;
  }
  if (!isPackageFilename(sourceFile.getName()) && (flags & PARSE_MUST_BE_APK) != 0) {
    if ((flags & PARSE_IS_SYSTEM) == 0) {
      Log.w(TAG,"Skipping non-package file: " + mArchiveSourcePath);
    }
    mParseError=PackageManager.INSTALL_PARSE_FAILED_NOT_APK;
    return null;
  }
  if ((flags & PARSE_CHATTY) != 0 && Config.LOGD)   Log.d(TAG,"Scanning package: " + mArchiveSourcePath);
  XmlResourceParser parser=null;
  AssetManager assmgr=null;
  try {
    assmgr=new AssetManager();
    assmgr.addAssetPath(mArchiveSourcePath);
    parser=assmgr.openXmlResourceParser("AndroidManifest.xml");
  }
 catch (  Exception e) {
    if (assmgr != null)     assmgr.close();
    Log.w(TAG,"Unable to read AndroidManifest.xml of " + mArchiveSourcePath,e);
    mParseError=PackageManager.INSTALL_PARSE_FAILED_BAD_MANIFEST;
    return null;
  }
  String[] errorText=new String[1];
  Package pkg=null;
  Exception errorException=null;
  try {
    Resources res=new Resources(assmgr,metrics,null);
    pkg=parsePackage(res,parser,flags,errorText);
  }
 catch (  Exception e) {
    errorException=e;
    mParseError=PackageManager.INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION;
  }
  if (pkg == null) {
    if (errorException != null) {
      Log.w(TAG,mArchiveSourcePath,errorException);
    }
 else {
      Log.w(TAG,mArchiveSourcePath + " (at " + parser.getPositionDescription()+ "): "+ errorText[0]);
    }
    parser.close();
    assmgr.close();
    if (mParseError == PackageManager.INSTALL_SUCCEEDED) {
      mParseError=PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;
    }
    return null;
  }
  parser.close();
  assmgr.close();
  pkg.applicationInfo.sourceDir=destFileName;
  pkg.applicationInfo.publicSourceDir=destFileName;
  pkg.mSignatures=null;
  return pkg;
}
