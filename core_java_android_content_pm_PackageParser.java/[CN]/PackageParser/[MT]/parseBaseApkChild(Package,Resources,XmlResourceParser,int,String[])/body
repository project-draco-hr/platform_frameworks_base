{
  if (parentPkg.childPackages != null && parentPkg.childPackages.size() + 2 > MAX_PACKAGES_PER_APK) {
    outError[0]="Maximum number of packages per APK is: " + MAX_PACKAGES_PER_APK;
    mParseError=PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;
    return false;
  }
  String childPackageName=parser.getAttributeValue(null,"package");
  if (validateName(childPackageName,true,false) != null) {
    mParseError=PackageManager.INSTALL_PARSE_FAILED_BAD_PACKAGE_NAME;
    return false;
  }
  if (childPackageName.equals(parentPkg.packageName)) {
    String message="Child package name cannot be equal to parent package name: " + parentPkg.packageName;
    Slog.w(TAG,message);
    outError[0]=message;
    mParseError=PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;
    return false;
  }
  if (parentPkg.hasChildPackage(childPackageName)) {
    String message="Duplicate child package:" + childPackageName;
    Slog.w(TAG,message);
    outError[0]=message;
    mParseError=PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;
    return false;
  }
  Package childPkg=new Package(childPackageName);
  childPkg.mVersionCode=parentPkg.mVersionCode;
  childPkg.baseRevisionCode=parentPkg.baseRevisionCode;
  childPkg.mVersionName=parentPkg.mVersionName;
  childPkg.applicationInfo.targetSdkVersion=parentPkg.applicationInfo.targetSdkVersion;
  childPkg=parseBaseApkCommon(childPkg,CHILD_PACKAGE_TAGS,res,parser,flags,outError);
  if (childPkg == null) {
    return false;
  }
  if (parentPkg.childPackages == null) {
    parentPkg.childPackages=new ArrayList<>();
  }
  parentPkg.childPackages.add(childPkg);
  childPkg.parentPackage=parentPkg;
  return true;
}
