{
  if (mOnlyCoreApps) {
    final PackageLite lite=parseMonolithicPackageLite(apkFile,flags);
    if (!lite.coreApp) {
      throw new PackageParserException(INSTALL_PARSE_FAILED_MANIFEST_MALFORMED,"Not a coreApp: " + apkFile);
    }
  }
  final AssetManager assets=new AssetManager();
  try {
    final Package pkg=parseBaseApk(apkFile,assets,flags);
    pkg.codePath=apkFile.getAbsolutePath();
    return pkg;
  }
  finally {
    IoUtils.closeQuietly(assets);
  }
}
