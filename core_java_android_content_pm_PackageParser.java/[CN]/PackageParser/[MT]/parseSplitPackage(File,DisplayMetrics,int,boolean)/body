{
  final File[] files=apkDir.listFiles();
  if (ArrayUtils.isEmpty(files)) {
    throw new PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,"No packages found in split");
  }
  File baseFile=null;
  for (  File file : files) {
    if (file.isFile() && isPackageFilename(file)) {
      ApkLite lite=parseApkLite(file.getAbsolutePath(),0);
      if (lite == null) {
        throw new PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,"Invalid package file: " + file);
      }
      if (TextUtils.isEmpty(lite.splitName)) {
        baseFile=file;
        break;
      }
    }
  }
  if (baseFile == null) {
    throw new PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,"Missing base APK in " + apkDir);
  }
  final Package pkg=parseBaseApk(baseFile,metrics,flags,trustedOverlay);
  if (pkg == null) {
    throw new PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,"Failed to parse base APK: " + baseFile);
  }
  for (  File file : files) {
    if (file.isFile() && isPackageFilename(file) && !file.equals(baseFile)) {
      parseSplitApk(pkg,file,metrics,flags,trustedOverlay);
    }
  }
  if (pkg.splitCodePaths != null) {
    Arrays.sort(pkg.splitCodePaths);
  }
  return pkg;
}
