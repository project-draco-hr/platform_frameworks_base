{
  final String apkPath=apkFile.getAbsolutePath();
  AssetManager assmgr=null;
  XmlResourceParser parser=null;
  try {
    assmgr=new AssetManager();
    assmgr.setConfiguration(0,0,null,0,0,0,0,0,0,0,0,0,0,0,0,0,Build.VERSION.RESOURCES_SDK_INT);
    int cookie=assmgr.addAssetPath(apkPath);
    if (cookie == 0) {
      throw new PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,"Failed to parse " + apkPath);
    }
    final DisplayMetrics metrics=new DisplayMetrics();
    metrics.setToDefaults();
    final Resources res=new Resources(assmgr,metrics,null);
    parser=assmgr.openXmlResourceParser(cookie,ANDROID_MANIFEST_FILENAME);
    final Signature[] signatures;
    if ((flags & PARSE_GET_SIGNATURES) != 0) {
      signatures=collectManifestCertificates(apkFile);
    }
 else {
      signatures=null;
    }
    final AttributeSet attrs=parser;
    return parseApkLite(apkPath,res,parser,attrs,flags,signatures);
  }
 catch (  XmlPullParserException|IOException|RuntimeException e) {
    throw new PackageParserException(INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION,"Failed to parse " + apkPath,e);
  }
 finally {
    if (parser != null)     parser.close();
    if (assmgr != null)     assmgr.close();
  }
}
