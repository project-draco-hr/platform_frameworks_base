{
  if (p == null)   return null;
  if (!checkUseInstalledOrHidden(flags,state) || !p.isMatch(flags)) {
    return null;
  }
  if (!copyNeeded(flags,p,state,null,userId) && ((flags & PackageManager.GET_DISABLED_UNTIL_USED_COMPONENTS) == 0 || state.enabled != PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED)) {
    updateApplicationInfo(p.applicationInfo,flags,state);
    return p.applicationInfo;
  }
  ApplicationInfo ai=new ApplicationInfo(p.applicationInfo);
  ai.initForUser(userId);
  if ((flags & PackageManager.GET_META_DATA) != 0) {
    ai.metaData=p.mAppMetaData;
  }
  if ((flags & PackageManager.GET_SHARED_LIBRARY_FILES) != 0) {
    ai.sharedLibraryFiles=p.usesLibraryFiles;
  }
  if (state.stopped) {
    ai.flags|=ApplicationInfo.FLAG_STOPPED;
  }
 else {
    ai.flags&=~ApplicationInfo.FLAG_STOPPED;
  }
  updateApplicationInfo(ai,flags,state);
  return ai;
}
