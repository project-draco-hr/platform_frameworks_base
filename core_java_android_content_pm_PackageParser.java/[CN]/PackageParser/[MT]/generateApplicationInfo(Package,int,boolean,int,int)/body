{
  if (p == null)   return null;
  if (!copyNeeded(flags,p,enabledState,null) && userId == 0) {
    if (!sCompatibilityModeEnabled) {
      p.applicationInfo.disableCompatibilityMode();
    }
    if (stopped) {
      p.applicationInfo.flags|=ApplicationInfo.FLAG_STOPPED;
    }
 else {
      p.applicationInfo.flags&=~ApplicationInfo.FLAG_STOPPED;
    }
    if (enabledState == PackageManager.COMPONENT_ENABLED_STATE_ENABLED) {
      p.applicationInfo.enabled=true;
    }
 else     if (enabledState == PackageManager.COMPONENT_ENABLED_STATE_DISABLED || enabledState == PackageManager.COMPONENT_ENABLED_STATE_DISABLED_USER) {
      p.applicationInfo.enabled=false;
    }
    p.applicationInfo.enabledSetting=enabledState;
    return p.applicationInfo;
  }
  ApplicationInfo ai=new ApplicationInfo(p.applicationInfo);
  if (userId != 0) {
    ai.uid=UserId.getUid(userId,ai.uid);
    ai.dataDir=PackageManager.getDataDirForUser(userId,ai.packageName);
  }
  if ((flags & PackageManager.GET_META_DATA) != 0) {
    ai.metaData=p.mAppMetaData;
  }
  if ((flags & PackageManager.GET_SHARED_LIBRARY_FILES) != 0) {
    ai.sharedLibraryFiles=p.usesLibraryFiles;
  }
  if (!sCompatibilityModeEnabled) {
    ai.disableCompatibilityMode();
  }
  if (stopped) {
    ai.flags|=ApplicationInfo.FLAG_STOPPED;
  }
 else {
    ai.flags&=~ApplicationInfo.FLAG_STOPPED;
  }
  if (enabledState == PackageManager.COMPONENT_ENABLED_STATE_ENABLED) {
    ai.enabled=true;
  }
 else   if (enabledState == PackageManager.COMPONENT_ENABLED_STATE_DISABLED || enabledState == PackageManager.COMPONENT_ENABLED_STATE_DISABLED_USER) {
    ai.enabled=false;
  }
  ai.enabledSetting=enabledState;
  return ai;
}
