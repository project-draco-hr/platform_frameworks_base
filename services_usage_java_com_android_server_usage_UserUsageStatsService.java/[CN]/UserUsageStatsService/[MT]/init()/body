{
  mDatabase.init();
  int nullCount=0;
  for (int i=0; i < mCurrentStats.length; i++) {
    mCurrentStats[i]=mDatabase.getLatestUsageStats(i);
    if (mCurrentStats[i] == null) {
      nullCount++;
    }
  }
  if (nullCount > 0) {
    if (nullCount != mCurrentStats.length) {
      Slog.w(TAG,mLogPrefix + "Some stats have no latest available");
    }
 else {
    }
    loadActiveStats();
  }
 else {
    mDailyExpiryDate.setTimeInMillis(mCurrentStats[UsageStatsManager.INTERVAL_DAILY].beginTime);
    mDailyExpiryDate.add(Calendar.DAY_OF_YEAR,1);
    UsageStatsUtils.truncateDateTo(UsageStatsManager.INTERVAL_DAILY,mDailyExpiryDate);
    Slog.i(TAG,mLogPrefix + "Rollover scheduled for " + sDateFormat.format(mDailyExpiryDate.getTime()));
  }
  for (  IntervalStats stat : mCurrentStats) {
    final int pkgCount=stat.stats.size();
    for (int i=0; i < pkgCount; i++) {
      UsageStats pkgStats=stat.stats.valueAt(i);
      if (pkgStats.mLastEvent == UsageEvents.Event.MOVE_TO_FOREGROUND || pkgStats.mLastEvent == UsageEvents.Event.CONTINUE_PREVIOUS_DAY) {
        stat.update(pkgStats.mPackageName,stat.lastTimeSaved,UsageEvents.Event.END_OF_DAY);
        notifyStatsChanged();
      }
    }
  }
}
