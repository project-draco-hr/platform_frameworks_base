{
  mDatabase.init();
  int nullCount=0;
  for (int i=0; i < mCurrentStats.length; i++) {
    mCurrentStats[i]=mDatabase.getLatestUsageStats(i);
    if (mCurrentStats[i] == null) {
      nullCount++;
    }
  }
  if (nullCount > 0) {
    if (nullCount != mCurrentStats.length) {
      Slog.w(TAG,mLogPrefix + "Some stats have no latest available");
    }
 else {
    }
    loadActiveStats();
  }
 else {
    mDailyExpiryDate.setTimeInMillis(mCurrentStats[UsageStatsManager.DAILY_BUCKET].mBeginTimeStamp);
    mDailyExpiryDate.add(Calendar.DAY_OF_YEAR,1);
    UsageStatsUtils.truncateDateTo(UsageStatsManager.DAILY_BUCKET,mDailyExpiryDate);
    Slog.i(TAG,mLogPrefix + "Rollover scheduled for " + sDateFormat.format(mDailyExpiryDate.getTime()));
  }
  for (  UsageStats stat : mCurrentStats) {
    final int pkgCount=stat.getPackageCount();
    for (int i=0; i < pkgCount; i++) {
      PackageUsageStats pkgStats=stat.getPackage(i);
      if (pkgStats.mLastEvent == UsageStats.Event.MOVE_TO_FOREGROUND || pkgStats.mLastEvent == UsageStats.Event.CONTINUE_PREVIOUS_DAY) {
        updateStats(stat,pkgStats.mPackageName,stat.mLastTimeSaved,UsageStats.Event.END_OF_DAY);
        notifyStatsChanged();
      }
    }
  }
}
