{
  PackageUsageStats pkgStats=stats.getOrCreatePackageUsageStats(packageName);
  if (eventType == UsageStats.Event.MOVE_TO_BACKGROUND || eventType == UsageStats.Event.END_OF_DAY) {
    if (pkgStats.mLastEvent == UsageStats.Event.MOVE_TO_FOREGROUND || pkgStats.mLastEvent == UsageStats.Event.CONTINUE_PREVIOUS_DAY) {
      pkgStats.mTotalTimeSpent+=timeStamp - pkgStats.mLastTimeUsed;
    }
  }
  pkgStats.mLastEvent=eventType;
  pkgStats.mLastTimeUsed=timeStamp;
  stats.mEndTimeStamp=timeStamp;
}
