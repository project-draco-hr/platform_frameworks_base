{
switch (m.what) {
case MSG_OPEN_NOTIFICATION_PEEK:
    if (DEBUG)     Slog.d(TAG,"opening notification peek window; arg=" + m.arg1);
  if (m.arg1 >= 0) {
    final int N=mNotificationData.size();
    if (!mNotificationDNDMode) {
      if (mNotificationPeekIndex >= 0 && mNotificationPeekIndex < N) {
        NotificationData.Entry entry=mNotificationData.get(N - 1 - mNotificationPeekIndex);
        entry.icon.setBackgroundColor(0);
        mNotificationPeekIndex=-1;
        mNotificationPeekKey=null;
      }
    }
    final int peekIndex=m.arg1;
    if (peekIndex < N) {
      NotificationData.Entry entry=mNotificationDNDMode ? mNotificationDNDDummyEntry : mNotificationData.get(N - 1 - peekIndex);
      NotificationData.Entry copy=new NotificationData.Entry(entry.key,entry.notification,entry.icon);
      inflateViews(copy,mNotificationPeekRow);
      if (mNotificationDNDMode) {
        copy.content.setOnClickListener(new View.OnClickListener(){
          public void onClick(          View v){
            SharedPreferences.Editor editor=Prefs.edit(mContext);
            editor.putBoolean(Prefs.DO_NOT_DISTURB_PREF,false);
            editor.apply();
            animateCollapse();
          }
        }
);
      }
      entry.icon.setBackgroundColor(0x20FFFFFF);
      mNotificationPeekRow.removeAllViews();
      mNotificationPeekRow.addView(copy.row);
      mNotificationPeekWindow.setVisibility(View.VISIBLE);
      mNotificationPanel.show(false,true);
      mNotificationPeekIndex=peekIndex;
      mNotificationPeekKey=entry.key;
    }
  }
break;
case MSG_CLOSE_NOTIFICATION_PEEK:
if (DEBUG) Slog.d(TAG,"closing notification peek window");
mNotificationPeekWindow.setVisibility(View.GONE);
mNotificationPeekRow.removeAllViews();
final int N=mNotificationData.size();
if (mNotificationPeekIndex >= 0 && mNotificationPeekIndex < N) {
NotificationData.Entry entry=mNotificationDNDMode ? mNotificationDNDDummyEntry : mNotificationData.get(N - 1 - mNotificationPeekIndex);
entry.icon.setBackgroundColor(0);
}
mNotificationPeekIndex=-1;
mNotificationPeekKey=null;
break;
case MSG_OPEN_NOTIFICATION_PANEL:
if (DEBUG) Slog.d(TAG,"opening notifications panel");
if (!mNotificationPanel.isShowing()) {
mNotificationPeekWindow.setVisibility(View.GONE);
mNotificationPanel.show(true,true);
mNotificationArea.setVisibility(View.INVISIBLE);
mTicker.halt();
}
break;
case MSG_CLOSE_NOTIFICATION_PANEL:
if (DEBUG) Slog.d(TAG,"closing notifications panel");
if (mNotificationPanel.isShowing()) {
mNotificationPanel.show(false,true);
mNotificationArea.setVisibility(View.VISIBLE);
}
break;
case MSG_OPEN_RECENTS_PANEL:
if (DEBUG) Slog.d(TAG,"opening recents panel");
if (mRecentsPanel != null) {
disable(StatusBarManager.DISABLE_BACK);
mRecentsPanel.setVisibility(View.VISIBLE);
mRecentsPanel.show(true,true);
}
break;
case MSG_CLOSE_RECENTS_PANEL:
if (DEBUG) Slog.d(TAG,"closing recents panel");
if (mRecentsPanel != null && mRecentsPanel.isShowing()) {
disable(StatusBarManager.DISABLE_NONE);
mRecentsPanel.show(false,true);
}
break;
case MSG_OPEN_INPUT_METHODS_PANEL:
if (DEBUG) Slog.d(TAG,"opening input methods panel");
if (mInputMethodsPanel != null) mInputMethodsPanel.openPanel();
break;
case MSG_CLOSE_INPUT_METHODS_PANEL:
if (DEBUG) Slog.d(TAG,"closing input methods panel");
if (mInputMethodsPanel != null) mInputMethodsPanel.closePanel(false);
break;
case MSG_SHOW_CHROME:
if (DEBUG) Slog.d(TAG,"hiding shadows (lights on)");
mBarContents.setVisibility(View.VISIBLE);
mShadow.setVisibility(View.GONE);
notifyLightsChanged(true);
break;
case MSG_HIDE_CHROME:
if (DEBUG) Slog.d(TAG,"showing shadows (lights out)");
animateCollapse();
mBarContents.setVisibility(View.GONE);
mShadow.setVisibility(View.VISIBLE);
notifyLightsChanged(false);
break;
case MSG_STOP_TICKER:
mTicker.halt();
break;
}
}
