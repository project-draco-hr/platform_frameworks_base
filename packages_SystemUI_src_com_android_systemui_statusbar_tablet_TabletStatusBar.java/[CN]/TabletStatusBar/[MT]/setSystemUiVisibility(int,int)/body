{
  final int oldVal=mSystemUiVisibility;
  final int newVal=(oldVal & ~mask) | (vis & mask);
  final int diff=newVal ^ oldVal;
  if (diff != 0) {
    mSystemUiVisibility=newVal;
    if (0 != (diff & View.SYSTEM_UI_FLAG_LOW_PROFILE)) {
      mHandler.removeMessages(MSG_HIDE_CHROME);
      mHandler.removeMessages(MSG_SHOW_CHROME);
      mHandler.sendEmptyMessage(0 == (vis & View.SYSTEM_UI_FLAG_LOW_PROFILE) ? MSG_SHOW_CHROME : MSG_HIDE_CHROME);
    }
    notifyUiVisibilityChanged();
  }
}
