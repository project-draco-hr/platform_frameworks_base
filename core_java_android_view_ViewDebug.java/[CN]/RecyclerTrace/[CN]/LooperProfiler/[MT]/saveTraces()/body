{
  FileOutputStream fos;
  try {
    fos=new FileOutputStream(mTraceFile);
  }
 catch (  FileNotFoundException e) {
    Log.e(LOG_TAG,"Could not open trace file: " + mTraceFile);
    return;
  }
  DataOutputStream out=new DataOutputStream(new BufferedOutputStream(fos));
  try {
    out.writeInt(LOOPER_PROFILER_VERSION);
    out.writeLong(mTraceWallStart);
    out.writeLong(mTraceThreadStart);
    out.writeInt(mTraceNames.size());
    for (    Map.Entry<String,Short> entry : mTraceNames.entrySet()) {
      saveTraceName(entry.getKey(),entry.getValue(),out);
    }
    out.writeInt(mTraces.size());
    for (    Entry entry : mTraces) {
      saveTrace(entry,out);
    }
    Log.d(LOG_TAG,"Looper traces ready: " + mTraceFile);
  }
 catch (  IOException e) {
    Log.e(LOG_TAG,"Could not write trace file: ",e);
  }
 finally {
    try {
      out.close();
    }
 catch (    IOException e) {
    }
  }
}
