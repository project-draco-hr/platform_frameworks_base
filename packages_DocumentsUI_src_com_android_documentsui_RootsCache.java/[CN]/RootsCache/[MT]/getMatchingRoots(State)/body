{
  int includeFlags=0;
  for (  String acceptMime : state.acceptMimes) {
    final String[] type=acceptMime.split("/");
    if (type.length != 2)     continue;
    if ("image".equals(type[0])) {
      includeFlags|=Root.FLAG_PROVIDES_IMAGES;
    }
 else     if ("audio".equals(type[0])) {
      includeFlags|=Root.FLAG_PROVIDES_AUDIO;
    }
 else     if ("video".equals(type[0])) {
      includeFlags|=Root.FLAG_PROVIDES_VIDEO;
    }
 else     if ("*".equals(type[0])) {
      includeFlags|=Root.FLAG_PROVIDES_IMAGES | Root.FLAG_PROVIDES_AUDIO | Root.FLAG_PROVIDES_VIDEO;
    }
  }
  ArrayList<RootInfo> matching=Lists.newArrayList();
  for (  RootInfo root : mRoots) {
    final boolean supportsCreate=(root.flags & Root.FLAG_SUPPORTS_CREATE) != 0;
    final boolean advanced=(root.flags & Root.FLAG_ADVANCED) != 0;
    final boolean localOnly=(root.flags & Root.FLAG_LOCAL_ONLY) != 0;
    if (state.action == State.ACTION_CREATE && !supportsCreate)     continue;
    if (!state.showAdvanced && advanced)     continue;
    if (state.localOnly && !localOnly)     continue;
    if ((root.flags & FLAGS_CONTENT_MASK) != 0) {
      if ((root.flags & includeFlags) == 0) {
        continue;
      }
    }
    matching.add(root);
  }
  return matching;
}
