{
  final boolean lowPowerModeEnabled=!mIsPowered && (mLowPowerModeSetting || (mAutoLowPowerModeEnabled && mBatteryLevelLow));
  if (mLowPowerModeEnabled != lowPowerModeEnabled) {
    mLowPowerModeEnabled=lowPowerModeEnabled;
    powerHintInternal(POWER_HINT_LOW_POWER_MODE,lowPowerModeEnabled ? 1 : 0);
    setSurfaceFlingerLowPowerMode(lowPowerModeEnabled ? 1 : 0);
    mLowPowerModeEnabled=lowPowerModeEnabled;
    BackgroundThread.getHandler().post(new Runnable(){
      @Override public void run(){
        ArrayList<PowerManagerInternal.LowPowerModeListener> listeners;
synchronized (mLock) {
          listeners=new ArrayList<PowerManagerInternal.LowPowerModeListener>(mLowPowerModeListeners);
        }
        for (int i=0; i < listeners.size(); i++) {
          listeners.get(i).onLowPowerModeChanged(lowPowerModeEnabled);
        }
        Intent intent=new Intent(PowerManager.ACTION_POWER_SAVE_MODE_CHANGED);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
        mContext.sendBroadcast(intent);
      }
    }
);
  }
}
