{
  boolean changed=false;
  if ((dirty & (DIRTY_WAKE_LOCKS | DIRTY_USER_ACTIVITY | DIRTY_BOOT_COMPLETED| DIRTY_WAKEFULNESS| DIRTY_STAY_ON| DIRTY_PROXIMITY_POSITIVE| DIRTY_DOCK_STATE)) != 0) {
    if (mWakefulness == WAKEFULNESS_AWAKE && isItBedTimeYetLocked()) {
      if (DEBUG_SPEW) {
        Slog.d(TAG,"updateWakefulnessLocked: Bed time...");
      }
      final long time=SystemClock.uptimeMillis();
      if (shouldNapAtBedTimeLocked()) {
        changed=napNoUpdateLocked(time,Process.SYSTEM_UID);
      }
 else {
        changed=goToSleepNoUpdateLocked(time,PowerManager.GO_TO_SLEEP_REASON_TIMEOUT,0,Process.SYSTEM_UID);
      }
    }
  }
  return changed;
}
