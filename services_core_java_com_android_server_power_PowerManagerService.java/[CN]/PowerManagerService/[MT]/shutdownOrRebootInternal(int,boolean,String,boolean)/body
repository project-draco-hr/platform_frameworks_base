{
  if (mHandler == null || !mSystemReady) {
    throw new IllegalStateException("Too early to call shutdown() or reboot()");
  }
  Runnable runnable=new Runnable(){
    @Override public void run(){
synchronized (this) {
        if (haltMode == HALT_MODE_REBOOT_SAFE_MODE) {
          ShutdownThread.rebootSafeMode(mContext,confirm);
        }
 else         if (haltMode == HALT_MODE_REBOOT) {
          ShutdownThread.reboot(mContext,reason,confirm);
        }
 else {
          ShutdownThread.shutdown(mContext,reason,confirm);
        }
      }
    }
  }
;
  Message msg=Message.obtain(mHandler,runnable);
  msg.setAsynchronous(true);
  mHandler.sendMessage(msg);
  if (wait) {
synchronized (runnable) {
      while (true) {
        try {
          runnable.wait();
        }
 catch (        InterruptedException e) {
        }
      }
    }
  }
}
