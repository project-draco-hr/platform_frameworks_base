{
  Frame input=pullInput("image");
  FrameFormat inputFormat=input.getFormat();
  FrameFormat noiseFormat=ImageFormat.create(inputFormat.getWidth() / 2,inputFormat.getHeight() / 2,ImageFormat.COLORSPACE_RGBA,FrameFormat.TARGET_GPU);
  Frame noiseFrame=context.getFrameManager().newFrame(inputFormat);
  Frame output=context.getFrameManager().newFrame(inputFormat);
  if (mNoiseProgram == null || mGrainProgram == null || inputFormat.getTarget() != mTarget) {
    initProgram(context,inputFormat.getTarget());
    updateParameters();
  }
  if (inputFormat.getWidth() != mWidth || inputFormat.getHeight() != mHeight) {
    updateFrameSize(inputFormat.getWidth(),inputFormat.getHeight());
  }
  Frame[] empty={};
  mNoiseProgram.process(empty,noiseFrame);
  Frame[] inputs={input,noiseFrame};
  mGrainProgram.process(inputs,output);
  pushOutput("image",output);
  output.release();
  noiseFrame.release();
}
