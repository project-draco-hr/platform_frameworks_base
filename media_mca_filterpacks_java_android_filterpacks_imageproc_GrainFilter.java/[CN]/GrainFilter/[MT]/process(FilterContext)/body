{
  Frame input=pullInput("image");
  FrameFormat inputFormat=input.getFormat();
  Frame output=context.getFrameManager().newFrame(inputFormat);
  if (mProgram == null || inputFormat.getTarget() != mTarget) {
    initProgram(context,inputFormat.getTarget());
    updateParameters();
  }
  if (inputFormat.getWidth() != mWidth || inputFormat.getHeight() != mHeight) {
    updateFrameSize(inputFormat.getWidth(),inputFormat.getHeight());
    int[] buffer=new int[mWidth * mHeight];
    for (int i=0; i < mWidth * mHeight; ++i) {
      buffer[i]=(mRandom.nextInt(256) < RAND_THRESHOLD) ? mRandom.nextInt(256) : 0;
    }
    FrameFormat format=ImageFormat.create(mWidth,mHeight,ImageFormat.COLORSPACE_RGBA,FrameFormat.TARGET_GPU);
    if (mNoiseFrame != null) {
      mNoiseFrame.release();
    }
    mNoiseFrame=context.getFrameManager().newFrame(format);
    mNoiseFrame.setInts(buffer);
  }
  if (mNoiseFrame.getFormat().getWidth() != mWidth || mNoiseFrame.getFormat().getHeight() != mHeight) {
    throw new RuntimeException("Random map and imput image size mismatch!");
  }
  Frame[] inputs={input,mNoiseFrame};
  mProgram.process(inputs,output);
  pushOutput("image",output);
  output.release();
}
