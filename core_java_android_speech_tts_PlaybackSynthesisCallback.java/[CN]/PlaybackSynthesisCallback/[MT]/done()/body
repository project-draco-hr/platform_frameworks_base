{
  if (DBG)   Log.d(TAG,"done()");
  int statusCode=0;
  SynthesisPlaybackQueueItem item=null;
synchronized (mStateLock) {
    if (mDone) {
      Log.w(TAG,"Duplicate call to done()");
      return TextToSpeech.ERROR;
    }
    if (mStatusCode == TextToSpeech.STOPPED) {
      if (DBG)       Log.d(TAG,"Request has been aborted.");
      return errorCodeOnStop();
    }
    mDone=true;
    if (mItem == null) {
      Log.w(TAG,"done() was called before start() call");
      if (mStatusCode == TextToSpeech.SUCCESS) {
        mDispatcher.dispatchOnSuccess();
      }
 else {
        mDispatcher.dispatchOnError(mStatusCode);
      }
      mLogger.onEngineComplete();
      return TextToSpeech.ERROR;
    }
    item=mItem;
    statusCode=mStatusCode;
  }
  if (statusCode == TextToSpeech.SUCCESS) {
    item.done();
  }
 else {
    item.stop(statusCode);
  }
  mLogger.onEngineComplete();
  return TextToSpeech.SUCCESS;
}
