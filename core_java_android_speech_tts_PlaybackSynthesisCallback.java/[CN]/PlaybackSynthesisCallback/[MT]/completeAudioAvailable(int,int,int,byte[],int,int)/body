{
  int channelConfig=AudioPlaybackHandler.getChannelConfig(channelCount);
  if (channelConfig == 0) {
    Log.e(TAG,"Unsupported number of channels :" + channelCount);
    return TextToSpeech.ERROR;
  }
  int bytesPerFrame=AudioPlaybackHandler.getBytesPerFrame(audioFormat);
  if (bytesPerFrame < 0) {
    Log.e(TAG,"Unsupported audio format :" + audioFormat);
    return TextToSpeech.ERROR;
  }
synchronized (mStateLock) {
    if (mStopped) {
      return TextToSpeech.ERROR;
    }
    SynthesisMessageParams params=new SynthesisMessageParams(mStreamType,sampleRateInHz,audioFormat,channelCount,mVolume,mPan,mDispatcher);
    params.addBuffer(buffer,offset,length);
    mAudioTrackHandler.enqueueSynthesisCompleteDataAvailable(params);
    mToken=params;
  }
  return TextToSpeech.SUCCESS;
}
