{
  if (DBG)   Log.d(TAG,"stop()");
  mLogger.onStopped();
  SynthesisMessageParams token;
synchronized (mStateLock) {
    if (mStopped) {
      Log.w(TAG,"stop() called twice");
      return;
    }
    token=mToken;
    mStopped=true;
  }
  if (token != null) {
    token.setIsError(wasError);
    token.clearBuffers();
    if (wasError) {
      mAudioTrackHandler.enqueueSynthesisDone(token);
    }
  }
 else {
    mLogger.onWriteData();
    if (wasError) {
      mDispatcher.dispatchOnError();
    }
  }
}
