{
  boolean fullyClosed=true;
  PanelView fullyOpenedPanel=null;
  LOG("panelExpansionChanged: start state=%d panel=%s",mState,panel.getName());
  for (  PanelView pv : mPanels) {
    if (pv.getExpandedHeight() > 0f) {
      if (mState == STATE_CLOSED) {
        go(STATE_OPENING);
        onPanelPeeked();
      }
      fullyClosed=false;
      final float thisFrac=pv.getExpandedFraction();
      LOG("panelExpansionChanged:  -> %s: f=%.1f",pv.getName(),thisFrac);
      if (panel == pv) {
        if (thisFrac == 1f)         fullyOpenedPanel=panel;
      }
 else {
        pv.setExpandedFraction(1f - frac);
      }
    }
  }
  if (fullyOpenedPanel != null && !mTracking) {
    go(STATE_OPEN);
    onPanelFullyOpened(fullyOpenedPanel);
  }
 else   if (fullyClosed && !mTracking && mState != STATE_CLOSED) {
    go(STATE_CLOSED);
    onAllPanelsCollapsed();
  }
  LOG("panelExpansionChanged: end state=%d [%s%s ]",mState,(fullyOpenedPanel != null) ? " fullyOpened" : "",fullyClosed ? " fullyClosed" : "");
}
