{
  boolean waiting=false;
  for (  PanelView pv : mPanels) {
    if (animate && !pv.isFullyCollapsed()) {
      if (PhoneStatusBar.DEBUG_EMPTY_KEYGUARD) {
        Log.i(TAG,"Animating collapse, delayed");
      }
      pv.collapse(true);
      waiting=true;
    }
 else {
      if (PhoneStatusBar.DEBUG_EMPTY_KEYGUARD) {
        Log.i(TAG,"Collapsing without animation");
      }
      pv.resetViews();
      pv.setExpandedFraction(0);
      pv.setVisibility(View.GONE);
      pv.cancelPeek();
    }
  }
  if (DEBUG)   LOG("collapseAllPanels: animate=%s waiting=%s",animate,waiting);
  if (!waiting && mState != STATE_CLOSED) {
    go(STATE_CLOSED);
    onAllPanelsCollapsed();
  }
}
