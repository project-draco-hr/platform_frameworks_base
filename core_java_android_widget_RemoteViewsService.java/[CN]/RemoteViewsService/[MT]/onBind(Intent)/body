{
synchronized (mLock) {
    Intent.FilterComparison fc=new Intent.FilterComparison(intent);
    Pair<RemoteViewsFactory,Integer> factoryRef=null;
    RemoteViewsFactory factory=null;
    if (!mRemoteViewFactories.containsKey(fc)) {
      factory=onGetViewFactory(intent);
      factoryRef=new Pair<RemoteViewsFactory,Integer>(factory,1);
      mRemoteViewFactories.put(fc,factoryRef);
      factory.onCreate();
    }
 else {
      Pair<RemoteViewsFactory,Integer> oldFactoryRef=mRemoteViewFactories.get(fc);
      factory=oldFactoryRef.first;
      int newRefCount=oldFactoryRef.second.intValue() + 1;
      factoryRef=new Pair<RemoteViewsFactory,Integer>(oldFactoryRef.first,newRefCount);
      mRemoteViewFactories.put(fc,factoryRef);
    }
    return new RemoteViewsFactoryAdapter(factory);
  }
}
