{
  Log.w(TAG,"Upgrading settings database from version " + oldVersion + " to "+ currentVersion);
  int upgradeVersion=oldVersion;
  if (upgradeVersion == 20) {
    loadVibrateSetting(db,true);
    if (Config.LOGD)     Log.d(TAG,"Reset system vibrate setting");
    upgradeVersion=21;
  }
  if (upgradeVersion < 22) {
    upgradeVersion=22;
    upgradeLockPatternLocation(db);
  }
  if (upgradeVersion < 23) {
    db.execSQL("UPDATE favorites SET iconResource=0 WHERE iconType=0");
    upgradeVersion=23;
  }
  if (upgradeVersion == 23) {
    db.beginTransaction();
    try {
      db.execSQL("ALTER TABLE favorites ADD spanX INTEGER");
      db.execSQL("ALTER TABLE favorites ADD spanY INTEGER");
      db.execSQL("UPDATE favorites SET spanX=1, spanY=1 WHERE itemType<=0");
      db.execSQL("UPDATE favorites SET spanX=2, spanY=2 WHERE itemType=1000 or itemType=1002");
      db.execSQL("UPDATE favorites SET spanX=4, spanY=1 WHERE itemType=1001");
      db.setTransactionSuccessful();
    }
  finally {
      db.endTransaction();
    }
    upgradeVersion=24;
  }
  if (upgradeVersion == 24) {
    db.beginTransaction();
    try {
      db.execSQL("DELETE FROM system WHERE name='network_preference'");
      db.execSQL("INSERT INTO system ('name', 'value') values ('network_preference', '" + ConnectivityManager.DEFAULT_NETWORK_PREFERENCE + "')");
      db.setTransactionSuccessful();
    }
  finally {
      db.endTransaction();
    }
    upgradeVersion=25;
  }
  if (upgradeVersion != currentVersion) {
    Log.w(TAG,"Got stuck trying to upgrade from version " + upgradeVersion + ", must wipe the settings provider");
    db.execSQL("DROP TABLE IF EXISTS system");
    db.execSQL("DROP INDEX IF EXISTS systemIndex1");
    db.execSQL("DROP TABLE IF EXISTS gservices");
    db.execSQL("DROP INDEX IF EXISTS gservicesIndex1");
    db.execSQL("DROP TABLE IF EXISTS bluetooth_devices");
    db.execSQL("DROP TABLE IF EXISTS bookmarks");
    db.execSQL("DROP INDEX IF EXISTS bookmarksIndex1");
    db.execSQL("DROP INDEX IF EXISTS bookmarksIndex2");
    db.execSQL("DROP TABLE IF EXISTS favorites");
    onCreate(db);
  }
}
