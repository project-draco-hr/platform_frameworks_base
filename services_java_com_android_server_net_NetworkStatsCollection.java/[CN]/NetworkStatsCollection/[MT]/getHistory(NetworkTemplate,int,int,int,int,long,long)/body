{
  final NetworkStatsHistory combined=new NetworkStatsHistory(mBucketDuration,estimateBuckets(),fields);
  for (  Map.Entry<Key,NetworkStatsHistory> entry : mStats.entrySet()) {
    final Key key=entry.getKey();
    final boolean setMatches=set == SET_ALL || key.set == set;
    if (key.uid == uid && setMatches && key.tag == tag && templateMatches(template,key.ident)) {
      combined.recordHistory(entry.getValue(),start,end);
    }
  }
  return combined;
}
