{
  if (mIdleMaintenanceStarted) {
    if (!deviceStatePermitsIdleMaintenanceRunning()) {
      mIdleMaintenanceStarted=false;
      EventLogTags.writeIdleMaintenanceWindowFinish(SystemClock.elapsedRealtime(),mLastUserActivityElapsedTimeMillis,mBatteryLevel,mBatteryCharging ? 1 : 0);
      sendIdleMaintenanceEndIntent();
    }
  }
 else   if (deviceStatePermitsIdleMaintenanceStart() && lastUserActivityPermitsIdleMaintenanceStart() && lastRunPermitsIdleMaintenanceStart()) {
    mIdleMaintenanceStarted=true;
    EventLogTags.writeIdleMaintenanceWindowStart(SystemClock.elapsedRealtime(),mLastUserActivityElapsedTimeMillis,mBatteryLevel,mBatteryCharging ? 1 : 0);
    mLastIdleMaintenanceStartTimeMillis=SystemClock.elapsedRealtime();
    sendIdleMaintenanceStartIntent();
  }
}
