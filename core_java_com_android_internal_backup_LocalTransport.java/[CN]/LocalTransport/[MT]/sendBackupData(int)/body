{
  if (mSocket == null) {
    Log.w(TAG,"Attempted sendBackupData before performFullBackup");
    return TRANSPORT_ERROR;
  }
  mFullBackupSize+=numBytes;
  if (mFullBackupSize > FULL_BACKUP_SIZE_QUOTA) {
    return TRANSPORT_QUOTA_EXCEEDED;
  }
  if (numBytes > mFullBackupBuffer.length) {
    mFullBackupBuffer=new byte[numBytes];
  }
  if (mFullBackupOutputStream == null) {
    FileOutputStream tarstream;
    try {
      File tarball=tarballFile(mFullTargetPackage);
      tarstream=new FileOutputStream(tarball);
    }
 catch (    FileNotFoundException e) {
      return TRANSPORT_ERROR;
    }
    mFullBackupOutputStream=new BufferedOutputStream(tarstream);
  }
  int bytesLeft=numBytes;
  while (bytesLeft > 0) {
    try {
      int nRead=mSocketInputStream.read(mFullBackupBuffer,0,bytesLeft);
      if (nRead < 0) {
        Log.w(TAG,"Unexpected EOD; failing backup");
        return TRANSPORT_ERROR;
      }
      mFullBackupOutputStream.write(mFullBackupBuffer,0,nRead);
      bytesLeft-=nRead;
    }
 catch (    IOException e) {
      Log.e(TAG,"Error handling backup data for " + mFullTargetPackage);
      return TRANSPORT_ERROR;
    }
  }
  if (DEBUG) {
    Log.v(TAG,"   stored " + numBytes + " of data");
  }
  return TRANSPORT_OK;
}
