{
  setViewportSettingsFromNative();
  if (WebView.DEFAULT_SCALE_PERCENT != 100) {
    float adjust=(float)WebView.DEFAULT_SCALE_PERCENT / 100.0f;
    if (mViewportInitialScale > 0) {
      mViewportInitialScale*=adjust;
    }
    if (mViewportMinimumScale > 0) {
      mViewportMinimumScale*=adjust;
    }
    if (mViewportMaximumScale > 0) {
      mViewportMaximumScale*=adjust;
    }
  }
  if (mViewportWidth == 0) {
    if (mViewportInitialScale == 0) {
      mViewportInitialScale=WebView.DEFAULT_SCALE_PERCENT;
    }
    if (mViewportMinimumScale == 0) {
      mViewportMinimumScale=WebView.DEFAULT_SCALE_PERCENT;
    }
  }
  if (mViewportUserScalable == false) {
    mViewportInitialScale=WebView.DEFAULT_SCALE_PERCENT;
    mViewportMinimumScale=WebView.DEFAULT_SCALE_PERCENT;
    mViewportMaximumScale=WebView.DEFAULT_SCALE_PERCENT;
  }
  if (mViewportMinimumScale > mViewportInitialScale) {
    if (mViewportInitialScale == 0) {
      mViewportInitialScale=mViewportMinimumScale;
    }
 else {
      mViewportMinimumScale=mViewportInitialScale;
    }
  }
  if (mViewportMaximumScale > 0) {
    if (mViewportMaximumScale < mViewportInitialScale) {
      mViewportMaximumScale=mViewportInitialScale;
    }
 else     if (mViewportInitialScale == 0) {
      mViewportInitialScale=mViewportMaximumScale;
    }
  }
  if (mViewportWidth < 0 && mViewportInitialScale == WebView.DEFAULT_SCALE_PERCENT) {
    mViewportWidth=0;
  }
  if (mViewportWidth != 0 && !updateRestoreState)   return;
  int webViewWidth=Math.round(mCurrentViewWidth * mCurrentViewScale);
  mRestoreState=new RestoreState();
  mRestoreState.mMinScale=mViewportMinimumScale / 100.0f;
  mRestoreState.mMaxScale=mViewportMaximumScale / 100.0f;
  mRestoreState.mScrollX=mRestoredX;
  mRestoreState.mScrollY=mRestoredY;
  mRestoreState.mMobileSite=(0 == mViewportWidth);
  if (mRestoredScale > 0) {
    if (mRestoredScreenWidthScale > 0) {
      mRestoreState.mTextWrapScale=mRestoredScreenWidthScale / 100.0f;
      mRestoreState.mViewScale=0;
    }
 else {
      mRestoreState.mViewScale=mRestoreState.mTextWrapScale=mRestoredScale / 100.0f;
    }
  }
 else {
    if (mViewportInitialScale > 0) {
      mRestoreState.mViewScale=mRestoreState.mTextWrapScale=mViewportInitialScale / 100.0f;
    }
 else     if (mViewportWidth > 0 && mViewportWidth < webViewWidth) {
      mRestoreState.mViewScale=mRestoreState.mTextWrapScale=(float)webViewWidth / mViewportWidth;
    }
 else {
      mRestoreState.mTextWrapScale=WebView.DEFAULT_SCALE_PERCENT / 100.0f;
      mRestoreState.mViewScale=0;
    }
  }
  if (mWebView.mHeightCanMeasure) {
    mWebView.mLastHeightSent=0;
    WebView.ViewSizeData data=new WebView.ViewSizeData();
    data.mWidth=mWebView.mLastWidthSent;
    data.mHeight=0;
    data.mTextWrapWidth=data.mWidth;
    data.mScale=-1.0f;
    mEventHub.sendMessageAtFrontOfQueue(Message.obtain(null,EventHub.VIEW_SIZE_CHANGED,data));
  }
 else   if (mSettings.getUseWideViewPort()) {
    if (mCurrentViewWidth == 0) {
      mWebView.mLastWidthSent=0;
    }
 else {
      WebView.ViewSizeData data=new WebView.ViewSizeData();
      data.mScale=mRestoreState.mViewScale == 0 ? (mRestoredScale > 0 ? mRestoredScale : mRestoreState.mTextWrapScale) : mRestoreState.mViewScale;
      data.mWidth=Math.round(webViewWidth / data.mScale);
      data.mHeight=mCurrentViewHeight * data.mWidth / mCurrentViewWidth;
      data.mTextWrapWidth=Math.round(webViewWidth / mRestoreState.mTextWrapScale);
      mEventHub.sendMessageAtFrontOfQueue(Message.obtain(null,EventHub.VIEW_SIZE_CHANGED,data));
    }
  }
}
