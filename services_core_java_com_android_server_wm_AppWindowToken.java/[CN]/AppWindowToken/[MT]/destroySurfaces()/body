{
  final ArrayList<WindowState> allWindows=(ArrayList<WindowState>)allAppWindows.clone();
  final DisplayContentList displayList=new DisplayContentList();
  for (int i=allWindows.size() - 1; i >= 0; i--) {
    final WindowState win=allWindows.get(i);
    if (!win.mDestroying) {
      continue;
    }
    if (!mAppStopped && !win.mClientRemoveRequested) {
      continue;
    }
    win.destroyOrSaveSurface();
    if (win.mRemoveOnExit) {
      win.mExiting=false;
      service.removeWindowInnerLocked(win);
    }
    final DisplayContent displayContent=win.getDisplayContent();
    if (displayContent != null && !displayList.contains(displayContent)) {
      displayList.add(displayContent);
    }
    win.mDestroying=false;
  }
  for (int i=0; i < displayList.size(); i++) {
    final DisplayContent displayContent=displayList.get(i);
    service.mLayersController.assignLayersLocked(displayContent.getWindowList());
    displayContent.layoutNeeded=true;
  }
}
