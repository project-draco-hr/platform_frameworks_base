{
  final TileRecord r=new TileRecord();
  r.tile=tile;
  r.tileView=createTileView(tile);
  final QSTile.Callback callback=new QSTile.Callback(){
    @Override public void onStateChanged(    QSTile.State state){
      if (!r.openingDetail) {
        drawTile(r,state);
      }
    }
    @Override public void onShowDetail(    boolean show){
      QSPanel.this.showDetail(show,r);
    }
    @Override public void onToggleStateChanged(    boolean state){
      if (mDetailRecord == r) {
        fireToggleStateChanged(state);
      }
    }
    @Override public void onScanStateChanged(    boolean state){
      r.scanState=state;
      if (mDetailRecord == r) {
        fireScanStateChanged(r.scanState);
      }
    }
    @Override public void onAnnouncementRequested(    CharSequence announcement){
      announceForAccessibility(announcement);
    }
  }
;
  r.tile.setCallback(callback);
  final View.OnClickListener click=new View.OnClickListener(){
    @Override public void onClick(    View v){
      onTileClick(r.tile);
    }
  }
;
  final View.OnLongClickListener longClick=new View.OnLongClickListener(){
    @Override public boolean onLongClick(    View v){
      if (mCustomizePanel != null) {
        if (!mCustomizePanel.isCustomizing()) {
          int[] loc=new int[2];
          getLocationInWindow(loc);
          int x=r.tileView.getLeft() + r.tileView.getWidth() / 2 + loc[0];
          int y=r.tileView.getTop() + mTileLayout.getOffsetTop(r) + r.tileView.getHeight() / 2 + loc[1];
          mCustomizePanel.show(x,y);
        }
      }
 else {
        r.tile.longClick();
      }
      return true;
    }
  }
;
  r.tileView.init(click,longClick);
  r.tile.setListening(mListening);
  callback.onStateChanged(r.tile.getState());
  r.tile.refreshState();
  mRecords.add(r);
  if (mTileLayout != null) {
    mTileLayout.addTile(r);
  }
}
