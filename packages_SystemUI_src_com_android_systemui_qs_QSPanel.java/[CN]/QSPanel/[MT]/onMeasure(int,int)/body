{
  final int width=MeasureSpec.getSize(widthMeasureSpec);
  int r=-1;
  int c=-1;
  int rows=0;
  boolean rowIsDual=false;
  for (  TileRecord record : mRecords) {
    if (record.tileView.getVisibility() == GONE)     continue;
    if (r == -1 || c == (mColumns - 1) || rowIsDual != record.tile.supportsDualTargets()) {
      r++;
      c=0;
      rowIsDual=record.tile.supportsDualTargets();
    }
 else {
      c++;
    }
    record.row=r;
    record.col=c;
    rows=r + 1;
  }
  for (  TileRecord record : mRecords) {
    if (record.tileView.getVisibility() == GONE)     continue;
    record.tileView.setDual(record.tile.supportsDualTargets());
    final int cw=record.row == 0 ? mLargeCellWidth : mCellWidth;
    final int ch=record.row == 0 ? mLargeCellHeight : mCellHeight;
    record.tileView.measure(exactly(cw),exactly(ch));
  }
  int h=rows == 0 ? 0 : (getRowTop(rows) + mPanelPaddingBottom);
  mDetail.measure(exactly(width),unspecified());
  if (mDetail.getVisibility() == VISIBLE && mDetail.getChildCount() > 0) {
    final int dmh=mDetail.getMeasuredHeight();
    if (dmh > 0)     h=Math.max(h,dmh);
  }
  setMeasuredDimension(width,h);
}
