{
  if (bitmap.getConfig() == Bitmap.Config.ARGB_8888) {
    return bitmap;
  }
 else {
    Bitmap result=bitmap.copy(Bitmap.Config.ARGB_8888,false);
    if (result == null) {
      throw new RuntimeException("Error converting bitmap to RGBA!");
    }
 else     if (result.getRowBytes() != result.getWidth() * 4) {
      throw new RuntimeException("Unsupported row byte count in bitmap!");
    }
    return result;
  }
}
