{
  int width=r.getWidth();
  int height=r.getHeight();
  float result[][]=new float[width * height][nColorChannels];
  float normMultipliers[]=new float[nColorChannels];
  int pos=0;
  if (isTTypeIntegral) {
    for (int i=0; i < nColorChannels; i++) {
      normMultipliers[i]=channelMulipliers[i] / MAX_SHORT;
    }
    int sample;
    for (int row=r.getMinX(); row < width; row++) {
      for (int col=r.getMinY(); col < height; col++) {
        for (int chan=0; chan < nColorChannels; chan++) {
          sample=r.getSample(row,col,chan);
          result[pos][chan]=(sample * normMultipliers[chan]);
        }
        pos++;
      }
    }
  }
 else {
    for (int row=r.getMinX(); row < width; row++) {
      for (int col=r.getMinY(); col < height; col++) {
        for (int chan=0; chan < nColorChannels; chan++) {
          result[pos][chan]=r.getSampleFloat(row,col,chan);
        }
        pos++;
      }
    }
  }
  return result;
}
