{
  int width=r.getWidth();
  int height=r.getHeight();
  short result[]=new short[width * height * nColorChannels];
  int pos=0;
  if (isTTypeIntegral) {
    int sample;
    for (int row=r.getMinX(); row < width; row++) {
      for (int col=r.getMinY(); col < height; col++) {
        for (int chan=0; chan < nColorChannels; chan++) {
          sample=r.getSample(row,col,chan);
          result[pos++]=(short)(sample * channelMulipliers[chan] + 0.5f);
        }
      }
    }
  }
 else {
    float sample;
    for (int row=r.getMinX(); row < width; row++) {
      for (int col=r.getMinY(); col < height; col++) {
        for (int chan=0; chan < nColorChannels; chan++) {
          sample=r.getSampleFloat(row,col,chan);
          result[pos++]=(short)((sample - channelMinValues[chan]) * channelMulipliers[chan] + 0.5f);
        }
      }
    }
  }
  return result;
}
