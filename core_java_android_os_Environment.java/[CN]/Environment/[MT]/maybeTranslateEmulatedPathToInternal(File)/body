{
  if (!Environment.isExternalStorageEmulated() || CANONCIAL_EMULATED_STORAGE_TARGET == null) {
    return path;
  }
  try {
    final String rawPath=path.getCanonicalPath();
    if (rawPath.startsWith(CANONCIAL_EMULATED_STORAGE_TARGET)) {
      final File internalPath=new File(DIR_MEDIA_STORAGE,rawPath.substring(CANONCIAL_EMULATED_STORAGE_TARGET.length()));
      if (internalPath.exists()) {
        return internalPath;
      }
    }
  }
 catch (  IOException e) {
    Log.w(TAG,"Failed to resolve canonical path for " + path);
  }
  return path;
}
