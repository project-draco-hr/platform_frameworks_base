{
  final String rawPath;
  try {
    rawPath=path.getCanonicalPath();
  }
 catch (  IOException e) {
    Log.w(TAG,"Failed to resolve target path: " + e);
    return Environment.MEDIA_UNKNOWN;
  }
  try {
    final IMountService mountService=IMountService.Stub.asInterface(ServiceManager.getService("mount"));
    final StorageVolume[] volumes=mountService.getVolumeList();
    for (    StorageVolume volume : volumes) {
      if (rawPath.startsWith(volume.getPath())) {
        return mountService.getVolumeState(volume.getPath());
      }
    }
  }
 catch (  RemoteException e) {
    Log.w(TAG,"Failed to find external storage state: " + e);
  }
  return Environment.MEDIA_UNKNOWN;
}
