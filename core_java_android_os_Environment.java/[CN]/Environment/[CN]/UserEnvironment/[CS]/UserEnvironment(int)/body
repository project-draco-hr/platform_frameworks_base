{
  String rawExternalStorage=System.getenv(ENV_EXTERNAL_STORAGE);
  String rawEmulatedSource=System.getenv(ENV_EMULATED_STORAGE_SOURCE);
  String rawEmulatedTarget=System.getenv(ENV_EMULATED_STORAGE_TARGET);
  String rawMediaStorage=System.getenv(ENV_MEDIA_STORAGE);
  if (TextUtils.isEmpty(rawMediaStorage)) {
    rawMediaStorage="/data/media";
  }
  ArrayList<File> externalForVold=Lists.newArrayList();
  ArrayList<File> externalForApp=Lists.newArrayList();
  if (!TextUtils.isEmpty(rawEmulatedTarget)) {
    final String rawUserId=Integer.toString(userId);
    final File emulatedSourceBase=new File(rawEmulatedSource);
    final File emulatedTargetBase=new File(rawEmulatedTarget);
    final File mediaBase=new File(rawMediaStorage);
    externalForVold.add(buildPath(emulatedSourceBase,rawUserId));
    externalForApp.add(buildPath(emulatedTargetBase,rawUserId));
    mEmulatedDirForDirect=buildPath(mediaBase,rawUserId);
  }
 else {
    if (TextUtils.isEmpty(rawExternalStorage)) {
      Log.w(TAG,"EXTERNAL_STORAGE undefined; falling back to default");
      rawExternalStorage="/storage/sdcard0";
    }
    externalForVold.add(new File(rawExternalStorage));
    externalForApp.add(new File(rawExternalStorage));
    mEmulatedDirForDirect=new File(rawMediaStorage);
  }
  final String rawSecondaryStorage=System.getenv(ENV_SECONDARY_STORAGE);
  if (!TextUtils.isEmpty(rawSecondaryStorage) && userId == UserHandle.USER_OWNER) {
    for (    String secondaryPath : rawSecondaryStorage.split(":")) {
      externalForVold.add(new File(secondaryPath));
      externalForApp.add(new File(secondaryPath));
    }
  }
  mExternalDirsForVold=externalForVold.toArray(new File[externalForVold.size()]);
  mExternalDirsForApp=externalForApp.toArray(new File[externalForApp.size()]);
}
