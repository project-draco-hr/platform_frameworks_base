{
  String rawExternalStorage=System.getenv(ENV_EXTERNAL_STORAGE);
  String rawEmulatedSource=System.getenv(ENV_EMULATED_STORAGE_SOURCE);
  String rawEmulatedTarget=System.getenv(ENV_EMULATED_STORAGE_TARGET);
  String rawMediaStorage=System.getenv(ENV_MEDIA_STORAGE);
  if (TextUtils.isEmpty(rawMediaStorage)) {
    rawMediaStorage="/data/media";
  }
  if (!TextUtils.isEmpty(rawEmulatedTarget)) {
    final String rawUserId=Integer.toString(userId);
    final File emulatedSourceBase=new File(rawEmulatedSource);
    final File emulatedTargetBase=new File(rawEmulatedTarget);
    final File mediaBase=new File(rawMediaStorage);
    mExternalDirsForVold=new File[]{buildPath(emulatedSourceBase,rawUserId)};
    mExternalDirsForApp=new File[]{buildPath(emulatedTargetBase,rawUserId)};
    mEmulatedDirForDirect=buildPath(mediaBase,rawUserId);
  }
 else {
    if (TextUtils.isEmpty(rawExternalStorage)) {
      Log.w(TAG,"EXTERNAL_STORAGE undefined; falling back to default");
      rawExternalStorage="/storage/sdcard0";
    }
    mExternalDirsForVold=new File[]{new File(rawExternalStorage)};
    mExternalDirsForApp=new File[]{new File(rawExternalStorage)};
    mEmulatedDirForDirect=new File(rawMediaStorage);
  }
}
