{
  ColorStateList colorStateList=span.getTextColor();
  if (colorStateList != null) {
    int[] colors=colorStateList.getColors();
    boolean changed=false;
    for (int i=0; i < colors.length; i++) {
      if (ImageUtils.isGrayscale(colors[i])) {
        if (!changed) {
          colors=Arrays.copyOf(colors,colors.length);
        }
        colors[i]=processColor(colors[i]);
        changed=true;
      }
    }
    if (changed) {
      return new TextAppearanceSpan(span.getFamily(),span.getTextStyle(),span.getTextSize(),new ColorStateList(colorStateList.getStates(),colors),span.getLinkTextColor());
    }
  }
  return span;
}
