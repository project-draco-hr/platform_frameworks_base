{
  TaskStack newStack=null;
  if (DEBUG_STACK)   Slog.d(TAG,"createStack: stackId=" + stackId + " relativeStackBoxId="+ relativeStackBoxId+ " position="+ position+ " weight="+ weight);
  if (mStackBoxes.isEmpty()) {
    if (stackId != HOME_STACK_ID) {
      throw new IllegalArgumentException("createStack: First stackId not " + HOME_STACK_ID);
    }
    StackBox newBox=new StackBox(service,this,null);
    mStackBoxes.add(newBox);
    newStack=new TaskStack(service,stackId,this);
    newStack.mStackBox=newBox;
    newBox.mStack=newStack;
    mHomeStack=newStack;
  }
 else {
    int stackBoxNdx;
    for (stackBoxNdx=mStackBoxes.size() - 1; stackBoxNdx >= 0; --stackBoxNdx) {
      final StackBox box=mStackBoxes.get(stackBoxNdx);
      if (position == StackBox.TASK_STACK_GOES_OVER || position == StackBox.TASK_STACK_GOES_UNDER) {
        if (box.contains(relativeStackBoxId)) {
          StackBox newBox=new StackBox(service,this,null);
          newStack=new TaskStack(service,stackId,this);
          newStack.mStackBox=newBox;
          newBox.mStack=newStack;
          final int offset=position == StackBox.TASK_STACK_GOES_OVER ? 1 : 0;
          if (DEBUG_STACK)           Slog.d(TAG,"createStack: inserting stack at " + (stackBoxNdx + offset));
          mStackBoxes.add(stackBoxNdx + offset,newBox);
          break;
        }
      }
 else {
        newStack=box.split(stackId,relativeStackBoxId,position,weight);
        if (newStack != null) {
          break;
        }
      }
    }
    if (stackBoxNdx < 0) {
      throw new IllegalArgumentException("createStack: stackBoxId " + relativeStackBoxId + " not found.");
    }
  }
  if (newStack != null) {
    layoutNeeded=true;
  }
  return newStack;
}
