{
  if (DBG) {
    Log.d(LOG_TAG,"--- up:");
  }
  Layout layout=widget.getLayout();
  int end=getEndPos(widget);
  int line=layout.getLineForOffset(end);
  if (line > 0) {
    int to;
    if (layout.getParagraphDirection(line) == layout.getParagraphDirection(line - 1)) {
      float h=layout.getPrimaryHorizontal(end);
      to=layout.getOffsetForHorizontal(line - 1,h);
    }
 else {
      to=layout.getLineStart(line - 1);
    }
    mManager.setSelectedEndPos(to);
    mManager.onCursorMoved();
    return true;
  }
  return false;
}
