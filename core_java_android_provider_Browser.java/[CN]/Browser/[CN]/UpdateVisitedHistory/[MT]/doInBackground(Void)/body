{
  Cursor c=null;
  try {
    c=getVisitedLike(mContentResolver,mUrl);
    if (c.moveToFirst()) {
      ContentValues map=new ContentValues();
      if (mReal) {
        map.put(BookmarkColumns.VISITS,c.getInt(HISTORY_PROJECTION_VISITS_INDEX) + 1);
      }
 else {
        map.put(BookmarkColumns.USER_ENTERED,1);
      }
      map.put(BookmarkColumns.DATE,mNow);
      String[] projection=new String[]{Integer.valueOf(c.getInt(0)).toString()};
      mContentResolver.update(BOOKMARKS_URI,map,"_id = ?",projection);
    }
 else {
      truncateHistory(mContentResolver);
      ContentValues map=new ContentValues();
      int visits;
      int user_entered;
      if (mReal) {
        visits=1;
        user_entered=0;
      }
 else {
        visits=0;
        user_entered=1;
      }
      map.put(BookmarkColumns.URL,mUrl);
      map.put(BookmarkColumns.VISITS,visits);
      map.put(BookmarkColumns.DATE,mNow);
      map.put(BookmarkColumns.BOOKMARK,0);
      map.put(BookmarkColumns.TITLE,mUrl);
      map.put(BookmarkColumns.CREATED,0);
      map.put(BookmarkColumns.USER_ENTERED,user_entered);
      mContentResolver.insert(BOOKMARKS_URI,map);
    }
  }
 catch (  IllegalStateException e) {
    Log.e(LOGTAG,"updateVisitedHistory",e);
  }
 finally {
    if (c != null)     c.close();
  }
  return null;
}
