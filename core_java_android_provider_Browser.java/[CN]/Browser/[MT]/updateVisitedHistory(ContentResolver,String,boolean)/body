{
  long now=new Date().getTime();
  try {
    StringBuilder sb=new StringBuilder(BookmarkColumns.URL + " = ");
    DatabaseUtils.appendEscapedSQLString(sb,url);
    Cursor c=cr.query(BOOKMARKS_URI,HISTORY_PROJECTION,sb.toString(),null,null);
    if (c.moveToFirst()) {
      ContentValues map=new ContentValues();
      if (real) {
        map.put(BookmarkColumns.VISITS,c.getInt(HISTORY_PROJECTION_VISITS_INDEX) + 1);
      }
 else {
        map.put(BookmarkColumns.USER_ENTERED,1);
      }
      map.put(BookmarkColumns.DATE,now);
      cr.update(BOOKMARKS_URI,map,"_id = " + c.getInt(0),null);
    }
 else {
      truncateHistory(cr);
      ContentValues map=new ContentValues();
      int visits;
      int user_entered;
      if (real) {
        visits=1;
        user_entered=0;
      }
 else {
        visits=0;
        user_entered=1;
      }
      map.put(BookmarkColumns.URL,url);
      map.put(BookmarkColumns.VISITS,visits);
      map.put(BookmarkColumns.DATE,now);
      map.put(BookmarkColumns.BOOKMARK,0);
      map.put(BookmarkColumns.TITLE,url);
      map.put(BookmarkColumns.CREATED,0);
      map.put(BookmarkColumns.USER_ENTERED,user_entered);
      cr.insert(BOOKMARKS_URI,map);
    }
    c.deactivate();
  }
 catch (  IllegalStateException e) {
    return;
  }
}
