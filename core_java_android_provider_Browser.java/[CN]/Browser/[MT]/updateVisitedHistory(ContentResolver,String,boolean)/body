{
  long now=System.currentTimeMillis();
  Cursor c=null;
  try {
    c=getVisitedLike(cr,url);
    if (c.moveToFirst()) {
      ContentValues map=new ContentValues();
      if (real) {
        map.put(BookmarkColumns.VISITS,c.getInt(HISTORY_PROJECTION_VISITS_INDEX) + 1);
      }
 else {
        map.put(BookmarkColumns.USER_ENTERED,1);
      }
      map.put(BookmarkColumns.DATE,now);
      String[] projection=new String[]{Integer.valueOf(c.getInt(0)).toString()};
      cr.update(BOOKMARKS_URI,map,"_id = ?",projection);
    }
 else {
      truncateHistory(cr);
      ContentValues map=new ContentValues();
      int visits;
      int user_entered;
      if (real) {
        visits=1;
        user_entered=0;
      }
 else {
        visits=0;
        user_entered=1;
      }
      map.put(BookmarkColumns.URL,url);
      map.put(BookmarkColumns.VISITS,visits);
      map.put(BookmarkColumns.DATE,now);
      map.put(BookmarkColumns.BOOKMARK,0);
      map.put(BookmarkColumns.TITLE,url);
      map.put(BookmarkColumns.CREATED,0);
      map.put(BookmarkColumns.USER_ENTERED,user_entered);
      cr.insert(BOOKMARKS_URI,map);
    }
  }
 catch (  IllegalStateException e) {
    Log.e(LOGTAG,"updateVisitedHistory",e);
  }
 finally {
    if (c != null)     c.close();
  }
}
