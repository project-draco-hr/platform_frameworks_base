{
  try {
    IBinder b=ServiceManager.getService(USB_SERVICE);
    IUsbManager service=IUsbManager.Stub.asInterface(b);
    int uid=ri.activityInfo.applicationInfo.uid;
    String action=intent.getAction();
    if (UsbManager.ACTION_USB_DEVICE_ATTACHED.equals(action)) {
      UsbDevice device=(UsbDevice)intent.getParcelableExtra(UsbManager.EXTRA_DEVICE);
      service.grantDevicePermission(device,uid);
      if (alwaysCheck) {
        service.setDevicePackage(device,ri.activityInfo.packageName);
      }
 else {
        service.setDevicePackage(device,null);
      }
    }
 else     if (UsbManager.ACTION_USB_ACCESSORY_ATTACHED.equals(action)) {
      UsbAccessory accessory=(UsbAccessory)intent.getParcelableExtra(UsbManager.EXTRA_ACCESSORY);
      service.grantAccessoryPermission(accessory,uid);
      if (alwaysCheck) {
        service.setAccessoryPackage(accessory,ri.activityInfo.packageName);
      }
 else {
        service.setAccessoryPackage(accessory,null);
      }
    }
    try {
      startActivity(intent);
    }
 catch (    ActivityNotFoundException e) {
      Log.e(TAG,"startActivity failed",e);
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"onIntentSelected failed",e);
  }
}
