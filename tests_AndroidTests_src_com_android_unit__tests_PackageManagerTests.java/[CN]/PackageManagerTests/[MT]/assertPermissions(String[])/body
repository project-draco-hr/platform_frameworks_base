{
  final PackageManager pm=getPm();
  String pkg=null;
  PackageInfo pkgInfo=null;
  String mode=PERM_DEFINED;
  int i=0;
  while (i < cmds.length) {
    String cmd=cmds[i++];
    if (cmd == PERM_PACKAGE) {
      pkg=cmds[i++];
      try {
        pkgInfo=pm.getPackageInfo(pkg,PackageManager.GET_PERMISSIONS | PackageManager.GET_UNINSTALLED_PACKAGES);
      }
 catch (      NameNotFoundException e) {
        pkgInfo=null;
      }
    }
 else     if (cmd == PERM_DEFINED || cmd == PERM_UNDEFINED || cmd == PERM_USED || cmd == PERM_NOTUSED) {
      mode=cmds[i++];
    }
 else {
      if (mode == PERM_DEFINED) {
        try {
          PermissionInfo pi=pm.getPermissionInfo(cmd,0);
          assertNotNull(pi);
          assertEquals(pi.packageName,pkg);
          assertEquals(pi.name,cmd);
          assertNotNull(pkgInfo);
          boolean found=false;
          for (int j=0; j < pkgInfo.permissions.length && !found; j++) {
            if (pkgInfo.permissions[j].name.equals(cmd)) {
              found=true;
            }
          }
          if (!found) {
            fail("Permission not found: " + cmd);
          }
        }
 catch (        NameNotFoundException e) {
          throw new RuntimeException(e);
        }
      }
 else       if (mode == PERM_UNDEFINED) {
        try {
          pm.getPermissionInfo(cmd,0);
          throw new RuntimeException("Permission exists: " + cmd);
        }
 catch (        NameNotFoundException e) {
        }
        if (pkgInfo != null) {
          boolean found=false;
          for (int j=0; j < pkgInfo.permissions.length && !found; j++) {
            if (pkgInfo.permissions[j].name.equals(cmd)) {
              found=true;
            }
          }
          if (found) {
            fail("Permission still exists: " + cmd);
          }
        }
      }
 else       if (mode == PERM_USED || mode == PERM_NOTUSED) {
        boolean found=false;
        for (int j=0; j < pkgInfo.requestedPermissions.length && !found; j++) {
          if (pkgInfo.requestedPermissions[j].equals(cmd)) {
            found=true;
          }
        }
        if (!found) {
          fail("Permission not requested: " + cmd);
        }
        if (mode == PERM_USED) {
          if (pm.checkPermission(cmd,pkg) != PackageManager.PERMISSION_GRANTED) {
            fail("Permission not granted: " + cmd);
          }
        }
 else {
          if (pm.checkPermission(cmd,pkg) != PackageManager.PERMISSION_DENIED) {
            fail("Permission granted: " + cmd);
          }
        }
      }
    }
  }
}
