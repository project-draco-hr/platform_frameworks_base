{
  File filesDir=mContext.getFilesDir();
  File outFile=new File(filesDir,outFileName);
  Uri packageURI=getInstallablePackage(rawResId,outFile);
  PackageParser.Package pkg=parsePackage(packageURI);
  assertNotNull(pkg);
  InstallParams ip=null;
  getPm().deletePackage(pkg.packageName,null,0);
  clearSecureContainersForPkg(pkg.packageName);
  try {
    try {
      if (fail) {
        assertTrue(invokeInstallPackageFail(packageURI,flags,pkg.packageName,result));
        assertNotInstalled(pkg.packageName);
      }
 else {
        InstallReceiver receiver=new InstallReceiver(pkg.packageName);
        assertTrue(invokeInstallPackage(packageURI,flags,pkg.packageName,receiver));
        assertInstall(pkg,flags,expInstallLocation);
        ip=new InstallParams(pkg,outFileName,packageURI);
      }
    }
 catch (    Exception e) {
      failStr("Failed with exception : " + e);
    }
    return ip;
  }
  finally {
    if (cleanUp) {
      cleanUpInstall(ip);
    }
  }
}
