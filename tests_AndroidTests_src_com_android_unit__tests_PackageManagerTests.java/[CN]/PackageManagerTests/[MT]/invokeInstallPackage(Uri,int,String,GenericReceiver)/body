{
  PackageInstallObserver observer=new PackageInstallObserver();
  final boolean received=false;
  mContext.registerReceiver(receiver,receiver.filter);
  final boolean DEBUG=true;
  try {
synchronized (observer) {
synchronized (receiver) {
        getPm().installPackage(packageURI,observer,flags,null);
        long waitTime=0;
        while ((!observer.isDone()) && (waitTime < MAX_WAIT_TIME)) {
          observer.wait(WAIT_TIME_INCR);
          waitTime+=WAIT_TIME_INCR;
        }
        if (!observer.isDone()) {
          throw new Exception("Timed out waiting for packageInstalled callback");
        }
        if (observer.returnCode != PackageManager.INSTALL_SUCCEEDED) {
          Log.i(TAG,"Failed to install with error code = " + observer.returnCode);
          return false;
        }
        waitTime=0;
        while ((!receiver.isDone()) && (waitTime < MAX_WAIT_TIME)) {
          receiver.wait(WAIT_TIME_INCR);
          waitTime+=WAIT_TIME_INCR;
        }
        if (!receiver.isDone()) {
          throw new Exception("Timed out waiting for PACKAGE_ADDED notification");
        }
        return receiver.received;
      }
    }
  }
  finally {
    mContext.unregisterReceiver(receiver);
  }
}
