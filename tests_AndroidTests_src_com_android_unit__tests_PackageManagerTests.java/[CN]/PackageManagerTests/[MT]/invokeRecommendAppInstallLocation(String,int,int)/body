{
  int origSetting=Settings.System.getInt(mContext.getContentResolver(),Settings.System.SET_INSTALL_LOCATION,0);
  try {
    Settings.System.putInt(mContext.getContentResolver(),Settings.System.SET_INSTALL_LOCATION,0);
    File filesDir=mContext.getFilesDir();
    File outFile=new File(filesDir,outFileName);
    Uri packageURI=getInstallablePackage(fileResId,outFile);
    PackageParser.Package pkg=parsePackage(packageURI);
    assertNotNull(pkg);
    int installLoc=getPm().recommendAppInstallLocation(pkg);
    Log.i(TAG,"expected=" + expected + ", installLoc="+ installLoc);
    boolean onFlash=(installLoc & PackageManager.INSTALL_ON_INTERNAL_FLASH) != 0;
    boolean onSd=(installLoc & PackageManager.INSTALL_ON_SDCARD) != 0;
    boolean expOnFlash=(expected & PackageManager.INSTALL_ON_INTERNAL_FLASH) != 0;
    boolean expOnSd=(expected & PackageManager.INSTALL_ON_SDCARD) != 0;
    assertTrue(expOnFlash == onFlash || expOnSd == onSd);
  }
  finally {
    Settings.System.putInt(mContext.getContentResolver(),Settings.System.SET_INSTALL_LOCATION,origSetting);
  }
}
