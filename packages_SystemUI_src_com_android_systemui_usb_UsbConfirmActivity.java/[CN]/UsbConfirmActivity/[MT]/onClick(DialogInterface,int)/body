{
  if (which == AlertDialog.BUTTON_POSITIVE) {
    try {
      IBinder b=ServiceManager.getService(USB_SERVICE);
      IUsbManager service=IUsbManager.Stub.asInterface(b);
      int uid=mResolveInfo.activityInfo.applicationInfo.uid;
      boolean alwaysUse=mAlwaysUse.isChecked();
      Intent intent=null;
      if (mDevice != null) {
        intent=new Intent(UsbManager.ACTION_USB_DEVICE_ATTACHED);
        intent.putExtra(UsbManager.EXTRA_DEVICE,mDevice);
        service.grantDevicePermission(mDevice,uid);
        if (alwaysUse) {
          service.setDevicePackage(mDevice,mResolveInfo.activityInfo.packageName);
        }
 else {
          service.setDevicePackage(mDevice,null);
        }
      }
 else       if (mAccessory != null) {
        intent=new Intent(UsbManager.ACTION_USB_ACCESSORY_ATTACHED);
        intent.putExtra(UsbManager.EXTRA_ACCESSORY,mAccessory);
        service.grantAccessoryPermission(mAccessory,uid);
        if (alwaysUse) {
          service.setAccessoryPackage(mAccessory,mResolveInfo.activityInfo.packageName);
        }
 else {
          service.setAccessoryPackage(mAccessory,null);
        }
      }
      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
      intent.setComponent(new ComponentName(mResolveInfo.activityInfo.packageName,mResolveInfo.activityInfo.name));
      startActivity(intent);
    }
 catch (    Exception e) {
      Log.e(TAG,"Unable to start activity",e);
    }
  }
  finish();
}
