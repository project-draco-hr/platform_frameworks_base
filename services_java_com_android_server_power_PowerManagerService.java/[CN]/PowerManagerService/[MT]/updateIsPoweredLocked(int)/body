{
  if ((dirty & DIRTY_BATTERY_STATE) != 0) {
    final boolean wasPowered=mIsPowered;
    final int oldPlugType=mPlugType;
    mIsPowered=mBatteryService.isPowered(BatteryManager.BATTERY_PLUGGED_ANY);
    mPlugType=mBatteryService.getPlugType();
    if (DEBUG) {
      Slog.d(TAG,"updateIsPoweredLocked: wasPowered=" + wasPowered + ", mIsPowered="+ mIsPowered+ ", oldPlugType="+ oldPlugType+ ", mPlugType="+ mPlugType);
    }
    if (wasPowered != mIsPowered || oldPlugType != mPlugType) {
      mDirty|=DIRTY_IS_POWERED;
      final long now=SystemClock.uptimeMillis();
      if (shouldWakeUpWhenPluggedOrUnpluggedLocked(wasPowered,oldPlugType)) {
        wakeUpNoUpdateLocked(now);
      }
      userActivityNoUpdateLocked(now,PowerManager.USER_ACTIVITY_EVENT_OTHER,0,Process.SYSTEM_UID);
    }
  }
}
