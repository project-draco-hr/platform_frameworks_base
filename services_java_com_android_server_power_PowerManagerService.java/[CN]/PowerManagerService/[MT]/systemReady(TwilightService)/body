{
synchronized (mLock) {
    mSystemReady=true;
    PowerManager pm=(PowerManager)mContext.getSystemService(Context.POWER_SERVICE);
    mScreenBrightnessSettingMinimum=pm.getMinimumScreenBrightnessSetting();
    mScreenBrightnessSettingMaximum=pm.getMaximumScreenBrightnessSetting();
    mScreenBrightnessSettingDefault=pm.getDefaultScreenBrightnessSetting();
    mNotifier=new Notifier(mHandler.getLooper(),mContext,mBatteryStats,createSuspendBlockerLocked("PowerManagerService.Broadcasts"),mPolicy,mScreenOnListener);
    mDisplayPowerController=new DisplayPowerController(mHandler.getLooper(),mContext,mNotifier,mLightsService,twilight,createSuspendBlockerLocked("PowerManagerService.Display"),mDisplayPowerControllerCallbacks,mHandler);
    mSettingsObserver=new SettingsObserver(mHandler);
    mAttentionLight=mLightsService.getLight(LightsService.LIGHT_ID_ATTENTION);
    IntentFilter filter=new IntentFilter();
    filter.addAction(Intent.ACTION_BATTERY_CHANGED);
    mContext.registerReceiver(new BatteryReceiver(),filter);
    filter=new IntentFilter();
    filter.addAction(Intent.ACTION_BOOT_COMPLETED);
    mContext.registerReceiver(new BootCompletedReceiver(),filter);
    filter=new IntentFilter();
    filter.addAction(Intent.ACTION_DOCK_EVENT);
    mContext.registerReceiver(new DockReceiver(),filter);
    filter=new IntentFilter();
    filter.addAction(Dream.ACTION_DREAMING_STOPPED);
    mContext.registerReceiver(new DreamReceiver(),filter);
    final ContentResolver resolver=mContext.getContentResolver();
    resolver.registerContentObserver(Settings.Secure.getUriFor(Settings.Secure.SCREENSAVER_ENABLED),false,mSettingsObserver);
    resolver.registerContentObserver(Settings.Secure.getUriFor(Settings.Secure.SCREENSAVER_ACTIVATE_ON_SLEEP),false,mSettingsObserver);
    resolver.registerContentObserver(Settings.System.getUriFor(Settings.System.SCREEN_OFF_TIMEOUT),false,mSettingsObserver);
    resolver.registerContentObserver(Settings.Global.getUriFor(Settings.Global.STAY_ON_WHILE_PLUGGED_IN),false,mSettingsObserver);
    resolver.registerContentObserver(Settings.System.getUriFor(Settings.System.SCREEN_BRIGHTNESS),false,mSettingsObserver);
    resolver.registerContentObserver(Settings.System.getUriFor(Settings.System.SCREEN_BRIGHTNESS_MODE),false,mSettingsObserver);
    readConfigurationLocked();
    updateSettingsLocked();
    mDirty|=DIRTY_BATTERY_STATE;
    updatePowerStateLocked();
  }
}
