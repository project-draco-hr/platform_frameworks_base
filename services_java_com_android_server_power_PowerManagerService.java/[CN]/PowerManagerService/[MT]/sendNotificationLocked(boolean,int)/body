{
  if (!mInitialized) {
    return;
  }
  if (DEBUG_SCREEN_ON) {
    RuntimeException here=new RuntimeException("here");
    here.fillInStackTrace();
    Slog.i(TAG,"sendNotificationLocked: " + on,here);
  }
  if (!on) {
    mStillNeedSleepNotification=false;
  }
  int index=0;
  while (mBroadcastQueue[index] != -1) {
    index++;
  }
  mBroadcastQueue[index]=on ? 1 : 0;
  mBroadcastWhy[index]=why;
  if (index == 2) {
    if (!on && mBroadcastWhy[0] > why) {
      mBroadcastWhy[0]=why;
    }
    mBroadcastQueue[0]=on ? 1 : 0;
    mBroadcastQueue[1]=-1;
    mBroadcastQueue[2]=-1;
    EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_STOP,1,mBroadcastWakeLock.mCount);
    mBroadcastWakeLock.release();
    EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_STOP,1,mBroadcastWakeLock.mCount);
    mBroadcastWakeLock.release();
    index=0;
  }
  if (index == 1 && !on) {
    mBroadcastQueue[0]=-1;
    mBroadcastQueue[1]=-1;
    index=-1;
    EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_STOP,1,mBroadcastWakeLock.mCount);
    mBroadcastWakeLock.release();
  }
  if (mSkippedScreenOn) {
    updateLightsLocked(mPowerState,SCREEN_ON_BIT);
  }
  if (index >= 0) {
    mBroadcastWakeLock.acquire();
    EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_SEND,mBroadcastWakeLock.mCount);
    mHandler.post(mNotificationTask);
  }
}
