{
  final FragmentManager fm=getFragmentManager();
  final RootInfo root=getCurrentRoot();
  final DocumentInfo cwd=getCurrentDirectory();
  mDirectoryContainer.setDrawDisappearingFirst(anim == ANIM_DOWN);
  if (cwd == null) {
    if (mState.action == ACTION_CREATE || mState.action == ACTION_OPEN_TREE || mState.action == ACTION_OPEN_COPY_DESTINATION) {
      RecentsCreateFragment.show(fm);
    }
 else {
      DirectoryFragment.showRecentsOpen(fm,anim);
      final boolean visualMimes=MimePredicate.mimeMatches(MimePredicate.VISUAL_MIMES,mState.acceptMimes);
      mState.userMode=visualMimes ? MODE_GRID : MODE_LIST;
      mState.derivedMode=mState.userMode;
    }
  }
 else {
    if (mState.currentSearch != null) {
      DirectoryFragment.showSearch(fm,root,mState.currentSearch,anim);
    }
 else {
      DirectoryFragment.showNormal(fm,root,cwd,anim);
    }
  }
  if (mState.action == ACTION_CREATE) {
    final SaveFragment save=SaveFragment.get(fm);
    if (save != null) {
      save.setReplaceTarget(null);
    }
  }
  if (mState.action == ACTION_OPEN_TREE || mState.action == ACTION_OPEN_COPY_DESTINATION) {
    final PickFragment pick=PickFragment.get(fm);
    if (pick != null) {
      final CharSequence displayName=(mState.stack.size() <= 1) ? root.title : cwd.displayName;
      pick.setPickTarget(mState.action,cwd,displayName);
    }
  }
  final RootsFragment roots=RootsFragment.get(fm);
  if (roots != null) {
    roots.onCurrentRootChanged();
  }
  updateActionBar();
  invalidateOptionsMenu();
  dumpStack();
}
