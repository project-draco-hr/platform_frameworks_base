{
  State state=buildDefaultState();
  final Intent intent=getIntent();
  final String action=intent.getAction();
  if (Intent.ACTION_OPEN_DOCUMENT.equals(action)) {
    state.action=ACTION_OPEN;
  }
 else   if (Intent.ACTION_CREATE_DOCUMENT.equals(action)) {
    state.action=ACTION_CREATE;
  }
 else   if (Intent.ACTION_GET_CONTENT.equals(action)) {
    state.action=ACTION_GET_CONTENT;
  }
 else   if (Intent.ACTION_OPEN_DOCUMENT_TREE.equals(action)) {
    state.action=ACTION_OPEN_TREE;
  }
 else   if (Shared.ACTION_PICK_COPY_DESTINATION.equals(action)) {
    state.action=ACTION_PICK_COPY_DESTINATION;
  }
  if (state.action == ACTION_OPEN || state.action == ACTION_GET_CONTENT) {
    state.allowMultiple=intent.getBooleanExtra(Intent.EXTRA_ALLOW_MULTIPLE,false);
  }
  if (state.action == ACTION_OPEN || state.action == ACTION_GET_CONTENT || state.action == ACTION_CREATE) {
    state.openableOnly=intent.hasCategory(Intent.CATEGORY_OPENABLE);
  }
  if (state.action == ACTION_PICK_COPY_DESTINATION) {
    state.directoryCopy=intent.getBooleanExtra(Shared.EXTRA_DIRECTORY_COPY,false);
    state.transferMode=intent.getIntExtra(CopyService.EXTRA_TRANSFER_MODE,CopyService.TRANSFER_MODE_COPY);
  }
  return state;
}
