{
  super.onCreate(icicle);
  final Resources res=getResources();
  mShowAsDialog=res.getBoolean(R.bool.show_as_dialog) && mState.action != ACTION_BROWSE;
  if (!mShowAsDialog) {
    setTheme(R.style.DocumentsNonDialogTheme);
  }
  final Context context=this;
  if (mShowAsDialog) {
    mDrawer=DrawerController.createDummy();
    final WindowManager.LayoutParams a=getWindow().getAttributes();
    final Point size=new Point();
    getWindowManager().getDefaultDisplay().getSize(size);
    a.width=(int)res.getFraction(R.dimen.dialog_width,size.x,size.x);
    getWindow().setAttributes(a);
  }
 else {
    mDrawer=DrawerController.create(this);
  }
  mDirectoryContainer=(DirectoryContainerView)findViewById(R.id.container_directory);
  mToolbar=(Toolbar)findViewById(R.id.toolbar);
  mStackAdapter=new StackAdapter();
  mStackListener=new ItemSelectedListener();
  mToolbarStack=(Spinner)findViewById(R.id.stack);
  mToolbarStack.setOnItemSelectedListener(mStackListener);
  mRootsToolbar=(Toolbar)findViewById(R.id.roots_toolbar);
  setActionBar(mToolbar);
  if (mState.action == ACTION_BROWSE) {
    mDrawer.lockClosed();
    if (mShowAsDialog) {
      findViewById(R.id.container_roots).setVisibility(View.GONE);
    }
  }
  if (mState.action == ACTION_CREATE) {
    final String mimeType=getIntent().getType();
    final String title=getIntent().getStringExtra(Intent.EXTRA_TITLE);
    SaveFragment.show(getFragmentManager(),mimeType,title);
  }
 else   if (mState.action == ACTION_OPEN_TREE || mState.action == ACTION_OPEN_COPY_DESTINATION) {
    PickFragment.show(getFragmentManager());
  }
  if (mState.action == ACTION_GET_CONTENT) {
    final Intent moreApps=new Intent(getIntent());
    moreApps.setComponent(null);
    moreApps.setPackage(null);
    RootsFragment.show(getFragmentManager(),moreApps);
  }
 else   if (mState.action == ACTION_OPEN || mState.action == ACTION_CREATE || mState.action == ACTION_OPEN_TREE || mState.action == ACTION_OPEN_COPY_DESTINATION) {
    RootsFragment.show(getFragmentManager(),null);
  }
  if (!mState.restored) {
    setTitle("");
    if (mState.action == ACTION_BROWSE) {
      final Uri rootUri=getIntent().getData();
      new RestoreRootTask(rootUri).executeOnExecutor(getCurrentExecutor());
    }
 else {
      new RestoreStackTask().execute();
    }
  }
 else {
    onCurrentDirectoryChanged(ANIM_NONE);
  }
}
