{
  super.onCreate(icicle);
  final Intent intent=getIntent();
  final String action=intent.getAction();
  if (Intent.ACTION_OPEN_DOCUMENT.equals(action)) {
    mAction=ACTION_OPEN;
    mDisplayState.allowMultiple=intent.getBooleanExtra(Intent.EXTRA_ALLOW_MULTIPLE,false);
  }
 else   if (Intent.ACTION_CREATE_DOCUMENT.equals(action)) {
    mAction=ACTION_CREATE;
    mDisplayState.allowMultiple=false;
  }
  if (intent.hasExtra(Intent.EXTRA_MIME_TYPES)) {
    mAcceptMimes=intent.getStringArrayExtra(Intent.EXTRA_MIME_TYPES);
  }
 else {
    mAcceptMimes=new String[]{intent.getType()};
  }
  if (mimeMatches("image/*",mAcceptMimes)) {
    mDisplayState.mode=DisplayState.MODE_GRID;
  }
 else {
    mDisplayState.mode=DisplayState.MODE_LIST;
  }
  setResult(Activity.RESULT_CANCELED);
  setContentView(R.layout.activity);
  getFragmentManager().addOnBackStackChangedListener(mStackListener);
  if (mAction == ACTION_CREATE) {
    final String mimeType=getIntent().getType();
    final String title=getIntent().getStringExtra(Intent.EXTRA_TITLE);
    SaveFragment.show(getFragmentManager(),mimeType,title);
  }
  mDrawerLayout=(DrawerLayout)findViewById(R.id.drawer_layout);
  mRootsAdapter=new RootsAdapter(this,mRoots);
  mRootsList=(ListView)findViewById(R.id.roots_list);
  mRootsList.setAdapter(mRootsAdapter);
  mRootsList.setOnItemClickListener(mRootsListener);
  mDrawerToggle=new ActionBarDrawerToggle(this,mDrawerLayout,R.drawable.ic_drawer,R.string.drawer_open,R.string.drawer_close);
  mDrawerLayout.setDrawerListener(mDrawerListener);
  mDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow,GravityCompat.START);
  mDrawerLayout.openDrawer(mRootsList);
  updateActionBar();
  updateRoots();
}
