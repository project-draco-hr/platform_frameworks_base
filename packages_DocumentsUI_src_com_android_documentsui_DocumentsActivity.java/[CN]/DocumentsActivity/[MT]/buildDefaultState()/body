{
  mState=new State();
  final Intent intent=getIntent();
  final String action=intent.getAction();
  if (Intent.ACTION_OPEN_DOCUMENT.equals(action)) {
    mState.action=ACTION_OPEN;
  }
 else   if (Intent.ACTION_CREATE_DOCUMENT.equals(action)) {
    mState.action=ACTION_CREATE;
  }
 else   if (Intent.ACTION_GET_CONTENT.equals(action)) {
    mState.action=ACTION_GET_CONTENT;
  }
 else   if (Intent.ACTION_OPEN_DOCUMENT_TREE.equals(action)) {
    mState.action=ACTION_OPEN_TREE;
  }
 else   if (DocumentsContract.ACTION_MANAGE_ROOT.equals(action)) {
    mState.action=ACTION_MANAGE;
  }
 else   if (DocumentsContract.ACTION_BROWSE_DOCUMENT_ROOT.equals(action)) {
    mState.action=ACTION_BROWSE;
  }
 else   if (DocumentsIntent.ACTION_OPEN_COPY_DESTINATION.equals(action)) {
    mState.action=ACTION_OPEN_COPY_DESTINATION;
  }
  if (mState.action == ACTION_OPEN || mState.action == ACTION_GET_CONTENT) {
    mState.allowMultiple=intent.getBooleanExtra(Intent.EXTRA_ALLOW_MULTIPLE,false);
  }
  if (mState.action == ACTION_MANAGE || mState.action == ACTION_BROWSE) {
    mState.acceptMimes=new String[]{"*/*"};
    mState.allowMultiple=true;
  }
 else   if (intent.hasExtra(Intent.EXTRA_MIME_TYPES)) {
    mState.acceptMimes=intent.getStringArrayExtra(Intent.EXTRA_MIME_TYPES);
  }
 else {
    mState.acceptMimes=new String[]{intent.getType()};
  }
  mState.localOnly=intent.getBooleanExtra(Intent.EXTRA_LOCAL_ONLY,false);
  mState.forceAdvanced=intent.getBooleanExtra(DocumentsContract.EXTRA_SHOW_ADVANCED,false);
  mState.showAdvanced=mState.forceAdvanced | LocalPreferences.getDisplayAdvancedDevices(this);
  if (mState.action == ACTION_MANAGE || mState.action == ACTION_BROWSE) {
    mState.showSize=true;
  }
 else {
    mState.showSize=LocalPreferences.getDisplayFileSize(this);
  }
  if (mState.action == ACTION_OPEN_COPY_DESTINATION) {
    mState.directoryCopy=intent.getBooleanExtra(BaseActivity.DocumentsIntent.EXTRA_DIRECTORY_COPY,false);
  }
}
