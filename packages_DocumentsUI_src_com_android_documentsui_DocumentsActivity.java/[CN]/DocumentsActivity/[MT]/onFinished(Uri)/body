{
  Log.d(TAG,"onFinished() " + Arrays.toString(uris));
  final ContentResolver resolver=getContentResolver();
  final ContentValues values=new ContentValues();
  final byte[] rawStack=DurableUtils.writeToArrayOrNull(mState.stack);
  if (mState.action == ACTION_CREATE) {
    values.clear();
    values.put(RecentColumns.STACK,rawStack);
    resolver.insert(RecentsProvider.buildRecent(),values);
  }
  final String packageName=getCallingPackage();
  values.clear();
  values.put(ResumeColumns.STACK,rawStack);
  values.put(ResumeColumns.EXTERNAL,0);
  resolver.insert(RecentsProvider.buildResume(packageName),values);
  final Intent intent=new Intent();
  if (uris.length == 1) {
    intent.setData(uris[0]);
  }
 else   if (uris.length > 1) {
    final ClipData clipData=new ClipData(null,mState.acceptMimes,new ClipData.Item(uris[0]));
    for (int i=1; i < uris.length; i++) {
      clipData.addItem(new ClipData.Item(uris[i]));
    }
    intent.setClipData(clipData);
  }
  if (mState.action == ACTION_GET_CONTENT) {
    intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
  }
 else {
    intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION | Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION);
  }
  setResult(Activity.RESULT_OK,intent);
  finish();
}
