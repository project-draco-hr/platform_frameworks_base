{
  if (localLOGV)   Slog.v(TAG,"Activity idle: " + token);
  ActivityRecord res=isInStackLocked(token);
  if (res != null) {
    if (mResumedActivity == res && mLaunchingActivity.isHeld()) {
      mHandler.removeMessages(LAUNCH_TIMEOUT_MSG);
      if (VALIDATE_WAKE_LOCK_CALLER && Binder.getCallingUid() != Process.myUid()) {
        throw new IllegalStateException("Calling must be system uid");
      }
      mLaunchingActivity.release();
    }
    if (DEBUG_VISBILITY)     Slog.v(TAG,"Idle activity for " + res);
    mStackSupervisor.ensureActivitiesVisibleLocked(null,0);
  }
  return res;
}
