{
  ActivityRecord r=topRunningActivityLocked(null);
  if (r != null && r.app == app) {
    Slog.w(TAG,"  Force finishing activity " + r.intent.getComponent().flattenToShortString());
    int index=mHistory.indexOf(r);
    r.stack.finishActivityLocked(r,Activity.RESULT_CANCELED,null,"crashed",false);
    index--;
    if (index >= 0) {
      r=mHistory.get(index);
      if (r.state == ActivityState.RESUMED || r.state == ActivityState.PAUSING || r.state == ActivityState.PAUSED) {
        if (!r.isHomeActivity || mService.mHomeProcess != r.app) {
          Slog.w(TAG,"  Force finishing activity " + r.intent.getComponent().flattenToShortString());
          r.stack.finishActivityLocked(r,Activity.RESULT_CANCELED,null,"crashed",false);
        }
      }
    }
  }
}
