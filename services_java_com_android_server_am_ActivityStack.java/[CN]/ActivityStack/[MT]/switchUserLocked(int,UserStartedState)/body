{
  if (VALIDATE_TOKENS) {
    validateAppTokensLocked();
  }
  mStartingUsers.add(uss);
  if (mCurrentUser == userId) {
    return true;
  }
  mCurrentUser=userId;
  boolean haveActivities=false;
  TaskRecord task=null;
  int index=mTaskHistory.size();
  for (int i=0; i < index; ++i) {
    task=mTaskHistory.get(i);
    if (task.userId == userId) {
      haveActivities=true;
      mTaskHistory.remove(i);
      mTaskHistory.add(task);
      --index;
    }
  }
{
    int N=mHistory.size();
    int i=0;
    while (i < N) {
      ActivityRecord r=mHistory.get(i);
      if (r.userId == userId) {
        ActivityRecord moveToTop=mHistory.remove(i);
        mHistory.add(moveToTop);
        N--;
        haveActivities=true;
      }
 else {
        i++;
      }
    }
    if (VALIDATE_TASK_REPLACE) {
      verifyActivityRecords(true);
    }
  }
  ActivityRecord top=task != null ? task.getTopActivity() : null;
  if (VALIDATE_TASK_REPLACE)   Slog.w(TAG,"newSwitchUserLocked: would call resumeTopActivity " + top);
  resumeTopActivityLocked(top);
  return haveActivities;
}
