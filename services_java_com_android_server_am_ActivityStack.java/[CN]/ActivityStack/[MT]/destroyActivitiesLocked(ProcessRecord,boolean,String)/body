{
  boolean lastIsOpaque=false;
  boolean activityRemoved=false;
  for (int taskNdx=mTaskHistory.size() - 1; taskNdx >= 0; --taskNdx) {
    final ArrayList<ActivityRecord> activities=mTaskHistory.get(taskNdx).mActivities;
    for (int activityNdx=activities.size() - 1; activityNdx >= 0; --activityNdx) {
      final ActivityRecord r=activities.get(activityNdx);
      if (r.finishing) {
        continue;
      }
      if (r.fullscreen) {
        lastIsOpaque=true;
      }
      if (owner != null && r.app != owner) {
        continue;
      }
      if (!lastIsOpaque) {
        continue;
      }
      if (r.app != null && r != mResumedActivity && r != mPausingActivity && r.haveState && !r.visible && r.stopped && r.state != ActivityState.DESTROYING && r.state != ActivityState.DESTROYED) {
        if (DEBUG_SWITCH)         Slog.v(TAG,"Destroying " + r + " in state "+ r.state+ " resumed="+ mResumedActivity+ " pausing="+ mPausingActivity);
        if (destroyActivityLocked(r,true,oomAdj,reason)) {
          activityRemoved=true;
        }
      }
    }
  }
  if (activityRemoved) {
    resumeTopActivityLocked(null);
  }
}
