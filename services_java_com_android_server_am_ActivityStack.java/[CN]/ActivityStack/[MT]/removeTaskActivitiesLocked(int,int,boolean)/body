{
  final TaskRecord task=mTaskIdToTaskRecord.get(taskId);
  TaskAccessInfo info=getTaskAccessInfoLocked(task,false);
  if (info.root == null) {
    if (taskRequired) {
      Slog.w(TAG,"removeTaskLocked: unknown taskId " + taskId);
    }
    return null;
  }
  if (subTaskIndex < 0) {
    performClearTaskAtIndexLocked(task,info.rootIndex);
    return info.root;
  }
  if (subTaskIndex >= info.subtasks.size()) {
    if (taskRequired) {
      Slog.w(TAG,"removeTaskLocked: unknown subTaskIndex " + subTaskIndex);
    }
    return null;
  }
  TaskAccessInfo.SubTask subtask=info.subtasks.get(subTaskIndex);
  performClearTaskAtIndexLocked(task,subtask.index);
  return subtask.activity;
}
