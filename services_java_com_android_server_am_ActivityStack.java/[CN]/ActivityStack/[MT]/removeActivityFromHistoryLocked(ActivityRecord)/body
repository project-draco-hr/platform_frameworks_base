{
  if (r.state != ActivityState.DESTROYED) {
    r.makeFinishing();
    mHistory.remove(r);
    r.takeFromHistory();
    r.state=ActivityState.DESTROYED;
    mService.mWindowManager.removeAppToken(r);
    if (VALIDATE_TOKENS) {
      mService.mWindowManager.validateAppTokens(mHistory);
    }
    cleanUpActivityServicesLocked(r);
    r.removeUriPermissionsLocked();
  }
}
