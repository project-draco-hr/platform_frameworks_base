{
  int i=mHistory.size();
  while (i > 0) {
    i--;
    ActivityRecord r=mHistory.get(i);
    if (r.task.taskId == taskId) {
      i++;
      break;
    }
  }
  while (i > 0) {
    i--;
    ActivityRecord r=mHistory.get(i);
    if (r.finishing) {
      continue;
    }
    if (r.task.taskId != taskId) {
      return null;
    }
    if (r.realActivity.equals(newR.realActivity)) {
      ActivityRecord ret=r;
      while (i < (mHistory.size() - 1)) {
        i++;
        r=mHistory.get(i);
        if (r.task.taskId != taskId) {
          break;
        }
        if (r.finishing) {
          continue;
        }
        if (finishActivityLocked(r,i,Activity.RESULT_CANCELED,null,"clear",false)) {
          i--;
        }
      }
      if (ret.launchMode == ActivityInfo.LAUNCH_MULTIPLE && (launchFlags & Intent.FLAG_ACTIVITY_SINGLE_TOP) == 0) {
        if (!ret.finishing) {
          int index=indexOfTokenLocked(ret.appToken);
          if (index >= 0) {
            finishActivityLocked(ret,index,Activity.RESULT_CANCELED,null,"clear",false);
          }
          return null;
        }
      }
      return ret;
    }
  }
  return null;
}
