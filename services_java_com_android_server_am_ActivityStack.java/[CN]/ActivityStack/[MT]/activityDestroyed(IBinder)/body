{
synchronized (mService) {
    final long origId=Binder.clearCallingIdentity();
    try {
      ActivityRecord r=ActivityRecord.forToken(token);
      if (r != null) {
        mHandler.removeMessages(DESTROY_TIMEOUT_MSG,r);
      }
      int index=indexOfActivityLocked(r);
      if (index >= 0) {
        if (r.state == ActivityState.DESTROYING) {
          cleanUpActivityLocked(r,true,false);
          removeActivityFromHistoryLocked(r);
        }
      }
      resumeTopActivityLocked(null);
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
  }
}
