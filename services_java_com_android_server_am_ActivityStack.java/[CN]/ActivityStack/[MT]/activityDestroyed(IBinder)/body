{
synchronized (mService) {
    ActivityRecord r=ActivityRecord.forToken(token);
    if (r != null) {
      mHandler.removeMessages(DESTROY_TIMEOUT_MSG,r);
    }
    int index=indexOfActivityLocked(r);
    if (index >= 0) {
      if (r.state == ActivityState.DESTROYING) {
        final long origId=Binder.clearCallingIdentity();
        removeActivityFromHistoryLocked(r);
        Binder.restoreCallingIdentity(origId);
      }
    }
  }
}
