{
  ActivityRecord r=isInStackLocked(token);
  if (DEBUG_RESULTS)   Slog.v(TAG,"Finishing activity affinity token=" + token + " r="+ r);
  if (r == null) {
    return false;
  }
  ArrayList<ActivityRecord> activities=r.task.mActivities;
  for (int index=activities.indexOf(r); index >= 0; --index) {
    ActivityRecord cur=activities.get(index);
    if (!Objects.equal(cur.taskAffinity,r.taskAffinity)) {
      break;
    }
    finishActivityLocked(cur,Activity.RESULT_CANCELED,null,"request-affinity",true);
  }
  return true;
}
