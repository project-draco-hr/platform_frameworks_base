{
  int N=mStoppingActivities.size();
  if (N <= 0)   return null;
  ArrayList<ActivityRecord> stops=null;
  final boolean nowVisible=mResumedActivity != null && mResumedActivity.nowVisible && !mResumedActivity.waitingVisible;
  for (int i=0; i < N; i++) {
    ActivityRecord s=mStoppingActivities.get(i);
    if (localLOGV)     Slog.v(TAG,"Stopping " + s + ": nowVisible="+ nowVisible+ " waitingVisible="+ s.waitingVisible+ " finishing="+ s.finishing);
    if (s.waitingVisible && nowVisible) {
      mWaitingVisibleActivities.remove(s);
      s.waitingVisible=false;
      if (s.finishing) {
        if (localLOGV)         Slog.v(TAG,"Before stopping, can hide: " + s);
        mService.mWindowManager.setAppVisibility(s,false);
      }
    }
    if ((!s.waitingVisible || mService.isSleeping()) && remove) {
      if (localLOGV)       Slog.v(TAG,"Ready to stop: " + s);
      if (stops == null) {
        stops=new ArrayList<ActivityRecord>();
      }
      stops.add(s);
      mStoppingActivities.remove(i);
      N--;
      i--;
    }
  }
  return stops;
}
