{
  if (!newMoveTaskToBackLocked(task,reason)) {
    return false;
  }
  final int N=mHistory.size();
  int bottom=0;
  int pos=0;
  while (pos < N) {
    ActivityRecord r=mHistory.get(pos);
    if (localLOGV)     Slog.v(TAG,"At " + pos + " ckp "+ r.task+ ": "+ r);
    if (r.task.taskId == task) {
      if (localLOGV)       Slog.v(TAG,"Removing and adding at " + (N - 1));
      if (DEBUG_ADD_REMOVE) {
        RuntimeException here=new RuntimeException("here");
        here.fillInStackTrace();
        Slog.i(TAG,"Removing and adding activity " + r + " to stack at "+ bottom,here);
      }
      mHistory.remove(pos);
      mHistory.add(bottom,r);
      bottom++;
    }
    pos++;
  }
  if (VALIDATE_TASK_REPLACE) {
    verifyActivityRecords(true);
  }
  return true;
}
