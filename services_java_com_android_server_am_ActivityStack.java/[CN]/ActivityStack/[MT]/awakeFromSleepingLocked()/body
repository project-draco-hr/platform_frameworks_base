{
  mHandler.removeMessages(SLEEP_TIMEOUT_MSG);
  mSleepTimeout=false;
  if (mGoingToSleep.isHeld()) {
    mGoingToSleep.release();
  }
  if (VALIDATE_TASK_REPLACE) {
    verifyActivityRecords(true);
  }
  for (int i=mHistory.size() - 1; i >= 0; i--) {
    ActivityRecord r=mHistory.get(i);
    r.setSleeping(false);
  }
  mGoingToSleepActivities.clear();
}
