{
  ComponentName cls=intent.getComponent();
  if (info.targetActivity != null) {
    cls=new ComponentName(info.packageName,info.targetActivity);
  }
  final int userId=UserHandle.getUserId(info.applicationInfo.uid);
  for (int taskNdx=mTaskHistory.size() - 1; taskNdx >= 0; --taskNdx) {
    final TaskRecord task=mTaskHistory.get(taskNdx);
    final ActivityRecord r=task.getTopActivity();
    if (r == null || r.finishing || r.userId != userId || r.launchMode == ActivityInfo.LAUNCH_SINGLE_INSTANCE) {
      continue;
    }
    if (task.affinity != null) {
      if (task.affinity.equals(info.taskAffinity)) {
        return r;
      }
    }
 else     if (task.intent != null && task.intent.getComponent().equals(cls)) {
      return r;
    }
 else     if (task.affinityIntent != null && task.affinityIntent.getComponent().equals(cls)) {
      return r;
    }
  }
  return null;
}
