{
  mValidateAppTokens.clear();
  mValidateAppTokens.ensureCapacity(mHistory.size());
  int taskId=Integer.MIN_VALUE;
  TaskGroup task=null;
  for (int i=0; i < mHistory.size(); i++) {
    final ActivityRecord r=mHistory.get(i);
    if (taskId != r.task.taskId) {
      taskId=r.task.taskId;
      task=new TaskGroup();
      task.taskId=taskId;
      mValidateAppTokens.add(task);
    }
    task.tokens.add(r.appToken);
  }
  mService.mWindowManager.validateAppTokens(mValidateAppTokens);
}
