{
  if (surfaceHolder == null) {
    throw new IllegalArgumentException("Surface Holder is null");
  }
  final Surface surface=surfaceHolder.getSurface();
  if (surface == null) {
    throw new IllegalArgumentException("Surface could not be retrieved from Surface holder");
  }
  if (timeMs < 0) {
    throw new IllegalArgumentException("requested time not correct");
  }
 else   if (timeMs > mDurationMs) {
    throw new IllegalArgumentException("requested time more than duration");
  }
  long result=0;
  boolean semAcquireDone=false;
  try {
    semAcquireDone=mMANativeHelper.lock(ENGINE_ACCESS_MAX_TIMEOUT_MS);
    if (semAcquireDone == false) {
      throw new IllegalStateException("Timeout waiting for semaphore");
    }
    if (mMediaItems.size() > 0) {
      final Rect frame=surfaceHolder.getSurfaceFrame();
      result=mMANativeHelper.renderPreviewFrame(surface,timeMs,frame.width(),frame.height(),overlayData);
    }
 else {
      result=0;
    }
  }
 catch (  InterruptedException ex) {
    Log.w(TAG,"The thread was interrupted",new Throwable());
    throw new IllegalStateException("The thread was interrupted");
  }
 finally {
    if (semAcquireDone) {
      mMANativeHelper.unlock();
    }
  }
  return result;
}
