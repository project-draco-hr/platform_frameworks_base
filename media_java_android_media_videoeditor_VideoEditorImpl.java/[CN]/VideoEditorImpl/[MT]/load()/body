{
  final File file=new File(mProjectPath,PROJECT_FILENAME);
  final FileInputStream fis=new FileInputStream(file);
  try {
    final List<String> ignoredMediaItems=new ArrayList<String>();
    final XmlPullParser parser=Xml.newPullParser();
    parser.setInput(fis,"UTF-8");
    int eventType=parser.getEventType();
    String name;
    MediaItem currentMediaItem=null;
    Overlay currentOverlay=null;
    boolean regenerateProjectThumbnail=false;
    while (eventType != XmlPullParser.END_DOCUMENT) {
switch (eventType) {
case XmlPullParser.START_TAG:
{
          name=parser.getName();
          if (TAG_PROJECT.equals(name)) {
            mAspectRatio=Integer.parseInt(parser.getAttributeValue("",ATTR_ASPECT_RATIO));
            final boolean mRegenPCM=Boolean.parseBoolean(parser.getAttributeValue("",ATTR_REGENERATE_PCM));
            mMANativeHelper.setAudioflag(mRegenPCM);
          }
 else           if (TAG_MEDIA_ITEM.equals(name)) {
            final String mediaItemId=parser.getAttributeValue("",ATTR_ID);
            try {
              currentMediaItem=parseMediaItem(parser);
              mMediaItems.add(currentMediaItem);
            }
 catch (            Exception ex) {
              Log.w(TAG,"Cannot load media item: " + mediaItemId,ex);
              currentMediaItem=null;
              if (mMediaItems.size() == 0) {
                regenerateProjectThumbnail=true;
              }
              ignoredMediaItems.add(mediaItemId);
            }
          }
 else           if (TAG_TRANSITION.equals(name)) {
            try {
              final Transition transition=parseTransition(parser,ignoredMediaItems);
              if (transition != null) {
                mTransitions.add(transition);
              }
            }
 catch (            Exception ex) {
              Log.w(TAG,"Cannot load transition",ex);
            }
          }
 else           if (TAG_OVERLAY.equals(name)) {
            if (currentMediaItem != null) {
              try {
                currentOverlay=parseOverlay(parser,currentMediaItem);
                currentMediaItem.addOverlay(currentOverlay);
              }
 catch (              Exception ex) {
                Log.w(TAG,"Cannot load overlay",ex);
              }
            }
          }
 else           if (TAG_OVERLAY_USER_ATTRIBUTES.equals(name)) {
            if (currentOverlay != null) {
              final int attributesCount=parser.getAttributeCount();
              for (int i=0; i < attributesCount; i++) {
                currentOverlay.setUserAttribute(parser.getAttributeName(i),parser.getAttributeValue(i));
              }
            }
          }
 else           if (TAG_EFFECT.equals(name)) {
            if (currentMediaItem != null) {
              try {
                final Effect effect=parseEffect(parser,currentMediaItem);
                currentMediaItem.addEffect(effect);
                if (effect instanceof EffectKenBurns) {
                  final boolean isImageClipGenerated=Boolean.parseBoolean(parser.getAttributeValue("",ATTR_IS_IMAGE_CLIP_GENERATED));
                  if (isImageClipGenerated) {
                    final String filename=parser.getAttributeValue("",ATTR_GENERATED_IMAGE_CLIP);
                    if (new File(filename).exists() == true) {
                      ((MediaImageItem)currentMediaItem).setGeneratedImageClip(filename);
                      ((MediaImageItem)currentMediaItem).setRegenerateClip(false);
                    }
 else {
                      ((MediaImageItem)currentMediaItem).setGeneratedImageClip(null);
                      ((MediaImageItem)currentMediaItem).setRegenerateClip(true);
                    }
                  }
 else {
                    ((MediaImageItem)currentMediaItem).setGeneratedImageClip(null);
                    ((MediaImageItem)currentMediaItem).setRegenerateClip(true);
                  }
                }
              }
 catch (              Exception ex) {
                Log.w(TAG,"Cannot load effect",ex);
              }
            }
          }
 else           if (TAG_AUDIO_TRACK.equals(name)) {
            try {
              final AudioTrack audioTrack=parseAudioTrack(parser);
              addAudioTrack(audioTrack);
            }
 catch (            Exception ex) {
              Log.w(TAG,"Cannot load audio track",ex);
            }
          }
          break;
        }
case XmlPullParser.END_TAG:
{
        name=parser.getName();
        if (TAG_MEDIA_ITEM.equals(name)) {
          currentMediaItem=null;
        }
 else         if (TAG_OVERLAY.equals(name)) {
          currentOverlay=null;
        }
        break;
      }
default :
{
      break;
    }
}
eventType=parser.next();
}
computeTimelineDuration();
if (regenerateProjectThumbnail) {
generateProjectThumbnail();
regenerateProjectThumbnail=false;
}
}
  finally {
if (fis != null) {
fis.close();
}
}
}
