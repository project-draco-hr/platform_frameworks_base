{
synchronized (sLock) {
    if (sUserCerts != null) {
      return sUserCerts;
    }
    CertificateFactory certFactory;
    try {
      certFactory=CertificateFactory.getInstance("X.509");
    }
 catch (    CertificateException e) {
      throw new RuntimeException("Failed to obtain X.509 CertificateFactory",e);
    }
    final File configDir=Environment.getUserConfigDirectory(UserHandle.myUserId());
    final File userCaDir=new File(configDir,"cacerts-added");
    if (!userCaDir.isDirectory()) {
      throw new AssertionError(userCaDir + " is not a directory");
    }
    Set<X509Certificate> userCerts=new ArraySet<X509Certificate>();
    for (    String caFile : userCaDir.list()) {
      InputStream is=null;
      try {
        is=new BufferedInputStream(new FileInputStream(new File(userCaDir,caFile)));
        userCerts.add((X509Certificate)certFactory.generateCertificate(is));
      }
 catch (      CertificateException|IOException e) {
        continue;
      }
 finally {
        IoUtils.closeQuietly(is);
      }
    }
    sUserCerts=userCerts;
    return sUserCerts;
  }
}
