{
  MockIpManagerCallback ipManagerCallback=new MockIpManagerCallback();
  ApfFilter apfFilter=new TestApfFilter(ipManagerCallback,false);
  byte[] program=ipManagerCallback.getApfProgram();
  ByteBuffer packet=ByteBuffer.wrap(new byte[100]);
  packet.putShort(ETH_ETHERTYPE_OFFSET,(short)ETH_P_ARP);
  assertPass(program,packet.array(),0);
  packet.position(ARP_HEADER_OFFSET);
  packet.put(ARP_IPV4_REQUEST_HEADER);
  assertPass(program,packet.array(),0);
  packet.position(ARP_TARGET_IP_ADDRESS_OFFSET);
  packet.put(MOCK_IPV4_ADDR);
  assertPass(program,packet.array(),0);
  LinkProperties lp=new LinkProperties();
  assertTrue(lp.addLinkAddress(new LinkAddress(InetAddress.getByAddress(MOCK_IPV4_ADDR),24)));
  verifyArpFilter(ipManagerCallback,apfFilter,lp,DROP);
  verifyArpFilter(ipManagerCallback,apfFilter,new LinkProperties(),PASS);
  apfFilter.shutdown();
}
