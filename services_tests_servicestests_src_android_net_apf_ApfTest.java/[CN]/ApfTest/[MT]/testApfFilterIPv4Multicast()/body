{
  MockIpManagerCallback ipManagerCallback=new MockIpManagerCallback();
  ApfFilter apfFilter=new TestApfFilter(ipManagerCallback,false);
  byte[] program=ipManagerCallback.getApfProgram();
  ByteBuffer packet=ByteBuffer.wrap(new byte[100]);
  packet.putShort(ETH_ETHERTYPE_OFFSET,(short)ETH_P_IP);
  packet.position(IPV4_DEST_ADDR_OFFSET);
  packet.put(new byte[]{(byte)224,0,0,1});
  assertPass(program,packet.array(),0);
  ipManagerCallback.resetApfProgramWait();
  apfFilter.setMulticastFilter(true);
  program=ipManagerCallback.getApfProgram();
  assertDrop(program,packet.array(),0);
  ipManagerCallback.resetApfProgramWait();
  apfFilter.setMulticastFilter(false);
  program=ipManagerCallback.getApfProgram();
  assertPass(program,packet.array(),0);
  ipManagerCallback.resetApfProgramWait();
  apfFilter.shutdown();
  apfFilter=new TestApfFilter(ipManagerCallback,true);
  program=ipManagerCallback.getApfProgram();
  assertDrop(program,packet.array(),0);
  apfFilter.shutdown();
}
