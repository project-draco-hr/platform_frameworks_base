{
  if (!mIsBound) {
    Log.w("SurfaceRenderFilter",this + ": Ignoring frame as there is no surface to render to!");
    return;
  }
  if (mLogVerbose)   Log.v(TAG,"Starting frame processing");
  GLEnvironment glEnv=mSurfaceView.getGLEnv();
  if (glEnv != context.getGLEnvironment()) {
    throw new RuntimeException("Surface created under different GLEnvironment!");
  }
  Frame input=pullInput("frame");
  boolean createdFrame=false;
  float currentAspectRatio=(float)input.getFormat().getWidth() / input.getFormat().getHeight();
  if (currentAspectRatio != mAspectRatio) {
    if (mLogVerbose)     Log.v(TAG,"New aspect ratio: " + currentAspectRatio + ", previously: "+ mAspectRatio);
    mAspectRatio=currentAspectRatio;
    updateTargetRect();
  }
  Frame gpuFrame=null;
  if (mLogVerbose)   Log.v("SurfaceRenderFilter","Got input format: " + input.getFormat());
  int target=input.getFormat().getTarget();
  if (target != FrameFormat.TARGET_GPU) {
    gpuFrame=context.getFrameManager().duplicateFrameToTarget(input,FrameFormat.TARGET_GPU);
    createdFrame=true;
  }
 else {
    gpuFrame=input;
  }
  glEnv.activateSurfaceWithId(mSurfaceView.getSurfaceId());
  mProgram.process(gpuFrame,mScreen);
  glEnv.swapBuffers();
  if (createdFrame) {
    gpuFrame.release();
  }
}
