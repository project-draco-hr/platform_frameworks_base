{
  buffer.mark();
  boolean foundNull=false;
  int stringLength=0;
  while (buffer.hasRemaining()) {
    if (buffer.get() == (byte)0) {
      foundNull=true;
      break;
    }
    stringLength++;
  }
  if (!foundNull) {
    throw new IllegalArgumentException("Strings must be null-terminated");
  }
  buffer.reset();
  byte[] strBytes=new byte[stringLength + 1];
  buffer.get(strBytes,0,stringLength + 1);
  return new String(strBytes,0,stringLength,UTF8_CHARSET);
}
