{
  if (mInputStream.read(mBuffer,0,1) != 1) {
    Log.e(TAG,"could not read command byte");
    return -1;
  }
  int dataSize=MidiUtils.getMessageDataSize(mBuffer[0]);
  if (dataSize < 0) {
    return -1;
  }
  if (dataSize > 0) {
    if (mInputStream.read(mBuffer,1,dataSize) != dataSize) {
      Log.e(TAG,"could not read command data");
      return -1;
    }
  }
  return MidiDevice.packMessage(mBuffer,0,dataSize + 1,System.nanoTime(),0,buffer);
}
