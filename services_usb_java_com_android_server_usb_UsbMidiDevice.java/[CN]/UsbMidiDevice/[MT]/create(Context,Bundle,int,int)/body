{
  MidiManager midiManager=(MidiManager)context.getSystemService(Context.MIDI_SERVICE);
  if (midiManager == null) {
    Log.e(TAG,"No MidiManager in UsbMidiDevice.create()");
    return null;
  }
  int subDevices=nativeGetSubdeviceCount(card,device);
  if (subDevices <= 0) {
    Log.e(TAG,"nativeGetSubdeviceCount failed");
    return null;
  }
  FileDescriptor[] fileDescriptors=nativeOpen(card,device,subDevices);
  if (fileDescriptors == null) {
    Log.e(TAG,"nativeOpen failed");
    return null;
  }
  MidiDeviceServer server=midiManager.createDeviceServer(subDevices,subDevices,properties,false,MidiDeviceInfo.TYPE_USB);
  if (server == null) {
    Log.e(TAG,"createDeviceServer failed");
    return null;
  }
  return new UsbMidiDevice(server,fileDescriptors,fileDescriptors);
}
