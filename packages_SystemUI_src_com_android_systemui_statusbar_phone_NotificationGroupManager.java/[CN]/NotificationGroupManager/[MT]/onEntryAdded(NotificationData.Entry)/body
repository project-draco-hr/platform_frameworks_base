{
  StatusBarNotification sbn=added.notification;
  Notification notif=sbn.getNotification();
  String groupKey=sbn.getGroupKey();
  NotificationGroup group=mGroupMap.get(groupKey);
  if (group == null) {
    group=new NotificationGroup();
    mGroupMap.put(groupKey,group);
  }
  if (notif.isGroupSummary()) {
    group.summary=added;
    group.expanded=added.row.areChildrenExpanded();
    if (!group.children.isEmpty()) {
      mListener.onGroupCreatedFromChildren(group);
    }
  }
 else {
    group.children.add(added);
    if (group.summary != null && group.children.size() == 1 && !group.expanded) {
      group.summary.row.updateExpandButton();
    }
  }
}
