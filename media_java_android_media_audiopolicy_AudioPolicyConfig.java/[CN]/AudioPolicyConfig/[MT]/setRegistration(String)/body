{
  final boolean currentRegNull=(mRegistrationId == null) || mRegistrationId.isEmpty();
  final boolean newRegNull=(regId == null) || regId.isEmpty();
  if (!currentRegNull && !newRegNull && !mRegistrationId.equals(regId)) {
    Log.e(TAG,"Invalid registration transition from " + mRegistrationId + " to "+ regId);
    return;
  }
  mRegistrationId=regId == null ? "" : regId;
  int mixIndex=0;
  for (  AudioMix mix : mMixes) {
    if (!mRegistrationId.isEmpty()) {
      if ((mix.getRouteFlags() & AudioMix.ROUTE_FLAG_LOOP_BACK) == AudioMix.ROUTE_FLAG_LOOP_BACK) {
        mix.setRegistration(mRegistrationId + "mix" + mixTypeId(mix.getMixType())+ ":"+ mixIndex++);
      }
 else       if ((mix.getRouteFlags() & AudioMix.ROUTE_FLAG_RENDER) == AudioMix.ROUTE_FLAG_RENDER) {
        mix.setRegistration(mix.mDeviceAddress);
      }
    }
 else {
      mix.setRegistration("");
    }
  }
}
