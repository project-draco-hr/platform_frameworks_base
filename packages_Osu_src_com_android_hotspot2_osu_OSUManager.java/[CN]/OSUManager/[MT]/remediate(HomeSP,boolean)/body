{
  UpdateInfo updateInfo;
  if (policy) {
    if (homeSP.getPolicy() == null) {
      throw new IOException("No policy object");
    }
    updateInfo=homeSP.getPolicy().getPolicyUpdate();
  }
 else {
    updateInfo=homeSP.getSubscriptionUpdate();
  }
switch (updateInfo.getUpdateRestriction()) {
case HomeSP:
{
      Network network=mWifiNetworkAdapter.getCurrentNetwork();
      if (network == null) {
        throw new IOException("Failed to determine current network");
      }
      WifiConfiguration config=mWifiNetworkAdapter.getActivePasspointNetwork();
      HomeSP activeSP=MOManager.buildSP(config.getMoTree());
      if (activeSP == null || !activeSP.getFQDN().equals(homeSP.getFQDN())) {
        throw new IOException("Remediation restricted to HomeSP");
      }
      doRemediate(updateInfo.getURI(),network,homeSP,policy);
      break;
    }
case RoamingPartner:
{
    Network network=mWifiNetworkAdapter.getCurrentNetwork();
    if (network == null) {
      throw new IOException("Failed to determine current network");
    }
    WifiInfo wifiInfo=mWifiNetworkAdapter.getConnectionInfo();
    if (wifiInfo == null) {
      throw new IOException("Unable to determine WiFi info");
    }
    PasspointMatch match=mWifiNetworkAdapter.matchProviderWithCurrentNetwork(homeSP.getFQDN());
    if (match == PasspointMatch.HomeProvider || match == PasspointMatch.RoamingProvider) {
      doRemediate(updateInfo.getURI(),network,homeSP,policy);
    }
 else {
      throw new IOException("No roaming network match: " + match);
    }
    break;
  }
case Unrestricted:
{
  Network network=mWifiNetworkAdapter.getCurrentNetwork();
  doRemediate(updateInfo.getURI(),network,homeSP,policy);
  break;
}
}
}
