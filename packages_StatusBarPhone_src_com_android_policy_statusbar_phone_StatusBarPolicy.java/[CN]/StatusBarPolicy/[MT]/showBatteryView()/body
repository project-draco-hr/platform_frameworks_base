{
  closeLastBatteryView();
  if (mLowBatteryDialog != null) {
    mLowBatteryDialog.dismiss();
  }
  int level=mBatteryLevel;
  View v=View.inflate(mContext,com.android.internal.R.layout.battery_status,null);
  mBatteryView=v;
  int pixelFormat=PixelFormat.TRANSLUCENT;
  Drawable bg=v.getBackground();
  if (bg != null) {
    pixelFormat=bg.getOpacity();
  }
  int flags=WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE | WindowManager.LayoutParams.FLAG_DIM_BEHIND;
  if (!mContext.getResources().getBoolean(com.android.internal.R.bool.config_sf_slowBlur)) {
    flags|=WindowManager.LayoutParams.FLAG_BLUR_BEHIND;
  }
  WindowManager.LayoutParams lp=new WindowManager.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,ViewGroup.LayoutParams.WRAP_CONTENT,WindowManager.LayoutParams.TYPE_TOAST,flags,pixelFormat);
  TypedArray a=mContext.obtainStyledAttributes(com.android.internal.R.styleable.Theme);
  lp.dimAmount=a.getFloat(android.R.styleable.Theme_backgroundDimAmount,0.5f);
  a.recycle();
  lp.setTitle("Battery");
  TextView levelTextView=(TextView)v.findViewById(com.android.internal.R.id.level_percent);
  levelTextView.setText(mContext.getString(com.android.internal.R.string.battery_status_text_percent_format,level));
  setBatteryLevel(v,com.android.internal.R.id.spacer,100 - level,0,0);
  setBatteryLevel(v,com.android.internal.R.id.level,level,com.android.internal.R.drawable.battery_charge_fill,level);
  WindowManagerImpl.getDefault().addView(v,lp);
  scheduleCloseBatteryView();
}
