{
  if (mUpdateCount > 0) {
    throw new IllegalStateException("Can't save state while updating");
  }
  forgetUndos(null,-1);
  forgetRedos(null,-1);
  ParcelableParcel pp=(ParcelableParcel)state;
  Parcel p=pp.getParcel();
  mHistorySize=p.readInt();
  mStateOwners=new UndoOwner[p.readInt()];
  int stype;
  while ((stype=p.readInt()) != 0) {
    UndoState ustate=new UndoState(this,p,pp.getClassLoader());
    if (stype == 1) {
      mUndos.add(0,ustate);
    }
 else {
      mRedos.add(0,ustate);
    }
  }
}
