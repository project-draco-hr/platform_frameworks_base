{
  if (mUpdateCount > 0) {
    throw new IllegalStateException("Can't save state while updating");
  }
  ParcelableParcel pp=new ParcelableParcel(getClass().getClassLoader());
  Parcel p=pp.getParcel();
  mStateSeq++;
  if (mStateSeq <= 0) {
    mStateSeq=0;
  }
  mNextSavedIdx=0;
  p.writeInt(mHistorySize);
  p.writeInt(mOwners.size());
  int i=mUndos.size();
  while (i > 0) {
    p.writeInt(1);
    i--;
    mUndos.get(i).writeToParcel(p);
  }
  i=mRedos.size();
  p.writeInt(i);
  while (i > 0) {
    p.writeInt(2);
    i--;
    mRedos.get(i).writeToParcel(p);
  }
  p.writeInt(0);
  return pp;
}
