{
  mSortedAndFiltered.clear();
  ArraySet<String> groupsWithSummaries=null;
  final int N=mEntries.size();
  for (int i=0; i < N; i++) {
    Entry entry=mEntries.valueAt(i);
    StatusBarNotification sbn=entry.notification;
    if (shouldFilterOut(sbn)) {
      continue;
    }
    if (sbn.getNotification().isGroupSummary()) {
      if (groupsWithSummaries == null) {
        groupsWithSummaries=new ArraySet<>();
      }
      groupsWithSummaries.add(sbn.getGroupKey());
    }
    mSortedAndFiltered.add(entry);
  }
  if (groupsWithSummaries != null) {
    final int M=mSortedAndFiltered.size();
    for (int i=M - 1; i >= 0; i--) {
      Entry ent=mSortedAndFiltered.get(i);
      StatusBarNotification sbn=ent.notification;
      if (sbn.getNotification().isGroupChild() && groupsWithSummaries.contains(sbn.getGroupKey())) {
        mSortedAndFiltered.remove(i);
      }
    }
  }
  Collections.sort(mSortedAndFiltered,mRankingComparator);
}
