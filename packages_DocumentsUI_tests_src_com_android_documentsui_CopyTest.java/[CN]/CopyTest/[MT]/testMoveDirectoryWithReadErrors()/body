{
  String testContent[]={"The five boxing wizards jump quickly","The quick brown fox jumps over the lazy dog","Jackdaws love my big sphinx of quartz"};
  String srcDir="/testdir";
  String srcFiles[]={srcDir + "/test0.txt",srcDir + "/test1.txt",srcDir + "/test2.txt"};
  Uri testDir=mStorage.createFile(SRC,srcDir,DocumentsContract.Document.MIME_TYPE_DIR,null);
  mStorage.createFile(SRC,srcFiles[0],"text/plain",testContent[0].getBytes());
  Uri errFile=mStorage.createFile(SRC,srcFiles[1],"text/plain",testContent[1].getBytes());
  mStorage.createFile(SRC,srcFiles[2],"text/plain",testContent[2].getBytes());
  mStorage.simulateReadErrorsForFile(errFile);
  Intent moveIntent=createCopyIntent(Lists.newArrayList(testDir));
  moveIntent.putExtra(CopyService.EXTRA_TRANSFER_MODE,CopyService.TRANSFER_MODE_MOVE);
  startService(moveIntent);
  mResolver.waitForChanges(10);
  assertTrue(mStorage.getFile(SRC,srcDir).isDirectory());
  assertTrue(mStorage.getFile(DST,srcDir).isDirectory());
  MoreAsserts.assertEquals("Copied file contents differ",testContent[0].getBytes(),readFile(DST,srcFiles[0]));
  MoreAsserts.assertEquals("Copied file contents differ",testContent[2].getBytes(),readFile(DST,srcFiles[2]));
  assertDoesNotExist(SRC,srcFiles[0]);
  assertDoesNotExist(SRC,srcFiles[2]);
  assertDoesNotExist(DST,srcFiles[1]);
  assertExists(SRC,srcFiles[1]);
}
