{
  if (!srcSurf.isNativeDrawable()) {
    JavaBlitter.inst.blit(srcX,srcY,srcSurf,dstX,dstY,dstSurf,width,height,comp,bgcolor,clip);
  }
 else {
    long dstSurfStruct=dstSurf.getSurfaceDataPtr();
    Object dstData=dstSurf.getData();
    int clipRects[];
    if (clip != null) {
      clipRects=clip.rect;
    }
 else {
      clipRects=new int[]{5,0,0,dstSurf.getWidth(),dstSurf.getHeight()};
    }
    if (!(srcSurf instanceof ImageSurface)) {
      srcSurf=srcSurf.getImageSurface();
      if (bgcolor != null) {
        bgcolor=null;
      }
    }
    long srcSurfStruct=srcSurf.getSurfaceDataPtr();
    Object srcData=srcSurf.getData();
    if (comp instanceof AlphaComposite) {
      AlphaComposite ac=(AlphaComposite)comp;
      int compType=ac.getRule();
      float alpha=ac.getAlpha();
      if (bgcolor != null) {
        bltBG(srcX,srcY,srcSurfStruct,srcData,dstX,dstY,dstSurfStruct,dstData,width,height,bgcolor.getRGB(),compType,alpha,clipRects,srcSurf.invalidated());
        dstSurf.invalidate();
        srcSurf.validate();
      }
 else {
        blt(srcX,srcY,srcSurfStruct,srcData,dstX,dstY,dstSurfStruct,dstData,width,height,compType,alpha,clipRects,srcSurf.invalidated());
        dstSurf.invalidate();
        srcSurf.validate();
      }
    }
 else     if (comp instanceof XORComposite) {
      XORComposite xcomp=(XORComposite)comp;
      xor(srcX,srcY,srcSurfStruct,srcData,dstX,dstY,dstSurfStruct,dstData,width,height,xcomp.getXORColor().getRGB(),clipRects,srcSurf.invalidated());
      dstSurf.invalidate();
      srcSurf.validate();
    }
 else {
      if (srcSurf instanceof ImageSurface) {
        JavaBlitter.inst.blit(srcX,srcY,srcSurf,dstX,dstY,dstSurf,width,height,comp,bgcolor,clip);
      }
 else {
        int w=srcSurf.getWidth();
        int h=srcSurf.getHeight();
        BufferedImage tmp=new BufferedImage(w,h,BufferedImage.TYPE_INT_RGB);
        Surface tmpSurf=Surface.getImageSurface(tmp);
        long tmpSurfStruct=tmpSurf.getSurfaceDataPtr();
        Object tmpData=tmpSurf.getData();
        int tmpClip[]=new int[]{5,0,0,srcSurf.getWidth(),srcSurf.getHeight()};
        blt(0,0,srcSurfStruct,srcData,0,0,tmpSurfStruct,tmpData,w,h,AlphaComposite.SRC_OVER,1.0f,tmpClip,srcSurf.invalidated());
        srcSurf.validate();
        JavaBlitter.inst.blit(srcX,srcY,tmpSurf,dstX,dstY,dstSurf,width,height,comp,bgcolor,clip);
      }
    }
  }
}
