{
  final Set<UidRange> ranges=new ArraySet<>();
  addUserToRanges(ranges,userHandle,allowedApplications,disallowedApplications);
  if (canHaveRestrictedProfile(userHandle)) {
    final long token=Binder.clearCallingIdentity();
    List<UserInfo> users;
    try {
      users=UserManager.get(mContext).getUsers(true);
    }
  finally {
      Binder.restoreCallingIdentity(token);
    }
    for (    UserInfo user : users) {
      if (user.isRestricted() && (user.restrictedProfileParentId == userHandle)) {
        addUserToRanges(ranges,user.id,allowedApplications,disallowedApplications);
      }
    }
  }
  return ranges;
}
