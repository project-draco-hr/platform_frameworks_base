{
  if (DEBUG) {
    Slog.d(TAG,"deviceAdded(): " + usbDevice);
  }
  boolean isAudioDevice=false;
  int interfaceCount=usbDevice.getInterfaceCount();
  for (int ntrfaceIndex=0; !isAudioDevice && ntrfaceIndex < interfaceCount; ntrfaceIndex++) {
    UsbInterface ntrface=usbDevice.getInterface(ntrfaceIndex);
    if (ntrface.getInterfaceClass() == UsbConstants.USB_CLASS_AUDIO) {
      isAudioDevice=true;
    }
  }
  if (!isAudioDevice) {
    return;
  }
  ArrayList<AlsaCardsParser.AlsaCardRecord> prevScanRecs=mCardsParser.getScanRecords();
  mCardsParser.scan();
  int addedCard=-1;
  ArrayList<AlsaCardsParser.AlsaCardRecord> newScanRecs=mCardsParser.getNewCardRecords(prevScanRecs);
  if (newScanRecs.size() > 0) {
    addedCard=newScanRecs.get(0).mCardNum;
  }
 else {
    addedCard=mCardsParser.getDefaultUsbCard();
  }
  if (mCardsParser.isCardUsb(addedCard)) {
    selectAudioCard(addedCard);
    mAudioDevices.put(usbDevice,mSelectedAudioDevice);
    boolean hasMidi=mDevicesParser.hasMIDIDevices(addedCard);
    if (hasMidi) {
      int device=mDevicesParser.getDefaultDeviceNum(addedCard);
      AlsaDevice alsaDevice=waitForAlsaDevice(addedCard,device,AlsaDevice.TYPE_MIDI);
      if (alsaDevice != null) {
        UsbMidiDevice usbMidiDevice=UsbMidiDevice.create(mContext,usbDevice,alsaDevice.mCard,alsaDevice.mDevice);
        if (usbMidiDevice != null) {
          mMidiDevices.put(usbDevice,usbMidiDevice);
        }
      }
    }
  }
}
