{
  if (DEBUG) {
    Slog.d(TAG,"deviceAdded(): " + usbDevice.getManufacturerName() + "nm:"+ usbDevice.getProductName());
  }
  boolean isAudioDevice=false;
  int interfaceCount=usbDevice.getInterfaceCount();
  for (int ntrfaceIndex=0; !isAudioDevice && ntrfaceIndex < interfaceCount; ntrfaceIndex++) {
    UsbInterface ntrface=usbDevice.getInterface(ntrfaceIndex);
    if (ntrface.getInterfaceClass() == UsbConstants.USB_CLASS_AUDIO) {
      isAudioDevice=true;
    }
  }
  if (!isAudioDevice) {
    return;
  }
  ArrayList<AlsaCardsParser.AlsaCardRecord> prevScanRecs=mCardsParser.getScanRecords();
  mCardsParser.scan();
  int addedCard=-1;
  ArrayList<AlsaCardsParser.AlsaCardRecord> newScanRecs=mCardsParser.getNewCardRecords(prevScanRecs);
  if (newScanRecs.size() > 0) {
    addedCard=newScanRecs.get(0).mCardNum;
  }
 else {
    addedCard=mCardsParser.getDefaultUsbCard();
  }
  if (mCardsParser.isCardUsb(addedCard)) {
    UsbAudioDevice audioDevice=selectAudioCard(addedCard);
    if (audioDevice != null) {
      mAudioDevices.put(usbDevice,audioDevice);
    }
    boolean hasMidi=mDevicesParser.hasMIDIDevices(addedCard);
    if (hasMidi && mHasMidiFeature) {
      int device=mDevicesParser.getDefaultDeviceNum(addedCard);
      AlsaDevice alsaDevice=waitForAlsaDevice(addedCard,device,AlsaDevice.TYPE_MIDI);
      if (alsaDevice != null) {
        Bundle properties=new Bundle();
        String manufacturer=usbDevice.getManufacturerName();
        String product=usbDevice.getProductName();
        String name;
        if (manufacturer == null || manufacturer.isEmpty()) {
          name=product;
        }
 else         if (product == null || product.isEmpty()) {
          name=manufacturer;
        }
 else {
          name=manufacturer + " " + product;
        }
        properties.putString(MidiDeviceInfo.PROPERTY_NAME,name);
        properties.putString(MidiDeviceInfo.PROPERTY_MANUFACTURER,manufacturer);
        properties.putString(MidiDeviceInfo.PROPERTY_PRODUCT,product);
        properties.putString(MidiDeviceInfo.PROPERTY_SERIAL_NUMBER,usbDevice.getSerialNumber());
        properties.putInt(MidiDeviceInfo.PROPERTY_ALSA_CARD,alsaDevice.mCard);
        properties.putInt(MidiDeviceInfo.PROPERTY_ALSA_DEVICE,alsaDevice.mDevice);
        properties.putParcelable(MidiDeviceInfo.PROPERTY_USB_DEVICE,usbDevice);
        UsbMidiDevice usbMidiDevice=UsbMidiDevice.create(mContext,properties,alsaDevice.mCard,alsaDevice.mDevice);
        if (usbMidiDevice != null) {
          mMidiDevices.put(usbDevice,usbMidiDevice);
        }
      }
    }
  }
}
