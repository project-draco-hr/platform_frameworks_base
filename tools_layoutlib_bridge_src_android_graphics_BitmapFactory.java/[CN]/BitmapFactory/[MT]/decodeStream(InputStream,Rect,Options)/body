{
  if (is == null) {
    return null;
  }
  boolean isNinePatch=is instanceof NinePatchInputStream;
  if (!is.markSupported()) {
    is=new BufferedInputStream(is,16 * 1024);
  }
  is.mark(1024);
  Bitmap bm;
  if (is instanceof AssetManager.AssetInputStream) {
    Bridge.getLog().error(LayoutLog.TAG_UNSUPPORTED,"Bitmap.decodeStream: " + "InputStream is unsupported (AssetManager.AssetInputStream)",null);
    return null;
  }
 else {
    try {
      Density density=Density.MEDIUM;
      if (opts != null) {
        density=Density.getEnum(opts.inDensity);
      }
      if (isNinePatch) {
        NinePatch ninePatch=NinePatch.load(is,true,false);
        bm=Bitmap_Delegate.createBitmap(ninePatch.getImage(),true,density);
        NinePatchChunk chunk=ninePatch.getChunk();
        bm.setNinePatchChunk(NinePatch_Delegate.serialize(chunk));
        int[] padding=chunk.getPadding();
        outPadding.left=padding[0];
        outPadding.top=padding[1];
        outPadding.right=padding[2];
        outPadding.bottom=padding[3];
      }
 else {
        bm=Bitmap_Delegate.createBitmap(is,true,density);
      }
    }
 catch (    IOException e) {
      return null;
    }
  }
  return finishDecode(bm,outPadding,opts);
}
