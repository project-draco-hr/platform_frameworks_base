{
  mNetwork=network;
  mLinkProperties=lp;
  mInterfaceIndex=getInterfaceIndex(mLinkProperties.getInterfaceName());
  mTimeoutMs=timeoutMs;
  mStartTime=now();
  mDeadlineTime=mStartTime + mTimeoutMs;
  if (mLinkProperties.isReachable(TEST_DNS4)) {
    mLinkProperties.addDnsServer(TEST_DNS4);
  }
  if (mLinkProperties.hasGlobalIPv6Address() || mLinkProperties.hasIPv6DefaultRoute()) {
    mLinkProperties.addDnsServer(TEST_DNS6);
  }
  for (  RouteInfo route : mLinkProperties.getRoutes()) {
    if (route.hasGateway()) {
      InetAddress gateway=route.getGateway();
      prepareIcmpMeasurement(gateway);
      if (route.isIPv6Default()) {
        prepareExplicitSourceIcmpMeasurements(gateway);
      }
    }
  }
  for (  InetAddress nameserver : mLinkProperties.getDnsServers()) {
    prepareIcmpMeasurement(nameserver);
    prepareDnsMeasurement(nameserver);
  }
  mCountDownLatch=new CountDownLatch(totalMeasurementCount());
  startMeasurements();
  mDescription="ifaces{" + TextUtils.join(",",mLinkProperties.getAllInterfaceNames()) + "}"+ " index{"+ mInterfaceIndex+ "}"+ " network{"+ mNetwork+ "}"+ " nethandle{"+ mNetwork.getNetworkHandle()+ "}";
}
