{
  new Thread(new Runnable(){
    public void run(){
      Log.i(TAG,"VPN connectivity monitor running");
      try {
        mNotification.update(mStartTime);
        for (int i=10; ; i--) {
          long now=System.currentTimeMillis();
          boolean heavyCheck=i == 0;
synchronized (VpnService.this) {
            if (mState != VpnState.CONNECTED)             break;
            mNotification.update(now);
            if (heavyCheck) {
              i=10;
              if (checkConnectivity())               checkDns();
            }
            long t=1000L - System.currentTimeMillis() + now;
            if (t > 100L)             VpnService.this.wait(t);
          }
        }
      }
 catch (      InterruptedException e) {
        onError(e);
      }
      Log.i(TAG,"VPN connectivity monitor stopped");
    }
  }
).start();
}
