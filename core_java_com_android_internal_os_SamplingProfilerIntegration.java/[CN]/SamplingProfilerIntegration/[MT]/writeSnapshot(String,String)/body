{
  byte[] snapshot=SamplingProfiler.getInstance().snapshot();
  if (snapshot == null) {
    return;
  }
  long start=System.currentTimeMillis();
  String path=dir + "/" + name.replace(':','.')+ "-"+ +System.currentTimeMillis()+ ".snapshot";
  try {
    FileOutputStream out;
    int count=0;
    while (true) {
      try {
        out=new FileOutputStream(path);
        break;
      }
 catch (      FileNotFoundException e) {
        if (++count > 3) {
          Log.e(TAG,"Could not open " + path + ".");
          return;
        }
        try {
          Thread.sleep(2500);
        }
 catch (        InterruptedException e1) {
        }
      }
    }
    try {
      out.write(snapshot);
    }
  finally {
      out.close();
    }
    long elapsed=System.currentTimeMillis() - start;
    Log.i(TAG,"Wrote snapshot for " + name + " in "+ elapsed+ "ms.");
  }
 catch (  IOException e) {
    Log.e(TAG,"Error writing snapshot.",e);
  }
}
