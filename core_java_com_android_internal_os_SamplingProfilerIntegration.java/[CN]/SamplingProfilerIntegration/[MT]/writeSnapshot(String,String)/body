{
  if (!enabled) {
    return;
  }
  INSTANCE.stop();
  long start=System.currentTimeMillis();
  String path=dir + "/" + name.replace(':','.')+ "-"+ System.currentTimeMillis()+ ".snapshot";
  PrintStream out;
  int count=0;
  while (true) {
    try {
      out=new PrintStream(new BufferedOutputStream(new FileOutputStream(path)));
      break;
    }
 catch (    FileNotFoundException e) {
      if (++count > 3) {
        Log.e(TAG,"Could not open " + path + ".");
        return;
      }
      try {
        Thread.sleep(2500);
      }
 catch (      InterruptedException e1) {
      }
    }
  }
  try {
    INSTANCE.writeHprofData(out);
  }
  finally {
    out.close();
  }
  if (out.checkError()) {
    Log.e(TAG,"Error writing snapshot.");
  }
 else {
    long elapsed=System.currentTimeMillis() - start;
    Log.i(TAG,"Wrote snapshot for " + name + " in "+ elapsed+ "ms.");
  }
}
