{
  byte[] snapshot=SamplingProfiler.getInstance().snapshot();
  if (snapshot == null) {
    return;
  }
  long start=System.currentTimeMillis();
  String name=processName.replaceAll(":",".");
  String path=dir + "/" + name+ "-"+ System.currentTimeMillis()+ ".snapshot";
  FileOutputStream out=null;
  try {
    out=new FileOutputStream(path);
    generateSnapshotHeader(name,packageInfo,out);
    out.write(snapshot);
  }
 catch (  IOException e) {
    Log.e(TAG,"Error writing snapshot.",e);
  }
 finally {
    try {
      if (out != null) {
        out.close();
      }
    }
 catch (    IOException ex) {
    }
  }
  new File(path).setReadable(true,false);
  long elapsed=System.currentTimeMillis() - start;
  Log.i(TAG,"Wrote snapshot for " + name + " in "+ elapsed+ "ms.");
}
