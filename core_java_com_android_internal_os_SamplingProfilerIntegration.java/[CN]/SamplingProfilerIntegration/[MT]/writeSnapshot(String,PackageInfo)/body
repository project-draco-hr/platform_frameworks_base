{
  if (!enabled)   return;
  if (pending.compareAndSet(false,true)) {
    snapshotWriter.execute(new Runnable(){
      public void run(){
        if (!dirMade) {
          File dir=new File(SNAPSHOT_DIR);
          dir.mkdirs();
          dir.setWritable(true,false);
          dir.setExecutable(true,false);
          if (new File(SNAPSHOT_DIR).isDirectory()) {
            dirMade=true;
          }
 else {
            Log.w(TAG,"Creation of " + SNAPSHOT_DIR + " failed.");
            pending.set(false);
            return;
          }
        }
        try {
          writeSnapshot(SNAPSHOT_DIR,processName,packageInfo);
        }
  finally {
          pending.set(false);
        }
      }
    }
);
  }
}
