{
  long ident=Binder.clearCallingIdentity();
  try {
    if (state == TelephonyManager.CALL_STATE_IDLE) {
      mBatteryStats.notePhoneOff();
    }
 else {
      mBatteryStats.notePhoneOn();
    }
  }
 catch (  RemoteException e) {
  }
 finally {
    Binder.restoreCallingIdentity(ident);
  }
  Intent intent=new Intent(TelephonyManager.ACTION_PHONE_STATE_CHANGED);
  intent.putExtra(PhoneConstants.STATE_KEY,DefaultPhoneNotifier.convertCallState(state).toString());
  if (!TextUtils.isEmpty(incomingNumber)) {
    intent.putExtra(TelephonyManager.EXTRA_INCOMING_NUMBER,incomingNumber);
  }
  if (subId != SubscriptionManager.INVALID_SUBSCRIPTION_ID) {
    intent.setAction(PhoneConstants.ACTION_SUBSCRIPTION_PHONE_STATE_CHANGED);
    intent.putExtra(PhoneConstants.SUBSCRIPTION_KEY,subId);
  }
  if (phoneId != SubscriptionManager.INVALID_PHONE_INDEX) {
    intent.putExtra(PhoneConstants.SLOT_KEY,phoneId);
  }
  mContext.sendBroadcastAsUser(intent,UserHandle.ALL,android.Manifest.permission.READ_PRIVILEGED_PHONE_STATE);
  mContext.sendBroadcastAsUser(intent,UserHandle.ALL,android.Manifest.permission.READ_PHONE_STATE,AppOpsManager.OP_READ_PHONE_STATE);
}
