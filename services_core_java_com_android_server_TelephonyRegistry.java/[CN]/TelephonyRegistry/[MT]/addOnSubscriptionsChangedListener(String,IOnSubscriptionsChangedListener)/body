{
  int callerUserId=UserHandle.getCallingUserId();
  if (VDBG) {
    log("listen oscl: E pkg=" + callingPackage + " myUserId="+ UserHandle.myUserId()+ " callerUserId="+ callerUserId+ " callback="+ callback+ " callback.asBinder="+ callback.asBinder());
  }
  try {
    mContext.enforceCallingPermission(android.Manifest.permission.READ_PRIVILEGED_PHONE_STATE,"addOnSubscriptionsChangedListener");
  }
 catch (  SecurityException e) {
    mContext.enforceCallingOrSelfPermission(android.Manifest.permission.READ_PHONE_STATE,"addOnSubscriptionsChangedListener");
    if (mAppOps.noteOp(AppOpsManager.OP_READ_PHONE_STATE,Binder.getCallingUid(),callingPackage) != AppOpsManager.MODE_ALLOWED) {
      return;
    }
  }
  Record r;
synchronized (mRecords) {
    find_and_add: {
      IBinder b=callback.asBinder();
      final int N=mRecords.size();
      for (int i=0; i < N; i++) {
        r=mRecords.get(i);
        if (b == r.binder) {
          break find_and_add;
        }
      }
      r=new Record();
      r.binder=b;
      mRecords.add(r);
      if (DBG)       log("listen oscl: add new record");
    }
    r.onSubscriptionsChangedListenerCallback=callback;
    r.callingPackage=callingPackage;
    r.callerUserId=callerUserId;
    r.events=0;
    r.canReadPhoneState=true;
    if (DBG) {
      log("listen oscl:  Register r=" + r);
    }
    if (hasNotifySubscriptionInfoChangedOccurred) {
      try {
        if (VDBG)         log("listen oscl: send to r=" + r);
        r.onSubscriptionsChangedListenerCallback.onSubscriptionsChanged();
        if (VDBG)         log("listen oscl: sent to r=" + r);
      }
 catch (      RemoteException e) {
        if (VDBG)         log("listen oscl: remote exception sending to r=" + r + " e="+ e);
        remove(r.binder);
      }
    }
 else {
      log("listen oscl: hasNotifySubscriptionInfoChangedOccurred==false no callback");
    }
  }
}
