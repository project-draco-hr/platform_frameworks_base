{
  String profileFile=null;
  boolean start=false;
  boolean wall=false;
  int userId=UserHandle.USER_CURRENT;
  int profileType=0;
  mSamplingInterval=0;
  String process=null;
  String cmd=nextArgRequired();
  if ("start".equals(cmd)) {
    start=true;
    String opt;
    while ((opt=nextOption()) != null) {
      if (opt.equals("--user")) {
        userId=parseUserArg(nextArgRequired());
      }
 else       if (opt.equals("--wall")) {
        wall=true;
      }
 else       if (opt.equals("--sampling")) {
        mSamplingInterval=Integer.parseInt(nextArgRequired());
      }
 else {
        System.err.println("Error: Unknown option: " + opt);
        return;
      }
    }
    process=nextArgRequired();
  }
 else   if ("stop".equals(cmd)) {
    String opt;
    while ((opt=nextOption()) != null) {
      if (opt.equals("--user")) {
        userId=parseUserArg(nextArgRequired());
      }
 else {
        System.err.println("Error: Unknown option: " + opt);
        return;
      }
    }
    process=nextArg();
  }
 else {
    process=cmd;
    cmd=nextArgRequired();
    if ("start".equals(cmd)) {
      start=true;
    }
 else     if (!"stop".equals(cmd)) {
      throw new IllegalArgumentException("Profile command " + process + " not valid");
    }
  }
  if (userId == UserHandle.USER_ALL) {
    System.err.println("Error: Can't profile with user 'all'");
    return;
  }
  ParcelFileDescriptor fd=null;
  ProfilerInfo profilerInfo=null;
  if (start) {
    profileFile=nextArgRequired();
    try {
      fd=openForSystemServer(new File(profileFile),ParcelFileDescriptor.MODE_CREATE | ParcelFileDescriptor.MODE_TRUNCATE | ParcelFileDescriptor.MODE_WRITE_ONLY);
    }
 catch (    FileNotFoundException e) {
      System.err.println("Error: Unable to open file: " + profileFile);
      System.err.println("Consider using a file under /data/local/tmp/");
      return;
    }
    profilerInfo=new ProfilerInfo(profileFile,fd,mSamplingInterval,false);
  }
  try {
    if (wall) {
      String props=SystemProperties.get("dalvik.vm.extra-opts");
      if (props == null || !props.contains("-Xprofile:wallclock")) {
        props=props + " -Xprofile:wallclock";
      }
    }
 else     if (start) {
    }
    if (!mAm.profileControl(process,userId,start,profilerInfo,profileType)) {
      wall=false;
      throw new AndroidException("PROFILE FAILED on process " + process);
    }
  }
  finally {
    if (!wall) {
    }
  }
}
