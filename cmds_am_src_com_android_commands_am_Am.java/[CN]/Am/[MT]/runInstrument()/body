{
  String profileFile=null;
  boolean wait=false;
  boolean rawMode=false;
  boolean no_window_animation=false;
  Bundle args=new Bundle();
  String argKey=null, argValue=null;
  IWindowManager wm=IWindowManager.Stub.asInterface(ServiceManager.getService("window"));
  String opt;
  while ((opt=nextOption()) != null) {
    if (opt.equals("-p")) {
      profileFile=nextArgRequired();
    }
 else     if (opt.equals("-w")) {
      wait=true;
    }
 else     if (opt.equals("-r")) {
      rawMode=true;
    }
 else     if (opt.equals("-e")) {
      argKey=nextArgRequired();
      argValue=nextArgRequired();
      args.putString(argKey,argValue);
    }
 else     if (opt.equals("--no_window_animation") || opt.equals("--no-window-animation")) {
      no_window_animation=true;
    }
 else {
      System.err.println("Error: Unknown option: " + opt);
      return;
    }
  }
  String cnArg=nextArgRequired();
  ComponentName cn=ComponentName.unflattenFromString(cnArg);
  if (cn == null)   throw new IllegalArgumentException("Bad component name: " + cnArg);
  InstrumentationWatcher watcher=null;
  if (wait) {
    watcher=new InstrumentationWatcher();
    watcher.setRawOutput(rawMode);
  }
  float[] oldAnims=null;
  if (no_window_animation) {
    oldAnims=wm.getAnimationScales();
    wm.setAnimationScale(0,0.0f);
    wm.setAnimationScale(1,0.0f);
  }
  if (!mAm.startInstrumentation(cn,profileFile,0,args,watcher)) {
    throw new AndroidException("INSTRUMENTATION_FAILED: " + cn.flattenToString());
  }
  if (watcher != null) {
    if (!watcher.waitForFinish()) {
      System.out.println("INSTRUMENTATION_ABORTED: System has crashed.");
    }
  }
  if (oldAnims != null) {
    wm.setAnimationScales(oldAnims);
  }
}
