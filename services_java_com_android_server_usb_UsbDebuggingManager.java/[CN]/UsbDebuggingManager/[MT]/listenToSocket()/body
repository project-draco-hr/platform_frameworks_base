{
  try {
    byte[] buffer=new byte[BUFFER_SIZE];
    LocalSocketAddress address=new LocalSocketAddress(ADBD_SOCKET,LocalSocketAddress.Namespace.RESERVED);
    InputStream inputStream=null;
    mSocket=new LocalSocket();
    mSocket.connect(address);
    mOutputStream=mSocket.getOutputStream();
    inputStream=mSocket.getInputStream();
    while (true) {
      int count=inputStream.read(buffer);
      if (count < 0) {
        Slog.e(TAG,"got " + count + " reading");
        break;
      }
      if (buffer[0] == 'P' && buffer[1] == 'K') {
        String key=new String(Arrays.copyOfRange(buffer,2,count));
        Slog.d(TAG,"Received public key: " + key);
        Message msg=mHandler.obtainMessage(UsbDebuggingHandler.MESSAGE_ADB_CONFIRM);
        msg.obj=key;
        mHandler.sendMessage(msg);
      }
 else {
        Slog.e(TAG,"Wrong message: " + (new String(Arrays.copyOfRange(buffer,0,2))));
        break;
      }
    }
  }
 catch (  IOException ex) {
    Slog.e(TAG,"Communication error: ",ex);
    throw ex;
  }
 finally {
    closeSocket();
  }
}
