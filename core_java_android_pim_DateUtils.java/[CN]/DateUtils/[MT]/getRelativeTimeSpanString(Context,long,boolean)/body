{
  long span=System.currentTimeMillis() - millis;
  Resources res=c.getResources();
  if (sNowTime == null) {
    sNowTime=new Time();
    sThenTime=new Time();
    sMonthDayFormat=res.getString(com.android.internal.R.string.abbrev_month_day);
  }
  sNowTime.setToNow();
  sThenTime.set(millis);
  if (span < DAY_IN_MILLIS && sNowTime.weekDay == sThenTime.weekDay) {
    return getPrepositionDate(res,sThenTime,R.string.preposition_for_time,HOUR_MINUTE_CAP_AMPM,withPreposition);
  }
 else   if (sNowTime.year != sThenTime.year) {
    return getPrepositionDate(res,sThenTime,R.string.preposition_for_year,NUMERIC_MONTH_FORMAT + "/" + MONTH_DAY_FORMAT+ "/"+ YEAR_FORMAT_TWO_DIGITS,withPreposition);
  }
 else {
    return getPrepositionDate(res,sThenTime,R.string.preposition_for_date,sMonthDayFormat,withPreposition);
  }
}
