{
  if (!mChanged)   return;
  try {
    File file=new File(mGestureFileName);
    if (!file.getParentFile().exists()) {
      file.getParentFile().mkdirs();
    }
    if (Config.DEBUG) {
      Log.v(LOGTAG,"Save to " + mGestureFileName);
    }
    BufferedOutputStream outputStream=new BufferedOutputStream(new FileOutputStream(mGestureFileName),GestureConstants.IO_BUFFER_SIZE);
    PrintWriter writer=new PrintWriter(outputStream);
    XmlSerializer serializer=Xml.newSerializer();
    serializer.setOutput(writer);
    serializer.startDocument(Encoding.ISO_8859_1.name(),null);
    serializer.startTag(NAMESPACE,GestureConstants.XML_TAG_LIBRARY);
    HashMap<String,ArrayList<Gesture>> maps=mEntryName2gestures;
    Iterator<String> it=maps.keySet().iterator();
    while (it.hasNext()) {
      String key=it.next();
      ArrayList<Gesture> examples=maps.get(key);
      serializer.startTag(NAMESPACE,GestureConstants.XML_TAG_ENTRY);
      serializer.attribute(NAMESPACE,GestureConstants.XML_TAG_NAME,key);
      int count=examples.size();
      for (int i=0; i < count; i++) {
        Gesture gesture=examples.get(i);
        gesture.toXML(NAMESPACE,serializer);
      }
      serializer.endTag(NAMESPACE,GestureConstants.XML_TAG_ENTRY);
    }
    serializer.endTag(NAMESPACE,GestureConstants.XML_TAG_LIBRARY);
    serializer.endDocument();
    serializer.flush();
    writer.close();
    outputStream.close();
    mChanged=false;
  }
 catch (  IOException ex) {
    Log.d(LOGTAG,"Failed to save gestures:",ex);
  }
}
