{
  mBackupDataName.delete();
  mStageName.delete();
  try {
    if (mBackupData != null)     mBackupData.close();
  }
 catch (  IOException e) {
  }
  try {
    if (mNewState != null)     mNewState.close();
  }
 catch (  IOException e) {
  }
  mBackupData=mNewState=null;
  mNewStateName.delete();
  if (mCurrentPackage.applicationInfo != null) {
    try {
      mActivityManager.unbindBackupAgent(mCurrentPackage.applicationInfo);
      final int appFlags=mCurrentPackage.applicationInfo.flags;
      final boolean killAfterRestore=(mRestoreDescription.getDataType() == RestoreDescription.TYPE_FULL_STREAM) || ((appFlags & ApplicationInfo.FLAG_KILL_AFTER_RESTORE) != 0);
      if (mTargetPackage == null && killAfterRestore) {
        if (DEBUG)         Slog.d(TAG,"Restore complete, killing host process of " + mCurrentPackage.applicationInfo.processName);
        mActivityManager.killApplicationProcess(mCurrentPackage.applicationInfo.processName,mCurrentPackage.applicationInfo.uid);
      }
    }
 catch (    RemoteException e) {
    }
  }
  mBackupHandler.removeMessages(MSG_TIMEOUT,this);
synchronized (mCurrentOpLock) {
    mCurrentOperations.clear();
  }
}
