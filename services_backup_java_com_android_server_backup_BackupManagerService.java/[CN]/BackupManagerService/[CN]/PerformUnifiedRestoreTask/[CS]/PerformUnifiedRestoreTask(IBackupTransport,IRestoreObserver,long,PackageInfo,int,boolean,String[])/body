{
  mState=UnifiedRestoreState.INITIAL;
  mStartRealtime=SystemClock.elapsedRealtime();
  mTransport=transport;
  mObserver=observer;
  mToken=restoreSetToken;
  mPmToken=pmToken;
  mTargetPackage=targetPackage;
  mIsSystemRestore=isFullSystemRestore;
  mFinished=false;
  if (targetPackage != null) {
    mAcceptSet=new ArrayList<PackageInfo>();
    mAcceptSet.add(targetPackage);
  }
 else {
    if (filterSet == null) {
      List<PackageInfo> apps=PackageManagerBackupAgent.getStorableApplications(mPackageManager);
      filterSet=packagesToNames(apps);
      if (DEBUG) {
        Slog.i(TAG,"Full restore; asking about " + filterSet.length + " apps");
      }
    }
    mAcceptSet=new ArrayList<PackageInfo>(filterSet.length);
    boolean hasSystem=false;
    boolean hasSettings=false;
    for (int i=0; i < filterSet.length; i++) {
      try {
        PackageInfo info=mPackageManager.getPackageInfo(filterSet[i],0);
        if ("android".equals(info.packageName)) {
          hasSystem=true;
          continue;
        }
        if (SETTINGS_PACKAGE.equals(info.packageName)) {
          hasSettings=true;
          continue;
        }
        if (appIsEligibleForBackup(info.applicationInfo)) {
          mAcceptSet.add(info);
        }
      }
 catch (      NameNotFoundException e) {
      }
    }
    if (hasSystem) {
      try {
        mAcceptSet.add(0,mPackageManager.getPackageInfo("android",0));
      }
 catch (      NameNotFoundException e) {
      }
    }
    if (hasSettings) {
      try {
        mAcceptSet.add(mPackageManager.getPackageInfo(SETTINGS_PACKAGE,0));
      }
 catch (      NameNotFoundException e) {
      }
    }
  }
  if (MORE_DEBUG) {
    Slog.v(TAG,"Restore; accept set size is " + mAcceptSet.size());
    for (    PackageInfo info : mAcceptSet) {
      Slog.v(TAG,"   " + info.packageName);
    }
  }
}
