{
  IBackupAgent agent=null;
synchronized (mAgentConnectLock) {
    mConnecting=true;
    mConnectedAgent=null;
    try {
      if (mActivityManager.bindBackupAgent(app.packageName,mode,UserHandle.USER_OWNER)) {
        Slog.d(TAG,"awaiting agent for " + app);
        long timeoutMark=System.currentTimeMillis() + TIMEOUT_INTERVAL;
        while (mConnecting && mConnectedAgent == null && (System.currentTimeMillis() < timeoutMark)) {
          try {
            mAgentConnectLock.wait(5000);
          }
 catch (          InterruptedException e) {
            if (DEBUG)             Slog.w(TAG,"Interrupted: " + e);
            mActivityManager.clearPendingBackup();
            return null;
          }
        }
        if (mConnecting == true) {
          Slog.w(TAG,"Timeout waiting for agent " + app);
          mActivityManager.clearPendingBackup();
          return null;
        }
        if (DEBUG)         Slog.i(TAG,"got agent " + mConnectedAgent);
        agent=mConnectedAgent;
      }
    }
 catch (    RemoteException e) {
    }
  }
  return agent;
}
