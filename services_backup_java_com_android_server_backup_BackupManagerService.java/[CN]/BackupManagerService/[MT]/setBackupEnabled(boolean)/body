{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BACKUP,"setBackupEnabled");
  Slog.i(TAG,"Backup enabled => " + enable);
  long oldId=Binder.clearCallingIdentity();
  try {
    boolean wasEnabled=mEnabled;
synchronized (this) {
      Settings.Secure.putInt(mContext.getContentResolver(),Settings.Secure.BACKUP_ENABLED,enable ? 1 : 0);
      mEnabled=enable;
    }
synchronized (mQueueLock) {
      if (enable && !wasEnabled && mProvisioned) {
        KeyValueBackupJob.schedule(mContext);
        scheduleNextFullBackupJob();
      }
 else       if (!enable) {
        if (DEBUG)         Slog.i(TAG,"Opting out of backup");
        KeyValueBackupJob.cancel(mContext);
        if (wasEnabled && mProvisioned) {
          HashSet<String> allTransports;
synchronized (mTransports) {
            allTransports=new HashSet<String>(mTransports.keySet());
          }
          for (          String transport : allTransports) {
            recordInitPendingLocked(true,transport);
          }
          mAlarmManager.set(AlarmManager.RTC_WAKEUP,System.currentTimeMillis(),mRunInitIntent);
        }
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(oldId);
  }
}
