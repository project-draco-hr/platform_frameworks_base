{
  final String key=data.getKey();
  if (isKeyInList(key,mKeys)) {
    if (key.equals(WALLPAPER_IMAGE_KEY)) {
      File f=new File(STAGE_FILE);
      if (writeFile(f,data)) {
        BitmapFactory.Options options=new BitmapFactory.Options();
        options.inJustDecodeBounds=true;
        BitmapFactory.decodeFile(STAGE_FILE,options);
        if (DEBUG)         Slog.d(TAG,"Restoring wallpaper image w=" + options.outWidth + " h="+ options.outHeight);
        final double heightRatio=mDesiredMinHeight / options.outHeight;
        if (options.outWidth >= mDesiredMinWidth && heightRatio > 0 && heightRatio < 1.33) {
          Slog.d(TAG,"Applying restored wallpaper image.");
          f.renameTo(new File(WALLPAPER_IMAGE));
        }
 else {
          Slog.i(TAG,"Restored image dimensions (w=" + options.outWidth + ", h="+ options.outHeight+ ") too far off target (tw="+ mDesiredMinWidth+ ", th="+ mDesiredMinHeight+ "); falling back to default wallpaper.");
          f.delete();
        }
      }
    }
 else     if (key.equals(WALLPAPER_INFO_KEY)) {
      File f=new File(WALLPAPER_INFO);
      writeFile(f,data);
    }
  }
}
