{
  final int powerState;
  final int goToSleepReason;
synchronized (mLock) {
    if (mActualPowerState == POWER_STATE_UNKNOWN || mActualPowerState == mBroadcastedPowerState) {
      mBroadcastInProgress=false;
      mSuspendBlocker.release();
      return;
    }
    powerState=mActualPowerState;
    goToSleepReason=mLastGoToSleepReason;
    mBroadcastedPowerState=powerState;
    mBroadcastStartTime=SystemClock.uptimeMillis();
  }
  EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_SEND,1);
  if (powerState == POWER_STATE_AWAKE) {
    sendWakeUpBroadcast();
  }
 else {
    sendGoToSleepBroadcast(goToSleepReason);
  }
}
