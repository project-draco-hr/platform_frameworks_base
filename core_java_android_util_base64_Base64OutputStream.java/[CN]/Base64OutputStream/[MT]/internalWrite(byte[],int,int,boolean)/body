{
  if (encode) {
    estate.output=embiggen(estate.output,len * 8 / 5 + 10);
    Base64.encodeInternal(b,off,len,estate,finish);
    out.write(estate.output,0,estate.op);
  }
 else {
    dstate.output=embiggen(dstate.output,len * 3 / 4 + 10);
    if (!Base64.decodeInternal(b,off,len,dstate,finish)) {
      throw new IOException("bad base-64");
    }
    out.write(dstate.output,0,dstate.op);
  }
}
