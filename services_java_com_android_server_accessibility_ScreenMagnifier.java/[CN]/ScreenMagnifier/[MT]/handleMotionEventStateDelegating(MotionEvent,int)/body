{
  if (event.getActionMasked() == MotionEvent.ACTION_UP) {
    if (mDetectingStateHandler.mDelayedEventQueue == null) {
      transitionToState(STATE_DETECTING);
    }
  }
  if (mNext != null) {
    final float eventX=event.getX();
    final float eventY=event.getY();
    if (mMagnificationController.isMagnifying() && mViewport.getBounds().contains((int)eventX,(int)eventY)) {
      final float scale=mMagnificationController.getScale();
      final float scaledOffsetX=mMagnificationController.getScaledOffsetX();
      final float scaledOffsetY=mMagnificationController.getScaledOffsetY();
      final int pointerCount=event.getPointerCount();
      PointerCoords[] coords=getTempPointerCoordsWithMinSize(pointerCount);
      PointerProperties[] properties=getTempPointerPropertiesWithMinSize(pointerCount);
      for (int i=0; i < pointerCount; i++) {
        event.getPointerCoords(i,coords[i]);
        coords[i].x=(coords[i].x - scaledOffsetX) / scale;
        coords[i].y=(coords[i].y - scaledOffsetY) / scale;
        event.getPointerProperties(i,properties[i]);
      }
      event=MotionEvent.obtain(event.getDownTime(),event.getEventTime(),event.getAction(),pointerCount,properties,coords,0,0,1.0f,1.0f,event.getDeviceId(),0,event.getSource(),event.getFlags());
    }
    mNext.onMotionEvent(event,policyFlags);
  }
}
