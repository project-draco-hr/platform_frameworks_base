{
  if (tv.isFocusedTask()) {
    tv.unsetFocusedTask();
  }
  TaskViewTransform transform=new TaskViewTransform();
  transform=stackView.getStackAlgorithm().getStackTransform(tv.mTask,stackScroll,transform,null);
  float scale=tv.getScaleX();
  int fromHeaderWidth=(int)(tv.mHeaderView.getMeasuredWidth() * scale);
  int fromHeaderHeight=(int)(tv.mHeaderView.getMeasuredHeight() * scale);
  Bitmap b=null;
  if (addHeaderBitmap) {
    b=Bitmap.createBitmap(fromHeaderWidth,fromHeaderHeight,Bitmap.Config.ARGB_8888);
    if (Constants.DebugFlags.App.EnableTransitionThumbnailDebugMode) {
      b.eraseColor(0xFFff0000);
    }
 else {
      Canvas c=new Canvas(b);
      c.scale(tv.getScaleX(),tv.getScaleY());
      tv.mHeaderView.draw(c);
      c.setBitmap(null);
    }
    b=b.createAshmemBitmap();
  }
  int[] pts=new int[2];
  tv.getLocationOnScreen(pts);
  final int left=pts[0] + offsetX;
  final int top=pts[1] + offsetY;
  final Rect rect=new Rect(left,top,left + transform.rect.width(),top + transform.rect.height());
  return new AppTransitionAnimationSpec(taskId,b,rect);
}
