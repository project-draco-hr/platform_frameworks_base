{
  mSmallSize=small;
  mMaximumStretch=mSmallSize * STRETCH_INTERVAL;
  mLargeSize=large;
  mContext=context;
  mCallback=callback;
  popStack=new Stack<PopState>();
  mScaler=new ViewScaler();
  mGravity=Gravity.TOP;
  mScaleAnimation=ObjectAnimator.ofFloat(mScaler,"height",0f);
  mScaleAnimation.setDuration(EXPAND_DURATION);
  mPopLimit=mContext.getResources().getDimension(R.dimen.one_finger_pop_limit);
  mPopDuration=mContext.getResources().getInteger(R.integer.one_finger_pop_duration_ms);
  AnimatorListenerAdapter glowVisibilityController=new AnimatorListenerAdapter(){
    @Override public void onAnimationStart(    Animator animation){
      View target=(View)((ObjectAnimator)animation).getTarget();
      if (target.getAlpha() <= 0.0f) {
        target.setVisibility(View.VISIBLE);
      }
    }
    @Override public void onAnimationEnd(    Animator animation){
      View target=(View)((ObjectAnimator)animation).getTarget();
      if (target.getAlpha() <= 0.0f) {
        target.setVisibility(View.INVISIBLE);
      }
    }
  }
;
  mGlowTopAnimation=ObjectAnimator.ofFloat(null,"alpha",0f);
  mGlowTopAnimation.addListener(glowVisibilityController);
  mGlowBottomAnimation=ObjectAnimator.ofFloat(null,"alpha",0f);
  mGlowBottomAnimation.addListener(glowVisibilityController);
  mGlowAnimationSet=new AnimatorSet();
  mGlowAnimationSet.play(mGlowTopAnimation).with(mGlowBottomAnimation);
  mGlowAnimationSet.setDuration(GLOW_DURATION);
  final ViewConfiguration configuration=ViewConfiguration.get(mContext);
  mTouchSlop=configuration.getScaledTouchSlop();
  mDetector=new ScaleGestureDetector(context,new ScaleGestureDetector.SimpleOnScaleGestureListener(){
    @Override public boolean onScaleBegin(    ScaleGestureDetector detector){
      if (DEBUG_SCALE)       Slog.v(TAG,"onscalebegin()");
      float x=detector.getFocusX();
      float y=detector.getFocusY();
      mInitialTouchFocusY=detector.getFocusY();
      mInitialTouchSpan=Math.abs(detector.getCurrentSpan());
      if (DEBUG_SCALE)       Slog.d(TAG,"got mInitialTouchSpan: (" + mInitialTouchSpan + ")");
      mStretching=initScale(findView(x,y));
      return mStretching;
    }
    @Override public boolean onScale(    ScaleGestureDetector detector){
      if (DEBUG_SCALE)       Slog.v(TAG,"onscale() on " + mCurrView);
      float span=Math.abs(detector.getCurrentSpan()) - mInitialTouchSpan;
      span*=USE_SPAN ? 1f : 0f;
      float drag=detector.getFocusY() - mInitialTouchFocusY;
      drag*=USE_DRAG ? 1f : 0f;
      drag*=mGravity == Gravity.BOTTOM ? -1f : 1f;
      float pull=Math.abs(drag) + Math.abs(span) + 1f;
      float hand=drag * Math.abs(drag) / pull + span * Math.abs(span) / pull;
      float target=hand + mOldHeight;
      float newHeight=clamp(target);
      mScaler.setHeight(newHeight);
      setGlow(calculateGlow(target,newHeight));
      return true;
    }
    @Override public void onScaleEnd(    ScaleGestureDetector detector){
      if (DEBUG_SCALE)       Slog.v(TAG,"onscaleend()");
      if (DEBUG_SCALE)       Slog.d(TAG,"scale end");
      finishScale(false);
      clearView();
      mStretching=false;
    }
  }
);
}
