{
  SSLSession sslSession=sslSocket.getSession();
  if (!sslSession.isValid()) {
    closeSocketThrowException(sslSocket,"failed to perform SSL handshake");
  }
  Certificate[] peerCertificates=sslSocket.getSession().getPeerCertificates();
  if (peerCertificates == null || peerCertificates.length == 0) {
    closeSocketThrowException(sslSocket,"failed to retrieve peer certificates");
  }
 else {
    if (connection != null) {
      if (peerCertificates[0] != null) {
        connection.setCertificate(new SslCertificate((X509Certificate)peerCertificates[0]));
      }
    }
  }
  return verifyServerDomainAndCertificates((X509Certificate[])peerCertificates,domain,"RSA");
}
