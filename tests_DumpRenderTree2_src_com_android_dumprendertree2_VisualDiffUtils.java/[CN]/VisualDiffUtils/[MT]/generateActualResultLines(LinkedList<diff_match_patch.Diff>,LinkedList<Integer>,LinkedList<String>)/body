{
  String insSpan="<span class=\"ins\">";
  String eqlSpan="<span class=\"eql\">";
  String line="";
  int i=1;
  diff_match_patch.Diff diff;
  int size=diffs.size();
  boolean isLastDiff;
  for (int j=0; j < size; j++) {
    diff=diffs.get(j);
    isLastDiff=j == size - 1;
switch (diff.operation) {
case INSERT:
      line=processDiff(diff,lineNums,lines,line,i,insSpan,isLastDiff);
    if (line.equals("")) {
      i++;
    }
  break;
case DELETE:
if (diff.text.endsWith("\n") || isLastDiff) {
  lineNums.add(line.equals("") ? DONT_PRINT_LINE_NUMBER : i++);
  lines.add(line);
  line="";
}
break;
case EQUAL:
line=processDiff(diff,lineNums,lines,line,i,eqlSpan,isLastDiff);
if (line.equals("")) {
i++;
}
break;
}
}
}
