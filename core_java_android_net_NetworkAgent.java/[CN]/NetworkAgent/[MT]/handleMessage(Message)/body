{
switch (msg.what) {
case AsyncChannel.CMD_CHANNEL_FULL_CONNECTION:
{
      if (mAsyncChannel != null) {
        log("Received new connection while already connected!");
      }
 else {
        if (DBG)         log("NetworkAgent fully connected");
        AsyncChannel ac=new AsyncChannel();
        ac.connected(null,this,msg.replyTo);
        ac.replyToMessage(msg,AsyncChannel.CMD_CHANNEL_FULLY_CONNECTED,AsyncChannel.STATUS_SUCCESSFUL);
synchronized (mPreConnectedQueue) {
          mAsyncChannel=ac;
          for (          Message m : mPreConnectedQueue) {
            ac.sendMessage(m);
          }
          mPreConnectedQueue.clear();
        }
      }
      break;
    }
case AsyncChannel.CMD_CHANNEL_DISCONNECT:
{
    if (DBG)     log("CMD_CHANNEL_DISCONNECT");
    if (mAsyncChannel != null)     mAsyncChannel.disconnect();
    break;
  }
case AsyncChannel.CMD_CHANNEL_DISCONNECTED:
{
  if (DBG)   log("NetworkAgent channel lost");
  unwanted();
synchronized (mPreConnectedQueue) {
    mAsyncChannel=null;
  }
  break;
}
case CMD_SUSPECT_BAD:
{
log("Unhandled Message " + msg);
break;
}
}
}
