{
  ApplicationInfo existingInfo=null;
  try {
    existingInfo=context.getPackageManager().getApplicationInfo(packageName,PackageManager.GET_UNINSTALLED_PACKAGES);
  }
 catch (  NameNotFoundException ignored) {
  }
  final int prefer;
  final boolean checkBoth;
  if ((installFlags & PackageManager.INSTALL_INTERNAL) != 0) {
    prefer=RECOMMEND_INSTALL_INTERNAL;
    checkBoth=false;
  }
 else   if ((installFlags & PackageManager.INSTALL_EXTERNAL) != 0) {
    prefer=RECOMMEND_INSTALL_EXTERNAL;
    checkBoth=false;
  }
 else   if (installLocation == PackageInfo.INSTALL_LOCATION_INTERNAL_ONLY) {
    prefer=RECOMMEND_INSTALL_INTERNAL;
    checkBoth=false;
  }
 else   if (installLocation == PackageInfo.INSTALL_LOCATION_PREFER_EXTERNAL) {
    prefer=RECOMMEND_INSTALL_EXTERNAL;
    checkBoth=true;
  }
 else   if (installLocation == PackageInfo.INSTALL_LOCATION_AUTO) {
    if (existingInfo != null) {
      if ((existingInfo.flags & ApplicationInfo.FLAG_EXTERNAL_STORAGE) != 0) {
        prefer=RECOMMEND_INSTALL_EXTERNAL;
      }
 else {
        prefer=RECOMMEND_INSTALL_INTERNAL;
      }
    }
 else {
      prefer=RECOMMEND_INSTALL_INTERNAL;
    }
    checkBoth=true;
  }
 else {
    prefer=RECOMMEND_INSTALL_INTERNAL;
    checkBoth=false;
  }
  final boolean emulated=Environment.isExternalStorageEmulated();
  final StorageManager storage=StorageManager.from(context);
  boolean fitsOnInternal=false;
  if (checkBoth || prefer == RECOMMEND_INSTALL_INTERNAL) {
    final File target=Environment.getDataDirectory();
    fitsOnInternal=(sizeBytes <= storage.getStorageBytesUntilLow(target));
  }
  boolean fitsOnExternal=false;
  if (!emulated && (checkBoth || prefer == RECOMMEND_INSTALL_EXTERNAL)) {
    final File target=new UserEnvironment(UserHandle.USER_OWNER).getExternalStorageDirectory();
    if (sizeBytes > 0) {
      fitsOnExternal=(sizeBytes <= storage.getStorageBytesUntilLow(target));
    }
  }
  if (prefer == RECOMMEND_INSTALL_INTERNAL) {
    if (fitsOnInternal) {
      return PackageHelper.RECOMMEND_INSTALL_INTERNAL;
    }
  }
 else   if (!emulated && prefer == RECOMMEND_INSTALL_EXTERNAL) {
    if (fitsOnExternal) {
      return PackageHelper.RECOMMEND_INSTALL_EXTERNAL;
    }
  }
  if (checkBoth) {
    if (fitsOnInternal) {
      return PackageHelper.RECOMMEND_INSTALL_INTERNAL;
    }
 else     if (!emulated && fitsOnExternal) {
      return PackageHelper.RECOMMEND_INSTALL_EXTERNAL;
    }
  }
  if (!emulated && (checkBoth || prefer == RECOMMEND_INSTALL_EXTERNAL) && !Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {
    return PackageHelper.RECOMMEND_MEDIA_UNAVAILABLE;
  }
 else {
    return PackageHelper.RECOMMEND_FAILED_INSUFFICIENT_STORAGE;
  }
}
