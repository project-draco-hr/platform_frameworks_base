{
  Credential credential=homeSP.getCredential();
  X509Certificate clientCertificate=null;
  if (clientKey == null || clientChain == null) {
    throw new IOException("No key and/or cert passed for EAP-TLS");
  }
  if (credential.getCertType() != Credential.CertType.x509v3) {
    throw new IOException("Invalid certificate type for TLS: " + credential.getCertType());
  }
  byte[] reference=credential.getFingerPrint();
  MessageDigest digester=MessageDigest.getInstance("SHA-256");
  for (  X509Certificate certificate : clientChain) {
    digester.reset();
    byte[] fingerprint=digester.digest(certificate.getEncoded());
    if (Arrays.equals(reference,fingerprint)) {
      clientCertificate=certificate;
      break;
    }
  }
  if (clientCertificate == null) {
    throw new IOException("No certificate in chain matches supplied fingerprint");
  }
  String alias=Base64.encodeToString(reference,Base64.DEFAULT);
  WifiConfiguration config=buildBaseConfiguration(homeSP);
  WifiEnterpriseConfig enterpriseConfig=config.enterpriseConfig;
  enterpriseConfig.setClientCertificateAlias(alias);
  enterpriseConfig.setClientKeyEntry(clientKey,clientCertificate);
  return config;
}
