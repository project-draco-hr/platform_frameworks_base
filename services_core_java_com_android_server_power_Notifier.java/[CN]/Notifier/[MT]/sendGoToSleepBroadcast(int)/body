{
  if (DEBUG) {
    Slog.d(TAG,"Sending go to sleep broadcast.");
  }
  int why=WindowManagerPolicy.OFF_BECAUSE_OF_USER;
switch (reason) {
case PowerManager.GO_TO_SLEEP_REASON_DEVICE_ADMIN:
    why=WindowManagerPolicy.OFF_BECAUSE_OF_ADMIN;
  break;
case PowerManager.GO_TO_SLEEP_REASON_TIMEOUT:
why=WindowManagerPolicy.OFF_BECAUSE_OF_TIMEOUT;
break;
}
EventLog.writeEvent(EventLogTags.POWER_SCREEN_STATE,0,why,0,0);
mPolicy.screenTurnedOff(why);
mActivityManagerInternal.goingToSleep();
if (ActivityManagerNative.isSystemReady()) {
mContext.sendOrderedBroadcastAsUser(mScreenOffIntent,UserHandle.ALL,null,mGoToSleepBroadcastDone,mHandler,0,null,null);
}
 else {
EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_STOP,3,1);
sendNextBroadcast();
}
}
