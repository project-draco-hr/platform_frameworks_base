{
  final int powerState;
synchronized (mLock) {
    if (mBroadcastedInteractiveState == INTERACTIVE_STATE_UNKNOWN) {
      mPendingWakeUpBroadcast=false;
      mBroadcastedInteractiveState=INTERACTIVE_STATE_AWAKE;
    }
 else     if (mBroadcastedInteractiveState == INTERACTIVE_STATE_AWAKE) {
      if (mPendingWakeUpBroadcast || mPendingGoToSleepBroadcast || mPendingInteractiveState == INTERACTIVE_STATE_ASLEEP) {
        mPendingGoToSleepBroadcast=false;
        mBroadcastedInteractiveState=INTERACTIVE_STATE_ASLEEP;
      }
 else {
        finishPendingBroadcastLocked();
        return;
      }
    }
 else {
      if (mPendingWakeUpBroadcast || mPendingGoToSleepBroadcast || mPendingInteractiveState == INTERACTIVE_STATE_AWAKE) {
        mPendingWakeUpBroadcast=false;
        mBroadcastedInteractiveState=INTERACTIVE_STATE_AWAKE;
      }
 else {
        finishPendingBroadcastLocked();
        return;
      }
    }
    mBroadcastStartTime=SystemClock.uptimeMillis();
    powerState=mBroadcastedInteractiveState;
  }
  EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_SEND,1);
  if (powerState == INTERACTIVE_STATE_AWAKE) {
    sendWakeUpBroadcast();
  }
 else {
    sendGoToSleepBroadcast();
  }
}
