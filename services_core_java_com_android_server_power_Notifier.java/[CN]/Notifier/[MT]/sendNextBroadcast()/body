{
  final int powerState;
synchronized (mLock) {
    if (mBroadcastedPowerState == POWER_STATE_UNKNOWN) {
      mPendingWakeUpBroadcast=false;
      mBroadcastedPowerState=POWER_STATE_AWAKE;
    }
 else     if (mBroadcastedPowerState == POWER_STATE_AWAKE) {
      if (mPendingWakeUpBroadcast || mPendingGoToSleepBroadcast || mActualPowerState == POWER_STATE_ASLEEP) {
        mPendingGoToSleepBroadcast=false;
        mBroadcastedPowerState=POWER_STATE_ASLEEP;
      }
 else {
        finishPendingBroadcastLocked();
        return;
      }
    }
 else {
      if (mPendingWakeUpBroadcast || mPendingGoToSleepBroadcast || mActualPowerState == POWER_STATE_AWAKE) {
        mPendingWakeUpBroadcast=false;
        mBroadcastedPowerState=POWER_STATE_AWAKE;
      }
 else {
        finishPendingBroadcastLocked();
        return;
      }
    }
    mBroadcastStartTime=SystemClock.uptimeMillis();
    powerState=mBroadcastedPowerState;
  }
  EventLog.writeEvent(EventLogTags.POWER_SCREEN_BROADCAST_SEND,1);
  if (powerState == POWER_STATE_AWAKE) {
    sendWakeUpBroadcast();
  }
 else {
    sendGoToSleepBroadcast();
  }
}
