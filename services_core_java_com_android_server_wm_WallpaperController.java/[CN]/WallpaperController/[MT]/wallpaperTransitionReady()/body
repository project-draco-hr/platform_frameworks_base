{
  boolean transitionReady=true;
  boolean wallpaperReady=true;
  for (int curTokenIndex=mWallpaperTokens.size() - 1; curTokenIndex >= 0 && wallpaperReady; curTokenIndex--) {
    WindowToken token=mWallpaperTokens.get(curTokenIndex);
    for (int curWallpaperIndex=token.windows.size() - 1; curWallpaperIndex >= 0; curWallpaperIndex--) {
      WindowState wallpaper=token.windows.get(curWallpaperIndex);
      if (wallpaper.mWallpaperVisible && !wallpaper.isDrawnLw()) {
        wallpaperReady=false;
        if (mWallpaperDrawState != WALLPAPER_DRAW_TIMEOUT) {
          transitionReady=false;
        }
        if (mWallpaperDrawState == WALLPAPER_DRAW_NORMAL) {
          mWallpaperDrawState=WALLPAPER_DRAW_PENDING;
          mService.mH.removeMessages(WALLPAPER_DRAW_PENDING_TIMEOUT);
          mService.mH.sendEmptyMessageDelayed(WALLPAPER_DRAW_PENDING_TIMEOUT,WALLPAPER_DRAW_PENDING_TIMEOUT_DURATION);
        }
        if (DEBUG_APP_TRANSITIONS || DEBUG_WALLPAPER)         Slog.v(TAG,"Wallpaper should be visible but has not been drawn yet. " + "mWallpaperDrawState=" + mWallpaperDrawState);
        break;
      }
    }
  }
  if (wallpaperReady) {
    mWallpaperDrawState=WALLPAPER_DRAW_NORMAL;
    mService.mH.removeMessages(WALLPAPER_DRAW_PENDING_TIMEOUT);
  }
  return transitionReady;
}
