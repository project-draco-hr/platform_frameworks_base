{
  if (mWallpaperTarget != null && (mWallpaperTarget != winGoingAway || mLowerWallpaperTarget != null)) {
    return;
  }
  if (mService.mAppTransition.isRunning()) {
    mDeferredHideWallpaper=winGoingAway;
    return;
  }
  final boolean wasDeferred=(mDeferredHideWallpaper == winGoingAway);
  for (int i=mWallpaperTokens.size() - 1; i >= 0; i--) {
    final WindowToken token=mWallpaperTokens.get(i);
    for (int j=token.windows.size() - 1; j >= 0; j--) {
      final WindowState wallpaper=token.windows.get(j);
      final WindowStateAnimator winAnimator=wallpaper.mWinAnimator;
      if (!winAnimator.mLastHidden || wasDeferred) {
        winAnimator.hide("hideWallpapers");
        dispatchWallpaperVisibility(wallpaper,false);
        final DisplayContent displayContent=wallpaper.getDisplayContent();
        if (displayContent != null) {
          displayContent.pendingLayoutChanges|=WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER;
        }
      }
    }
    if (DEBUG_WALLPAPER_LIGHT && !token.hidden)     Slog.d(TAG,"Hiding wallpaper " + token + " from "+ winGoingAway+ " target="+ mWallpaperTarget+ " lower="+ mLowerWallpaperTarget+ "\n"+ Debug.getCallers(5,"  "));
    token.hidden=true;
  }
}
