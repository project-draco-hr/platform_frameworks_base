{
  int handle;
  Intent intent=null;
  Log.i("CertTool","addCertificate()");
  if (isPkcs12Keystore(data)) {
    intent=prepareIntent(TITLE_PKCS12_KEYSTORE,UNKNOWN,UNKNOWN).addCredential(USER_KEY,data).build();
  }
 else   if ((handle=generateX509Certificate(data)) != 0) {
    String issuer=getIssuerDN(handle);
    String distinctName=getCertificateDN(handle);
    String privateKeyPEM=getPrivateKeyPEM(handle);
    if (isCaCertificate(handle)) {
      intent=prepareIntent(TITLE_CA_CERT,issuer,distinctName).addCredential(CA_CERTIFICATE,data).build();
    }
 else {
      AddCredentialIntentBuilder builder=prepareIntent(TITLE_USER_CERT,issuer,distinctName).addCredential(USER_CERTIFICATE,data);
      if (!TextUtils.isEmpty(privateKeyPEM)) {
        builder.addCredential(USER_KEY,privateKeyPEM.getBytes());
      }
      intent=builder.build();
    }
    freeX509Certificate(handle);
  }
  if (intent != null) {
    context.startActivity(intent);
  }
 else {
    Log.w("CertTool","incorrect data for addCertificate()");
  }
}
