{
  int handle;
  Intent intent=null;
  Log.i("CertTool","addCertificate()");
  if (isPkcs12Keystore(data)) {
    intent=prepareIntent(TITLE_PKCS12_KEYSTORE,data,USER_KEY,UNKNOWN,UNKNOWN);
  }
 else   if ((handle=generateX509Certificate(data)) != 0) {
    String issuer=getIssuerDN(handle);
    String distinctName=getCertificateDN(handle);
    String privateKeyPEM=getPrivateKeyPEM(handle);
    if (isCaCertificate(handle)) {
      intent=prepareIntent(TITLE_CA_CERT,data,CA_CERTIFICATE,issuer,distinctName);
    }
 else {
      intent=prepareIntent(TITLE_USER_CERT,data,USER_CERTIFICATE,issuer,distinctName);
      if (!TextUtils.isEmpty(privateKeyPEM)) {
        addExtraIntentInfo(intent,USER_KEY,privateKeyPEM);
      }
    }
    freeX509Certificate(handle);
  }
  if (intent != null)   context.startActivity(intent);
}
