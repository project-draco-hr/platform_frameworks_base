{
  int handle, i=0;
  String pemData;
  Log.i("CertTool","addPkcs12Keystore()");
  if ((handle=getPkcs12Handle(p12Data,password)) == 0)   return -1;
  if ((pemData=getPkcs12Certificate(handle)) != null) {
    sKeystore.put(USER_CERTIFICATE,keyname,pemData);
  }
  if ((pemData=getPkcs12PrivateKey(handle)) != null) {
    sKeystore.put(USER_KEY,keyname,pemData);
  }
  while ((pemData=this.popPkcs12CertificateStack(handle)) != null) {
    if (i++ > 0) {
      sKeystore.put(CA_CERTIFICATE,keyname + i,pemData);
    }
 else {
      sKeystore.put(CA_CERTIFICATE,keyname,pemData);
    }
  }
  freePkcs12Handle(handle);
  return 0;
}
