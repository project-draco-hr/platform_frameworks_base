{
  Alarm a=new Alarm(type,when,whenElapsed,maxWhen,interval,operation);
  removeLocked(operation);
  final boolean reschedule;
  Batch batch=(isStandalone) ? null : attemptCoalesceLocked(whenElapsed,maxWhen);
  if (batch == null) {
    batch=new Batch(a);
    batch.standalone=isStandalone;
    if (DEBUG_BATCH) {
      Slog.v(TAG,"Starting new alarm batch " + batch);
    }
    reschedule=addBatchLocked(mAlarmBatches,batch);
  }
 else {
    reschedule=batch.add(a);
  }
  if (reschedule) {
    rescheduleKernelAlarmsLocked();
  }
}
