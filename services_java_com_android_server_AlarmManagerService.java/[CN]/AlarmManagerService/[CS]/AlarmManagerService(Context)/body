{
  mContext=context;
  mDescriptor=init();
  mNextWakeup=mNextNonWakeup=0;
  String tz=SystemProperties.get(TIMEZONE_PROPERTY);
  if (tz != null) {
    setTimeZone(tz);
  }
  PowerManager pm=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mWakeLock=pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,TAG);
  mTimeTickSender=PendingIntent.getBroadcastAsUser(context,0,new Intent(Intent.ACTION_TIME_TICK).addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY | Intent.FLAG_RECEIVER_FOREGROUND),0,UserHandle.ALL);
  Intent intent=new Intent(Intent.ACTION_DATE_CHANGED);
  intent.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
  mDateChangeSender=PendingIntent.getBroadcastAsUser(context,0,intent,Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT,UserHandle.ALL);
  mClockReceiver=new ClockReceiver();
  mClockReceiver.scheduleTimeTickEvent();
  mClockReceiver.scheduleDateChangedEvent();
  mUninstallReceiver=new UninstallReceiver();
  if (mDescriptor != -1) {
    mWaitThread.start();
  }
 else {
    Slog.w(TAG,"Failed to open alarm driver. Falling back to a handler.");
  }
}
