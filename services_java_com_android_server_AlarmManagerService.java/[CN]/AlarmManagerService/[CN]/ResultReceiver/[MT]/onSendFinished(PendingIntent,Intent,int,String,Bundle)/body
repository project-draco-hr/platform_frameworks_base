{
synchronized (mLock) {
    BroadcastStats bs=getStatsLocked(pi);
    if (bs != null) {
      bs.nesting--;
      if (bs.nesting <= 0) {
        bs.nesting=0;
        bs.aggregateTime+=SystemClock.elapsedRealtime() - bs.startTime;
        Intent.FilterComparison fc=new Intent.FilterComparison(intent);
        FilterStats fs=bs.filterStats.get(fc);
        if (fs == null) {
          fs=new FilterStats();
          bs.filterStats.put(fc,fs);
        }
        fs.count++;
      }
    }
    mInFlight.removeFirst();
    mBroadcastRefCount--;
    if (mBroadcastRefCount == 0) {
      mWakeLock.release();
    }
 else {
      final PendingIntent nowInFlight=mInFlight.peekFirst();
      if (nowInFlight != null) {
        setWakelockWorkSource(nowInFlight);
      }
 else {
        Slog.e(TAG,"Alarm wakelock still held but sent queue empty");
        mWakeLock.setWorkSource(null);
      }
    }
  }
}
