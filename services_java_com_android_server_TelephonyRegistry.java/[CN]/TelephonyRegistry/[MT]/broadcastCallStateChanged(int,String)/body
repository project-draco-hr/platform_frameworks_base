{
  long ident=Binder.clearCallingIdentity();
  try {
    if (state == TelephonyManager.CALL_STATE_IDLE) {
      mBatteryStats.notePhoneOff();
    }
 else {
      mBatteryStats.notePhoneOn();
    }
  }
 catch (  RemoteException e) {
  }
 finally {
    Binder.restoreCallingIdentity(ident);
  }
  Intent intent=new Intent(TelephonyManager.ACTION_PHONE_STATE_CHANGED);
  intent.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
  intent.putExtra(Phone.STATE_KEY,DefaultPhoneNotifier.convertCallState(state).toString());
  if (!TextUtils.isEmpty(incomingNumber)) {
    intent.putExtra(TelephonyManager.EXTRA_INCOMING_NUMBER,incomingNumber);
  }
  mContext.sendBroadcast(intent,android.Manifest.permission.READ_PHONE_STATE);
}
