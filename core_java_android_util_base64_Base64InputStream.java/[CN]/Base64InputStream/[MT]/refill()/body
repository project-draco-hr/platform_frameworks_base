{
  if (eof)   return;
  int bytesRead=in.read(inputBuffer);
  if (encode) {
    if (bytesRead == -1) {
      eof=true;
      Base64.encodeInternal(EMPTY,0,0,estate,true);
    }
 else {
      Base64.encodeInternal(inputBuffer,0,bytesRead,estate,false);
    }
    outputEnd=estate.op;
  }
 else {
    if (bytesRead == -1) {
      eof=true;
      Base64.decodeInternal(EMPTY,0,0,dstate,true);
    }
 else {
      Base64.decodeInternal(inputBuffer,0,bytesRead,dstate,false);
    }
    outputEnd=dstate.op;
  }
  outputStart=0;
}
