{
  if (DBG)   Log.d(TAG,"addService() - service: " + service.getUuid());
  if (mService == null || mServerIf == 0)   return false;
  mServices.add(service);
  try {
    mService.beginServiceDeclaration(mServerIf,service.getType(),service.getInstanceId(),service.getHandles(),new ParcelUuid(service.getUuid()));
    List<BluetoothGattService> includedServices=service.getIncludedServices();
    for (    BluetoothGattService includedService : includedServices) {
      mService.addIncludedService(mServerIf,includedService.getType(),includedService.getInstanceId(),new ParcelUuid(includedService.getUuid()));
    }
    List<BluetoothGattCharacteristic> characteristics=service.getCharacteristics();
    for (    BluetoothGattCharacteristic characteristic : characteristics) {
      int permission=((characteristic.getKeySize() - 7) << 12) + characteristic.getPermissions();
      mService.addCharacteristic(mServerIf,new ParcelUuid(characteristic.getUuid()),characteristic.getProperties(),permission);
      List<BluetoothGattDescriptor> descriptors=characteristic.getDescriptors();
      for (      BluetoothGattDescriptor descriptor : descriptors) {
        permission=((characteristic.getKeySize() - 7) << 12) + descriptor.getPermissions();
        mService.addDescriptor(mServerIf,new ParcelUuid(descriptor.getUuid()),permission);
      }
    }
    mService.endServiceDeclaration(mServerIf);
  }
 catch (  RemoteException e) {
    Log.e(TAG,"",e);
    return false;
  }
  return true;
}
