{
  final Context context=mContextRef.get();
  if (locale == null) {
    return null;
  }
  if (context == null) {
    throw new RuntimeException("Context was GCed.");
  }
  final String localeStr=locale.toString();
  SpellCheckerConnection connection=null;
synchronized (sComponentMap) {
    if (sComponentMap.containsKey(localeStr)) {
      connection=sComponentMap.get(localeStr);
    }
    if (connection != null && !resetIfChanged) {
      return connection;
    }
    try {
      final SpellCheckerInfo sci=sService.getCurrentSpellChecker(localeStr);
      if (sci == null) {
        return null;
      }
      if (connection != null && connection.getSpellCheckerInfo().getId().equals(sci.getId())) {
        return connection;
      }
      connection=new SpellCheckerConnection(localeStr,sci);
      final Intent serviceIntent=new Intent(SpellCheckerService.SERVICE_INTERFACE);
      serviceIntent.setComponent(sci.getComponent());
      if (!context.bindService(serviceIntent,connection,Context.BIND_AUTO_CREATE)) {
        Log.e(TAG,"Bind to spell checker service failed.");
        return null;
      }
      sComponentMap.put(localeStr,connection);
      return connection;
    }
 catch (    RemoteException e) {
      return null;
    }
  }
}
