{
  mKeyStore.load(null,null);
  KeyFactory keyFact=KeyFactory.getInstance("RSA");
  PrivateKey expectedKey=keyFact.generatePrivate(new PKCS8EncodedKeySpec(FAKE_KEY_1));
  final CertificateFactory f=CertificateFactory.getInstance("X.509");
  final Certificate[] expectedChain=new Certificate[2];
  expectedChain[0]=f.generateCertificate(new ByteArrayInputStream(FAKE_USER_1));
  expectedChain[1]=f.generateCertificate(new ByteArrayInputStream(FAKE_CA_1));
  PrivateKeyEntry entry=new PrivateKeyEntry(expectedKey,expectedChain);
  try {
    mKeyStore.setEntry(TEST_ALIAS_1,entry,new AndroidKeyStoreParameter.Builder(getContext()).setEncryptionRequired().build());
    fail("Shouldn't be able to insert encrypted entry when KeyStore uninitialized");
  }
 catch (  KeyStoreException expected) {
  }
  assertNull(mKeyStore.getEntry(TEST_ALIAS_1,null));
}
