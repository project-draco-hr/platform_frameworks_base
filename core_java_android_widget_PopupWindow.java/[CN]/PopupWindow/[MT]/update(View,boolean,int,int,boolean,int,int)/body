{
  if (!isShowing() || mContentView == null) {
    return;
  }
  final WeakReference<View> oldAnchor=mAnchor;
  final boolean needsUpdate=updateLocation && (mAnchorXoff != xoff || mAnchorYoff != yoff);
  if (oldAnchor == null || oldAnchor.get() != anchor || (needsUpdate && !mIsDropdown)) {
    registerForScrollChanged(anchor,xoff,yoff,mAnchoredGravity);
  }
 else   if (needsUpdate) {
    mAnchorXoff=xoff;
    mAnchorYoff=yoff;
  }
  if (updateDimension) {
    if (width == -1) {
      width=mPopupWidth;
    }
 else {
      mPopupWidth=width;
    }
    if (height == -1) {
      height=mPopupHeight;
    }
 else {
      mPopupHeight=height;
    }
  }
  final WindowManager.LayoutParams p=(WindowManager.LayoutParams)mDecorView.getLayoutParams();
  final int x=p.x;
  final int y=p.y;
  if (updateLocation) {
    updateAboveAnchor(findDropDownPosition(anchor,p,xoff,yoff,mAnchoredGravity));
  }
 else {
    updateAboveAnchor(findDropDownPosition(anchor,p,mAnchorXoff,mAnchorYoff,mAnchoredGravity));
  }
  update(p.x,p.y,width,height,x != p.x || y != p.y);
}
