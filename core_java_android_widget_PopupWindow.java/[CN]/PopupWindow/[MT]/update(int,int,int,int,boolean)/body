{
  if (width != -1) {
    mLastWidth=width;
    setWidth(width);
  }
  if (height != -1) {
    mLastHeight=height;
    setHeight(height);
  }
  if (!isShowing() || mContentView == null) {
    return;
  }
  WindowManager.LayoutParams p=(WindowManager.LayoutParams)mPopupView.getLayoutParams();
  boolean update=force;
  final int finalWidth=mWidthMode < 0 ? mWidthMode : mLastWidth;
  if (width != -1 && p.width != finalWidth) {
    p.width=mLastWidth=finalWidth;
    update=true;
  }
  final int finalHeight=mHeightMode < 0 ? mHeightMode : mLastHeight;
  if (height != -1 && p.height != finalHeight) {
    p.height=mLastHeight=finalHeight;
    update=true;
  }
  if (p.x != x) {
    p.x=x;
    update=true;
  }
  if (p.y != y) {
    p.y=y;
    update=true;
  }
  final int newAnim=computeAnimationResource();
  if (newAnim != p.windowAnimations) {
    p.windowAnimations=newAnim;
    update=true;
  }
  final int newFlags=computeFlags(p.flags);
  if (newFlags != p.flags) {
    p.flags=newFlags;
    update=true;
  }
  if (update) {
    mWindowManager.updateViewLayout(mPopupView,p);
  }
}
