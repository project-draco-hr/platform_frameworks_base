{
  WindowManager.LayoutParams p=new WindowManager.LayoutParams();
  p.gravity=Gravity.START | Gravity.TOP;
  p.width=mLastWidth=mWidth;
  p.height=mLastHeight=mHeight;
  if (mBackground != null) {
    p.format=mBackground.getOpacity();
  }
 else {
    p.format=PixelFormat.TRANSLUCENT;
  }
  p.flags=computeFlags(p.flags);
  p.type=mWindowLayoutType;
  p.token=token;
  p.softInputMode=mSoftInputMode;
  p.setTitle("PopupWindow:" + Integer.toHexString(hashCode()));
  final int shadowInset=(int)Math.ceil(mElevation * 2);
  p.shadowInsets.set(shadowInset,shadowInset,shadowInset,shadowInset);
  return p;
}
