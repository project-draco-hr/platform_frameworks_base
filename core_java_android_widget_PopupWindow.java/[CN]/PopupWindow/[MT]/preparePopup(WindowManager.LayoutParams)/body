{
  if (mContentView == null || mContext == null || mWindowManager == null) {
    throw new IllegalStateException("You must specify a valid content view by " + "calling setContentView() before attempting to show the popup.");
  }
  if (mDecorView != null) {
    mDecorView.cancelTransitions();
  }
  if (mBackground != null) {
    mBackgroundView=createBackgroundView(mContentView);
    mBackgroundView.setBackground(mBackground);
  }
 else {
    mBackgroundView=mContentView;
  }
  mDecorView=createDecorView(mBackgroundView);
  mBackgroundView.setElevation(mElevation);
  final int surfaceInset=(int)Math.ceil(mBackgroundView.getZ() * 2);
  p.surfaceInsets.set(surfaceInset,surfaceInset,surfaceInset,surfaceInset);
  p.hasManualSurfaceInsets=true;
  mPopupViewInitialLayoutDirectionInherited=(mContentView.getRawLayoutDirection() == View.LAYOUT_DIRECTION_INHERIT);
}
