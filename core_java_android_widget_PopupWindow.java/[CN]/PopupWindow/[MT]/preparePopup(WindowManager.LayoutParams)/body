{
  if (mContentView == null || mContext == null || mWindowManager == null) {
    throw new IllegalStateException("You must specify a valid content view by " + "calling setContentView() before attempting to show the popup.");
  }
  if (mDecorView != null) {
    mDecorView.cancelTransitions();
  }
  final View backgroundView;
  if (mBackground != null) {
    backgroundView=createBackgroundView(mContentView);
    backgroundView.setBackground(mBackground);
  }
 else {
    backgroundView=mContentView;
  }
  mDecorView=createDecorView(backgroundView);
  backgroundView.setElevation(mElevation);
  final int surfaceInset=(int)Math.ceil(backgroundView.getZ() * 2);
  p.surfaceInsets.set(surfaceInset,surfaceInset,surfaceInset,surfaceInset);
  p.hasManualSurfaceInsets=true;
  mPopupViewInitialLayoutDirectionInherited=(mContentView.getRawLayoutDirection() == View.LAYOUT_DIRECTION_INHERIT);
  mPopupWidth=p.width;
  mPopupHeight=p.height;
}
