{
  if (getPackageInfo().isShadow()) {
    return;
  }
  final ArraySet<String> pinnedByCallerSet=(callingLauncher == null) ? null : s.getLauncherShortcutsLocked(callingLauncher,getPackageUserId(),launcherUserId).getPinnedShortcutIds(getPackageName(),getPackageUserId());
  for (int i=0; i < mShortcuts.size(); i++) {
    final ShortcutInfo si=mShortcuts.valueAt(i);
    final boolean isPinnedByCaller=(callingLauncher == null) || ((pinnedByCallerSet != null) && pinnedByCallerSet.contains(si.getId()));
    if (!si.isDynamic()) {
      if (!si.isPinned()) {
        s.wtf("Shortcut not pinned: package " + getPackageName() + ", user="+ getPackageUserId()+ ", id="+ si.getId());
        continue;
      }
      if (!isPinnedByCaller) {
        continue;
      }
    }
    final ShortcutInfo clone=si.clone(cloneFlag);
    if (!isPinnedByCaller) {
      clone.clearFlags(ShortcutInfo.FLAG_PINNED);
    }
    if (query == null || query.test(clone)) {
      result.add(clone);
    }
  }
}
