{
  for (int i=mShortcuts.size() - 1; i >= 0; i--) {
    mShortcuts.valueAt(i).clearFlags(ShortcutInfo.FLAG_PINNED);
  }
  final ArrayMap<ShortcutUser.PackageWithUser,ShortcutLauncher> launchers=s.getUserShortcutsLocked(getPackageUserId()).getAllLaunchers();
  for (int l=launchers.size() - 1; l >= 0; l--) {
    final ShortcutLauncher launcherShortcuts=launchers.valueAt(l);
    final ArraySet<String> pinned=launcherShortcuts.getPinnedShortcutIds(getPackageName(),getPackageUserId());
    if (pinned == null || pinned.size() == 0) {
      continue;
    }
    for (int i=pinned.size() - 1; i >= 0; i--) {
      final String id=pinned.valueAt(i);
      final ShortcutInfo si=mShortcuts.get(id);
      if (si == null) {
        continue;
      }
      si.addFlags(ShortcutInfo.FLAG_PINNED);
    }
  }
  removeOrphans(s);
}
