{
  if (forBackup) {
    if (!si.isPinned()) {
      return;
    }
  }
  out.startTag(null,TAG_SHORTCUT);
  ShortcutService.writeAttr(out,ATTR_ID,si.getId());
  ShortcutService.writeAttr(out,ATTR_ACTIVITY,si.getActivityComponent());
  ShortcutService.writeAttr(out,ATTR_TITLE,si.getTitle());
  ShortcutService.writeAttr(out,ATTR_TEXT,si.getText());
  ShortcutService.writeAttr(out,ATTR_INTENT,si.getIntentNoExtras());
  ShortcutService.writeAttr(out,ATTR_WEIGHT,si.getWeight());
  ShortcutService.writeAttr(out,ATTR_TIMESTAMP,si.getLastChangedTimestamp());
  if (forBackup) {
    ShortcutService.writeAttr(out,ATTR_FLAGS,si.getFlags() & ~(ShortcutInfo.FLAG_HAS_ICON_FILE | ShortcutInfo.FLAG_HAS_ICON_RES | ShortcutInfo.FLAG_DYNAMIC));
  }
 else {
    ShortcutService.writeAttr(out,ATTR_FLAGS,si.getFlags());
    ShortcutService.writeAttr(out,ATTR_ICON_RES,si.getIconResourceId());
    ShortcutService.writeAttr(out,ATTR_BITMAP_PATH,si.getBitmapPath());
  }
{
    final Set<String> cat=si.getCategories();
    if (cat != null && cat.size() > 0) {
      out.startTag(null,TAG_CATEGORIES);
      XmlUtils.writeStringArrayXml(cat.toArray(new String[cat.size()]),NAME_CATEGORIES,out);
      out.endTag(null,TAG_CATEGORIES);
    }
  }
  ShortcutService.writeTagExtra(out,TAG_INTENT_EXTRAS,si.getIntentPersistableExtras());
  ShortcutService.writeTagExtra(out,TAG_EXTRAS,si.getExtras());
  out.endTag(null,TAG_SHORTCUT);
}
