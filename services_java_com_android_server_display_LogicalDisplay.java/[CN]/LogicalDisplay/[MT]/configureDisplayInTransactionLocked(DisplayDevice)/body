{
  final DisplayInfo displayInfo=getDisplayInfoLocked();
  final DisplayDeviceInfo displayDeviceInfo=device.getDisplayDeviceInfoLocked();
  device.setLayerStackInTransactionLocked(mLayerStack);
  mTempLayerStackRect.set(0,0,displayInfo.logicalWidth,displayInfo.logicalHeight);
  int orientation=Surface.ROTATION_0;
  if (device == mPrimaryDisplayDevice && (displayDeviceInfo.flags & DisplayDeviceInfo.FLAG_SUPPORTS_ROTATION) != 0) {
    orientation=displayInfo.rotation;
  }
  boolean rotated=(orientation == Surface.ROTATION_90 || orientation == Surface.ROTATION_270);
  int physWidth=rotated ? displayDeviceInfo.height : displayDeviceInfo.width;
  int physHeight=rotated ? displayDeviceInfo.width : displayDeviceInfo.height;
  int displayRectWidth, displayRectHeight;
  if (physWidth * displayInfo.logicalHeight < physHeight * displayInfo.logicalWidth) {
    displayRectWidth=physWidth;
    displayRectHeight=displayInfo.logicalHeight * physWidth / displayInfo.logicalWidth;
  }
 else {
    displayRectWidth=displayInfo.logicalWidth * physHeight / displayInfo.logicalHeight;
    displayRectHeight=physHeight;
  }
  int displayRectTop=(physHeight - displayRectHeight) / 2;
  int displayRectLeft=(physWidth - displayRectWidth) / 2;
  mTempDisplayRect.set(displayRectLeft,displayRectTop,displayRectLeft + displayRectWidth,displayRectTop + displayRectHeight);
  device.setProjectionInTransactionLocked(orientation,mTempLayerStackRect,mTempDisplayRect);
}
