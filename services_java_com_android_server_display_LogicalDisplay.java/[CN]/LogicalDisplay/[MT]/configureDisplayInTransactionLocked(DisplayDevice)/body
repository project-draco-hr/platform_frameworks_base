{
  final DisplayInfo displayInfo=getDisplayInfoLocked();
  final DisplayDeviceInfo displayDeviceInfo=device.getDisplayDeviceInfoLocked();
  device.setLayerStackInTransactionLocked(mLayerStack);
  mTempRect.set(0,0,displayInfo.logicalWidth,displayInfo.logicalHeight);
  device.setViewportInTransactionLocked(mTempRect);
  int orientation=Surface.ROTATION_0;
  if (device == mPrimaryDisplayDevice && (displayDeviceInfo.flags & DisplayDeviceInfo.FLAG_SUPPORTS_ROTATION) != 0) {
    orientation=displayInfo.rotation;
  }
  device.setOrientationInTransactionLocked(orientation);
  boolean rotated=(orientation == Surface.ROTATION_90 || orientation == Surface.ROTATION_270);
  int physWidth=rotated ? displayDeviceInfo.height : displayDeviceInfo.width;
  int physHeight=rotated ? displayDeviceInfo.width : displayDeviceInfo.height;
  int frameWidth, frameHeight;
  if (physWidth * displayInfo.logicalHeight < physHeight * displayInfo.logicalWidth) {
    frameWidth=physWidth;
    frameHeight=displayInfo.logicalHeight * physWidth / displayInfo.logicalWidth;
  }
 else {
    frameWidth=displayInfo.logicalWidth * physHeight / displayInfo.logicalHeight;
    frameHeight=physHeight;
  }
  int frameTop=(physHeight - frameHeight) / 2;
  int frameLeft=(physWidth - frameWidth) / 2;
  mTempRect.set(frameLeft,frameTop,frameLeft + frameWidth,frameTop + frameHeight);
  device.setFrameInTransactionLocked(mTempRect);
}
