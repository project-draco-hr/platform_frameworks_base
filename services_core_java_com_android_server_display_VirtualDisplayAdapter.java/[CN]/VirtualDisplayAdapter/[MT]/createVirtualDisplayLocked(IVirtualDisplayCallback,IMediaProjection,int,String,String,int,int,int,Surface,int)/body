{
  boolean secure=(flags & DisplayManager.VIRTUAL_DISPLAY_FLAG_SECURE) != 0;
  IBinder appToken=callback.asBinder();
  IBinder displayToken=SurfaceControl.createDisplay(name,secure);
  final String baseUniqueId=UNIQUE_ID_PREFIX + ownerPackageName + ","+ ownerUid+ ","+ name+ ",";
  final int uniqueIndex=getNextUniqueIndex(baseUniqueId);
  VirtualDisplayDevice device=new VirtualDisplayDevice(displayToken,appToken,ownerUid,ownerPackageName,name,width,height,densityDpi,surface,flags,new Callback(callback,mHandler),baseUniqueId + uniqueIndex,uniqueIndex);
  mVirtualDisplayDevices.put(appToken,device);
  try {
    if (projection != null) {
      projection.registerCallback(new MediaProjectionCallback(appToken));
    }
    appToken.linkToDeath(device,0);
  }
 catch (  RemoteException ex) {
    mVirtualDisplayDevices.remove(appToken);
    device.destroyLocked();
    return null;
  }
  return device;
}
