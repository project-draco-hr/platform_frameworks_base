{
  boolean secure=(flags & DisplayManager.VIRTUAL_DISPLAY_FLAG_SECURE) != 0;
  IBinder appToken=callbacks.asBinder();
  IBinder displayToken=SurfaceControl.createDisplay(name,secure);
  VirtualDisplayDevice device=new VirtualDisplayDevice(displayToken,appToken,ownerUid,ownerPackageName,name,width,height,densityDpi,surface,flags,new Callbacks(callbacks,mHandler));
  mVirtualDisplayDevices.put(appToken,device);
  try {
    if (projection != null) {
      projection.addCallback(new MediaProjectionCallback(appToken));
    }
    appToken.linkToDeath(device,0);
  }
 catch (  RemoteException ex) {
    mVirtualDisplayDevices.remove(appToken);
    device.destroyLocked();
    return null;
  }
  return device;
}
