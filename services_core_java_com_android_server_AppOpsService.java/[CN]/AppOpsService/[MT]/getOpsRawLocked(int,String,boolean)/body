{
  HashMap<String,Ops> pkgOps=mUidOps.get(uid);
  if (pkgOps == null) {
    if (!edit) {
      return null;
    }
    pkgOps=new HashMap<String,Ops>();
    mUidOps.put(uid,pkgOps);
  }
  Ops ops=pkgOps.get(packageName);
  if (ops == null) {
    if (!edit) {
      return null;
    }
    boolean isPrivileged=false;
    if (uid != 0) {
      final long ident=Binder.clearCallingIdentity();
      try {
        int pkgUid=-1;
        try {
          ApplicationInfo appInfo=ActivityThread.getPackageManager().getApplicationInfo(packageName,0,UserHandle.getUserId(uid));
          if (appInfo != null) {
            pkgUid=appInfo.uid;
            isPrivileged=(appInfo.flags & ApplicationInfo.FLAG_PRIVILEGED) != 0;
          }
 else {
            if ("media".equals(packageName)) {
              pkgUid=Process.MEDIA_UID;
              isPrivileged=false;
            }
          }
        }
 catch (        RemoteException e) {
          Slog.w(TAG,"Could not contact PackageManager",e);
        }
        if (pkgUid != uid) {
          Slog.w(TAG,"Bad call: specified package " + packageName + " under uid "+ uid+ " but it is really "+ pkgUid);
          return null;
        }
      }
  finally {
        Binder.restoreCallingIdentity(ident);
      }
    }
    ops=new Ops(packageName,uid,isPrivileged);
    pkgOps.put(packageName,ops);
  }
  return ops;
}
