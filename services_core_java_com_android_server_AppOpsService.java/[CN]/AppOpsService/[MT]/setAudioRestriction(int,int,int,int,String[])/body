{
  verifyIncomingUid(uid);
  verifyIncomingOp(code);
synchronized (this) {
    SparseArray<Restriction> usageRestrictions=mAudioRestrictions.get(code);
    if (usageRestrictions == null) {
      usageRestrictions=new SparseArray<Restriction>();
      mAudioRestrictions.put(code,usageRestrictions);
    }
    usageRestrictions.remove(usage);
    if (mode != AppOpsManager.MODE_ALLOWED) {
      final Restriction r=new Restriction();
      r.mode=mode;
      if (exceptionPackages != null) {
        final int N=exceptionPackages.length;
        r.exceptionPackages=new ArraySet<String>(N);
        for (int i=0; i < N; i++) {
          final String pkg=exceptionPackages[i];
          if (pkg != null) {
            r.exceptionPackages.add(pkg.trim());
          }
        }
      }
      usageRestrictions.put(usage,r);
    }
  }
  notifyWatchersOfChange(code);
}
