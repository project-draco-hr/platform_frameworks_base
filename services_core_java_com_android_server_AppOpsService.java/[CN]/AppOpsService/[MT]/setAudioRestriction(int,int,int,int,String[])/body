{
  verifyIncomingUid(uid);
  verifyIncomingOp(code);
synchronized (this) {
    SparseArray<Restriction> streamRestrictions=mAudioRestrictions.get(code);
    if (streamRestrictions == null) {
      streamRestrictions=new SparseArray<Restriction>();
      mAudioRestrictions.put(code,streamRestrictions);
    }
    streamRestrictions.remove(stream);
    if (mode != AppOpsManager.MODE_ALLOWED) {
      final Restriction r=new Restriction();
      r.mode=mode;
      if (exceptionPackages != null) {
        final int N=exceptionPackages.length;
        r.exceptionPackages=new ArraySet<String>(N);
        for (int i=0; i < N; i++) {
          final String pkg=exceptionPackages[i];
          if (pkg != null) {
            r.exceptionPackages.add(pkg.trim());
          }
        }
      }
      streamRestrictions.put(stream,r);
    }
  }
}
