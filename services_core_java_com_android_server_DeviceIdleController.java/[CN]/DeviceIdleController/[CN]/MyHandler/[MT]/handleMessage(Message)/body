{
  if (DEBUG)   Slog.d(TAG,"handleMessage(" + msg.what + ")");
switch (msg.what) {
case MSG_WRITE_CONFIG:
{
      handleWriteConfigFile();
    }
  break;
case MSG_REPORT_IDLE_ON:
case MSG_REPORT_IDLE_ON_LIGHT:
{
  EventLogTags.writeDeviceIdleOnStart();
  final boolean fullChanged;
  final boolean lightChanged;
  if (msg.what == MSG_REPORT_IDLE_ON) {
    fullChanged=mLocalPowerManager.setDeviceIdleMode(true);
    lightChanged=mLocalPowerManager.setLightDeviceIdleMode(false);
  }
 else {
    fullChanged=mLocalPowerManager.setDeviceIdleMode(false);
    lightChanged=mLocalPowerManager.setLightDeviceIdleMode(true);
  }
  try {
    mNetworkPolicyManager.setDeviceIdleMode(true);
    mBatteryStats.noteDeviceIdleMode(msg.what == MSG_REPORT_IDLE_ON ? BatteryStats.DEVICE_IDLE_MODE_FULL : BatteryStats.DEVICE_IDLE_MODE_LIGHT,null,Process.myUid());
  }
 catch (  RemoteException e) {
  }
  if (fullChanged) {
    getContext().sendBroadcastAsUser(mIdleIntent,UserHandle.ALL);
  }
  if (lightChanged) {
    getContext().sendBroadcastAsUser(mLightIdleIntent,UserHandle.ALL);
  }
  EventLogTags.writeDeviceIdleOnComplete();
}
break;
case MSG_REPORT_IDLE_OFF:
{
EventLogTags.writeDeviceIdleOffStart("unknown");
final boolean fullChanged=mLocalPowerManager.setDeviceIdleMode(false);
final boolean lightChanged=mLocalPowerManager.setLightDeviceIdleMode(false);
try {
mNetworkPolicyManager.setDeviceIdleMode(false);
mBatteryStats.noteDeviceIdleMode(BatteryStats.DEVICE_IDLE_MODE_OFF,null,Process.myUid());
}
 catch (RemoteException e) {
}
if (fullChanged) {
getContext().sendBroadcastAsUser(mIdleIntent,UserHandle.ALL);
}
if (lightChanged) {
getContext().sendBroadcastAsUser(mLightIdleIntent,UserHandle.ALL);
}
EventLogTags.writeDeviceIdleOffComplete();
}
break;
case MSG_REPORT_ACTIVE:
{
String activeReason=(String)msg.obj;
int activeUid=msg.arg1;
EventLogTags.writeDeviceIdleOffStart(activeReason != null ? activeReason : "unknown");
final boolean fullChanged=mLocalPowerManager.setDeviceIdleMode(false);
final boolean lightChanged=mLocalPowerManager.setLightDeviceIdleMode(false);
try {
mNetworkPolicyManager.setDeviceIdleMode(false);
mBatteryStats.noteDeviceIdleMode(BatteryStats.DEVICE_IDLE_MODE_OFF,activeReason,activeUid);
}
 catch (RemoteException e) {
}
if (fullChanged) {
getContext().sendBroadcastAsUser(mIdleIntent,UserHandle.ALL);
}
if (lightChanged) {
getContext().sendBroadcastAsUser(mLightIdleIntent,UserHandle.ALL);
}
EventLogTags.writeDeviceIdleOffComplete();
}
break;
case MSG_TEMP_APP_WHITELIST_TIMEOUT:
{
int uid=msg.arg1;
checkTempAppWhitelistTimeout(uid);
}
break;
}
}
