{
  final long timeNow=SystemClock.elapsedRealtime();
synchronized (this) {
    duration=Math.min(duration,mConstants.MAX_TEMP_APP_WHITELIST_DURATION);
    long currentEndTime=mTempWhitelistAppIdEndTimes.get(appId);
    mTempWhitelistAppIdEndTimes.put(appId,timeNow + duration);
    if (DEBUG) {
      Slog.d(TAG,"Adding AppId " + appId + " to temp whitelist");
    }
    if (currentEndTime == 0) {
      postTempActiveTimeoutMessage(appId,duration);
      updateTempWhitelistAppIdsLocked();
      reportTempWhitelistChangedLocked();
    }
  }
}
