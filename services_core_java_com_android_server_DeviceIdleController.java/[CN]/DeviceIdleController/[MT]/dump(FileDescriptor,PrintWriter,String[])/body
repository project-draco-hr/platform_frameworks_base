{
  if (getContext().checkCallingOrSelfPermission(android.Manifest.permission.DUMP) != PackageManager.PERMISSION_GRANTED) {
    pw.println("Permission Denial: can't dump DeviceIdleController from from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " without permission "+ android.Manifest.permission.DUMP);
    return;
  }
  if (args != null) {
    int userId=UserHandle.USER_SYSTEM;
    for (int i=0; i < args.length; i++) {
      String arg=args[i];
      if ("-h".equals(arg)) {
        dumpHelp(pw);
        return;
      }
 else       if ("-u".equals(arg)) {
        i++;
        if (i < args.length) {
          arg=args[i];
          userId=Integer.parseInt(arg);
        }
      }
 else       if ("-a".equals(arg)) {
      }
 else       if (arg.length() > 0 && arg.charAt(0) == '-') {
        pw.println("Unknown option: " + arg);
        return;
      }
 else {
        Shell shell=new Shell();
        shell.userId=userId;
        String[] newArgs=new String[args.length - i];
        System.arraycopy(args,i,newArgs,0,args.length - i);
        shell.exec(mBinderService,null,fd,null,newArgs,new ResultReceiver(null));
        return;
      }
    }
  }
synchronized (this) {
    mConstants.dump(pw);
    int size=mPowerSaveWhitelistAppsExceptIdle.size();
    if (size > 0) {
      pw.println("  Whitelist (except idle) system apps:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.println(mPowerSaveWhitelistAppsExceptIdle.keyAt(i));
      }
    }
    size=mPowerSaveWhitelistApps.size();
    if (size > 0) {
      pw.println("  Whitelist system apps:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.println(mPowerSaveWhitelistApps.keyAt(i));
      }
    }
    size=mPowerSaveWhitelistUserApps.size();
    if (size > 0) {
      pw.println("  Whitelist user apps:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.println(mPowerSaveWhitelistUserApps.keyAt(i));
      }
    }
    size=mPowerSaveWhitelistExceptIdleAppIds.size();
    if (size > 0) {
      pw.println("  Whitelist (except idle) all app ids:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.print(mPowerSaveWhitelistExceptIdleAppIds.keyAt(i));
        pw.println();
      }
    }
    size=mPowerSaveWhitelistAllAppIds.size();
    if (size > 0) {
      pw.println("  Whitelist all app ids:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.print(mPowerSaveWhitelistAllAppIds.keyAt(i));
        pw.println();
      }
    }
    size=mTempWhitelistAppIdEndTimes.size();
    if (size > 0) {
      pw.println("  Temp whitelist schedule:");
      final long timeNow=SystemClock.elapsedRealtime();
      for (int i=0; i < size; i++) {
        pw.print("    UID=");
        pw.print(mTempWhitelistAppIdEndTimes.keyAt(i));
        pw.print(": ");
        Pair<MutableLong,String> entry=mTempWhitelistAppIdEndTimes.valueAt(i);
        TimeUtils.formatDuration(entry.first.value,timeNow,pw);
        pw.print(" - ");
        pw.println(entry.second);
      }
    }
    size=mTempWhitelistAppIdArray != null ? mTempWhitelistAppIdArray.length : 0;
    if (size > 0) {
      pw.println("  Temp whitelist app ids:");
      for (int i=0; i < size; i++) {
        pw.print("    ");
        pw.print(mTempWhitelistAppIdArray[i]);
        pw.println();
      }
    }
    pw.print("  mEnabled=");
    pw.println(mEnabled);
    pw.print("  mForceIdle=");
    pw.println(mForceIdle);
    pw.print("  mMotionSensor=");
    pw.println(mMotionSensor);
    pw.print("  mCurDisplay=");
    pw.println(mCurDisplay);
    pw.print("  mScreenOn=");
    pw.println(mScreenOn);
    pw.print("  mCharging=");
    pw.println(mCharging);
    pw.print("  mMotionActive=");
    pw.println(mMotionListener.active);
    pw.print("  mSensing=");
    pw.print(mSensing);
    pw.print(" mNotMoving=");
    pw.println(mNotMoving);
    pw.print("  mLocating=");
    pw.print(mLocating);
    pw.print(" mHasGps=");
    pw.print(mHasGps);
    pw.print(" mHasNetwork=");
    pw.print(mHasNetworkLocation);
    pw.print(" mLocated=");
    pw.println(mLocated);
    if (mLastGenericLocation != null) {
      pw.print("  mLastGenericLocation=");
      pw.println(mLastGenericLocation);
    }
    if (mLastGpsLocation != null) {
      pw.print("  mLastGpsLocation=");
      pw.println(mLastGpsLocation);
    }
    pw.print("  mState=");
    pw.println(stateToString(mState));
    pw.print("  mInactiveTimeout=");
    TimeUtils.formatDuration(mInactiveTimeout,pw);
    pw.println();
    if (mNextAlarmTime != 0) {
      pw.print("  mNextAlarmTime=");
      TimeUtils.formatDuration(mNextAlarmTime,SystemClock.elapsedRealtime(),pw);
      pw.println();
    }
    if (mNextIdlePendingDelay != 0) {
      pw.print("  mNextIdlePendingDelay=");
      TimeUtils.formatDuration(mNextIdlePendingDelay,pw);
      pw.println();
    }
    if (mNextIdleDelay != 0) {
      pw.print("  mNextIdleDelay=");
      TimeUtils.formatDuration(mNextIdleDelay,pw);
      pw.println();
    }
  }
}
