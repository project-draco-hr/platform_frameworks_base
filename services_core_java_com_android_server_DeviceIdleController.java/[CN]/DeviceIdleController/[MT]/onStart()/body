{
synchronized (this) {
    mAlarmManager=(AlarmManager)getContext().getSystemService(Context.ALARM_SERVICE);
    mBatteryStats=BatteryStatsService.getService();
    mNetworkPolicyManager=INetworkPolicyManager.Stub.asInterface(ServiceManager.getService(Context.NETWORK_POLICY_SERVICE));
    mDisplayManager=(DisplayManager)getContext().getSystemService(Context.DISPLAY_SERVICE);
    mSensorManager=(SensorManager)getContext().getSystemService(Context.SENSOR_SERVICE);
    mSigMotionSensor=mSensorManager.getDefaultSensor(Sensor.TYPE_SIGNIFICANT_MOTION);
    Intent intent=new Intent(ACTION_STEP_IDLE_STATE).setPackage("android").setFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    mAlarmIntent=PendingIntent.getBroadcast(getContext(),0,intent,0);
    IntentFilter filter=new IntentFilter();
    filter.addAction(Intent.ACTION_BATTERY_CHANGED);
    filter.addAction(ACTION_STEP_IDLE_STATE);
    getContext().registerReceiver(mReceiver,filter);
    mDisplayManager.registerDisplayListener(mDisplayListener,null);
    mScreenOn=true;
    mCharging=true;
    mState=STATE_ACTIVE;
    updateDisplayLocked();
  }
  publishBinderService("deviceidle",mBinder);
}
