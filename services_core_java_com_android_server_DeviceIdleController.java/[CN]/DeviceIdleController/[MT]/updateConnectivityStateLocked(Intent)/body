{
  if (mConnectivityService != null) {
    NetworkInfo ni=mConnectivityService.getActiveNetworkInfo();
    boolean conn;
    if (ni == null) {
      conn=false;
    }
 else {
      if (connIntent == null) {
        conn=ni.isConnected();
      }
 else {
        final int networkType=connIntent.getIntExtra(ConnectivityManager.EXTRA_NETWORK_TYPE,ConnectivityManager.TYPE_NONE);
        if (ni.getType() != networkType) {
          return;
        }
        conn=!connIntent.getBooleanExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY,false);
      }
    }
    if (conn != mNetworkConnected) {
      mNetworkConnected=conn;
      if (conn && mLightState == LIGHT_STATE_WAITING_FOR_NETWORK) {
        stepLightIdleStateLocked("network");
      }
    }
  }
}
