{
  if (duration > MAX_TEMP_APP_WHITELIST_DURATION) {
    duration=MAX_TEMP_APP_WHITELIST_DURATION;
  }
  try {
    int uid=getContext().getPackageManager().getPackageUid(packageName,userId);
    int appId=UserHandle.getAppId(uid);
    final long timeNow=System.currentTimeMillis();
synchronized (this) {
      long currentEndTime=mTempWhitelistAppIdEndTimes.get(appId);
      mTempWhitelistAppIdEndTimes.put(appId,timeNow + duration);
      if (DEBUG) {
        Slog.d(TAG,"Adding AppId " + appId + " to temp whitelist");
      }
      if (currentEndTime == 0) {
        postTempActiveTimeoutMessage(appId,duration);
        updateTempWhitelistAppIdsLocked();
        reportTempWhitelistChangedLocked();
      }
    }
  }
 catch (  NameNotFoundException e) {
  }
}
