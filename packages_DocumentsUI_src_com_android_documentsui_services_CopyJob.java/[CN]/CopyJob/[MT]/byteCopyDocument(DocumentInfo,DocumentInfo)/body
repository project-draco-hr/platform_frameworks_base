{
  final String dstMimeType;
  final String dstDisplayName;
  if (DEBUG)   Log.d(TAG,"Doing byte copy of document: " + srcInfo);
  if (srcInfo.isVirtualDocument()) {
    final String[] streamTypes=getContentResolver().getStreamTypes(srcInfo.derivedUri,"*/*");
    if (streamTypes != null && streamTypes.length > 0) {
      dstMimeType=streamTypes[0];
      final String extension=MimeTypeMap.getSingleton().getExtensionFromMimeType(dstMimeType);
      dstDisplayName=srcInfo.displayName + (extension != null ? "." + extension : srcInfo.displayName);
    }
 else {
      onFileFailed(srcInfo,"Cannot copy virtual file. No streamable formats available.");
      return false;
    }
  }
 else {
    dstMimeType=srcInfo.mimeType;
    dstDisplayName=srcInfo.displayName;
  }
  final Uri dstUri=DocumentsContract.createDocument(dstClient,dstDirInfo.derivedUri,dstMimeType,dstDisplayName);
  if (dstUri == null) {
    onFileFailed(srcInfo,"Couldn't create destination document " + dstDisplayName + " in directory "+ dstDirInfo.displayName+ ".");
    return false;
  }
  DocumentInfo dstInfo=null;
  try {
    dstInfo=DocumentInfo.fromUri(getContentResolver(),dstUri);
  }
 catch (  FileNotFoundException e) {
    onFileFailed(srcInfo,"Could not load DocumentInfo for newly created file: " + dstUri + ".");
    return false;
  }
  final boolean success;
  if (Document.MIME_TYPE_DIR.equals(srcInfo.mimeType)) {
    success=copyDirectoryHelper(srcInfo,dstInfo);
  }
 else {
    success=copyFileHelper(srcInfo,dstInfo,dstMimeType);
  }
  return success;
}
