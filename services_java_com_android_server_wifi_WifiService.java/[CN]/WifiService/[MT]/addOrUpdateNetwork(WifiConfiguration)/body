{
  enforceChangePermission();
  if (config.proxySettings == ProxySettings.PAC) {
    enforceConnectivityInternalPermission();
  }
  if (config.isValid()) {
    if (mWifiStateMachineChannel != null) {
      return mWifiStateMachine.syncAddOrUpdateNetwork(mWifiStateMachineChannel,config);
    }
 else {
      Slog.e(TAG,"mWifiStateMachineChannel is not initialized");
      return -1;
    }
  }
 else {
    Slog.e(TAG,"bad network configuration");
    return -1;
  }
}
