{
  mContext=context;
  mService=service;
  Messenger messenger=null;
  try {
    messenger=mService.getMessenger();
  }
 catch (  RemoteException e) {
    throw e.rethrowFromSystemServer();
  }
  if (messenger == null) {
    throw new IllegalStateException("getMessenger() returned null!  This is invalid.");
  }
  mAsyncChannel=new AsyncChannel();
  mConnected=new CountDownLatch(1);
  mInternalHandler=new ServiceHandler(looper);
  mAsyncChannel.connect(mContext,mInternalHandler,messenger);
  if (waitForConnection) {
    try {
      mConnected.await();
    }
 catch (    InterruptedException e) {
      Log.e(TAG,"interrupted wait at init");
    }
  }
}
