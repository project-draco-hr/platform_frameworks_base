{
synchronized (sThreadRefLock) {
    if (++sThreadRefCount == 1) {
      Messenger messenger=null;
      try {
        messenger=mService.getMessenger();
      }
 catch (      RemoteException e) {
      }
catch (      SecurityException e) {
      }
      if (messenger == null) {
        sAsyncChannel=null;
        return;
      }
      sAsyncChannel=new AsyncChannel();
      sConnected=new CountDownLatch(1);
      if (looper == null) {
        HandlerThread thread=new HandlerThread("WifiScanner");
        thread.start();
        sInternalHandler=new ServiceHandler(thread.getLooper());
      }
 else {
        sInternalHandler=new ServiceHandler(looper);
      }
      sAsyncChannel.connect(mContext,sInternalHandler,messenger);
      if (waitForConnection) {
        try {
          sConnected.await();
        }
 catch (        InterruptedException e) {
          Log.e(TAG,"interrupted wait at init");
        }
      }
    }
  }
}
