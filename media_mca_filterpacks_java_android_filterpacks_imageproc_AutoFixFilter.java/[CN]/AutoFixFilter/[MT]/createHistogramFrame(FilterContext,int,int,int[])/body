{
  int histDims=255 * 3 + 1;
  int[] histArray=new int[histDims];
  float border_thickness_ratio=0.05f;
  int y_border_thickness=(int)(height * border_thickness_ratio);
  int x_border_thickness=(int)(width * border_thickness_ratio);
  int pixels=(width - 2 * x_border_thickness) * (height - 2 * y_border_thickness);
  float count=0f;
  for (int y=y_border_thickness; y < height - y_border_thickness; ++y) {
    for (int x=x_border_thickness; x < width - x_border_thickness; ++x) {
      int index=y * width + x;
      int energy=(data[index] & 0xFF) + ((data[index] >> 8) & 0xFF) + ((data[index] >> 16) & 0xFF);
      histArray[energy]++;
    }
  }
  for (int i=1; i < histDims; i++) {
    histArray[i]+=histArray[i - 1];
  }
  for (int i=0; i < histDims; i++) {
    long temp=(256 * 256 - 1l) * histArray[i] / pixels;
    histArray[i]=(int)temp;
  }
  FrameFormat shaderHistFormat=ImageFormat.create(histDims,1,ImageFormat.COLORSPACE_RGBA,FrameFormat.TARGET_GPU);
  if (mHistFrame != null)   mHistFrame.release();
  mHistFrame=context.getFrameManager().newFrame(shaderHistFormat);
  mHistFrame.setInts(histArray);
}
