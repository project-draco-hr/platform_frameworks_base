{
  if (mHandler == null) {
    mHandler=new Handler(){
      @Override public void handleMessage(      Message msg){
switch (msg.what) {
case OPEN:
          nativeOpen((String)msg.obj);
        break;
case CLOSE:
      nativeClose();
    break;
case REMOVE_ALL:
  nativeRemoveAllIcons();
break;
case REQUEST_ICON:
IconListener l=(IconListener)msg.obj;
String url=msg.getData().getString("url");
requestIconAndSendResult(url,l);
break;
case BULK_REQUEST_ICON:
bulkRequestIcons(msg);
break;
case RETAIN_ICON:
nativeRetainIconForPageUrl((String)msg.obj);
break;
case RELEASE_ICON:
nativeReleaseIconForPageUrl((String)msg.obj);
break;
}
}
}
;
for (int size=mMessages.size(); size > 0; size--) {
mHandler.sendMessage(mMessages.remove(0));
}
mMessages=null;
}
}
