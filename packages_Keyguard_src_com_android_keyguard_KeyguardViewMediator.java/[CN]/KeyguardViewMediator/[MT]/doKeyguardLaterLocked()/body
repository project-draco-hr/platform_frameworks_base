{
  final ContentResolver cr=mContext.getContentResolver();
  long displayTimeout=Settings.System.getInt(cr,SCREEN_OFF_TIMEOUT,KEYGUARD_DISPLAY_TIMEOUT_DELAY_DEFAULT);
  final long lockAfterTimeout=Settings.Secure.getInt(cr,Settings.Secure.LOCK_SCREEN_LOCK_AFTER_TIMEOUT,KEYGUARD_LOCK_AFTER_DELAY_DEFAULT);
  final long policyTimeout=mLockPatternUtils.getDevicePolicyManager().getMaximumTimeToLock(null,mLockPatternUtils.getCurrentUser());
  long timeout;
  if (policyTimeout > 0) {
    displayTimeout=Math.max(displayTimeout,0);
    timeout=Math.min(policyTimeout - displayTimeout,lockAfterTimeout);
  }
 else {
    timeout=lockAfterTimeout;
  }
  if (timeout <= 0) {
    mSuppressNextLockSound=true;
    doKeyguardLocked(null);
  }
 else {
    long when=SystemClock.elapsedRealtime() + timeout;
    Intent intent=new Intent(DELAYED_KEYGUARD_ACTION);
    intent.putExtra("seq",mDelayedShowingSequence);
    PendingIntent sender=PendingIntent.getBroadcast(mContext,0,intent,PendingIntent.FLAG_CANCEL_CURRENT);
    mAlarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,when,sender);
    if (DEBUG)     Log.d(TAG,"setting alarm to turn off keyguard, seq = " + mDelayedShowingSequence);
  }
}
