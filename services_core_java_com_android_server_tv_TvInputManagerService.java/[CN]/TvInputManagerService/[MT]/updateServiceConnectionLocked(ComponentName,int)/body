{
  UserState userState=getUserStateLocked(userId);
  ServiceState serviceState=userState.serviceStateMap.get(name);
  if (serviceState == null) {
    return;
  }
  boolean isStateEmpty=serviceState.clients.isEmpty() && serviceState.sessionTokens.isEmpty();
  if (serviceState.service == null && !isStateEmpty && userId == mCurrentUserId) {
    if (serviceState.bound) {
      return;
    }
    if (DEBUG) {
      Slog.d(TAG,"bindServiceAsUser(name=" + name.getClassName() + ", userId="+ userId+ ")");
    }
    Intent i=new Intent(TvInputService.SERVICE_INTERFACE).setComponent(name);
    mContext.bindServiceAsUser(i,serviceState.connection,Context.BIND_AUTO_CREATE,new UserHandle(userId));
    serviceState.bound=true;
  }
 else   if (serviceState.service != null && isStateEmpty) {
    if (DEBUG) {
      Slog.d(TAG,"unbindService(name=" + name.getClassName() + ")");
    }
    mContext.unbindService(serviceState.connection);
    userState.serviceStateMap.remove(name);
  }
}
