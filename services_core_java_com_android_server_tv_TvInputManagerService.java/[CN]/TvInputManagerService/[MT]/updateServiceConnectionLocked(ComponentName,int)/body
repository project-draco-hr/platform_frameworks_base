{
  UserState userState=getOrCreateUserStateLocked(userId);
  ServiceState serviceState=userState.serviceStateMap.get(component);
  if (serviceState == null) {
    return;
  }
  if (serviceState.reconnecting) {
    if (!serviceState.sessionTokens.isEmpty()) {
      return;
    }
    serviceState.reconnecting=false;
  }
  boolean shouldBind;
  if (userId == mCurrentUserId) {
    shouldBind=!serviceState.sessionTokens.isEmpty() || serviceState.isHardware;
  }
 else {
    shouldBind=!serviceState.sessionTokens.isEmpty();
  }
  if (serviceState.service == null && shouldBind) {
    if (serviceState.bound) {
      return;
    }
    if (DEBUG) {
      Slog.d(TAG,"bindServiceAsUser(service=" + component + ", userId="+ userId+ ")");
    }
    Intent i=new Intent(TvInputService.SERVICE_INTERFACE).setComponent(component);
    serviceState.bound=mContext.bindServiceAsUser(i,serviceState.connection,Context.BIND_AUTO_CREATE | Context.BIND_FOREGROUND_SERVICE_WHILE_AWAKE,new UserHandle(userId));
  }
 else   if (serviceState.service != null && !shouldBind) {
    if (DEBUG) {
      Slog.d(TAG,"unbindService(service=" + component + ")");
    }
    mContext.unbindService(serviceState.connection);
    userState.serviceStateMap.remove(component);
  }
}
