{
  UserState userState=getUserStateLocked(userId);
  SessionState sessionState=userState.sessionStateMap.remove(sessionToken);
  if (sessionState.mLogUri != null) {
    SomeArgs args=SomeArgs.obtain();
    args.arg1=sessionState.mLogUri;
    args.arg2=System.currentTimeMillis();
    mLogHandler.obtainMessage(LogHandler.MSG_CLOSE_ENTRY,args).sendToTarget();
  }
  ClientState clientState=userState.clientStateMap.get(sessionState.mClient.asBinder());
  if (clientState != null) {
    clientState.mSessionTokens.remove(sessionToken);
    if (clientState.isEmpty()) {
      userState.clientStateMap.remove(sessionState.mClient.asBinder());
    }
  }
  TvInputInfo info=sessionState.mInfo;
  if (info != null) {
    ServiceState serviceState=userState.serviceStateMap.get(info.getComponent());
    if (serviceState != null) {
      serviceState.mSessionTokens.remove(sessionToken);
    }
  }
  updateServiceConnectionLocked(sessionState.mInfo.getComponent(),userId);
}
