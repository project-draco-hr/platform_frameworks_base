{
  UserState userState=getUserStateLocked(userId);
  SessionState sessionState=userState.sessionStateMap.remove(sessionToken);
  if (sessionState.mLogUri != null) {
    SomeArgs args=SomeArgs.obtain();
    args.arg1=sessionState.mLogUri;
    args.arg2=System.currentTimeMillis();
    mLogHandler.obtainMessage(LogHandler.MSG_CLOSE_ENTRY,args).sendToTarget();
  }
  ServiceState serviceState=userState.serviceStateMap.get(sessionState.mInputId);
  if (serviceState != null) {
    serviceState.mSessionTokens.remove(sessionToken);
  }
  updateServiceConnectionLocked(sessionState.mInputId,userId);
}
