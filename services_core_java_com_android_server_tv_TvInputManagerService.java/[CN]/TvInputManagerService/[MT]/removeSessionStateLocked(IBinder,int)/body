{
  UserState userState=getUserStateLocked(userId);
  if (sessionToken == userState.mainSessionToken) {
    userState.mainSessionToken=null;
  }
  SessionState sessionState=userState.sessionStateMap.remove(sessionToken);
  if (sessionState == null) {
    return;
  }
  ClientState clientState=userState.clientStateMap.get(sessionState.mClient.asBinder());
  if (clientState != null) {
    clientState.mSessionTokens.remove(sessionToken);
    if (clientState.isEmpty()) {
      userState.clientStateMap.remove(sessionState.mClient.asBinder());
    }
  }
  TvInputInfo info=sessionState.mInfo;
  if (info != null) {
    ServiceState serviceState=userState.serviceStateMap.get(info.getComponent());
    if (serviceState != null) {
      serviceState.mSessionTokens.remove(sessionToken);
    }
  }
  updateServiceConnectionLocked(sessionState.mInfo.getComponent(),userId);
  SomeArgs args=SomeArgs.obtain();
  args.arg1=sessionToken;
  args.arg2=System.currentTimeMillis();
  mWatchLogHandler.obtainMessage(WatchLogHandler.MSG_LOG_WATCH_END,args).sendToTarget();
}
