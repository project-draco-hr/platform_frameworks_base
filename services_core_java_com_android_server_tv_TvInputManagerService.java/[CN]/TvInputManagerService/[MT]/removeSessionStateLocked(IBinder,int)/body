{
  UserState userState=getUserStateLocked(userId);
  SessionState sessionState=userState.sessionStateMap.remove(sessionToken);
  if (sessionState.logUri != null) {
    SomeArgs args=SomeArgs.obtain();
    args.arg1=sessionState.logUri;
    args.arg2=System.currentTimeMillis();
    mLogHandler.obtainMessage(LogHandler.MSG_CLOSE_ENTRY,args).sendToTarget();
  }
  ServiceState serviceState=userState.serviceStateMap.get(sessionState.name);
  if (serviceState != null) {
    serviceState.sessionTokens.remove(sessionToken);
  }
  updateServiceConnectionLocked(sessionState.name,userId);
}
