{
  UserState userState=getOrCreateUserStateLocked(userId);
  if (sessionToken == userState.mainSessionToken) {
    if (DEBUG) {
      Slog.d(TAG,"mainSessionToken=null");
    }
    userState.mainSessionToken=null;
  }
  SessionState sessionState=userState.sessionStateMap.remove(sessionToken);
  if (sessionState == null) {
    return;
  }
  ClientState clientState=userState.clientStateMap.get(sessionState.client.asBinder());
  if (clientState != null) {
    clientState.sessionTokens.remove(sessionToken);
    if (clientState.isEmpty()) {
      userState.clientStateMap.remove(sessionState.client.asBinder());
    }
  }
  ServiceState serviceState=userState.serviceStateMap.get(sessionState.componentName);
  if (serviceState != null) {
    serviceState.sessionTokens.remove(sessionToken);
  }
  updateServiceConnectionLocked(sessionState.componentName,userId);
  SomeArgs args=SomeArgs.obtain();
  args.arg1=sessionToken;
  args.arg2=System.currentTimeMillis();
  mWatchLogHandler.obtainMessage(WatchLogHandler.MSG_LOG_WATCH_END,args).sendToTarget();
}
