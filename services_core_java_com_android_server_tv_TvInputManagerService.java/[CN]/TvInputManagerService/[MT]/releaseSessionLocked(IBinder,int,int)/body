{
  SessionState sessionState=null;
  try {
    sessionState=getSessionStateLocked(sessionToken,callingUid,userId);
    if (sessionState.session != null) {
      UserState userState=getOrCreateUserStateLocked(userId);
      if (sessionToken == userState.mainSessionToken) {
        setMainLocked(sessionToken,false,callingUid,userId);
      }
      if (sessionState.isRecordingSession) {
        sessionState.session.disconnect();
      }
 else {
        sessionState.session.release();
      }
    }
  }
 catch (  RemoteException|SessionNotFoundException e) {
    Slog.e(TAG,"error in releaseSession",e);
  }
 finally {
    if (sessionState != null) {
      sessionState.session=null;
    }
  }
  removeSessionStateLocked(sessionToken,userId);
}
