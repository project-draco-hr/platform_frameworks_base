{
synchronized (mLock) {
    UserState userState=mUserStates.get(userId);
    if (userState == null) {
      return;
    }
    for (    SessionState state : userState.sessionStateMap.values()) {
      if (state.mSession != null) {
        try {
          state.mSession.release();
        }
 catch (        RemoteException e) {
          Slog.e(TAG,"error in release",e);
        }
      }
    }
    userState.sessionStateMap.clear();
    for (    ServiceState serviceState : userState.serviceStateMap.values()) {
      if (serviceState.mCallback != null) {
        try {
          serviceState.mService.unregisterCallback(serviceState.mCallback);
        }
 catch (        RemoteException e) {
          Slog.e(TAG,"error in unregisterCallback",e);
        }
      }
      mContext.unbindService(serviceState.mConnection);
    }
    userState.serviceStateMap.clear();
    userState.inputMap.clear();
    userState.packageSet.clear();
    userState.ratingSystemXmlUriSet.clear();
    userState.clientStateMap.clear();
    userState.callbackSet.clear();
    userState.mainSessionToken=null;
    mUserStates.remove(userId);
  }
}
