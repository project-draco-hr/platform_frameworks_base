{
synchronized (mLock) {
    UserState userState=mUserStates.get(userId);
    if (userState == null) {
      return;
    }
    for (    SessionState state : userState.sessionStateMap.values()) {
      if (state.session != null) {
        try {
          state.session.release();
        }
 catch (        RemoteException e) {
          Slog.e(TAG,"error in release",e);
        }
      }
    }
    userState.sessionStateMap.clear();
    for (    ServiceState serviceState : userState.serviceStateMap.values()) {
      if (serviceState.service != null) {
        if (serviceState.callback != null) {
          try {
            serviceState.service.unregisterCallback(serviceState.callback);
          }
 catch (          RemoteException e) {
            Slog.e(TAG,"error in unregisterCallback",e);
          }
        }
        mContext.unbindService(serviceState.connection);
      }
    }
    userState.serviceStateMap.clear();
    userState.inputMap.clear();
    userState.packageSet.clear();
    userState.contentRatingSystemList.clear();
    userState.clientStateMap.clear();
    userState.callbackSet.clear();
    userState.mainSessionToken=null;
    mUserStates.remove(userId);
  }
}
