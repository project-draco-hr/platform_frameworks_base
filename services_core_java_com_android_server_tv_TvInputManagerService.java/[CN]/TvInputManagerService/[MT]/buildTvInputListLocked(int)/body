{
  UserState userState=getUserStateLocked(userId);
  userState.inputMap.clear();
  if (DEBUG)   Slog.d(TAG,"buildTvInputList");
  PackageManager pm=mContext.getPackageManager();
  List<ResolveInfo> services=pm.queryIntentServices(new Intent(TvInputService.SERVICE_INTERFACE),PackageManager.GET_SERVICES);
  for (  ResolveInfo ri : services) {
    ServiceInfo si=ri.serviceInfo;
    if (!android.Manifest.permission.BIND_TV_INPUT.equals(si.permission)) {
      Slog.w(TAG,"Skipping TV input " + si.name + ": it does not require the permission "+ android.Manifest.permission.BIND_TV_INPUT);
      continue;
    }
    TvInputInfo info=new TvInputInfo(ri);
    if (DEBUG)     Slog.d(TAG,"add " + info.getId());
    userState.inputMap.put(info.getId(),info);
  }
}
