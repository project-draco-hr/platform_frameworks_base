{
  UserState userState=getUserStateLocked(userId);
  SessionState sessionState=userState.sessionStateMap.get(sessionToken);
  if (sessionState == null) {
    throw new IllegalArgumentException("Session state not found for token " + sessionToken);
  }
  if (callingUid != Process.SYSTEM_UID && callingUid != sessionState.callingUid) {
    throw new SecurityException("Illegal access to the session with token " + sessionToken + " from uid "+ callingUid);
  }
  ITvInputSession session=sessionState.session;
  if (session == null) {
    throw new IllegalStateException("Session not yet created for token " + sessionToken);
  }
  return session;
}
