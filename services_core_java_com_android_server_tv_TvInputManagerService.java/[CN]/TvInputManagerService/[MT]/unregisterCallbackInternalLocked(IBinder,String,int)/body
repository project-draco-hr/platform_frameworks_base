{
  UserState userState=getUserStateLocked(userId);
  ClientState clientState=userState.clientStateMap.get(clientToken);
  if (clientState != null) {
    clientState.mInputIds.remove(inputId);
    if (clientState.isEmpty()) {
      userState.clientStateMap.remove(clientToken);
    }
  }
  ServiceState serviceState=userState.serviceStateMap.get(inputId);
  if (serviceState == null) {
    return;
  }
  serviceState.mClientTokens.remove(clientToken);
  if (!serviceState.mClientTokens.isEmpty()) {
    return;
  }
  if (serviceState.mService == null || serviceState.mCallback == null) {
    return;
  }
  try {
    serviceState.mService.unregisterCallback(serviceState.mCallback);
  }
 catch (  RemoteException e) {
    Slog.e(TAG,"error in unregisterCallback",e);
  }
 finally {
    serviceState.mCallback=null;
    updateServiceConnectionLocked(inputId,userId);
  }
}
