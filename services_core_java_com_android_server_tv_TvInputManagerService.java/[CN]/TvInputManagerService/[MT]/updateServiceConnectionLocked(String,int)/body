{
  UserState userState=getUserStateLocked(userId);
  ServiceState serviceState=userState.serviceStateMap.get(inputId);
  if (serviceState == null) {
    return;
  }
  if (serviceState.mReconnecting) {
    if (!serviceState.mSessionTokens.isEmpty()) {
      return;
    }
    serviceState.mReconnecting=false;
  }
  boolean isStateEmpty=serviceState.mClientTokens.isEmpty() && serviceState.mSessionTokens.isEmpty();
  if (serviceState.mService == null && !isStateEmpty && userId == mCurrentUserId) {
    if (serviceState.mBound) {
      return;
    }
    if (DEBUG) {
      Slog.d(TAG,"bindServiceAsUser(inputId=" + inputId + ", userId="+ userId+ ")");
    }
    Intent i=new Intent(TvInputService.SERVICE_INTERFACE).setComponent(userState.inputMap.get(inputId).mInfo.getComponent());
    serviceState.mBound=mContext.bindServiceAsUser(i,serviceState.mConnection,Context.BIND_AUTO_CREATE,new UserHandle(userId));
  }
 else   if (serviceState.mService != null && isStateEmpty) {
    if (DEBUG) {
      Slog.d(TAG,"unbindService(inputId=" + inputId + ")");
    }
    mContext.unbindService(serviceState.mConnection);
    userState.serviceStateMap.remove(inputId);
  }
}
