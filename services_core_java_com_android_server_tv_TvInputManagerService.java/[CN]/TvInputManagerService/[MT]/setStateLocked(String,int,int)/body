{
  UserState userState=getUserStateLocked(userId);
  TvInputState inputState=userState.inputMap.get(inputId);
  ServiceState serviceState=userState.serviceStateMap.get(inputId);
  int oldState=inputState.mState;
  inputState.mState=state;
  boolean isStateEmpty=serviceState.mClientTokens.isEmpty() && serviceState.mSessionTokens.isEmpty();
  if (serviceState != null && serviceState.mService == null && !isStateEmpty) {
    return;
  }
  if (oldState != state) {
    notifyStateChangedLocked(userState,inputId,state,null);
  }
}
