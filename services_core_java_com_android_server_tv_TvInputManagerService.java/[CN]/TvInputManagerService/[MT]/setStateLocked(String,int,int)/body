{
  UserState userState=getUserStateLocked(userId);
  TvInputState inputState=userState.inputMap.get(inputId);
  ServiceState serviceState=userState.serviceStateMap.get(inputId);
  int oldState=inputState.mState;
  inputState.mState=state;
  if (serviceState != null && serviceState.mService == null && shouldMaintainConnection(serviceState)) {
    return;
  }
  if (oldState != state) {
    notifyStateChangedLocked(userState,inputId,state,null);
  }
}
