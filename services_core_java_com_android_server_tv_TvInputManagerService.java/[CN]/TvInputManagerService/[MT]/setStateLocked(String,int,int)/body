{
  UserState userState=getOrCreateUserStateLocked(userId);
  TvInputState inputState=userState.inputMap.get(inputId);
  ServiceState serviceState=userState.serviceStateMap.get(inputState.info.getComponent());
  int oldState=inputState.state;
  inputState.state=state;
  if (serviceState != null && serviceState.service == null && (!serviceState.sessionTokens.isEmpty() || serviceState.isHardware)) {
    return;
  }
  if (oldState != state) {
    notifyInputStateChangedLocked(userState,inputId,state,null);
  }
}
