{
  if (DEBUG) {
    Slog.d(TAG,"onSessionCreated(inputId=" + sessionState.info.getId() + ")");
  }
synchronized (mLock) {
    sessionState.session=session;
    sessionState.hardwareSessionToken=harewareSessionToken;
    if (session == null) {
      removeSessionStateLocked(sessionState.sessionToken,sessionState.userId);
      sendSessionTokenToClientLocked(sessionState.client,sessionState.info.getId(),null,null,sessionState.seq);
    }
 else {
      try {
        session.asBinder().linkToDeath(sessionState,0);
      }
 catch (      RemoteException e) {
        Slog.e(TAG,"session process has already died",e);
      }
      IBinder clientToken=sessionState.client.asBinder();
      UserState userState=getUserStateLocked(sessionState.userId);
      ClientState clientState=userState.clientStateMap.get(clientToken);
      if (clientState == null) {
        clientState=createClientStateLocked(clientToken,sessionState.userId);
      }
      clientState.sessionTokens.add(sessionState.sessionToken);
      sendSessionTokenToClientLocked(sessionState.client,sessionState.info.getId(),sessionState.sessionToken,mChannels[0],sessionState.seq);
    }
    mChannels[0].dispose();
  }
}
