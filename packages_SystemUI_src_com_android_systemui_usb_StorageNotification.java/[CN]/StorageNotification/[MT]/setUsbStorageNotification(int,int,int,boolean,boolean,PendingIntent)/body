{
  if (!visible && mUsbStorageNotification == null) {
    return;
  }
  NotificationManager notificationManager=(NotificationManager)mContext.getSystemService(Context.NOTIFICATION_SERVICE);
  if (notificationManager == null) {
    return;
  }
  if (visible) {
    Resources r=Resources.getSystem();
    CharSequence title=r.getText(titleId);
    CharSequence message=r.getText(messageId);
    if (mUsbStorageNotification == null) {
      mUsbStorageNotification=new Notification();
      mUsbStorageNotification.icon=icon;
      mUsbStorageNotification.when=0;
    }
    if (sound) {
      mUsbStorageNotification.defaults|=Notification.DEFAULT_SOUND;
    }
 else {
      mUsbStorageNotification.defaults&=~Notification.DEFAULT_SOUND;
    }
    mUsbStorageNotification.flags=Notification.FLAG_ONGOING_EVENT;
    mUsbStorageNotification.tickerText=title;
    if (pi == null) {
      Intent intent=new Intent();
      pi=PendingIntent.getBroadcastAsUser(mContext,0,intent,0,UserHandle.CURRENT);
    }
    mUsbStorageNotification.color=mContext.getColor(com.android.internal.R.color.system_notification_accent_color);
    mUsbStorageNotification.setLatestEventInfo(mContext,title,message,pi);
    mUsbStorageNotification.visibility=Notification.VISIBILITY_PUBLIC;
    mUsbStorageNotification.category=Notification.CATEGORY_SYSTEM;
    final boolean adbOn=1 == Settings.Global.getInt(mContext.getContentResolver(),Settings.Global.ADB_ENABLED,0);
    if (POP_UMS_ACTIVITY_ON_CONNECT && !adbOn) {
      mUsbStorageNotification.fullScreenIntent=pi;
    }
  }
  final int notificationId=mUsbStorageNotification.icon;
  if (visible) {
    notificationManager.notifyAsUser(null,notificationId,mUsbStorageNotification,UserHandle.ALL);
  }
 else {
    notificationManager.cancelAsUser(null,notificationId,UserHandle.ALL);
  }
}
