{
  Slog.i(TAG,String.format("Media {%s} state changed from {%s} -> {%s}",path,oldState,newState));
  if (newState.equals(Environment.MEDIA_SHARED)) {
    Intent intent=new Intent();
    intent.setClass(mContext,com.android.systemui.usb.UsbStorageActivity.class);
    PendingIntent pi=PendingIntent.getActivity(mContext,0,intent,0);
    setUsbStorageNotification(com.android.internal.R.string.usb_storage_stop_notification_title,com.android.internal.R.string.usb_storage_stop_notification_message,com.android.internal.R.drawable.stat_sys_warning,false,true,pi);
  }
 else   if (newState.equals(Environment.MEDIA_CHECKING)) {
    setMediaStorageNotification(com.android.internal.R.string.ext_media_checking_notification_title,com.android.internal.R.string.ext_media_checking_notification_message,com.android.internal.R.drawable.stat_notify_sdcard_prepare,true,false,null);
    updateUsbMassStorageNotification(false);
  }
 else   if (newState.equals(Environment.MEDIA_MOUNTED)) {
    setMediaStorageNotification(0,0,0,false,false,null);
    updateUsbMassStorageNotification(mUmsAvailable);
  }
 else   if (newState.equals(Environment.MEDIA_UNMOUNTED)) {
    if (!mStorageManager.isUsbMassStorageEnabled()) {
      if (oldState.equals(Environment.MEDIA_SHARED)) {
        setMediaStorageNotification(0,0,0,false,false,null);
        updateUsbMassStorageNotification(mUmsAvailable);
      }
 else {
        if (Environment.isExternalStorageRemovable()) {
          setMediaStorageNotification(com.android.internal.R.string.ext_media_safe_unmount_notification_title,com.android.internal.R.string.ext_media_safe_unmount_notification_message,com.android.internal.R.drawable.stat_notify_sdcard,true,true,null);
        }
 else {
          setMediaStorageNotification(0,0,0,false,false,null);
        }
        updateUsbMassStorageNotification(mUmsAvailable);
      }
    }
 else {
      setMediaStorageNotification(0,0,0,false,false,null);
      updateUsbMassStorageNotification(false);
    }
  }
 else   if (newState.equals(Environment.MEDIA_NOFS)) {
    Intent intent=new Intent();
    intent.setClass(mContext,com.android.internal.app.ExternalMediaFormatActivity.class);
    PendingIntent pi=PendingIntent.getActivity(mContext,0,intent,0);
    setMediaStorageNotification(com.android.internal.R.string.ext_media_nofs_notification_title,com.android.internal.R.string.ext_media_nofs_notification_message,com.android.internal.R.drawable.stat_notify_sdcard_usb,true,false,pi);
    updateUsbMassStorageNotification(mUmsAvailable);
  }
 else   if (newState.equals(Environment.MEDIA_UNMOUNTABLE)) {
    Intent intent=new Intent();
    intent.setClass(mContext,com.android.internal.app.ExternalMediaFormatActivity.class);
    PendingIntent pi=PendingIntent.getActivity(mContext,0,intent,0);
    setMediaStorageNotification(com.android.internal.R.string.ext_media_unmountable_notification_title,com.android.internal.R.string.ext_media_unmountable_notification_message,com.android.internal.R.drawable.stat_notify_sdcard_usb,true,false,pi);
    updateUsbMassStorageNotification(mUmsAvailable);
  }
 else   if (newState.equals(Environment.MEDIA_REMOVED)) {
    setMediaStorageNotification(com.android.internal.R.string.ext_media_nomedia_notification_title,com.android.internal.R.string.ext_media_nomedia_notification_message,com.android.internal.R.drawable.stat_notify_sdcard_usb,true,false,null);
    updateUsbMassStorageNotification(false);
  }
 else   if (newState.equals(Environment.MEDIA_BAD_REMOVAL)) {
    setMediaStorageNotification(com.android.internal.R.string.ext_media_badremoval_notification_title,com.android.internal.R.string.ext_media_badremoval_notification_message,com.android.internal.R.drawable.stat_sys_warning,true,true,null);
    updateUsbMassStorageNotification(false);
  }
 else {
    Slog.w(TAG,String.format("Ignoring unknown state {%s}",newState));
  }
}
