{
  if (canDraw()) {
    if (!hasDirtyRegions()) {
      dirty=null;
    }
    final int surfaceState=checkRenderContext();
    if (surfaceState != SURFACE_STATE_ERROR) {
      HardwareCanvas canvas=mCanvas;
      if (mProfileEnabled) {
        mProfileLock.lock();
      }
      dirty=beginFrame(canvas,dirty,surfaceState);
      int saveCount=0;
      int status=DisplayList.STATUS_DONE;
      long start=GLRenderer.getSystemTime();
      try {
        status=prepareFrame(dirty);
        saveCount=canvas.save();
        callbacks.onHardwarePreDraw(canvas);
        status|=doDrawDisplayList(attachInfo,canvas,displayList,status);
      }
 catch (      Exception e) {
        Log.e(LOG_TAG,"An error has occurred while drawing:",e);
      }
 finally {
        callbacks.onHardwarePostDraw(canvas);
        canvas.restoreToCount(saveCount);
        mDrawDelta=GLRenderer.getSystemTime() - start;
        if (mDrawDelta > 0) {
          mFrameCount++;
          debugOverdraw(attachInfo,dirty,canvas,displayList);
          debugDirtyRegions(dirty,canvas);
          drawProfileData(attachInfo);
        }
      }
      onPostDraw();
      swapBuffers(status);
      if (mProfileEnabled) {
        mProfileLock.unlock();
      }
      attachInfo.mIgnoreDirtyState=false;
    }
  }
}
