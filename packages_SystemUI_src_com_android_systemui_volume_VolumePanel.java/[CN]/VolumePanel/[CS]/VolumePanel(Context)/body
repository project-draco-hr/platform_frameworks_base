{
  mContext=context;
  mAudioManager=(AudioManager)context.getSystemService(Context.AUDIO_SERVICE);
  final Resources res=context.getResources();
  final boolean useMasterVolume=res.getBoolean(R.bool.config_useMasterVolume);
  if (useMasterVolume) {
    for (int i=0; i < STREAMS.length; i++) {
      StreamResources streamRes=STREAMS[i];
      streamRes.show=(streamRes.streamType == STREAM_MASTER);
    }
  }
  mDialog=new Dialog(context){
    @Override public boolean onTouchEvent(    MotionEvent event){
      if (isShowing() && event.getAction() == MotionEvent.ACTION_OUTSIDE && sConfirmSafeVolumeDialog == null) {
        forceTimeout();
        return true;
      }
      return false;
    }
  }
;
  final Window window=mDialog.getWindow();
  final LayoutParams lp=window.getAttributes();
  lp.token=null;
  lp.y=res.getDimensionPixelOffset(R.dimen.volume_panel_top);
  lp.type=LayoutParams.TYPE_VOLUME_OVERLAY;
  lp.windowAnimations=R.style.Animation_VolumePanel;
  window.setAttributes(lp);
  window.setGravity(Gravity.TOP);
  window.clearFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND);
  window.requestFeature(Window.FEATURE_NO_TITLE);
  window.addFlags(LayoutParams.FLAG_NOT_FOCUSABLE | LayoutParams.FLAG_NOT_TOUCH_MODAL | LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH);
  mDialog.setCanceledOnTouchOutside(true);
  mDialog.setContentView(R.layout.volume_adjust);
  mDialog.setOnDismissListener(new OnDismissListener(){
    @Override public void onDismiss(    DialogInterface dialog){
      mActiveStreamType=-1;
      mAudioManager.forceVolumeControlStream(mActiveStreamType);
    }
  }
);
  mDialog.create();
  mView=window.findViewById(R.id.content);
  mView.setOnTouchListener(new View.OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      resetTimeout();
      return false;
    }
  }
);
  mPanel=(ViewGroup)mView.findViewById(R.id.visible_panel);
  mSliderGroup=(ViewGroup)mView.findViewById(R.id.slider_group);
  mMoreButton=mView.findViewById(R.id.expand_button);
  mDivider=mView.findViewById(R.id.expand_button_divider);
  mToneGenerators=new ToneGenerator[AudioSystem.getNumStreamTypes()];
  mVibrator=(Vibrator)context.getSystemService(Context.VIBRATOR_SERVICE);
  mVoiceCapable=context.getResources().getBoolean(R.bool.config_voice_capable);
  mShowCombinedVolumes=!mVoiceCapable && !useMasterVolume;
  if (!mShowCombinedVolumes) {
    mMoreButton.setVisibility(View.GONE);
    mDivider.setVisibility(View.GONE);
  }
 else {
    mMoreButton.setOnClickListener(mClickListener);
  }
  final boolean masterVolumeOnly=res.getBoolean(R.bool.config_useMasterVolume);
  final boolean masterVolumeKeySounds=res.getBoolean(R.bool.config_useVolumeKeySounds);
  mPlayMasterStreamTones=masterVolumeOnly && masterVolumeKeySounds;
  listenToRingerMode();
}
