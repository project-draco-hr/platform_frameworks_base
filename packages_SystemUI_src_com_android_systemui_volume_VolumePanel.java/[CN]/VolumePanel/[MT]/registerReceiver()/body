{
  final IntentFilter filter=new IntentFilter();
  filter.addAction(AudioManager.RINGER_MODE_CHANGED_ACTION);
  filter.addAction(AudioManager.INTERNAL_RINGER_MODE_CHANGED_ACTION);
  filter.addAction(Intent.ACTION_SCREEN_OFF);
  mContext.registerReceiver(new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      final String action=intent.getAction();
      if (AudioManager.RINGER_MODE_CHANGED_ACTION.equals(action)) {
        removeMessages(MSG_RINGER_MODE_CHANGED);
        sendEmptyMessage(MSG_RINGER_MODE_CHANGED);
      }
      if (AudioManager.INTERNAL_RINGER_MODE_CHANGED_ACTION.equals(action)) {
        removeMessages(MSG_INTERNAL_RINGER_MODE_CHANGED);
        sendEmptyMessage(MSG_INTERNAL_RINGER_MODE_CHANGED);
      }
      if (Intent.ACTION_SCREEN_OFF.equals(action)) {
        postDismiss(0);
      }
    }
  }
,filter);
}
