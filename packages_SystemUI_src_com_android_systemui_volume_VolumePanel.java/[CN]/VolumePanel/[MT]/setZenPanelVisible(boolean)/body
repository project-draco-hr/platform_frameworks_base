{
  if (LOGD)   Log.d(mTag,"setZenPanelVisible " + visible + " mZenPanel="+ mZenPanel);
  final boolean changing=visible != isZenPanelVisible();
  if (visible) {
    if (mZenPanel == null) {
      mZenPanel=(ZenModePanel)mZenPanelStub.inflate();
      mZenPanel.init(mZenController,mDialog != null ? 'D' : 'E');
      mZenPanel.setCallback(new ZenModePanel.Callback(){
        @Override public void onMoreSettings(){
          if (mCallback != null) {
            mCallback.onZenSettings();
          }
        }
        @Override public void onInteraction(){
          resetTimeout();
        }
        @Override public void onExpanded(        boolean expanded){
          if (mZenPanelExpanded == expanded)           return;
          mZenPanelExpanded=expanded;
          updateTimeoutDelay();
          resetTimeout();
        }
      }
);
    }
    mZenPanel.setVisibility(View.VISIBLE);
    resetTimeout();
  }
 else {
    if (mZenPanel != null) {
      mZenPanel.setVisibility(View.GONE);
    }
  }
  if (changing) {
    updateTimeoutDelay();
    resetTimeout();
  }
}
