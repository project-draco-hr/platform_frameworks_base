{
  String packageName=null;
  String op=null;
  String mode=null;
  int userId=UserHandle.USER_CURRENT;
  for (String argument; (argument=nextArg()) != null; ) {
    if (ARGUMENT_USER.equals(argument)) {
      userId=Integer.parseInt(nextArgRequired());
    }
 else {
      if (packageName == null) {
        packageName=argument;
      }
 else       if (op == null) {
        op=argument;
      }
 else       if (mode == null) {
        mode=argument;
      }
 else {
        throw new IllegalArgumentException("Unsupported argument: " + argument);
      }
    }
  }
  if (packageName == null) {
    throw new IllegalArgumentException("Package name not specified.");
  }
 else   if (op == null) {
    throw new IllegalArgumentException("Operation not specified.");
  }
 else   if (mode == null) {
    throw new IllegalArgumentException("Mode not specified.");
  }
  final int opInt=AppOpsManager.strOpToOp(op);
  final int modeInt;
switch (mode) {
case MODE_ALLOW:
    modeInt=AppOpsManager.MODE_ALLOWED;
  break;
case MODE_DENY:
modeInt=AppOpsManager.MODE_ERRORED;
break;
case MODE_IGNORE:
modeInt=AppOpsManager.MODE_IGNORED;
break;
case MODE_DEFAULT:
modeInt=AppOpsManager.MODE_DEFAULT;
break;
default :
throw new IllegalArgumentException("Mode is invalid.");
}
if (userId == UserHandle.USER_CURRENT) {
userId=ActivityManager.getCurrentUser();
}
final IPackageManager pm=ActivityThread.getPackageManager();
final IAppOpsService appOpsService=IAppOpsService.Stub.asInterface(ServiceManager.getService(Context.APP_OPS_SERVICE));
final int uid=pm.getPackageUid(packageName,userId);
if (uid < 0) {
throw new Exception("No UID for " + packageName + " for user "+ userId);
}
appOpsService.setMode(opInt,uid,packageName,modeInt);
}
