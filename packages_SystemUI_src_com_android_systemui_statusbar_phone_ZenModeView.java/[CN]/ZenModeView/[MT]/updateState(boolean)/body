{
  if (mAdapter != null && mAdapter.getMode() == Adapter.MODE_OFF && !mPeekable) {
    close();
  }
 else {
    mModeSpinner.updateState();
    mUntilPager.updateState();
    mAlarmWarning.updateState(animate);
    final float settingsAlpha=getSettingsButtonAlpha();
    if (settingsAlpha != mSettingsButton.getAlpha()) {
      if (animate) {
        mSettingsButton.animate().alpha(settingsAlpha).start();
      }
 else {
        mSettingsButton.setAlpha(settingsAlpha);
      }
    }
    if (mPeekable && mAdapter != null && mAdapter.getMode() != Adapter.MODE_OFF) {
      if (DEBUG)       log("panic expand!");
      mPeekable=false;
      mModeSpinner.setEnabled(true);
      mBottom=getExpandedBottom();
      setExpanded(1);
    }
    mInfoWindow.dismiss();
  }
}
