{
  super(context,attrs);
  if (DEBUG)   log("new %s()",getClass().getSimpleName());
  mContext=context;
  final int iconSize=mContext.getResources().getDimensionPixelSize(com.android.internal.R.dimen.notification_large_icon_width);
  final int topRowSize=iconSize * 2 / 3;
  final int p=topRowSize / 3;
  LayoutParams lp=null;
  mModeText=new TextView(mContext);
  mModeText.setText(R.string.zen_mode_title);
  mModeText.setId(android.R.id.title);
  mModeText.setTextColor(GRAY);
  mModeText.setTypeface(CONDENSED);
  mModeText.setAllCaps(true);
  mModeText.setGravity(Gravity.LEFT | Gravity.CENTER_VERTICAL);
  mModeText.setTextSize(TypedValue.COMPLEX_UNIT_PX,mModeText.getTextSize() * 1.5f);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,topRowSize);
  lp.leftMargin=p;
  addView(mModeText,lp);
  mModeSwitch=new Switch(mContext);
  mModeSwitch.setSwitchPadding(0);
  mModeSwitch.setSwitchTypeface(CONDENSED);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,topRowSize);
  lp.topMargin=p;
  lp.rightMargin=p;
  lp.addRule(ALIGN_PARENT_RIGHT);
  lp.addRule(ALIGN_BASELINE,mModeText.getId());
  addView(mModeSwitch,lp);
  mModeSwitch.setOnCheckedChangeListener(new OnCheckedChangeListener(){
    @Override public void onCheckedChanged(    CompoundButton buttonView,    boolean isChecked){
      mAdapter.setMode(isChecked);
      if (!mInit)       return;
      postDelayed(new Runnable(){
        @Override public void run(){
          mAdapter.close();
        }
      }
,CLOSE_DELAY);
    }
  }
);
  mDivider=new View(mContext);
  mDivider.setId(android.R.id.empty);
  mDivider.setBackgroundColor(GRAY);
  lp=new LayoutParams(LayoutParams.MATCH_PARENT,2);
  lp.addRule(BELOW,mModeText.getId());
  lp.bottomMargin=p;
  addView(mDivider,lp);
  mUntilPager=new UntilPager(mContext,iconSize * 3 / 4);
  mUntilPager.setId(android.R.id.tabhost);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
  lp.leftMargin=lp.rightMargin=iconSize / 2;
  lp.addRule(CENTER_HORIZONTAL);
  lp.addRule(BELOW,mDivider.getId());
  addView(mUntilPager,lp);
  mProgressDots=new ProgressDots(mContext,iconSize / 5);
  mProgressDots.setId(android.R.id.progress);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
  lp.addRule(CENTER_HORIZONTAL);
  lp.addRule(BELOW,mUntilPager.getId());
  addView(mProgressDots,lp);
  mDivider2=new View(mContext);
  mDivider2.setId(android.R.id.widget_frame);
  mDivider2.setBackgroundColor(GRAY);
  lp=new LayoutParams(LayoutParams.MATCH_PARENT,2);
  lp.addRule(BELOW,mProgressDots.getId());
  addView(mDivider2,lp);
  mSettingsButton=new TextView(mContext);
  mSettingsButton.setTypeface(CONDENSED);
  mSettingsButton.setTextSize(TypedValue.COMPLEX_UNIT_PX,mSettingsButton.getTextSize() * 1.3f);
  mSettingsButton.setPadding(p,p,p,p);
  mSettingsButton.setText("More settings...");
  lp=new LayoutParams(LayoutParams.MATCH_PARENT,LayoutParams.WRAP_CONTENT);
  lp.addRule(BELOW,mDivider2.getId());
  addView(mSettingsButton,lp);
  mSettingsButton.setOnTouchListener(new OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      if (event.getAction() == MotionEvent.ACTION_DOWN) {
        mSettingsButton.setBackgroundColor(DARK_GRAY);
      }
 else       if (event.getAction() == MotionEvent.ACTION_UP) {
        mSettingsButton.setBackground(null);
        if (mAdapter != null) {
          mAdapter.configure();
        }
      }
      return true;
    }
  }
);
}
