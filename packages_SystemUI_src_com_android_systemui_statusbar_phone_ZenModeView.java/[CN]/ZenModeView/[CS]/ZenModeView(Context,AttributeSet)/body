{
  super(context,attrs);
  if (DEBUG)   log("new %s()",getClass().getSimpleName());
  mContext=context;
  final int iconSize=mContext.getResources().getDimensionPixelSize(com.android.internal.R.dimen.notification_large_icon_width);
  final int topRowSize=iconSize * 2 / 3;
  final int p=topRowSize / 7;
  mPathPaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  mPathPaint.setStyle(Paint.Style.STROKE);
  mPathPaint.setColor(GRAY);
  mPathPaint.setStrokeWidth(p / 2);
  mSettingsButton=new ImageView(mContext);
  mSettingsButton.setPadding(p,p,p,p);
  mSettingsButton.setImageResource(R.drawable.ic_notify_settings_normal);
  LayoutParams lp=new LayoutParams(topRowSize,topRowSize);
  lp.topMargin=p;
  lp.leftMargin=p;
  addView(mSettingsButton,lp);
  mSettingsButton.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (mAdapter != null) {
        mAdapter.configure();
      }
      bounce(mSettingsButton,null);
    }
  }
);
  mModeText=new TextView(mContext);
  mModeText.setText(MODE_LABEL);
  mModeText.setId(android.R.id.title);
  mModeText.setTextColor(GRAY);
  mModeText.setTypeface(CONDENSED);
  mModeText.setAllCaps(true);
  mModeText.setGravity(Gravity.CENTER);
  mModeText.setTextSize(TypedValue.COMPLEX_UNIT_PX,mModeText.getTextSize() * 1.1f);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,topRowSize);
  lp.topMargin=p;
  lp.addRule(CENTER_HORIZONTAL);
  addView(mModeText,lp);
  mModeSwitch=new Switch(mContext);
  mModeSwitch.setSwitchPadding(0);
  mModeSwitch.setSwitchTypeface(CONDENSED);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,topRowSize);
  lp.topMargin=p;
  lp.addRule(ALIGN_PARENT_RIGHT);
  lp.addRule(ALIGN_BASELINE,mModeText.getId());
  addView(mModeSwitch,lp);
  mModeSwitch.setOnCheckedChangeListener(new OnCheckedChangeListener(){
    @Override public void onCheckedChanged(    CompoundButton buttonView,    boolean isChecked){
      mAdapter.setMode(isChecked);
      if (!mInit)       return;
      postDelayed(new Runnable(){
        @Override public void run(){
          mAdapter.close();
        }
      }
,CLOSE_DELAY);
    }
  }
);
  mDivider=new View(mContext);
  mDivider.setId(android.R.id.empty);
  mDivider.setBackgroundColor(GRAY);
  lp=new LayoutParams(LayoutParams.MATCH_PARENT,2);
  lp.addRule(BELOW,mModeText.getId());
  lp.topMargin=p;
  lp.bottomMargin=p * 2;
  addView(mDivider,lp);
  mUntilPager=new UntilPager(mContext,mPathPaint,iconSize * 3 / 4);
  mUntilPager.setId(android.R.id.tabhost);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
  lp.leftMargin=lp.rightMargin=iconSize / 2;
  lp.addRule(CENTER_HORIZONTAL);
  lp.addRule(BELOW,mDivider.getId());
  addView(mUntilPager,lp);
  mProgressDots=new ProgressDots(mContext,iconSize / 5);
  lp=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
  lp.addRule(CENTER_HORIZONTAL);
  lp.addRule(BELOW,mUntilPager.getId());
  addView(mProgressDots,lp);
}
