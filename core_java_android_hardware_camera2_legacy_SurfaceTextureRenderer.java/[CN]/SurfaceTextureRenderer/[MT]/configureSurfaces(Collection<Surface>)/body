{
  releaseEGLContext();
  if (surfaces == null || surfaces.size() == 0) {
    Log.w(TAG,"No output surfaces configured for GL drawing.");
    return;
  }
  for (  Surface s : surfaces) {
    try {
      if (LegacyCameraDevice.needsConversion(s)) {
        LegacyCameraDevice.setSurfaceFormat(s,ImageFormat.YV12);
        EGLSurfaceHolder holder=new EGLSurfaceHolder();
        holder.surface=s;
        mConversionSurfaces.add(holder);
      }
 else {
        EGLSurfaceHolder holder=new EGLSurfaceHolder();
        holder.surface=s;
        mSurfaces.add(holder);
      }
    }
 catch (    LegacyExceptionUtils.BufferQueueAbandonedException e) {
      Log.w(TAG,"Surface abandoned, skipping configuration... ",e);
    }
  }
  configureEGLContext();
  if (mSurfaces.size() > 0) {
    configureEGLOutputSurfaces(mSurfaces);
  }
  if (mConversionSurfaces.size() > 0) {
    configureEGLPbufferSurfaces(mConversionSurfaces);
  }
  makeCurrent((mSurfaces.size() > 0) ? mSurfaces.get(0).eglSurface : mConversionSurfaces.get(0).eglSurface);
  initializeGLState();
  mSurfaceTexture=new SurfaceTexture(getTextureId());
  if (SystemProperties.getBoolean(LEGACY_PERF_PROPERTY,false)) {
    setupGlTiming();
  }
}
