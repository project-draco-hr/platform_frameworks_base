{
  boolean skipChildren=in.getInt() > 0;
  boolean includeProperties=in.getInt() > 0;
  boolean v2=in.hasRemaining() && in.getInt() > 0;
  long start=System.currentTimeMillis();
  ByteArrayOutputStream b=new ByteArrayOutputStream(2 * 1024 * 1024);
  try {
    if (v2) {
      ViewDebug.dumpv2(rootView,b);
    }
 else {
      ViewDebug.dump(rootView,skipChildren,includeProperties,b);
    }
  }
 catch (  IOException|InterruptedException e) {
    return createFailChunk(1,"Unexpected error while obtaining view hierarchy: " + e.getMessage());
  }
  long end=System.currentTimeMillis();
  Log.d(TAG,"Time to obtain view hierarchy (ms): " + (end - start));
  byte[] data=b.toByteArray();
  return new Chunk(CHUNK_VURT,data,0,data.length);
}
