{
  File dir=getEmptyDir("testAgeLimits");
  int blockSize=new StatFs(dir.getPath()).getBlockSize();
  int kb=blockSize * 10 / 1024;
  ContentResolver cr=getContext().getContentResolver();
  Settings.Global.putString(cr,Settings.Global.DROPBOX_AGE_SECONDS,"1");
  Settings.Global.putString(cr,Settings.Global.DROPBOX_QUOTA_KB,Integer.toString(kb));
  long before=System.currentTimeMillis();
  DropBoxManagerService service=new DropBoxManagerService(getContext(),dir);
  DropBoxManager dropbox=new DropBoxManager(service.getServiceStub());
  dropbox.addText("DropBoxTest","TEST");
  addRandomEntry(dropbox,"DropBoxTest",blockSize * 20);
  DropBoxManager.Entry e0=dropbox.getNextEntry(null,before);
  DropBoxManager.Entry e1=dropbox.getNextEntry(null,e0.getTimeMillis());
  assertTrue(null == dropbox.getNextEntry(null,e1.getTimeMillis()));
  assertEquals("TEST",e0.getText(80));
  assertEquals(null,e1.getText(80));
  assertEquals(-1,getEntrySize(e1));
  e0.close();
  e1.close();
  Thread.sleep(2000);
  dropbox.addText("DropBoxTest","TEST1");
  e0=dropbox.getNextEntry(null,before);
  assertTrue(null == dropbox.getNextEntry(null,e0.getTimeMillis()));
  assertEquals("TEST1",e0.getText(80));
  e0.close();
}
