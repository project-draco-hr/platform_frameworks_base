{
  File dir=getEmptyDir("testAddFile");
  long before=System.currentTimeMillis();
  File f0=new File(dir,"f0.txt");
  File f1=new File(dir,"f1.txt.gz");
  File f2=new File(dir,"f2.dat");
  File f3=new File(dir,"f2.dat.gz");
  FileWriter w0=new FileWriter(f0);
  GZIPOutputStream gz1=new GZIPOutputStream(new FileOutputStream(f1));
  FileOutputStream os2=new FileOutputStream(f2);
  GZIPOutputStream gz3=new GZIPOutputStream(new FileOutputStream(f3));
  w0.write("FILE0");
  gz1.write("FILE1".getBytes());
  os2.write("DATA2".getBytes());
  gz3.write("DATA3".getBytes());
  w0.close();
  gz1.close();
  os2.close();
  gz3.close();
  DropBoxManagerService service=new DropBoxManagerService(getContext(),dir);
  DropBoxManager dropbox=new DropBoxManager(getContext(),service.getServiceStub());
  dropbox.addFile("DropBoxTest",f0,DropBoxManager.IS_TEXT);
  dropbox.addFile("DropBoxTest",f1,DropBoxManager.IS_TEXT | DropBoxManager.IS_GZIPPED);
  dropbox.addFile("DropBoxTest",f2,0);
  dropbox.addFile("DropBoxTest",f3,DropBoxManager.IS_GZIPPED);
  DropBoxManager.Entry e0=dropbox.getNextEntry("DropBoxTest",before);
  DropBoxManager.Entry e1=dropbox.getNextEntry("DropBoxTest",e0.getTimeMillis());
  DropBoxManager.Entry e2=dropbox.getNextEntry("DropBoxTest",e1.getTimeMillis());
  DropBoxManager.Entry e3=dropbox.getNextEntry("DropBoxTest",e2.getTimeMillis());
  assertTrue(null == dropbox.getNextEntry("DropBoxTest",e3.getTimeMillis()));
  assertTrue(e0.getTimeMillis() > before);
  assertTrue(e1.getTimeMillis() > e0.getTimeMillis());
  assertTrue(e2.getTimeMillis() > e1.getTimeMillis());
  assertTrue(e3.getTimeMillis() > e2.getTimeMillis());
  assertEquals(DropBoxManager.IS_TEXT,e0.getFlags());
  assertEquals(DropBoxManager.IS_TEXT,e1.getFlags());
  assertEquals(0,e2.getFlags());
  assertEquals(0,e3.getFlags());
  assertEquals("FILE0",e0.getText(80));
  byte[] buf1=new byte[80];
  assertEquals("FILE1",new String(buf1,0,e1.getInputStream().read(buf1)));
  assertTrue(null == e2.getText(80));
  byte[] buf2=new byte[80];
  assertEquals("DATA2",new String(buf2,0,e2.getInputStream().read(buf2)));
  assertTrue(null == e3.getText(80));
  byte[] buf3=new byte[80];
  assertEquals("DATA3",new String(buf3,0,e3.getInputStream().read(buf3)));
  e0.close();
  e1.close();
  e2.close();
  e3.close();
}
