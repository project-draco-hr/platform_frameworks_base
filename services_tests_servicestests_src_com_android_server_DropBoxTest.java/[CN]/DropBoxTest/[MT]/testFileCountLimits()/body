{
  File dir=getEmptyDir("testFileCountLimits");
  DropBoxManagerService service=new DropBoxManagerService(getContext(),dir);
  DropBoxManager dropbox=new DropBoxManager(service);
  dropbox.addText("DropBoxTest","TEST0");
  dropbox.addText("DropBoxTest","TEST1");
  dropbox.addText("DropBoxTest","TEST2");
  dropbox.addText("DropBoxTest","TEST3");
  dropbox.addText("DropBoxTest","TEST4");
  dropbox.addText("DropBoxTest","TEST5");
  DropBoxManager.Entry e0=dropbox.getNextEntry(null,0);
  DropBoxManager.Entry e1=dropbox.getNextEntry(null,e0.getTimeMillis());
  DropBoxManager.Entry e2=dropbox.getNextEntry(null,e1.getTimeMillis());
  DropBoxManager.Entry e3=dropbox.getNextEntry(null,e2.getTimeMillis());
  DropBoxManager.Entry e4=dropbox.getNextEntry(null,e3.getTimeMillis());
  DropBoxManager.Entry e5=dropbox.getNextEntry(null,e4.getTimeMillis());
  assertTrue(null == dropbox.getNextEntry(null,e5.getTimeMillis()));
  assertEquals("TEST0",e0.getText(80));
  assertEquals("TEST5",e5.getText(80));
  e0.close();
  e1.close();
  e2.close();
  e3.close();
  e4.close();
  e5.close();
  ContentResolver cr=getContext().getContentResolver();
  Settings.Global.putString(cr,Settings.Global.DROPBOX_MAX_FILES,"3");
  dropbox.addText("DropBoxTest","TEST6");
  DropBoxManager.Entry f0=dropbox.getNextEntry(null,0);
  DropBoxManager.Entry f1=dropbox.getNextEntry(null,f0.getTimeMillis());
  DropBoxManager.Entry f2=dropbox.getNextEntry(null,f1.getTimeMillis());
  assertTrue(null == dropbox.getNextEntry(null,f2.getTimeMillis()));
  assertEquals("TEST4",f0.getText(80));
  assertEquals("TEST5",f1.getText(80));
  assertEquals("TEST6",f2.getText(80));
  f0.close();
  f1.close();
  f2.close();
}
