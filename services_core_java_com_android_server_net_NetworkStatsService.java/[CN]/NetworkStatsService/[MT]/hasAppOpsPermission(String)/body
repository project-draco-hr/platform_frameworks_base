{
  final int callingUid=Binder.getCallingUid();
  boolean appOpsAllow=false;
  if (callingPackage != null) {
    AppOpsManager appOps=(AppOpsManager)mContext.getSystemService(Context.APP_OPS_SERVICE);
    final int mode=appOps.checkOp(AppOpsManager.OP_GET_USAGE_STATS,callingUid,callingPackage);
    if (mode == AppOpsManager.MODE_DEFAULT) {
      final int permissionCheck=mContext.checkCallingPermission(Manifest.permission.PACKAGE_USAGE_STATS);
      appOpsAllow=permissionCheck == PackageManager.PERMISSION_GRANTED;
    }
    appOpsAllow=(mode == AppOpsManager.MODE_ALLOWED);
  }
  return appOpsAllow;
}
