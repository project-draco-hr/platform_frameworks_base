{
  checkNotNull(callingPackage,"calling package is null");
  checkNotNull(request,"DataUsageRequest is null");
  checkNotNull(request.templates,"NetworkTemplate is null");
  checkArgument(request.templates.length > 0);
  checkNotNull(messenger,"messenger is null");
  checkNotNull(binder,"binder is null");
  int callingUid=Binder.getCallingUid();
  @NetworkStatsAccess.Level int accessLevel=checkAccessLevel(callingPackage);
  DataUsageRequest normalizedRequest;
  final long token=Binder.clearCallingIdentity();
  try {
    normalizedRequest=mStatsObservers.register(request,messenger,binder,callingUid,accessLevel);
  }
  finally {
    Binder.restoreCallingIdentity(token);
  }
  mHandler.sendMessage(mHandler.obtainMessage(MSG_PERFORM_POLL,FLAG_PERSIST_ALL));
  return normalizedRequest;
}
