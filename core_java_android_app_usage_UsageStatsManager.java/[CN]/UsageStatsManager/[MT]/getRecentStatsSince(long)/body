{
  UsageStats aggregatedStats=null;
  long lastTime=time;
  UsageStats[] stats;
  while (true) {
    stats=getDailyStatsSince(lastTime);
    if (stats == null || stats.length == 0) {
      break;
    }
    for (    UsageStats stat : stats) {
      lastTime=stat.mEndTimeStamp;
      if (aggregatedStats == null) {
        aggregatedStats=new UsageStats();
        aggregatedStats.mBeginTimeStamp=stat.mBeginTimeStamp;
      }
      aggregatedStats.mEndTimeStamp=stat.mEndTimeStamp;
      final int pkgCount=stat.getPackageCount();
      for (int i=0; i < pkgCount; i++) {
        final PackageUsageStats pkgStats=stat.getPackage(i);
        final PackageUsageStats aggPkgStats=aggregatedStats.getOrCreatePackageUsageStats(pkgStats.mPackageName);
        aggPkgStats.mTotalTimeSpent+=pkgStats.mTotalTimeSpent;
        aggPkgStats.mLastTimeUsed=pkgStats.mLastTimeUsed;
        aggPkgStats.mLastEvent=pkgStats.mLastEvent;
      }
    }
  }
  return aggregatedStats;
}
