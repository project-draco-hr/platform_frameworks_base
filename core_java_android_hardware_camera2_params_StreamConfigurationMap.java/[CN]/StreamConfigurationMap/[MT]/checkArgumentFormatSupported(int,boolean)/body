{
  checkArgumentFormat(format);
  int internalFormat=imageFormatToInternal(format);
  int internalDataspace=imageFormatToDataspace(format);
  if (output) {
    if (internalDataspace == HAL_DATASPACE_DEPTH) {
      if (mDepthOutputFormats.indexOfKey(internalFormat) >= 0) {
        return format;
      }
    }
 else {
      if (mAllOutputFormats.indexOfKey(internalFormat) >= 0) {
        return format;
      }
    }
  }
 else {
    if (mInputFormats.indexOfKey(internalFormat) >= 0) {
      return format;
    }
  }
  throw new IllegalArgumentException(String.format("format %x is not supported by this stream configuration map",format));
}
