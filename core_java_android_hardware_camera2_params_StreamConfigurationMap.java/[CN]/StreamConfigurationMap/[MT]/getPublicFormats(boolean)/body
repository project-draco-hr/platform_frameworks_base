{
  int[] formats=new int[getPublicFormatCount(output)];
  int i=0;
  for (  int format : getFormatsMap(output).keySet()) {
    if (format != HAL_PIXEL_FORMAT_IMPLEMENTATION_DEFINED && format != HAL_PIXEL_FORMAT_RAW_OPAQUE) {
      formats[i++]=format;
    }
  }
  if (formats.length != i) {
    throw new AssertionError("Too few formats " + i + ", expected "+ formats.length);
  }
  return imageFormatToPublic(formats);
}
