{
  int[] formats=new int[getPublicFormatCount(output)];
  int i=0;
  SparseIntArray map=getFormatsMap(output);
  for (int j=0; j < map.size(); j++) {
    int format=map.keyAt(j);
    if (format != HAL_PIXEL_FORMAT_RAW_OPAQUE) {
      formats[i++]=imageFormatToPublic(format);
    }
  }
  if (output) {
    for (int j=0; j < mDepthOutputFormats.size(); j++) {
      formats[i++]=depthFormatToPublic(mDepthOutputFormats.keyAt(j));
    }
  }
  if (formats.length != i) {
    throw new AssertionError("Too few formats " + i + ", expected "+ formats.length);
  }
  return formats;
}
