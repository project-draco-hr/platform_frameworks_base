{
  if (mDimSurface == null) {
    Slog.e(TAG,"updateSurface: no Surface");
    return false;
  }
  if (!dimming) {
    if (mDimTargetAlpha != 0) {
      mLastDimAnimTime=currentTime;
      mDimTargetAlpha=0;
      mDimDeltaPerMs=(-mDimCurrentAlpha) / WindowManagerService.DEFAULT_DIM_DURATION;
    }
  }
  boolean animating=mLastDimAnimTime != 0;
  if (animating) {
    mDimCurrentAlpha+=mDimDeltaPerMs * (currentTime - mLastDimAnimTime);
    if (displayFrozen) {
      animating=false;
    }
 else     if (mDimDeltaPerMs > 0) {
      if (mDimCurrentAlpha > mDimTargetAlpha) {
        animating=false;
      }
    }
 else     if (mDimDeltaPerMs < 0) {
      if (mDimCurrentAlpha < mDimTargetAlpha) {
        animating=false;
      }
    }
 else {
      animating=false;
    }
    if (animating) {
      if (WindowManagerService.SHOW_TRANSACTIONS)       Slog.i(WindowManagerService.TAG,"  DIM " + mDimSurface + ": alpha="+ mDimCurrentAlpha);
      mLastDimAnimTime=currentTime;
      mDimSurface.setAlpha(mDimCurrentAlpha);
    }
 else {
      mDimCurrentAlpha=mDimTargetAlpha;
      mLastDimAnimTime=0;
      if (WindowManagerService.SHOW_TRANSACTIONS)       Slog.i(WindowManagerService.TAG,"  DIM " + mDimSurface + ": final alpha="+ mDimCurrentAlpha);
      mDimSurface.setAlpha(mDimCurrentAlpha);
      if (!dimming) {
        if (WindowManagerService.SHOW_TRANSACTIONS)         Slog.i(WindowManagerService.TAG,"  DIM " + mDimSurface + ": HIDE");
        try {
          mDimSurface.hide();
        }
 catch (        RuntimeException e) {
          Slog.w(WindowManagerService.TAG,"Illegal argument exception hiding dim surface");
        }
        mDimShown=false;
      }
    }
  }
  return animating;
}
