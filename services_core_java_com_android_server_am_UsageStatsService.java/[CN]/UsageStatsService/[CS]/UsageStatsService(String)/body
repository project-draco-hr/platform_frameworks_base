{
  mStats=new ArrayMap<String,PkgUsageStatsExtended>();
  mLastResumeTimes=new ArrayMap<String,ArrayMap<String,Long>>();
  mStatsLock=new Object();
  mFileLock=new Object();
  mDir=new File(dir);
  mCal=Calendar.getInstance(TimeZone.getTimeZone("GMT+0"));
  mDir.mkdir();
  File parentDir=mDir.getParentFile();
  String fList[]=parentDir.list();
  if (fList != null) {
    String prefix=mDir.getName() + ".";
    int i=fList.length;
    while (i > 0) {
      i--;
      if (fList[i].startsWith(prefix)) {
        Slog.i(TAG,"Deleting old usage file: " + fList[i]);
        (new File(parentDir,fList[i])).delete();
      }
    }
  }
  mFileLeaf=getCurrentDateStr(FILE_PREFIX);
  mFile=new File(mDir,mFileLeaf);
  mHistoryFile=new AtomicFile(new File(mDir,FILE_HISTORY));
  readStatsFromFile();
  readHistoryStatsFromFile();
  mLastWriteElapsedTime.set(SystemClock.elapsedRealtime());
  mLastWriteDay.set(mCal.get(Calendar.DAY_OF_YEAR));
}
