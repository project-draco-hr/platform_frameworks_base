{
  enforceCallingPermission();
  String pkgName;
synchronized (mStatsLock) {
    if ((componentName == null) || ((pkgName=componentName.getPackageName()) == null)) {
      return;
    }
    final boolean samePackage=pkgName.equals(mLastResumedPkg);
    if (mIsResumed) {
      if (mLastResumedPkg != null) {
        if (REPORT_UNEXPECTED)         Slog.i(TAG,"Unexpected resume of " + pkgName + " while already resumed in "+ mLastResumedPkg);
        PkgUsageStatsExtended pus=(PkgUsageStatsExtended)mStats.getPackageStats(mLastResumedPkg);
        if (pus != null) {
          pus.pause();
        }
      }
    }
    final boolean sameComp=samePackage && componentName.getClassName().equals(mLastResumedComp);
    mIsResumed=true;
    mLastResumedPkg=pkgName;
    mLastResumedComp=componentName.getClassName();
    if (localLOGV)     Slog.i(TAG,"started component:" + pkgName);
    PkgUsageStatsExtended pus=(PkgUsageStatsExtended)mStats.getOrCreatePackageStats(pkgName);
    pus.resume(!samePackage);
    if (!sameComp) {
      pus.addLaunchCount(mLastResumedComp);
    }
    pus.componentResumeTimes.put(mLastResumedComp,System.currentTimeMillis());
  }
}
