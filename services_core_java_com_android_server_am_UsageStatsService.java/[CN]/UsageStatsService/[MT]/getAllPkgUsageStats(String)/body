{
  checkCallerPermission(callingPkg,"getAllPkgUsageStats");
synchronized (mStatsLock) {
    int NP=mStats.mPackages.size();
    if (NP <= 0) {
      return null;
    }
    UsageStats.PackageStats retArr[]=new UsageStats.PackageStats[NP];
    for (int p=0; p < NP; p++) {
      UsageStats.PackageStats ps=mStats.mPackages.valueAt(p);
      retArr[p]=new UsageStats.PackageStats(ps);
    }
    return retArr;
  }
}
