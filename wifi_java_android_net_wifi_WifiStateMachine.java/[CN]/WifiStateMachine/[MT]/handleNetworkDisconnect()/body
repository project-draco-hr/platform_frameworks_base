{
  Log.d(TAG,"Stopping DHCP and clearing IP");
  if (mDhcpStateMachine != null) {
    mDhcpStateMachine.sendMessage(DhcpStateMachine.CMD_STOP_DHCP);
    mDhcpStateMachine.quit();
    mDhcpStateMachine=null;
  }
  try {
    nwService.clearInterfaceAddresses(mInterfaceName);
  }
 catch (  Exception e) {
    Log.e(TAG,"Failed to clear IP addresses on disconnect" + e);
  }
  mWifiInfo.setInetAddress(null);
  mWifiInfo.setBSSID(null);
  mWifiInfo.setSSID(null);
  mWifiInfo.setNetworkId(WifiConfiguration.INVALID_NETWORK_ID);
  mWifiInfo.setRssi(MIN_RSSI);
  mWifiInfo.setLinkSpeed(-1);
  setNetworkDetailedState(DetailedState.DISCONNECTED);
  sendNetworkStateChangeBroadcast(mLastBssid);
  mLinkProperties.clear();
  if (!WifiConfigStore.isUsingStaticIp(mLastNetworkId)) {
    WifiConfigStore.clearIpConfiguration(mLastNetworkId);
  }
  mLastBssid=null;
  mLastNetworkId=WifiConfiguration.INVALID_NETWORK_ID;
}
