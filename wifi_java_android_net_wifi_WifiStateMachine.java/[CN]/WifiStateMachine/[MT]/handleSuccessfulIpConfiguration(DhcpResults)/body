{
  mLastSignalLevel=-1;
  mReconnectCount=0;
synchronized (mDhcpResultsLock) {
    mDhcpResults=dhcpResults;
  }
  LinkProperties linkProperties=dhcpResults.linkProperties;
  mWifiConfigStore.setLinkProperties(mLastNetworkId,new LinkProperties(linkProperties));
  InetAddress addr=null;
  Iterator<InetAddress> addrs=linkProperties.getAddresses().iterator();
  if (addrs.hasNext()) {
    addr=addrs.next();
  }
  mWifiInfo.setInetAddress(addr);
  mWifiInfo.setMeteredHint(dhcpResults.hasMeteredHint());
  if (getNetworkDetailedState() == DetailedState.CONNECTED) {
    linkProperties.setHttpProxy(mWifiConfigStore.getProxyProperties(mLastNetworkId));
    if (!linkProperties.equals(mLinkProperties)) {
      if (DBG) {
        log("Link configuration changed for netId: " + mLastNetworkId + " old: "+ mLinkProperties+ "new: "+ linkProperties);
      }
      mLinkProperties=linkProperties;
      sendLinkConfigurationChangedBroadcast();
    }
  }
 else {
    configureLinkProperties();
  }
}
