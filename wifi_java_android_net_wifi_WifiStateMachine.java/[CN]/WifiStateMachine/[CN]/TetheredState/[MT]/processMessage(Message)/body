{
switch (message.what) {
case CMD_TETHER_STATE_CHANGE:
    TetherStateChange stateChange=(TetherStateChange)message.obj;
  if (!isWifiTethered(stateChange.active)) {
    loge("Tethering reports wifi as untethered!, shut down soft Ap");
    setHostApRunning(null,false);
    setHostApRunning(null,true);
  }
return HANDLED;
case CMD_STOP_AP:
if (DBG) log("Untethering before stopping AP");
setWifiApState(WIFI_AP_STATE_DISABLING);
stopTethering();
transitionTo(mUntetheringState);
deferMessage(message);
break;
default :
return NOT_HANDLED;
}
return HANDLED;
}
