{
  if (DBG)   log(getName() + "\n");
  EventLog.writeEvent(EVENTLOG_WIFI_STATE_CHANGED,getName());
  mIsRunning=true;
  mInDelayedStop=false;
  updateBatteryWorkSource(null);
  mWifiNative.setBluetoothCoexistenceScanMode(mBluetoothConnectionActive);
  setCountryCode();
  setFrequencyBand();
  setNetworkDetailedState(DetailedState.DISCONNECTED);
  mWifiNative.stopFilteringMulticastV6Packets();
  if (mFilteringMulticastV4Packets.get()) {
    mWifiNative.startFilteringMulticastV4Packets();
  }
 else {
    mWifiNative.stopFilteringMulticastV4Packets();
  }
  if (mIsScanMode) {
    mWifiNative.setScanResultHandling(SCAN_ONLY_MODE);
    mWifiNative.disconnect();
    transitionTo(mScanModeState);
  }
 else {
    mWifiNative.setScanResultHandling(CONNECT_MODE);
    mWifiNative.reconnect();
    mWifiNative.status();
    transitionTo(mDisconnectedState);
  }
}
