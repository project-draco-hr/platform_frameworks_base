{
  if (DBG)   log(getName() + "\n");
  EventLog.writeEvent(EVENTLOG_WIFI_STATE_CHANGED,getName());
  mIsRunning=true;
  mInDelayedStop=false;
  updateBatteryWorkSource(null);
  WifiNative.setBluetoothCoexistenceScanMode(mBluetoothConnectionActive);
  setCountryCode();
  setFrequencyBand();
  setNetworkDetailedState(DetailedState.DISCONNECTED);
  WifiNative.stopFilteringMulticastV6Packets();
  if (mFilteringMulticastV4Packets.get()) {
    WifiNative.startFilteringMulticastV4Packets();
  }
 else {
    WifiNative.stopFilteringMulticastV4Packets();
  }
  if (mIsScanMode) {
    WifiNative.setScanResultHandling(SCAN_ONLY_MODE);
    WifiNative.disconnect();
    transitionTo(mScanModeState);
  }
 else {
    WifiNative.setScanResultHandling(CONNECT_MODE);
    WifiNative.reconnect();
    WifiNative.status();
    transitionTo(mDisconnectedState);
  }
}
