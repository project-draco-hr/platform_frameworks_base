{
  if (DBG)   log(getName() + "\n");
  EventLog.writeEvent(EVENTLOG_WIFI_STATE_CHANGED,getName());
  final Message message=new Message();
  message.copyFrom(getCurrentMessage());
  new Thread(new Runnable(){
    public void run(){
      mWakeLock.acquire();
switch (message.arg1) {
case WIFI_STATE_ENABLING:
        setWifiState(WIFI_STATE_ENABLING);
      break;
case WIFI_AP_STATE_ENABLING:
    setWifiApState(WIFI_AP_STATE_ENABLING);
  break;
}
if (WifiNative.loadDriver()) {
if (DBG) log("Driver load successful");
sendMessage(CMD_LOAD_DRIVER_SUCCESS);
}
 else {
loge("Failed to load driver!");
switch (message.arg1) {
case WIFI_STATE_ENABLING:
  setWifiState(WIFI_STATE_UNKNOWN);
break;
case WIFI_AP_STATE_ENABLING:
setWifiApState(WIFI_AP_STATE_FAILED);
break;
}
sendMessage(CMD_LOAD_DRIVER_FAILURE);
}
mWakeLock.release();
}
}
).start();
}
