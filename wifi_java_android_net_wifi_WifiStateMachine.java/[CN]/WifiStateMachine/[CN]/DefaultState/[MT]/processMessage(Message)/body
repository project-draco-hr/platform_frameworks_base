{
switch (message.what) {
case AsyncChannel.CMD_CHANNEL_HALF_CONNECTED:
    if (message.arg1 == AsyncChannel.STATUS_SUCCESSFUL) {
      mWifiP2pChannel.sendMessage(AsyncChannel.CMD_CHANNEL_FULL_CONNECTION);
    }
 else {
      loge("WifiP2pService connection failure, error=" + message.arg1);
    }
  break;
case AsyncChannel.CMD_CHANNEL_DISCONNECTED:
loge("WifiP2pService channel lost, message.arg1 =" + message.arg1);
break;
case CMD_BLUETOOTH_ADAPTER_STATE_CHANGE:
mBluetoothConnectionActive=(message.arg1 != BluetoothAdapter.STATE_DISCONNECTED);
break;
case CMD_PING_SUPPLICANT:
case CMD_ENABLE_NETWORK:
case CMD_ADD_OR_UPDATE_NETWORK:
case CMD_REMOVE_NETWORK:
case CMD_SAVE_CONFIG:
replyToMessage(message,message.what,FAILURE);
break;
case CMD_GET_CONFIGURED_NETWORKS:
replyToMessage(message,message.what,(List<WifiConfiguration>)null);
break;
case CMD_ENABLE_RSSI_POLL:
mEnableRssiPolling=(message.arg1 == 1);
break;
case CMD_ENABLE_BACKGROUND_SCAN:
mEnableBackgroundScan=(message.arg1 == 1);
break;
case CMD_SET_HIGH_PERF_MODE:
if (message.arg1 == 1) {
setSuspendOptimizations(SUSPEND_DUE_TO_HIGH_PERF,false);
}
 else {
setSuspendOptimizations(SUSPEND_DUE_TO_HIGH_PERF,true);
}
break;
case CMD_BOOT_COMPLETED:
String countryCode=mPersistedCountryCode;
if (TextUtils.isEmpty(countryCode) == false) {
Settings.Global.putString(mContext.getContentResolver(),Settings.Global.WIFI_COUNTRY_CODE,countryCode);
sendMessageAtFrontOfQueue(CMD_SET_COUNTRY_CODE,countryCode);
}
break;
case CMD_SET_BATCHED_SCAN:
recordBatchedScanSettings(message.arg1,message.arg2,(Bundle)message.obj);
break;
case CMD_POLL_BATCHED_SCAN:
handleBatchedScanPollRequest();
break;
case CMD_START_NEXT_BATCHED_SCAN:
startNextBatchedScan();
break;
case CMD_START_SCAN:
case CMD_START_SUPPLICANT:
case CMD_STOP_SUPPLICANT:
case CMD_STOP_SUPPLICANT_FAILED:
case CMD_START_DRIVER:
case CMD_STOP_DRIVER:
case CMD_DELAYED_STOP_DRIVER:
case CMD_DRIVER_START_TIMED_OUT:
case CMD_CAPTIVE_CHECK_COMPLETE:
case CMD_START_AP:
case CMD_START_AP_SUCCESS:
case CMD_START_AP_FAILURE:
case CMD_STOP_AP:
case CMD_TETHER_STATE_CHANGE:
case CMD_TETHER_NOTIFICATION_TIMED_OUT:
case CMD_DISCONNECT:
case CMD_RECONNECT:
case CMD_REASSOCIATE:
case CMD_RELOAD_TLS_AND_RECONNECT:
case WifiMonitor.SUP_CONNECTION_EVENT:
case WifiMonitor.SUP_DISCONNECTION_EVENT:
case WifiMonitor.NETWORK_CONNECTION_EVENT:
case WifiMonitor.NETWORK_DISCONNECTION_EVENT:
case WifiMonitor.SCAN_RESULTS_EVENT:
case WifiMonitor.SUPPLICANT_STATE_CHANGE_EVENT:
case WifiMonitor.AUTHENTICATION_FAILURE_EVENT:
case WifiMonitor.ASSOCIATION_REJECTION_EVENT:
case WifiMonitor.WPS_OVERLAP_EVENT:
case CMD_BLACKLIST_NETWORK:
case CMD_CLEAR_BLACKLIST:
case CMD_SET_OPERATIONAL_MODE:
case CMD_SET_COUNTRY_CODE:
case CMD_SET_FREQUENCY_BAND:
case CMD_RSSI_POLL:
case CMD_ENABLE_ALL_NETWORKS:
case DhcpStateMachine.CMD_PRE_DHCP_ACTION:
case DhcpStateMachine.CMD_POST_DHCP_ACTION:
case CMD_SET_AP_CONFIG:
case CMD_SET_AP_CONFIG_COMPLETED:
case CMD_REQUEST_AP_CONFIG:
case CMD_RESPONSE_AP_CONFIG:
case WifiWatchdogStateMachine.POOR_LINK_DETECTED:
case WifiWatchdogStateMachine.GOOD_LINK_DETECTED:
case CMD_NO_NETWORKS_PERIODIC_SCAN:
case CMD_DISABLE_P2P_RSP:
break;
case DhcpStateMachine.CMD_ON_QUIT:
mDhcpStateMachine=null;
break;
case CMD_SET_SUSPEND_OPT_ENABLED:
if (message.arg1 == 1) {
mSuspendWakeLock.release();
setSuspendOptimizations(SUSPEND_DUE_TO_SCREEN,true);
}
 else {
setSuspendOptimizations(SUSPEND_DUE_TO_SCREEN,false);
}
break;
case WifiMonitor.DRIVER_HUNG_EVENT:
setSupplicantRunning(false);
setSupplicantRunning(true);
break;
case WifiManager.CONNECT_NETWORK:
replyToMessage(message,WifiManager.CONNECT_NETWORK_FAILED,WifiManager.BUSY);
break;
case WifiManager.FORGET_NETWORK:
replyToMessage(message,WifiManager.FORGET_NETWORK_FAILED,WifiManager.BUSY);
break;
case WifiManager.SAVE_NETWORK:
replyToMessage(message,WifiManager.SAVE_NETWORK_FAILED,WifiManager.BUSY);
break;
case WifiManager.START_WPS:
replyToMessage(message,WifiManager.WPS_FAILED,WifiManager.BUSY);
break;
case WifiManager.CANCEL_WPS:
replyToMessage(message,WifiManager.CANCEL_WPS_FAILED,WifiManager.BUSY);
break;
case WifiManager.DISABLE_NETWORK:
replyToMessage(message,WifiManager.DISABLE_NETWORK_FAILED,WifiManager.BUSY);
break;
case WifiManager.RSSI_PKTCNT_FETCH:
replyToMessage(message,WifiManager.RSSI_PKTCNT_FETCH_FAILED,WifiManager.BUSY);
break;
case WifiP2pService.P2P_CONNECTION_CHANGED:
NetworkInfo info=(NetworkInfo)message.obj;
mP2pConnected.set(info.isConnected());
break;
case WifiP2pService.DISCONNECT_WIFI_REQUEST:
mTemporarilyDisconnectWifi=(message.arg1 == 1);
replyToMessage(message,WifiP2pService.DISCONNECT_WIFI_RESPONSE);
break;
case CMD_IP_ADDRESS_UPDATED:
if (mNetlinkLinkProperties.addLinkAddress((LinkAddress)message.obj)) {
updateLinkProperties();
}
break;
case CMD_IP_ADDRESS_REMOVED:
if (mNetlinkLinkProperties.removeLinkAddress((LinkAddress)message.obj)) {
updateLinkProperties();
}
break;
default :
loge("Error! unhandled message" + message);
break;
}
return HANDLED;
}
