{
  if (DBG)   Log.d(TAG,getName() + "\n");
  EventLog.writeEvent(EVENTLOG_WIFI_STATE_CHANGED,getName());
  if (!WifiConfigStore.isUsingStaticIp(mLastNetworkId)) {
    mDhcpStateMachine=DhcpStateMachine.makeDhcpStateMachine(mContext,WifiStateMachine.this,mInterfaceName);
    mDhcpStateMachine.registerForPreDhcpNotification();
    mDhcpStateMachine.sendMessage(DhcpStateMachine.CMD_START_DHCP);
  }
 else {
    DhcpInfoInternal dhcpInfoInternal=WifiConfigStore.getIpConfiguration(mLastNetworkId);
    InterfaceConfiguration ifcg=new InterfaceConfiguration();
    ifcg.addr=dhcpInfoInternal.makeLinkAddress();
    ifcg.interfaceFlags="[up]";
    try {
      nwService.setInterfaceConfig(mInterfaceName,ifcg);
      Log.v(TAG,"Static IP configuration succeeded");
      sendMessage(CMD_STATIC_IP_SUCCESS,dhcpInfoInternal);
    }
 catch (    RemoteException re) {
      Log.v(TAG,"Static IP configuration failed: " + re);
      sendMessage(CMD_STATIC_IP_FAILURE);
    }
catch (    IllegalStateException e) {
      Log.v(TAG,"Static IP configuration failed: " + e);
      sendMessage(CMD_STATIC_IP_FAILURE);
    }
  }
}
