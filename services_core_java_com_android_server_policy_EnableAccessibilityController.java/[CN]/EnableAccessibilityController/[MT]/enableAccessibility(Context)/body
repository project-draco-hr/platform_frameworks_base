{
  final IAccessibilityManager accessibilityManager=IAccessibilityManager.Stub.asInterface(ServiceManager.getService("accessibility"));
  final WindowManagerInternal windowManager=LocalServices.getService(WindowManagerInternal.class);
  final UserManager userManager=(UserManager)context.getSystemService(Context.USER_SERVICE);
  ComponentName componentName=getInstalledSpeakingAccessibilityServiceComponent(context);
  if (componentName == null) {
    return false;
  }
  boolean keyguardLocked=windowManager.isKeyguardLocked();
  final boolean hasMoreThanOneUser=userManager.getUsers().size() > 1;
  try {
    if (!keyguardLocked || !hasMoreThanOneUser) {
      final int userId=ActivityManager.getCurrentUser();
      accessibilityManager.enableAccessibilityService(componentName,userId);
    }
 else     if (keyguardLocked) {
      accessibilityManager.temporaryEnableAccessibilityStateUntilKeyguardRemoved(componentName,true);
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"cannot enable accessibilty: " + e);
  }
  return true;
}
