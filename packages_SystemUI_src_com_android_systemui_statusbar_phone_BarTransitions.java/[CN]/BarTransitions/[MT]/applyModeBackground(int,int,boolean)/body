{
  if (DEBUG)   Log.d(mTag,String.format("applyModeBackground %s animate=%s",modeToString(newMode),animate));
  cancelColorAnimation();
  Integer oldColor=getBackgroundColor(oldMode);
  Integer newColor=getBackgroundColor(newMode);
  if (newColor != null) {
    if (animate && oldColor != null && !oldColor.equals(newColor)) {
      startColorAnimation(oldColor,newColor);
    }
 else     if (!newColor.equals(mColorDrawable.getColor())) {
      if (DEBUG)       Log.d(mTag,String.format("setColor = %08x",newColor));
      mColorDrawable.setColor(newColor);
    }
  }
  if (newColor == null && mColorDrawableShowing) {
    if (DEBUG)     Log.d(mTag,"Hide color layer");
    if (animate) {
      mTransitionDrawable.reverseTransition(BACKGROUND_DURATION);
    }
 else {
      mTransitionDrawable.resetTransition();
    }
    mColorDrawableShowing=false;
  }
 else   if (newColor != null && !mColorDrawableShowing) {
    if (DEBUG)     Log.d(mTag,"Show color layer");
    mTransitionDrawable.startTransition(animate ? BACKGROUND_DURATION : 0);
    mColorDrawableShowing=true;
  }
}
