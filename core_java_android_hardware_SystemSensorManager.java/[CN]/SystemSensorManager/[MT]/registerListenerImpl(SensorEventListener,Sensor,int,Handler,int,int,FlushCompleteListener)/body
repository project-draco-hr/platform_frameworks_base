{
  if (sensor == null)   throw new IllegalArgumentException("sensor cannot be null");
  if (listener == null)   throw new IllegalArgumentException("listener cannot be null");
  if (reservedFlags != 0)   throw new IllegalArgumentException("reservedFlags should be zero");
  if (delayUs < 0)   throw new IllegalArgumentException("rateUs should be positive");
  if (maxBatchReportLatencyUs < 0)   throw new IllegalArgumentException("maxBatchReportLatencyUs should be positive");
  if (Sensor.getReportingMode(sensor) == Sensor.REPORTING_MODE_ONE_SHOT)   throw new IllegalArgumentException("Trigger Sensors cannot use registerListener");
synchronized (mSensorListeners) {
    SensorEventQueue queue=mSensorListeners.get(listener);
    if (queue == null) {
      Looper looper=(handler != null) ? handler.getLooper() : mMainLooper;
      queue=new SensorEventQueue(listener,looper,this,flushCompleteListener);
      if (!queue.addSensor(sensor,delayUs,maxBatchReportLatencyUs,reservedFlags)) {
        queue.dispose();
        return false;
      }
      mSensorListeners.put(listener,queue);
      return true;
    }
 else {
      return queue.addSensor(sensor,delayUs,maxBatchReportLatencyUs,reservedFlags);
    }
  }
}
