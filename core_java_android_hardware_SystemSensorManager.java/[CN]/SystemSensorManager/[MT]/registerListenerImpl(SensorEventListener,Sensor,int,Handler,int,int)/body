{
  if (listener == null || sensor == null) {
    Log.e(TAG,"sensor or listener is null");
    return false;
  }
  if (sensor.getReportingMode() == Sensor.REPORTING_MODE_ONE_SHOT) {
    Log.e(TAG,"Trigger Sensors should use the requestTriggerSensor.");
    return false;
  }
  if (maxBatchReportLatencyUs < 0 || delayUs < 0) {
    Log.e(TAG,"maxBatchReportLatencyUs and delayUs should be non-negative");
    return false;
  }
synchronized (mSensorListeners) {
    SensorEventQueue queue=mSensorListeners.get(listener);
    if (queue == null) {
      Looper looper=(handler != null) ? handler.getLooper() : mMainLooper;
      final String fullClassName=listener.getClass().getEnclosingClass() != null ? listener.getClass().getEnclosingClass().getName() : listener.getClass().getName();
      queue=new SensorEventQueue(listener,looper,this,fullClassName);
      if (!queue.addSensor(sensor,delayUs,maxBatchReportLatencyUs)) {
        queue.dispose();
        return false;
      }
      mSensorListeners.put(listener,queue);
      return true;
    }
 else {
      return queue.addSensor(sensor,delayUs,maxBatchReportLatencyUs);
    }
  }
}
