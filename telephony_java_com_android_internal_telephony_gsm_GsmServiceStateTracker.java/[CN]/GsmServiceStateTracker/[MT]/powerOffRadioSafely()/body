{
  DataConnectionTracker dcTracker=phone.mDataConnection;
  Message msg=dcTracker.obtainMessage(DataConnectionTracker.EVENT_CLEAN_UP_CONNECTION);
  msg.arg1=1;
  msg.obj=GSMPhone.REASON_RADIO_TURNED_OFF;
  dcTracker.sendMessage(msg);
  for (int i=0; i < MAX_NUM_DATA_STATE_READS; i++) {
    if (dcTracker.getState() != DataConnectionTracker.State.CONNECTED && dcTracker.getState() != DataConnectionTracker.State.DISCONNECTING) {
      Log.d(LOG_TAG,"Data shutdown complete.");
      break;
    }
    SystemClock.sleep(DATA_STATE_POLL_SLEEP_MS);
  }
  if (phone.isInCall()) {
    phone.mCT.ringingCall.hangupIfAlive();
    phone.mCT.backgroundCall.hangupIfAlive();
    phone.mCT.foregroundCall.hangupIfAlive();
  }
  cm.setRadioPower(false,null);
}
