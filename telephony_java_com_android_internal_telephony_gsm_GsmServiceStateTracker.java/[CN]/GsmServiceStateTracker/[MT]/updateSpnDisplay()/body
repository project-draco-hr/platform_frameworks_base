{
  int rule=phone.mIccRecords.getDisplayRule(ss.getOperatorNumeric());
  String spn=phone.mIccRecords.getServiceProviderName();
  String plmn=ss.getOperatorAlphaLong();
  if (mEmergencyOnly && cm.getRadioState().isOn()) {
    plmn=Resources.getSystem().getText(com.android.internal.R.string.emergency_calls_only).toString();
    if (DBG)     log("updateSpnDisplay: emergency only and radio is on plmn='" + plmn + "'");
  }
  if (rule != curSpnRule || !TextUtils.equals(spn,curSpn) || !TextUtils.equals(plmn,curPlmn)) {
    boolean showSpn=!mEmergencyOnly && !TextUtils.isEmpty(spn) && (rule & SIMRecords.SPN_RULE_SHOW_SPN) == SIMRecords.SPN_RULE_SHOW_SPN;
    boolean showPlmn=!TextUtils.isEmpty(plmn) && (mEmergencyOnly || ((rule & SIMRecords.SPN_RULE_SHOW_PLMN) == SIMRecords.SPN_RULE_SHOW_PLMN));
    if (DBG) {
      log(String.format("updateSpnDisplay: changed sending intent" + " rule=" + rule + " showPlmn='%b' plmn='%s' showSpn='%b' spn='%s'",showPlmn,plmn,showSpn,spn));
    }
    Intent intent=new Intent(Intents.SPN_STRINGS_UPDATED_ACTION);
    intent.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
    intent.putExtra(Intents.EXTRA_SHOW_SPN,showSpn);
    intent.putExtra(Intents.EXTRA_SPN,spn);
    intent.putExtra(Intents.EXTRA_SHOW_PLMN,showPlmn);
    intent.putExtra(Intents.EXTRA_PLMN,plmn);
    phone.getContext().sendStickyBroadcast(intent);
  }
  curSpnRule=rule;
  curSpn=spn;
  curPlmn=plmn;
}
