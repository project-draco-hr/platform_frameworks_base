{
  RestrictedState newRs=new RestrictedState();
  if (DBG)   log("onRestrictedStateChanged: E rs " + mRestrictedState);
  if (ar.exception == null) {
    int[] ints=(int[])ar.result;
    int state=ints[0];
    newRs.setCsEmergencyRestricted(((state & RILConstants.RIL_RESTRICTED_STATE_CS_EMERGENCY) != 0) || ((state & RILConstants.RIL_RESTRICTED_STATE_CS_ALL) != 0));
    if (phone.getIccCard().getState() == IccCard.State.READY) {
      newRs.setCsNormalRestricted(((state & RILConstants.RIL_RESTRICTED_STATE_CS_NORMAL) != 0) || ((state & RILConstants.RIL_RESTRICTED_STATE_CS_ALL) != 0));
      newRs.setPsRestricted((state & RILConstants.RIL_RESTRICTED_STATE_PS_ALL) != 0);
    }
    if (DBG)     log("onRestrictedStateChanged: new rs " + newRs);
    if (!mRestrictedState.isPsRestricted() && newRs.isPsRestricted()) {
      mPsRestrictEnabledRegistrants.notifyRegistrants();
      setNotification(PS_ENABLED);
    }
 else     if (mRestrictedState.isPsRestricted() && !newRs.isPsRestricted()) {
      mPsRestrictDisabledRegistrants.notifyRegistrants();
      setNotification(PS_DISABLED);
    }
    if (mRestrictedState.isCsRestricted()) {
      if (!newRs.isCsRestricted()) {
        setNotification(CS_DISABLED);
      }
 else       if (!newRs.isCsNormalRestricted()) {
        setNotification(CS_EMERGENCY_ENABLED);
      }
 else       if (!newRs.isCsEmergencyRestricted()) {
        setNotification(CS_NORMAL_ENABLED);
      }
    }
 else     if (mRestrictedState.isCsEmergencyRestricted() && !mRestrictedState.isCsNormalRestricted()) {
      if (!newRs.isCsRestricted()) {
        setNotification(CS_DISABLED);
      }
 else       if (newRs.isCsRestricted()) {
        setNotification(CS_ENABLED);
      }
 else       if (newRs.isCsNormalRestricted()) {
        setNotification(CS_NORMAL_ENABLED);
      }
    }
 else     if (!mRestrictedState.isCsEmergencyRestricted() && mRestrictedState.isCsNormalRestricted()) {
      if (!newRs.isCsRestricted()) {
        setNotification(CS_DISABLED);
      }
 else       if (newRs.isCsRestricted()) {
        setNotification(CS_ENABLED);
      }
 else       if (newRs.isCsEmergencyRestricted()) {
        setNotification(CS_EMERGENCY_ENABLED);
      }
    }
 else {
      if (newRs.isCsRestricted()) {
        setNotification(CS_ENABLED);
      }
 else       if (newRs.isCsEmergencyRestricted()) {
        setNotification(CS_EMERGENCY_ENABLED);
      }
 else       if (newRs.isCsNormalRestricted()) {
        setNotification(CS_NORMAL_ENABLED);
      }
    }
    mRestrictedState=newRs;
  }
  log("onRestrictedStateChanged: X rs " + mRestrictedState);
}
