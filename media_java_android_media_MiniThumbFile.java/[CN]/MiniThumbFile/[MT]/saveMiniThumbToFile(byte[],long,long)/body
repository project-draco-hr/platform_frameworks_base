{
  RandomAccessFile r=miniThumbDataFile();
  if (r == null)   return;
  long pos=id * BYTES_PER_MINTHUMB;
  FileLock lock=null;
  try {
    lock=mChannel.lock();
    if (data != null) {
      if (data.length > BYTES_PER_MINTHUMB - HEADER_SIZE) {
        return;
      }
      r.seek(pos);
      r.writeByte(0);
      if (magic == 0) {
        r.skipBytes(8);
      }
 else {
        r.writeLong(magic);
      }
      r.writeInt(data.length);
      r.write(data);
      r.seek(pos);
      r.writeByte(1);
    }
  }
 catch (  IOException ex) {
    Log.e(TAG,"couldn't save mini thumbnail data for " + id + "; ",ex);
    throw ex;
  }
catch (  RuntimeException ex) {
    Log.e(TAG,"couldn't save mini thumbnail data for " + id + "; disk full or mount read-only? "+ ex.getClass());
  }
 finally {
    try {
      if (lock != null)       lock.release();
    }
 catch (    IOException ex) {
    }
  }
}
