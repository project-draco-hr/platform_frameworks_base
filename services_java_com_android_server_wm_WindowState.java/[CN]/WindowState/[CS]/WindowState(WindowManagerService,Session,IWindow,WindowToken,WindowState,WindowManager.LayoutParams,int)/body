{
  mService=service;
  mSession=s;
  mClient=c;
  mToken=token;
  mAttrs.copyFrom(a);
  mViewVisibility=viewVisibility;
  DeathRecipient deathRecipient=new DeathRecipient();
  mAlpha=a.alpha;
  mEnforceSizeCompat=(mAttrs.flags & FLAG_COMPATIBLE_WINDOW) != 0;
  if (WindowManagerService.localLOGV)   Slog.v(WindowManagerService.TAG,"Window " + this + " client="+ c.asBinder()+ " token="+ token+ " ("+ mAttrs.token+ ")");
  try {
    c.asBinder().linkToDeath(deathRecipient,0);
  }
 catch (  RemoteException e) {
    mDeathRecipient=null;
    mAttachedWindow=null;
    mLayoutAttached=false;
    mIsImWindow=false;
    mIsWallpaper=false;
    mIsFloatingLayer=false;
    mBaseLayer=0;
    mSubLayer=0;
    return;
  }
  mDeathRecipient=deathRecipient;
  if ((mAttrs.type >= FIRST_SUB_WINDOW && mAttrs.type <= LAST_SUB_WINDOW)) {
    mBaseLayer=mService.mPolicy.windowTypeToLayerLw(attachedWindow.mAttrs.type) * WindowManagerService.TYPE_LAYER_MULTIPLIER + WindowManagerService.TYPE_LAYER_OFFSET;
    mSubLayer=mService.mPolicy.subWindowTypeToLayerLw(a.type);
    mAttachedWindow=attachedWindow;
    if (WindowManagerService.DEBUG_ADD_REMOVE)     Slog.v(WindowManagerService.TAG,"Adding " + this + " to "+ mAttachedWindow);
    mAttachedWindow.mChildWindows.add(this);
    mLayoutAttached=mAttrs.type != WindowManager.LayoutParams.TYPE_APPLICATION_ATTACHED_DIALOG;
    mIsImWindow=attachedWindow.mAttrs.type == TYPE_INPUT_METHOD || attachedWindow.mAttrs.type == TYPE_INPUT_METHOD_DIALOG;
    mIsWallpaper=attachedWindow.mAttrs.type == TYPE_WALLPAPER;
    mIsFloatingLayer=mIsImWindow || mIsWallpaper;
  }
 else {
    mBaseLayer=mService.mPolicy.windowTypeToLayerLw(a.type) * WindowManagerService.TYPE_LAYER_MULTIPLIER + WindowManagerService.TYPE_LAYER_OFFSET;
    mSubLayer=0;
    mAttachedWindow=null;
    mLayoutAttached=false;
    mIsImWindow=mAttrs.type == TYPE_INPUT_METHOD || mAttrs.type == TYPE_INPUT_METHOD_DIALOG;
    mIsWallpaper=mAttrs.type == TYPE_WALLPAPER;
    mIsFloatingLayer=mIsImWindow || mIsWallpaper;
  }
  WindowState appWin=this;
  while (appWin.mAttachedWindow != null) {
    appWin=mAttachedWindow;
  }
  WindowToken appToken=appWin.mToken;
  while (appToken.appWindowToken == null) {
    WindowToken parent=mService.mTokenMap.get(appToken.token);
    if (parent == null || appToken == parent) {
      break;
    }
    appToken=parent;
  }
  mRootToken=appToken;
  mAppToken=appToken.appWindowToken;
  mSurface=null;
  mRequestedWidth=0;
  mRequestedHeight=0;
  mXOffset=0;
  mYOffset=0;
  mLayer=0;
  mAnimLayer=0;
  mLastLayer=0;
  mInputWindowHandle=new InputWindowHandle(mAppToken != null ? mAppToken.mInputApplicationHandle : null,this);
}
