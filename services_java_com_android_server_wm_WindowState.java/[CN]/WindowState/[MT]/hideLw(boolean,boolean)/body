{
  if (doAnimation) {
    if (!mService.okToDisplay()) {
      doAnimation=false;
    }
  }
  boolean current=doAnimation ? mPolicyVisibilityAfterAnim : mPolicyVisibility;
  if (!current) {
    return false;
  }
  if (doAnimation) {
    mWinAnimator.applyAnimationLocked(WindowManagerPolicy.TRANSIT_EXIT,false);
    if (mWinAnimator.mAnimation == null) {
      doAnimation=false;
    }
  }
  if (doAnimation) {
    mPolicyVisibilityAfterAnim=false;
  }
 else {
    if (DEBUG_VISIBILITY)     Slog.v(TAG,"Policy visibility false: " + this);
    mPolicyVisibilityAfterAnim=false;
    mPolicyVisibility=false;
    mService.enableScreenIfNeededLocked();
    if (mService.mCurrentFocus == this) {
      mService.mFocusMayChange=true;
    }
  }
  if (requestAnim) {
    mService.updateLayoutToAnimationLocked();
  }
  return true;
}
