{
  if (doAnimation) {
    if (mService.mDisplayFrozen || !mService.mPolicy.isScreenOn()) {
      doAnimation=false;
    }
  }
  boolean current=doAnimation ? mPolicyVisibilityAfterAnim : mPolicyVisibility;
  if (!current) {
    return false;
  }
  if (doAnimation) {
    mService.applyAnimationLocked(this,WindowManagerPolicy.TRANSIT_EXIT,false);
    if (mAnimation == null) {
      doAnimation=false;
    }
  }
  if (doAnimation) {
    mPolicyVisibilityAfterAnim=false;
  }
 else {
    if (DEBUG_VISIBILITY)     Slog.v(WindowManagerService.TAG,"Policy visibility false: " + this);
    mPolicyVisibilityAfterAnim=false;
    mPolicyVisibility=false;
    mService.enableScreenIfNeededLocked();
    if (mService.mCurrentFocus == this) {
      mService.mFocusMayChange=true;
    }
  }
  if (requestAnim) {
    mService.requestAnimationLocked(0);
  }
  return true;
}
