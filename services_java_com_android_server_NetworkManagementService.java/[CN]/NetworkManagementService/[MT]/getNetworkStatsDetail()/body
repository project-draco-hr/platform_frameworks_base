{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.ACCESS_NETWORK_STATE,"NetworkManagementService");
  final File procPath=new File("/proc/uid_stat");
  final String[] knownUids=procPath.list();
  final NetworkStats.Builder stats=new NetworkStats.Builder(SystemClock.elapsedRealtime(),knownUids.length);
  for (  String uid : knownUids) {
    final File uidPath=new File(procPath,uid);
    final int rx=readSingleIntFromFile(new File(uidPath,"tcp_rcv"));
    final int tx=readSingleIntFromFile(new File(uidPath,"tcp_snd"));
    final int uidInt=Integer.parseInt(uid);
    stats.addEntry(NetworkStats.IFACE_ALL,uidInt,rx,tx);
  }
  return stats.build();
}
