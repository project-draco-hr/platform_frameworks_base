{
  int start=getLineStart(line);
  int end=full ? getLineEnd(line) : getLineVisibleEnd(line);
  boolean hasTabsOrEmoji=getLineContainsTab(line);
  TabStops tabStops=null;
  if (hasTabsOrEmoji && mText instanceof Spanned) {
    TabStopSpan[] tabs=getParagraphSpans((Spanned)mText,start,end,TabStopSpan.class);
    if (tabs.length > 0) {
      tabStops=new TabStops(TAB_INCREMENT,tabs);
    }
  }
  Directions directions=getLineDirections(line);
  if (directions == null) {
    return 0f;
  }
  int dir=getParagraphDirection(line);
  TextLine tl=TextLine.obtain();
  tl.set(mPaint,mText,start,end,dir,directions,hasTabsOrEmoji,tabStops);
  float width=tl.metrics(null);
  TextLine.recycle(tl);
  return width;
}
