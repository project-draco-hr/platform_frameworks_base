{
  MeasuredText mt=MeasuredText.obtain();
  TextLine tl=TextLine.obtain();
  try {
    mt.setPara(text,start,end,DIR_REQUEST_LTR);
    Directions directions;
    if (mt.mEasy) {
      directions=DIRS_ALL_LEFT_TO_RIGHT;
    }
 else {
      directions=AndroidBidi.directions(mt.mDir,mt.mLevels,0,mt.mChars,0,mt.mLen);
    }
    tl.set(paint,text,start,end,1,directions,hasTabs,tabs);
    return tl.metrics(null);
  }
  finally {
    TextLine.recycle(tl);
    MeasuredText.recycle(mt);
  }
}
