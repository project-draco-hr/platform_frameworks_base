{
  int prefer;
  boolean checkBoth=false;
  final boolean isForwardLocked=(flags & PackageManager.INSTALL_FORWARD_LOCK) != 0;
  check_inner: {
    if ((flags & PackageManager.INSTALL_INTERNAL) != 0) {
      prefer=PREFER_INTERNAL;
      break check_inner;
    }
 else     if ((flags & PackageManager.INSTALL_EXTERNAL) != 0) {
      prefer=PREFER_EXTERNAL;
      break check_inner;
    }
    if (pkg.installLocation == PackageInfo.INSTALL_LOCATION_INTERNAL_ONLY) {
      prefer=PREFER_INTERNAL;
      break check_inner;
    }
 else     if (pkg.installLocation == PackageInfo.INSTALL_LOCATION_PREFER_EXTERNAL) {
      prefer=PREFER_EXTERNAL;
      checkBoth=true;
      break check_inner;
    }
 else     if (pkg.installLocation == PackageInfo.INSTALL_LOCATION_AUTO) {
      prefer=PREFER_INTERNAL;
      checkBoth=true;
      break check_inner;
    }
    int installPreference=Settings.Global.getInt(getApplicationContext().getContentResolver(),Settings.Global.DEFAULT_INSTALL_LOCATION,PackageHelper.APP_INSTALL_AUTO);
    if (installPreference == PackageHelper.APP_INSTALL_INTERNAL) {
      prefer=PREFER_INTERNAL;
      break check_inner;
    }
 else     if (installPreference == PackageHelper.APP_INSTALL_EXTERNAL) {
      prefer=PREFER_EXTERNAL;
      break check_inner;
    }
    prefer=PREFER_INTERNAL;
  }
  final boolean emulated=Environment.isExternalStorageEmulated();
  boolean fitsOnInternal=false;
  if (checkBoth || prefer == PREFER_INTERNAL) {
    try {
      fitsOnInternal=isUnderInternalThreshold(pkg,isForwardLocked,threshold);
    }
 catch (    IOException e) {
      return PackageHelper.RECOMMEND_FAILED_INVALID_URI;
    }
  }
  boolean fitsOnSd=false;
  if (!emulated && (checkBoth || prefer == PREFER_EXTERNAL)) {
    try {
      fitsOnSd=isUnderExternalThreshold(pkg,isForwardLocked,abiOverride);
    }
 catch (    IOException e) {
      return PackageHelper.RECOMMEND_FAILED_INVALID_URI;
    }
  }
  if (prefer == PREFER_INTERNAL) {
    if (fitsOnInternal) {
      return PackageHelper.RECOMMEND_INSTALL_INTERNAL;
    }
  }
 else   if (!emulated && prefer == PREFER_EXTERNAL) {
    if (fitsOnSd) {
      return PackageHelper.RECOMMEND_INSTALL_EXTERNAL;
    }
  }
  if (checkBoth) {
    if (fitsOnInternal) {
      return PackageHelper.RECOMMEND_INSTALL_INTERNAL;
    }
 else     if (!emulated && fitsOnSd) {
      return PackageHelper.RECOMMEND_INSTALL_EXTERNAL;
    }
  }
  if (!emulated && (checkBoth || prefer == PREFER_EXTERNAL) && !Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {
    return PackageHelper.RECOMMEND_MEDIA_UNAVAILABLE;
  }
 else {
    return PackageHelper.RECOMMEND_FAILED_INSUFFICIENT_STORAGE;
  }
}
