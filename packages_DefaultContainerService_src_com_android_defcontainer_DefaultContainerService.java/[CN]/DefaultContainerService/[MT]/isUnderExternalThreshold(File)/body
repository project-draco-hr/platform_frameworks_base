{
  if (Environment.isExternalStorageEmulated()) {
    return false;
  }
  final int sizeMb=calculateContainerSize(apkFile);
  final int availSdMb;
  if (Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) {
    final StatFs sdStats=new StatFs(Environment.getExternalStorageDirectory().getPath());
    final int blocksToMb=(1 << 20) / sdStats.getBlockSize();
    availSdMb=sdStats.getAvailableBlocks() * blocksToMb;
  }
 else {
    availSdMb=-1;
  }
  return availSdMb > sizeMb;
}
