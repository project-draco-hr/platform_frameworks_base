{
  InputStream inStream=null;
  try {
    final InputStream is=new FileInputStream(new File(packagePath));
    inStream=new BufferedInputStream(is);
    ApkContainer container=new ApkContainer(inStream,encryptionParams);
    try {
      copyToFile(container.getInputStream(),outStream);
      if (!container.isAuthenticated()) {
        throw new DigestException();
      }
    }
 catch (    GeneralSecurityException e) {
      throw new DigestException("A problem occured copying the file.");
    }
  }
  finally {
    IoUtils.closeQuietly(inStream);
  }
}
