{
  if (data == null)   return 0;
  int size=isConnectable ? FLAGS_FIELD_BYTES : 0;
  if (data.getServiceUuids() != null) {
    int num16BitUuids=0;
    int num32BitUuids=0;
    int num128BitUuids=0;
    for (    ParcelUuid uuid : data.getServiceUuids()) {
      if (BluetoothUuid.is16BitUuid(uuid)) {
        ++num16BitUuids;
      }
 else       if (BluetoothUuid.is32BitUuid(uuid)) {
        ++num32BitUuids;
      }
 else {
        ++num128BitUuids;
      }
    }
    if (num16BitUuids != 0) {
      size+=OVERHEAD_BYTES_PER_FIELD + num16BitUuids * BluetoothUuid.UUID_BYTES_16_BIT;
    }
    if (num32BitUuids != 0) {
      size+=OVERHEAD_BYTES_PER_FIELD + num32BitUuids * BluetoothUuid.UUID_BYTES_32_BIT;
    }
    if (num128BitUuids != 0) {
      size+=OVERHEAD_BYTES_PER_FIELD + num128BitUuids * BluetoothUuid.UUID_BYTES_128_BIT;
    }
  }
  for (  ParcelUuid uuid : data.getServiceData().keySet()) {
    size+=OVERHEAD_BYTES_PER_FIELD + SERVICE_DATA_UUID_LENGTH + byteLength(data.getServiceData().get(uuid));
  }
  for (int i=0; i < data.getManufacturerSpecificData().size(); ++i) {
    size+=OVERHEAD_BYTES_PER_FIELD + MANUFACTURER_SPECIFIC_DATA_LENGTH + byteLength(data.getManufacturerSpecificData().valueAt(i));
  }
  if (data.getIncludeTxPowerLevel()) {
    size+=OVERHEAD_BYTES_PER_FIELD + 1;
  }
  if (data.getIncludeDeviceName() && mBluetoothAdapter.getName() != null) {
    size+=OVERHEAD_BYTES_PER_FIELD + mBluetoothAdapter.getName().length();
  }
  return size;
}
