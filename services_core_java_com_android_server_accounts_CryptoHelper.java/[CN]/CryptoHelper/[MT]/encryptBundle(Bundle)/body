{
  Preconditions.checkNotNull(bundle,"Cannot encrypt null bundle.");
  Parcel parcel=Parcel.obtain();
  bundle.writeToParcel(parcel,0);
  byte[] bytes=parcel.marshall();
  parcel.recycle();
  Bundle encryptedBundle=new Bundle();
  byte[] cipher=encrypt(bytes);
  byte[] mac=createMac(cipher);
  encryptedBundle.putByteArray(KEY_CIPHER,cipher);
  encryptedBundle.putByteArray(KEY_MAC,mac);
  return encryptedBundle;
}
