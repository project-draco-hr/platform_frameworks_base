{
  int count=ev.getPointerCount();
  TouchEvent proto=new TouchEvent();
  proto.setTimeOffsetNanos(ev.getEventTimeNano() - mStartSystemTimeNanos);
  proto.setAction(ev.getActionMasked());
  proto.setActionIndex(ev.getActionIndex());
  proto.pointers=new TouchEvent.Pointer[count];
  for (int i=0; i < count; i++) {
    TouchEvent.Pointer p=new TouchEvent.Pointer();
    p.setX(ev.getX(i));
    p.setY(ev.getY(i));
    p.setSize(ev.getSize(i));
    p.setPressure(ev.getPressure(i));
    p.setId(ev.getPointerId(i));
    proto.pointers[i]=p;
    if ((ev.getActionMasked() == MotionEvent.ACTION_POINTER_UP && ev.getActionIndex() == i) || ev.getActionMasked() == MotionEvent.ACTION_UP) {
      p.boundingBox=mPointerTracker.getPointerBoundingBox(p.getId());
      p.setLength(mPointerTracker.getPointerLength(p.getId()));
    }
  }
  if (ev.getActionMasked() == MotionEvent.ACTION_UP) {
    proto.boundingBox=mPointerTracker.getBoundingBox();
  }
  return proto;
}
