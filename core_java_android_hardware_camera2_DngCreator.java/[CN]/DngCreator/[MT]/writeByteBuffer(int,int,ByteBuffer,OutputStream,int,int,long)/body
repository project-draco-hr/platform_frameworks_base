{
  if (width <= 0 || height <= 0) {
    throw new IllegalArgumentException("Image with invalid width, height: (" + width + ","+ height+ ") passed to write");
  }
  long capacity=pixels.capacity();
  long totalSize=((long)rowStride) * height + offset;
  if (capacity < totalSize) {
    throw new IllegalArgumentException("Image size " + capacity + " is too small (must be larger than "+ totalSize+ ")");
  }
  int minRowStride=pixelStride * width;
  if (minRowStride > rowStride) {
    throw new IllegalArgumentException("Invalid image pixel stride, row byte width " + minRowStride + " is too large, expecting "+ rowStride);
  }
  pixels.clear();
  nativeWriteImage(dngOutput,width,height,pixels,rowStride,pixelStride,offset,pixels.isDirect());
  pixels.clear();
}
