{
  if (!isAutomaticTimeRequested())   return;
  final long refTime=SystemClock.elapsedRealtime();
  if (mNitzTimeSetTime != NOT_SET && refTime - mNitzTimeSetTime < POLLING_INTERVAL_MS) {
    resetAlarm(POLLING_INTERVAL_MS);
    return;
  }
  final long currentTime=System.currentTimeMillis();
  if (DBG)   Log.d(TAG,"System time = " + currentTime);
  if (mLastNtpFetchTime == NOT_SET || refTime >= mLastNtpFetchTime + POLLING_INTERVAL_MS || event == EVENT_AUTO_TIME_CHANGED) {
    if (DBG)     Log.d(TAG,"Before Ntp fetch");
    if (mTime.getCacheAge() >= POLLING_INTERVAL_MS) {
      mTime.forceRefresh();
    }
    if (mTime.getCacheAge() < POLLING_INTERVAL_MS) {
      final long ntp=mTime.currentTimeMillis();
      mTryAgainCounter=0;
      mLastNtpFetchTime=SystemClock.elapsedRealtime();
      if (Math.abs(ntp - currentTime) > TIME_ERROR_THRESHOLD_MS) {
        if (DBG)         Log.d(TAG,"Ntp time to be set = " + ntp);
        if (ntp / 1000 < Integer.MAX_VALUE) {
          SystemClock.setCurrentTimeMillis(ntp);
        }
      }
 else {
        if (DBG)         Log.d(TAG,"Ntp time is close enough = " + ntp);
      }
    }
 else {
      mTryAgainCounter++;
      if (mTryAgainCounter <= TRY_AGAIN_TIMES_MAX) {
        resetAlarm(POLLING_INTERVAL_SHORTER_MS);
      }
 else {
        mTryAgainCounter=0;
        resetAlarm(POLLING_INTERVAL_MS);
      }
      return;
    }
  }
  resetAlarm(POLLING_INTERVAL_MS);
}
