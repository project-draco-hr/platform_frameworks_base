{
  Log.v(TAG,"setListener(): " + listener);
synchronized (SipService.this) {
    mProxy.setListener(listener);
    if (mSession == null)     return;
    try {
      SipSessionState state=(mSession == null) ? SipSessionState.READY_TO_CALL : Enum.valueOf(SipSessionState.class,mSession.getState());
      if ((state == SipSessionState.REGISTERING) || (state == SipSessionState.DEREGISTERING)) {
        mProxy.onRegistering(mSession);
      }
 else       if (mRegistered) {
        int duration=(int)(mExpiryTime - SystemClock.elapsedRealtime());
        mProxy.onRegistrationDone(mSession,duration);
      }
 else       if (mErrorCode != null) {
        if (mErrorCode == SipErrorCode.TIME_OUT) {
          mProxy.onRegistrationTimeout(mSession);
        }
 else {
          mProxy.onRegistrationFailed(mSession,mErrorCode.toString(),mErrorMessage);
        }
      }
    }
 catch (    Throwable t) {
      Log.w(TAG,"setListener(): " + t);
    }
  }
}
