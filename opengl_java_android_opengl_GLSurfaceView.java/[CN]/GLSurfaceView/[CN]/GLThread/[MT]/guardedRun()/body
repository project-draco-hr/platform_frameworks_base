{
  mEglHelper=new EglHelper();
  try {
    GL10 gl=null;
    boolean tellRendererSurfaceCreated=true;
    boolean tellRendererSurfaceChanged=true;
    while (!isDone()) {
      int w=0;
      int h=0;
      boolean changed=false;
      boolean needStart=false;
      boolean eventsWaiting=false;
synchronized (sGLThreadManager) {
        while (true) {
          if (mPaused) {
            stopEglLocked();
          }
          if (!mHasSurface) {
            if (!mWaitingForSurface) {
              stopEglLocked();
              mWaitingForSurface=true;
              sGLThreadManager.notifyAll();
            }
          }
 else {
            if (!mHaveEgl) {
              if (sGLThreadManager.tryAcquireEglSurface(this)) {
                mHaveEgl=true;
                mEglHelper.start();
                mRequestRender=true;
                needStart=true;
              }
            }
          }
          if (mDone) {
            return;
          }
          if (mEventsWaiting) {
            eventsWaiting=true;
            mEventsWaiting=false;
            break;
          }
          if ((!mPaused) && mHasSurface && mHaveEgl&& (mWidth > 0)&& (mHeight > 0)&& (mRequestRender || (mRenderMode == RENDERMODE_CONTINUOUSLY))) {
            changed=mSizeChanged;
            w=mWidth;
            h=mHeight;
            mSizeChanged=false;
            mRequestRender=false;
            if (mHasSurface && mWaitingForSurface) {
              changed=true;
              mWaitingForSurface=false;
              sGLThreadManager.notifyAll();
            }
            break;
          }
          if (LOG_THREADS) {
            Log.i("GLThread","waiting tid=" + getId());
          }
          sGLThreadManager.wait();
        }
      }
      if (eventsWaiting) {
        Runnable r;
        while ((r=getEvent()) != null) {
          r.run();
          if (isDone()) {
            return;
          }
        }
        continue;
      }
      if (needStart) {
        tellRendererSurfaceCreated=true;
        changed=true;
      }
      if (changed) {
        gl=(GL10)mEglHelper.createSurface(getHolder());
        sGLThreadManager.checkGLDriver(gl);
        tellRendererSurfaceChanged=true;
      }
      if (tellRendererSurfaceCreated) {
        mRenderer.onSurfaceCreated(gl,mEglHelper.mEglConfig);
        tellRendererSurfaceCreated=false;
      }
      if (tellRendererSurfaceChanged) {
        mRenderer.onSurfaceChanged(gl,w,h);
        tellRendererSurfaceChanged=false;
      }
      if ((w > 0) && (h > 0)) {
        mRenderer.onDrawFrame(gl);
        mEglHelper.swap();
      }
    }
  }
  finally {
synchronized (sGLThreadManager) {
      stopEglLocked();
    }
  }
}
