{
  mEglHelper=new EglHelper();
  try {
    mEglHelper.start();
    GL10 gl=null;
    boolean tellRendererSurfaceCreated=true;
    boolean tellRendererSurfaceChanged=true;
    while (!mDone) {
      int w, h;
      boolean changed;
      boolean needStart=false;
synchronized (this) {
        Runnable r;
        while ((r=getEvent()) != null) {
          r.run();
        }
        if (mPaused) {
          mEglHelper.destroySurface();
          mEglHelper.finish();
          needStart=true;
        }
        while (needToWait()) {
          if (LOG_THREADS) {
            Log.i("GLThread","needToWait tid=" + getId());
          }
          if (!mHasSurface) {
            if (!mWaitingForSurface) {
              mEglHelper.destroySurface();
              mWaitingForSurface=true;
              notifyAll();
            }
          }
          wait();
        }
        if (mDone) {
          break;
        }
        changed=mSizeChanged;
        w=mWidth;
        h=mHeight;
        mSizeChanged=false;
        mRequestRender=false;
        if (mHasSurface && mWaitingForSurface) {
          changed=true;
          mWaitingForSurface=false;
          notifyAll();
        }
      }
      if (needStart) {
        mEglHelper.start();
        tellRendererSurfaceCreated=true;
        changed=true;
      }
      if (changed) {
        gl=(GL10)mEglHelper.createSurface(getHolder());
        sGLThreadManager.checkGLDriver(gl);
        tellRendererSurfaceChanged=true;
      }
      if (tellRendererSurfaceCreated) {
        mRenderer.onSurfaceCreated(gl,mEglHelper.mEglConfig);
        tellRendererSurfaceCreated=false;
      }
      if (tellRendererSurfaceChanged) {
        mRenderer.onSurfaceChanged(gl,w,h);
        tellRendererSurfaceChanged=false;
      }
      if ((w > 0) && (h > 0)) {
        mRenderer.onDrawFrame(gl);
        mEglHelper.swap();
      }
    }
  }
  finally {
    mEglHelper.destroySurface();
    mEglHelper.finish();
  }
}
