{
  ProcessRecord fgApp=null;
  for (int stackNdx=mStacks.size() - 1; stackNdx >= 0; --stackNdx) {
    final ActivityStack stack=mStacks.get(stackNdx);
    if (isFrontStack(stack)) {
      if (stack.mResumedActivity != null) {
        fgApp=stack.mResumedActivity.app;
      }
 else       if (stack.mPausingActivity != null) {
        fgApp=stack.mPausingActivity.app;
      }
      break;
    }
  }
  if (r.app != null && fgApp != null && r.app != fgApp && r.lastVisibleTime > mService.mPreviousProcessVisibleTime && !mService.mHomeProcess.contains(r.app)) {
    mService.mPreviousProcess=r.app;
    mService.mPreviousProcessVisibleTime=r.lastVisibleTime;
  }
}
