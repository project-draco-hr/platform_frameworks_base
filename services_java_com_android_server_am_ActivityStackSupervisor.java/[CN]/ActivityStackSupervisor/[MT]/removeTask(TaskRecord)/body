{
  final ActivityStack stack=task.stack;
  if (stack.removeTask(task) && !stack.isHomeStack()) {
    mStacks.remove(stack);
    final int oldStackId=stack.mStackId;
    final int newMainStackId=mService.mWindowManager.removeStack(oldStackId);
    if (newMainStackId == HOME_STACK_ID) {
      return;
    }
    if (mMainStack.mStackId == oldStackId) {
      mMainStack=getStack(newMainStackId);
    }
  }
}
