{
  mWindowManager.removeTask(task.taskId);
  final ActivityStack stack=task.stack;
  final ActivityRecord r=stack.mResumedActivity;
  if (r != null && r.task == task) {
    stack.mResumedActivity=null;
  }
  if (stack.removeTask(task) && !stack.isHomeStack()) {
    if (DEBUG_STACK)     Slog.i(TAG,"removeTask: removing stack " + stack);
    mStacks.remove(stack);
    final int stackId=stack.mStackId;
    final int nextStackId=mWindowManager.removeStack(stackId);
    if (mFocusedStack == null || mFocusedStack.mStackId == stackId) {
      mFocusedStack=nextStackId == HOME_STACK_ID ? null : getStack(nextStackId);
    }
  }
}
