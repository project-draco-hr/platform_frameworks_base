{
  final TaskRecord task=r.task;
  if (r.isApplicationActivity() || (task != null && task.isApplicationTask())) {
    int stackNdx;
    for (stackNdx=mStacks.size() - 1; stackNdx > 0; --stackNdx) {
      if (mStacks.get(stackNdx).mCurrentUser == mCurrentUser) {
        break;
      }
    }
    if (stackNdx == 0) {
      int stackId=mService.createStack(-1,HOME_STACK_ID,StackBox.TASK_STACK_GOES_OVER,1.0f);
      if (DEBUG_FOCUS)       Slog.d(TAG,"getCorrectStack: New stack r=" + r + " stackId="+ stackId);
      mFocusedStack=getStack(stackId);
    }
    if (task != null) {
      if (DEBUG_FOCUS)       Slog.d(TAG,"getCorrectStack: Setting focused stack to r=" + r + " task="+ task);
      mFocusedStack=task.stack;
    }
    return mFocusedStack;
  }
  return mHomeStack;
}
