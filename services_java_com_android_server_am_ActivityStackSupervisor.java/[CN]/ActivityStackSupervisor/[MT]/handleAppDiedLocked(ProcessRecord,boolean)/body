{
  boolean launchHomeTaskNext=false;
  final ActivityStack focusedStack=getFocusedStack();
  final int numStacks=mStacks.size();
  for (int stackNdx=0; stackNdx < numStacks; ++stackNdx) {
    final ActivityStack stack=mStacks.get(stackNdx);
    launchHomeTaskNext|=(stack == focusedStack && stack.handleAppDiedLocked(app));
  }
  if (!restarting) {
    if (launchHomeTaskNext) {
      resumeHomeActivity(null);
    }
 else {
      if (!resumeTopActivitiesLocked(focusedStack,null,null)) {
        ensureActivitiesVisibleLocked(null,0);
      }
    }
  }
}
