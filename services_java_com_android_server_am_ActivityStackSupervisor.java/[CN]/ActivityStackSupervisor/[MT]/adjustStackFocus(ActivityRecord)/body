{
  final TaskRecord task=r.task;
  if (r.isApplicationActivity() || (task != null && task.isApplicationTask())) {
    if (task != null) {
      final ActivityStack taskStack=task.stack;
      if (mFocusedStack != taskStack) {
        if (DEBUG_FOCUS || DEBUG_STACK)         Slog.d(TAG,"adjustStackFocus: Setting focused stack to r=" + r + " task="+ task);
        mFocusedStack=taskStack.isHomeStack() ? null : taskStack;
      }
 else {
        if (DEBUG_FOCUS || DEBUG_STACK)         Slog.d(TAG,"adjustStackFocus: Focused stack already=" + mFocusedStack);
      }
      return taskStack;
    }
    if (mFocusedStack != null) {
      if (DEBUG_FOCUS || DEBUG_STACK)       Slog.d(TAG,"adjustStackFocus: Have a focused stack=" + mFocusedStack);
      return mFocusedStack;
    }
    for (int stackNdx=mStacks.size() - 1; stackNdx > 0; --stackNdx) {
      ActivityStack stack=mStacks.get(stackNdx);
      if (!stack.isHomeStack()) {
        if (DEBUG_FOCUS || DEBUG_STACK)         Slog.d(TAG,"adjustStackFocus: Setting focused stack=" + stack);
        mFocusedStack=stack;
        return mFocusedStack;
      }
    }
    int stackId=mService.createStack(-1,HOME_STACK_ID,StackBox.TASK_STACK_GOES_OVER,1.0f);
    if (DEBUG_FOCUS || DEBUG_STACK)     Slog.d(TAG,"adjustStackFocus: New stack r=" + r + " stackId="+ stackId);
    mFocusedStack=getStack(stackId);
    return mFocusedStack;
  }
  return mHomeStack;
}
