{
  File temp=null;
  OutputStream out=null;
  try {
    if ((flags & DropBoxEntry.IS_EMPTY) != 0)     throw new IllegalArgumentException();
    init();
    if (!isTagEnabled(tag))     return;
    long max=trimToFit();
    if (data.length > max) {
      Log.w(TAG,"Dropping: " + tag + " ("+ data.length+ " > "+ max+ " bytes)");
    }
 else {
      temp=new File(mDropBoxDir,"drop" + Thread.currentThread().getId() + ".tmp");
      out=new FileOutputStream(temp);
      if (data.length > mBlockSize && ((flags & DropBoxEntry.IS_GZIPPED) == 0)) {
        flags=flags | DropBoxEntry.IS_GZIPPED;
        out=new GZIPOutputStream(out);
      }
      out.write(data);
      out.close();
      out=null;
    }
    createEntry(temp,tag,flags);
    temp=null;
  }
 catch (  IOException e) {
    Log.e(TAG,"Can't write: " + tag,e);
  }
 finally {
    try {
      if (out != null)       out.close();
    }
 catch (    IOException e) {
    }
    if (temp != null)     temp.delete();
  }
}
