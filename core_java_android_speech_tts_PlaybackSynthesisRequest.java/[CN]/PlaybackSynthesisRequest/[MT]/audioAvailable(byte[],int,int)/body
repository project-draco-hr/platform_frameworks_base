{
  if (DBG) {
    Log.d(TAG,"audioAvailable(byte[" + buffer.length + "],"+ offset+ ","+ length+ ")");
  }
  if (length > getMaxBufferSize()) {
    throw new IllegalArgumentException("buffer is too large (" + length + " bytes)");
  }
synchronized (mStateLock) {
    if (mStopped) {
      if (DBG)       Log.d(TAG,"Request has been aborted.");
      return TextToSpeech.ERROR;
    }
    if (mAudioTrack == null) {
      Log.e(TAG,"audioAvailable(): Not started");
      return TextToSpeech.ERROR;
    }
    int playState=mAudioTrack.getPlayState();
    if (playState == AudioTrack.PLAYSTATE_STOPPED) {
      if (DBG)       Log.d(TAG,"AudioTrack stopped, restarting");
      mAudioTrack.play();
    }
    if (DBG)     Log.d(TAG,"AudioTrack.write()");
    int count=mAudioTrack.write(buffer,offset,length);
    if (DBG)     Log.d(TAG,"AudioTrack.write() returned " + count);
    if (count < 0) {
      Log.e(TAG,"Writing to AudioTrack failed: " + count);
      cleanUp();
      return TextToSpeech.ERROR;
    }
 else {
      return TextToSpeech.SUCCESS;
    }
  }
}
