{
  int channelConfig;
  if (channelCount == 1) {
    channelConfig=AudioFormat.CHANNEL_OUT_MONO;
  }
 else   if (channelCount == 2) {
    channelConfig=AudioFormat.CHANNEL_OUT_STEREO;
  }
 else {
    Log.e(TAG,"Unsupported number of channels: " + channelCount);
    return null;
  }
  int minBufferSizeInBytes=AudioTrack.getMinBufferSize(sampleRateInHz,channelConfig,audioFormat);
  int bufferSizeInBytes=Math.max(MIN_AUDIO_BUFFER_SIZE,minBufferSizeInBytes);
  AudioTrack audioTrack=new AudioTrack(mStreamType,sampleRateInHz,channelConfig,audioFormat,bufferSizeInBytes,mode);
  if (audioTrack == null) {
    return null;
  }
  if (audioTrack.getState() != AudioTrack.STATE_INITIALIZED) {
    audioTrack.release();
    return null;
  }
  setupVolume(audioTrack,mVolume,mPan);
  return audioTrack;
}
