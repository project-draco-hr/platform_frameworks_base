{
  if (conditions == null || conditions.length == 0)   return null;
  final int N=conditions.length;
  final ArrayMap<Uri,Condition> valid=new ArrayMap<Uri,Condition>(N);
  for (int i=0; i < N; i++) {
    final Uri id=conditions[i].id;
    if (!Condition.isValidId(id,pkg)) {
      Slog.w(TAG,"Ignoring condition from " + pkg + " for invalid id: "+ id);
      continue;
    }
    if (valid.containsKey(id)) {
      Slog.w(TAG,"Ignoring condition from " + pkg + " for duplicate id: "+ id);
      continue;
    }
    valid.put(id,conditions[i]);
  }
  if (valid.size() == 0)   return null;
  if (valid.size() == N)   return conditions;
  final Condition[] rt=new Condition[valid.size()];
  for (int i=0; i < rt.length; i++) {
    rt[i]=valid.valueAt(i);
  }
  return rt;
}
