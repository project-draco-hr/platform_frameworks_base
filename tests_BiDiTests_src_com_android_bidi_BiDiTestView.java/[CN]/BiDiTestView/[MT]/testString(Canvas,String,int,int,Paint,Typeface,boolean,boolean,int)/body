{
  paint.setTypeface(typeface);
  boolean oldFakeBold=paint.isFakeBoldText();
  paint.setFakeBoldText(isBold);
  float oldTextSkewX=paint.getTextSkewX();
  if (isItalic) {
    paint.setTextSkewX(DEFAULT_ITALIC_SKEW_X);
  }
  drawTextWithCanvasDrawText(text,canvas,x,y,TEXT_SIZE,Color.WHITE);
  int length=text.length();
  float[] advances=new float[length];
  float textWidth=paint.getTextRunAdvances(text,0,length,0,length,0,advances,0);
  logAdvances(text,textWidth,advances);
  drawBoxAroundText(canvas,x,y,textWidth,TEXT_SIZE,Color.RED);
  paint.setColor(Color.WHITE);
  char[] glyphs=new char[2 * length];
  int count=getGlyphs(text,glyphs,dir);
  logGlypths(glyphs,count);
  drawTextWithDrawGlyph(canvas,glyphs,count,x,y + DELTA_Y);
  paint.setFakeBoldText(oldFakeBold);
  paint.setTextSkewX(oldTextSkewX);
  return (int)Math.ceil(textWidth) + TEXT_PADDING;
}
