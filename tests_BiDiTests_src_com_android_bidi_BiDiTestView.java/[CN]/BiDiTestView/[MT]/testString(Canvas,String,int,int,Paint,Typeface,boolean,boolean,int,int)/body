{
  paint.setTypeface(typeface);
  boolean oldFakeBold=paint.isFakeBoldText();
  paint.setFakeBoldText(isBold);
  float oldTextSkewX=paint.getTextSkewX();
  if (isItalic) {
    paint.setTextSkewX(DEFAULT_ITALIC_SKEW_X);
  }
  Log.v(TAG,"START -- drawTextWithCanvasDrawText");
  drawTextWithCanvasDrawText(text,canvas,x,y,textSize,Color.WHITE,dir);
  Log.v(TAG,"END   -- drawTextWithCanvasDrawText");
  int length=text.length();
  float[] advances=new float[length];
  float textWidthHB=paint.getTextRunAdvances(text,0,length,0,length,dir,advances,0);
  setPaintDir(paint,dir);
  float textWidthICU=paint.getTextRunAdvancesICU(text,0,length,0,length,dir,advances,0);
  logAdvances(text,textWidthHB,textWidthICU,advances);
  drawMetricsAroundText(canvas,x,y,textWidthHB,textWidthICU,textSize,Color.RED,Color.GREEN);
  paint.setColor(Color.WHITE);
  Log.v(TAG,"START -- drawTextWithGlyphs");
  drawTextWithGlyphs(canvas,text,x,y + currentTextSize,dir);
  Log.v(TAG,"END   -- drawTextWithGlyphs");
  paint.setFakeBoldText(oldFakeBold);
  paint.setTextSkewX(oldTextSkewX);
  return (int)Math.ceil(textWidthHB) + TEXT_PADDING;
}
