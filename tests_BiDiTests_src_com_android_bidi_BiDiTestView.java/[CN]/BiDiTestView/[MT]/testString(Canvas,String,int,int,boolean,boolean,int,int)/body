{
  TextPaint paint=new TextPaint();
  paint.setAntiAlias(true);
  boolean oldFakeBold=paint.isFakeBoldText();
  paint.setFakeBoldText(isBold);
  float oldTextSkewX=paint.getTextSkewX();
  if (isItalic) {
    paint.setTextSkewX(DEFAULT_ITALIC_SKEW_X);
  }
  paint.setTextSize(textSize);
  paint.setColor(Color.WHITE);
  canvas.drawText(text,x,y,paint);
  int length=text.length();
  float[] advances=new float[length];
  float textWidthHB=paint.getTextRunAdvances(text,0,length,0,length,dir,advances,0);
  setPaintDir(paint,dir);
  float textWidthICU=paint.getTextRunAdvances(text,0,length,0,length,dir,advances,0,1);
  logAdvances(text,textWidthHB,textWidthICU,advances);
  drawMetricsAroundText(canvas,x,y,textWidthHB,textWidthICU,textSize,Color.RED,Color.GREEN);
  paint.setFakeBoldText(oldFakeBold);
  paint.setTextSkewX(oldTextSkewX);
  return (int)Math.ceil(textWidthHB) + TEXT_PADDING;
}
