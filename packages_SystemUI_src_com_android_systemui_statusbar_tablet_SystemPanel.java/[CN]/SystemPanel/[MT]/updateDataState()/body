{
  mDataConnected=hasService() && (mDataState == TelephonyManager.DATA_CONNECTED);
  if (isCdma()) {
    if ((mPhoneState == TelephonyManager.CALL_STATE_IDLE) && isEvdo()) {
      mDataLevel=getEvdoLevel() * 25;
    }
 else {
      mDataLevel=getCdmaLevel() * 25;
    }
  }
 else {
    int asu=(mSignalStrength == null) ? 0 : mSignalStrength.getGsmSignalStrength();
    if (asu <= 2 || asu == 99)     mDataLevel=0;
 else     mDataLevel=(int)(((float)Math.max(asu,15) / 15) * 100);
    mDataRoaming=mPhone.isNetworkRoaming();
    mDataConnected=mDataConnected && (mSimState == IccCard.State.READY || mSimState == IccCard.State.UNKNOWN);
  }
  if (DEBUG_SIGNAL || DEBUG) {
    Slog.d(TAG,"updateDataState: connected=" + mDataConnected + " level="+ mDataLevel+ " isEvdo="+ isEvdo()+ " isCdma="+ isCdma()+ " mPhoneState="+ mPhoneState+ " mDataState="+ mDataState);
  }
  refreshSignalMeters();
}
