{
  int icon=R.drawable.ic_sysbar_brightness;
  int bg=R.drawable.sysbar_toggle_bg_on;
  Context context=getContext();
  try {
    IPowerManager power=IPowerManager.Stub.asInterface(ServiceManager.getService("power"));
    if (power != null) {
      ContentResolver cr=context.getContentResolver();
      int brightness=Settings.System.getInt(cr,Settings.System.SCREEN_BRIGHTNESS);
      int brightnessMode=Settings.System.SCREEN_BRIGHTNESS_MODE_MANUAL;
      if (context.getResources().getBoolean(com.android.internal.R.bool.config_automatic_brightness_available)) {
        brightnessMode=Settings.System.getInt(cr,Settings.System.SCREEN_BRIGHTNESS_MODE);
      }
      if (brightnessMode == Settings.System.SCREEN_BRIGHTNESS_MODE_AUTOMATIC) {
        brightness=MINIMUM_BACKLIGHT;
        icon=R.drawable.ic_sysbar_brightness_low;
        brightnessMode=Settings.System.SCREEN_BRIGHTNESS_MODE_MANUAL;
      }
 else       if (brightness < DEFAULT_BACKLIGHT) {
        brightness=DEFAULT_BACKLIGHT;
      }
 else       if (brightness < MAXIMUM_BACKLIGHT) {
        brightness=MAXIMUM_BACKLIGHT;
      }
 else {
        brightnessMode=Settings.System.SCREEN_BRIGHTNESS_MODE_AUTOMATIC;
        brightness=MINIMUM_BACKLIGHT;
        icon=R.drawable.ic_sysbar_brightness_auto;
      }
      if (context.getResources().getBoolean(com.android.internal.R.bool.config_automatic_brightness_available)) {
        Settings.System.putInt(context.getContentResolver(),Settings.System.SCREEN_BRIGHTNESS_MODE,brightnessMode);
      }
 else {
        brightnessMode=Settings.System.SCREEN_BRIGHTNESS_MODE_MANUAL;
      }
      if (brightnessMode == Settings.System.SCREEN_BRIGHTNESS_MODE_MANUAL) {
        power.setBacklightBrightness(brightness);
        Settings.System.putInt(cr,Settings.System.SCREEN_BRIGHTNESS,brightness);
      }
    }
  }
 catch (  RemoteException e) {
  }
catch (  Settings.SettingNotFoundException e) {
  }
  mBrightnessButton.setImageResource(icon);
  mBrightnessButton.setBackgroundResource(bg);
}
