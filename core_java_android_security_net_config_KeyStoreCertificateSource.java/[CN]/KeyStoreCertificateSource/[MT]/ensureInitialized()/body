{
synchronized (mLock) {
    if (mCertificates != null) {
      return;
    }
    try {
      TrustedCertificateIndex localIndex=new TrustedCertificateIndex();
      Set<X509Certificate> certificates=new ArraySet<>(mKeyStore.size());
      for (Enumeration<String> en=mKeyStore.aliases(); en.hasMoreElements(); ) {
        String alias=en.nextElement();
        X509Certificate cert=(X509Certificate)mKeyStore.getCertificate(alias);
        if (cert != null) {
          certificates.add(cert);
          localIndex.index(cert);
        }
      }
      mIndex=localIndex;
      mCertificates=certificates;
    }
 catch (    KeyStoreException e) {
      throw new RuntimeException("Failed to load certificates from KeyStore",e);
    }
  }
}
