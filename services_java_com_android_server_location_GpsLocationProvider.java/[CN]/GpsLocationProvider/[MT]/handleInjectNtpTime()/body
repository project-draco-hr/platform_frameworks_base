{
  if (!mNetworkAvailable) {
    mInjectNtpTimePending=true;
    return;
  }
  mInjectNtpTimePending=false;
  SntpClient client=new SntpClient();
  long delay;
  if (client.requestTime(mNtpServer,10000)) {
    long time=client.getNtpTime();
    long timeReference=client.getNtpTimeReference();
    int certainty=(int)(client.getRoundTripTime() / 2);
    long now=System.currentTimeMillis();
    Log.d(TAG,"NTP server returned: " + time + " ("+ new Date(time)+ ") reference: "+ timeReference+ " certainty: "+ certainty+ " system time offset: "+ (time - now));
    native_inject_time(time,timeReference,certainty);
    delay=NTP_INTERVAL;
  }
 else {
    if (DEBUG)     Log.d(TAG,"requestTime failed");
    delay=RETRY_INTERVAL;
  }
  if (mPeriodicTimeInjection) {
    mHandler.removeMessages(INJECT_NTP_TIME);
    mHandler.sendMessageDelayed(Message.obtain(mHandler,INJECT_NTP_TIME),delay);
  }
}
