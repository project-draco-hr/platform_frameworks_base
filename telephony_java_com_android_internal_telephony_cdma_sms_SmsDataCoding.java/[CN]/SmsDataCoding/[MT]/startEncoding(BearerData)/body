{
  int m_id;
  byte[] m_data;
  int dataLength;
  byte[] encodedSms;
  int nbrOfHeaders=0;
  if (nativeCdmaSmsSetBearerDataPrimitives(bearerData) == JNI_CDMA_SMS_FAILURE) {
    return null;
  }
  if ((bearerData.mask & CDMA_SMS_WMS_MASK_BD_USER_DATA) == CDMA_SMS_WMS_MASK_BD_USER_DATA) {
    if (nativeCdmaSmsSetUserData(bearerData.userData) == JNI_CDMA_SMS_FAILURE) {
      return null;
    }
    if (bearerData.userData.userDataHeader != null) {
      nbrOfHeaders=bearerData.userData.userDataHeader.nbrOfHeaders;
    }
    for (int i=0; i < nbrOfHeaders; i++) {
      m_id=bearerData.userData.userDataHeader.getElements().get(i).getID();
      m_data=bearerData.userData.userDataHeader.getElements().get(i).getData();
      dataLength=m_data.length;
      if (nativeCdmaSmsSetUserDataHeader(m_id,m_data,dataLength,i) == JNI_CDMA_SMS_FAILURE) {
        return null;
      }
    }
  }
  if ((bearerData.mask & CDMA_SMS_WMS_MASK_BD_CALLBACK) == CDMA_SMS_WMS_MASK_BD_CALLBACK) {
    if (nativeCdmaSmsSetSmsAddress(bearerData.callbackNumber) == JNI_CDMA_SMS_FAILURE) {
      return null;
    }
  }
  encodedSms=nativeCdmaSmsEncodeSms();
  return encodedSms;
}
