{
  ApplicationInfo info=null;
  try {
    info=context.getPackageManager().getApplicationInfo(context.getPackageName(),PackageManager.GET_META_DATA);
  }
 catch (  PackageManager.NameNotFoundException e) {
    throw new RuntimeException("Failed to look up ApplicationInfo",e);
  }
  int configResourceId=0;
  if (info != null && info.metaData != null) {
    configResourceId=info.metaData.getInt(META_DATA_NETWORK_SECURITY_CONFIG);
  }
  ApplicationConfig config;
  if (configResourceId != 0) {
    boolean debugBuild=(info.flags & ApplicationInfo.FLAG_DEBUGGABLE) != 0;
    if (DBG) {
      Log.d(LOG_TAG,"Using Network Security Config from resource " + context.getResources().getResourceEntryName(configResourceId) + " debugBuild: "+ debugBuild);
    }
    ConfigSource source=new XmlConfigSource(context,configResourceId,debugBuild);
    config=new ApplicationConfig(source);
  }
 else {
    if (DBG) {
      Log.d(LOG_TAG,"No Network Security Config specified, using platform default");
    }
    config=ApplicationConfig.getPlatformDefault();
  }
  ApplicationConfig.setDefaultInstance(config);
  int pos=Security.insertProviderAt(new NetworkSecurityConfigProvider(),1);
  if (pos != 1) {
    throw new RuntimeException("Failed to install provider as highest priority provider." + " Provider was installed at position " + pos);
  }
}
