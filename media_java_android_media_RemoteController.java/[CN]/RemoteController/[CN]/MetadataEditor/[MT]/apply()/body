{
  if (!mMetadataChanged) {
    return;
  }
  if (USE_SESSIONS) {
synchronized (mInfoLock) {
      if (mCurrentSession != null) {
        if (mEditorMetadata.containsKey(String.valueOf(MediaMetadataEditor.RATING_KEY_BY_USER))) {
          Rating rating=(Rating)getObject(MediaMetadataEditor.RATING_KEY_BY_USER,null);
          if (rating != null) {
            mCurrentSession.getTransportControls().setRating(rating);
          }
        }
      }
    }
  }
 else {
    final int genId;
synchronized (mGenLock) {
      genId=mClientGenerationIdCurrent;
    }
synchronized (mInfoLock) {
      if (mEditorMetadata.containsKey(String.valueOf(MediaMetadataEditor.RATING_KEY_BY_USER))) {
        Rating rating=(Rating)getObject(MediaMetadataEditor.RATING_KEY_BY_USER,null);
        mAudioManager.updateRemoteControlClientMetadata(genId,MediaMetadataEditor.RATING_KEY_BY_USER,rating);
      }
 else {
        Log.e(TAG,"no metadata to apply");
      }
    }
  }
  mApplied=false;
}
