{
  if (DEBUG) {
    Log.d(TAG,"Updating controller to " + controller + " previous controller is "+ mCurrentSession);
  }
synchronized (mInfoLock) {
    if (controller == null) {
      if (mCurrentSession != null) {
        mCurrentSession.removeCallback(mSessionCb);
        mCurrentSession=null;
        sendMsg(mEventHandler,MSG_CLIENT_CHANGE,SENDMSG_REPLACE,0,1,null,0);
      }
    }
 else     if (mCurrentSession == null || !controller.getSessionToken().equals(mCurrentSession.getSessionToken())) {
      if (mCurrentSession != null) {
        mCurrentSession.removeCallback(mSessionCb);
      }
      sendMsg(mEventHandler,MSG_CLIENT_CHANGE,SENDMSG_REPLACE,0,0,null,0);
      mCurrentSession=controller;
      mCurrentSession.addCallback(mSessionCb,mEventHandler);
      PlaybackState state=controller.getPlaybackState();
      sendMsg(mEventHandler,MSG_NEW_PLAYBACK_STATE,SENDMSG_REPLACE,0,0,state,0);
      MediaMetadata metadata=controller.getMetadata();
      sendMsg(mEventHandler,MSG_NEW_MEDIA_METADATA,SENDMSG_REPLACE,0,0,metadata,0);
    }
  }
}
