{
  if (USE_SESSIONS) {
synchronized (mInfoLock) {
      if (mCurrentSession != null) {
        PlaybackState state=mCurrentSession.getPlaybackState();
        if (state != null) {
          return state.getPosition();
        }
      }
    }
  }
 else {
    final PlaybackInfo lastPlaybackInfo;
synchronized (mInfoLock) {
      lastPlaybackInfo=mLastPlaybackInfo;
    }
    if (lastPlaybackInfo != null) {
      if (!RemoteControlClient.playbackPositionShouldMove(lastPlaybackInfo.mState)) {
        return lastPlaybackInfo.mCurrentPosMs;
      }
      final long thenPos=lastPlaybackInfo.mCurrentPosMs;
      if (thenPos < 0) {
        return -1;
      }
      final long now=SystemClock.elapsedRealtime();
      final long then=lastPlaybackInfo.mStateChangeTimeMs;
      final long sinceThen=now - then;
      final long scaledSinceThen=(long)(sinceThen * lastPlaybackInfo.mSpeed);
      return thenPos + scaledSinceThen;
    }
  }
  return -1;
}
