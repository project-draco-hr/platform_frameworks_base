{
  if (oldPackage != null && !oldPackage.equals(mPackage)) {
    return false;
  }
  if (newPackage == null || (newPackage.equals(mPackage) && !newPackage.equals(VpnConfig.LEGACY_VPN))) {
    return true;
  }
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("Unauthorized Caller");
  }
  if (mInterface != null) {
    jniReset(mInterface);
    mCallback.restore();
    hideNotification();
    mInterface=null;
  }
  if (!mPackage.equals(VpnConfig.LEGACY_VPN)) {
  }
 else   if (mLegacyVpnRunner != null) {
    mLegacyVpnRunner.exit();
    mLegacyVpnRunner=null;
  }
  Log.i(TAG,"Switched from " + mPackage + " to "+ newPackage);
  mPackage=newPackage;
  return true;
}
