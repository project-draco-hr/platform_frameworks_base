{
  if (packageName == null) {
    return mPackageName;
  }
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("Unauthorized Caller");
  }
  PackageManager pm=mContext.getPackageManager();
  if (packageName.isEmpty()) {
    packageName=null;
  }
 else   if (pm.checkPermission(VPN,packageName) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException(packageName + " does not have " + VPN);
  }
  if (mInterfaceName != null) {
    jniResetInterface(mInterfaceName);
    mCallback.restore();
    hideNotification();
    mInterfaceName=null;
  }
  if (mPackageName != null) {
    Intent intent=new Intent(VpnConfig.ACTION_VPN_REVOKED);
    intent.setPackage(mPackageName);
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    mContext.sendBroadcast(intent);
  }
  if (mLegacyVpnRunner != null) {
    mLegacyVpnRunner.exit();
    mLegacyVpnRunner=null;
  }
  Log.i(TAG,"Switched from " + mPackageName + " to "+ packageName);
  mPackageName=packageName;
  return mPackageName;
}
