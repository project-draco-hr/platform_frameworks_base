{
  PackageManager pm=mContext.getPackageManager();
  ApplicationInfo app=null;
  try {
    app=pm.getApplicationInfo(mPackage,0);
  }
 catch (  Exception e) {
    return null;
  }
  if (Binder.getCallingUid() != app.uid) {
    return null;
  }
  Intent intent=new Intent(VpnConfig.SERVICE_INTERFACE);
  intent.setClassName(mPackage,config.user);
  ResolveInfo info=pm.resolveService(intent,0);
  if (info == null) {
    throw new SecurityException("Cannot find " + config.user);
  }
  if (!BIND_VPN_SERVICE.equals(info.serviceInfo.permission)) {
    throw new SecurityException(config.user + " does not require " + BIND_VPN_SERVICE);
  }
  String label=app.loadLabel(pm).toString();
  Drawable icon=app.loadIcon(pm);
  Bitmap bitmap=null;
  if (icon.getIntrinsicWidth() > 0 && icon.getIntrinsicHeight() > 0) {
    int width=mContext.getResources().getDimensionPixelSize(android.R.dimen.notification_large_icon_width);
    int height=mContext.getResources().getDimensionPixelSize(android.R.dimen.notification_large_icon_height);
    icon.setBounds(0,0,width,height);
    bitmap=Bitmap.createBitmap(width,height,Bitmap.Config.ARGB_8888);
    Canvas c=new Canvas(bitmap);
    icon.draw(c);
    c.setBitmap(null);
  }
  ParcelFileDescriptor tun=ParcelFileDescriptor.adoptFd(jniCreate(config.mtu));
  try {
    String interfaze=jniGetName(tun.getFd());
    if (jniSetAddresses(interfaze,config.addresses) < 1) {
      throw new IllegalArgumentException("At least one address must be specified");
    }
    if (config.routes != null) {
      jniSetRoutes(interfaze,config.routes);
    }
    Connection connection=new Connection();
    if (!mContext.bindService(intent,connection,Context.BIND_AUTO_CREATE)) {
      throw new IllegalStateException("Cannot bind " + config.user);
    }
    if (mConnection != null) {
      mContext.unbindService(mConnection);
    }
    if (mInterface != null && !mInterface.equals(interfaze)) {
      jniReset(mInterface);
    }
    mConnection=connection;
    mInterface=interfaze;
  }
 catch (  RuntimeException e) {
    IoUtils.closeQuietly(tun);
    throw e;
  }
  Log.i(TAG,"Established by " + config.user + " on "+ mInterface);
  config.user=mPackage;
  config.interfaze=mInterface;
  long identity=Binder.clearCallingIdentity();
  mCallback.override(config.dnsServers,config.searchDomains);
  showNotification(config,label,bitmap);
  Binder.restoreCallingIdentity(identity);
  return tun;
}
