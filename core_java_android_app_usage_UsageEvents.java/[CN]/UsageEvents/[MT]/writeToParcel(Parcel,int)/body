{
  dest.writeInt(mEventCount);
  dest.writeInt(mIndex);
  if (mEventCount > 0) {
    dest.writeTypedArray(mComponentNameTable,flags);
    if (mEventsToWrite != null) {
      Parcel p=Parcel.obtain();
      try {
        p.setDataPosition(0);
        for (int i=0; i < mEventCount; i++) {
          final Event event=mEventsToWrite.get(i);
          int index=Arrays.binarySearch(mComponentNameTable,event.getComponent());
          if (index < 0) {
            throw new IllegalStateException(event.getComponent().toShortString() + " is not in the component name table");
          }
          p.writeInt(index);
          p.writeInt(event.getEventType());
          p.writeLong(event.getTimeStamp());
        }
        final int listByteLength=p.dataPosition();
        dest.writeInt(listByteLength);
        dest.writeInt(0);
        dest.appendFrom(p,0,listByteLength);
      }
  finally {
        p.recycle();
      }
    }
 else     if (mParcel != null) {
      dest.writeInt(mParcel.dataSize());
      dest.writeInt(mParcel.dataPosition());
      dest.appendFrom(mParcel,0,mParcel.dataSize());
    }
 else {
      throw new IllegalStateException("Either mParcel or mEventsToWrite must not be null");
    }
  }
}
