{
  SyncOperation lowestOp=null;
  long lowestOpRunTime=0;
  for (  SyncOperation op : mOperationsMap.values()) {
    Pair<Long,Long> backoff=null;
    long delayUntilTime=0;
    final boolean isManualSync=op.extras.getBoolean(ContentResolver.SYNC_EXTRAS_MANUAL,false);
    if (!isManualSync) {
      backoff=mSyncStorageEngine.getBackoff(op.account,op.authority);
      delayUntilTime=mSyncStorageEngine.getDelayUntilTime(op.account,op.authority);
    }
    long backoffTime=Math.max(backoff != null ? backoff.first : 0,delayUntilTime);
    long opRunTime=backoffTime > now ? backoffTime : op.earliestRunTime;
    if (lowestOp == null || (lowestOp.expedited == op.expedited ? opRunTime < lowestOpRunTime : op.expedited)) {
      lowestOp=op;
      lowestOpRunTime=opRunTime;
    }
  }
  if (lowestOp == null) {
    return null;
  }
  return Pair.create(lowestOp,lowestOpRunTime);
}
