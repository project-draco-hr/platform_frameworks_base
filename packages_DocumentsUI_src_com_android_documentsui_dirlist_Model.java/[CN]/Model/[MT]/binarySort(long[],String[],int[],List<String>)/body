{
  final int count=positions.length;
  for (int start=1; start < count; start++) {
    final int pivotPosition=positions[start];
    final long pivotValue=sortKey[start];
    final String pivotMime=mimeTypes[start];
    final String pivotId=ids.get(start);
    int left=0;
    int right=start;
    while (left < right) {
      int mid=((left + right) >>> 1);
      int compare=0;
      final boolean lhsIsDir=Document.MIME_TYPE_DIR.equals(pivotMime);
      final boolean rhsIsDir=Document.MIME_TYPE_DIR.equals(mimeTypes[mid]);
      if (lhsIsDir && !rhsIsDir) {
        compare=-1;
      }
 else       if (!lhsIsDir && rhsIsDir) {
        compare=1;
      }
 else {
        final long lhs=pivotValue;
        final long rhs=sortKey[mid];
        compare=-Long.compare(lhs,rhs);
      }
      if (compare < 0) {
        right=mid;
      }
 else {
        left=mid + 1;
      }
    }
    int n=start - left;
switch (n) {
case 2:
      positions[left + 2]=positions[left + 1];
    sortKey[left + 2]=sortKey[left + 1];
  mimeTypes[left + 2]=mimeTypes[left + 1];
ids.set(left + 2,ids.get(left + 1));
case 1:
positions[left + 1]=positions[left];
sortKey[left + 1]=sortKey[left];
mimeTypes[left + 1]=mimeTypes[left];
ids.set(left + 1,ids.get(left));
break;
default :
System.arraycopy(positions,left,positions,left + 1,n);
System.arraycopy(sortKey,left,sortKey,left + 1,n);
System.arraycopy(mimeTypes,left,mimeTypes,left + 1,n);
for (int i=n; i >= 1; --i) {
ids.set(left + i,ids.get(left + i - 1));
}
}
positions[left]=pivotPosition;
sortKey[left]=pivotValue;
mimeTypes[left]=pivotMime;
ids.set(left,pivotId);
}
}
