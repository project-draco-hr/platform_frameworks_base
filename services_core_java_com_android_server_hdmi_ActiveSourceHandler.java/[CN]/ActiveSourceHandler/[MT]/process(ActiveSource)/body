{
  HdmiCecLocalDeviceTv tv=mSource;
  ActiveSource activeSource=tv.getActiveSource();
  if (activeSource.equals(newActive)) {
    invokeCallback(HdmiControlManager.RESULT_SUCCESS);
    return;
  }
  HdmiCecDeviceInfo device=mService.getDeviceInfo(newActive.logicalAddress);
  if (device == null) {
    tv.startNewDeviceAction(newActive);
  }
  ActiveSource current=tv.getActiveSource();
  if (!tv.isProhibitMode()) {
    tv.updateActiveSource(newActive);
    if (!current.equals(newActive)) {
      boolean notifyInputChange=(mCallback == null);
      tv.updateActiveInput(newActive.physicalAddress,notifyInputChange);
    }
    invokeCallback(HdmiControlManager.RESULT_SUCCESS);
  }
 else {
    if (current.logicalAddress == getSourceAddress()) {
      HdmiCecMessage activeSourceCommand=HdmiCecMessageBuilder.buildActiveSource(current.logicalAddress,current.physicalAddress);
      mService.sendCecCommand(activeSourceCommand);
      tv.updateActiveSource(current);
      invokeCallback(HdmiControlManager.RESULT_SUCCESS);
    }
 else {
      HdmiCecMessage routingChange=HdmiCecMessageBuilder.buildRoutingChange(getSourceAddress(),newActive.physicalAddress,current.physicalAddress);
      mService.sendCecCommand(routingChange);
      tv.addAndStartAction(new RoutingControlAction(tv,current.physicalAddress,true,mCallback));
    }
  }
}
