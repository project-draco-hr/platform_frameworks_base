{
  HdmiCecLocalDeviceTv tv=mSource;
  if (getSourcePath() == activePath && tv.getActiveSource() == getSourceAddress()) {
    invokeCallback(HdmiCec.RESULT_SUCCESS);
    return;
  }
  HdmiCecDeviceInfo device=mService.getDeviceInfo(activeAddress);
  if (device == null) {
    tv.addAndStartAction(new NewDeviceAction(tv,activeAddress,activePath,false));
  }
  int currentActive=tv.getActiveSource();
  int currentPath=tv.getActivePath();
  if (!tv.isInPresetInstallationMode()) {
    tv.updateActiveSource(activeAddress,activePath);
    if (currentActive != activeAddress && currentPath != activePath) {
      tv.updateActivePortId(mService.pathToPortId(activePath));
    }
    invokeCallback(HdmiCec.RESULT_SUCCESS);
  }
 else {
    if (currentActive == getSourceAddress()) {
      HdmiCecMessage activeSource=HdmiCecMessageBuilder.buildActiveSource(currentActive,currentPath);
      mService.sendCecCommand(activeSource);
      tv.updateActiveSource(currentActive,currentPath);
      invokeCallback(HdmiCec.RESULT_SUCCESS);
    }
 else {
      HdmiCecMessage routingChange=HdmiCecMessageBuilder.buildRoutingChange(getSourceAddress(),activePath,currentPath);
      mService.sendCecCommand(routingChange);
      tv.addAndStartAction(new RoutingControlAction(tv,currentPath,mCallback));
    }
  }
}
