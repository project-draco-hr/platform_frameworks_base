{
synchronized (mMethodMap) {
    String curInputMethodId=Settings.Secure.getString(mContext.getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD);
    final int N=mMethodList.size();
    if (curInputMethodId != null) {
      for (int i=0; i < N; i++) {
        InputMethodInfo imi=mMethodList.get(i);
        if (imi.getId().equals(curInputMethodId)) {
          for (          String pkg : packages) {
            if (imi.getPackageName().equals(pkg)) {
              if (!doit) {
                return true;
              }
              Settings.Secure.putString(mContext.getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD,"");
              chooseNewDefaultIMELocked();
              return true;
            }
          }
        }
      }
    }
  }
  return false;
}
