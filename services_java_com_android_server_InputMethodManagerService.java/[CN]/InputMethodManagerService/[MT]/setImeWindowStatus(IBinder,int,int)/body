{
  int uid=Binder.getCallingUid();
  long ident=Binder.clearCallingIdentity();
  try {
    if (token == null || mCurToken != token) {
      Slog.w(TAG,"Ignoring setImeWindowStatus of uid " + uid + " token: "+ token);
      return;
    }
synchronized (mMethodMap) {
      mImeWindowVis=vis;
      mBackDisposition=backDisposition;
      mStatusBar.setImeWindowStatus(token,vis,backDisposition);
      final boolean iconVisibility=(vis & InputMethodService.IME_ACTIVE) != 0;
      if (iconVisibility && needsToShowImeSwitchOngoingNotification()) {
        final PackageManager pm=mContext.getPackageManager();
        final CharSequence label=mMethodMap.get(mCurMethodId).loadLabel(pm);
        final CharSequence title=mRes.getText(com.android.internal.R.string.select_input_method);
        mImeSwitcherNotification.setLatestEventInfo(mContext,title,label,mImeSwitchPendingIntent);
        mNotificationManager.notify(com.android.internal.R.string.select_input_method,mImeSwitcherNotification);
        mNotificationShown=true;
      }
 else {
        if (mNotificationShown) {
          mNotificationManager.cancel(com.android.internal.R.string.select_input_method);
          mNotificationShown=false;
        }
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
