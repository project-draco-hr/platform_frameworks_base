{
  if (!mSystemReady) {
    return;
  }
  final Locale newLocale=mRes.getConfiguration().locale;
  if (!updateOnlyWhenLocaleChanged || (newLocale != null && !newLocale.equals(mLastSystemLocale))) {
    if (!updateOnlyWhenLocaleChanged) {
      hideCurrentInputLocked(0,null);
      mCurMethodId=null;
      unbindCurrentMethodLocked(true);
    }
    if (DEBUG) {
      Slog.i(TAG,"Locale has been changed to " + newLocale);
    }
    buildInputMethodListLocked(mMethodList,mMethodMap);
    if (!updateOnlyWhenLocaleChanged) {
      final String selectedImiId=mSettings.getSelectedInputMethod();
      if (TextUtils.isEmpty(selectedImiId)) {
        resetDefaultImeLocked(mContext);
      }
    }
    updateFromSettingsLocked();
    mLastSystemLocale=newLocale;
    if (!updateOnlyWhenLocaleChanged) {
      try {
        startInputInnerLocked();
      }
 catch (      RuntimeException e) {
        Slog.w(TAG,"Unexpected exception",e);
      }
    }
  }
}
