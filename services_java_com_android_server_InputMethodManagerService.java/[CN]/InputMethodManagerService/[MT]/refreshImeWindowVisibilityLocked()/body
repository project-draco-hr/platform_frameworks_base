{
  final Configuration conf=mRes.getConfiguration();
  final boolean haveHardKeyboard=conf.keyboard != Configuration.KEYBOARD_NOKEYS;
  final boolean hardKeyShown=haveHardKeyboard && conf.hardKeyboardHidden != Configuration.HARDKEYBOARDHIDDEN_YES;
  final boolean isScreenLocked=mKeyguardManager != null && mKeyguardManager.isKeyguardLocked() && mKeyguardManager.isKeyguardSecure();
  mImeWindowVis=(!isScreenLocked && (mInputShown || hardKeyShown)) ? (InputMethodService.IME_ACTIVE | InputMethodService.IME_VISIBLE) : 0;
  updateImeWindowStatusLocked();
}
