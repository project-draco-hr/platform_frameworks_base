{
  final Configuration conf=mRes.getConfiguration();
  final boolean haveHardKeyboard=conf.keyboard != Configuration.KEYBOARD_NOKEYS;
  final boolean hardKeyShown=haveHardKeyboard && conf.hardKeyboardHidden != Configuration.HARDKEYBOARDHIDDEN_YES;
  final boolean isScreenLocked=mKeyguardManager != null && mKeyguardManager.isKeyguardLocked();
  final boolean isScreenSecurelyLocked=isScreenLocked && mKeyguardManager.isKeyguardSecure();
  final boolean inputShown=mInputShown && (!isScreenLocked || mInputBoundToKeyguard);
  final boolean inputActive=!isScreenSecurelyLocked && (inputShown || hardKeyShown);
  final boolean inputVisible=inputActive && !hardKeyShown;
  mImeWindowVis=(inputActive ? InputMethodService.IME_ACTIVE : 0) | (inputVisible ? InputMethodService.IME_VISIBLE : 0);
  updateImeWindowStatusLocked();
}
