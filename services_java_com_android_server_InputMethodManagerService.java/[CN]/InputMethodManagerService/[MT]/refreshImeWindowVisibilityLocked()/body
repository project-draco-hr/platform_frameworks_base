{
  final Configuration conf=mRes.getConfiguration();
  final boolean haveHardKeyboard=conf.keyboard != Configuration.KEYBOARD_NOKEYS;
  final boolean hardKeyShown=haveHardKeyboard && conf.hardKeyboardHidden != Configuration.HARDKEYBOARDHIDDEN_YES;
  final boolean isScreenLocked=mKeyguardManager != null && mKeyguardManager.isKeyguardLocked();
  final boolean isScreenSecurelyLocked=isScreenLocked && mKeyguardManager.isKeyguardSecure();
  final boolean inputShown=mInputShown && (!isScreenLocked || mInputBoundToKeyguard);
  mImeWindowVis=(!isScreenSecurelyLocked && (inputShown || hardKeyShown)) ? (InputMethodService.IME_ACTIVE | InputMethodService.IME_VISIBLE) : 0;
  updateImeWindowStatusLocked();
}
