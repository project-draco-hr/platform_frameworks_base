{
synchronized (mMethodMap) {
    if (token == null) {
      if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.WRITE_SECURE_SETTINGS) != PackageManager.PERMISSION_GRANTED) {
        throw new SecurityException("Using null token requires permission " + android.Manifest.permission.WRITE_SECURE_SETTINGS);
      }
    }
 else     if (mCurToken != token) {
      Slog.w(TAG,"Ignoring setInputMethod of uid " + Binder.getCallingUid() + " token: "+ token);
      return;
    }
    long ident=Binder.clearCallingIdentity();
    try {
      setInputMethodLocked(id,subtypeId);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
