{
  InputMethodInfo info=mMethodMap.get(id);
  if (info == null) {
    throw new IllegalArgumentException("Unknown id: " + id);
  }
  if (id.equals(mCurMethodId)) {
    if (subtypeId != NOT_A_SUBTYPE_ID) {
      InputMethodSubtype subtype=info.getSubtypes().get(subtypeId);
      if (subtype != mCurrentSubtype) {
synchronized (mMethodMap) {
          if (mCurMethod != null) {
            try {
              putSelectedInputMethodSubtype(info,subtypeId);
              if (mInputShown) {
                mStatusBar.setIMEButtonVisible(true);
              }
              mCurMethod.changeInputMethodSubtype(subtype);
            }
 catch (            RemoteException e) {
              return;
            }
          }
        }
      }
    }
    return;
  }
  final long ident=Binder.clearCallingIdentity();
  try {
    mCurMethodId=id;
    putSelectedInputMethodSubtype(info,subtypeId);
    Settings.Secure.putString(mContext.getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD,id);
    if (ActivityManagerNative.isSystemReady()) {
      Intent intent=new Intent(Intent.ACTION_INPUT_METHOD_CHANGED);
      intent.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
      intent.putExtra("input_method_id",id);
      mContext.sendBroadcast(intent);
    }
    unbindCurrentClientLocked();
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
