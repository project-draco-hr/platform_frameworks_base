{
  saveCurrentInputMethodAndSubtypeToHistory();
  if (imi == null || subtypeId < 0) {
    mSettings.putSelectedSubtype(NOT_A_SUBTYPE_ID);
    mCurrentSubtype=null;
  }
 else {
    final ArrayList<InputMethodSubtype> subtypes=imi.getSubtypes();
    if (subtypeId < subtypes.size()) {
      mSettings.putSelectedSubtype(subtypes.get(subtypeId).hashCode());
      mCurrentSubtype=subtypes.get(subtypeId);
    }
 else {
      mSettings.putSelectedSubtype(NOT_A_SUBTYPE_ID);
      mCurrentSubtype=null;
    }
  }
}
