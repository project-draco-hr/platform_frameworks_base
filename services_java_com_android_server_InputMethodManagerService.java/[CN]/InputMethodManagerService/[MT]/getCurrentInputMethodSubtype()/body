{
synchronized (mMethodMap) {
    boolean subtypeIsSelected=false;
    try {
      subtypeIsSelected=Settings.Secure.getInt(mContext.getContentResolver(),Settings.Secure.SELECTED_INPUT_METHOD_SUBTYPE) != NOT_A_SUBTYPE_ID;
    }
 catch (    SettingNotFoundException e) {
    }
    if (!subtypeIsSelected || mCurrentSubtype == null) {
      String lastInputMethodId=Settings.Secure.getString(mContext.getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD);
      int subtypeId=getSelectedInputMethodSubtypeId(lastInputMethodId);
      if (subtypeId == NOT_A_SUBTYPE_ID) {
        subtypeId=findApplicableSubtypeLocked(lastInputMethodId);
      }
      if (subtypeId != NOT_A_SUBTYPE_ID) {
        mCurrentSubtype=mMethodMap.get(lastInputMethodId).getSubtypes().get(subtypeId);
      }
    }
    return mCurrentSubtype;
  }
}
