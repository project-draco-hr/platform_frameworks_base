{
  if (DEBUG)   Slog.v(TAG,"Show switching menu");
  final Context context=mContext;
  final PackageManager pm=context.getPackageManager();
  String lastInputMethodId=Settings.Secure.getString(context.getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD);
  if (DEBUG)   Slog.v(TAG,"Current IME: " + lastInputMethodId);
  final List<InputMethodInfo> immis=getEnabledInputMethodList();
  if (immis == null) {
    return;
  }
synchronized (mMethodMap) {
    hideInputMethodMenuLocked();
    int N=immis.size();
    final Map<CharSequence,InputMethodInfo> imMap=new TreeMap<CharSequence,InputMethodInfo>(Collator.getInstance());
    for (int i=0; i < N; ++i) {
      InputMethodInfo property=immis.get(i);
      if (property == null) {
        continue;
      }
      imMap.put(property.loadLabel(pm),property);
    }
    N=imMap.size();
    mItems=imMap.keySet().toArray(new CharSequence[N]);
    mIms=imMap.values().toArray(new InputMethodInfo[N]);
    int checkedItem=0;
    for (int i=0; i < N; ++i) {
      if (mIms[i].getId().equals(lastInputMethodId)) {
        checkedItem=i;
        break;
      }
    }
    AlertDialog.OnClickListener adocl=new AlertDialog.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int which){
        hideInputMethodMenu();
      }
    }
;
    TypedArray a=context.obtainStyledAttributes(null,com.android.internal.R.styleable.DialogPreference,com.android.internal.R.attr.alertDialogStyle,0);
    mDialogBuilder=new AlertDialog.Builder(context).setTitle(com.android.internal.R.string.select_input_method).setOnCancelListener(new OnCancelListener(){
      public void onCancel(      DialogInterface dialog){
        hideInputMethodMenu();
      }
    }
).setIcon(a.getDrawable(com.android.internal.R.styleable.DialogPreference_dialogTitle));
    a.recycle();
    mDialogBuilder.setSingleChoiceItems(mItems,checkedItem,new AlertDialog.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int which){
synchronized (mMethodMap) {
          if (mIms == null || mIms.length <= which) {
            return;
          }
          InputMethodInfo im=mIms[which];
          hideInputMethodMenu();
          if (im != null) {
            setInputMethodLocked(im.getId());
          }
        }
      }
    }
);
    mSwitchingDialog=mDialogBuilder.create();
    mSwitchingDialog.getWindow().setType(WindowManager.LayoutParams.TYPE_INPUT_METHOD_DIALOG);
    mSwitchingDialog.show();
  }
}
