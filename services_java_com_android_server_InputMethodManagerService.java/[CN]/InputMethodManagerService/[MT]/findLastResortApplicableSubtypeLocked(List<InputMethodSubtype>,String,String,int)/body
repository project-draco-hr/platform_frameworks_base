{
  if (subtypes == null || subtypes.size() == 0) {
    return null;
  }
  if (TextUtils.isEmpty(locale)) {
    locale=mContext.getResources().getConfiguration().locale.toString();
  }
  final String language=locale.substring(0,2);
  boolean partialMatchFound=false;
  InputMethodSubtype applicableSubtype=null;
  for (int i=0; i < subtypes.size(); ++i) {
    InputMethodSubtype subtype=subtypes.get(i);
    final String subtypeLocale=subtype.getLocale();
    if (subtypes.get(i).getMode().equalsIgnoreCase(mode)) {
      if (locale.equals(subtypeLocale)) {
        applicableSubtype=subtype;
        break;
      }
 else       if (!partialMatchFound && subtypeLocale.startsWith(language)) {
        applicableSubtype=subtype;
        partialMatchFound=true;
      }
    }
  }
  if (DEBUG) {
    Slog.d(TAG,"Applicable InputMethodSubtype was found: " + applicableSubtype.getMode() + ","+ applicableSubtype.getLocale());
  }
  return applicableSubtype;
}
