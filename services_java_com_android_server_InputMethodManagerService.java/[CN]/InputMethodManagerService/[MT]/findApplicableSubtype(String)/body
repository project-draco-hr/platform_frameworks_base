{
  InputMethodInfo imi=mMethodMap.get(id);
  if (imi == null) {
    return NOT_A_SUBTYPE_ID;
  }
  ArrayList<InputMethodSubtype> subtypes=imi.getSubtypes();
  if (subtypes == null || subtypes.size() == 0) {
    return NOT_A_SUBTYPE_ID;
  }
  final String locale=mContext.getResources().getConfiguration().locale.toString();
  final String language=locale.substring(0,2);
  boolean partialMatchFound=false;
  int applicableSubtypeId=DEFAULT_SUBTYPE_ID;
  for (int i=0; i < subtypes.size(); ++i) {
    final String subtypeLocale=subtypes.get(i).getLocale();
    if (subtypes.get(i).getMode().equalsIgnoreCase("keyboard")) {
      if (locale.equals(subtypeLocale)) {
        applicableSubtypeId=i;
        break;
      }
 else       if (!partialMatchFound && subtypeLocale.startsWith(language)) {
        applicableSubtypeId=i;
        partialMatchFound=true;
      }
    }
  }
  if (DEBUG) {
    Slog.d(TAG,"Applicable InputMethodSubtype was found: " + applicableSubtypeId + subtypes.get(applicableSubtypeId).getLocale());
  }
  return applicableSubtypeId;
}
