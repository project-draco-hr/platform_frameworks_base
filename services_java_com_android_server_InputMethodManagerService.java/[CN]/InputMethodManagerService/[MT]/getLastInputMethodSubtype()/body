{
synchronized (mMethodMap) {
    final Pair<String,String> lastIme=mSettings.getLastInputMethodAndSubtypeLocked();
    if (lastIme == null || TextUtils.isEmpty(lastIme.first) || TextUtils.isEmpty(lastIme.second))     return null;
    final InputMethodInfo lastImi=mMethodMap.get(lastIme.first);
    if (lastImi == null)     return null;
    try {
      final int lastSubtypeHash=Integer.valueOf(lastIme.second);
      final int lastSubtypeId=getSubtypeIdFromHashCode(lastImi,lastSubtypeHash);
      if (lastSubtypeId < 0 || lastSubtypeId >= lastImi.getSubtypeCount()) {
        return null;
      }
      return lastImi.getSubtypeAt(lastSubtypeId);
    }
 catch (    NumberFormatException e) {
      return null;
    }
  }
}
