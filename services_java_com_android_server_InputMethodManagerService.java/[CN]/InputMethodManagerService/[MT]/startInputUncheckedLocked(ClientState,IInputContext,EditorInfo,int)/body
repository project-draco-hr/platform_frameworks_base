{
  if (mCurMethodId == null) {
    return mNoBinding;
  }
  if (mCurClient == null) {
    mInputBoundToKeyguard=mKeyguardManager != null && mKeyguardManager.isKeyguardLocked();
    if (DEBUG) {
      Slog.v(TAG,"New bind. keyguard = " + mInputBoundToKeyguard);
    }
  }
  if (mCurClient != cs) {
    unbindCurrentClientLocked();
    if (DEBUG)     Slog.v(TAG,"switching to client: client = " + cs.client.asBinder());
    if (mScreenOn) {
      executeOrSendMessage(cs.client,mCaller.obtainMessageIO(MSG_SET_ACTIVE,mScreenOn ? 1 : 0,cs));
    }
  }
  mCurSeq++;
  if (mCurSeq <= 0)   mCurSeq=1;
  mCurClient=cs;
  mCurInputContext=inputContext;
  mCurAttribute=attribute;
  if (mCurId != null && mCurId.equals(mCurMethodId)) {
    if (cs.curSession != null) {
      return attachNewInputLocked((controlFlags & InputMethodManager.CONTROL_START_INITIAL) != 0);
    }
    if (mHaveConnection) {
      if (mCurMethod != null) {
        if (!cs.sessionRequested) {
          cs.sessionRequested=true;
          if (DEBUG)           Slog.v(TAG,"Creating new session for client " + cs);
          executeOrSendMessage(mCurMethod,mCaller.obtainMessageOO(MSG_CREATE_SESSION,mCurMethod,new MethodCallback(mCurMethod,this)));
        }
        return new InputBindResult(null,mCurId,mCurSeq);
      }
 else       if (SystemClock.uptimeMillis() < (mLastBindTime + TIME_TO_RECONNECT)) {
        return new InputBindResult(null,mCurId,mCurSeq);
      }
 else {
        EventLog.writeEvent(EventLogTags.IMF_FORCE_RECONNECT_IME,mCurMethodId,SystemClock.uptimeMillis() - mLastBindTime,0);
      }
    }
  }
  return startInputInnerLocked();
}
