{
  final LayoutInflater inflater=LayoutInflater.from(mContext);
  final MenuAdapter adapter=new MenuAdapter(menu,inflater,mOverflowOnly);
  if (!isShowing() && mForceShowIcon) {
    adapter.setForceShowIcon(true);
  }
 else   if (isShowing()) {
    adapter.setForceShowIcon(MenuPopup.shouldPreserveIconSpacing(menu));
  }
  final int menuWidth=measureIndividualMenuWidth(adapter,null,mContext,mMenuMaxWidth);
  final MenuPopupWindow popupWindow=createPopupWindow();
  popupWindow.setAdapter(adapter);
  popupWindow.setWidth(menuWidth);
  popupWindow.setDropDownGravity(mDropDownGravity);
  final CascadingMenuInfo parentInfo;
  final View parentView;
  if (mShowingMenus.size() > 0) {
    parentInfo=mShowingMenus.get(mShowingMenus.size() - 1);
    parentView=findParentViewForSubmenu(parentInfo,menu);
  }
 else {
    parentInfo=null;
    parentView=null;
  }
  final int x;
  final int y;
  final Rect epicenterBounds;
  if (parentView != null) {
    popupWindow.setTouchModal(false);
    popupWindow.setEnterTransition(null);
    final @HorizPosition int nextMenuPosition=getNextMenuPosition(menuWidth);
    final boolean showOnRight=nextMenuPosition == HORIZ_POSITION_RIGHT;
    mLastPosition=nextMenuPosition;
    final int[] tempLocation=new int[2];
    parentView.getLocationInWindow(tempLocation);
    final int parentOffsetLeft=parentInfo.window.getHorizontalOffset() + tempLocation[0];
    final int parentOffsetTop=parentInfo.window.getVerticalOffset() + tempLocation[1];
    if ((mDropDownGravity & Gravity.RIGHT) == Gravity.RIGHT) {
      if (showOnRight) {
        x=parentOffsetLeft + menuWidth;
      }
 else {
        x=parentOffsetLeft - parentView.getWidth();
      }
    }
 else {
      if (showOnRight) {
        x=parentOffsetLeft + parentView.getWidth();
      }
 else {
        x=parentOffsetLeft - menuWidth;
      }
    }
    y=parentOffsetTop;
    epicenterBounds=null;
  }
 else {
    x=mInitXOffset;
    y=mInitYOffset;
    epicenterBounds=getEpicenterBounds();
  }
  popupWindow.setHorizontalOffset(x);
  popupWindow.setVerticalOffset(y);
  popupWindow.setEpicenterBounds(epicenterBounds);
  final CascadingMenuInfo menuInfo=new CascadingMenuInfo(popupWindow,menu,mLastPosition);
  mShowingMenus.add(menuInfo);
  popupWindow.show();
  if (parentInfo == null && mShowTitle && menu.getHeaderTitle() != null) {
    final ListView listView=popupWindow.getListView();
    final FrameLayout titleItemView=(FrameLayout)inflater.inflate(R.layout.popup_menu_header_item_layout,listView,false);
    final TextView titleView=(TextView)titleItemView.findViewById(R.id.title);
    titleItemView.setEnabled(false);
    titleView.setText(menu.getHeaderTitle());
    listView.addHeaderView(titleItemView,null,false);
    popupWindow.show();
  }
}
