{
  mInFlight--;
  if (DEBUG) {
    Log.d(TAG,"Completed request " + request.getRequestId() + ", "+ mInFlight+ " requests remain in flight.");
  }
  if (mInFlight < 0) {
    throw new IllegalStateException("More captures completed than requests queued.");
  }
  mNotFull.signalAll();
  if (mInFlight == 0) {
    mIsEmpty.signalAll();
  }
  CameraMetadataNative result=mMapper.cachedConvertResultMetadata(legacyHolder,timestamp);
  mDeviceState.setCaptureResult(request,result);
}
