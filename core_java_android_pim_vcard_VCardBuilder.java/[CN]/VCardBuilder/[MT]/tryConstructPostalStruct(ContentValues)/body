{
  boolean reallyUseQuotedPrintable=false;
  boolean appendCharset=false;
  boolean dataArrayExists=false;
  String[] dataArray=VCardUtils.getVCardPostalElements(contentValues);
  for (  String data : dataArray) {
    if (!TextUtils.isEmpty(data)) {
      dataArrayExists=true;
      if (!appendCharset && !VCardUtils.containsOnlyPrintableAscii(data)) {
        appendCharset=true;
      }
      if (mUsesQuotedPrintable && !VCardUtils.containsOnlyNonCrLfPrintableAscii(data)) {
        reallyUseQuotedPrintable=true;
        break;
      }
    }
  }
  if (dataArrayExists) {
    StringBuffer addressBuffer=new StringBuffer();
    boolean first=true;
    for (    String data : dataArray) {
      if (first) {
        first=false;
      }
 else {
        addressBuffer.append(VCARD_ITEM_SEPARATOR);
      }
      if (!TextUtils.isEmpty(data)) {
        if (reallyUseQuotedPrintable) {
          addressBuffer.append(encodeQuotedPrintable(data));
        }
 else {
          addressBuffer.append(escapeCharacters(data));
        }
      }
    }
    return new PostalStruct(reallyUseQuotedPrintable,appendCharset,addressBuffer.toString());
  }
  String formattedAddress=contentValues.getAsString(StructuredPostal.FORMATTED_ADDRESS);
  if (!TextUtils.isEmpty(formattedAddress)) {
    reallyUseQuotedPrintable=!VCardUtils.containsOnlyPrintableAscii(formattedAddress);
    appendCharset=!VCardUtils.containsOnlyNonCrLfPrintableAscii(formattedAddress);
    if (reallyUseQuotedPrintable) {
      formattedAddress=encodeQuotedPrintable(formattedAddress);
    }
 else {
      formattedAddress=escapeCharacters(formattedAddress);
    }
    StringBuffer addressBuffer=new StringBuffer();
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(formattedAddress);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    return new PostalStruct(reallyUseQuotedPrintable,appendCharset,addressBuffer.toString());
  }
  return null;
}
