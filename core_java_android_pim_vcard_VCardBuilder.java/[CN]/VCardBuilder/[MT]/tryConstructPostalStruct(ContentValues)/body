{
  final String rawPoBox=contentValues.getAsString(StructuredPostal.POBOX);
  final String rawExtendedAddress=contentValues.getAsString(StructuredPostal.NEIGHBORHOOD);
  final String rawStreet=contentValues.getAsString(StructuredPostal.STREET);
  final String rawLocality=contentValues.getAsString(StructuredPostal.CITY);
  final String rawRegion=contentValues.getAsString(StructuredPostal.REGION);
  final String rawPostalCode=contentValues.getAsString(StructuredPostal.POSTCODE);
  final String rawCountry=contentValues.getAsString(StructuredPostal.COUNTRY);
  final String[] rawAddressArray=new String[]{rawPoBox,rawExtendedAddress,rawStreet,rawLocality,rawRegion,rawPostalCode,rawCountry};
  if (!VCardUtils.areAllEmpty(rawAddressArray)) {
    final boolean reallyUseQuotedPrintable=(mShouldUseQuotedPrintable && !VCardUtils.containsOnlyNonCrLfPrintableAscii(rawAddressArray));
    final boolean appendCharset=!VCardUtils.containsOnlyPrintableAscii(rawAddressArray);
    final String encodedPoBox;
    final String encodedExtendedAddress;
    final String encodedStreet;
    final String encodedLocality;
    final String encodedRegion;
    final String encodedPostalCode;
    final String encodedCountry;
    if (reallyUseQuotedPrintable) {
      encodedPoBox=encodeQuotedPrintable(rawPoBox);
      encodedExtendedAddress=encodeQuotedPrintable(rawExtendedAddress);
      encodedStreet=encodeQuotedPrintable(rawStreet);
      encodedLocality=encodeQuotedPrintable(rawLocality);
      encodedRegion=encodeQuotedPrintable(rawRegion);
      encodedPostalCode=encodeQuotedPrintable(rawPostalCode);
      encodedCountry=encodeQuotedPrintable(rawCountry);
    }
 else {
      encodedPoBox=escapeCharacters(rawPoBox);
      encodedExtendedAddress=escapeCharacters(rawExtendedAddress);
      encodedStreet=escapeCharacters(rawStreet);
      encodedLocality=escapeCharacters(rawLocality);
      encodedRegion=escapeCharacters(rawRegion);
      encodedPostalCode=escapeCharacters(rawPostalCode);
      encodedCountry=escapeCharacters(rawCountry);
    }
    final StringBuffer addressBuffer=new StringBuffer();
    addressBuffer.append(encodedPoBox);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedExtendedAddress);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedStreet);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedLocality);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedRegion);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedPostalCode);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedCountry);
    return new PostalStruct(reallyUseQuotedPrintable,appendCharset,addressBuffer.toString());
  }
 else {
    final String rawFormattedAddress=contentValues.getAsString(StructuredPostal.FORMATTED_ADDRESS);
    if (TextUtils.isEmpty(rawFormattedAddress)) {
      return null;
    }
    final boolean reallyUseQuotedPrintable=(mShouldUseQuotedPrintable && !VCardUtils.containsOnlyNonCrLfPrintableAscii(rawFormattedAddress));
    final boolean appendCharset=!VCardUtils.containsOnlyPrintableAscii(rawFormattedAddress);
    final String encodedFormattedAddress;
    if (reallyUseQuotedPrintable) {
      encodedFormattedAddress=encodeQuotedPrintable(rawFormattedAddress);
    }
 else {
      encodedFormattedAddress=escapeCharacters(rawFormattedAddress);
    }
    final StringBuffer addressBuffer=new StringBuffer();
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(encodedFormattedAddress);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    addressBuffer.append(VCARD_ITEM_SEPARATOR);
    return new PostalStruct(reallyUseQuotedPrintable,appendCharset,addressBuffer.toString());
  }
}
