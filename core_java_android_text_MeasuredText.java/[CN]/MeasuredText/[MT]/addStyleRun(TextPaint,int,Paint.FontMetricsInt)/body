{
  if (fm != null) {
    paint.getFontMetricsInt(fm);
  }
  int p=mPos;
  mPos=p + len;
  if (mEasy) {
    int flags=mDir == Layout.DIR_LEFT_TO_RIGHT ? Canvas.DIRECTION_LTR : Canvas.DIRECTION_RTL;
    return paint.getTextRunAdvances(mChars,p,len,p,len,flags,mWidths,p);
  }
  float totalAdvance=0;
  int level=mLevels[p];
  for (int q=p, i=p + 1, e=p + len; ; ++i) {
    if (i == e || mLevels[i] != level) {
      int flags=(level & 0x1) == 0 ? Canvas.DIRECTION_LTR : Canvas.DIRECTION_RTL;
      totalAdvance+=paint.getTextRunAdvances(mChars,q,i - q,q,i - q,flags,mWidths,q);
      if (i == e) {
        break;
      }
      q=i;
      level=mLevels[i];
    }
  }
  return totalAdvance;
}
