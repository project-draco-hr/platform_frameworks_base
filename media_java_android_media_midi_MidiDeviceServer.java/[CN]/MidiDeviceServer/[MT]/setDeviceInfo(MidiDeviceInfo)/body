{
  if (mDeviceInfo != null) {
    throw new IllegalStateException("setDeviceInfo should only be called once");
  }
  mDeviceInfo=deviceInfo;
  mInputPortCount=deviceInfo.getInputPortCount();
  mOutputPortCount=deviceInfo.getOutputPortCount();
  mInputPortSenders=new MidiOutputPort[mInputPortCount];
  mInputPortReceivers=new ArrayList[mInputPortCount];
  for (int i=0; i < mInputPortCount; i++) {
    mInputPortReceivers[i]=new ArrayList<MidiReceiver>();
  }
  mOutputPortReceivers=new ArrayList[mOutputPortCount];
  for (int i=0; i < mOutputPortCount; i++) {
    mOutputPortReceivers[i]=new ArrayList<MidiInputPort>();
  }
}
