{
  if (!(o instanceof Map)) {
    return false;
  }
  Map<?,?> m=(Map<?,?>)o;
  Set<?> keys=keySet();
  if (!keys.equals(m.keySet())) {
    return false;
  }
  Iterator<?> it=keys.iterator();
  while (it.hasNext()) {
    Key key=(Key)it.next();
    Object v1=get(key);
    Object v2=m.get(key);
    if (!(v1 == null ? v2 == null : v1.equals(v2))) {
      return false;
    }
  }
  return true;
}
