{
  final LayoutParams lp=(LayoutParams)child.getLayoutParams();
switch (getChildVerticalGravity(lp.gravity)) {
case Gravity.TOP:
    return getPaddingTop();
case Gravity.BOTTOM:
  return getPaddingBottom() - child.getMeasuredHeight() - lp.bottomMargin;
default :
case Gravity.CENTER_VERTICAL:
final int paddingTop=getPaddingTop();
final int paddingBottom=getPaddingBottom();
final int height=getHeight();
final int childHeight=child.getMeasuredHeight();
final int space=height - paddingTop - paddingBottom;
int spaceAbove=(space - childHeight) / 2;
if (spaceAbove < lp.topMargin) {
spaceAbove=lp.topMargin;
}
 else {
final int spaceBelow=height - paddingBottom - childHeight- spaceAbove- paddingTop;
if (spaceBelow < lp.bottomMargin) {
spaceAbove=Math.max(0,spaceAbove - (lp.bottomMargin - spaceBelow));
}
}
return paddingTop + spaceAbove;
}
}
