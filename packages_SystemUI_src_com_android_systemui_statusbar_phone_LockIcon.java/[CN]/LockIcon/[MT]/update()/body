{
  boolean visible=isShown() && KeyguardUpdateMonitor.getInstance(mContext).isScreenOn();
  if (visible) {
    mTrustDrawable.start();
  }
 else {
    mTrustDrawable.stop();
  }
  if (!visible) {
    return;
  }
  int state=getState();
  boolean anyFingerprintIcon=state == STATE_FINGERPRINT || state == STATE_FINGERPRINT_ERROR;
  if (state != mLastState || mScreenOn != mLastScreenOn) {
    int iconRes=getAnimationResForTransition(mLastState,state,mLastScreenOn,mScreenOn);
    if (iconRes == R.drawable.lockscreen_fingerprint_draw_off_animation) {
      anyFingerprintIcon=true;
    }
    if (iconRes == -1) {
      iconRes=getIconForState(state);
    }
    Drawable icon=mContext.getDrawable(iconRes);
    final AnimatedVectorDrawable animation=icon instanceof AnimatedVectorDrawable ? (AnimatedVectorDrawable)icon : null;
    int iconHeight=getResources().getDimensionPixelSize(R.dimen.keyguard_affordance_icon_height);
    int iconWidth=getResources().getDimensionPixelSize(R.dimen.keyguard_affordance_icon_width);
    if (!anyFingerprintIcon && (icon.getIntrinsicHeight() != iconHeight || icon.getIntrinsicWidth() != iconWidth)) {
      icon=new IntrinsicSizeDrawable(icon,iconWidth,iconHeight);
    }
    setPaddingRelative(0,0,0,anyFingerprintIcon ? getResources().getDimensionPixelSize(R.dimen.fingerprint_icon_additional_padding) : 0);
    setRestingAlpha(anyFingerprintIcon ? 1f : KeyguardAffordanceHelper.SWIPE_RESTING_ALPHA_AMOUNT);
    setImageDrawable(icon);
    if (animation != null) {
      if (iconRes == R.drawable.lockscreen_fingerprint_draw_on_animation) {
        postOnAnimationDelayed(new Runnable(){
          @Override public void run(){
            animation.start();
          }
        }
,ANIM_DELAY_AFTER_SCREEN_ON);
      }
 else {
        animation.start();
      }
    }
    mLastState=state;
    mLastScreenOn=mScreenOn;
  }
  boolean trustManaged=mUnlockMethodCache.isTrustManaged() && !anyFingerprintIcon;
  mTrustDrawable.setTrustManaged(trustManaged);
  updateClickability();
}
