{
  if (mAutomaticPerformanceSnapshots) {
    endPerformanceSnapshot();
  }
  if (mPerfMetrics != null) {
    results.putAll(mPerfMetrics);
  }
  if (mUiAutomation != null) {
    mUiAutomation.disconnect();
    mUiAutomation=null;
  }
  mThread.finishInstrumentation(resultCode,results);
}
