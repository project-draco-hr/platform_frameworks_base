{
  final ChildDrawable[] array=mLayerState.mChildren;
  final int count=mLayerState.mNum;
  boolean needsLayer=false;
  if (mAnimatingRipplesCount > 0 && mMask == null) {
    for (int i=0; i < count; i++) {
      if (array[i].mId != R.id.mask && array[i].mDrawable.getOpacity() != PixelFormat.OPAQUE) {
        needsLayer=true;
        break;
      }
    }
  }
  final Paint maskingPaint=getMaskingPaint(mode);
  final int restoreToCount=needsLayer ? canvas.saveLayer(bounds.left,bounds.top,bounds.right,bounds.bottom,maskingPaint) : -1;
  for (int i=0; i < count; i++) {
    if (array[i].mId != R.id.mask) {
      array[i].mDrawable.draw(canvas);
    }
  }
  return restoreToCount;
}
