{
  super.onStateChange(stateSet);
  boolean enabled=false;
  boolean pressed=false;
  boolean focused=false;
  final int N=stateSet.length;
  for (int i=0; i < N; i++) {
    if (stateSet[i] == R.attr.state_enabled) {
      enabled=true;
    }
    if (stateSet[i] == R.attr.state_focused) {
      focused=true;
    }
    if (stateSet[i] == R.attr.state_pressed) {
      pressed=true;
    }
  }
  setRippleActive(enabled && pressed);
  setBackgroundActive(focused || (enabled && pressed));
  if (mRipplePaint != null && mState.mColor != null) {
    final ColorStateList stateList=mState.mColor;
    final int newColor=stateList.getColorForState(stateSet,0);
    final int oldColor=mRipplePaint.getColor();
    if (oldColor != newColor) {
      mRipplePaint.setColor(newColor);
      invalidateSelf();
      return true;
    }
  }
  return false;
}
