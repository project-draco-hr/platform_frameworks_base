{
  final boolean hasMask=mMask != null;
  final boolean hasRipples=mRipple != null || mExitingRipplesCount > 0 || (mBackground != null && mBackground.shouldDraw());
  final Rect bounds=getDirtyBounds();
  final int saveCount=canvas.save(Canvas.CLIP_SAVE_FLAG);
  canvas.clipRect(bounds);
  final boolean hasContentLayer=drawContent(canvas,bounds,hasRipples,hasMask);
  if (hasRipples) {
    final boolean hasNonOpaqueMask=hasMask && mMask.getOpacity() != PixelFormat.OPAQUE;
    final boolean hasRippleLayer=drawBackgroundAndRipples(canvas,bounds,hasNonOpaqueMask,hasContentLayer);
    if (hasRippleLayer) {
      drawMaskingLayer(canvas,bounds,DST_IN);
    }
  }
  canvas.restoreToCount(saveCount);
}
