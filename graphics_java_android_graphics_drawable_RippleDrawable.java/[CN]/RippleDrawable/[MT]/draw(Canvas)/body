{
  final boolean isProjected=isProjected();
  final boolean hasMask=mMask != null;
  final boolean drawNonMaskContent=mLayerState.mNum > (hasMask ? 1 : 0);
  final boolean drawMask=hasMask && mMask.getOpacity() != PixelFormat.OPAQUE;
  final Rect bounds=isProjected ? getDirtyBounds() : getBounds();
  final int contentLayer=drawNonMaskContent ? drawContentLayer(canvas,bounds,SRC_OVER) : -1;
  final PorterDuffXfermode xfermode=(hasMask || !drawNonMaskContent) ? SRC_OVER : SRC_ATOP;
  final int rippleLayer=drawRippleLayer(canvas,bounds,xfermode);
  if (rippleLayer >= 0 && drawMask) {
    drawMaskingLayer(canvas,bounds,DST_IN);
  }
  if (contentLayer >= 0) {
    canvas.restoreToCount(contentLayer);
  }
 else   if (rippleLayer >= 0) {
    canvas.restoreToCount(rippleLayer);
  }
}
