{
  boolean needsTheme=false;
  final RippleState ns;
  if (theme != null && state != null && state.canApplyTheme()) {
    ns=new RippleState(state,this,res);
    needsTheme=true;
  }
 else   if (state == null) {
    ns=new RippleState(null,this,res);
  }
 else {
    ns=new RippleState(state,this,res);
  }
  if (res != null) {
    mDensity=res.getDisplayMetrics().density;
  }
  mState=ns;
  mLayerState=ns;
  if (ns.mNum > 0) {
    ensurePadding();
  }
  if (needsTheme) {
    applyTheme(theme);
  }
  initializeFromState();
}
