{
  mTouchExcludeRegion.set(mBaseDisplayRect);
  WindowList windows=getWindowList();
  final int delta=calculatePixelFromDp(WindowState.RESIZE_HANDLE_WIDTH_IN_DP);
  for (int i=windows.size() - 1; i >= 0; --i) {
    final WindowState win=windows.get(i);
    final Task task=win.mAppToken != null ? win.getTask() : null;
    if (win.isVisibleLw() && task != null) {
      final boolean isFreeformed=task.inFreeformWorkspace();
      if (task != focusedTask || isFreeformed) {
        mTmpRect.set(win.mVisibleFrame);
        mTmpRect.intersect(win.mVisibleInsets);
        if (isFreeformed) {
          mTmpRect.inset(-delta,-delta);
        }
        mTouchExcludeRegion.op(mTmpRect,Region.Op.DIFFERENCE);
      }
      if (task == focusedTask && isFreeformed) {
        mTmpRect.inset(delta,delta);
        mTouchExcludeRegion.op(mTmpRect,Region.Op.UNION);
      }
    }
  }
  if (mTapDetector != null) {
    mTapDetector.setTouchExcludeRegion(mTouchExcludeRegion);
  }
}
