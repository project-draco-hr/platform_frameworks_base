{
  if (StackId.isAlwaysOnTop(stack.mStackId) && !toTop) {
    Slog.w(TAG_WM,"Ignoring move of always-on-top stack=" + stack + " to bottom");
    return;
  }
  if (!mStacks.remove(stack)) {
    Slog.wtf(TAG_WM,"moving stack that was not added: " + stack,new Throwable());
  }
  int addIndex=toTop ? mStacks.size() : 0;
  if (toTop && mService.isStackVisibleLocked(PINNED_STACK_ID) && stack.mStackId != PINNED_STACK_ID) {
    addIndex--;
    TaskStack topStack=mStacks.get(addIndex);
    if (topStack.mStackId != PINNED_STACK_ID) {
      throw new IllegalStateException("Pinned stack isn't top stack??? " + mStacks);
    }
  }
  mStacks.add(addIndex,stack);
}
