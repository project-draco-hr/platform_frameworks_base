{
  boolean changed=false;
synchronized (mLock) {
    if (mAppIdleParoleOn == isAppIdleParoleOn) {
      return;
    }
    mAppIdleParoleOn=isAppIdleParoleOn;
    for (    JobStatus task : mTrackedTasks) {
      String packageName=task.getSourcePackageName();
      final boolean appIdle=!mAppIdleParoleOn && mUsageStatsInternal.isAppIdle(packageName,task.getSourceUid(),task.getSourceUserId());
      if (DEBUG) {
        Slog.d(LOG_TAG,"Setting idle state of " + packageName + " to "+ appIdle);
      }
      if (task.setAppNotIdleConstraintSatisfied(!appIdle)) {
        changed=true;
      }
    }
  }
  if (changed) {
    mStateChangedListener.onControllerStateChanged();
  }
}
