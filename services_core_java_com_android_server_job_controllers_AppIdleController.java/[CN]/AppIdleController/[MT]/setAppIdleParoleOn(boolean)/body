{
  boolean changed=false;
synchronized (mTrackedTasks) {
    if (mAppIdleParoleOn == isAppIdleParoleOn) {
      return;
    }
    mAppIdleParoleOn=isAppIdleParoleOn;
    for (    JobStatus task : mTrackedTasks) {
      String packageName=task.job.getService().getPackageName();
      final boolean appIdle=!mAppIdleParoleOn && mUsageStatsInternal.isAppIdle(packageName,task.uId,task.getUserId());
      if (DEBUG) {
        Slog.d(LOG_TAG,"Setting idle state of " + packageName + " to "+ appIdle);
      }
      if (task.appNotIdleConstraintSatisfied.get() == appIdle) {
        task.appNotIdleConstraintSatisfied.set(!appIdle);
        changed=true;
      }
    }
  }
  if (changed) {
    mStateChangedListener.onControllerStateChanged();
  }
}
