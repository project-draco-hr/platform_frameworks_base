{
  boolean changed=false;
synchronized (mTrackedTasks) {
    if (mPluggedIn == pluggedIn) {
      return;
    }
    mPluggedIn=pluggedIn;
    for (    JobStatus task : mTrackedTasks) {
      String packageName=task.job.getService().getPackageName();
      final boolean appIdle=!mPluggedIn && mUsageStatsInternal.isAppIdle(packageName,task.getUserId());
      if (DEBUG) {
        Slog.d(LOG_TAG,"Plugged in " + pluggedIn + ", setting idle state of "+ packageName+ " to "+ appIdle);
      }
      if (task.appNotIdleConstraintSatisfied.get() == appIdle) {
        task.appNotIdleConstraintSatisfied.set(!appIdle);
        changed=true;
      }
    }
  }
  if (changed) {
    mStateChangedListener.onControllerStateChanged();
  }
}
