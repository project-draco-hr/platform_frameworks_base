{
  PackageSetting ps=generateFakePackageSetting("packageA");
  mPackagesMap.put(ps.name,ps);
  ArrayMap<String,ArraySet<PublicKey>> definedKS=new ArrayMap<String,ArraySet<PublicKey>>();
  ArraySet<PublicKey> keys=new ArraySet<PublicKey>();
  PublicKey keyA=PackageParser.parsePublicKey(KeySetStrings.ctsKeySetPublicKeyA);
  keys.add(keyA);
  definedKS.put("aliasA",keys);
  mKsms.addDefinedKeySetsToPackageLPw(ps.name,definedKS);
  keys=new ArraySet<PublicKey>();
  PublicKey keyB=PackageParser.parsePublicKey(KeySetStrings.ctsKeySetPublicKeyB);
  keys.add(keyB);
  definedKS.remove("aliasA");
  definedKS.put("aliasB",keys);
  mKsms.addDefinedKeySetsToPackageLPw(ps.name,definedKS);
  assertEquals(0,getKeySetRefCount(1));
  assertEquals(0,getPubKeyRefCount(1));
  assertEquals(1,getKeySetRefCount(2));
  assertEquals(1,getPubKeyRefCount(2));
  assertEquals(keyB,getPubKey(2));
  LongSparseArray<ArraySet<Long>> ksMapping=getKeySetMapping();
  assertEquals(1,ksMapping.size());
  ArraySet<Long> mapping=ksMapping.get(2);
  assertEquals(1,mapping.size());
  assertTrue(mapping.contains(new Long(2)));
  assertNull(ps.keySetData.getAliases().get("aliasA"));
  assertNotNull(ps.keySetData.getAliases().get("aliasB"));
  assertEquals(new Long(2),ps.keySetData.getAliases().get("aliasB"));
}
