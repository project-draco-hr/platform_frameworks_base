{
  PackageSetting ps1=generateFakePackageSetting("packageA");
  mPackagesMap.put(ps1.name,ps1);
  PackageSetting ps2=generateFakePackageSetting("packageB");
  mPackagesMap.put(ps2.name,ps2);
  ArraySet<PublicKey> signingKeys=new ArraySet<PublicKey>();
  PublicKey keyA=PackageParser.parsePublicKey(KeySetStrings.ctsKeySetPublicKeyA);
  signingKeys.add(keyA);
  mKsms.addSigningKeySetToPackageLPw(ps1.name,signingKeys);
  mKsms.addSigningKeySetToPackageLPw(ps2.name,signingKeys);
  PublicKey keyB=PackageParser.parsePublicKey(KeySetStrings.ctsKeySetPublicKeyB);
  signingKeys.removeAt(0);
  signingKeys.add(keyB);
  mKsms.addSigningKeySetToPackageLPw(ps1.name,signingKeys);
  assertEquals(1,getKeySetRefCount(1));
  assertEquals(1,getKeySetRefCount(2));
  assertEquals(1,getPubKeyRefCount(1));
  assertEquals(1,getPubKeyRefCount(2));
  assertEquals(keyA,getPubKey(1));
  assertEquals(keyB,getPubKey(2));
  LongSparseArray<ArraySet<Long>> ksMapping=getKeySetMapping();
  assertEquals(2,ksMapping.size());
  ArraySet<Long> mapping=ksMapping.get(1);
  assertEquals(1,mapping.size());
  assertTrue(mapping.contains(new Long(1)));
  mapping=ksMapping.get(2);
  assertEquals(1,mapping.size());
  assertTrue(mapping.contains(new Long(2)));
  assertEquals(2,ps1.keySetData.getProperSigningKeySet());
  assertEquals(1,ps2.keySetData.getProperSigningKeySet());
}
