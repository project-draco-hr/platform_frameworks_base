{
  final int outerDepth=parser.getDepth();
  while (XmlUtils.nextElementWithin(parser,outerDepth)) {
    if (parser.getName().equals("keyboard-layout")) {
      String descriptor=parser.getAttributeValue(null,"descriptor");
      if (descriptor == null) {
        throw new XmlPullParserException("Missing descriptor attribute on keyboard-layout.");
      }
      String current=parser.getAttributeValue(null,"current");
      if (mKeyboardLayouts.contains(descriptor)) {
        throw new XmlPullParserException("Found duplicate keyboard layout.");
      }
      mKeyboardLayouts.add(descriptor);
      if (current != null && current.equals("true")) {
        if (mCurrentKeyboardLayout != null) {
          throw new XmlPullParserException("Found multiple current keyboard layouts.");
        }
        mCurrentKeyboardLayout=descriptor;
      }
    }
  }
  Collections.sort(mKeyboardLayouts);
  if (mCurrentKeyboardLayout == null && !mKeyboardLayouts.isEmpty()) {
    mCurrentKeyboardLayout=mKeyboardLayouts.get(0);
  }
}
