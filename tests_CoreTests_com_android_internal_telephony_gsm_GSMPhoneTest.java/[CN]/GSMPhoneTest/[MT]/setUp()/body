{
  super.setUp();
  mGSMTestHandler=new GSMTestHandler(mContext);
  mGSMTestHandler.start();
synchronized (mGSMTestHandler) {
    do {
      mGSMTestHandler.wait();
    }
 while (mGSMTestHandler.getGSMPhone() == null);
  }
  mGSMPhone=mGSMTestHandler.getGSMPhone();
  mRadioControl=mGSMTestHandler.getSimulatedCommands();
  mHandler=mGSMTestHandler.getHandler();
  mGSMPhone.registerForPhoneStateChanged(mHandler,EVENT_PHONE_STATE_CHANGED,null);
  mGSMPhone.registerForNewRingingConnection(mHandler,EVENT_RINGING,null);
  mGSMPhone.registerForDisconnect(mHandler,EVENT_DISCONNECT,null);
  mGSMPhone.setOnPostDialCharacter(mHandler,EVENT_POST_DIAL,null);
  mGSMPhone.registerForSuppServiceNotification(mHandler,EVENT_SSN,null);
  mGSMPhone.registerForMmiInitiate(mHandler,EVENT_MMI_INITIATE,null);
  mGSMPhone.registerForMmiComplete(mHandler,EVENT_MMI_COMPLETE,null);
  mGSMPhone.registerForSuppServiceFailed(mHandler,SUPP_SERVICE_FAILED,null);
  mGSMPhone.registerForServiceStateChanged(mHandler,SERVICE_STATE_CHANGED,null);
  Message msg;
  ServiceState state;
  do {
    msg=mGSMTestHandler.waitForMessage(SERVICE_STATE_CHANGED);
    assertNotNull("Message Time Out",msg);
    state=(ServiceState)((AsyncResult)msg.obj).result;
  }
 while (state.getState() != ServiceState.STATE_IN_SERVICE);
}
