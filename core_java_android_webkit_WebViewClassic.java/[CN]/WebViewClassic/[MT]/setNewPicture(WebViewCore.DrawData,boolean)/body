{
  if (mNativeClass == 0) {
    if (mDelaySetPicture != null) {
      throw new IllegalStateException("Tried to setNewPicture with" + " a delay picture already set! (memory leak)");
    }
    mDelaySetPicture=draw;
    return;
  }
  WebViewCore.ViewState viewState=draw.mViewState;
  boolean isPictureAfterFirstLayout=viewState != null;
  if (updateBaseLayer) {
    setBaseLayer(draw.mBaseLayer,draw.mInvalRegion,getSettings().getShowVisualIndicator(),isPictureAfterFirstLayout);
  }
  final Point viewSize=draw.mViewSize;
  final boolean updateLayout=viewSize.x == mLastWidthSent && viewSize.y == mLastHeightSent;
  mSendScrollEvent=false;
  recordNewContentSize(draw.mContentSize.x,draw.mContentSize.y,updateLayout);
  if (isPictureAfterFirstLayout) {
    mLastWidthSent=0;
    mZoomManager.onFirstLayout(draw);
    int scrollX=viewState.mShouldStartScrolledRight ? getContentWidth() : viewState.mScrollX;
    int scrollY=viewState.mScrollY;
    contentScrollTo(scrollX,scrollY,false);
    if (!mDrawHistory) {
      hideSoftKeyboard();
    }
  }
  mSendScrollEvent=true;
  if (DebugFlags.WEB_VIEW) {
    Rect b=draw.mInvalRegion.getBounds();
    Log.v(LOGTAG,"NEW_PICTURE_MSG_ID {" + b.left + ","+ b.top+ ","+ b.right+ ","+ b.bottom+ "}");
  }
  Rect invalBounds=draw.mInvalRegion.getBounds();
  if (!invalBounds.isEmpty()) {
    invalidateContentRect(invalBounds);
  }
 else {
    mWebView.invalidate();
  }
  mZoomManager.onNewPicture(draw);
  if (isPictureAfterFirstLayout) {
    mViewManager.postReadyToDrawAll();
  }
  scrollEditWithCursor();
  if (mPictureListener != null) {
    if (!mWebView.isHardwareAccelerated() || mWebView.getLayerType() == View.LAYER_TYPE_SOFTWARE) {
      mPictureListener.onNewPicture(getWebView(),capturePicture());
    }
  }
}
