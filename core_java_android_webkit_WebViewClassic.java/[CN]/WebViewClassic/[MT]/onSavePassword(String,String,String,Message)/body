{
  boolean rVal=false;
  if (resumeMsg == null) {
    mDatabase.setUsernamePassword(schemePlusHost,username,password);
  }
 else {
    if (mResumeMsg != null) {
      Log.w(LOGTAG,"onSavePassword should not be called while dialog is up");
      resumeMsg.sendToTarget();
      return true;
    }
    mResumeMsg=resumeMsg;
    final Message remember=mPrivateHandler.obtainMessage(REMEMBER_PASSWORD);
    remember.getData().putString("host",schemePlusHost);
    remember.getData().putString("username",username);
    remember.getData().putString("password",password);
    remember.obj=resumeMsg;
    final Message neverRemember=mPrivateHandler.obtainMessage(NEVER_REMEMBER_PASSWORD);
    neverRemember.getData().putString("host",schemePlusHost);
    neverRemember.getData().putString("username",username);
    neverRemember.getData().putString("password",password);
    neverRemember.obj=resumeMsg;
    mSavePasswordDialog=new AlertDialog.Builder(mContext).setTitle(com.android.internal.R.string.save_password_label).setMessage(com.android.internal.R.string.save_password_message).setPositiveButton(com.android.internal.R.string.save_password_notnow,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        if (mResumeMsg != null) {
          resumeMsg.sendToTarget();
          mResumeMsg=null;
        }
        mSavePasswordDialog=null;
      }
    }
).setNeutralButton(com.android.internal.R.string.save_password_remember,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        if (mResumeMsg != null) {
          remember.sendToTarget();
          mResumeMsg=null;
        }
        mSavePasswordDialog=null;
      }
    }
).setNegativeButton(com.android.internal.R.string.save_password_never,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        if (mResumeMsg != null) {
          neverRemember.sendToTarget();
          mResumeMsg=null;
        }
        mSavePasswordDialog=null;
      }
    }
).setOnDismissListener(new DialogInterface.OnDismissListener(){
      @Override public void onDismiss(      DialogInterface dialog){
        if (mResumeMsg != null) {
          resumeMsg.sendToTarget();
          mResumeMsg=null;
        }
        mSavePasswordDialog=null;
      }
    }
).show();
    rVal=true;
  }
  return rVal;
}
