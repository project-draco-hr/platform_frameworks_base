{
  if (textGeneration == mTextGeneration) {
    if (mInputConnection != null && mFieldPointer == nodePointer) {
      mInputConnection.setSelection(data.mStart,data.mEnd);
    }
  }
  nativeSetTextSelection(mNativeClass,data.mSelectTextPtr);
  if ((data.mSelectionReason == TextSelectionData.REASON_ACCESSIBILITY_INJECTOR) || (!mSelectingText && data.mStart != data.mEnd && data.mSelectionReason != TextSelectionData.REASON_SELECT_WORD)) {
    selectionDone();
    mShowTextSelectionExtra=true;
    invalidate();
    return;
  }
  if (data.mSelectTextPtr != 0 && (data.mStart != data.mEnd || (mFieldPointer == nodePointer && mFieldPointer != 0) || (nodePointer == 0 && data.mStart == 0 && data.mEnd == 0))) {
    mIsEditingText=(mFieldPointer == nodePointer) && nodePointer != 0;
    mIsCaretSelection=(data.mStart == data.mEnd && nodePointer != 0);
    if (mIsCaretSelection && (mInputConnection == null || mInputConnection.getEditable().length() == 0)) {
      selectionDone();
    }
 else {
      if (!mSelectingText) {
        setupWebkitSelect();
      }
 else {
        syncSelectionCursors();
      }
      animateHandles();
      if (mIsCaretSelection) {
        resetCaretTimer();
      }
    }
  }
 else {
    selectionDone();
  }
  invalidate();
}
