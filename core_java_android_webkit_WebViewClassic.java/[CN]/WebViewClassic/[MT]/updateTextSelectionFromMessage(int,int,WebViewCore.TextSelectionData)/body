{
  if (textGeneration == mTextGeneration) {
    if (mInputConnection != null && mFieldPointer == nodePointer) {
      mInputConnection.setSelection(data.mStart,data.mEnd);
    }
  }
  nativeSetTextSelection(mNativeClass,data.mSelectTextPtr);
  if ((data.mSelectionReason == TextSelectionData.REASON_ACCESSIBILITY_INJECTOR) || (!mSelectingText && data.mSelectionReason != TextSelectionData.REASON_SELECT_WORD)) {
    selectionDone();
    mShowTextSelectionExtra=true;
    invalidate();
    return;
  }
  if (data.mSelectTextPtr != 0 && (data.mStart != data.mEnd || (mFieldPointer == nodePointer && mFieldPointer != 0))) {
    mIsCaretSelection=(data.mStart == data.mEnd);
    if (mIsCaretSelection && (mInputConnection == null || mInputConnection.getEditable().length() == 0)) {
      selectionDone();
    }
 else {
      if (!mSelectingText) {
        setupWebkitSelect();
      }
 else       if (!mSelectionStarted) {
        syncSelectionCursors();
      }
 else {
        adjustSelectionCursors();
      }
      if (mIsCaretSelection) {
        resetCaretTimer();
      }
    }
  }
 else {
    selectionDone();
  }
  invalidate();
}
