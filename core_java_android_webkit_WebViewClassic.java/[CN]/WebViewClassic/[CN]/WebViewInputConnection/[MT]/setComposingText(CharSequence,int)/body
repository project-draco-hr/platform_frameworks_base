{
  Editable editable=getEditable();
  int start=getComposingSpanStart(editable);
  int end=getComposingSpanEnd(editable);
  if (start < 0 || end < 0) {
    start=Selection.getSelectionStart(editable);
    end=Selection.getSelectionEnd(editable);
  }
  if (end < start) {
    int temp=end;
    end=start;
    start=temp;
  }
  CharSequence limitedText=limitReplaceTextByMaxLength(text,end - start);
  setNewText(start,end,limitedText);
  if (limitedText != text) {
    newCursorPosition-=text.length() - limitedText.length();
  }
  super.setComposingText(limitedText,newCursorPosition);
  updateSelection();
  if (limitedText != text) {
    restartInput();
    int lastCaret=start + limitedText.length();
    finishComposingText();
    setSelection(lastCaret,lastCaret);
  }
  return true;
}
