{
  final long time=SystemClock.uptimeMillis();
  if (time - mStartTimeMillis > mState.mDuration) {
    if (mState.mAlpha == 0) {
      mFrom=0;
      mTo=255;
      mState.mAlpha=0;
      mReverse=false;
    }
 else {
      mFrom=255;
      mTo=0;
      mState.mAlpha=255;
      mReverse=true;
    }
    mDuration=mState.mDuration=duration;
    mTransitionState=TRANSITION_STARTING;
    invalidateSelf();
    return;
  }
  mReverse=!mReverse;
  mFrom=mState.mAlpha;
  mTo=mReverse ? 0 : 255;
  mDuration=(int)(mReverse ? time - mStartTimeMillis : mState.mDuration - (time - mStartTimeMillis));
  mTransitionState=TRANSITION_STARTING;
}
