{
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkState(buildMobile3gState(IMSI_1));
  expectNetworkStatsSummary(buildEmptyStats());
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION));
  verifyAndReset();
  incrementCurrentTime(HOUR_IN_MILLIS);
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkStatsSummary(buildEmptyStats());
  expectNetworkStatsUidDetail(new NetworkStats(getElapsedRealtime(),1).addValues(TEST_IFACE,UID_RED,SET_DEFAULT,TAG_NONE,1024L,8L,1024L,8L,0L).addValues(TEST_IFACE,UID_RED,SET_DEFAULT,0xF00D,512L,4L,512L,4L,0L));
  expectNetworkStatsPoll();
  mService.incrementOperationCount(UID_RED,0xF00D,5);
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertUidTotal(sTemplateImsi1,UID_RED,1024L,8L,1024L,8L,5);
  verifyAndReset();
  incrementCurrentTime(HOUR_IN_MILLIS);
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkState(buildMobile4gState());
  expectNetworkStatsSummary(buildEmptyStats());
  expectNetworkStatsUidDetail(buildEmptyStats());
  expectNetworkStatsPoll();
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION));
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  verifyAndReset();
  incrementCurrentTime(HOUR_IN_MILLIS);
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkStatsSummary(buildEmptyStats());
  expectNetworkStatsUidDetail(new NetworkStats(getElapsedRealtime(),1).addValues(TEST_IFACE,UID_RED,SET_DEFAULT,TAG_NONE,512L,4L,256L,2L,0L).addValues(TEST_IFACE,UID_RED,SET_DEFAULT,0xFAAD,512L,4L,256L,2L,0L));
  expectNetworkStatsPoll();
  mService.incrementOperationCount(UID_RED,0xFAAD,5);
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertUidTotal(sTemplateImsi1,UID_RED,1536L,12L,1280L,10L,10);
  verifyAndReset();
}
