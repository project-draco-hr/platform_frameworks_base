{
  long elapsedRealtime=0;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkState(buildMobile3gState(IMSI_1));
  expectNetworkStatsSummary(buildEmptyStats(elapsedRealtime));
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION));
  verifyAndReset();
  elapsedRealtime+=HOUR_IN_MILLIS;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkStatsSummary(buildEmptyStats(elapsedRealtime));
  expectNetworkStatsDetail(new NetworkStats(elapsedRealtime,1).addEntry(TEST_IFACE,UID_RED,TAG_NONE,1024L,1024L).addEntry(TEST_IFACE,UID_RED,0xF00D,512L,512L));
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertUidTotal(sTemplateImsi1,UID_RED,1024L,1024L);
  verifyAndReset();
  elapsedRealtime+=HOUR_IN_MILLIS;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkState(buildMobile4gState());
  expectNetworkStatsSummary(buildEmptyStats(elapsedRealtime));
  expectNetworkStatsDetail(buildEmptyStats(elapsedRealtime));
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION));
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  verifyAndReset();
  elapsedRealtime+=HOUR_IN_MILLIS;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkStatsSummary(buildEmptyStats(elapsedRealtime));
  expectNetworkStatsDetail(new NetworkStats(elapsedRealtime,1).addEntry(TEST_IFACE,UID_RED,TAG_NONE,512L,256L));
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertUidTotal(sTemplateImsi1,UID_RED,1536L,1280L);
  verifyAndReset();
}
