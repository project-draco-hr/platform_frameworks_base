{
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkState(buildMobile3gState(IMSI_1));
  expectNetworkStatsSummary(buildEmptyStats());
  expectNetworkStatsUidDetail(buildEmptyStats());
  expectNetworkStatsPoll();
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION_IMMEDIATE));
  verifyAndReset();
  incrementCurrentTime(90 * MINUTE_IN_MILLIS);
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkStatsSummaryDev(new NetworkStats(getElapsedRealtime(),1).addIfaceValues(TEST_IFACE,6000L,60L,3000L,30L));
  expectNetworkStatsSummaryXt(buildEmptyStats());
  expectNetworkStatsUidDetail(buildEmptyStats());
  expectNetworkStatsPoll();
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertNetworkTotal(sTemplateImsi1,6000L,60L,3000L,30L,0);
  verifyAndReset();
  incrementCurrentTime(2 * HOUR_IN_MILLIS);
  expectCurrentTime();
  expectDefaultSettings();
  expectNetworkStatsSummaryDev(new NetworkStats(getElapsedRealtime(),1).addIfaceValues(TEST_IFACE,6004L,64L,3004L,34L));
  expectNetworkStatsSummaryXt(new NetworkStats(getElapsedRealtime(),1).addIfaceValues(TEST_IFACE,10240L,0L,0L,0L));
  expectNetworkStatsUidDetail(buildEmptyStats());
  expectNetworkStatsPoll();
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertNetworkTotal(sTemplateImsi1,13681L,61L,3001L,31L,0);
  assertNetworkTotal(sTemplateImsi1,startTimeMillis(),startTimeMillis() + 2 * HOUR_IN_MILLIS,6001L,61L,3001L,31L,0);
  assertNetworkTotal(sTemplateImsi1,startTimeMillis() + 2 * HOUR_IN_MILLIS,startTimeMillis() + 4 * HOUR_IN_MILLIS,7680L,0L,0L,0L,0);
  verifyAndReset();
}
