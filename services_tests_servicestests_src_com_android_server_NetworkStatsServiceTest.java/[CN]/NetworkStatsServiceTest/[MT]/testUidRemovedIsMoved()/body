{
  long elapsedRealtime=0;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkState(buildWifiState());
  expectNetworkStatsSummary(buildEmptyStats(elapsedRealtime));
  replay();
  mServiceContext.sendBroadcast(new Intent(CONNECTIVITY_ACTION));
  verifyAndReset();
  elapsedRealtime+=HOUR_IN_MILLIS;
  expectTime(TEST_START + elapsedRealtime);
  expectDefaultSettings();
  expectNetworkStatsSummary(new NetworkStats(elapsedRealtime,1).addValues(TEST_IFACE,UID_ALL,TAG_NONE,4128L,258L,544L,34L));
  expectNetworkStatsDetail(new NetworkStats(elapsedRealtime,1).addValues(TEST_IFACE,UID_RED,TAG_NONE,16L,1L,16L,1L).addValues(TEST_IFACE,UID_BLUE,TAG_NONE,4096L,258L,512L,32L).addValues(TEST_IFACE,UID_GREEN,TAG_NONE,16L,1L,16L,1L));
  replay();
  mServiceContext.sendBroadcast(new Intent(ACTION_NETWORK_STATS_POLL));
  assertNetworkTotal(sTemplateWifi,4128L,544L);
  assertUidTotal(sTemplateWifi,UID_RED,16L,16L);
  assertUidTotal(sTemplateWifi,UID_BLUE,4096L,512L);
  assertUidTotal(sTemplateWifi,UID_GREEN,16L,16L);
  verifyAndReset();
  expectDefaultSettings();
  replay();
  final Intent intent=new Intent(ACTION_UID_REMOVED);
  intent.putExtra(EXTRA_UID,UID_BLUE);
  mServiceContext.sendBroadcast(intent);
  intent.putExtra(EXTRA_UID,UID_RED);
  mServiceContext.sendBroadcast(intent);
  assertNetworkTotal(sTemplateWifi,4128L,544L);
  assertUidTotal(sTemplateWifi,UID_RED,0L,0L);
  assertUidTotal(sTemplateWifi,UID_BLUE,0L,0L);
  assertUidTotal(sTemplateWifi,UID_GREEN,16L,16L);
  assertUidTotal(sTemplateWifi,UID_REMOVED,4112L,528L);
  verifyAndReset();
}
