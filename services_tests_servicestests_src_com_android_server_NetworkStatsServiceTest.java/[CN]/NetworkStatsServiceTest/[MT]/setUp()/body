{
  super.setUp();
  mServiceContext=new BroadcastInterceptingContext(getContext());
  mStatsDir=getContext().getFilesDir();
  mNetManager=createMock(INetworkManagementService.class);
  mAlarmManager=createMock(IAlarmManager.class);
  mTime=createMock(TrustedTime.class);
  mConnManager=createMock(IConnectivityManager.class);
  mService=new NetworkStatsService(mServiceContext,mNetManager,mAlarmManager,mTime,mStatsDir);
  mService.bindConnectivityManager(mConnManager);
  expectSystemReady();
  replay();
  mService.systemReady();
  verifyAndReset();
}
