{
  ExportTestResolver resolver=new ExportTestResolver();
  ContentValues contentValues=resolver.buildData(StructuredName.CONTENT_ITEM_TYPE);
  contentValues.put(StructuredName.FAMILY_NAME,"PhotoTest");
  contentValues=resolver.buildData(Photo.CONTENT_ITEM_TYPE);
  contentValues.put(Photo.PHOTO,sPhotoByteArray);
  ContentValues contentValuesForPhoto=new ContentValues();
  contentValuesForPhoto.put("ENCODING",(isV30 ? "b" : "BASE64"));
  VCardVerificationHandler handler=new VCardVerificationHandler(this,isV30);
  handler.addNewPropertyNodesVerifier().addNodeWithOrder("VERSION",(isV30 ? "3.0" : "2.1")).addNodeWithoutOrder("FN","PhotoTest").addNodeWithoutOrder("N","PhotoTest;;;;",Arrays.asList("PhotoTest","","","","")).addNodeWithOrder("PHOTO",null,null,sPhotoByteArray,contentValuesForPhoto,new TypeSet("JPEG"),null);
  int vcardType=(isV30 ? VCardConfig.VCARD_TYPE_V30_GENERIC : VCardConfig.VCARD_TYPE_V21_GENERIC);
  VCardComposer composer=new VCardComposer(new CustomMockContext(resolver),vcardType);
  composer.addHandler(handler);
  if (!composer.init(VCardComposer.CONTACTS_TEST_CONTENT_URI,null,null,null)) {
    fail("init() failed. Reason: " + composer.getErrorReason());
  }
  assertFalse(composer.isAfterLast());
  assertTrue(composer.createOneEntry());
  assertTrue(composer.isAfterLast());
  composer.terminate();
}
