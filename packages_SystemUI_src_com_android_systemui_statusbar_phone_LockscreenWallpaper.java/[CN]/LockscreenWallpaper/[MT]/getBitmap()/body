{
  try {
    if (mCached) {
      return mCache;
    }
    if (!mService.isWallpaperSupported(mContext.getOpPackageName())) {
      mCached=true;
      mCache=null;
      return null;
    }
    final int lockWallpaperUserId=mSelectedUser != null ? mSelectedUser.getIdentifier() : mCurrentUserId;
    ParcelFileDescriptor fd=mService.getWallpaper(null,WallpaperManager.FLAG_LOCK,new Bundle(),lockWallpaperUserId);
    if (fd != null) {
      try {
        BitmapFactory.Options options=new BitmapFactory.Options();
        mCache=BitmapFactory.decodeFileDescriptor(fd.getFileDescriptor(),null,options);
        mCached=true;
        return mCache;
      }
 catch (      OutOfMemoryError e) {
        Log.w(TAG,"Can't decode file",e);
        return null;
      }
 finally {
        IoUtils.closeQuietly(fd);
      }
    }
 else {
      mCached=true;
      if (mSelectedUser != null && mSelectedUser.getIdentifier() != mCurrentUserId) {
        mCache=mWallpaperManager.getBitmapAsUser(mSelectedUser.getIdentifier());
      }
 else {
        mCache=null;
      }
      return mCache;
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"System dead?" + e);
    return null;
  }
}
