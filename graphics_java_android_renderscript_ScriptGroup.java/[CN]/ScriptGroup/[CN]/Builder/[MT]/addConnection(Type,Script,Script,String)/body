{
  android.util.Log.v("RSR","addConnection " + t + ", "+ output+ ", "+ input);
  Node nout=findScript(output);
  Connection c;
  if (nout == null) {
    android.util.Log.v("RSR","addConnection new output node");
    nout=new Node(output);
    mNodeCount++;
    c=new Connection(nout,t);
    mConnectionCount++;
    nout.addOutput(c);
    addNode(nout);
  }
 else {
    android.util.Log.v("RSR","addConnection reuse output node");
    if (nout.mOutput[0] != null) {
      if (nout.mOutput[0].mFrom.mScript != output) {
        throw new RSInvalidStateException("Changed output of existing node");
      }
      if (nout.mOutput[0].mAllocationType != t) {
        throw new RSInvalidStateException("Changed output type of existing node");
      }
    }
    c=nout.mOutput[0];
  }
  Node nin=findScript(input);
  if (nin == null) {
    android.util.Log.v("RSR","addConnection new input node");
    nin=new Node(input);
    mNodeCount++;
    addNode(nin);
  }
  c.addTo(nin,inputName);
  nin.addInput(c);
  validate();
  return this;
}
