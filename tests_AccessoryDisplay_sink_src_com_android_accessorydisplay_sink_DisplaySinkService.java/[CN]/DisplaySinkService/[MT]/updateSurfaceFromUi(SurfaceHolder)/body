{
  Surface surface=null;
  int width=0, height=0;
  if (holder != null && !holder.isCreating()) {
    surface=holder.getSurface();
    if (surface.isValid()) {
      final Rect frame=holder.getSurfaceFrame();
      width=frame.width();
      height=frame.height();
    }
 else {
      surface=null;
    }
  }
synchronized (mSurfaceAndCodecLock) {
    if (mSurface == surface && mSurfaceWidth == width && mSurfaceHeight == height) {
      return;
    }
    mSurface=surface;
    mSurfaceWidth=width;
    mSurfaceHeight=height;
    if (mCodec != null) {
      mCodec.stop();
      mCodec=null;
      mCodecInputBuffers=null;
      mCodecBufferInfo=null;
    }
    if (mSurface != null) {
      MediaFormat format=MediaFormat.createVideoFormat("video/avc",mSurfaceWidth,mSurfaceHeight);
      mCodec=MediaCodec.createDecoderByType("video/avc");
      mCodec.configure(format,mSurface,null,0);
      mCodec.start();
      mCodecBufferInfo=new BufferInfo();
    }
    mTransportHandler.post(new Runnable(){
      @Override public void run(){
        sendSinkStatus();
      }
    }
);
  }
}
