{
  boolean migrated=false;
  if (mOwners.getDeviceOwnerUserRestrictionsNeedsMigration()) {
    if (VERBOSE_LOG) {
      Log.v(LOG_TAG,"Migrating DO user restrictions");
    }
    migrated=true;
    final ActiveAdmin deviceOwnerAdmin=getDeviceOwnerAdminLocked();
    migrateUserRestrictionsForUser(UserHandle.SYSTEM,deviceOwnerAdmin,null,true);
    pushUserRestrictions(UserHandle.USER_SYSTEM);
    mOwners.setDeviceOwnerUserRestrictionsMigrated();
  }
  final Set<String> secondaryUserExceptionList=Sets.newArraySet(UserManager.DISALLOW_OUTGOING_CALLS,UserManager.DISALLOW_SMS);
  for (  UserInfo ui : mUserManager.getUsers()) {
    final int userId=ui.id;
    if (mOwners.getProfileOwnerUserRestrictionsNeedsMigration(userId)) {
      if (VERBOSE_LOG) {
        Log.v(LOG_TAG,"Migrating PO user restrictions for user " + userId);
      }
      migrated=true;
      final ActiveAdmin profileOwnerAdmin=getProfileOwnerAdminLocked(userId);
      final Set<String> exceptionList=(userId == UserHandle.USER_SYSTEM) ? null : secondaryUserExceptionList;
      migrateUserRestrictionsForUser(ui.getUserHandle(),profileOwnerAdmin,exceptionList,false);
      pushUserRestrictions(userId);
      mOwners.setProfileOwnerUserRestrictionsMigrated(userId);
    }
  }
  if (VERBOSE_LOG && migrated) {
    Log.v(LOG_TAG,"User restrictions migrated.");
  }
}
