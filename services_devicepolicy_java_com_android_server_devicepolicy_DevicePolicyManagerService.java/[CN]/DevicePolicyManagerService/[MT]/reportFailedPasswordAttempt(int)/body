{
  enforceFullCrossUsersPermission(userHandle);
  if (!isSeparateProfileChallengeEnabled(userHandle)) {
    enforceNotManagedProfile(userHandle,"report failed password attempt if separate profile challenge is not in place");
  }
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BIND_DEVICE_ADMIN,null);
  final long ident=mInjector.binderClearCallingIdentity();
  try {
    boolean wipeData=false;
    int identifier=0;
synchronized (this) {
      DevicePolicyData policy=getUserData(userHandle);
      policy.mFailedPasswordAttempts++;
      saveSettingsLocked(userHandle);
      if (mHasFeature) {
        ActiveAdmin strictestAdmin=getAdminWithMinimumFailedPasswordsForWipeLocked(userHandle,false);
        int max=strictestAdmin != null ? strictestAdmin.maximumFailedPasswordsForWipe : 0;
        if (max > 0 && policy.mFailedPasswordAttempts >= max) {
          wipeData=true;
          identifier=strictestAdmin.getUserHandle().getIdentifier();
        }
        sendAdminCommandForLockscreenPoliciesLocked(DeviceAdminReceiver.ACTION_PASSWORD_FAILED,DeviceAdminInfo.USES_POLICY_WATCH_LOGIN,userHandle);
      }
    }
    if (wipeData) {
      wipeDeviceOrUserLocked(false,identifier,"reportFailedPasswordAttempt()");
    }
  }
  finally {
    mInjector.binderRestoreCallingIdentity(ident);
  }
  if (mInjector.securityLogIsLoggingEnabled()) {
    SecurityLog.writeEvent(SecurityLog.TAG_KEYGUARD_DISMISS_AUTH_ATTEMPT,0,1);
  }
}
