{
  boolean removed=false;
  if (DBG)   Slog.d(LOG_TAG,"Handling package changes for user " + userHandle);
  DevicePolicyData policy=getUserData(userHandle);
  IPackageManager pm=getIPackageManager();
synchronized (this) {
    for (int i=policy.mAdminList.size() - 1; i >= 0; i--) {
      ActiveAdmin aa=policy.mAdminList.get(i);
      try {
        final String adminPackage=aa.info.getPackageName();
        if (packageName == null || packageName.equals(adminPackage)) {
          if (pm.getPackageInfo(adminPackage,0,userHandle) == null || pm.getReceiverInfo(aa.info.getComponent(),0,userHandle) == null) {
            removed=true;
            policy.mAdminList.remove(i);
            policy.mAdminMap.remove(aa.info.getComponent());
          }
        }
      }
 catch (      RemoteException re) {
      }
    }
    if (removed) {
      validatePasswordOwnerLocked(policy);
      syncDeviceCapabilitiesLocked(policy);
      saveSettingsLocked(policy.mUserHandle);
    }
    if (policy.mDelegatedCertInstallerPackage != null && (packageName == null || packageName.equals(policy.mDelegatedCertInstallerPackage))) {
      try {
        if (pm.getPackageInfo(policy.mDelegatedCertInstallerPackage,0,userHandle) == null) {
          policy.mDelegatedCertInstallerPackage=null;
          saveSettingsLocked(policy.mUserHandle);
        }
      }
 catch (      RemoteException e) {
      }
    }
  }
}
