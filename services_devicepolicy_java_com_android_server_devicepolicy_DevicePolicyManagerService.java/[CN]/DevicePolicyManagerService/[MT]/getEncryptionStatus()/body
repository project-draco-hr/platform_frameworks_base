{
  String status=systemPropertiesGet("ro.crypto.state","unsupported");
  if ("encrypted".equalsIgnoreCase(status)) {
    final long token=binderClearCallingIdentity();
    try {
      return LockPatternUtils.isDeviceEncrypted() ? DevicePolicyManager.ENCRYPTION_STATUS_ACTIVE : DevicePolicyManager.ENCRYPTION_STATUS_ACTIVE_DEFAULT_KEY;
    }
  finally {
      binderRestoreCallingIdentity(token);
    }
  }
 else   if ("unencrypted".equalsIgnoreCase(status)) {
    return DevicePolicyManager.ENCRYPTION_STATUS_INACTIVE;
  }
 else {
    return DevicePolicyManager.ENCRYPTION_STATUS_UNSUPPORTED;
  }
}
