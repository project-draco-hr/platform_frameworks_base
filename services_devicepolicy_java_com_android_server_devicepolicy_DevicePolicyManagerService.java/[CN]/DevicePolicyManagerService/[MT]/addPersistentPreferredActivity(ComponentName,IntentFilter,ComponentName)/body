{
  int callingUserId=UserHandle.getCallingUserId();
  Slog.d(LOG_TAG,"called by user " + callingUserId);
synchronized (this) {
    ActiveAdmin aa=getActiveAdminUncheckedLocked(admin,callingUserId);
    if (aa == null) {
      throw new SecurityException("No active admin " + admin);
    }
 else {
      if (isProfileOwner(admin.getPackageName(),callingUserId) || isDeviceOwner(admin.getPackageName())) {
        IPackageManager pm=AppGlobals.getPackageManager();
        long id=Binder.clearCallingIdentity();
        try {
          pm.addPersistentPreferredActivity(filter,activity,callingUserId);
        }
 catch (        RemoteException re) {
        }
 finally {
          restoreCallingIdentity(id);
        }
      }
 else {
        throw new SecurityException("Admin " + admin + "is not device owner or profile owner");
      }
    }
  }
}
