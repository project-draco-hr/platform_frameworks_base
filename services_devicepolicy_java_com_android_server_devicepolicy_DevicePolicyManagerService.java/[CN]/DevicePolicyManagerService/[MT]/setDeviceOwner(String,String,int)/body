{
  if (!mHasFeature) {
    return false;
  }
  if (packageName == null || !isPackageInstalledForUser(packageName,userId)) {
    throw new IllegalArgumentException("Invalid package name " + packageName + " for device owner");
  }
synchronized (this) {
    enforceCanSetDeviceOwner(userId);
    long ident=mInjector.binderClearCallingIdentity();
    try {
      mInjector.getIBackupManager().setBackupServiceActive(UserHandle.USER_SYSTEM,false);
    }
 catch (    RemoteException e) {
      throw new IllegalStateException("Failed deactivating backup service.",e);
    }
 finally {
      mInjector.binderRestoreCallingIdentity(ident);
    }
    mOwners.setDeviceOwner(packageName,ownerName,userId);
    mOwners.writeDeviceOwner();
    updateDeviceOwnerLocked();
    Intent intent=new Intent(DevicePolicyManager.ACTION_DEVICE_OWNER_CHANGED);
    ident=mInjector.binderClearCallingIdentity();
    try {
      mContext.sendBroadcastAsUser(intent,new UserHandle(userId));
    }
  finally {
      mInjector.binderRestoreCallingIdentity(ident);
    }
    return true;
  }
}
