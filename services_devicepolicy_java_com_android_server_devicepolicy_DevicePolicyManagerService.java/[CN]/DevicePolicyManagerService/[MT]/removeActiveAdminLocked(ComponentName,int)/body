{
  final ActiveAdmin admin=getActiveAdminUncheckedLocked(adminReceiver,userHandle);
  if (admin != null) {
    sendAdminCommandLocked(admin,DeviceAdminReceiver.ACTION_DEVICE_ADMIN_DISABLED,new BroadcastReceiver(){
      @Override public void onReceive(      Context context,      Intent intent){
synchronized (DevicePolicyManagerService.this) {
          int userHandle=admin.getUserHandle().getIdentifier();
          DevicePolicyData policy=getUserData(userHandle);
          boolean doProxyCleanup=admin.info.usesPolicy(DeviceAdminInfo.USES_POLICY_SETS_GLOBAL_PROXY);
          policy.mAdminList.remove(admin);
          policy.mAdminMap.remove(adminReceiver);
          validatePasswordOwnerLocked(policy);
          syncDeviceCapabilitiesLocked(policy);
          if (doProxyCleanup) {
            resetGlobalProxyLocked(getUserData(userHandle));
          }
          saveSettingsLocked(userHandle);
          updateMaximumTimeToLockLocked(policy);
        }
      }
    }
);
  }
}
