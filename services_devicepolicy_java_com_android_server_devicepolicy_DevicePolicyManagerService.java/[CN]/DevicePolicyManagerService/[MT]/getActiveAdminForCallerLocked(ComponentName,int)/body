{
  final int callingUid=Binder.getCallingUid();
  final int userHandle=UserHandle.getUserId(callingUid);
  final DevicePolicyData policy=getUserData(userHandle);
  if (who != null) {
    ActiveAdmin admin=policy.mAdminMap.get(who);
    if (admin == null) {
      throw new SecurityException("No active admin " + who);
    }
    if (admin.getUid() != callingUid) {
      throw new SecurityException("Admin " + who + " is not owned by uid "+ Binder.getCallingUid());
    }
    if (!admin.info.usesPolicy(reqPolicy)) {
      throw new SecurityException("Admin " + admin.info.getComponent() + " did not specify uses-policy for: "+ admin.info.getTagForPolicy(reqPolicy));
    }
    return admin;
  }
 else {
    final int N=policy.mAdminList.size();
    for (int i=0; i < N; i++) {
      ActiveAdmin admin=policy.mAdminList.get(i);
      if (admin.getUid() == callingUid && admin.info.usesPolicy(reqPolicy)) {
        return admin;
      }
    }
    throw new SecurityException("No active admin owned by uid " + Binder.getCallingUid() + " for policy #"+ reqPolicy);
  }
}
