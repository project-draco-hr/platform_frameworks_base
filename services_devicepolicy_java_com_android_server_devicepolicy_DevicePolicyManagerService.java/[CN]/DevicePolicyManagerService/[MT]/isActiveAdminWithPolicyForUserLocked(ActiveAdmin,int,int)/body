{
  boolean ownsDevice=isDeviceOwner(admin.info.getPackageName());
  boolean ownsProfile=(getProfileOwner(userId) != null && getProfileOwner(userId).getPackageName().equals(admin.info.getPackageName()));
  boolean ownsInitialization=isDeviceInitializer(admin.info.getPackageName()) && !hasUserSetupCompleted(userId);
  if (reqPolicy == DeviceAdminInfo.USES_POLICY_DEVICE_OWNER) {
    if (ownsDevice || (userId == UserHandle.USER_OWNER && ownsInitialization)) {
      return true;
    }
  }
 else   if (reqPolicy == DeviceAdminInfo.USES_POLICY_PROFILE_OWNER) {
    if (ownsDevice || ownsProfile || ownsInitialization) {
      return true;
    }
  }
 else {
    if (admin.info.usesPolicy(reqPolicy)) {
      return true;
    }
  }
  return false;
}
