{
  boolean ownsDevice=isDeviceOwner(admin.info.getComponent());
  boolean ownsProfile=(getProfileOwner(userId) != null && getProfileOwner(userId).getPackageName().equals(admin.info.getPackageName()));
  if (reqPolicy == DeviceAdminInfo.USES_POLICY_DEVICE_OWNER) {
    if ((userId == UserHandle.USER_SYSTEM && ownsDevice) || (ownsDevice && ownsProfile)) {
      return true;
    }
  }
 else   if (reqPolicy == DeviceAdminInfo.USES_POLICY_PROFILE_OWNER) {
    if ((userId == UserHandle.USER_SYSTEM && ownsDevice) || ownsProfile) {
      return true;
    }
  }
 else {
    if (admin.info.usesPolicy(reqPolicy)) {
      return true;
    }
  }
  return false;
}
