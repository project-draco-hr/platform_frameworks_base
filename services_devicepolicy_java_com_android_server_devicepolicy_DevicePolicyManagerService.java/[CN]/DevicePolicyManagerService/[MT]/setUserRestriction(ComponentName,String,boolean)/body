{
  Preconditions.checkNotNull(who,"ComponentName is null");
  final int userHandle=mInjector.userHandleGetCallingUserId();
  final UserHandle user=new UserHandle(userHandle);
synchronized (mUserManagerInternal.getUserRestrictionsLock()) {
synchronized (this) {
      ActiveAdmin activeAdmin=getActiveAdminForCallerLocked(who,DeviceAdminInfo.USES_POLICY_PROFILE_OWNER);
      final boolean isDeviceOwner=isDeviceOwner(who);
      if (!isDeviceOwner && userHandle != UserHandle.USER_SYSTEM && DEVICE_OWNER_USER_RESTRICTIONS.contains(key)) {
        throw new SecurityException("Profile owners cannot set user restriction " + key);
      }
      if (IMMUTABLE_USER_RESTRICTIONS.contains(key)) {
        throw new SecurityException("User restriction " + key + " cannot be changed");
      }
      final long id=mInjector.binderClearCallingIdentity();
      try {
        activeAdmin.ensureUserRestrictions().putBoolean(key,enabledFromThisOwner);
        saveSettingsLocked(userHandle);
        if (isDeviceOwner) {
          mUserManagerInternal.updateEffectiveUserRestrictionsForAllUsersRL();
        }
 else {
          mUserManagerInternal.updateEffectiveUserRestrictionsRL(userHandle);
        }
      }
  finally {
        mInjector.binderRestoreCallingIdentity(id);
      }
      sendChangedNotification(userHandle);
    }
  }
}
