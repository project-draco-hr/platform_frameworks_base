{
  UserInfo currentUser;
  try {
    currentUser=ActivityManagerNative.getDefault().getCurrentUser();
  }
 catch (  RemoteException e) {
    Slog.e(LOG_TAG,"Failed to make remote calls to get current user",e);
    return null;
  }
  int userId=currentUser.id;
synchronized (this) {
    List<String> result=null;
    List<UserInfo> profiles=mUserManager.getProfiles(userId);
    final int PROFILES_SIZE=profiles.size();
    for (int i=0; i < PROFILES_SIZE; ++i) {
      DevicePolicyData policy=getUserData(profiles.get(i).id);
      final int N=policy.mAdminList.size();
      for (int j=0; j < N; j++) {
        ActiveAdmin admin=policy.mAdminList.get(j);
        List<String> fromAdmin=admin.permittedInputMethods;
        if (fromAdmin != null) {
          if (result == null) {
            result=new ArrayList<String>(fromAdmin);
          }
 else {
            result.retainAll(fromAdmin);
          }
        }
      }
    }
    if (result != null) {
      InputMethodManager inputMethodManager=(InputMethodManager)mContext.getSystemService(Context.INPUT_METHOD_SERVICE);
      List<InputMethodInfo> imes=inputMethodManager.getInputMethodList();
      long id=Binder.clearCallingIdentity();
      try {
        IPackageManager pm=AppGlobals.getPackageManager();
        if (imes != null) {
          for (          InputMethodInfo ime : imes) {
            ServiceInfo serviceInfo=ime.getServiceInfo();
            ApplicationInfo applicationInfo=serviceInfo.applicationInfo;
            if ((applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0) {
              result.add(serviceInfo.packageName);
            }
          }
        }
      }
  finally {
        restoreCallingIdentity(id);
      }
    }
    return result;
  }
}
