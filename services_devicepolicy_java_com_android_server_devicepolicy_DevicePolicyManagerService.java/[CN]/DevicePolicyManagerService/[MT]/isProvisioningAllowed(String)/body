{
  if (!mHasFeature) {
    return false;
  }
  final int callingUserId=mInjector.userHandleGetCallingUserId();
  if (DevicePolicyManager.ACTION_PROVISION_MANAGED_PROFILE.equals(action)) {
    if (!hasFeatureManagedUsers()) {
      return false;
    }
synchronized (this) {
      if (mOwners.hasDeviceOwner()) {
        if (!mInjector.userManagerIsSplitSystemUser()) {
          return false;
        }
        if (mOwners.getDeviceOwnerUserId() != UserHandle.USER_SYSTEM) {
          return false;
        }
        if (callingUserId == UserHandle.USER_SYSTEM) {
          return false;
        }
      }
    }
    if (getProfileOwner(callingUserId) != null) {
      return false;
    }
    final long ident=mInjector.binderClearCallingIdentity();
    try {
      if (!mUserManager.canAddMoreManagedProfiles(callingUserId,true)) {
        return false;
      }
    }
  finally {
      mInjector.binderRestoreCallingIdentity(ident);
    }
    return true;
  }
 else   if (DevicePolicyManager.ACTION_PROVISION_MANAGED_DEVICE.equals(action)) {
    return isDeviceOwnerProvisioningAllowed(callingUserId);
  }
 else   if (DevicePolicyManager.ACTION_PROVISION_MANAGED_USER.equals(action)) {
    if (!hasFeatureManagedUsers()) {
      return false;
    }
    if (!mInjector.userManagerIsSplitSystemUser()) {
      return false;
    }
    if (callingUserId == UserHandle.USER_SYSTEM) {
      return false;
    }
    if (hasUserSetupCompleted(callingUserId)) {
      return false;
    }
    return true;
  }
 else   if (DevicePolicyManager.ACTION_PROVISION_MANAGED_SHAREABLE_DEVICE.equals(action)) {
    if (!mInjector.userManagerIsSplitSystemUser()) {
      return false;
    }
    return isDeviceOwnerProvisioningAllowed(callingUserId);
  }
  throw new IllegalArgumentException("Unknown provisioning action " + action);
}
