{
  int callingUserId=UserHandle.getCallingUserId();
  long token=binderClearCallingIdentity();
  try {
    UserInfo currentUser;
    UserInfo callingUser=mUserManager.getUserInfo(callingUserId);
    try {
      currentUser=getIActivityManager().getCurrentUser();
    }
 catch (    RemoteException e) {
      Slog.e(LOG_TAG,"Failed to talk to activity managed.",e);
      return false;
    }
    if (callingUser.isManagedProfile() && callingUser.profileGroupId != currentUser.id) {
      Slog.e(LOG_TAG,"Cannot set permitted input methods for managed profile " + "of a user that isn't the foreground user.");
      return false;
    }
    if (!callingUser.isManagedProfile() && callingUserId != currentUser.id) {
      Slog.e(LOG_TAG,"Cannot set permitted input methods " + "of a user that isn't the foreground user.");
      return false;
    }
  }
  finally {
    binderRestoreCallingIdentity(token);
  }
  return true;
}
