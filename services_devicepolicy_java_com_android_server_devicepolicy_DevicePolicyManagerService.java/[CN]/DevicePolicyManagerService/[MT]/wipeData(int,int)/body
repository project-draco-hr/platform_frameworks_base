{
  if (!mHasFeature) {
    return;
  }
  enforceCrossUserPermission(userHandle);
synchronized (this) {
    final ActiveAdmin admin=getActiveAdminForCallerLocked(null,DeviceAdminInfo.USES_POLICY_WIPE_DATA);
    final String source;
    final ComponentName cname=admin.info.getComponent();
    if (cname != null) {
      source=cname.flattenToShortString();
    }
 else {
      source=admin.info.getPackageName();
    }
    long ident=Binder.clearCallingIdentity();
    try {
      if ((flags & WIPE_RESET_PROTECTION_DATA) != 0) {
        if (userHandle != UserHandle.USER_OWNER || !isDeviceOwner(admin.info.getPackageName())) {
          throw new SecurityException("Only device owner admins can set WIPE_RESET_PROTECTION_DATA");
        }
        PersistentDataBlockManager manager=(PersistentDataBlockManager)mContext.getSystemService(Context.PERSISTENT_DATA_BLOCK_SERVICE);
        manager.wipe();
      }
      boolean wipeExtRequested=(flags & WIPE_EXTERNAL_STORAGE) != 0;
      wipeDeviceOrUserLocked(wipeExtRequested,userHandle,"DevicePolicyManager.wipeData() from " + source);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
