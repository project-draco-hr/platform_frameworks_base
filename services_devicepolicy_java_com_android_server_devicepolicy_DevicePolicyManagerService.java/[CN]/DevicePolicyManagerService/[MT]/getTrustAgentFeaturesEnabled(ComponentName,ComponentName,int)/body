{
  if (!mHasFeature) {
    return null;
  }
  enforceCrossUserPermission(userHandle);
synchronized (this) {
    if (agent == null) {
      throw new NullPointerException("agent is null");
    }
    final String componentName=agent.flattenToString();
    if (admin != null) {
      final ActiveAdmin ap=getActiveAdminUncheckedLocked(admin,userHandle);
      return (ap != null) ? ap.trustAgentFeatures.get(componentName) : null;
    }
    List<UserInfo> profiles=mUserManager.getProfiles(userHandle);
    List<String> result=null;
    for (    UserInfo userInfo : profiles) {
      DevicePolicyData policy=getUserData(userInfo.getUserHandle().getIdentifier());
      final int N=policy.mAdminList.size();
      for (int i=0; i < N; i++) {
        ActiveAdmin ap=policy.mAdminList.get(i);
        if ((ap.disabledKeyguardFeatures & DevicePolicyManager.KEYGUARD_DISABLE_TRUST_AGENTS) != 0) {
          final List<String> features=ap.trustAgentFeatures.get(componentName);
          if (result == null) {
            if (features == null || features.size() == 0) {
              result=new ArrayList<String>();
              Slog.w(LOG_TAG,"admin " + ap.info.getPackageName() + " has null trust agent feature set; all will be disabled");
            }
 else {
              result=new ArrayList<String>(features.size());
              result.addAll(features);
            }
          }
 else {
            result.retainAll(features);
          }
        }
      }
    }
    return result;
  }
}
