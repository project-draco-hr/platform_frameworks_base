{
  mContext=context;
  mDeviceOwner=new DeviceOwner(mContext);
  mUserManager=UserManager.get(mContext);
  mHasFeature=context.getPackageManager().hasSystemFeature(PackageManager.FEATURE_DEVICE_ADMIN);
  mPowerManager=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mPowerManagerInternal=LocalServices.getService(PowerManagerInternal.class);
  mWakeLock=mPowerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"DPM");
  mLocalService=new LocalService();
  if (!mHasFeature) {
    return;
  }
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_BOOT_COMPLETED);
  filter.addAction(ACTION_EXPIRED_PASSWORD_NOTIFICATION);
  filter.addAction(Intent.ACTION_USER_REMOVED);
  filter.addAction(Intent.ACTION_USER_STARTED);
  filter.addAction(KeyChain.ACTION_STORAGE_CHANGED);
  filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
  context.registerReceiverAsUser(mReceiver,UserHandle.ALL,filter,null,mHandler);
  filter=new IntentFilter();
  filter.addAction(Intent.ACTION_PACKAGE_CHANGED);
  filter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  filter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE);
  filter.addAction(Intent.ACTION_PACKAGE_ADDED);
  filter.addDataScheme("package");
  context.registerReceiverAsUser(mReceiver,UserHandle.ALL,filter,null,mHandler);
  filter=new IntentFilter();
  filter.addAction(Intent.ACTION_MANAGED_PROFILE_ADDED);
  context.registerReceiverAsUser(mReceiver,UserHandle.ALL,filter,null,mHandler);
  LocalServices.addService(DevicePolicyManagerInternal.class,mLocalService);
}
