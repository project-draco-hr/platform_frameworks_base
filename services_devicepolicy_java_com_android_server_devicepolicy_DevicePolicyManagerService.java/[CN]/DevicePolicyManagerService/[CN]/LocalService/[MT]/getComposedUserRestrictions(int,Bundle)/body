{
synchronized (DevicePolicyManagerService.this) {
    final ActiveAdmin deviceOwner=getDeviceOwnerAdminLocked();
    final ActiveAdmin profileOwner=getProfileOwnerAdminLocked(userId);
    final Bundle deviceOwnerRestrictions=deviceOwner == null ? null : deviceOwner.userRestrictions;
    final Bundle profileOwnerRestrictions=profileOwner == null ? null : profileOwner.userRestrictions;
    if (deviceOwnerRestrictions == null && profileOwnerRestrictions == null) {
      return inBundle;
    }
    final Bundle composed=new Bundle(inBundle);
    UserRestrictionsUtils.merge(composed,deviceOwnerRestrictions);
    UserRestrictionsUtils.merge(composed,profileOwnerRestrictions);
    return composed;
  }
}
