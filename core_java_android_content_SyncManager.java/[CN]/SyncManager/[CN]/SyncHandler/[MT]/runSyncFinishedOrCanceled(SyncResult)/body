{
  boolean isLoggable=Log.isLoggable(TAG,Log.VERBOSE);
  if (isLoggable)   Log.v(TAG,"runSyncFinishedOrCanceled");
  final ActiveSyncContext activeSyncContext=mActiveSyncContext;
  mActiveSyncContext=null;
  mSyncStorageEngine.setActiveSync(mActiveSyncContext);
  final SyncOperation syncOperation=activeSyncContext.mSyncOperation;
  final long elapsedTime=SystemClock.elapsedRealtime() - activeSyncContext.mStartTime;
  String historyMessage;
  int downstreamActivity;
  int upstreamActivity;
  if (syncResult != null) {
    if (isLoggable) {
      Log.v(TAG,"runSyncFinishedOrCanceled: is a finished: operation " + syncOperation + ", result "+ syncResult);
    }
    if (!syncResult.hasError()) {
      if (isLoggable) {
        Log.v(TAG,"finished sync operation " + syncOperation);
      }
      historyMessage=SyncStorageEngine.MESG_SUCCESS;
      downstreamActivity=0;
      upstreamActivity=0;
    }
 else {
      maybeRescheduleSync(syncResult,syncOperation);
      if (Config.LOGD) {
        Log.d(TAG,"failed sync operation " + syncOperation);
      }
      historyMessage=Integer.toString(syncResultToErrorNumber(syncResult));
      downstreamActivity=0;
      upstreamActivity=0;
    }
  }
 else {
    if (isLoggable) {
      Log.v(TAG,"runSyncFinishedOrCanceled: is a cancel: operation " + syncOperation);
    }
    if (activeSyncContext.mSyncAdapter != null) {
      try {
        activeSyncContext.mSyncAdapter.cancelSync();
      }
 catch (      RemoteException e) {
      }
    }
    historyMessage=SyncStorageEngine.MESG_CANCELED;
    downstreamActivity=0;
    upstreamActivity=0;
  }
  stopSyncEvent(activeSyncContext.mHistoryRowId,syncOperation,historyMessage,upstreamActivity,downstreamActivity,elapsedTime);
  activeSyncContext.unBindFromSyncAdapter();
  if (syncResult != null && syncResult.tooManyDeletions) {
    installHandleTooManyDeletesNotification(syncOperation.account,syncOperation.authority,syncResult.stats.numDeletes);
  }
 else {
    mNotificationMgr.cancel(syncOperation.account.hashCode() ^ syncOperation.authority.hashCode());
  }
  if (syncResult != null && syncResult.fullSyncRequested) {
    scheduleSyncOperation(new SyncOperation(syncOperation.account,syncOperation.syncSource,syncOperation.authority,new Bundle(),0));
  }
}
