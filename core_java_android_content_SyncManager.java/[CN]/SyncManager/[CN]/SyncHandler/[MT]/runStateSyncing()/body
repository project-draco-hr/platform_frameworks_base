{
  ActiveSyncContext activeSyncContext=mActiveSyncContext;
  final long now=SystemClock.elapsedRealtime();
  if (now > activeSyncContext.mTimeoutStartTime + MAX_TIME_PER_SYNC) {
    Pair<SyncOperation,Long> nextOpAndRunTime;
synchronized (mSyncQueue) {
      nextOpAndRunTime=mSyncQueue.nextOperation();
    }
    SyncOperation curOp=activeSyncContext.mSyncOperation;
    if (nextOpAndRunTime != null && nextOpAndRunTime.second <= now && !nextOpAndRunTime.first.account.equals(curOp.account) && !nextOpAndRunTime.first.authority.equals(curOp.authority)) {
      Log.d(TAG,"canceling and rescheduling sync because it ran too long: " + activeSyncContext.mSyncOperation);
      scheduleSyncOperation(new SyncOperation(activeSyncContext.mSyncOperation));
      sendSyncFinishedOrCanceledMessage(activeSyncContext,null);
    }
 else {
      activeSyncContext.mTimeoutStartTime=now + MAX_TIME_PER_SYNC;
    }
  }
}
