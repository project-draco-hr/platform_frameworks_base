{
  boolean isLoggable=Log.isLoggable(TAG,Log.VERBOSE);
  if (isLoggable)   Log.v(TAG,"runStateIdle");
  if (!mDataConnectionIsConnected) {
    if (isLoggable) {
      Log.v(TAG,"runStateIdle: no data connection, skipping");
    }
    return;
  }
  if (mStorageIsLow) {
    if (isLoggable) {
      Log.v(TAG,"runStateIdle: memory low, skipping");
    }
    return;
  }
  Account[] accounts=mAccounts;
  if (accounts == INITIAL_ACCOUNTS_ARRAY) {
    if (isLoggable) {
      Log.v(TAG,"runStateIdle: accounts not known, skipping");
    }
    return;
  }
  SyncOperation op;
  int syncableState;
  final boolean backgroundDataUsageAllowed=getConnectivityManager().getBackgroundDataSetting();
  final boolean masterSyncAutomatically=mSyncStorageEngine.getMasterSyncAutomatically();
synchronized (mSyncQueue) {
    final long now=SystemClock.elapsedRealtime();
    while (true) {
      Pair<SyncOperation,Long> nextOpAndRunTime=mSyncQueue.nextOperation();
      if (nextOpAndRunTime == null || nextOpAndRunTime.second > now) {
        if (isLoggable) {
          Log.v(TAG,"runStateIdle: no more ready sync operations, returning");
        }
        return;
      }
      op=nextOpAndRunTime.first;
      mSyncQueue.remove(op);
      if (!ArrayUtils.contains(mAccounts,op.account)) {
        continue;
      }
      syncableState=mSyncStorageEngine.getIsSyncable(op.account,op.authority);
      if (syncableState == 0) {
        continue;
      }
      if (!op.extras.getBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_SETTINGS,false) && (syncableState > 0) && (!masterSyncAutomatically || !backgroundDataUsageAllowed || !mSyncStorageEngine.getSyncAutomatically(op.account,op.authority))) {
        continue;
      }
      break;
    }
    if (isLoggable) {
      Log.v(TAG,"runStateIdle: we are going to sync " + op);
    }
  }
  final boolean initializeIsSet=op.extras.getBoolean(ContentResolver.SYNC_EXTRAS_INITIALIZE,false);
  if (syncableState < 0 && !initializeIsSet) {
    op.extras.putBoolean(ContentResolver.SYNC_EXTRAS_INITIALIZE,true);
    op=new SyncOperation(op);
  }
 else   if (syncableState > 0 && initializeIsSet) {
    op.extras.putBoolean(ContentResolver.SYNC_EXTRAS_INITIALIZE,false);
    op=new SyncOperation(op);
  }
  SyncAdapterType syncAdapterType=SyncAdapterType.newKey(op.authority,op.account.type);
  RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapterInfo=mSyncAdapters.getServiceInfo(syncAdapterType);
  if (syncAdapterInfo == null) {
    Log.d(TAG,"can't find a sync adapter for " + syncAdapterType + ", removing settings for it");
    mSyncStorageEngine.removeAuthority(op.account,op.authority);
    runStateIdle();
    return;
  }
  ActiveSyncContext activeSyncContext=new ActiveSyncContext(op,insertStartSyncEvent(op));
  mActiveSyncContext=activeSyncContext;
  if (Log.isLoggable(TAG,Log.VERBOSE)) {
    Log.v(TAG,"runStateIdle: setting mActiveSyncContext to " + mActiveSyncContext);
  }
  mSyncStorageEngine.setActiveSync(mActiveSyncContext);
  mSyncWakeLock.setWorkSource(new WorkSource(syncAdapterInfo.uid));
  if (!activeSyncContext.bindToSyncAdapter(syncAdapterInfo)) {
    Log.e(TAG,"Bind attempt failed to " + syncAdapterInfo);
    mActiveSyncContext.close();
    mActiveSyncContext=null;
    mSyncStorageEngine.setActiveSync(mActiveSyncContext);
    runStateIdle();
    return;
  }
  mSyncWakeLock.acquire();
}
