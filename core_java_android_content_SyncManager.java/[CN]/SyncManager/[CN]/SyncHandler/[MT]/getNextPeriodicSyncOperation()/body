{
  final boolean backgroundDataUsageAllowed=getConnectivityManager().getBackgroundDataSetting();
  SyncStorageEngine.AuthorityInfo best=null;
  long bestPollTimeAbsolute=Long.MAX_VALUE;
  Bundle bestExtras=null;
  ArrayList<SyncStorageEngine.AuthorityInfo> infos=mSyncStorageEngine.getAuthorities();
  for (  SyncStorageEngine.AuthorityInfo info : infos) {
    if (!isSyncAllowed(info.account,info.authority,false,backgroundDataUsageAllowed)) {
      continue;
    }
    SyncStatusInfo status=mSyncStorageEngine.getStatusByAccountAndAuthority(info.account,info.authority);
    int i=0;
    for (    Pair<Bundle,Long> periodicSync : info.periodicSyncs) {
      long lastPollTimeAbsolute=status != null ? status.getPeriodicSyncTime(i) : 0;
      final Bundle extras=periodicSync.first;
      final Long periodInSeconds=periodicSync.second;
      long nextPollTimeAbsolute=lastPollTimeAbsolute + periodInSeconds * 1000;
      if (nextPollTimeAbsolute < bestPollTimeAbsolute) {
        best=info;
        bestPollTimeAbsolute=nextPollTimeAbsolute;
        bestExtras=extras;
      }
      i++;
    }
  }
  if (best == null) {
    return null;
  }
  final long nowAbsolute=System.currentTimeMillis();
  final SyncOperation syncOperation=new SyncOperation(best.account,SyncStorageEngine.SOURCE_PERIODIC,best.authority,bestExtras,0);
  syncOperation.earliestRunTime=SystemClock.elapsedRealtime() + (bestPollTimeAbsolute - nowAbsolute);
  if (syncOperation.earliestRunTime < 0) {
    syncOperation.earliestRunTime=0;
  }
  return syncOperation;
}
