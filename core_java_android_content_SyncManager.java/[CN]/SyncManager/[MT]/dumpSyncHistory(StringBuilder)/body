{
  Cursor c=mSyncStorageEngine.query(Sync.History.CONTENT_URI,null,"event=?",new String[]{String.valueOf(Sync.History.EVENT_STOP)},Sync.HistoryColumns.EVENT_TIME + " desc");
  try {
    long numSyncsLastHour=0, durationLastHour=0;
    long numSyncsLastDay=0, durationLastDay=0;
    long numSyncsLastWeek=0, durationLastWeek=0;
    long numSyncsLast4Weeks=0, durationLast4Weeks=0;
    long numSyncsTotal=0, durationTotal=0;
    long now=System.currentTimeMillis();
    int indexEventTime=c.getColumnIndexOrThrow(Sync.History.EVENT_TIME);
    int indexElapsedTime=c.getColumnIndexOrThrow(Sync.History.ELAPSED_TIME);
    while (c.moveToNext()) {
      long duration=c.getLong(indexElapsedTime);
      long endTime=c.getLong(indexEventTime) + duration;
      long millisSinceStart=now - endTime;
      numSyncsTotal++;
      durationTotal+=duration;
      if (millisSinceStart < MILLIS_IN_HOUR) {
        numSyncsLastHour++;
        durationLastHour+=duration;
      }
      if (millisSinceStart < MILLIS_IN_DAY) {
        numSyncsLastDay++;
        durationLastDay+=duration;
      }
      if (millisSinceStart < MILLIS_IN_WEEK) {
        numSyncsLastWeek++;
        durationLastWeek+=duration;
      }
      if (millisSinceStart < MILLIS_IN_4WEEKS) {
        numSyncsLast4Weeks++;
        durationLast4Weeks+=duration;
      }
    }
    dumpSyncIntervalHeader(sb);
    dumpSyncInterval(sb,"hour",MILLIS_IN_HOUR,numSyncsLastHour,durationLastHour);
    dumpSyncInterval(sb,"day",MILLIS_IN_DAY,numSyncsLastDay,durationLastDay);
    dumpSyncInterval(sb,"week",MILLIS_IN_WEEK,numSyncsLastWeek,durationLastWeek);
    dumpSyncInterval(sb,"4 weeks",MILLIS_IN_4WEEKS,numSyncsLast4Weeks,durationLast4Weeks);
    dumpSyncInterval(sb,"total",0,numSyncsTotal,durationTotal);
    dumpSyncIntervalFooter(sb);
  }
  finally {
    c.close();
  }
}
