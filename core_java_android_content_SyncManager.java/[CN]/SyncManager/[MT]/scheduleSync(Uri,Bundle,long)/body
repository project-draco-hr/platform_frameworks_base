{
  boolean isLoggable=Log.isLoggable(TAG,Log.VERBOSE);
  if (isLoggable) {
    Log.v(TAG,"scheduleSync:" + " delay " + delay + ", url "+ ((url == null) ? "(null)" : url)+ ", extras "+ ((extras == null) ? "(null)" : extras));
  }
  if (!isSyncEnabled()) {
    if (isLoggable) {
      Log.v(TAG,"not syncing because sync is disabled");
    }
    setStatusText("Sync is disabled.");
    return;
  }
  if (mAccounts == null)   setStatusText("The accounts aren't known yet.");
  if (!mDataConnectionIsConnected)   setStatusText("No data connection");
  if (mStorageIsLow)   setStatusText("Memory low");
  if (extras == null)   extras=new Bundle();
  Boolean expedited=extras.getBoolean(ContentResolver.SYNC_EXTRAS_EXPEDITED,false);
  if (expedited) {
    delay=-1;
  }
  Account[] accounts;
  Account accountFromExtras=extras.getParcelable(ContentResolver.SYNC_EXTRAS_ACCOUNT);
  if (accountFromExtras != null) {
    accounts=new Account[]{accountFromExtras};
  }
 else {
    accounts=mAccounts;
    if (accounts == null) {
      if (isLoggable) {
        Log.v(TAG,"scheduleSync: no accounts yet, dropping");
      }
      return;
    }
    if (accounts.length == 0) {
      if (isLoggable) {
        Log.v(TAG,"scheduleSync: no accounts configured, dropping");
      }
      setStatusText("No accounts are configured.");
      return;
    }
  }
  final boolean uploadOnly=extras.getBoolean(ContentResolver.SYNC_EXTRAS_UPLOAD,false);
  final boolean force=extras.getBoolean(ContentResolver.SYNC_EXTRAS_FORCE,false);
  int source;
  if (uploadOnly) {
    source=Sync.History.SOURCE_LOCAL;
  }
 else   if (force) {
    source=Sync.History.SOURCE_USER;
  }
 else   if (url == null) {
    source=Sync.History.SOURCE_POLL;
  }
 else {
    source=Sync.History.SOURCE_SERVER;
  }
  Set<String> syncableAuthorities=new HashSet<String>();
  for (  RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapter : mSyncAdapters.getAllServices()) {
    syncableAuthorities.add(syncAdapter.type.authority);
  }
  if (url != null) {
    boolean isSyncable=syncableAuthorities.contains(url.getAuthority());
    syncableAuthorities.clear();
    if (isSyncable)     syncableAuthorities.add(url.getAuthority());
  }
  for (  String authority : syncableAuthorities) {
    for (    Account account : accounts) {
      if (mSyncAdapters.getServiceInfo(new SyncAdapterType(authority,account.mType)) != null) {
        scheduleSyncOperation(new SyncOperation(account,source,authority,extras,delay));
        if ("calendar".equals(authority)) {
          break;
        }
      }
    }
  }
}
