{
  boolean isLoggable=Log.isLoggable(TAG,Log.VERBOSE);
  if (!isSyncEnabled()) {
    if (isLoggable) {
      Log.v(TAG,"not syncing because sync is disabled");
    }
    return;
  }
  final boolean backgroundDataUsageAllowed=!mBootCompleted || getConnectivityManager().getBackgroundDataSetting();
  if (extras == null)   extras=new Bundle();
  Boolean expedited=extras.getBoolean(ContentResolver.SYNC_EXTRAS_EXPEDITED,false);
  if (expedited) {
    delay=-1;
  }
  Account[] accounts;
  if (requestedAccount != null) {
    accounts=new Account[]{requestedAccount};
  }
 else {
    accounts=mAccounts;
    if (accounts.length == 0) {
      if (isLoggable) {
        Log.v(TAG,"scheduleSync: no accounts configured, dropping");
      }
      return;
    }
  }
  final boolean uploadOnly=extras.getBoolean(ContentResolver.SYNC_EXTRAS_UPLOAD,false);
  final boolean manualSync=extras.getBoolean(ContentResolver.SYNC_EXTRAS_MANUAL,false);
  if (manualSync) {
    extras.putBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_BACKOFF,true);
    extras.putBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_SETTINGS,true);
  }
  final boolean ignoreSettings=extras.getBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_SETTINGS,false);
  int source;
  if (uploadOnly) {
    source=SyncStorageEngine.SOURCE_LOCAL;
  }
 else   if (manualSync) {
    source=SyncStorageEngine.SOURCE_USER;
  }
 else   if (requestedAuthority == null) {
    source=SyncStorageEngine.SOURCE_POLL;
  }
 else {
    source=SyncStorageEngine.SOURCE_SERVER;
  }
  final HashSet<String> syncableAuthorities=new HashSet<String>();
  for (  RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapter : mSyncAdapters.getAllServices()) {
    syncableAuthorities.add(syncAdapter.type.authority);
  }
  if (requestedAuthority != null) {
    final boolean hasSyncAdapter=syncableAuthorities.contains(requestedAuthority);
    syncableAuthorities.clear();
    if (hasSyncAdapter)     syncableAuthorities.add(requestedAuthority);
  }
  final boolean masterSyncAutomatically=mSyncStorageEngine.getMasterSyncAutomatically();
  for (  String authority : syncableAuthorities) {
    for (    Account account : accounts) {
      int isSyncable=mSyncStorageEngine.getIsSyncable(account,authority);
      if (isSyncable == 0) {
        continue;
      }
      if (onlyThoseWithUnkownSyncableState && isSyncable >= 0) {
        continue;
      }
      final RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapterInfo=mSyncAdapters.getServiceInfo(SyncAdapterType.newKey(authority,account.type));
      if (syncAdapterInfo != null) {
        if (!syncAdapterInfo.type.supportsUploading() && uploadOnly) {
          continue;
        }
        if (isSyncable < 0) {
          initializeSyncAdapter(account,authority);
          continue;
        }
        final boolean syncAutomatically=masterSyncAutomatically && mSyncStorageEngine.getSyncAutomatically(account,authority);
        boolean syncAllowed=ignoreSettings || (backgroundDataUsageAllowed && syncAutomatically);
        if (!syncAllowed) {
          if (isLoggable) {
            Log.d(TAG,"scheduleSync: sync of " + account + ", "+ authority+ " is not allowed, dropping request");
          }
          continue;
        }
        if (isLoggable) {
          Log.v(TAG,"scheduleSync:" + " delay " + delay + ", source "+ source+ ", account "+ account+ ", authority "+ authority+ ", extras "+ extras);
        }
        scheduleSyncOperation(new SyncOperation(account,source,authority,extras,delay));
      }
    }
  }
}
