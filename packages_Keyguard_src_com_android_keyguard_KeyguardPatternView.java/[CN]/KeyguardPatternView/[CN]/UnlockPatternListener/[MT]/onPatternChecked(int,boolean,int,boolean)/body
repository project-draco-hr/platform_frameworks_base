{
  boolean dismissKeyguard=KeyguardUpdateMonitor.getCurrentUser() == userId;
  if (matched) {
    mCallback.reportUnlockAttempt(userId,true,0);
    if (dismissKeyguard) {
      mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Correct);
      mCallback.dismiss(true);
    }
  }
 else {
    mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Wrong);
    if (isValidPattern) {
      mCallback.reportUnlockAttempt(userId,false,timeoutMs);
      if (timeoutMs > 0) {
        long deadline=mLockPatternUtils.setLockoutAttemptDeadline(userId,timeoutMs);
        handleAttemptLockout(deadline);
      }
    }
    if (timeoutMs == 0) {
      mSecurityMessageDisplay.setMessage(R.string.kg_wrong_pattern,true);
      mLockPatternView.postDelayed(mCancelPatternRunnable,PATTERN_CLEAR_TIMEOUT_MS);
    }
  }
}
