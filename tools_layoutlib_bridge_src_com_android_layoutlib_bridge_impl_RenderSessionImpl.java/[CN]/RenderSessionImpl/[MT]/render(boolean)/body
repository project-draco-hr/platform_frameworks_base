{
  checkLock();
  try {
    if (mViewRoot == null) {
      return ERROR_NOT_INFLATED.createResult();
    }
    int w_spec, h_spec;
    RenderingMode renderingMode=mParams.getRenderingMode();
    boolean newRenderSize=false;
    if (mMeasuredScreenWidth == -1) {
      newRenderSize=true;
      mMeasuredScreenWidth=mParams.getScreenWidth();
      mMeasuredScreenHeight=mParams.getScreenHeight() - mTotalBarSize;
      if (renderingMode != RenderingMode.NORMAL) {
        w_spec=MeasureSpec.makeMeasureSpec(mMeasuredScreenWidth,renderingMode.isHorizExpand() ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY);
        h_spec=MeasureSpec.makeMeasureSpec(mMeasuredScreenHeight,renderingMode.isVertExpand() ? MeasureSpec.UNSPECIFIED : MeasureSpec.EXACTLY);
        mViewRoot.measure(w_spec,h_spec);
        if (renderingMode.isHorizExpand()) {
          int neededWidth=mViewRoot.getChildAt(0).getMeasuredWidth();
          if (neededWidth > mMeasuredScreenWidth) {
            mMeasuredScreenWidth=neededWidth;
          }
        }
        if (renderingMode.isVertExpand()) {
          int neededHeight=mViewRoot.getChildAt(0).getMeasuredHeight();
          if (neededHeight > mMeasuredScreenHeight) {
            mMeasuredScreenHeight=neededHeight;
          }
        }
      }
    }
    w_spec=MeasureSpec.makeMeasureSpec(mMeasuredScreenWidth,MeasureSpec.EXACTLY);
    h_spec=MeasureSpec.makeMeasureSpec(mMeasuredScreenHeight,MeasureSpec.EXACTLY);
    mViewRoot.measure(w_spec,h_spec);
    mViewRoot.layout(0,0,mMeasuredScreenWidth,mMeasuredScreenHeight);
    mViewRoot.mAttachInfo.mTreeObserver.dispatchOnPreDraw();
    boolean newImage=false;
    if (newRenderSize || mCanvas == null) {
      if (mParams.getImageFactory() != null) {
        mImage=mParams.getImageFactory().getImage(mMeasuredScreenWidth,mMeasuredScreenHeight + mTotalBarSize);
      }
 else {
        mImage=new BufferedImage(mMeasuredScreenWidth,mMeasuredScreenHeight + mTotalBarSize,BufferedImage.TYPE_INT_ARGB);
        newImage=true;
      }
      if (mParams.isBgColorOverridden()) {
        newImage=true;
        Graphics2D gc=mImage.createGraphics();
        gc.setColor(new Color(mParams.getOverrideBgColor(),true));
        gc.setComposite(AlphaComposite.Src);
        gc.fillRect(0,0,mMeasuredScreenWidth,mMeasuredScreenHeight + mTotalBarSize);
        gc.dispose();
      }
      Bitmap bitmap=Bitmap_Delegate.createBitmap(mImage,true,Density.getEnum(mParams.getDensity()));
      mCanvas=new Canvas(bitmap);
      mCanvas.setDensity(mParams.getDensity());
      mCanvas.translate(0,mTopOffset);
    }
    if (freshRender && newImage == false) {
      Graphics2D gc=mImage.createGraphics();
      gc.setComposite(AlphaComposite.Src);
      if (mStatusBarSize > 0) {
        gc.setColor(new Color(0xFF3C3C3C,true));
        gc.fillRect(0,0,mMeasuredScreenWidth,mStatusBarSize);
      }
      if (mTopBarSize > 0) {
        gc.setColor(new Color(0xFF7F7F7F,true));
        gc.fillRect(0,mStatusBarSize,mMeasuredScreenWidth,mTopOffset);
      }
      gc.setColor(new Color(0x00000000,true));
      gc.fillRect(0,mTopOffset,mMeasuredScreenWidth,mMeasuredScreenHeight + mTopOffset);
      if (mSystemBarSize > 0) {
        gc.setColor(new Color(0xFF3C3C3C,true));
        gc.fillRect(0,mMeasuredScreenHeight + mTopOffset,mMeasuredScreenWidth,mMeasuredScreenHeight + mTotalBarSize);
      }
      gc.dispose();
    }
    mViewRoot.draw(mCanvas);
    mViewInfoList=visitAllChildren((ViewGroup)mViewRoot,mContext,mTopOffset);
    return SUCCESS.createResult();
  }
 catch (  Throwable e) {
    Throwable t=e;
    while (t.getCause() != null) {
      t=t.getCause();
    }
    return ERROR_UNKNOWN.createResult(t.getMessage(),t);
  }
}
