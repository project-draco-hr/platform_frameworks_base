{
  final int[] progressUpdate=new int[100];
  final Semaphore blockTillPreviewCompletes=new Semaphore(1);
  final long mDuration=duration;
  mVideoEditor.generatePreview(new MediaProcessingProgressListener(){
    int i=0;
    public void onProgress(    Object item,    int action,    int progress){
      progressUpdate[i++]=progress;
    }
  }
);
  mVideoEditorHelper.checkProgressCBValues(progressUpdate);
  final SurfaceHolder surfaceHolder=MediaFrameworkTest.mSurfaceView.getHolder();
  blockTillPreviewCompletes.acquire();
  try {
    mVideoEditor.startPreview(surfaceHolder,startMs,endMs,loop,1,new PreviewProgressListener(){
      public void onProgress(      VideoEditor videoEditor,      long timeMs,      boolean end){
        if ((mDuration != 0) && (timeMs >= mDuration)) {
          blockTillPreviewCompletes.release();
        }
 else         if (end == true) {
          blockTillPreviewCompletes.release();
        }
      }
    }
);
  }
 catch (  Exception e) {
    Log.e("VideoEditorPreviewTest","Exception thrown during preview");
    blockTillPreviewCompletes.release();
  }
  blockTillPreviewCompletes.acquire();
  mVideoEditor.stopPreview();
  blockTillPreviewCompletes.release();
}
