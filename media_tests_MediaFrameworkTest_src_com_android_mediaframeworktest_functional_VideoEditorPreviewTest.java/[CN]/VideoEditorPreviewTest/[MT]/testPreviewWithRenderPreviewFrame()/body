{
  final String videoItemFileName=INPUT_FILE_PATH + "H264_BP_640x480_30fps_256kbps_1_17.mp4";
  final Semaphore blockTillPreviewCompletes=new Semaphore(1);
  boolean flagForException=false;
  OverlayData overlayData1=new OverlayData();
  previewStart=false;
  previewStop=false;
  final String overlayFilename1=INPUT_FILE_PATH + "IMG_640x480_Overlay1.png";
  final MediaVideoItem mediaVideoItem=mVideoEditorHelper.createMediaItem(mVideoEditor,"m1",videoItemFileName,MediaItem.RENDERING_MODE_BLACK_BORDER);
  mVideoEditor.addMediaItem(mediaVideoItem);
  final EffectColor effectPink=mVideoEditorHelper.createEffectItem(mediaVideoItem,"effectNegativeOnMvi",1000,3000,EffectColor.TYPE_COLOR,EffectColor.PINK);
  mediaVideoItem.addEffect(effectPink);
  mVideoEditor.generatePreview(new MediaProcessingProgressListener(){
    public void onProgress(    Object item,    int action,    int progress){
    }
  }
);
  final SurfaceHolder surfaceHolder=MediaFrameworkTest.mSurfaceView.getHolder();
  assertEquals("Render preview Frame at 5 Sec",5000,mVideoEditor.renderPreviewFrame(surfaceHolder,5000,overlayData1));
  assertEquals("Render preview Frame at 7 Sec",7000,mVideoEditor.renderPreviewFrame(surfaceHolder,7000,overlayData1));
  long waitingTime=minWaitingTime + (mVideoEditor.getDuration() - 5000);
  blockTillPreviewCompletes.acquire();
  try {
    mVideoEditor.startPreview(surfaceHolder,5000,-1,false,1,new PreviewProgressListener(){
      public void onProgress(      VideoEditor videoEditor,      long timeMs,      OverlayData overlayData){
      }
      public void onStart(      VideoEditor videoEditor){
        setPreviewStart();
      }
      public void onStop(      VideoEditor videoEditor){
        setPreviewStop();
        blockTillPreviewCompletes.release();
      }
    }
);
  }
 catch (  Exception e) {
    blockTillPreviewCompletes.release();
  }
  blockTillPreviewCompletes.tryAcquire(waitingTime,TimeUnit.MILLISECONDS);
  mVideoEditor.stopPreview();
  assertTrue("Preview Failed to start",previewStart);
  assertTrue("Preview Failed to stop",previewStop);
  blockTillPreviewCompletes.release();
}
