{
  if (!mPackageInfo.isShadow()) {
    return;
  }
  if (!s.isPackageInstalled(mPackageName,mPackageUserId)) {
    if (ShortcutService.DEBUG) {
      Slog.d(TAG,String.format("Package still not installed: %s user=%d",mPackageName,mPackageUserId));
    }
    return;
  }
  if (!mPackageInfo.hasSignatures()) {
    s.wtf("Attempted to restore package " + mPackageName + ", user="+ mPackageUserId+ " but signatures not found in the restore data.");
    onRestoreBlocked(s);
    return;
  }
  final PackageInfo pi=s.getPackageInfoWithSignatures(mPackageName,mPackageUserId);
  if (!mPackageInfo.canRestoreTo(s,pi)) {
    onRestoreBlocked(s);
    return;
  }
  if (ShortcutService.DEBUG) {
    Slog.d(TAG,String.format("Restored package: %s/%d on user %d",mPackageName,mPackageUserId,getOwnerUserId()));
  }
  onRestored(s);
  mPackageInfo.setShadow(false);
  s.scheduleSaveUser(mPackageUserId);
}
