{
  Preconditions.checkNotNull(listener,"Attempted to register a 'null' listener.");
  if (!isSupported()) {
    Log.e(mTag,"Refused to add listener, the feature is not supported.");
    return false;
  }
  IBinder binder=listener.asBinder();
  LinkedListener deathListener=new LinkedListener(listener);
synchronized (mListenerMap) {
    if (mListenerMap.containsKey(binder)) {
      return true;
    }
    try {
      binder.linkToDeath(deathListener,0);
    }
 catch (    RemoteException e) {
      Log.e(mTag,"Remote listener already died.",e);
      return false;
    }
    mListenerMap.put(binder,deathListener);
    if (mListenerMap.size() == 1) {
      if (!registerWithService()) {
        Log.e(mTag,"RegisterWithService failed, listener will be removed.");
        removeListener(listener);
        return false;
      }
    }
  }
  return true;
}
