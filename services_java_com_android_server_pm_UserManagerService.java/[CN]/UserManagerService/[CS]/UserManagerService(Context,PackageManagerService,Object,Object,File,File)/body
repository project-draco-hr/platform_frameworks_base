{
  mContext=context;
  mPm=pm;
  mInstallLock=installLock;
  mPackagesLock=packagesLock;
  mHandler=new Handler();
synchronized (mInstallLock) {
synchronized (mPackagesLock) {
      mUsersDir=new File(dataDir,USER_INFO_DIR);
      mUsersDir.mkdirs();
      File userZeroDir=new File(mUsersDir,"0");
      userZeroDir.mkdirs();
      mBaseUserPath=baseUserPath;
      FileUtils.setPermissions(mUsersDir.toString(),FileUtils.S_IRWXU | FileUtils.S_IRWXG | FileUtils.S_IROTH| FileUtils.S_IXOTH,-1,-1);
      mUserListFile=new File(mUsersDir,USER_LIST_FILENAME);
      readUserListLocked();
      ArrayList<UserInfo> partials=new ArrayList<UserInfo>();
      for (int i=0; i < mUsers.size(); i++) {
        UserInfo ui=mUsers.valueAt(i);
        if (ui.partial && i != 0) {
          partials.add(ui);
        }
      }
      for (int i=0; i < partials.size(); i++) {
        UserInfo ui=partials.get(i);
        Slog.w(LOG_TAG,"Removing partially created user #" + i + " (name="+ ui.name+ ")");
        removeUserStateLocked(ui.id);
      }
      sInstance=this;
    }
  }
}
