{
  int userVersion=mUserVersion;
  if (userVersion < 1) {
    UserInfo user=mUsers.get(UserHandle.USER_OWNER);
    if ("Primary".equals(user.name)) {
      user.name=mContext.getResources().getString(com.android.internal.R.string.owner_name);
      writeUserLocked(user);
    }
    userVersion=1;
  }
  if (userVersion < 2) {
    UserInfo user=mUsers.get(UserHandle.USER_OWNER);
    if ((user.flags & UserInfo.FLAG_INITIALIZED) == 0) {
      user.flags|=UserInfo.FLAG_INITIALIZED;
      writeUserLocked(user);
    }
    userVersion=2;
  }
  if (userVersion < 3) {
    for (int i=0; i < mRestrictionsPinStates.size(); i++) {
      int userId=mRestrictionsPinStates.keyAt(i);
      RestrictionsPinState state=mRestrictionsPinStates.valueAt(i);
      if (state.salt != 0 && state.pinHash != null) {
        removeRestrictionsForUser(userId,false);
      }
    }
    userVersion=3;
  }
  if (userVersion < 4) {
    mUnblockAppsTemp=true;
    userVersion=4;
  }
  if (userVersion < USER_VERSION) {
    Slog.w(LOG_TAG,"User version " + mUserVersion + " didn't upgrade as expected to "+ USER_VERSION);
  }
 else {
    mUserVersion=userVersion;
    writeUserListLocked();
  }
}
