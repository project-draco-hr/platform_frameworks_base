{
  checkManageUsersPermission("Only the system can remove users");
synchronized (mInstallLock) {
synchronized (mPackagesLock) {
      final UserInfo user=mUsers.get(userHandle);
      if (userHandle == 0 || user == null) {
        return false;
      }
      mPm.cleanUpUserLILPw(userHandle);
      mUsers.remove(userHandle);
      AtomicFile userFile=new AtomicFile(new File(mUsersDir,userHandle + ".xml"));
      userFile.delete();
      writeUserListLocked();
      updateUserIdsLocked();
    }
  }
  Intent addedIntent=new Intent(Intent.ACTION_USER_REMOVED);
  addedIntent.putExtra(Intent.EXTRA_USER_HANDLE,userHandle);
  mContext.sendBroadcast(addedIntent,android.Manifest.permission.MANAGE_USERS);
  return true;
}
