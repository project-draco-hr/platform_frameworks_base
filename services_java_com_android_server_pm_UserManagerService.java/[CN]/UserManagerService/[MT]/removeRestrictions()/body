{
  checkManageUsersPermission("Only system can remove restrictions");
  final int userHandle=UserHandle.getCallingUserId();
synchronized (mPackagesLock) {
    setUserRestrictions(new Bundle(),userHandle);
    changeRestrictionsPin(null);
    cleanAppRestrictions(userHandle,true);
  }
  mHandler.post(new Runnable(){
    @Override public void run(){
      List<ApplicationInfo> apps=mPm.getInstalledApplications(PackageManager.GET_UNINSTALLED_PACKAGES,userHandle).getList();
      final long ident=Binder.clearCallingIdentity();
      try {
        for (        ApplicationInfo appInfo : apps) {
          if ((appInfo.flags & ApplicationInfo.FLAG_INSTALLED) != 0 && (appInfo.flags & ApplicationInfo.FLAG_BLOCKED) != 0) {
            mPm.setApplicationBlockedSettingAsUser(appInfo.packageName,false,userHandle);
          }
        }
      }
  finally {
        Binder.restoreCallingIdentity(ident);
      }
    }
  }
);
}
