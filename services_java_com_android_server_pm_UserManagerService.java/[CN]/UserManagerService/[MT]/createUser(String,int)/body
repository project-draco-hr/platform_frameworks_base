{
  enforceSystemOrRoot("Only the system can create users");
  int userId=getNextAvailableId();
  UserInfo userInfo=new UserInfo(userId,name,null,flags);
  File userPath=new File(mBaseUserPath,Integer.toString(userId));
  if (!createPackageFolders(userId,userPath)) {
    return null;
  }
synchronized (mUsers) {
    mUsers.put(userId,userInfo);
    writeUserListLocked();
    writeUserLocked(userInfo);
    updateUserIdsLocked();
  }
  if (userInfo != null) {
    Intent addedIntent=new Intent(Intent.ACTION_USER_ADDED);
    addedIntent.putExtra(Intent.EXTRA_USERID,userInfo.id);
    mContext.sendBroadcast(addedIntent,android.Manifest.permission.MANAGE_ACCOUNTS);
  }
  return userInfo;
}
