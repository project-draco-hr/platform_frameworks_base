{
  checkManageUsersPermission("Only system can verify the restrictions pin");
  int userId=UserHandle.getCallingUserId();
synchronized (mPackagesLock) {
    RestrictionsPinState pinState=mRestrictionsPinStates.get(userId);
    if (pinState == null || pinState.salt == 0 || pinState.pinHash == null) {
      return UserManager.PIN_VERIFICATION_FAILED_NOT_SET;
    }
 else     if (pin == null) {
      int waitTime=getRemainingTimeForPinAttempt(pinState);
      Slog.d(LOG_TAG,"Remaining waittime peek=" + waitTime);
      return waitTime;
    }
 else {
      int waitTime=getRemainingTimeForPinAttempt(pinState);
      Slog.d(LOG_TAG,"Remaining waittime=" + waitTime);
      if (waitTime > 0) {
        return waitTime;
      }
      if (passwordToHash(pin,pinState.salt).equals(pinState.pinHash)) {
        pinState.failedAttempts=0;
        writeUserLocked(mUsers.get(userId));
        return UserManager.PIN_VERIFICATION_SUCCESS;
      }
 else {
        pinState.failedAttempts++;
        pinState.lastAttemptTime=System.currentTimeMillis();
        writeUserLocked(mUsers.get(userId));
        return waitTime;
      }
    }
  }
}
