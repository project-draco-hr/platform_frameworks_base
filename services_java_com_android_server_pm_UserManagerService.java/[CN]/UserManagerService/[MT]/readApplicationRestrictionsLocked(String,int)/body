{
  final Bundle restrictions=new Bundle();
  final ArrayList<String> values=new ArrayList<String>();
  FileInputStream fis=null;
  try {
    AtomicFile restrictionsFile=new AtomicFile(new File(Environment.getUserSystemDirectory(userId),packageToRestrictionsFileName(packageName)));
    fis=restrictionsFile.openRead();
    XmlPullParser parser=Xml.newPullParser();
    parser.setInput(fis,null);
    int type;
    while ((type=parser.next()) != XmlPullParser.START_TAG && type != XmlPullParser.END_DOCUMENT) {
      ;
    }
    if (type != XmlPullParser.START_TAG) {
      Slog.e(LOG_TAG,"Unable to read restrictions file " + restrictionsFile.getBaseFile());
      return restrictions;
    }
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT) {
      if (type == XmlPullParser.START_TAG && parser.getName().equals(TAG_ENTRY)) {
        String key=parser.getAttributeValue(null,ATTR_KEY);
        String valType=parser.getAttributeValue(null,ATTR_VALUE_TYPE);
        String multiple=parser.getAttributeValue(null,ATTR_MULTIPLE);
        if (multiple != null) {
          int count=Integer.parseInt(multiple);
          while (count > 0 && (type=parser.next()) != XmlPullParser.END_DOCUMENT) {
            if (type == XmlPullParser.START_TAG && parser.getName().equals(TAG_VALUE)) {
              values.add(parser.nextText().trim());
              count--;
            }
          }
          String[] valueStrings=new String[values.size()];
          values.toArray(valueStrings);
          restrictions.putStringArray(key,valueStrings);
        }
 else         if (ATTR_TYPE_BOOLEAN.equals(valType)) {
          restrictions.putBoolean(key,Boolean.parseBoolean(parser.nextText().trim()));
        }
 else {
          String value=parser.nextText().trim();
          restrictions.putString(key,value);
        }
      }
    }
  }
 catch (  IOException ioe) {
  }
catch (  XmlPullParserException pe) {
  }
 finally {
    if (fis != null) {
      try {
        fis.close();
      }
 catch (      IOException e) {
      }
    }
  }
  return restrictions;
}
