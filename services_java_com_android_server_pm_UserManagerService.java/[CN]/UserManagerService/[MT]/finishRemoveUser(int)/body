{
synchronized (mInstallLock) {
synchronized (mPackagesLock) {
      mPm.cleanUpUserLILPw(userHandle);
      mUsers.remove(userHandle);
      AtomicFile userFile=new AtomicFile(new File(mUsersDir,userHandle + ".xml"));
      userFile.delete();
      writeUserListLocked();
      updateUserIdsLocked();
      removeDirectoryRecursive(Environment.getUserSystemDirectory(userHandle));
    }
  }
  long ident=Binder.clearCallingIdentity();
  try {
    Intent addedIntent=new Intent(Intent.ACTION_USER_REMOVED);
    addedIntent.putExtra(Intent.EXTRA_USER_HANDLE,userHandle);
    mContext.sendBroadcastAsUser(addedIntent,UserHandle.ALL,android.Manifest.permission.MANAGE_USERS);
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
