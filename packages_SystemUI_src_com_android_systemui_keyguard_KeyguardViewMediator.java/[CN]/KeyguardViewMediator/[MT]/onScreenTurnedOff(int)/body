{
synchronized (this) {
    mScreenOn=false;
    if (DEBUG)     Log.d(TAG,"onScreenTurnedOff(" + why + ")");
    resetKeyguardDonePendingLocked();
    mHideAnimationRun=false;
    int currentUser=mLockPatternUtils.getCurrentUser();
    final boolean lockImmediately=mLockPatternUtils.getPowerButtonInstantlyLocks(currentUser) || !mLockPatternUtils.isSecure(currentUser);
    notifyScreenOffLocked();
    if (mExitSecureCallback != null) {
      if (DEBUG)       Log.d(TAG,"pending exit secure callback cancelled");
      try {
        mExitSecureCallback.onKeyguardExitResult(false);
      }
 catch (      RemoteException e) {
        Slog.w(TAG,"Failed to call onKeyguardExitResult(false)",e);
      }
      mExitSecureCallback=null;
      if (!mExternallyEnabled) {
        hideLocked();
      }
    }
 else     if (mShowing) {
      resetStateLocked();
    }
 else     if (why == WindowManagerPolicy.OFF_BECAUSE_OF_TIMEOUT || (why == WindowManagerPolicy.OFF_BECAUSE_OF_USER && !lockImmediately)) {
      doKeyguardLaterLocked();
    }
 else {
      doKeyguardLocked(null);
    }
  }
  KeyguardUpdateMonitor.getInstance(mContext).dispatchScreenTurnedOff(why);
}
