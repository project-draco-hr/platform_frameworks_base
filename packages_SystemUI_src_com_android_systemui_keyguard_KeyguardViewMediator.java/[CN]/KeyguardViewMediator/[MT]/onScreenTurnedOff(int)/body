{
synchronized (this) {
    mScreenOn=false;
    if (DEBUG)     Log.d(TAG,"onScreenTurnedOff(" + why + ")");
    mKeyguardDonePending=false;
    final boolean lockImmediately=mLockPatternUtils.getPowerButtonInstantlyLocks() || !mLockPatternUtils.isSecure();
    if (mExitSecureCallback != null) {
      if (DEBUG)       Log.d(TAG,"pending exit secure callback cancelled");
      try {
        mExitSecureCallback.onKeyguardExitResult(false);
      }
 catch (      RemoteException e) {
        Slog.w(TAG,"Failed to call onKeyguardExitResult(false)",e);
      }
      mExitSecureCallback=null;
      if (!mExternallyEnabled) {
        hideLocked();
      }
    }
 else     if (mShowing) {
      notifyScreenOffLocked();
      resetStateLocked();
    }
 else     if (why == WindowManagerPolicy.OFF_BECAUSE_OF_TIMEOUT || (why == WindowManagerPolicy.OFF_BECAUSE_OF_USER && !lockImmediately)) {
      doKeyguardLaterLocked();
    }
 else {
      doKeyguardLocked(null);
    }
    if (ENABLE_ANALYTICS && mKeyguardAnalytics != null) {
      mKeyguardAnalytics.getCallback().onScreenOff();
    }
  }
  KeyguardUpdateMonitor.getInstance(mContext).dispatchScreenTurndOff(why);
}
