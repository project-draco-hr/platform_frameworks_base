{
  mPM=(PowerManager)mContext.getSystemService(Context.POWER_SERVICE);
  mWM=WindowManagerGlobal.getWindowManagerService();
  mTrustManager=(TrustManager)mContext.getSystemService(Context.TRUST_SERVICE);
  mShowKeyguardWakeLock=mPM.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"show keyguard");
  mShowKeyguardWakeLock.setReferenceCounted(false);
  mContext.registerReceiver(mBroadcastReceiver,new IntentFilter(DELAYED_KEYGUARD_ACTION));
  mContext.registerReceiver(mBroadcastReceiver,new IntentFilter(DELAYED_LOCK_PROFILE_ACTION));
  mKeyguardDisplayManager=new KeyguardDisplayManager(mContext);
  mAlarmManager=(AlarmManager)mContext.getSystemService(Context.ALARM_SERVICE);
  mUpdateMonitor=KeyguardUpdateMonitor.getInstance(mContext);
  mLockPatternUtils=new LockPatternUtils(mContext);
  KeyguardUpdateMonitor.setCurrentUser(ActivityManager.getCurrentUser());
  setShowingLocked(!shouldWaitForProvisioning() && !mLockPatternUtils.isLockScreenDisabled(KeyguardUpdateMonitor.getCurrentUser()));
  updateInputRestrictedLocked();
  mTrustManager.reportKeyguardShowingChanged();
  mStatusBarKeyguardViewManager=SystemUIFactory.getInstance().createStatusBarKeyguardViewManager(mContext,mViewMediatorCallback,mLockPatternUtils);
  final ContentResolver cr=mContext.getContentResolver();
  mDeviceInteractive=mPM.isInteractive();
  mLockSounds=new SoundPool(1,AudioManager.STREAM_SYSTEM,0);
  String soundPath=Settings.Global.getString(cr,Settings.Global.LOCK_SOUND);
  if (soundPath != null) {
    mLockSoundId=mLockSounds.load(soundPath,1);
  }
  if (soundPath == null || mLockSoundId == 0) {
    Log.w(TAG,"failed to load lock sound from " + soundPath);
  }
  soundPath=Settings.Global.getString(cr,Settings.Global.UNLOCK_SOUND);
  if (soundPath != null) {
    mUnlockSoundId=mLockSounds.load(soundPath,1);
  }
  if (soundPath == null || mUnlockSoundId == 0) {
    Log.w(TAG,"failed to load unlock sound from " + soundPath);
  }
  soundPath=Settings.Global.getString(cr,Settings.Global.TRUSTED_SOUND);
  if (soundPath != null) {
    mTrustedSoundId=mLockSounds.load(soundPath,1);
  }
  if (soundPath == null || mTrustedSoundId == 0) {
    Log.w(TAG,"failed to load trusted sound from " + soundPath);
  }
  int lockSoundDefaultAttenuation=mContext.getResources().getInteger(com.android.internal.R.integer.config_lockSoundVolumeDb);
  mLockSoundVolume=(float)Math.pow(10,(float)lockSoundDefaultAttenuation / 20);
  mHideAnimation=AnimationUtils.loadAnimation(mContext,com.android.internal.R.anim.lock_screen_behind_enter);
}
