{
  if (DEBUG)   Log.d(TAG,"Preparing intent for doc:" + mDocument.documentId);
  String trustedPkg=mResources.getString(R.string.trusted_quick_viewer_package);
  Intent intent=new Intent(Intent.ACTION_QUICK_VIEW);
  intent.setDataAndType(mDocument.derivedUri,mDocument.mimeType);
  intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
  if (TextUtils.isEmpty(trustedPkg)) {
    if (hasRegisteredHandler(intent)) {
      return intent;
    }
  }
 else {
    intent.setPackage(trustedPkg);
    if (hasRegisteredHandler(intent)) {
      Cursor cursor=mContext.getCursor();
      for (int i=0; i < cursor.getCount(); i++) {
        onNextItem(i,cursor);
      }
      intent.putExtra(Intent.EXTRA_INDEX,mDocumentLocation);
      intent.setClipData(mClipData);
      return intent;
    }
  }
  return null;
}
