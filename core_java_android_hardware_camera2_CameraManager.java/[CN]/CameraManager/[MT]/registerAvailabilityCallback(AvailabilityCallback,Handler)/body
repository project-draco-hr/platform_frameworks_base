{
  if (handler == null) {
    Looper looper=Looper.myLooper();
    if (looper == null) {
      throw new IllegalArgumentException("No handler given, and current thread has no looper!");
    }
    handler=new Handler(looper);
  }
synchronized (mLock) {
    Handler oldHandler=mCallbackMap.put(callback,handler);
    if (oldHandler == null) {
      mServiceListener.updateCallbackLocked(callback,handler);
    }
  }
}
