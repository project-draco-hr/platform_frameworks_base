{
  final int topBright=a.getResourceId(R.styleable.AlertDialog_topBright,R.drawable.popup_top_bright);
  final int topDark=a.getResourceId(R.styleable.AlertDialog_topDark,R.drawable.popup_top_dark);
  final int centerBright=a.getResourceId(R.styleable.AlertDialog_centerBright,R.drawable.popup_center_bright);
  final int centerDark=a.getResourceId(R.styleable.AlertDialog_centerDark,R.drawable.popup_center_dark);
  final View[] views=new View[4];
  final boolean[] light=new boolean[4];
  View lastView=null;
  boolean lastLight=false;
  int pos=0;
  if (hasTitle) {
    views[pos]=topPanel;
    light[pos]=false;
    pos++;
  }
  views[pos]=contentPanel.getVisibility() == View.GONE ? null : contentPanel;
  light[pos]=mListView != null;
  pos++;
  if (hasCustomView) {
    views[pos]=customPanel;
    light[pos]=mForceInverseBackground;
    pos++;
  }
  if (hasButtons) {
    views[pos]=buttonPanel;
    light[pos]=true;
  }
  boolean setView=false;
  for (pos=0; pos < views.length; pos++) {
    final View v=views[pos];
    if (v == null) {
      continue;
    }
    if (lastView != null) {
      if (!setView) {
        lastView.setBackgroundResource(lastLight ? topBright : topDark);
      }
 else {
        lastView.setBackgroundResource(lastLight ? centerBright : centerDark);
      }
      setView=true;
    }
    lastView=v;
    lastLight=light[pos];
  }
  if (lastView != null) {
    if (setView) {
      final int bottomBright=a.getResourceId(R.styleable.AlertDialog_bottomBright,R.drawable.popup_bottom_bright);
      final int bottomMedium=a.getResourceId(R.styleable.AlertDialog_bottomMedium,R.drawable.popup_bottom_medium);
      final int bottomDark=a.getResourceId(R.styleable.AlertDialog_bottomDark,R.drawable.popup_bottom_dark);
      lastView.setBackgroundResource(lastLight ? (hasButtons ? bottomMedium : bottomBright) : bottomDark);
    }
 else {
      final int fullBright=a.getResourceId(R.styleable.AlertDialog_fullBright,R.drawable.popup_full_bright);
      final int fullDark=a.getResourceId(R.styleable.AlertDialog_fullDark,R.drawable.popup_full_dark);
      lastView.setBackgroundResource(lastLight ? fullBright : fullDark);
    }
  }
  final ListView listView=mListView;
  if (listView != null && mAdapter != null) {
    listView.setAdapter(mAdapter);
    final int checkedItem=mCheckedItem;
    if (checkedItem > -1) {
      listView.setItemChecked(checkedItem,true);
      listView.setSelection(checkedItem);
    }
  }
}
