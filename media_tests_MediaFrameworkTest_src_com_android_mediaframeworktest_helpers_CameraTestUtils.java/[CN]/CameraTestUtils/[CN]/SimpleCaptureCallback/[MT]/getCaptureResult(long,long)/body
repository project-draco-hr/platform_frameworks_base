{
  try {
    long currentTs=-1L;
    TotalCaptureResult result;
    while (true) {
      result=mQueue.poll(timeout,TimeUnit.MILLISECONDS);
      if (result == null) {
        throw new RuntimeException("Wait for a capture result timed out in " + timeout + "ms");
      }
      currentTs=result.get(CaptureResult.SENSOR_TIMESTAMP);
      if (currentTs == timestamp) {
        return result;
      }
    }
  }
 catch (  InterruptedException e) {
    throw new UnsupportedOperationException("Unhandled interrupted exception",e);
  }
}
