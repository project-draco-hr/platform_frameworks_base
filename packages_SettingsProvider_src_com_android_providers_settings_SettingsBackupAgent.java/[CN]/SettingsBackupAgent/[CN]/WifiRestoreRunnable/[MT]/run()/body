{
  if (restoredSupplicantData != null || restoredWifiConfigFile != null) {
    if (DEBUG_BACKUP) {
      Log.v(TAG,"Starting deferred restore of wifi data");
    }
    final ContentResolver cr=getContentResolver();
    final int scanAlways=Settings.Global.getInt(cr,Settings.Global.WIFI_SCAN_ALWAYS_AVAILABLE,0);
    final int retainedWifiState=enableWifi(false);
    if (scanAlways != 0) {
      Settings.Global.putInt(cr,Settings.Global.WIFI_SCAN_ALWAYS_AVAILABLE,0);
    }
    try {
      Thread.sleep(1500);
    }
 catch (    InterruptedException e) {
    }
    if (restoredSupplicantData != null) {
      restoreWifiSupplicant(FILE_WIFI_SUPPLICANT,restoredSupplicantData,restoredSupplicantData.length);
      FileUtils.setPermissions(FILE_WIFI_SUPPLICANT,FileUtils.S_IRUSR | FileUtils.S_IWUSR | FileUtils.S_IRGRP| FileUtils.S_IWGRP,Process.myUid(),Process.WIFI_UID);
    }
    if (restoredWifiConfigFile != null) {
      restoreFileData(mWifiConfigFile,restoredWifiConfigFile,restoredWifiConfigFile.length);
    }
    if (scanAlways != 0) {
      Settings.Global.putInt(cr,Settings.Global.WIFI_SCAN_ALWAYS_AVAILABLE,scanAlways);
    }
    enableWifi(retainedWifiState == WifiManager.WIFI_STATE_ENABLED || retainedWifiState == WifiManager.WIFI_STATE_ENABLING);
  }
}
