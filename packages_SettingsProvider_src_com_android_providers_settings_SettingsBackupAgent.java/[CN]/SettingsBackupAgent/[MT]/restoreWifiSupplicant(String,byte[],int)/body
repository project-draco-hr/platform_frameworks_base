{
  try {
    WifiNetworkSettings supplicantImage=new WifiNetworkSettings();
    File supplicantFile=new File(FILE_WIFI_SUPPLICANT);
    if (supplicantFile.exists()) {
      BufferedReader in=new BufferedReader(new FileReader(FILE_WIFI_SUPPLICANT));
      supplicantImage.readNetworks(in);
      in.close();
      supplicantFile.delete();
    }
    if (size > 0) {
      char[] restoredAsBytes=new char[size];
      for (int i=0; i < size; i++)       restoredAsBytes[i]=(char)bytes[i];
      BufferedReader in=new BufferedReader(new CharArrayReader(restoredAsBytes));
      supplicantImage.readNetworks(in);
      if (DEBUG_BACKUP) {
        Log.v(TAG,"Final AP list:");
        supplicantImage.dump();
      }
    }
    BufferedWriter bw=new BufferedWriter(new FileWriter(FILE_WIFI_SUPPLICANT));
    copyWifiSupplicantTemplate(bw);
    supplicantImage.write(bw);
    bw.close();
  }
 catch (  IOException ioe) {
    Log.w(TAG,"Couldn't restore " + filename);
  }
}
