{
  byte[] systemSettingsData=getSystemSettings();
  byte[] secureSettingsData=getSecureSettings();
  byte[] globalSettingsData=getGlobalSettings();
  byte[] lockSettingsData=getLockSettings();
  byte[] locale=mSettingsHelper.getLocaleData();
  byte[] softApConfigData=getSoftAPConfiguration();
  byte[] netPoliciesData=getNetworkPolicies();
  byte[] wifiFullConfigData=getNewWifiConfigData();
  long[] stateChecksums=readOldChecksums(oldState);
  stateChecksums[STATE_SYSTEM]=writeIfChanged(stateChecksums[STATE_SYSTEM],KEY_SYSTEM,systemSettingsData,data);
  stateChecksums[STATE_SECURE]=writeIfChanged(stateChecksums[STATE_SECURE],KEY_SECURE,secureSettingsData,data);
  stateChecksums[STATE_GLOBAL]=writeIfChanged(stateChecksums[STATE_GLOBAL],KEY_GLOBAL,globalSettingsData,data);
  stateChecksums[STATE_LOCALE]=writeIfChanged(stateChecksums[STATE_LOCALE],KEY_LOCALE,locale,data);
  stateChecksums[STATE_WIFI_SUPPLICANT]=0;
  stateChecksums[STATE_WIFI_CONFIG]=0;
  stateChecksums[STATE_LOCK_SETTINGS]=writeIfChanged(stateChecksums[STATE_LOCK_SETTINGS],KEY_LOCK_SETTINGS,lockSettingsData,data);
  stateChecksums[STATE_SOFTAP_CONFIG]=writeIfChanged(stateChecksums[STATE_SOFTAP_CONFIG],KEY_SOFTAP_CONFIG,softApConfigData,data);
  stateChecksums[STATE_NETWORK_POLICIES]=writeIfChanged(stateChecksums[STATE_NETWORK_POLICIES],KEY_NETWORK_POLICIES,netPoliciesData,data);
  stateChecksums[STATE_WIFI_NEW_CONFIG]=writeIfChanged(stateChecksums[STATE_WIFI_NEW_CONFIG],KEY_WIFI_NEW_CONFIG,wifiFullConfigData,data);
  writeNewChecksums(stateChecksums,newState);
}
