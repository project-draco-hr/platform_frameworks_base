{
  byte[] systemSettingsData=getSystemSettings();
  byte[] secureSettingsData=getSecureSettings();
  byte[] syncProviders=mSettingsHelper.getSyncProviders();
  byte[] locale=mSettingsHelper.getLocaleData();
  byte[] wifiData=getWifiSupplicant(FILE_WIFI_SUPPLICANT);
  long[] stateChecksums=readOldChecksums(oldState);
  stateChecksums[STATE_SYSTEM]=writeIfChanged(stateChecksums[STATE_SYSTEM],KEY_SYSTEM,systemSettingsData,data);
  stateChecksums[STATE_SECURE]=writeIfChanged(stateChecksums[STATE_SECURE],KEY_SECURE,secureSettingsData,data);
  stateChecksums[STATE_SYNC]=writeIfChanged(stateChecksums[STATE_SYNC],KEY_SYNC,syncProviders,data);
  stateChecksums[STATE_LOCALE]=writeIfChanged(stateChecksums[STATE_LOCALE],KEY_LOCALE,locale,data);
  stateChecksums[STATE_WIFI]=writeIfChanged(stateChecksums[STATE_WIFI],KEY_WIFI_SUPPLICANT,wifiData,data);
  writeNewChecksums(stateChecksums,newState);
}
