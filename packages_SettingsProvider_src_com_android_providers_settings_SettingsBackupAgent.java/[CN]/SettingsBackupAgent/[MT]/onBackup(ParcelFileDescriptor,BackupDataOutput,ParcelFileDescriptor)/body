{
  byte[] systemSettingsData=getSystemSettings();
  byte[] secureSettingsData=getSecureSettings();
  byte[] globalSettingsData=getGlobalSettings();
  byte[] lockSettingsData=getLockSettings();
  byte[] locale=mSettingsHelper.getLocaleData();
  byte[] wifiSupplicantData=getWifiSupplicant(FILE_WIFI_SUPPLICANT);
  byte[] wifiConfigData=getFileData(mWifiConfigFile);
  long[] stateChecksums=readOldChecksums(oldState);
  stateChecksums[STATE_SYSTEM]=writeIfChanged(stateChecksums[STATE_SYSTEM],KEY_SYSTEM,systemSettingsData,data);
  stateChecksums[STATE_SECURE]=writeIfChanged(stateChecksums[STATE_SECURE],KEY_SECURE,secureSettingsData,data);
  stateChecksums[STATE_GLOBAL]=writeIfChanged(stateChecksums[STATE_GLOBAL],KEY_GLOBAL,globalSettingsData,data);
  stateChecksums[STATE_LOCALE]=writeIfChanged(stateChecksums[STATE_LOCALE],KEY_LOCALE,locale,data);
  stateChecksums[STATE_WIFI_SUPPLICANT]=writeIfChanged(stateChecksums[STATE_WIFI_SUPPLICANT],KEY_WIFI_SUPPLICANT,wifiSupplicantData,data);
  stateChecksums[STATE_WIFI_CONFIG]=writeIfChanged(stateChecksums[STATE_WIFI_CONFIG],KEY_WIFI_CONFIG,wifiConfigData,data);
  stateChecksums[STATE_LOCK_SETTINGS]=writeIfChanged(stateChecksums[STATE_LOCK_SETTINGS],KEY_LOCK_SETTINGS,lockSettingsData,data);
  writeNewChecksums(stateChecksums,newState);
}
