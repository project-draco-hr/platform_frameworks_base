{
  byte[] systemSettingsData=getSystemSettings();
  byte[] secureSettingsData=getSecureSettings();
  byte[] locale=mSettingsHelper.getLocaleData();
  byte[] wifiSupplicantData=getWifiSupplicant(FILE_WIFI_SUPPLICANT);
  byte[] wifiConfigData=getFileData(mWifiConfigFile);
  String root=getFilesDir().getAbsolutePath();
  File stage=new File(root,STAGE_FILE);
  try {
    FileOutputStream filestream=new FileOutputStream(stage);
    BufferedOutputStream bufstream=new BufferedOutputStream(filestream);
    DataOutputStream out=new DataOutputStream(bufstream);
    if (DEBUG_BACKUP)     Log.d(TAG,"Writing flattened data version " + FULL_BACKUP_VERSION);
    out.writeInt(FULL_BACKUP_VERSION);
    if (DEBUG_BACKUP)     Log.d(TAG,systemSettingsData.length + " bytes of settings data");
    out.writeInt(systemSettingsData.length);
    out.write(systemSettingsData);
    if (DEBUG_BACKUP)     Log.d(TAG,secureSettingsData.length + " bytes of secure settings data");
    out.writeInt(secureSettingsData.length);
    out.write(secureSettingsData);
    if (DEBUG_BACKUP)     Log.d(TAG,locale.length + " bytes of locale data");
    out.writeInt(locale.length);
    out.write(locale);
    if (DEBUG_BACKUP)     Log.d(TAG,wifiSupplicantData.length + " bytes of wifi supplicant data");
    out.writeInt(wifiSupplicantData.length);
    out.write(wifiSupplicantData);
    if (DEBUG_BACKUP)     Log.d(TAG,wifiConfigData.length + " bytes of wifi config data");
    out.writeInt(wifiConfigData.length);
    out.write(wifiConfigData);
    out.flush();
    fullBackupFile(stage,data);
  }
  finally {
    stage.delete();
  }
}
