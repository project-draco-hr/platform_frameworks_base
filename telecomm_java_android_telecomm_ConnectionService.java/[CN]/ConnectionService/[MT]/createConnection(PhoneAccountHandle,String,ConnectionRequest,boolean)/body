{
  Log.d(this,"call %s",request);
  final Connection createdConnection;
  if (isIncoming) {
    createdConnection=onCreateIncomingConnection(callManagerAccount,request);
  }
 else {
    createdConnection=onCreateOutgoingConnection(callManagerAccount,request);
  }
  if (createdConnection != null) {
    Log.d(this,"adapter handleCreateConnectionSuccessful %s",callId);
    if (createdConnection.getState() == Connection.STATE_INITIALIZING) {
      createdConnection.addConnectionListener(new Connection.Listener(){
        @Override public void onStateChanged(        Connection c,        int state){
switch (state) {
case Connection.STATE_FAILED:
            Log.d(this,"Connection (%s) failed (%d: %s)",request,c.getFailureCode(),c.getFailureMessage());
          Log.d(this,"adapter handleCreateConnectionFailed %s",callId);
        mAdapter.handleCreateConnectionFailed(callId,request,c.getFailureCode(),c.getFailureMessage());
      break;
case Connection.STATE_CANCELED:
    Log.d(this,"adapter handleCreateConnectionCanceled %s",callId);
  mAdapter.handleCreateConnectionCancelled(callId,request);
break;
case Connection.STATE_INITIALIZING:
Log.d(this,"State changed to STATE_INITIALIZING; ignoring");
return;
default :
Log.d(this,"Connection created in state %s",Connection.stateToString(state));
connectionCreated(callId,request,createdConnection);
break;
}
c.removeConnectionListener(this);
}
}
);
}
 else if (createdConnection.getState() == Connection.STATE_CANCELED) {
mAdapter.handleCreateConnectionCancelled(callId,request);
}
 else if (createdConnection.getState() == Connection.STATE_FAILED) {
mAdapter.handleCreateConnectionFailed(callId,request,createdConnection.getFailureCode(),createdConnection.getFailureMessage());
}
 else {
connectionCreated(callId,request,createdConnection);
}
}
 else {
Log.d(this,"adapter handleCreateConnectionFailed %s",callId);
mAdapter.handleCreateConnectionFailed(callId,request,DisconnectCause.ERROR_UNSPECIFIED,null);
}
}
