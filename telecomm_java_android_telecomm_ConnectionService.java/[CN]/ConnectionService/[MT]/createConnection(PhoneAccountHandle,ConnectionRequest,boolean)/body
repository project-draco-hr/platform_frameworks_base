{
  Log.d(this,"call %s",request);
  final Connection createdConnection;
  if (isIncoming) {
    createdConnection=onCreateIncomingConnection(callManagerAccount,request);
  }
 else {
    createdConnection=onCreateOutgoingConnection(callManagerAccount,request);
  }
  if (createdConnection != null) {
    if (createdConnection.getState() == Connection.State.INITIALIZING) {
      createdConnection.addConnectionListener(new Connection.Listener(){
        @Override public void onStateChanged(        Connection c,        int state){
switch (state) {
case Connection.State.FAILED:
            Log.d(this,"Connection (%s) failed (%d: %s)",request,c.getFailureCode(),c.getFailureMessage());
          Log.d(this,"adapter handleCreateConnectionFailed %s",request.getCallId());
        mAdapter.handleCreateConnectionFailed(request,c.getFailureCode(),c.getFailureMessage());
      break;
case Connection.State.CANCELED:
    Log.d(this,"adapter handleCreateConnectionCanceled %s",request.getCallId());
  mAdapter.handleCreateConnectionCancelled(request);
break;
case Connection.State.INITIALIZING:
Log.d(this,"State changed to INITIALIZING; ignoring");
return;
default :
Log.d(this,"Connection created in state %s",Connection.stateToString(state));
connectionCreated(request,createdConnection);
break;
}
c.removeConnectionListener(this);
}
}
);
}
 else if (createdConnection.getState() == Connection.State.CANCELED) {
mAdapter.handleCreateConnectionCancelled(request);
}
 else if (createdConnection.getState() == Connection.State.FAILED) {
mAdapter.handleCreateConnectionFailed(request,createdConnection.getFailureCode(),createdConnection.getFailureMessage());
}
 else {
connectionCreated(request,createdConnection);
}
}
 else {
Log.d(this,"adapter handleCreateConnectionFailed %s",request.getCallId());
mAdapter.handleCreateConnectionFailed(request,DisconnectCause.ERROR_UNSPECIFIED,null);
}
}
