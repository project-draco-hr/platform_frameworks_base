{
  acquireConnectionIfNoTransaction(null,connectionFlags);
  try {
    if (mTransactionStack == null) {
switch (transactionMode) {
case TRANSACTION_MODE_IMMEDIATE:
        mConnection.execute("BEGIN IMMEDIATE;",null);
      break;
case TRANSACTION_MODE_EXCLUSIVE:
    mConnection.execute("BEGIN EXCLUSIVE;",null);
  break;
default :
mConnection.execute("BEGIN;",null);
break;
}
}
if (transactionListener != null) {
try {
transactionListener.onBegin();
}
 catch (RuntimeException ex) {
if (mTransactionStack == null) {
mConnection.execute("ROLLBACK;",null);
}
throw ex;
}
}
Transaction transaction=obtainTransaction(transactionMode,transactionListener);
transaction.mParent=mTransactionStack;
mTransactionStack=transaction;
}
  finally {
releaseConnectionIfNoTransaction();
}
}
