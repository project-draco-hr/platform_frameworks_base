{
  if (cancellationSignal != null) {
    cancellationSignal.throwIfCanceled();
  }
  if (mTransactionStack == null) {
    acquireConnection(null,connectionFlags,cancellationSignal);
  }
  try {
    if (mTransactionStack == null) {
switch (transactionMode) {
case TRANSACTION_MODE_IMMEDIATE:
        mConnection.execute("BEGIN IMMEDIATE;",null,cancellationSignal);
      break;
case TRANSACTION_MODE_EXCLUSIVE:
    mConnection.execute("BEGIN EXCLUSIVE;",null,cancellationSignal);
  break;
default :
mConnection.execute("BEGIN;",null,cancellationSignal);
break;
}
}
if (transactionListener != null) {
try {
transactionListener.onBegin();
}
 catch (RuntimeException ex) {
if (mTransactionStack == null) {
mConnection.execute("ROLLBACK;",null,cancellationSignal);
}
throw ex;
}
}
Transaction transaction=obtainTransaction(transactionMode,transactionListener);
transaction.mParent=mTransactionStack;
mTransactionStack=transaction;
}
  finally {
if (mTransactionStack == null) {
releaseConnection();
}
}
}
