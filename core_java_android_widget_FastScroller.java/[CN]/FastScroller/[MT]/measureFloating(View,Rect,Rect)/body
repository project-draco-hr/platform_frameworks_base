{
  final int marginLeft;
  final int marginTop;
  final int marginRight;
  if (margins == null) {
    marginLeft=0;
    marginTop=0;
    marginRight=0;
  }
 else {
    marginLeft=margins.left;
    marginTop=margins.top;
    marginRight=margins.right;
  }
  final Rect container=mContainerRect;
  final int containerWidth=container.width();
  final int adjMaxHeight=Math.max(0,container.height());
  final int adjMaxWidth=Math.max(0,containerWidth - marginLeft - marginRight);
  final int widthMeasureSpec=MeasureSpec.makeMeasureSpec(adjMaxWidth,MeasureSpec.AT_MOST);
  final int heightMeasureSpec=MeasureSpec.makeSafeMeasureSpec(adjMaxHeight,MeasureSpec.UNSPECIFIED);
  preview.measure(widthMeasureSpec,heightMeasureSpec);
  final int containerHeight=container.height();
  final int width=preview.getMeasuredWidth();
  final int top=containerHeight / 10 + marginTop + container.top;
  final int bottom=top + preview.getMeasuredHeight();
  final int left=(containerWidth - width) / 2 + container.left;
  final int right=left + width;
  out.set(left,top,right,bottom);
}
