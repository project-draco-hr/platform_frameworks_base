{
  final DisplayState state=getDisplayState(this);
  getLoaderManager().restartLoader(mLoaderId,getArguments(),mCallbacks);
  mListView.smoothScrollToPosition(0);
  mGridView.smoothScrollToPosition(0);
  mListView.setVisibility(state.mode == DisplayState.MODE_LIST ? View.VISIBLE : View.GONE);
  mGridView.setVisibility(state.mode == DisplayState.MODE_GRID ? View.VISIBLE : View.GONE);
  final int choiceMode;
  if (state.allowMultiple) {
    choiceMode=ListView.CHOICE_MODE_MULTIPLE_MODAL;
  }
 else {
    choiceMode=ListView.CHOICE_MODE_NONE;
  }
  if (state.mode == DisplayState.MODE_GRID) {
    mListView.setAdapter(null);
    mListView.setChoiceMode(ListView.CHOICE_MODE_NONE);
    mGridView.setAdapter(mAdapter);
    mGridView.setColumnWidth(getResources().getDimensionPixelSize(R.dimen.grid_width));
    mGridView.setNumColumns(GridView.AUTO_FIT);
    mGridView.setChoiceMode(choiceMode);
    mCurrentView=mGridView;
  }
 else   if (state.mode == DisplayState.MODE_LIST) {
    mGridView.setAdapter(null);
    mGridView.setChoiceMode(ListView.CHOICE_MODE_NONE);
    mListView.setAdapter(mAdapter);
    mListView.setChoiceMode(choiceMode);
    mCurrentView=mListView;
  }
 else {
    throw new IllegalStateException();
  }
}
