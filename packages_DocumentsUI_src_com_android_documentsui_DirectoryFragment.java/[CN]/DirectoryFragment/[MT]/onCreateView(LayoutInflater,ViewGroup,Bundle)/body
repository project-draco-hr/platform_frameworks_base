{
  final Context context=inflater.getContext();
  final View view=inflater.inflate(R.layout.fragment_directory,container,false);
  mEmptyView=view.findViewById(android.R.id.empty);
  mListView=(ListView)view.findViewById(R.id.list);
  mListView.setOnItemClickListener(mItemListener);
  mListView.setMultiChoiceModeListener(mMultiListener);
  mGridView=(GridView)view.findViewById(R.id.grid);
  mGridView.setOnItemClickListener(mItemListener);
  mGridView.setMultiChoiceModeListener(mMultiListener);
  mMoreView=(Button)view.findViewById(R.id.more);
  mAdapter=new DocumentsAdapter();
  final Uri uri=getArguments().getParcelable(EXTRA_URI);
  mType=getArguments().getInt(EXTRA_TYPE);
  mCallbacks=new LoaderCallbacks<DirectoryResult>(){
    @Override public Loader<DirectoryResult> onCreateLoader(    int id,    Bundle args){
      final DisplayState state=getDisplayState(DirectoryFragment.this);
      mFilter=new MimePredicate(state.acceptMimes);
      Uri contentsUri;
      if (mType == TYPE_NORMAL) {
        contentsUri=DocumentsContract.buildContentsUri(uri);
      }
 else       if (mType == TYPE_RECENT_OPEN) {
        contentsUri=RecentsProvider.buildRecentOpen();
      }
 else {
        contentsUri=uri;
      }
      if (state.localOnly) {
        contentsUri=DocumentsContract.setLocalOnly(contentsUri);
      }
      final Comparator<Document> sortOrder;
      if (state.sortOrder == SORT_ORDER_DATE || mType == TYPE_RECENT_OPEN) {
        sortOrder=new Document.DateComparator();
      }
 else       if (state.sortOrder == SORT_ORDER_NAME) {
        sortOrder=new Document.NameComparator();
      }
 else       if (state.sortOrder == SORT_ORDER_SIZE) {
        sortOrder=new Document.SizeComparator();
      }
 else {
        throw new IllegalArgumentException("Unknown sort order " + state.sortOrder);
      }
      return new DirectoryLoader(context,contentsUri,mType,null,sortOrder);
    }
    @Override public void onLoadFinished(    Loader<DirectoryResult> loader,    DirectoryResult result){
      mAdapter.swapDocuments(result.contents);
      final Cursor cursor=result.cursor;
      if (cursor != null && cursor.getExtras().getBoolean(DocumentsContract.EXTRA_HAS_MORE,false)) {
        mMoreView.setText(R.string.more);
        mMoreView.setVisibility(View.VISIBLE);
        mMoreView.setOnClickListener(new View.OnClickListener(){
          @Override public void onClick(          View v){
            mMoreView.setText(R.string.loading);
            final Bundle bundle=new Bundle();
            bundle.putBoolean(DocumentsContract.EXTRA_REQUEST_MORE,true);
            try {
              cursor.respond(bundle);
            }
 catch (            Exception e) {
              Log.w(TAG,"Failed to respond: " + e);
            }
          }
        }
);
      }
 else {
        mMoreView.setVisibility(View.GONE);
      }
    }
    @Override public void onLoaderReset(    Loader<DirectoryResult> loader){
      mAdapter.swapDocuments(null);
    }
  }
;
  updateDisplayState();
  return view;
}
