{
  final Context context=parent.getContext();
  if (convertView == null) {
    final LayoutInflater inflater=LayoutInflater.from(context);
    final DisplayState state=getDisplayState(DirectoryFragment.this);
    if (state.mode == DisplayState.MODE_LIST) {
      convertView=inflater.inflate(R.layout.item_doc_list,parent,false);
    }
 else     if (state.mode == DisplayState.MODE_GRID) {
      convertView=inflater.inflate(R.layout.item_doc_grid,parent,false);
    }
 else {
      throw new IllegalStateException();
    }
  }
  final Document doc=getItem(position);
  final TextView title=(TextView)convertView.findViewById(android.R.id.title);
  final TextView summary=(TextView)convertView.findViewById(android.R.id.summary);
  final ImageView icon=(ImageView)convertView.findViewById(android.R.id.icon);
  if (doc.isThumbnailSupported()) {
    icon.setImageURI(doc.uri);
  }
 else {
    icon.setImageDrawable(RootsCache.resolveDocumentIcon(context,doc.uri.getAuthority(),doc.mimeType));
  }
  title.setText(doc.displayName);
  if (summary != null) {
    summary.setText(DateUtils.getRelativeTimeSpanString(doc.lastModified));
  }
  return convertView;
}
