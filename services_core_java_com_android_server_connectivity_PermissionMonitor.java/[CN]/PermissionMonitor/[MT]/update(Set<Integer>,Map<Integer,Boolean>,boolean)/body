{
  List<Integer> network=new ArrayList<Integer>();
  List<Integer> system=new ArrayList<Integer>();
  for (  Entry<Integer,Boolean> app : apps.entrySet()) {
    List<Integer> list=app.getValue() ? system : network;
    for (    int user : users) {
      list.add(UserHandle.getUid(user,app.getKey()));
    }
  }
  try {
    if (add) {
      mNetd.setPermission(CHANGE_NETWORK_STATE,toIntArray(network));
      mNetd.setPermission(CONNECTIVITY_INTERNAL,toIntArray(system));
    }
 else {
      mNetd.clearPermission(toIntArray(network));
      mNetd.clearPermission(toIntArray(system));
    }
  }
 catch (  RemoteException e) {
    loge("Exception when updating permissions: " + e);
  }
}
