{
  log("Monitoring");
  IntentFilter intentFilter=new IntentFilter();
  intentFilter.addAction(Intent.ACTION_USER_ADDED);
  intentFilter.addAction(Intent.ACTION_USER_REMOVED);
  mContext.registerReceiverAsUser(mIntentReceiver,UserHandle.ALL,intentFilter,null,null);
  intentFilter=new IntentFilter();
  intentFilter.addAction(Intent.ACTION_PACKAGE_ADDED);
  intentFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  intentFilter.addDataScheme("package");
  mContext.registerReceiverAsUser(mIntentReceiver,UserHandle.ALL,intentFilter,null,null);
  List<PackageInfo> apps=mPackageManager.getInstalledPackages(GET_PERMISSIONS);
  if (apps == null) {
    loge("No apps");
    return;
  }
  for (  PackageInfo app : apps) {
    int uid=app.applicationInfo != null ? app.applicationInfo.uid : -1;
    if (uid < 0) {
      continue;
    }
    boolean isNetwork=hasNetworkPermission(app);
    boolean isSystem=hasSystemPermission(app);
    if (isNetwork || isSystem) {
      Boolean permission=mApps.get(uid);
      if (permission == null || permission == NETWORK) {
        mApps.put(uid,isSystem);
      }
    }
  }
  List<UserInfo> users=mUserManager.getUsers(true);
  if (users != null) {
    for (    UserInfo user : users) {
      mUsers.add(user.id);
    }
  }
  log("Users: " + mUsers.size() + ", Apps: "+ mApps.size());
  update(mUsers,mApps,true);
}
