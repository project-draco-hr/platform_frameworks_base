{
  SQLiteDatabase db=mOpenHelper.getReadableDatabase();
  Cursor c=db.rawQuery("" + "SELECT initialFailureTime, s1.value, s2.value " + "FROM status "+ "LEFT JOIN stats ON status.stats_id=stats._id "+ "LEFT JOIN settings as s1 ON 'sync_provider_' || authority=s1.name "+ "LEFT JOIN settings as s2 ON s2.name='listen_for_tickles' "+ "where initialFailureTime is not null "+ "  AND lastFailureMesg!=" + Sync.History.ERROR_TOO_MANY_DELETIONS + "  AND lastFailureMesg!="+ Sync.History.ERROR_AUTHENTICATION+ "  AND lastFailureMesg!="+ Sync.History.ERROR_SYNC_ALREADY_IN_PROGRESS+ "  AND authority!='subscribedfeeds' "+ " ORDER BY initialFailureTime",null);
  try {
    while (c.moveToNext()) {
      final String providerEnabledString=c.getString(1);
      if (providerEnabledString != null && !Boolean.parseBoolean(providerEnabledString)) {
        continue;
      }
      final String allEnabledString=c.getString(2);
      if (allEnabledString != null && !Boolean.parseBoolean(allEnabledString)) {
        continue;
      }
      return c.getLong(0);
    }
  }
  finally {
    c.close();
  }
  return 0;
}
