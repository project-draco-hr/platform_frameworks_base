{
  StatusBarIconView iconView=addNotificationViews(key,notification);
  if (iconView == null)   return;
  boolean immersive=false;
  try {
    immersive=ActivityManagerNative.getDefault().isTopActivityImmersive();
    Slog.d(TAG,"Top activity is " + (immersive ? "immersive" : "not immersive"));
  }
 catch (  RemoteException ex) {
  }
  if (immersive) {
    if ((notification.notification.flags & Notification.FLAG_HIGH_PRIORITY) != 0) {
      Slog.d(TAG,"Presenting high-priority notification in immersive activity");
      ImageView alertIcon=(ImageView)mIntruderAlertView.findViewById(R.id.alertIcon);
      TextView alertText=(TextView)mIntruderAlertView.findViewById(R.id.alertText);
      alertIcon.setImageDrawable(StatusBarIconView.getIcon(alertIcon.getContext(),iconView.getStatusBarIcon()));
      alertText.setText(notification.notification.tickerText);
      View button=mIntruderAlertView.findViewById(R.id.intruder_alert_content);
      button.setOnClickListener(new Launcher(notification.notification.contentIntent,notification.pkg,notification.tag,notification.id));
      mHandler.sendEmptyMessage(MSG_SHOW_INTRUDER);
      mHandler.removeMessages(MSG_HIDE_INTRUDER);
      mHandler.sendEmptyMessageDelayed(MSG_HIDE_INTRUDER,INTRUDER_ALERT_DECAY_MS);
    }
  }
 else   if (notification.notification.fullScreenIntent != null) {
    Slog.d(TAG,"Notification has fullScreenIntent and activity is not immersive;" + " sending fullScreenIntent");
    try {
      notification.notification.fullScreenIntent.send();
    }
 catch (    PendingIntent.CanceledException e) {
    }
  }
 else {
    tick(notification);
  }
  setAreThereNotifications();
  updateExpandedViewPos(EXPANDED_LEAVE_ALONE);
}
