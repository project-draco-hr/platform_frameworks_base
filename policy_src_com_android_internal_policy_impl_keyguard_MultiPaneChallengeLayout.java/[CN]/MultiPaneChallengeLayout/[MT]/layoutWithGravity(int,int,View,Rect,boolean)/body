{
  final LayoutParams lp=(LayoutParams)child.getLayoutParams();
  final int gravity=Gravity.getAbsoluteGravity(lp.gravity,getLayoutDirection());
  final boolean fixedLayoutSize=lp.centerWithinArea > 0;
  final boolean fixedLayoutHorizontal=fixedLayoutSize && mOrientation == HORIZONTAL;
  final boolean fixedLayoutVertical=fixedLayoutSize && mOrientation == VERTICAL;
  final int adjustedWidth;
  final int adjustedHeight;
  if (fixedLayoutHorizontal) {
    adjustedWidth=(int)(width * lp.centerWithinArea + 0.5f);
    adjustedHeight=height;
  }
 else   if (fixedLayoutVertical) {
    adjustedWidth=width;
    adjustedHeight=(int)(height * lp.centerWithinArea + 0.5f);
  }
 else {
    adjustedWidth=width;
    adjustedHeight=height;
  }
  final boolean isVertical=Gravity.isVertical(gravity);
  final boolean isHorizontal=Gravity.isHorizontal(gravity);
  final int childWidth=child.getMeasuredWidth();
  final int childHeight=child.getMeasuredHeight();
  int left=padding.left;
  int top=padding.top;
  int right=left + childWidth;
  int bottom=top + childHeight;
switch (gravity & Gravity.VERTICAL_GRAVITY_MASK) {
case Gravity.TOP:
    top=fixedLayoutVertical ? padding.top + (adjustedHeight - childHeight) / 2 : padding.top;
  bottom=top + childHeight;
if (adjustPadding && isVertical) padding.top=bottom;
break;
case Gravity.BOTTOM:
bottom=fixedLayoutVertical ? height - padding.bottom - (adjustedHeight - childHeight) / 2 : height - padding.bottom;
top=bottom - childHeight;
if (adjustPadding && isVertical) padding.bottom=top;
break;
case Gravity.CENTER_VERTICAL:
top=(height - childHeight) / 2;
bottom=top + childHeight;
break;
}
switch (gravity & Gravity.HORIZONTAL_GRAVITY_MASK) {
case Gravity.LEFT:
left=fixedLayoutHorizontal ? padding.left + (adjustedWidth - childWidth) / 2 : padding.left;
right=left + childWidth;
if (adjustPadding && isHorizontal && !isVertical) padding.left=right;
break;
case Gravity.RIGHT:
right=fixedLayoutHorizontal ? width - padding.right - (adjustedWidth - childWidth) / 2 : width - padding.right;
left=right - childWidth;
if (adjustPadding && isHorizontal && !isVertical) padding.right=left;
break;
case Gravity.CENTER_HORIZONTAL:
left=(width - childWidth) / 2;
right=left + childWidth;
break;
}
child.layout(left,top,right,bottom);
}
