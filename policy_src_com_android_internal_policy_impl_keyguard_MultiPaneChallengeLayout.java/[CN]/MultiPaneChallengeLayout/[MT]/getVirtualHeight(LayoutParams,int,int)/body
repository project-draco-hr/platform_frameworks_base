{
  int virtualHeight=height;
  final View root=getRootView();
  if (root != null) {
    virtualHeight=mDisplayMetrics.heightPixels - root.getPaddingTop();
  }
  if (lp.childType == LayoutParams.CHILD_TYPE_WIDGET || lp.childType == LayoutParams.CHILD_TYPE_USER_SWITCHER) {
    return virtualHeight - heightUsed;
  }
  return Math.min(virtualHeight - heightUsed,height);
}
