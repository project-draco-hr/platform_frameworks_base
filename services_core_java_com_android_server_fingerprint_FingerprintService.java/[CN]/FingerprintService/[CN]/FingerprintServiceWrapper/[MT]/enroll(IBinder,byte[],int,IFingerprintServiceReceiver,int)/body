{
  checkPermission(MANAGE_FINGERPRINT);
  final int limit=mContext.getResources().getInteger(com.android.internal.R.integer.config_fingerprintMaxTemplatesPerUser);
  final int callingUid=Binder.getCallingUid();
  final int userId=UserHandle.getUserId(callingUid);
  final int enrolled=FingerprintService.this.getEnrolledFingerprints(userId).size();
  if (enrolled >= limit) {
    Slog.w(TAG,"Too many fingerprints registered");
    return;
  }
  final byte[] cryptoClone=Arrays.copyOf(cryptoToken,cryptoToken.length);
  final int effectiveGroupId=getEffectiveUserId(groupId);
  final boolean restricted=isRestricted();
  mHandler.post(new Runnable(){
    @Override public void run(){
      startEnrollment(token,cryptoClone,effectiveGroupId,receiver,flags,restricted);
    }
  }
);
}
