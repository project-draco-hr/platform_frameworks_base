{
  FileDescriptor fd=new FileDescriptor();
  try {
    fd=Os.open(fileToPin,OsConstants.O_RDONLY | OsConstants.O_CLOEXEC | OsConstants.O_NOFOLLOW,OsConstants.O_RDONLY);
    StructStat sb=Os.fstat(fd);
    if (offset + length > sb.st_size) {
      Os.close(fd);
      return false;
    }
    if (length == 0) {
      length=sb.st_size - offset;
    }
    long address=Os.mmap(0,length,OsConstants.PROT_READ,OsConstants.MAP_PRIVATE,fd,offset);
    Os.close(fd);
    Os.mlock(address,length);
    return true;
  }
 catch (  ErrnoException e) {
    Slog.e(TAG,"Failed to pin file " + fileToPin + " with error "+ e.getMessage());
    if (fd.valid()) {
      try {
        Os.close(fd);
      }
 catch (      ErrnoException eClose) {
        Slog.e(TAG,"Failed to close fd, error = " + eClose.getMessage());
      }
    }
    return false;
  }
}
