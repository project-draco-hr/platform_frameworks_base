{
  if (DEBUG) {
    Log.d(TAG,"Opening shim Camera device");
  }
  CameraLooper init=new CameraLooper(cameraId);
  CameraCallbackThread threadCallbacks=new CameraCallbackThread(callbacks);
  int initErrors=init.waitForOpen(OPEN_CAMERA_TIMEOUT_MS);
  Camera legacyCamera=init.getCamera();
  CameraBinderDecorator.throwOnError(initErrors);
  legacyCamera.disableShutterSound();
  CameraInfo info=new CameraInfo();
  Camera.getCameraInfo(cameraId,info);
  CameraCharacteristics characteristics=LegacyMetadataMapper.createCharacteristics(legacyCamera.getParameters(),info);
  LegacyCameraDevice device=new LegacyCameraDevice(cameraId,legacyCamera,characteristics,threadCallbacks);
  return new CameraDeviceUserShim(cameraId,device,characteristics,init,threadCallbacks);
}
