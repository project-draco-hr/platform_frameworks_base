{
  if (DEBUG) {
    Log.d(TAG,"Opening shim Camera device");
  }
  CameraLooper init=new CameraLooper(cameraId);
  CameraCallbackThread threadCallbacks=new CameraCallbackThread(callbacks);
  int initErrors=init.waitForOpen(OPEN_CAMERA_TIMEOUT_MS);
  Camera legacyCamera=init.getCamera();
  LegacyExceptionUtils.throwOnServiceError(initErrors);
  legacyCamera.disableShutterSound();
  CameraInfo info=new CameraInfo();
  Camera.getCameraInfo(cameraId,info);
  Camera.Parameters legacyParameters=null;
  try {
    legacyParameters=legacyCamera.getParameters();
  }
 catch (  RuntimeException e) {
    throw new ServiceSpecificException(ICameraService.ERROR_INVALID_OPERATION,"Unable to get initial parameters: " + e.getMessage());
  }
  CameraCharacteristics characteristics=LegacyMetadataMapper.createCharacteristics(legacyParameters,info);
  LegacyCameraDevice device=new LegacyCameraDevice(cameraId,legacyCamera,characteristics,threadCallbacks);
  return new CameraDeviceUserShim(cameraId,device,characteristics,init,threadCallbacks);
}
