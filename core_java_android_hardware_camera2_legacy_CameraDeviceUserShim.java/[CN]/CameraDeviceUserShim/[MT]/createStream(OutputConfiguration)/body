{
  if (DEBUG) {
    Log.d(TAG,"createStream called.");
  }
  if (mLegacyDevice.isClosed()) {
    String err="Cannot create stream, device has been closed.";
    Log.e(TAG,err);
    throw new ServiceSpecificException(ICameraService.ERROR_DISCONNECTED,err);
  }
synchronized (mConfigureLock) {
    if (!mConfiguring) {
      String err="Cannot create stream, beginConfigure hasn't been called yet.";
      Log.e(TAG,err);
      throw new ServiceSpecificException(ICameraService.ERROR_INVALID_OPERATION,err);
    }
    if (outputConfiguration.getRotation() != OutputConfiguration.ROTATION_0) {
      String err="Cannot create stream, stream rotation is not supported.";
      Log.e(TAG,err);
      throw new ServiceSpecificException(ICameraService.ERROR_ILLEGAL_ARGUMENT,err);
    }
    int id=++mSurfaceIdCounter;
    mSurfaces.put(id,outputConfiguration.getSurface());
    return id;
  }
}
