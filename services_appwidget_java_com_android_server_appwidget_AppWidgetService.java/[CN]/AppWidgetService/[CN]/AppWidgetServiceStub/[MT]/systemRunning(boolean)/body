{
  mSafeMode=safeMode;
  mAppWidgetServices.get(0).systemReady(safeMode);
  IntentFilter filter=new IntentFilter(Intent.ACTION_BOOT_COMPLETED);
  filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
  mContext.registerReceiverAsUser(mBroadcastReceiver,UserHandle.ALL,filter,null,null);
  mContext.registerReceiverAsUser(mBroadcastReceiver,UserHandle.ALL,new IntentFilter(Intent.ACTION_CONFIGURATION_CHANGED),null,null);
  filter.addAction(Intent.ACTION_PACKAGE_ADDED);
  filter.addAction(Intent.ACTION_PACKAGE_CHANGED);
  filter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  filter.addDataScheme("package");
  mContext.registerReceiverAsUser(mBroadcastReceiver,UserHandle.ALL,filter,null,null);
  IntentFilter sdFilter=new IntentFilter();
  sdFilter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_AVAILABLE);
  sdFilter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE);
  mContext.registerReceiverAsUser(mBroadcastReceiver,UserHandle.ALL,sdFilter,null,null);
  IntentFilter userFilter=new IntentFilter();
  userFilter.addAction(Intent.ACTION_USER_REMOVED);
  userFilter.addAction(Intent.ACTION_USER_STOPPING);
  mContext.registerReceiver(new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      if (Intent.ACTION_USER_REMOVED.equals(intent.getAction())) {
        onUserRemoved(intent.getIntExtra(Intent.EXTRA_USER_HANDLE,UserHandle.USER_NULL));
      }
 else       if (Intent.ACTION_USER_STOPPING.equals(intent.getAction())) {
        onUserStopping(intent.getIntExtra(Intent.EXTRA_USER_HANDLE,UserHandle.USER_NULL));
      }
    }
  }
,userFilter);
}
