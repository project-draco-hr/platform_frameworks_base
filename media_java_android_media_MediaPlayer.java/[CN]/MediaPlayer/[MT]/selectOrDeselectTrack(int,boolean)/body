{
  SubtitleTrack track=null;
synchronized (mInbandSubtitleLock) {
    if (mInbandSubtitleTracks.length == 0) {
      TrackInfo[] tracks=getInbandTrackInfo();
      mInbandSubtitleTracks=new SubtitleTrack[tracks.length];
      for (int i=0; i < tracks.length; i++) {
        if (tracks[i].getTrackType() == TrackInfo.MEDIA_TRACK_TYPE_SUBTITLE) {
          mInbandSubtitleTracks[i]=mSubtitleController.addTrack(tracks[i].getFormat());
        }
      }
    }
  }
  if (index < mInbandSubtitleTracks.length) {
    track=mInbandSubtitleTracks[index];
  }
 else   if (index < mInbandSubtitleTracks.length + mOutOfBandSubtitleTracks.size()) {
    track=mOutOfBandSubtitleTracks.get(index - mInbandSubtitleTracks.length);
  }
  if (mSubtitleController != null && track != null) {
    if (select) {
      if (track.isTimedText()) {
        int ttIndex=getSelectedTrack(TrackInfo.MEDIA_TRACK_TYPE_TIMEDTEXT);
        if (ttIndex >= 0 && ttIndex < mInbandSubtitleTracks.length) {
          selectOrDeselectInbandTrack(ttIndex,false);
        }
      }
      mSubtitleController.selectTrack(track);
    }
 else     if (mSubtitleController.getSelectedTrack() == track) {
      mSubtitleController.selectTrack(null);
    }
 else {
      Log.w(TAG,"trying to deselect track that was not selected");
    }
    return;
  }
  selectOrDeselectInbandTrack(index,select);
}
