{
  boolean sent=false;
  if ((state == ActivityState.RESUMED || (service.mSleeping && stack.topRunningActivityLocked(null) == this)) && app != null && app.thread != null) {
    try {
      ArrayList<Intent> ar=new ArrayList<Intent>();
      intent=new Intent(intent);
      ar.add(intent);
      service.grantUriPermissionFromIntentLocked(callingUid,packageName,intent,getUriPermissionsLocked());
      app.thread.scheduleNewIntent(ar,appToken);
      sent=true;
    }
 catch (    RemoteException e) {
      Slog.w(ActivityManagerService.TAG,"Exception thrown sending new intent to " + this,e);
    }
catch (    NullPointerException e) {
      Slog.w(ActivityManagerService.TAG,"Exception thrown sending new intent to " + this,e);
    }
  }
  if (!sent) {
    addNewIntentLocked(new Intent(intent));
  }
}
