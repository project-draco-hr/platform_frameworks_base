{
  ActivityRecord r;
  ProcessRecord anrApp=null;
synchronized (service) {
    r=getWaitingHistoryRecordLocked();
    if (r != null && r.app != null) {
      if (r.app.debugging) {
        return false;
      }
      if (service.mDidDexOpt) {
        service.mDidDexOpt=false;
        return false;
      }
      if (r.app.instrumentationClass == null) {
        anrApp=r.app;
      }
 else {
        Bundle info=new Bundle();
        info.putString("shortMsg","keyDispatchingTimedOut");
        info.putString("longMsg","Timed out while dispatching key event");
        service.finishInstrumentationLocked(r.app,Activity.RESULT_CANCELED,info);
      }
    }
  }
  if (anrApp != null) {
    service.appNotResponding(anrApp,r,this,false,"keyDispatchingTimedOut");
  }
  return true;
}
