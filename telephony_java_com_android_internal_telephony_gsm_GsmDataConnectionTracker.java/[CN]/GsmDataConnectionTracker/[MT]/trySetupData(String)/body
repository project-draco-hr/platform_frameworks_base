{
  if (DBG)   log("***trySetupData due to " + (reason == null ? "(unspecified)" : reason));
  log("[DSAC DEB] " + "trySetupData with mIsPsRestricted=" + mIsPsRestricted);
  if (mPhone.getSimulatedRadioControl() != null) {
    setState(State.CONNECTED);
    notifyDataConnection(reason);
    log("(fix?) We're on the simulator; assuming data is connected");
    return true;
  }
  int gprsState=mGsmPhone.mSST.getCurrentGprsState();
  boolean desiredPowerState=mGsmPhone.mSST.getDesiredPowerState();
  if (((mState == State.IDLE) || (mState == State.SCANNING)) && isDataAllowed() && getAnyDataEnabled()) {
    if (mState == State.IDLE) {
      mWaitingApns=buildWaitingApns(mRequestedApnType);
      mWaitingApnsPermanentFailureCountDown=mWaitingApns.size();
      if (mWaitingApns.isEmpty()) {
        if (DBG)         log("No APN found");
        notifyNoData(GsmDataConnection.FailCause.MISSING_UNKNOWN_APN);
        notifyOffApnsOfAvailability(reason,false);
        return false;
      }
 else {
        log("Create from allApns : " + apnListToString(mAllApns));
      }
    }
    if (DBG) {
      log("Setup waitngApns : " + apnListToString(mWaitingApns));
    }
    boolean retValue=setupData(reason);
    notifyOffApnsOfAvailability(reason,retValue);
    return retValue;
  }
 else {
    notifyOffApnsOfAvailability(reason,false);
    return false;
  }
}
