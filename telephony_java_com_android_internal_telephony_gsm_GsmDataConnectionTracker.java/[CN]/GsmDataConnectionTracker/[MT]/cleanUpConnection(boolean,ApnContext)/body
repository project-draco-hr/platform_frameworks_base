{
  if (apnContext == null) {
    if (DBG)     log("apn context is null");
    return;
  }
  if (DBG)   log("Clean up connection due to " + apnContext.getReason());
  if (apnContext.getReconnectIntent() != null) {
    AlarmManager am=(AlarmManager)mPhone.getContext().getSystemService(Context.ALARM_SERVICE);
    am.cancel(apnContext.getReconnectIntent());
    apnContext.setReconnectIntent(null);
  }
  if (apnContext.getState() == State.IDLE || apnContext.getState() == State.DISCONNECTING) {
    if (DBG)     log("state is in " + apnContext.getState());
    return;
  }
  if (apnContext.getState() == State.FAILED) {
    if (DBG)     log("state is in FAILED");
    apnContext.setState(State.IDLE);
    return;
  }
  GsmDataConnection pdp=apnContext.getDataConnection();
  if (tearDown && pdp != null) {
    apnContext.setState(State.DISCONNECTING);
    Message msg=obtainMessage(EVENT_DISCONNECT_DONE,apnContext);
    pdp.disconnect(msg);
    return;
  }
 else   if (pdp != null) {
    pdp.clearSettings();
  }
  if (!tearDown) {
    apnContext.setState(State.IDLE);
    mPhone.notifyDataConnection(apnContext.getReason(),apnContext.getApnType());
  }
  if (apnContext.getPendingAction() == ApnContext.PENDING_ACTION_APN_DISABLE) {
    mApnContexts.remove(apnContext.getApnType());
  }
}
