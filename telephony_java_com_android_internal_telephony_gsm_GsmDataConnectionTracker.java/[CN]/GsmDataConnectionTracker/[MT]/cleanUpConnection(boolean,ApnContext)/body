{
  if (apnContext == null) {
    if (DBG)     log("cleanUpConnection: apn context is null");
    return;
  }
  if (DBG) {
    log("cleanUpConnection: tearDown=" + tearDown + " reason="+ apnContext.getReason());
  }
  if (tearDown && cleanApnContextBeforeRestart(apnContext)) {
    return;
  }
  DataConnectionAc dcac=apnContext.getDataConnectionAc();
  if (dcac != null) {
    if (tearDown) {
      apnContext.setState(State.DISCONNECTING);
      releaseApnContext(apnContext,tearDown);
    }
 else {
      dcac.resetSync();
      if (apnContext.getDataConnection() != null) {
        apnContext.getDataConnection().setRefCount(0);
      }
      apnContext.setState(State.IDLE);
      mPhone.notifyDataConnection(apnContext.getReason(),apnContext.getApnType());
      apnContext.setDataConnection(null);
      apnContext.setDataConnectionAc(null);
    }
  }
}
