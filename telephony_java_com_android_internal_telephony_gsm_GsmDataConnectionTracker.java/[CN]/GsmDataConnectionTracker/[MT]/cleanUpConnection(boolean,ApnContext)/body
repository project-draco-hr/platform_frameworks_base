{
  if (apnContext == null) {
    if (DBG)     log("cleanUpConnection: apn context is null");
    return;
  }
  if (DBG) {
    log("cleanUpConnection: tearDown=" + tearDown + " reason="+ apnContext.getReason());
  }
  if (apnContext.getReconnectIntent() != null) {
    AlarmManager am=(AlarmManager)mPhone.getContext().getSystemService(Context.ALARM_SERVICE);
    am.cancel(apnContext.getReconnectIntent());
    apnContext.setReconnectIntent(null);
  }
  if (apnContext.getState() == State.IDLE || apnContext.getState() == State.DISCONNECTING) {
    if (DBG)     log("cleanUpConnection: state= " + apnContext.getState());
    return;
  }
  if (apnContext.getState() == State.FAILED) {
    if (DBG)     log("cleanUpConnection: state is in FAILED");
    apnContext.setState(State.IDLE);
    return;
  }
  DataConnection conn=apnContext.getDataConnection();
  if (conn != null) {
    DataConnectionAc dcac=mDataConnectionAsyncChannels.get(conn.getDataConnectionId());
    apnContext.setState(State.DISCONNECTING);
    if (tearDown) {
      releaseApnContext(apnContext,tearDown);
    }
 else {
      if (dcac != null) {
        dcac.resetSync();
      }
      apnContext.setState(State.IDLE);
      mPhone.notifyDataConnection(apnContext.getReason(),apnContext.getApnType());
    }
  }
}
