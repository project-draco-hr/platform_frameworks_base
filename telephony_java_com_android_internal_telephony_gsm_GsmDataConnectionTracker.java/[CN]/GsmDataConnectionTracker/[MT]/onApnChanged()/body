{
  boolean isConnected;
  ApnContext defaultApnContext=mApnContexts.get(Phone.APN_TYPE_DEFAULT);
  isConnected=(defaultApnContext.getState() != State.IDLE && defaultApnContext.getState() != State.FAILED);
  if (mPhone instanceof GSMPhone) {
    ((GSMPhone)mPhone).updateCurrentCarrierInProvider();
  }
  createAllApnList();
  if (DBG)   log("onApnChanged clean all connections");
  cleanUpAllConnections(isConnected,Phone.REASON_APN_CHANGED);
  if (!isConnected) {
    mRetryMgr.resetRetryCount();
    defaultApnContext.setReason(Phone.REASON_APN_CHANGED);
    trySetupData(defaultApnContext);
  }
}
