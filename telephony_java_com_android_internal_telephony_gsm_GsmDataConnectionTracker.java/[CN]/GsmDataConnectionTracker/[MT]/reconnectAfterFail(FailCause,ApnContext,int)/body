{
  if (apnContext == null) {
    loge("reconnectAfterFail: apnContext == null, impossible");
    return;
  }
  if (DBG) {
    log("reconnectAfterFail: lastFailCause=" + lastFailCauseCode + " retryOverride="+ retryOverride+ " apnContext="+ apnContext);
  }
  if ((apnContext.getState() == State.FAILED) && (apnContext.getDataConnection() != null)) {
    if (!apnContext.getDataConnection().isRetryNeeded()) {
      if (!apnContext.getApnType().equals(Phone.APN_TYPE_DEFAULT)) {
        mPhone.notifyDataConnection(Phone.REASON_APN_FAILED,apnContext.getApnType());
        return;
      }
      if (mReregisterOnReconnectFailure) {
        apnContext.getDataConnection().retryForeverUsingLastTimeout();
      }
 else {
        if (DBG)         log("reconnectAfterFail: activate failed, Reregistering to network");
        mReregisterOnReconnectFailure=true;
        mPhone.getServiceStateTracker().reRegisterNetwork(null);
        apnContext.setRetryCount(0);
        return;
      }
    }
    int nextReconnectDelay=retryOverride;
    if (nextReconnectDelay < 0) {
      nextReconnectDelay=apnContext.getDataConnection().getRetryTimer();
      apnContext.getDataConnection().increaseRetryCount();
      if (DBG) {
        log("reconnectAfterFail: increaseRetryCount=" + apnContext.getDataConnection().getRetryCount() + " nextReconnectDelay="+ nextReconnectDelay);
      }
    }
    startAlarmForReconnect(nextReconnectDelay,apnContext);
    if (!shouldPostNotification(lastFailCauseCode)) {
      if (DBG) {
        log("reconnectAfterFail: NOT Posting GPRS Unavailable notification " + "-- likely transient error");
      }
    }
 else {
      notifyNoData(lastFailCauseCode,apnContext);
    }
  }
}
