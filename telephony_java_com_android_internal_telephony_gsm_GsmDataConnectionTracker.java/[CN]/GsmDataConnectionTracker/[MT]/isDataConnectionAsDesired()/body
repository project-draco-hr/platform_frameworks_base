{
  boolean roaming=phone.getServiceState().getRoaming();
  if (((GSMPhone)phone).mSIMRecords.getRecordsLoaded() && ((GSMPhone)phone).mSST.getCurrentGprsState() == ServiceState.STATE_IN_SERVICE && (!roaming || getDataOnRoamingEnabled()) && !mIsWifiConnected && !mIsPsRestricted) {
    return (state == State.CONNECTED);
  }
  return true;
}
