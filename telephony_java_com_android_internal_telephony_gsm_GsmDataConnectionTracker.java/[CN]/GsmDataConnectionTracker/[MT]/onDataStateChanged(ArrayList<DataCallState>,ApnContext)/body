{
  if (DBG)   log("onDataStateChanged(dataCallState, apnContext):  apnContext=" + apnContext);
  if (apnContext == null) {
    if (DBG)     log("onDataStateChanged(dataCallState, apnContext):  ignore apnContext=null");
    return;
  }
  if (apnContext.getState() == State.CONNECTED) {
    DataConnectionAc dcac=apnContext.getDataConnectionAc();
    if (dcac == null) {
      if (DBG)       log("onDataStateChanged(dataCallState, apnContext):  dcac==null BAD NEWS");
      return;
    }
    int cid=dcac.getCidSync();
    if (!dataCallStatesHasCID(dataCallStates,cid)) {
      if (DBG) {
        log("onDataStateChanged(dataCallStates,apnContext) " + "PDP connection has dropped. Reconnecting");
      }
      int cellLocationId=getCellLocationId();
      EventLog.writeEvent(EventLogTags.PDP_NETWORK_DROP,cellLocationId,TelephonyManager.getDefault().getNetworkType());
      cleanUpConnection(true,apnContext);
    }
 else     if (!dataCallStatesHasActiveCID(dataCallStates,apnContext.getDataConnectionAc().getCidSync())) {
      if (DBG) {
        log("onDataStateChanged(dataCallStates,apnContext) " + "PDP connection has dropped (active=false case). Reconnecting");
      }
      int cellLocationId=getCellLocationId();
      EventLog.writeEvent(EventLogTags.PDP_NETWORK_DROP,cellLocationId,TelephonyManager.getDefault().getNetworkType());
      cleanUpConnection(true,apnContext);
    }
 else {
      DataCallState state=findDataCallStateByCID(dataCallStates,apnContext.getDataConnectionAc().getCidSync());
      if ((dcac != null) && (state != null)) {
        if (dcac.updateLinkPropertiesDataCallStateSync(state)) {
          mPhone.notifyDataConnection(Phone.REASON_LINK_PROPERTIES_CHANGED,apnContext.getApnType());
        }
      }
    }
  }
}
