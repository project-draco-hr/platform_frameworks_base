{
  String reason=null;
  if (ar.userObj instanceof String) {
    reason=(String)ar.userObj;
  }
  if (ar.exception == null) {
    mNetworkProperties=getNetworkProperties(mActivePdp);
    ApnSetting apn=mActivePdp.getApn();
    if (apn.proxy != null && apn.proxy.length() != 0) {
      try {
        ProxyProperties proxy=new ProxyProperties();
        proxy.setAddress(InetAddress.getByName(apn.proxy));
        proxy.setPort(Integer.parseInt(apn.port));
        mNetworkProperties.setHttpProxy(proxy);
      }
 catch (      UnknownHostException e) {
        Log.e(LOG_TAG,"UnknownHostException making ProxyProperties: " + e);
      }
catch (      SecurityException e) {
        Log.e(LOG_TAG,"SecurityException making ProxyProperties: " + e);
      }
catch (      NumberFormatException e) {
        Log.e(LOG_TAG,"NumberFormatException making ProxyProperties (" + apn.port + "): "+ e);
      }
    }
    if (isApnTypeActive(Phone.APN_TYPE_DEFAULT)) {
      SystemProperties.set("gsm.defaultpdpcontext.active","true");
      if (canSetPreferApn && preferredApn == null) {
        Log.d(LOG_TAG,"PREFERRED APN is null");
        preferredApn=mActiveApn;
        setPreferredApn(preferredApn.id);
      }
    }
 else {
      SystemProperties.set("gsm.defaultpdpcontext.active","false");
    }
    notifyDefaultData(reason);
  }
 else {
    GsmDataConnection.FailCause cause;
    cause=(GsmDataConnection.FailCause)(ar.result);
    if (DBG)     log("PDP setup failed " + cause);
    if (cause.isEventLoggable()) {
      GsmCellLocation loc=((GsmCellLocation)phone.getCellLocation());
      EventLog.writeEvent(EventLogTags.PDP_SETUP_FAIL,cause.ordinal(),loc != null ? loc.getCid() : -1,TelephonyManager.getDefault().getNetworkType());
    }
    if (cause.isPermanentFail()) {
      notifyNoData(cause);
      if (!mRequestedApnType.equals(Phone.APN_TYPE_DEFAULT)) {
        notifyDataConnection(Phone.REASON_APN_FAILED);
        onEnableApn(apnTypeToId(mRequestedApnType),DISABLED);
      }
      return;
    }
    waitingApns.remove(0);
    if (waitingApns.isEmpty()) {
      startDelayedRetry(cause,reason);
    }
 else {
      setState(State.SCANNING);
      sendMessageDelayed(obtainMessage(EVENT_TRY_SETUP_DATA,reason),APN_DELAY_MILLIS);
    }
  }
}
