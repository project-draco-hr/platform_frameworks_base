{
  if (DBG)   log("enter setupData!");
  ApnSetting apn;
  GsmDataConnection dc;
  int profileId=getApnProfileID(apnContext.getApnType());
  apn=apnContext.getNextWaitingApn();
  if (apn == null) {
    if (DBG)     log("setupData: return for no apn found!");
    return false;
  }
  dc=findReadyDataConnection(apn);
  if (dc == null) {
    if (DBG)     log("setupData: No ready GsmDataConnection found!");
    dc=findFreeDataConnection();
  }
  if (dc == null) {
    if (DBG)     log("setupData: No free GsmDataConnection found!");
    return false;
  }
  apnContext.setApnSetting(apn);
  apnContext.setDataConnection(dc);
  dc.setProfileId(profileId);
  dc.setActiveApnType(apnContext.getApnType());
  Message msg=obtainMessage();
  msg.what=EVENT_DATA_SETUP_COMPLETE;
  msg.obj=apnContext;
  if (DBG)   log("dc connect!");
  dc.connect(msg,apn);
  apnContext.setState(State.INITING);
  mPhone.notifyDataConnection(apnContext.getReason(),apnContext.getApnType());
  if (DBG)   log("setupData: initing!");
  return true;
}
