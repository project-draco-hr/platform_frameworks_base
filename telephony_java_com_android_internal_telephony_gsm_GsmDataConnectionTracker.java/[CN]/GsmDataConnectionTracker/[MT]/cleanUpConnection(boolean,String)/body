{
  if (DBG)   log("Clean up connection due to " + reason);
  if (mReconnectIntent != null) {
    AlarmManager am=(AlarmManager)mPhone.getContext().getSystemService(Context.ALARM_SERVICE);
    am.cancel(mReconnectIntent);
    mReconnectIntent=null;
  }
  setState(State.DISCONNECTING);
  boolean notificationDeferred=false;
  for (  DataConnection conn : mDataConnections.values()) {
    if (tearDown) {
      if (DBG)       log("cleanUpConnection: teardown, call conn.disconnect");
      conn.disconnect(obtainMessage(EVENT_DISCONNECT_DONE,conn.getDataConnectionId(),0,reason));
      notificationDeferred=true;
    }
 else {
      if (DBG)       log("cleanUpConnection: !tearDown, call conn.resetSynchronously");
      conn.resetSynchronously();
      notificationDeferred=false;
    }
  }
  stopNetStatPoll();
  if (!notificationDeferred) {
    if (DBG)     log("cleanupConnection: !notificationDeferred");
    gotoIdleAndNotifyDataConnection(reason);
  }
}
