{
  ApnContext apnContext=null;
  if (DBG)   log("EVENT_DISCONNECT_DONE connId=" + connId);
  if (ar.userObj instanceof ApnContext) {
    apnContext=(ApnContext)ar.userObj;
  }
 else {
    loge("Invalid ar in onDisconnectDone");
    return;
  }
  apnContext.setState(State.IDLE);
  apnContext.setApnSetting(null);
  if (apnContext.getPendingAction() == ApnContext.PENDING_ACTION_APN_DISABLE) {
    apnContext.setEnabled(false);
    apnContext.setPendingAction(ApnContext.PENDING_ACTION_NONE);
  }
  mPhone.notifyDataConnection(apnContext.getReason(),apnContext.getApnType());
  if (!isConnected()) {
    if (mPhone.getServiceStateTracker().processPendingRadioPowerOffAfterDataOff()) {
      return;
    }
  }
  if (apnContext.isReady() && retryAfterDisconnected(apnContext.getReason())) {
    SystemProperties.set("gsm.defaultpdpcontext.active","false");
    if (apnContext.getPendingAction() == ApnContext.PENDING_ACTION_RECONNECT) {
      apnContext.setPendingAction(ApnContext.PENDING_ACTION_NONE);
    }
    trySetupData(apnContext);
  }
}
