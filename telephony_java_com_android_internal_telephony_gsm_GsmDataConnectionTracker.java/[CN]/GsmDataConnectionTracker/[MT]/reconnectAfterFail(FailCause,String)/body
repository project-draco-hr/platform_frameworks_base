{
  if (mState == State.FAILED) {
    if (!mRetryMgr.isRetryNeeded()) {
      if (!mRequestedApnType.equals(Phone.APN_TYPE_DEFAULT)) {
        notifyDataConnection(Phone.REASON_APN_FAILED);
        onEnableApn(apnTypeToId(mRequestedApnType),DISABLED);
        return;
      }
      if (mReregisterOnReconnectFailure) {
        mRetryMgr.retryForeverUsingLastTimeout();
      }
 else {
        log("PDP activate failed, Reregistering to the network");
        mReregisterOnReconnectFailure=true;
        mGsmPhone.mSST.reRegisterNetwork(null);
        mRetryMgr.resetRetryCount();
        return;
      }
    }
    int nextReconnectDelay=mRetryMgr.getRetryTimer();
    log("PDP activate failed. Scheduling next attempt for " + (nextReconnectDelay / 1000) + "s");
    AlarmManager am=(AlarmManager)mPhone.getContext().getSystemService(Context.ALARM_SERVICE);
    Intent intent=new Intent(INTENT_RECONNECT_ALARM);
    intent.putExtra(INTENT_RECONNECT_ALARM_EXTRA_REASON,reason);
    mReconnectIntent=PendingIntent.getBroadcast(mPhone.getContext(),0,intent,0);
    am.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,SystemClock.elapsedRealtime() + nextReconnectDelay,mReconnectIntent);
    mRetryMgr.increaseRetryCount();
    if (!shouldPostNotification(lastFailCauseCode)) {
      log("NOT Posting GPRS Unavailable notification " + "-- likely transient error");
    }
 else {
      notifyNoData(lastFailCauseCode);
    }
  }
}
