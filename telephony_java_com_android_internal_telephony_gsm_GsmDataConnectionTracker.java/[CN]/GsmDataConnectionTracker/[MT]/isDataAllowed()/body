{
  int gprsState=mGsmPhone.mSST.getCurrentGprsState();
  boolean desiredPowerState=mGsmPhone.mSST.getDesiredPowerState();
  boolean allowed=((gprsState == ServiceState.STATE_IN_SERVICE || noAutoAttach) && mGsmPhone.mSIMRecords.getRecordsLoaded() && phone.getState() == Phone.State.IDLE && mMasterDataEnabled && (!phone.getServiceState().getRoaming() || getDataOnRoamingEnabled()) && !mIsPsRestricted && desiredPowerState);
  if (!allowed && DBG) {
    String reason="";
    if (gprsState != ServiceState.STATE_IN_SERVICE)     reason+=" - gprs= " + gprsState;
    if (!mGsmPhone.mSIMRecords.getRecordsLoaded())     reason+=" - SIM not loaded";
    if (phone.getState() != Phone.State.IDLE) {
      reason+=" - PhoneState= " + phone.getState();
    }
    if (!mMasterDataEnabled)     reason+=" - mMasterDataEnabled= false";
    if (phone.getServiceState().getRoaming() && getDataOnRoamingEnabled()) {
      reason+=" - Roaming";
    }
    if (mIsPsRestricted)     reason+=" - mIsPsRestricted= true";
    if (!desiredPowerState)     reason+=" - desiredPowerState= false";
    log("Data not allowed due to" + reason);
  }
  return allowed;
}
