{
  int gprsState=mGsmPhone.mSST.getCurrentGprsState();
  boolean desiredPowerState=mGsmPhone.mSST.getDesiredPowerState();
  boolean allowed=(gprsState == ServiceState.STATE_IN_SERVICE || mAutoAttachOnCreation) && mGsmPhone.mSIMRecords.getRecordsLoaded() && mPhone.getState() == Phone.State.IDLE && mMasterDataEnabled && (!mPhone.getServiceState().getRoaming() || getDataOnRoamingEnabled()) && !mIsPsRestricted && desiredPowerState;
  if (!allowed && DBG) {
    String reason="";
    if (!((gprsState == ServiceState.STATE_IN_SERVICE) || mAutoAttachOnCreation)) {
      reason+=" - gprs= " + gprsState;
    }
    if (!mGsmPhone.mSIMRecords.getRecordsLoaded())     reason+=" - SIM not loaded";
    if (mPhone.getState() != Phone.State.IDLE) {
      reason+=" - PhoneState= " + mPhone.getState();
    }
    if (!mMasterDataEnabled)     reason+=" - mMasterDataEnabled= false";
    if (mPhone.getServiceState().getRoaming() && getDataOnRoamingEnabled()) {
      reason+=" - Roaming";
    }
    if (mIsPsRestricted)     reason+=" - mIsPsRestricted= true";
    if (!desiredPowerState)     reason+=" - desiredPowerState= false";
    log("Data not allowed due to" + reason);
  }
  return allowed;
}
