{
  String apnType=apnContext.getApnType();
  ApnSetting dunSetting=null;
  if (Phone.APN_TYPE_DUN.equals(apnType)) {
    dunSetting=fetchDunApn();
  }
  DataConnection potential=null;
  for (  ApnContext c : mApnContexts.values()) {
    DataConnection conn=c.getDataConnection();
    if (conn != null) {
      ApnSetting apnSetting=c.getApnSetting();
      if (dunSetting != null) {
        if (dunSetting.equals(apnSetting)) {
switch (c.getState()) {
case CONNECTED:
            if (DBG) {
              log("checkForConnectionForApnContext: apnContext=" + apnContext + " found conn="+ conn);
            }
          return conn;
case CONNECTING:
        potential=conn;
    }
  }
}
 else if (apnSetting != null && apnSetting.canHandleType(apnType)) {
switch (c.getState()) {
case CONNECTED:
    if (DBG) {
      log("checkForConnectionForApnContext: apnContext=" + apnContext + " found conn="+ conn);
    }
  return conn;
case CONNECTING:
potential=conn;
}
}
}
}
if (potential != null) {
if (DBG) {
log("checkForConnectionForApnContext: apnContext=" + apnContext + " found conn="+ potential);
}
return potential;
}
if (DBG) log("checkForConnectionForApnContext: apnContext=" + apnContext + " NO conn");
return null;
}
