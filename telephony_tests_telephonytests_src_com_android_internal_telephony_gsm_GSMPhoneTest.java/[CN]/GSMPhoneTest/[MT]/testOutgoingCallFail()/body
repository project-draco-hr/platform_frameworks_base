{
  Message msg;
  mRadioControl.setNextCallFailCause(CallFailCause.NORMAL_CLEARING);
  mRadioControl.setAutoProgressConnectingCall(false);
  Connection cn=mGSMPhone.dial("+13125551212");
  mRadioControl.progressConnectingCallState();
  do {
    assertNotNull("Message Time Out",mGSMTestHandler.waitForMessage(ANY_MESSAGE));
  }
 while (cn.getState() == Call.State.DIALING);
  mRadioControl.triggerHangupAll();
  msg=mGSMTestHandler.waitForMessage(EVENT_DISCONNECT);
  assertNotNull("Message Time Out",msg);
  assertEquals(Phone.State.IDLE,mGSMPhone.getState());
  assertEquals(Connection.DisconnectCause.NORMAL,cn.getDisconnectCause());
  assertEquals(0,mGSMPhone.getRingingCall().getConnections().size());
  assertEquals(1,mGSMPhone.getForegroundCall().getConnections().size());
  assertEquals(0,mGSMPhone.getBackgroundCall().getConnections().size());
  assertEquals(Call.State.IDLE,mGSMPhone.getRingingCall().getState());
  assertEquals(Call.State.DISCONNECTED,mGSMPhone.getForegroundCall().getState());
  assertEquals(Call.State.IDLE,mGSMPhone.getBackgroundCall().getState());
  assertTrue(mGSMPhone.getForegroundCall().getEarliestCreateTime() > 0);
  assertEquals(0,mGSMPhone.getForegroundCall().getEarliestConnectTime());
  mRadioControl.setNextCallFailCause(CallFailCause.USER_BUSY);
  mRadioControl.setAutoProgressConnectingCall(false);
  cn=mGSMPhone.dial("+13125551212");
  mRadioControl.progressConnectingCallState();
  do {
    assertNotNull("Message Time Out",mGSMTestHandler.waitForMessage(ANY_MESSAGE));
  }
 while (cn.getState() == Call.State.DIALING);
  mRadioControl.triggerHangupAll();
  msg=mGSMTestHandler.waitForMessage(EVENT_DISCONNECT);
  assertNotNull("Message Time Out",msg);
  assertEquals(Phone.State.IDLE,mGSMPhone.getState());
  assertEquals(Connection.DisconnectCause.BUSY,cn.getDisconnectCause());
  assertEquals(0,mGSMPhone.getRingingCall().getConnections().size());
  assertEquals(1,mGSMPhone.getForegroundCall().getConnections().size());
  assertEquals(0,mGSMPhone.getBackgroundCall().getConnections().size());
  assertEquals(Call.State.IDLE,mGSMPhone.getRingingCall().getState());
  assertEquals(Call.State.DISCONNECTED,mGSMPhone.getForegroundCall().getState());
  assertEquals(Call.State.IDLE,mGSMPhone.getBackgroundCall().getState());
  assertTrue(mGSMPhone.getForegroundCall().getEarliestCreateTime() > 0);
  assertEquals(0,mGSMPhone.getForegroundCall().getEarliestConnectTime());
  mRadioControl.setNextCallFailCause(CallFailCause.NO_CIRCUIT_AVAIL);
  mRadioControl.setAutoProgressConnectingCall(false);
  cn=mGSMPhone.dial("+13125551212");
  mRadioControl.progressConnectingCallState();
  do {
    msg=mGSMTestHandler.waitForMessage(ANY_MESSAGE);
    assertNotNull("Message Time Out",msg);
  }
 while (cn.getState() == Call.State.DIALING);
  mRadioControl.triggerHangupAll();
  do {
    msg=mGSMTestHandler.waitForMessage(ANY_MESSAGE);
    assertNotNull("Message Time Out",msg);
  }
 while (!(msg.what == EVENT_PHONE_STATE_CHANGED && mGSMPhone.getState() == Phone.State.IDLE));
  assertEquals(Phone.State.IDLE,mGSMPhone.getState());
  assertEquals(Connection.DisconnectCause.CONGESTION,cn.getDisconnectCause());
  assertEquals(0,mGSMPhone.getRingingCall().getConnections().size());
  assertEquals(1,mGSMPhone.getForegroundCall().getConnections().size());
  assertEquals(0,mGSMPhone.getBackgroundCall().getConnections().size());
  assertEquals(Call.State.IDLE,mGSMPhone.getRingingCall().getState());
  assertEquals(Call.State.DISCONNECTED,mGSMPhone.getForegroundCall().getState());
  assertEquals(Call.State.IDLE,mGSMPhone.getBackgroundCall().getState());
  assertTrue(mGSMPhone.getForegroundCall().getEarliestCreateTime() > 0);
  assertEquals(0,mGSMPhone.getForegroundCall().getEarliestConnectTime());
}
