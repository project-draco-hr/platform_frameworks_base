{
  String userAgent=appAndVersion + " (" + Build.DEVICE+ " "+ Build.ID+ ")";
  if (gzipCapable) {
    userAgent=userAgent + "; gzip";
  }
  mClient=AndroidHttpClient.newInstance(userAgent,cache);
  mResolver=resolver;
  mAppName=appAndVersion;
  mUserAgent=userAgent;
  SchemeRegistry registry=getConnectionManager().getSchemeRegistry();
  for (  String name : registry.getSchemeNames()) {
    Scheme scheme=registry.unregister(name);
    SocketFactory sf=scheme.getSocketFactory();
    if (sf instanceof LayeredSocketFactory) {
      sf=new WrappedLayeredSocketFactory((LayeredSocketFactory)sf);
    }
 else {
      sf=new WrappedSocketFactory(sf);
    }
    registry.register(new Scheme(name,sf,scheme.getDefaultPort()));
  }
}
