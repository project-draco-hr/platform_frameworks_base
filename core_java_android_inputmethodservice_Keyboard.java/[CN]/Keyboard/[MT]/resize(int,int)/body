{
  int numRows=rows.size();
  for (int rowIndex=0; rowIndex < numRows; ++rowIndex) {
    Row row=rows.get(rowIndex);
    int numKeys=row.mKeys.size();
    int totalGap=0;
    int totalWidth=0;
    for (int keyIndex=0; keyIndex < numKeys; ++keyIndex) {
      Key key=row.mKeys.get(keyIndex);
      if (keyIndex > 0) {
        totalGap+=key.gap;
      }
      totalWidth+=key.width;
    }
    if (totalGap + totalWidth > newWidth) {
      int x=0;
      float scaleFactor=(float)(newWidth - totalGap) / totalWidth;
      for (int keyIndex=0; keyIndex < numKeys; ++keyIndex) {
        Key key=row.mKeys.get(keyIndex);
        key.width*=scaleFactor;
        key.x=x;
        x+=key.width + key.gap;
      }
    }
  }
  mTotalWidth=newWidth;
}
