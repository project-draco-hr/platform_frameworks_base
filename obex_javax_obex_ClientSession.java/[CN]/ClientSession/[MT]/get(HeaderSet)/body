{
  if (!mObexConnected) {
    throw new IOException("Not connected to the server");
  }
  setRequestActive();
  ensureOpen();
  HeaderSet head;
  if (header == null) {
    head=new HeaderSet();
  }
 else {
    head=header;
    if (head.nonce != null) {
      mChallengeDigest=new byte[16];
      System.arraycopy(head.nonce,0,mChallengeDigest,0,16);
    }
  }
  if (mConnectionId != null) {
    head.mConnectionID=new byte[4];
    System.arraycopy(mConnectionId,0,head.mConnectionID,0,4);
  }
  if (mLocalSrmSupported) {
    head.setHeader(HeaderSet.SINGLE_RESPONSE_MODE,ObexHelper.OBEX_SRM_ENABLE);
  }
  return new ClientOperation(mMaxTxPacketSize,this,head,true);
}
