{
  if (!isConnected) {
    throw new IOException("Not connected to the server");
  }
synchronized (this) {
    if (isActive) {
      throw new IOException("OBEX request is already being performed");
    }
    isActive=true;
  }
  ensureOpen();
  byte[] head=null;
  if (header != null) {
    if ((header).nonce != null) {
      challengeDigest=new byte[16];
      System.arraycopy((header).nonce,0,challengeDigest,0,16);
    }
    if (connectionID != null) {
      (header).connectionID=new byte[4];
      System.arraycopy(connectionID,0,(header).connectionID,0,4);
    }
    head=ObexHelper.createHeader(header,false);
    if ((head.length + 3) > maxPacketSize) {
      throw new IOException("Packet size exceeds max packet size");
    }
  }
 else {
    if (connectionID != null) {
      head=new byte[5];
      head[0]=(byte)0xCB;
      System.arraycopy(connectionID,0,head,1,4);
    }
  }
  HeaderSet returnHeaderSet=new HeaderSet();
  sendRequest(0x81,head,returnHeaderSet,null);
synchronized (this) {
    isConnected=false;
    isActive=false;
  }
  return returnHeaderSet;
}
