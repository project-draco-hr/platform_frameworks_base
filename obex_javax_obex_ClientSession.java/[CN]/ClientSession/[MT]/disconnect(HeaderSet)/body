{
  if (!mObexConnected) {
    throw new IOException("Not connected to the server");
  }
  setRequestActive();
  ensureOpen();
  byte[] head=null;
  if (header != null) {
    if (header.nonce != null) {
      mChallengeDigest=new byte[16];
      System.arraycopy(header.nonce,0,mChallengeDigest,0,16);
    }
    if (mConnectionId != null) {
      header.mConnectionID=new byte[4];
      System.arraycopy(mConnectionId,0,header.mConnectionID,0,4);
    }
    head=ObexHelper.createHeader(header,false);
    if ((head.length + 3) > maxPacketSize) {
      throw new IOException("Packet size exceeds max packet size");
    }
  }
 else {
    if (mConnectionId != null) {
      head=new byte[5];
      head[0]=(byte)HeaderSet.CONNECTION_ID;
      System.arraycopy(mConnectionId,0,head,1,4);
    }
  }
  HeaderSet returnHeaderSet=new HeaderSet();
  sendRequest(ObexHelper.OBEX_OPCODE_DISCONNECT,head,returnHeaderSet,null);
synchronized (this) {
    mObexConnected=false;
    setRequestInactive();
  }
  return returnHeaderSet;
}
