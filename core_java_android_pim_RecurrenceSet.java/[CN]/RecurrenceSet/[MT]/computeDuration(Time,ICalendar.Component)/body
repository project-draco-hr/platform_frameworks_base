{
  ICalendar.Property durationProperty=component.getFirstProperty("DURATION");
  if (durationProperty != null) {
    return durationProperty.getValue();
  }
  ICalendar.Property dtendProperty=component.getFirstProperty("DTEND");
  if (dtendProperty == null) {
    return "+P0S";
  }
  ICalendar.Parameter endTzidParameter=dtendProperty.getFirstParameter("TZID");
  String endTzid=(endTzidParameter == null) ? start.timezone : endTzidParameter.value;
  Time end=new Time(endTzid);
  end.parse(dtendProperty.getValue());
  long durationMillis=end.toMillis(false) - start.toMillis(false);
  long durationSeconds=(durationMillis / 1000);
  if (start.allDay && (durationSeconds % 86400) == 0) {
    return "P" + (durationSeconds / 86400) + "D";
  }
 else {
    return "P" + durationSeconds + "S";
  }
}
