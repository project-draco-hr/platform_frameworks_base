{
  if ((headsetState & headset) != (prevHeadsetState & headset)) {
    Intent intent=new Intent(Intent.ACTION_HEADSET_PLUG);
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    int state=0;
    int microphone=0;
    if ((headset & HEADSETS_WITH_MIC) != 0) {
      microphone=1;
    }
    if ((headsetState & headset) != 0) {
      state=1;
    }
    intent.putExtra("state",state);
    intent.putExtra("name",headsetName);
    intent.putExtra("microphone",microphone);
    if (LOG)     Log.v(TAG,"Intent.ACTION_HEADSET_PLUG: state: " + state + " name: "+ headsetName+ " mic: "+ microphone);
    ActivityManagerNative.broadcastStickyIntent(intent,null);
  }
}
