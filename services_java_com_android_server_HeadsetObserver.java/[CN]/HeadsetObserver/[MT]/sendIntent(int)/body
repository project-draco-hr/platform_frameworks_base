{
  if ((mHeadsetState & headset) != (mPrevHeadsetState & headset)) {
    Intent intent=new Intent(Intent.ACTION_HEADSET_PLUG);
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    int state=0;
    int microphone=0;
    if ((headset & HEADSETS_WITH_MIC) != 0) {
      microphone=1;
    }
    if ((mHeadsetState & headset) != 0) {
      state=1;
    }
    intent.putExtra("state",state);
    intent.putExtra("name",mHeadsetName);
    intent.putExtra("microphone",microphone);
    if (LOG)     Log.v(TAG,"Intent.ACTION_HEADSET_PLUG: state: " + state + " name: "+ mHeadsetName+ " mic: "+ microphone);
    ActivityManagerNative.broadcastStickyIntent(intent,null);
  }
}
