{
  if (oldLp == null || (newLp.isIdenticalDnses(oldLp) == false)) {
    Collection<InetAddress> dnses=getLikelyReachableDnsServers(newLp);
    if (dnses.size() == 0 && mDefaultDns != null && useDefaultDns) {
      dnses=new ArrayList();
      dnses.add(mDefaultDns);
      if (DBG) {
        loge("no dns provided for netId " + netId + ", so using defaults");
      }
    }
    if (DBG)     log("Setting Dns servers for network " + netId + " to "+ dnses);
    try {
      mNetd.setDnsServersForNetwork(netId,NetworkUtils.makeStrings(dnses),newLp.getDomains());
    }
 catch (    Exception e) {
      loge("Exception in setDnsServersForNetwork: " + e);
    }
    NetworkAgentInfo defaultNai=mNetworkForRequestId.get(mDefaultRequest.requestId);
    if (defaultNai != null && defaultNai.network.netId == netId) {
      setDefaultDnsSystemProperties(dnses);
    }
    flushVmDnsCache();
  }
 else   if (flush) {
    try {
      mNetd.flushNetworkDnsCache(netId);
    }
 catch (    Exception e) {
      loge("Exception in flushNetworkDnsCache: " + e);
    }
    flushVmDnsCache();
  }
}
