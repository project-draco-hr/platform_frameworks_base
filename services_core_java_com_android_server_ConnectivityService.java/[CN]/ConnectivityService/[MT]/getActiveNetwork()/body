{
  enforceAccessPermission();
  final int uid=Binder.getCallingUid();
  final int user=UserHandle.getUserId(uid);
  int vpnNetId=NETID_UNSET;
synchronized (mVpns) {
    final Vpn vpn=mVpns.get(user);
    if (vpn != null && vpn.appliesToUid(uid))     vpnNetId=vpn.getNetId();
  }
  NetworkAgentInfo nai;
  if (vpnNetId != NETID_UNSET) {
synchronized (mNetworkForNetId) {
      nai=mNetworkForNetId.get(vpnNetId);
    }
    if (nai != null)     return nai.network;
  }
  nai=getDefaultNetwork();
  if (nai != null && isNetworkWithLinkPropertiesBlocked(nai.linkProperties,uid))   nai=null;
  return nai != null ? nai.network : null;
}
