{
  networkCapabilities=new NetworkCapabilities(networkCapabilities);
  if (networkAgent.lastValidated) {
    networkCapabilities.addCapability(NET_CAPABILITY_VALIDATED);
  }
 else {
    networkCapabilities.removeCapability(NET_CAPABILITY_VALIDATED);
  }
  if (networkAgent.lastCaptivePortalDetected) {
    networkCapabilities.addCapability(NET_CAPABILITY_CAPTIVE_PORTAL);
  }
 else {
    networkCapabilities.removeCapability(NET_CAPABILITY_CAPTIVE_PORTAL);
  }
  if (!Objects.equals(networkAgent.networkCapabilities,networkCapabilities)) {
synchronized (networkAgent) {
      networkAgent.networkCapabilities=networkCapabilities;
    }
    rematchAllNetworksAndRequests(networkAgent,networkAgent.getCurrentScore(),nascent);
    notifyNetworkCallbacks(networkAgent,ConnectivityManager.CALLBACK_CAP_CHANGED);
  }
}
