{
synchronized (this) {
    if (!mSystemReady) {
      mInitialBroadcast=new Intent(intent);
    }
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
    if (VDBG) {
      log("sendStickyBroadcast: action=" + intent.getAction());
    }
    Bundle options=null;
    final long ident=Binder.clearCallingIdentity();
    if (ConnectivityManager.CONNECTIVITY_ACTION.equals(intent.getAction())) {
      final NetworkInfo ni=intent.getParcelableExtra(ConnectivityManager.EXTRA_NETWORK_INFO);
      if (ni.getType() == ConnectivityManager.TYPE_MOBILE_SUPL) {
        intent.setAction(ConnectivityManager.CONNECTIVITY_ACTION_SUPL);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
      }
 else {
        BroadcastOptions opts=BroadcastOptions.makeBasic();
        opts.setMaxManifestReceiverApiLevel(Build.VERSION_CODES.M);
        options=opts.toBundle();
      }
      final IBatteryStats bs=BatteryStatsService.getService();
      try {
        bs.noteConnectivityChanged(intent.getIntExtra(ConnectivityManager.EXTRA_NETWORK_TYPE,ConnectivityManager.TYPE_NONE),ni != null ? ni.getState().toString() : "?");
      }
 catch (      RemoteException e) {
      }
    }
    try {
      mContext.sendStickyBroadcastAsUser(intent,UserHandle.ALL,options);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
