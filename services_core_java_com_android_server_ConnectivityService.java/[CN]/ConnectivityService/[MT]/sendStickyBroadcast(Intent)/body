{
synchronized (this) {
    if (!mSystemReady) {
      mInitialBroadcast=new Intent(intent);
    }
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
    if (DBG) {
      log("sendStickyBroadcast: action=" + intent.getAction());
    }
    final long ident=Binder.clearCallingIdentity();
    if (ConnectivityManager.CONNECTIVITY_ACTION.equals(intent.getAction())) {
      final NetworkInfo ni=intent.getParcelableExtra(ConnectivityManager.EXTRA_NETWORK_INFO);
      if (ni.getType() == ConnectivityManager.TYPE_MOBILE_SUPL) {
        intent.setAction(ConnectivityManager.CONNECTIVITY_ACTION_SUPL);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
      }
      final IBatteryStats bs=BatteryStatsService.getService();
      try {
        bs.noteConnectivityChanged(intent.getIntExtra(ConnectivityManager.EXTRA_NETWORK_TYPE,ConnectivityManager.TYPE_NONE),ni != null ? ni.getState().toString() : "?");
      }
 catch (      RemoteException e) {
      }
    }
    try {
      mContext.sendStickyBroadcastAsUser(intent,UserHandle.ALL);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
