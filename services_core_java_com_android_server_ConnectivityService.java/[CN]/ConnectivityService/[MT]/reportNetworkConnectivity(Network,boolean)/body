{
  enforceAccessPermission();
  enforceInternetPermission();
  NetworkAgentInfo nai;
  if (network == null) {
    nai=getDefaultNetwork();
  }
 else {
    nai=getNetworkAgentInfoForNetwork(network);
  }
  if (nai == null || nai.networkInfo.getState() == NetworkInfo.State.DISCONNECTING || nai.networkInfo.getState() == NetworkInfo.State.DISCONNECTED) {
    return;
  }
  if (hasConnectivity == nai.lastValidated)   return;
  final int uid=Binder.getCallingUid();
  if (DBG) {
    log("reportNetworkConnectivity(" + nai.network.netId + ", "+ hasConnectivity+ ") by "+ uid);
  }
synchronized (nai) {
    if (!nai.everConnected)     return;
    if (isNetworkWithLinkPropertiesBlocked(nai.linkProperties,uid,false))     return;
    nai.networkMonitor.sendMessage(NetworkMonitor.CMD_FORCE_REEVALUATION,uid);
  }
}
