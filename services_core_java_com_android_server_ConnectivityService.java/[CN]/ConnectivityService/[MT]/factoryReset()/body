{
  enforceConnectivityInternalPermission();
  final int userId=UserHandle.getCallingUserId();
  setAirplaneMode(false);
  for (  String tether : getTetheredIfaces()) {
    untether(tether);
  }
  VpnConfig vpnConfig=getVpnConfig(userId);
  if (vpnConfig != null) {
    if (vpnConfig.legacy) {
      prepareVpn(VpnConfig.LEGACY_VPN,VpnConfig.LEGACY_VPN,userId);
    }
 else {
      setVpnPackageAuthorization(vpnConfig.user,userId,false);
      prepareVpn(vpnConfig.user,VpnConfig.LEGACY_VPN,userId);
    }
  }
}
