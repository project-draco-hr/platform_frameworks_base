{
  enforceConnectivityInternalPermission();
  if (mUserManager.hasUserRestriction(UserManager.DISALLOW_NETWORK_RESET)) {
    return;
  }
  final int userId=UserHandle.getCallingUserId();
  setAirplaneMode(false);
  if (!mUserManager.hasUserRestriction(UserManager.DISALLOW_CONFIG_TETHERING)) {
    for (    String tether : getTetheredIfaces()) {
      untether(tether);
    }
  }
  if (!mUserManager.hasUserRestriction(UserManager.DISALLOW_CONFIG_VPN)) {
synchronized (mVpns) {
      final String alwaysOnPackage=getAlwaysOnVpnPackage(userId);
      if (alwaysOnPackage != null) {
        setAlwaysOnVpnPackage(userId,null,false);
        setVpnPackageAuthorization(alwaysOnPackage,userId,false);
      }
    }
    VpnConfig vpnConfig=getVpnConfig(userId);
    if (vpnConfig != null) {
      if (vpnConfig.legacy) {
        prepareVpn(VpnConfig.LEGACY_VPN,VpnConfig.LEGACY_VPN,userId);
      }
 else {
        setVpnPackageAuthorization(vpnConfig.user,userId,false);
        prepareVpn(null,VpnConfig.LEGACY_VPN,userId);
      }
    }
  }
}
