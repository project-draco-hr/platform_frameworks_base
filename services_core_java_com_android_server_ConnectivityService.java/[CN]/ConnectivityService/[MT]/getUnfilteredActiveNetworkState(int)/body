{
  NetworkInfo info=null;
  LinkProperties lp=null;
  NetworkCapabilities nc=null;
  Network network=null;
  String subscriberId=null;
  NetworkAgentInfo nai=mNetworkForRequestId.get(mDefaultRequest.requestId);
  if (!mLockdownEnabled) {
    int user=UserHandle.getUserId(uid);
synchronized (mVpns) {
      Vpn vpn=mVpns.get(user);
      if (vpn != null && vpn.appliesToUid(uid)) {
        Network[] networks=vpn.getUnderlyingNetworks();
        if (networks != null) {
          if (networks.length > 0) {
            nai=getNetworkAgentInfoForNetwork(networks[0]);
          }
 else {
            nai=null;
          }
        }
      }
    }
  }
  if (nai != null) {
synchronized (nai) {
      info=new NetworkInfo(nai.networkInfo);
      lp=new LinkProperties(nai.linkProperties);
      nc=new NetworkCapabilities(nai.networkCapabilities);
      network=new Network(nai.network);
      subscriberId=(nai.networkMisc != null) ? nai.networkMisc.subscriberId : null;
    }
  }
  return new NetworkState(info,lp,nc,network,subscriberId,null);
}
