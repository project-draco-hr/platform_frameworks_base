{
  NetworkInfo info=null;
  LinkProperties lp=null;
  NetworkCapabilities nc=null;
  Network network=null;
  String subscriberId=null;
  NetworkAgentInfo nai=getDefaultNetwork();
  final Network[] networks=getVpnUnderlyingNetworks(uid);
  if (networks != null) {
    if (networks.length > 0) {
      nai=getNetworkAgentInfoForNetwork(networks[0]);
    }
 else {
      nai=null;
    }
  }
  if (nai != null) {
synchronized (nai) {
      info=new NetworkInfo(nai.networkInfo);
      lp=new LinkProperties(nai.linkProperties);
      nc=new NetworkCapabilities(nai.networkCapabilities);
      network=nai.network;
      subscriberId=(nai.networkMisc != null) ? nai.networkMisc.subscriberId : null;
    }
  }
  return new NetworkState(info,lp,nc,network,subscriberId,null);
}
