{
  if (connected) {
    NetworkInfo info=new NetworkInfo(nai.networkInfo);
    info.setType(type);
    sendConnectedBroadcastDelayed(info,getConnectivityChangeDelay());
  }
 else {
    NetworkInfo info=new NetworkInfo(nai.networkInfo);
    info.setType(type);
    Intent intent=new Intent(ConnectivityManager.CONNECTIVITY_ACTION);
    intent.putExtra(ConnectivityManager.EXTRA_NETWORK_INFO,info);
    intent.putExtra(ConnectivityManager.EXTRA_NETWORK_TYPE,info.getType());
    if (info.isFailover()) {
      intent.putExtra(ConnectivityManager.EXTRA_IS_FAILOVER,true);
      nai.networkInfo.setFailover(false);
    }
    if (info.getReason() != null) {
      intent.putExtra(ConnectivityManager.EXTRA_REASON,info.getReason());
    }
    if (info.getExtraInfo() != null) {
      intent.putExtra(ConnectivityManager.EXTRA_EXTRA_INFO,info.getExtraInfo());
    }
    NetworkAgentInfo newDefaultAgent=null;
    if (nai.networkRequests.get(mDefaultRequest.requestId) != null) {
      newDefaultAgent=mNetworkForRequestId.get(mDefaultRequest.requestId);
      if (newDefaultAgent != null) {
        intent.putExtra(ConnectivityManager.EXTRA_OTHER_NETWORK_INFO,newDefaultAgent.networkInfo);
      }
 else {
        intent.putExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY,true);
      }
    }
    intent.putExtra(ConnectivityManager.EXTRA_INET_CONDITION,mDefaultInetConditionPublished);
    final Intent immediateIntent=new Intent(intent);
    immediateIntent.setAction(CONNECTIVITY_ACTION_IMMEDIATE);
    sendStickyBroadcast(immediateIntent);
    sendStickyBroadcastDelayed(intent,getConnectivityChangeDelay());
    if (newDefaultAgent != null) {
      sendConnectedBroadcastDelayed(newDefaultAgent.networkInfo,getConnectivityChangeDelay());
    }
  }
}
