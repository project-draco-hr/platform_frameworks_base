{
  final int uid=Binder.getCallingUid();
  if (isSystem(uid)) {
    return;
  }
  if (networkCapabilities.hasCapability(NET_CAPABILITY_NOT_METERED) == false) {
    final int uidRules;
synchronized (mRulesLock) {
      uidRules=mUidRules.get(uid,RULE_ALLOW_ALL);
    }
    if (mRestrictBackground && (uidRules & RULE_ALLOW_METERED) == 0 && (uidRules & RULE_TEMPORARY_ALLOW_METERED) == 0) {
      networkCapabilities.addCapability(NET_CAPABILITY_NOT_METERED);
    }
  }
}
