{
  if (!hasWifiNetworkListenPermission(networkCapabilities)) {
    enforceAccessPermission();
  }
  NetworkRequest networkRequest=new NetworkRequest(new NetworkCapabilities(networkCapabilities),TYPE_NONE,nextNetworkRequestId());
  NetworkRequestInfo nri=new NetworkRequestInfo(messenger,networkRequest,binder,NetworkRequestInfo.LISTEN);
  if (DBG)   log("listenForNetwork for " + nri);
  mHandler.sendMessage(mHandler.obtainMessage(EVENT_REGISTER_NETWORK_LISTENER,nri));
  return networkRequest;
}
