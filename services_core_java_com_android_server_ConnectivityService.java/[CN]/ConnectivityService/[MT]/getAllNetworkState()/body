{
  enforceConnectivityInternalPermission();
  final ArrayList<NetworkState> result=Lists.newArrayList();
  for (  Network network : getAllNetworks()) {
    final NetworkAgentInfo nai=getNetworkAgentInfoForNetwork(network);
    if (nai != null) {
synchronized (nai) {
        final String subscriberId=(nai.networkMisc != null) ? nai.networkMisc.subscriberId : null;
        result.add(new NetworkState(nai.networkInfo,nai.linkProperties,nai.networkCapabilities,network,subscriberId,null));
      }
    }
  }
  return result.toArray(new NetworkState[result.size()]);
}
