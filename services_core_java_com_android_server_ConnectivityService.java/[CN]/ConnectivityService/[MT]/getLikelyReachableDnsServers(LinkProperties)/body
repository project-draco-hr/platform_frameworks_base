{
  final ArrayList<InetAddress> dnsServers=new ArrayList<InetAddress>();
  final List<RouteInfo> allRoutes=lp.getAllRoutes();
  for (  InetAddress nameserver : lp.getDnsServers()) {
    final RouteInfo bestRoute=RouteInfo.selectBestRoute(allRoutes,nameserver);
    if (bestRoute == null) {
      continue;
    }
    if (nameserver instanceof Inet4Address) {
      if (!lp.hasIPv4Address()) {
        continue;
      }
    }
 else     if (nameserver instanceof Inet6Address) {
      if (nameserver.isLinkLocalAddress()) {
        if (((Inet6Address)nameserver).getScopeId() == 0) {
          continue;
        }
      }
 else {
        if (bestRoute.isIPv6Default() && !lp.hasGlobalIPv6Address()) {
          continue;
        }
      }
    }
    dnsServers.add(nameserver);
  }
  return Collections.unmodifiableList(dnsServers);
}
