{
  final String alwaysOnPackage;
synchronized (mVpns) {
    Vpn vpn=mVpns.get(userId);
    if (vpn == null) {
      Slog.wtf(TAG,"User " + userId + " has no Vpn configuration");
      return false;
    }
    alwaysOnPackage=vpn.getAlwaysOnPackage();
    if (alwaysOnPackage == null) {
      return true;
    }
    if (vpn.getNetworkInfo().isConnected()) {
      return true;
    }
  }
  Intent serviceIntent=new Intent(VpnConfig.SERVICE_INTERFACE);
  serviceIntent.setPackage(alwaysOnPackage);
  try {
    return mContext.startServiceAsUser(serviceIntent,UserHandle.of(userId)) != null;
  }
 catch (  RuntimeException e) {
    Slog.w(TAG,"VpnService " + serviceIntent + " failed to start",e);
    return false;
  }
}
