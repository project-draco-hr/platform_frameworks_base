{
  NetworkInfo.State state=newInfo.getState();
  NetworkInfo oldInfo=null;
synchronized (networkAgent) {
    oldInfo=networkAgent.networkInfo;
    networkAgent.networkInfo=newInfo;
  }
  if (oldInfo != null && oldInfo.getState() == state) {
    if (VDBG)     log("ignoring duplicate network state non-change");
    return;
  }
  if (DBG) {
    log(networkAgent.name() + " EVENT_NETWORK_INFO_CHANGED, going from " + (oldInfo == null ? "null" : oldInfo.getState())+ " to "+ state);
  }
  if (state == NetworkInfo.State.CONNECTED) {
    try {
      mNetd.createNetwork(networkAgent.network.netId);
    }
 catch (    Exception e) {
      loge("Error creating network " + networkAgent.network.netId + ": "+ e.getMessage());
      return;
    }
    updateLinkProperties(networkAgent,null);
    notifyNetworkCallbacks(networkAgent,ConnectivityManager.CALLBACK_PRECHECK);
    networkAgent.networkMonitor.sendMessage(NetworkMonitor.CMD_NETWORK_CONNECTED);
  }
 else   if (state == NetworkInfo.State.DISCONNECTED || state == NetworkInfo.State.SUSPENDED) {
    networkAgent.asyncChannel.disconnect();
  }
}
