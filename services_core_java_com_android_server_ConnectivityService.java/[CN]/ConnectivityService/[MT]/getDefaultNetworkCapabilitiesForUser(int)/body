{
  enforceAccessPermission();
  HashMap<Network,NetworkCapabilities> result=new HashMap<Network,NetworkCapabilities>();
  NetworkAgentInfo nai=getDefaultNetwork();
  NetworkCapabilities nc=getNetworkCapabilitiesInternal(nai);
  if (nc != null) {
    result.put(nai.network,nc);
  }
  if (!mLockdownEnabled) {
synchronized (mVpns) {
      Vpn vpn=mVpns.get(userId);
      if (vpn != null) {
        Network[] networks=vpn.getUnderlyingNetworks();
        if (networks != null) {
          for (          Network network : networks) {
            nai=getNetworkAgentInfoForNetwork(network);
            nc=getNetworkCapabilitiesInternal(nai);
            if (nc != null) {
              result.put(network,nc);
            }
          }
        }
      }
    }
  }
  NetworkCapabilities[] out=new NetworkCapabilities[result.size()];
  out=result.values().toArray(out);
  return out;
}
