{
  NetworkInfo info=new NetworkInfo(nai.networkInfo);
  info.setType(type);
  if (state != DetailedState.DISCONNECTED) {
    info.setDetailedState(state,null,info.getExtraInfo());
    sendConnectedBroadcast(info);
  }
 else {
    info.setDetailedState(state,info.getReason(),info.getExtraInfo());
    Intent intent=new Intent(ConnectivityManager.CONNECTIVITY_ACTION);
    intent.putExtra(ConnectivityManager.EXTRA_NETWORK_INFO,info);
    intent.putExtra(ConnectivityManager.EXTRA_NETWORK_TYPE,info.getType());
    if (info.isFailover()) {
      intent.putExtra(ConnectivityManager.EXTRA_IS_FAILOVER,true);
      nai.networkInfo.setFailover(false);
    }
    if (info.getReason() != null) {
      intent.putExtra(ConnectivityManager.EXTRA_REASON,info.getReason());
    }
    if (info.getExtraInfo() != null) {
      intent.putExtra(ConnectivityManager.EXTRA_EXTRA_INFO,info.getExtraInfo());
    }
    NetworkAgentInfo newDefaultAgent=null;
    if (nai.networkRequests.get(mDefaultRequest.requestId) != null) {
      newDefaultAgent=mNetworkForRequestId.get(mDefaultRequest.requestId);
      if (newDefaultAgent != null) {
        intent.putExtra(ConnectivityManager.EXTRA_OTHER_NETWORK_INFO,newDefaultAgent.networkInfo);
      }
 else {
        intent.putExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY,true);
      }
    }
    intent.putExtra(ConnectivityManager.EXTRA_INET_CONDITION,mDefaultInetConditionPublished);
    sendStickyBroadcast(intent);
    if (newDefaultAgent != null) {
      sendConnectedBroadcast(newDefaultAgent.networkInfo);
    }
  }
}
