{
  enforceConnectivityInternalPermission();
  enforceCrossUserPermission(userId);
  if (LockdownVpnTracker.isEnabled()) {
    return false;
  }
  final String oldPackage=getAlwaysOnVpnPackage(userId);
  if (TextUtils.equals(oldPackage,packageName)) {
    return true;
  }
synchronized (mVpns) {
    Vpn vpn=mVpns.get(userId);
    if (vpn == null) {
      Slog.w(TAG,"User " + userId + " has no Vpn configuration");
      return false;
    }
    if (!vpn.setAlwaysOnPackage(packageName)) {
      return false;
    }
    if (!updateAlwaysOnVpn(userId)) {
      vpn.setAlwaysOnPackage(null);
      return false;
    }
  }
  return true;
}
