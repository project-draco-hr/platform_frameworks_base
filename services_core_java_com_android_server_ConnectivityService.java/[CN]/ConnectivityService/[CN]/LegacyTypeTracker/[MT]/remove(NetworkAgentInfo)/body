{
  if (VDBG)   log("Removing agent " + nai);
  for (int type=0; type < mTypeLists.length; type++) {
    ArrayList<NetworkAgentInfo> list=mTypeLists[type];
    if (list == null || list.isEmpty()) {
      continue;
    }
    boolean wasFirstNetwork=false;
    if (list.get(0).equals(nai)) {
      wasFirstNetwork=true;
    }
    list.remove(nai);
    if (wasFirstNetwork || isDefaultNetwork(nai)) {
      if (VDBG)       log("Sending disconnected broadcast for type " + type + "isDefaultNetwork="+ isDefaultNetwork(nai));
      sendLegacyNetworkBroadcast(nai,false,type);
    }
    if (!list.isEmpty() && wasFirstNetwork) {
      if (VDBG)       log("Other network available for type " + type + ", sending connected broadcast");
      sendLegacyNetworkBroadcast(list.get(0),false,type);
    }
  }
}
