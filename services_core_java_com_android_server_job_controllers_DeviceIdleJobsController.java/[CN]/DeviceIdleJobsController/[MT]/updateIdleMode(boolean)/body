{
  boolean changed=false;
  if (mDeviceIdleWhitelistAppIds == null) {
    updateWhitelist();
  }
synchronized (mLock) {
    if (mDeviceIdleMode != enabled) {
      changed=true;
    }
    mDeviceIdleMode=enabled;
    if (LOG_DEBUG)     Slog.d(LOG_TAG,"mDeviceIdleMode=" + mDeviceIdleMode);
    mJobSchedulerService.getJobStore().forEachJob(mUpdateFunctor);
  }
  if (changed) {
    mStateChangedListener.onDeviceIdleStateChanged(enabled);
  }
}
