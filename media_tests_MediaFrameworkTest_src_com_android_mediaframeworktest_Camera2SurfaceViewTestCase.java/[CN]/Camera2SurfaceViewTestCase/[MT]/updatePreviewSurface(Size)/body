{
  if (size.equals(mPreviewSize) && mPreviewSurface != null) {
    Log.w(TAG,"Skipping update preview surface size...");
    return;
  }
  mPreviewSize=size;
  Camera2SurfaceViewActivity ctsActivity=getActivity();
  final SurfaceHolder holder=ctsActivity.getSurfaceView().getHolder();
  Handler handler=new Handler(Looper.getMainLooper());
  handler.post(new Runnable(){
    @Override public void run(){
      holder.setFixedSize(mPreviewSize.getWidth(),mPreviewSize.getHeight());
    }
  }
);
  boolean res=ctsActivity.waitForSurfaceSizeChanged(WAIT_FOR_SURFACE_CHANGE_TIMEOUT_MS,mPreviewSize.getWidth(),mPreviewSize.getHeight());
  assertTrue("wait for surface change to " + mPreviewSize.toString() + " timed out",res);
  mPreviewSurface=holder.getSurface();
  assertNotNull("Preview surface is null",mPreviewSurface);
  assertTrue("Preview surface is invalid",mPreviewSurface.isValid());
}
