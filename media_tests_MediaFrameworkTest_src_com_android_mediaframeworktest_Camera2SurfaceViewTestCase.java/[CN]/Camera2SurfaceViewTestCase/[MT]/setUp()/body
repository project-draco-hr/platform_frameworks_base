{
  super.setUp();
  mContext=getActivity();
  System.setProperty("dexmaker.dexcache",mContext.getCacheDir().toString());
  mCameraManager=(CameraManager)mContext.getSystemService(Context.CAMERA_SERVICE);
  assertNotNull("Unable to get CameraManager",mCameraManager);
  mCameraIds=mCameraManager.getCameraIdList();
  assertNotNull("Unable to get camera ids",mCameraIds);
  mHandlerThread=new HandlerThread(TAG);
  mHandlerThread.start();
  mHandler=new Handler(mHandlerThread.getLooper());
  mCameraListener=new BlockingStateCallback();
  mCollector=new CameraErrorCollector();
  mWindowManager=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
  mIterations=getArgumentsAsNumber(ARG_KEY_ITERATIONS,1).intValue();
  mTestWaitIntervalMs=getArgumentsAsNumber(ARG_KEY_WAIT_INTERVAL_MS,1000).longValue();
  mWriteToFile=getArgumentsAsBoolean(ARG_KEY_RESULT_TO_FILE,true);
  Log.i(TAG,"Argument: iteration count=" + mIterations);
  Log.i(TAG,"Argument: interval (ms)=" + mTestWaitIntervalMs);
  Log.i(TAG,"Argument: result to file=" + (mWriteToFile ? "true" : "false"));
  mResultPrinter=new CameraTestResultPrinter(getInstrumentation(),mWriteToFile);
}
