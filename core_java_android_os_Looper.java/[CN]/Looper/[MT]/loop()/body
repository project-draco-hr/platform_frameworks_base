{
  Looper me=myLooper();
  if (me == null) {
    throw new RuntimeException("No Looper; Looper.prepare() wasn't called on this thread.");
  }
  MessageQueue queue=me.mQueue;
  Binder.clearCallingIdentity();
  final long ident=Binder.clearCallingIdentity();
  while (true) {
    Message msg=queue.next();
    if (msg != null) {
      if (msg.target == null) {
        return;
      }
      if (me.mLogging != null)       me.mLogging.println(">>>>> Dispatching to " + msg.target + " "+ msg.callback+ ": "+ msg.what);
      msg.target.dispatchMessage(msg);
      if (me.mLogging != null)       me.mLogging.println("<<<<< Finished to    " + msg.target + " "+ msg.callback);
      final long newIdent=Binder.clearCallingIdentity();
      if (ident != newIdent) {
        Log.wtf("Looper","Thread identity changed from 0x" + Long.toHexString(ident) + " to 0x"+ Long.toHexString(newIdent)+ " while dispatching to "+ msg.target.getClass().getName()+ " "+ msg.callback+ " what="+ msg.what);
      }
      msg.recycle();
    }
  }
}
