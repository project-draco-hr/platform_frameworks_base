{
  mDatabase.beginTransaction();
  try {
    final ContentValues[] valuesList=new ContentValues[roots.length];
    for (int i=0; i < roots.length; i++) {
      if (roots[i].mDeviceId != deviceId) {
        throw new IllegalArgumentException();
      }
      valuesList[i]=new ContentValues();
      getRootDocumentValues(valuesList[i],resources,roots[i]);
    }
    final long[] documentIds=putDocuments(valuesList,SELECTION_ROOT_DOCUMENTS,Integer.toString(deviceId));
    final ContentValues values=new ContentValues();
    int i=0;
    for (    final MtpRoot root : roots) {
      values.put(Root.COLUMN_ROOT_ID,documentIds[i++]);
      values.put(Root.COLUMN_FLAGS,Root.FLAG_SUPPORTS_IS_CHILD | Root.FLAG_SUPPORTS_CREATE);
      values.put(Root.COLUMN_AVAILABLE_BYTES,root.mFreeSpace);
      values.put(Root.COLUMN_CAPACITY_BYTES,root.mMaxCapacity);
      values.put(Root.COLUMN_MIME_TYPES,"");
      mDatabase.insert(TABLE_ROOT_EXTRA,null,values);
    }
    mDatabase.setTransactionSuccessful();
  }
  finally {
    mDatabase.endTransaction();
  }
}
