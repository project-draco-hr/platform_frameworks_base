{
  final AppWindowToken wtoken=mWin.mAppToken;
  if (wtoken != null) {
    if (mWin == wtoken.startingWindow) {
      wtoken.startingDisplayed=false;
    }
  }
  mWin.clearHasSavedSurface();
  if (mSurfaceController == null) {
    return;
  }
  int i=mWin.mChildWindows.size();
  while (!mDestroyPreservedSurfaceUponRedraw && i > 0) {
    i--;
    WindowState c=mWin.mChildWindows.get(i);
    c.mAttachedHidden=true;
  }
  try {
    if (DEBUG_VISIBILITY)     logWithStack(TAG,"Window " + this + " destroying surface "+ mSurfaceController+ ", session "+ mSession);
    if (mSurfaceDestroyDeferred) {
      if (mSurfaceController != null && mPendingDestroySurface != mSurfaceController) {
        if (mPendingDestroySurface != null) {
          if (SHOW_TRANSACTIONS || SHOW_SURFACE_ALLOC) {
            WindowManagerService.logSurface(mWin,"DESTROY PENDING",true);
          }
          mPendingDestroySurface.destroyInTransaction();
        }
        mPendingDestroySurface=mSurfaceController;
      }
    }
 else {
      if (SHOW_TRANSACTIONS || SHOW_SURFACE_ALLOC) {
        WindowManagerService.logSurface(mWin,"DESTROY",true);
      }
      destroySurface();
    }
    if (!mDestroyPreservedSurfaceUponRedraw) {
      mWallpaperControllerLocked.hideWallpapers(mWin);
    }
  }
 catch (  RuntimeException e) {
    Slog.w(TAG,"Exception thrown when destroying Window " + this + " surface "+ mSurfaceController+ " session "+ mSession+ ": "+ e.toString());
  }
  mWin.setHasSurface(false);
  if (mSurfaceController != null) {
    mSurfaceController.setShown(false);
  }
  mSurfaceController=null;
  mDrawState=NO_SURFACE;
}
