{
  if (DEBUG_STARTING_WINDOW && mWin.mAttrs.type == WindowManager.LayoutParams.TYPE_APPLICATION_STARTING) {
    Slog.i(TAG,"commitFinishDrawingLocked: " + mWin + " cur mDrawState="+ drawStateToString());
  }
  if (mDrawState != COMMIT_DRAW_PENDING && mDrawState != READY_TO_SHOW) {
    return false;
  }
  if (DEBUG_SURFACE_TRACE || DEBUG_ANIM) {
    Slog.i(TAG,"commitFinishDrawingLocked: mDrawState=READY_TO_SHOW " + mSurfaceControl);
  }
  mDrawState=READY_TO_SHOW;
  boolean result=false;
  final AppWindowToken atoken=mWin.mAppToken;
  if (atoken == null || atoken.allDrawn || mWin.mAttrs.type == TYPE_APPLICATION_STARTING) {
    result=performShowLocked();
  }
  if (mDestroyPreservedSurfaceUponRedraw && result) {
    mService.mDestroyPreservedSurface.add(mWin);
  }
  return result;
}
