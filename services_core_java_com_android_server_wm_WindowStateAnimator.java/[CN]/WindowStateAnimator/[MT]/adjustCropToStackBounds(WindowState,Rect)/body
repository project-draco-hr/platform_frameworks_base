{
  final AppWindowToken appToken=w.mAppToken;
  if (appToken != null && appToken.mCropWindowsToStack && !appToken.mReplacingWindow) {
    TaskStack stack=w.getTask().mStack;
    stack.getBounds(mTmpStackBounds);
    final int frameX=w.mFrame.left + mWin.mXOffset - w.getAttrs().surfaceInsets.left;
    final int frameY=w.mFrame.top + mWin.mYOffset - w.getAttrs().surfaceInsets.top;
    clipRect.left=Math.max(0,Math.max(mTmpStackBounds.left,frameX + clipRect.left) - frameX);
    clipRect.top=Math.max(0,Math.max(mTmpStackBounds.top,frameY + clipRect.top) - frameY);
    clipRect.right=Math.max(0,Math.min(mTmpStackBounds.right,frameX + clipRect.right) - frameX);
    clipRect.bottom=Math.max(0,Math.min(mTmpStackBounds.bottom,frameY + clipRect.bottom) - frameY);
  }
}
