{
  final AppWindowToken appToken=w.mAppToken;
  final Task task=w.getTask();
  if (task != null && appToken.mCropWindowsToStack && !appToken.mWillReplaceWindow) {
    TaskStack stack=task.mStack;
    stack.getBounds(mTmpStackBounds);
    final boolean isResizing=w.isDragResizing();
    final int frameX=isResizing ? (int)mSurfaceX : w.mFrame.left + mWin.mXOffset - w.getAttrs().surfaceInsets.left;
    final int frameY=isResizing ? (int)mSurfaceY : w.mFrame.top + mWin.mYOffset - w.getAttrs().surfaceInsets.top;
    clipRect.left=Math.max(0,Math.max(mTmpStackBounds.left,frameX + clipRect.left) - frameX);
    clipRect.top=Math.max(0,Math.max(mTmpStackBounds.top,frameY + clipRect.top) - frameY);
    clipRect.right=Math.max(0,Math.min(mTmpStackBounds.right,frameX + clipRect.right) - frameX);
    clipRect.bottom=Math.max(0,Math.min(mTmpStackBounds.bottom,frameY + clipRect.bottom) - frameY);
  }
}
