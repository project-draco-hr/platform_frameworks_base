{
  final AppWindowToken appToken=w.mAppToken;
  if (appToken != null && appToken.mCropWindowsToStack && !appToken.mReplacingWindow) {
    TaskStack stack=w.getTask().mStack;
    stack.getBounds(mTmpStackBounds);
    final int surfaceX=(int)mSurfaceX;
    final int surfaceY=(int)mSurfaceY;
    clipRect.left=Math.max(0,Math.max(mTmpStackBounds.left,surfaceX + clipRect.left) - surfaceX);
    clipRect.top=Math.max(0,Math.max(mTmpStackBounds.top,surfaceY + clipRect.top) - surfaceY);
    clipRect.right=Math.max(0,Math.min(mTmpStackBounds.right,surfaceX + clipRect.right) - surfaceX);
    clipRect.bottom=Math.max(0,Math.min(mTmpStackBounds.bottom,surfaceY + clipRect.bottom) - surfaceY);
  }
}
