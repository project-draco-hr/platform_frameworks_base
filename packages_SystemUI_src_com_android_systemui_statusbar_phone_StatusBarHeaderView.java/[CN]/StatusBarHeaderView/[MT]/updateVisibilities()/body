{
  boolean onKeyguardAndCollapsed=mKeyguardShowing && !mExpanded;
  if (onKeyguardAndCollapsed) {
    setBackground(null);
  }
 else {
    setBackgroundResource(R.drawable.notification_header_bg);
  }
  mDateGroup.setVisibility(onKeyguardAndCollapsed ? View.INVISIBLE : View.VISIBLE);
  mClock.setVisibility(onKeyguardAndCollapsed ? View.INVISIBLE : View.VISIBLE);
  mKeyguardCarrierText.setVisibility(onKeyguardAndCollapsed ? View.VISIBLE : View.GONE);
  mDateCollapsed.setVisibility(mExpanded && !mOverscrolled && mAlarmShowing ? View.VISIBLE : View.INVISIBLE);
  mDateExpanded.setVisibility(mExpanded && !mOverscrolled && mAlarmShowing ? View.INVISIBLE : View.VISIBLE);
  mAlarmStatus.setVisibility(mExpanded && !mOverscrolled && mAlarmShowing ? View.VISIBLE : View.INVISIBLE);
  mSettingsButton.setVisibility(mExpanded && !mOverscrolled ? View.VISIBLE : View.INVISIBLE);
  mQsDetailHeader.setVisibility(mExpanded ? View.VISIBLE : View.GONE);
  if (mStatusIcons != null) {
    mStatusIcons.setVisibility(mKeyguardShowing && (!mExpanded || mOverscrolled) ? View.VISIBLE : View.GONE);
  }
  if (mSignalCluster != null) {
    updateSignalClusterDetachment();
  }
  mEmergencyCallsOnly.setVisibility(mExpanded && !mOverscrolled && mShowEmergencyCallsOnly ? VISIBLE : GONE);
  mMultiUserSwitch.setVisibility(mExpanded || !mKeyguardUserSwitcherShowing ? VISIBLE : GONE);
  mBatteryLevel.setVisibility(mKeyguardShowing && mCharging || mExpanded && !mOverscrolled ? View.VISIBLE : View.GONE);
  if (mExpanded && !mOverscrolled && mKeyguardUserSwitcherShowing) {
    mKeyguardUserSwitcher.hide();
  }
}
