{
  if (newChild == null) {
    throw new IllegalArgumentException("newChild == null!");
  }
  IIOMetadataNode newIIOChild=(IIOMetadataNode)newChild;
  IIOMetadataNode refIIOChild=(IIOMetadataNode)refChild;
  newIIOChild.parent=this;
  if (refIIOChild == null) {
    newIIOChild.nextSibling=null;
    newIIOChild.previousSibling=lastChild;
    lastChild=newIIOChild;
    if (firstChild == null) {
      firstChild=newIIOChild;
    }
  }
 else {
    newIIOChild.nextSibling=refIIOChild;
    newIIOChild.previousSibling=refIIOChild.previousSibling;
    if (firstChild == refIIOChild) {
      firstChild=newIIOChild;
    }
    if (refIIOChild != null) {
      refIIOChild.previousSibling=newIIOChild;
    }
  }
  if (newIIOChild.previousSibling != null) {
    newIIOChild.previousSibling.nextSibling=newIIOChild;
  }
  nChildren++;
  return newIIOChild;
}
