{
  super(context,attrs);
  final DisplayMetrics metrics=context.getResources().getDisplayMetrics();
  TypedArray a=context.obtainStyledAttributes(attrs,R.styleable.ActionBar);
  final int colorFilter=a.getColor(R.styleable.ActionBar_colorFilter,0);
  if (colorFilter != 0) {
    final Drawable d=getBackground();
    d.setDither(true);
    d.setColorFilter(new PorterDuffColorFilter(colorFilter,PorterDuff.Mode.OVERLAY));
  }
  ApplicationInfo info=context.getApplicationInfo();
  PackageManager pm=context.getPackageManager();
  mNavigationMode=a.getInt(R.styleable.ActionBar_navigationMode,ActionBar.NAVIGATION_MODE_STANDARD);
  mTitle=a.getText(R.styleable.ActionBar_title);
  mSubtitle=a.getText(R.styleable.ActionBar_subtitle);
  mDisplayOptions=a.getInt(R.styleable.ActionBar_displayOptions,DISPLAY_DEFAULT);
  mLogo=a.getDrawable(R.styleable.ActionBar_logo);
  if (mLogo == null) {
    mLogo=info.loadLogo(pm);
  }
  mIcon=a.getDrawable(R.styleable.ActionBar_icon);
  if (mIcon == null) {
    mIcon=info.loadIcon(pm);
  }
  Drawable background=a.getDrawable(R.styleable.ActionBar_background);
  if (background != null) {
    setBackgroundDrawable(background);
  }
  final int customNavId=a.getResourceId(R.styleable.ActionBar_customNavigationLayout,0);
  if (customNavId != 0) {
    LayoutInflater inflater=LayoutInflater.from(context);
    mCustomNavView=(View)inflater.inflate(customNavId,null);
    mNavigationMode=ActionBar.NAVIGATION_MODE_CUSTOM;
    addView(mCustomNavView);
  }
  final int padding=a.getDimensionPixelSize(R.styleable.ActionBar_padding,(int)(CONTENT_PADDING_DIP * metrics.density + 0.5f));
  setPadding(padding,padding,padding,padding);
  mContentHeight=a.getDimensionPixelSize(R.styleable.ActionBar_height,(int)(CONTENT_PADDING_DIP * metrics.density + 0.5f)) - padding * 2;
  a.recycle();
  mSpacing=(int)(CONTENT_SPACING_DIP * metrics.density + 0.5f);
  mActionSpacing=(int)(CONTENT_ACTION_SPACING_DIP * metrics.density + 0.5f);
  if (mLogo != null || mIcon != null || mTitle != null) {
    mLogoNavItem=new ActionMenuItem(context,0,android.R.id.home,0,0,mTitle);
    mHomeClickListener=new OnClickListener(){
      public void onClick(      View v){
        Context context=getContext();
        if (context instanceof Activity) {
          Activity activity=(Activity)context;
          activity.onOptionsItemSelected(mLogoNavItem);
        }
      }
    }
;
  }
}
