{
  if (menu == mOptionsMenu)   return;
  if (mOptionsMenu != null) {
    mOptionsMenu.removeMenuPresenter(mMenuPresenter);
  }
  MenuBuilder builder=(MenuBuilder)menu;
  mOptionsMenu=builder;
  if (mMenuView != null) {
    removeView(mMenuView);
  }
  if (mMenuPresenter == null) {
    mMenuPresenter=new ActionMenuPresenter();
    mMenuPresenter.setCallback(cb);
  }
  builder.addMenuPresenter(mMenuPresenter);
  final ActionMenuView menuView=(ActionMenuView)mMenuPresenter.getMenuView(this);
  final LayoutParams layoutParams=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.MATCH_PARENT);
  menuView.setLayoutParams(layoutParams);
  if (!mSplitActionBar) {
    addView(menuView);
  }
 else {
    mMenuPresenter.setWidthLimit(getContext().getResources().getDisplayMetrics().widthPixels,true);
    mMenuPresenter.setItemLimit(Integer.MAX_VALUE);
    layoutParams.width=LayoutParams.MATCH_PARENT;
    if (mSplitView != null) {
      mSplitView.addView(menuView);
    }
  }
  mMenuView=menuView;
}
