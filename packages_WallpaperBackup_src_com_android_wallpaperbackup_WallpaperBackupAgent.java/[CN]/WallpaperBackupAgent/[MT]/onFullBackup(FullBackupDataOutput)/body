{
  final File filesDir=getFilesDir();
  final File infoStage=new File(filesDir,INFO_STAGE);
  final File imageStage=new File(filesDir,IMAGE_STAGE);
  final File empty=new File(filesDir,EMPTY_SENTINEL);
  try {
    FileOutputStream touch=new FileOutputStream(empty);
    touch.close();
    fullBackupFile(empty,data);
    if (mWm.isWallpaperBackupEligible()) {
      if (DEBUG) {
        Slog.v(TAG,"Wallpaper is backup-eligible; linking & writing");
      }
      infoStage.delete();
      imageStage.delete();
      Os.link(mWallpaperInfo.getCanonicalPath(),infoStage.getCanonicalPath());
      fullBackupFile(infoStage,data);
      Os.link(mWallpaperFile.getCanonicalPath(),imageStage.getCanonicalPath());
      fullBackupFile(imageStage,data);
    }
 else {
      if (DEBUG) {
        Slog.v(TAG,"Wallpaper not backup-eligible; writing no data");
      }
    }
  }
 catch (  Exception e) {
    Slog.e(TAG,"Unable to back up wallpaper: " + e.getMessage());
  }
 finally {
    if (DEBUG) {
      Slog.v(TAG,"Removing backup stage links");
    }
    infoStage.delete();
    imageStage.delete();
  }
}
