{
  if (DEBUG) {
    Slog.v(TAG,"onRestoreFinished()");
  }
  final File infoStage=new File(getFilesDir(),INFO_STAGE);
  final File imageStage=new File(getFilesDir(),IMAGE_STAGE);
  try {
    if (imageStage.exists()) {
      if (DEBUG) {
        Slog.v(TAG,"Got restored wallpaper; applying");
      }
      Rect cropHint=parseCropHint(infoStage);
      if (cropHint != null) {
        if (DEBUG) {
          Slog.v(TAG,"Restored crop hint " + cropHint + "; now writing data");
        }
        WallpaperManager wm=getSystemService(WallpaperManager.class);
        try (FileInputStream in=new FileInputStream(imageStage)){
          wm.setStream(in,cropHint,true,WallpaperManager.FLAG_SYSTEM);
        }
  finally {
        }
      }
    }
  }
 catch (  Exception e) {
    Slog.e(TAG,"Unable to restore wallpaper: " + e.getMessage());
  }
 finally {
    if (DEBUG) {
      Slog.v(TAG,"Removing restore stage files");
    }
    infoStage.delete();
    imageStage.delete();
  }
}
