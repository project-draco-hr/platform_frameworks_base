{
  super.onCreate(savedInstanceState);
  Intent intentReceived=getIntent();
  String className=intentReceived.getComponent().getClassName();
  final int targetUserId;
  final int userMessageId;
  if (className.equals(FORWARD_INTENT_TO_USER_OWNER)) {
    userMessageId=com.android.internal.R.string.forward_intent_to_owner;
    targetUserId=UserHandle.USER_OWNER;
  }
 else   if (className.equals(FORWARD_INTENT_TO_MANAGED_PROFILE)) {
    userMessageId=com.android.internal.R.string.forward_intent_to_work;
    targetUserId=getManagedProfile();
  }
 else {
    Slog.wtf(TAG,IntentForwarderActivity.class.getName() + " cannot be called directly");
    userMessageId=-1;
    targetUserId=UserHandle.USER_NULL;
  }
  if (targetUserId == UserHandle.USER_NULL) {
    finish();
    return;
  }
  Intent newIntent=new Intent(intentReceived);
  newIntent.setComponent(null);
  newIntent.setPackage(null);
  newIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT | Intent.FLAG_ACTIVITY_PREVIOUS_IS_TOP);
  int callingUserId=getUserId();
  if (canForward(newIntent,targetUserId)) {
    if (newIntent.getAction().equals(Intent.ACTION_CHOOSER)) {
      Intent innerIntent=(Intent)newIntent.getParcelableExtra(Intent.EXTRA_INTENT);
      innerIntent.setContentUserHint(callingUserId);
    }
 else {
      newIntent.setContentUserHint(callingUserId);
    }
    final android.content.pm.ResolveInfo ri=getPackageManager().resolveActivityAsUser(newIntent,MATCH_DEFAULT_ONLY,targetUserId);
    final boolean shouldShowDisclosure=!UserHandle.isSameApp(ri.activityInfo.applicationInfo.uid,Process.SYSTEM_UID);
    try {
      startActivityAsCaller(newIntent,null,targetUserId);
    }
 catch (    RuntimeException e) {
      int launchedFromUid=-1;
      String launchedFromPackage="?";
      try {
        launchedFromUid=ActivityManagerNative.getDefault().getLaunchedFromUid(getActivityToken());
        launchedFromPackage=ActivityManagerNative.getDefault().getLaunchedFromPackage(getActivityToken());
      }
 catch (      RemoteException ignored) {
      }
      Slog.wtf(TAG,"Unable to launch as UID " + launchedFromUid + " package "+ launchedFromPackage+ ", while running in "+ ActivityThread.currentProcessName(),e);
    }
    if (shouldShowDisclosure) {
      Toast.makeText(this,getString(userMessageId),Toast.LENGTH_LONG).show();
    }
  }
 else {
    Slog.wtf(TAG,"the intent: " + newIntent + "cannot be forwarded from user "+ callingUserId+ " to user "+ targetUserId);
  }
  finish();
}
