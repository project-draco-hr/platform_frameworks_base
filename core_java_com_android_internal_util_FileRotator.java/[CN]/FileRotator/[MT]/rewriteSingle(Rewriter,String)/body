{
  if (LOGD)   Slog.d(TAG,"rewriting " + name);
  final File file=new File(mBasePath,name);
  final File backupFile;
  rewriter.reset();
  if (file.exists()) {
    readFile(file,rewriter);
    if (!rewriter.shouldWrite())     return;
    backupFile=new File(mBasePath,name + SUFFIX_BACKUP);
    file.renameTo(backupFile);
    try {
      writeFile(file,rewriter);
      backupFile.delete();
    }
 catch (    Throwable t) {
      file.delete();
      backupFile.renameTo(file);
      throw rethrowAsIoException(t);
    }
  }
 else {
    backupFile=new File(mBasePath,name + SUFFIX_NO_BACKUP);
    backupFile.createNewFile();
    try {
      writeFile(file,rewriter);
      backupFile.delete();
    }
 catch (    Throwable t) {
      file.delete();
      backupFile.delete();
      throw rethrowAsIoException(t);
    }
  }
}
