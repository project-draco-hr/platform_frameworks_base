{
  VMRuntime r=VMRuntime.getRuntime();
  final boolean RUN_FLAKY=false;
  long origSize=r.getMinimumHeapSize();
  if (RUN_FLAKY) {
    assertTrue(origSize == 0);
  }
  long size=4 * 1024 * 1024;
  long oldSize=r.setMinimumHeapSize(size);
  assertTrue(oldSize == origSize);
  long newSize=r.getMinimumHeapSize();
  assertTrue(newSize == size);
  newSize=r.getMinimumHeapSize();
  assertTrue(newSize == size);
  if (RUN_FLAKY) {
    WeakReference ref=newRef();
    assertNotNull(ref.get());
    r.setMinimumHeapSize(8 * 1024 * 1024);
    allocateMemory(4 * 1024 * 1024);
    assertNotNull(ref.get());
  }
  r.setMinimumHeapSize(origSize);
  newSize=r.getMinimumHeapSize();
  assertTrue(newSize == origSize);
  Runtime.getRuntime().gc();
}
