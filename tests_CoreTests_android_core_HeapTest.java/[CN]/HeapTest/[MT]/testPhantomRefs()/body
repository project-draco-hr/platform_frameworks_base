{
  final int NUM_REFS=16;
  Object objects[]=new Object[NUM_REFS];
  PhantomReference<Object> refs[]=new PhantomReference[objects.length];
  ReferenceQueue<Object> queue=new ReferenceQueue<Object>();
  makeRefs(objects,refs,queue);
  Runtime.getRuntime().gc();
  checkRefs(objects,refs,queue);
  for (int i=0; i < objects.length; i+=2) {
    objects[i]=null;
  }
  Runtime.getRuntime().gc();
  Runtime.getRuntime().runFinalization();
  checkRefs(objects,refs,queue);
  for (int i=0; i < objects.length; i++) {
    objects[i]=null;
  }
  Runtime.getRuntime().gc();
  Runtime.getRuntime().runFinalization();
  checkRefs(objects,refs,queue);
}
