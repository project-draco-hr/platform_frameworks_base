{
  final ActionMenu menu=mActionMenu;
  if (menu == null) {
    return;
  }
  final Context context=getContext();
  int childCount=getChildCount();
  int childIndex=0;
  while (childIndex < childCount) {
    View v=getChildAt(childIndex);
    if (v instanceof ActionView) {
      detachViewFromParent(childIndex);
      childCount--;
    }
 else {
      childIndex++;
    }
  }
  ArrayList<ActionView> detachedViews=new ArrayList<ActionView>(mActions);
  final int itemCount=menu.size();
  for (int i=0; i < itemCount; i++) {
    final MenuItem item=menu.getItem(i);
    boolean newView=false;
    ActionView actionView=findActionViewForItem(item);
    if (actionView == null) {
      actionView=new ActionView(context);
      newView=true;
    }
    actionView.actionId=item.getItemId();
    actionView.menuItem=item;
    actionView.actionLabel=item.getTitle();
    actionView.setAdjustViewBounds(true);
    actionView.setImageDrawable(item.getIcon());
    actionView.setOnClickListener(mActionClickHandler);
    LayoutParams layoutParams=new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.MATCH_PARENT,LayoutParams.ITEM_TYPE_ACTION);
    actionView.setLayoutParams(layoutParams);
    if (newView) {
      addView(actionView);
      mActions.add(actionView);
    }
 else {
      attachViewToParent(actionView,-1,layoutParams);
      detachedViews.remove(actionView);
      actionView.invalidate();
    }
  }
  final int detachedCount=detachedViews.size();
  for (int i=0; i < detachedCount; i++) {
    removeDetachedView(detachedViews.get(i),false);
  }
  requestLayout();
}
