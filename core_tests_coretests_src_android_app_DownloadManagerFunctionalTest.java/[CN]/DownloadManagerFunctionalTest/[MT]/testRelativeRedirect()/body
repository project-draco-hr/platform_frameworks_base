{
  Uri uri=getServerUri(DEFAULT_FILENAME);
  final MockResponse resp=buildResponse(HTTP_REDIRECT);
  resp.setHeader("Location",":" + uri.getSchemeSpecificPart());
  enqueueResponse(resp);
  byte[] blobData=generateData(DEFAULT_FILE_SIZE,DataType.TEXT);
  enqueueResponse(buildResponse(HTTP_OK,blobData));
  Request request=new Request(uri);
  request.setTitle(DEFAULT_FILENAME);
  long dlRequest=mDownloadManager.enqueue(request);
  waitForDownloadOrTimeout(dlRequest);
  verifyAndCleanupSingleFileDownload(dlRequest,blobData);
  assertEquals(1,mReceiver.numDownloadsCompleted());
}
