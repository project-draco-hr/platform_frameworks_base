{
  int fileSize=1024 * 1024;
  byte[] blobData=generateData(fileSize,DataType.BINARY);
  long dlRequest=-1;
  boolean spaceAvailable=true;
  while (spaceAvailable) {
    dlRequest=enqueueDownloadRequest(blobData,DOWNLOAD_TO_DOWNLOAD_CACHE_DIR);
    waitForDownloadOrTimeout(dlRequest);
    StatFs fs=new StatFs(Environment.getDownloadCacheDirectory().getAbsolutePath());
    int availableBytes=fs.getBlockSize() * fs.getAvailableBlocks();
    Log.i(TAG,"available space in /cache: " + availableBytes);
    spaceAvailable=(availableBytes > fileSize) ? true : false;
  }
  dlRequest=enqueueDownloadRequest(blobData,DOWNLOAD_TO_DOWNLOAD_CACHE_DIR);
  waitForDownloadOrTimeout(dlRequest);
  Cursor cursor=getCursor(dlRequest);
  try {
    verifyInt(cursor,DownloadManager.COLUMN_REASON,DownloadManager.ERROR_INSUFFICIENT_SPACE);
  }
  finally {
    cursor.close();
  }
}
