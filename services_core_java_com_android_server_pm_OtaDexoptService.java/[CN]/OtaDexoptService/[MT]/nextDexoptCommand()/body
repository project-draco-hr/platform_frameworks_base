{
  if (mDexoptPackages == null) {
    throw new IllegalStateException("dexoptNextPackage() called before prepare()");
  }
  for (; ; ) {
    String next=getNextPackageDexopt();
    if (next != null) {
      return next;
    }
    if (mDexoptPackages.isEmpty()) {
      return "Nothing to do";
    }
    PackageParser.Package nextPackage=mDexoptPackages.remove(0);
    if (DEBUG_DEXOPT) {
      Log.i(TAG,"Processing " + nextPackage.packageName + " for OTA dexopt.");
    }
    generatePackageDexopts(nextPackage);
    if (mCommandsForCurrentPackage != null && mCommandsForCurrentPackage.isEmpty()) {
      cleanup();
      throw new IllegalStateException("mPackageDexopts empty for " + nextPackage);
    }
  }
}
