{
  RecordingInstallerConnection collectingConnection=new RecordingInstallerConnection();
  Installer collectingInstaller=new Installer(mContext,collectingConnection);
  PackageDexOptimizer optimizer=new OTADexoptPackageDexOptimizer(collectingInstaller,mPackageManagerService.mInstallLock,mContext);
  optimizer.performDexOpt(pkg,pkg.usesLibraryFiles,null,false,getCompilerFilterForReason(compilationReason),null);
  return collectingConnection.commands;
}
