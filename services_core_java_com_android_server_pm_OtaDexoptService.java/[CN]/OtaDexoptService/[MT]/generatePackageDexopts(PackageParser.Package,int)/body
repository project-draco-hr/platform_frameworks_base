{
  RecordingInstallerConnection collectingConnection=new RecordingInstallerConnection();
  Installer collectingInstaller=new Installer(mContext,collectingConnection);
  PackageDexOptimizer optimizer=new OTADexoptPackageDexOptimizer(collectingInstaller,mPackageManagerService.mInstallLock,mContext);
  String[] libraryDependencies=pkg.usesLibraryFiles;
  if (pkg.isSystemApp()) {
    libraryDependencies=NO_LIBRARIES;
  }
  optimizer.performDexOpt(pkg,libraryDependencies,null,false,getCompilerFilterForReason(compilationReason),null);
  return collectingConnection.commands;
}
