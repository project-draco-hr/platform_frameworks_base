{
  final Map<String,List<ContentValues>> contentValuesListMap=new HashMap<String,List<ContentValues>>();
  boolean dataExists=false;
  EntityIterator entityIterator=null;
  try {
    final Uri uri=RawContacts.CONTENT_URI.buildUpon().appendEncodedPath(contactId).appendEncodedPath(RawContacts.Entity.CONTENT_DIRECTORY).appendQueryParameter(Data.FOR_EXPORT_ONLY,"1").build();
    entityIterator=RawContacts.newEntityIterator(mContentResolver.query(uri,null,null,null,null));
    dataExists=entityIterator.hasNext();
    while (entityIterator.hasNext()) {
      Entity entity=entityIterator.next();
      for (      NamedContentValues namedContentValues : entity.getSubValues()) {
        ContentValues contentValues=namedContentValues.values;
        String key=contentValues.getAsString(Data.MIMETYPE);
        if (key != null) {
          List<ContentValues> contentValuesList=contentValuesListMap.get(key);
          if (contentValuesList == null) {
            contentValuesList=new ArrayList<ContentValues>();
            contentValuesListMap.put(key,contentValuesList);
          }
          contentValuesList.add(contentValues);
        }
      }
    }
  }
 catch (  RemoteException e) {
    Log.e(LOG_TAG,String.format("RemoteException at id %s (%s)",contactId,e.getMessage()));
    return "";
  }
 finally {
    if (entityIterator != null) {
      entityIterator.close();
    }
  }
  if (!dataExists) {
    return "";
  }
  final VCardBuilder builder=new VCardBuilder(mVCardType);
  builder.appendNameProperties(contentValuesListMap.get(StructuredName.CONTENT_ITEM_TYPE)).appendNickNames(contentValuesListMap.get(Nickname.CONTENT_ITEM_TYPE)).appendPhones(contentValuesListMap.get(Phone.CONTENT_ITEM_TYPE)).appendEmails(contentValuesListMap.get(Email.CONTENT_ITEM_TYPE)).appendPostals(contentValuesListMap.get(StructuredPostal.CONTENT_ITEM_TYPE)).appendOrganizations(contentValuesListMap.get(Organization.CONTENT_ITEM_TYPE)).appendWebsites(contentValuesListMap.get(Website.CONTENT_ITEM_TYPE)).appendPhotos(contentValuesListMap.get(Photo.CONTENT_ITEM_TYPE)).appendNotes(contentValuesListMap.get(Note.CONTENT_ITEM_TYPE)).appendEvents(contentValuesListMap.get(Event.CONTENT_ITEM_TYPE)).appendIms(contentValuesListMap.get(Im.CONTENT_ITEM_TYPE)).appendRelation(contentValuesListMap.get(Relation.CONTENT_ITEM_TYPE));
  return builder.toString();
}
