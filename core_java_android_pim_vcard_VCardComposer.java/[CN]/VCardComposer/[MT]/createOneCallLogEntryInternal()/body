{
  final StringBuilder builder=new StringBuilder();
  appendVCardLine(builder,VCARD_PROPERTY_BEGIN,VCARD_DATA_VCARD);
  if (mIsV30) {
    appendVCardLine(builder,VCARD_PROPERTY_VERSION,Constants.VERSION_V30);
  }
 else {
    appendVCardLine(builder,VCARD_PROPERTY_VERSION,Constants.VERSION_V21);
  }
  String name=mCursor.getString(CALLER_NAME_COLUMN_INDEX);
  if (TextUtils.isEmpty(name)) {
    name=mCursor.getString(NUMBER_COLUMN_INDEX);
  }
  boolean needCharset=!(VCardUtils.containsOnlyAscii(name));
  appendVCardLine(builder,VCARD_PROPERTY_FULL_NAME,name,needCharset,false);
  appendVCardLine(builder,VCARD_PROPERTY_NAME,name,needCharset,false);
  String number=mCursor.getString(NUMBER_COLUMN_INDEX);
  int type=mCursor.getInt(CALLER_NUMBERTYPE_COLUMN_INDEX);
  String label=mCursor.getString(CALLER_NUMBERLABEL_COLUMN_INDEX);
  if (TextUtils.isEmpty(label)) {
    label=Integer.toString(type);
  }
  appendVCardTelephoneLine(builder,type,label,number);
  long date=mCursor.getLong(DATE_COLUMN_INDEX);
  String dateClause=formatDate(date);
  int callLogType=mCursor.getInt(CALL_TYPE_COLUMN_INDEX);
  String timestampFeldString=createCallHistoryTimeStampField(callLogType);
  if (timestampFeldString != null) {
    appendVCardLine(builder,timestampFeldString,dateClause);
  }
  appendVCardLine(builder,VCARD_PROPERTY_END,VCARD_DATA_VCARD);
  return builder.toString();
}
