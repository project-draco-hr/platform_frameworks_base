{
  byte[] dataBytes=new byte[data.size()];
  try {
    data.read(dataBytes);
    String dataString=new String(dataBytes,JSON_FORMAT_ENCODING);
    JSONObject dataJSON=new JSONObject(dataString);
    boolean masterSyncEnabled=dataJSON.getBoolean(KEY_MASTER_SYNC_ENABLED);
    JSONArray accountJSONArray=dataJSON.getJSONArray(KEY_ACCOUNTS);
    boolean currentMasterSyncEnabled=ContentResolver.getMasterSyncAutomatically();
    if (currentMasterSyncEnabled) {
      ContentResolver.setMasterSyncAutomatically(false);
    }
    try {
      HashSet<Account> currentAccounts=getAccountsHashSet();
      for (int i=0; i < accountJSONArray.length(); i++) {
        JSONObject accountJSON=(JSONObject)accountJSONArray.get(i);
        String accountName=accountJSON.getString(KEY_ACCOUNT_NAME);
        String accountType=accountJSON.getString(KEY_ACCOUNT_TYPE);
        Account account=new Account(accountName,accountType);
        if (currentAccounts.contains(account)) {
          restoreExistingAccountSyncSettingsFromJSON(accountJSON);
        }
      }
    }
  finally {
      ContentResolver.setMasterSyncAutomatically(masterSyncEnabled);
    }
    Log.i(TAG,"Restore successful.");
  }
 catch (  IOException|JSONException e) {
    Log.e(TAG,"Couldn't restore account sync settings\n" + e);
  }
}
