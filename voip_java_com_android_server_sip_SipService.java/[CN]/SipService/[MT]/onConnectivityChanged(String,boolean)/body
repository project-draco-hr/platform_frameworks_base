{
  if (DEBUG)   Log.d(TAG,"onConnectivityChanged(): " + mNetworkType + (mConnected ? " CONNECTED" : " DISCONNECTED")+ " --> "+ type+ (connected ? " CONNECTED" : " DISCONNECTED"));
  boolean sameType=type.equals(mNetworkType);
  if (!sameType && !connected)   return;
  boolean wasWifi="WIFI".equalsIgnoreCase(mNetworkType);
  boolean isWifi="WIFI".equalsIgnoreCase(type);
  boolean wifiOff=(isWifi && !connected) || (wasWifi && !sameType);
  boolean wifiOn=isWifi && connected;
  try {
    boolean wasConnected=mConnected;
    mNetworkType=type;
    mConnected=connected;
    if (wasConnected) {
      mLocalIp=null;
      for (      SipSessionGroupExt group : mSipGroups.values()) {
        group.onConnectivityChanged(false);
      }
    }
    if (connected) {
      mLocalIp=determineLocalIp();
      mKeepAliveInterval=-1;
      for (      SipSessionGroupExt group : mSipGroups.values()) {
        group.onConnectivityChanged(true);
      }
      if (isWifi && (mWifiLock != null))       stopWifiScanner();
    }
 else {
      mMyWakeLock.reset();
      stopPortMappingMeasurement();
      if (isWifi && (mWifiLock != null))       startWifiScanner();
    }
  }
 catch (  SipException e) {
    Log.e(TAG,"onConnectivityChanged()",e);
  }
}
