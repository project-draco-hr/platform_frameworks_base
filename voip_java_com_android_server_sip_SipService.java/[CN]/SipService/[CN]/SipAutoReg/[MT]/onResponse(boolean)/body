{
synchronized (SipService.this) {
    if (portChanged) {
      int interval=getKeepAliveInterval();
      if (mKeepAliveSuccessCount < MIN_KEEPALIVE_SUCCESS_COUNT) {
        if (SAR_DBG) {
          log("onResponse: keepalive doesn't work with interval " + interval + ", past success count="+ mKeepAliveSuccessCount);
        }
        if (interval > DEFAULT_KEEPALIVE_INTERVAL) {
          restartPortMappingLifetimeMeasurement(mSession.getLocalProfile(),interval);
          mKeepAliveSuccessCount=0;
        }
      }
 else {
        if (SAR_DBG) {
          log("keep keepalive going with interval " + interval + ", past success count="+ mKeepAliveSuccessCount);
        }
        mKeepAliveSuccessCount/=2;
      }
    }
 else {
      startPortMappingLifetimeMeasurement(mSession.getLocalProfile());
      mKeepAliveSuccessCount++;
    }
    if (!mRunning || !portChanged)     return;
    mKeepAliveSession=null;
    mMyWakeLock.acquire(mSession);
    mSession.register(EXPIRY_TIME);
  }
}
