{
synchronized (SipService.this) {
    if (!portChanged) {
      if (++mPassCounter != PASS_THRESHOLD)       return;
      mKeepAliveInterval=mMinInterval=mInterval;
      if (DEBUG) {
        Log.d(TAG,"measured good keepalive interval: " + mKeepAliveInterval);
      }
      onKeepAliveIntervalChanged();
    }
 else {
      mMaxInterval=mInterval;
    }
    if ((mMaxInterval - mMinInterval) < MIN_INTERVAL) {
      stop();
      mKeepAliveInterval=mMinInterval;
      if (DEBUG) {
        Log.d(TAG,"measured keepalive interval: " + mKeepAliveInterval);
      }
    }
 else {
      mInterval=(mMaxInterval + mMinInterval) / 2;
      mPassCounter=0;
      if (DEBUG) {
        Log.d(TAG,"current interval: " + mKeepAliveInterval + ", test new interval: "+ mInterval);
      }
      restart();
    }
  }
}
