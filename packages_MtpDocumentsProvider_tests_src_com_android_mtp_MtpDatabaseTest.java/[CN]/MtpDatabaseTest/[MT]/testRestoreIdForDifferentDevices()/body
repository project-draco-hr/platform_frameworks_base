{
  final String[] columns=new String[]{DocumentsContract.Document.COLUMN_DOCUMENT_ID,MtpDatabaseConstants.COLUMN_STORAGE_ID,DocumentsContract.Document.COLUMN_DISPLAY_NAME};
  final String[] rootColumns=new String[]{Root.COLUMN_ROOT_ID,Root.COLUMN_AVAILABLE_BYTES};
  mDatabase.getMapper().startAddingDocuments(null);
  mDatabase.getMapper().putDeviceDocument(new MtpDeviceRecord(0,"Device A",true,new MtpRoot[0]));
  mDatabase.getMapper().putDeviceDocument(new MtpDeviceRecord(1,"Device B",true,new MtpRoot[0]));
  mDatabase.getMapper().stopAddingDocuments(null);
  mDatabase.getMapper().startAddingDocuments("1");
  mDatabase.getMapper().startAddingDocuments("2");
  mDatabase.getMapper().putStorageDocuments("1",resources,new MtpRoot[]{new MtpRoot(0,100,"Device A","Storage",0,0,"")});
  mDatabase.getMapper().putStorageDocuments("2",resources,new MtpRoot[]{new MtpRoot(1,100,"Device B","Storage",0,0,"")});
{
    final Cursor cursor=mDatabase.queryRootDocuments(columns);
    assertEquals(2,cursor.getCount());
    cursor.moveToNext();
    assertEquals(3,getInt(cursor,COLUMN_DOCUMENT_ID));
    assertEquals(100,getInt(cursor,COLUMN_STORAGE_ID));
    assertEquals("Device A Storage",getString(cursor,COLUMN_DISPLAY_NAME));
    cursor.moveToNext();
    assertEquals(4,getInt(cursor,COLUMN_DOCUMENT_ID));
    assertEquals(100,getInt(cursor,COLUMN_STORAGE_ID));
    assertEquals("Device B Storage",getString(cursor,COLUMN_DISPLAY_NAME));
    cursor.close();
  }
{
    final Cursor cursor=mDatabase.queryRoots(rootColumns);
    assertEquals(2,cursor.getCount());
    cursor.moveToNext();
    assertEquals(3,getInt(cursor,Root.COLUMN_ROOT_ID));
    assertEquals(0,getInt(cursor,Root.COLUMN_AVAILABLE_BYTES));
    cursor.moveToNext();
    assertEquals(4,getInt(cursor,Root.COLUMN_ROOT_ID));
    assertEquals(0,getInt(cursor,Root.COLUMN_AVAILABLE_BYTES));
    cursor.close();
  }
  mDatabase.getMapper().clearMapping();
  mDatabase.getMapper().startAddingDocuments("1");
  mDatabase.getMapper().startAddingDocuments("2");
  mDatabase.getMapper().putStorageDocuments("1",resources,new MtpRoot[]{new MtpRoot(0,200,"Device","Storage",2000,0,"")});
  mDatabase.getMapper().putStorageDocuments("2",resources,new MtpRoot[]{new MtpRoot(1,300,"Device","Storage",3000,0,"")});
  mDatabase.getMapper().stopAddingDocuments("1");
  mDatabase.getMapper().stopAddingDocuments("2");
{
    final Cursor cursor=mDatabase.queryRootDocuments(columns);
    assertEquals(2,cursor.getCount());
    cursor.moveToNext();
    assertEquals(5,getInt(cursor,COLUMN_DOCUMENT_ID));
    assertEquals(200,getInt(cursor,COLUMN_STORAGE_ID));
    assertEquals("Device Storage",getString(cursor,COLUMN_DISPLAY_NAME));
    cursor.moveToNext();
    assertEquals(6,getInt(cursor,COLUMN_DOCUMENT_ID));
    assertEquals(300,getInt(cursor,COLUMN_STORAGE_ID));
    assertEquals("Device Storage",getString(cursor,COLUMN_DISPLAY_NAME));
    cursor.close();
  }
{
    final Cursor cursor=mDatabase.queryRoots(rootColumns);
    assertEquals(2,cursor.getCount());
    cursor.moveToNext();
    assertEquals(5,getInt(cursor,Root.COLUMN_ROOT_ID));
    assertEquals(2000,getInt(cursor,Root.COLUMN_AVAILABLE_BYTES));
    cursor.moveToNext();
    assertEquals(6,getInt(cursor,Root.COLUMN_ROOT_ID));
    assertEquals(3000,getInt(cursor,Root.COLUMN_AVAILABLE_BYTES));
    cursor.close();
  }
}
