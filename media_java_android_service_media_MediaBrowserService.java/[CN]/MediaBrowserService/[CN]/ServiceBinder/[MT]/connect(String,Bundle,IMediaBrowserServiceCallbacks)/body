{
  final int uid=Binder.getCallingUid();
  if (!isValidPackage(pkg,uid)) {
    throw new IllegalArgumentException("Package/uid mismatch: uid=" + uid + " package="+ pkg);
  }
  mHandler.post(new Runnable(){
    @Override public void run(){
      final IBinder b=callbacks.asBinder();
      mConnections.remove(b);
      final ConnectionRecord connection=new ConnectionRecord();
      connection.pkg=pkg;
      connection.rootHints=rootHints;
      connection.callbacks=callbacks;
      connection.root=MediaBrowserService.this.onGetRoot(pkg,uid,rootHints);
      if (connection.root == null) {
        Log.i(TAG,"No root for client " + pkg + " from service "+ getClass().getName());
        try {
          callbacks.onConnectFailed();
        }
 catch (        RemoteException ex) {
          Log.w(TAG,"Calling onConnectFailed() failed. Ignoring. " + "pkg=" + pkg);
        }
      }
 else {
        try {
          mConnections.put(b,connection);
          if (mSession != null) {
            callbacks.onConnect(connection.root.getRootId(),mSession,connection.root.getExtras());
          }
        }
 catch (        RemoteException ex) {
          Log.w(TAG,"Calling onConnect() failed. Dropping client. " + "pkg=" + pkg);
          mConnections.remove(b);
        }
      }
    }
  }
);
}
