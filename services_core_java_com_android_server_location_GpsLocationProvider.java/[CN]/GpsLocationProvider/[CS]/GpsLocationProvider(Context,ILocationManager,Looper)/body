{
  mContext=context;
  mNtpTime=NtpTrustedTime.getInstance(context);
  mILocationManager=ilocationManager;
  mNIHandler=new GpsNetInitiatedHandler(context);
  mLocation.setExtras(mLocationExtras);
  mPowerManager=(PowerManager)mContext.getSystemService(Context.POWER_SERVICE);
  mWakeLock=mPowerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,WAKELOCK_KEY);
  mWakeLock.setReferenceCounted(true);
  mAlarmManager=(AlarmManager)mContext.getSystemService(Context.ALARM_SERVICE);
  mWakeupIntent=PendingIntent.getBroadcast(mContext,0,new Intent(ALARM_WAKEUP),0);
  mTimeoutIntent=PendingIntent.getBroadcast(mContext,0,new Intent(ALARM_TIMEOUT),0);
  mConnMgr=(ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);
  mAppOpsService=IAppOpsService.Stub.asInterface(ServiceManager.getService(Context.APP_OPS_SERVICE));
  mBatteryStats=IBatteryStats.Stub.asInterface(ServiceManager.getService(BatteryStats.SERVICE_NAME));
  boolean propertiesLoaded=false;
  final String gpsHardware=SystemProperties.get("ro.hardware.gps");
  if (!TextUtils.isEmpty(gpsHardware)) {
    final String propFilename=PROPERTIES_FILE_PREFIX + "." + gpsHardware+ PROPERTIES_FILE_SUFFIX;
    propertiesLoaded=loadPropertiesFile(propFilename);
  }
  if (!propertiesLoaded) {
    loadPropertiesFile(DEFAULT_PROPERTIES_FILE);
  }
  mHandler=new ProviderHandler(looper);
  listenForBroadcasts();
  mHandler.post(new Runnable(){
    @Override public void run(){
      LocationManager locManager=(LocationManager)mContext.getSystemService(Context.LOCATION_SERVICE);
      final long minTime=0;
      final float minDistance=0;
      final boolean oneShot=false;
      LocationRequest request=LocationRequest.createFromDeprecatedProvider(LocationManager.PASSIVE_PROVIDER,minTime,minDistance,oneShot);
      request.setHideFromAppOps(true);
      locManager.requestLocationUpdates(request,new NetworkLocationListener(),mHandler.getLooper());
    }
  }
);
}
