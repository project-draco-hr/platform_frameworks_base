{
  ConnectivityManager connectivityManager=(ConnectivityManager)mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
  NetworkInfo mobileInfo=connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
  NetworkInfo wifiInfo=connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
  mNetworkAvailable=(mobileInfo != null && mobileInfo.isConnected()) || (wifiInfo != null && wifiInfo.isConnected());
  NetworkInfo info=connectivityManager.getNetworkInfo(networkType);
  if (DEBUG) {
    Log.d(TAG,"updateNetworkState " + (mNetworkAvailable ? "available" : "unavailable") + " info: "+ info);
  }
  if (info != null) {
    if (native_is_agps_ril_supported()) {
      boolean dataEnabled=TelephonyManager.getDefault().getDataEnabled();
      boolean networkAvailable=info.isAvailable() && dataEnabled;
      String defaultApn=getSelectedApn();
      if (defaultApn == null) {
        defaultApn="dummy-apn";
      }
      native_update_network_state(info.isConnected(),info.getType(),info.isRoaming(),networkAvailable,info.getExtraInfo(),defaultApn);
    }
 else     if (DEBUG) {
      Log.d(TAG,"Skipped network state update because AGPS-RIL in GPS HAL is not" + " supported");
    }
  }
  if (info != null && info.getType() == ConnectivityManager.TYPE_MOBILE_SUPL && mAGpsDataConnectionState == AGPS_DATA_CONNECTION_OPENING) {
    if (info.isConnected()) {
      String apnName=info.getExtraInfo();
      if (apnName == null) {
        apnName="dummy-apn";
      }
      mAGpsApn=apnName;
      mApnIpType=getApnIpType(apnName);
      setRouting();
      if (DEBUG) {
        String message=String.format("native_agps_data_conn_open: mAgpsApn=%s, mApnIpType=%s",mAGpsApn,mApnIpType);
        Log.d(TAG,message);
      }
      native_agps_data_conn_open(mAGpsApn,mApnIpType);
      mAGpsDataConnectionState=AGPS_DATA_CONNECTION_OPEN;
    }
 else {
      Log.e(TAG,"call native_agps_data_conn_failed, info: " + info);
      mAGpsApn=null;
      mApnIpType=APN_INVALID;
      mAGpsDataConnectionState=AGPS_DATA_CONNECTION_CLOSED;
      native_agps_data_conn_failed();
    }
  }
  if (mNetworkAvailable) {
    if (mInjectNtpTimePending == STATE_PENDING_NETWORK) {
      sendMessage(INJECT_NTP_TIME,0,null);
    }
    if (mDownloadXtraDataPending == STATE_PENDING_NETWORK) {
      sendMessage(DOWNLOAD_XTRA_DATA,0,null);
    }
  }
}
