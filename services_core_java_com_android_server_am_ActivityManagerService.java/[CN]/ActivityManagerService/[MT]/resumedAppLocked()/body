{
  ActivityRecord act=mStackSupervisor.resumedAppLocked();
  String pkg;
  int uid;
  if (act != null && !act.sleeping) {
    pkg=act.packageName;
    uid=act.info.applicationInfo.uid;
  }
 else {
    pkg=null;
    uid=-1;
  }
  if (uid != mCurResumedUid || (pkg != mCurResumedPackage && (pkg == null || !pkg.equals(mCurResumedPackage)))) {
    if (mCurResumedPackage != null) {
      mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_TOP_FINISH,mCurResumedPackage,mCurResumedUid);
    }
    mCurResumedPackage=pkg;
    mCurResumedUid=uid;
    if (mCurResumedPackage != null) {
      mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_TOP_START,mCurResumedPackage,mCurResumedUid);
    }
  }
  return act;
}
