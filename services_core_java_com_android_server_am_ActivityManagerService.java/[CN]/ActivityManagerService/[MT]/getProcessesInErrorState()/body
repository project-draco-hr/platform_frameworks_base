{
  enforceNotIsolatedCaller("getProcessesInErrorState");
  List<ActivityManager.ProcessErrorStateInfo> errList=null;
  final boolean allUsers=ActivityManager.checkUidPermission(android.Manifest.permission.INTERACT_ACROSS_USERS_FULL,Binder.getCallingUid()) == PackageManager.PERMISSION_GRANTED;
  int userId=UserHandle.getUserId(Binder.getCallingUid());
synchronized (this) {
    for (int i=mLruProcesses.size() - 1; i >= 0; i--) {
      ProcessRecord app=mLruProcesses.get(i);
      if (!allUsers && app.userId != userId) {
        continue;
      }
      if ((app.thread != null) && (app.crashing || app.notResponding)) {
        ActivityManager.ProcessErrorStateInfo report=null;
        if (app.crashing) {
          report=app.crashingReport;
        }
 else         if (app.notResponding) {
          report=app.notRespondingReport;
        }
        if (report != null) {
          if (errList == null) {
            errList=new ArrayList<ActivityManager.ProcessErrorStateInfo>(1);
          }
          errList.add(report);
        }
 else {
          Slog.w(TAG,"Missing app error report, app = " + app.processName + " crashing = "+ app.crashing+ " notResponding = "+ app.notResponding);
        }
      }
    }
  }
  return errList;
}
