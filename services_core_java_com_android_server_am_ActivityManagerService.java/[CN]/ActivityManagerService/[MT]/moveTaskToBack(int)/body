{
  enforceCallingPermission(android.Manifest.permission.REORDER_TASKS,"moveTaskToBack()");
synchronized (this) {
    TaskRecord tr=recentTaskForIdLocked(taskId);
    if (tr != null) {
      if (tr == mStackSupervisor.mLockTaskModeTask) {
        mStackSupervisor.showLockTaskToast();
        return;
      }
      if (DEBUG_STACK)       Slog.d(TAG,"moveTaskToBack: moving task=" + tr);
      ActivityStack stack=tr.stack;
      if (stack.mResumedActivity != null && stack.mResumedActivity.task == tr) {
        if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),-1,-1,"Task to back")) {
          return;
        }
      }
      final long origId=Binder.clearCallingIdentity();
      try {
        stack.moveTaskToBackLocked(taskId,null);
      }
  finally {
        Binder.restoreCallingIdentity(origId);
      }
    }
  }
}
