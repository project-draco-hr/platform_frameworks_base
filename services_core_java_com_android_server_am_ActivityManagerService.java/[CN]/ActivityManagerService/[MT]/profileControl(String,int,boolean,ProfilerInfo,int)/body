{
  try {
synchronized (this) {
      if (checkCallingPermission(android.Manifest.permission.SET_ACTIVITY_WATCHER) != PackageManager.PERMISSION_GRANTED) {
        throw new SecurityException("Requires permission " + android.Manifest.permission.SET_ACTIVITY_WATCHER);
      }
      if (start && (profilerInfo == null || profilerInfo.profileFd == null)) {
        throw new IllegalArgumentException("null profile info or fd");
      }
      ProcessRecord proc=null;
      if (process != null) {
        proc=findProcessLocked(process,userId,"profileControl");
      }
      if (start && (proc == null || proc.thread == null)) {
        throw new IllegalArgumentException("Unknown process: " + process);
      }
      if (start) {
        stopProfilerLocked(null,0);
        setProfileApp(proc.info,proc.processName,profilerInfo);
        mProfileProc=proc;
        mProfileType=profileType;
        ParcelFileDescriptor fd=profilerInfo.profileFd;
        try {
          fd=fd.dup();
        }
 catch (        IOException e) {
          fd=null;
        }
        profilerInfo.profileFd=fd;
        proc.thread.profilerControl(start,profilerInfo,profileType);
        fd=null;
        mProfileFd=null;
      }
 else {
        stopProfilerLocked(proc,profileType);
        if (profilerInfo != null && profilerInfo.profileFd != null) {
          try {
            profilerInfo.profileFd.close();
          }
 catch (          IOException e) {
          }
        }
      }
      return true;
    }
  }
 catch (  RemoteException e) {
    throw new IllegalStateException("Process disappeared");
  }
 finally {
    if (profilerInfo != null && profilerInfo.profileFd != null) {
      try {
        profilerInfo.profileFd.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
