{
  enforceCallingPermission(MANAGE_ACTIVITY_STACKS,"resizeTask()");
  long ident=Binder.clearCallingIdentity();
  try {
synchronized (this) {
      TaskRecord task=mStackSupervisor.anyTaskForIdLocked(taskId);
      if (task == null) {
        Slog.w(TAG,"resizeTask: taskId=" + taskId + " not found");
        return;
      }
      int stackId=task.stack.mStackId;
      if (bounds != null && task.inCropWindowsResizeMode() && mStackSupervisor.isStackDockedInEffect(stackId)) {
        mWindowManager.scrollTask(task.taskId,bounds);
        return;
      }
      if (!StackId.isTaskResizeAllowed(stackId)) {
        throw new IllegalArgumentException("resizeTask not allowed on task=" + task);
      }
      if (bounds == null && stackId == FREEFORM_WORKSPACE_STACK_ID) {
        stackId=FULLSCREEN_WORKSPACE_STACK_ID;
      }
 else       if (bounds != null && stackId != FREEFORM_WORKSPACE_STACK_ID) {
        stackId=FREEFORM_WORKSPACE_STACK_ID;
      }
      boolean preserveWindow=(resizeMode & RESIZE_MODE_PRESERVE_WINDOW) != 0;
      if (stackId != task.stack.mStackId) {
        mStackSupervisor.moveTaskToStackUncheckedLocked(task,stackId,ON_TOP,!FORCE_FOCUS,"resizeTask");
        preserveWindow=false;
      }
      mStackSupervisor.resizeTaskLocked(task,bounds,resizeMode,preserveWindow,false);
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
