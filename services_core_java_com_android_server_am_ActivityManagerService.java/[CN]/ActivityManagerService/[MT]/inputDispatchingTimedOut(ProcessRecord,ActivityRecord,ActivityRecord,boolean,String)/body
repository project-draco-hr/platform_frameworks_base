{
  if (checkCallingPermission(android.Manifest.permission.FILTER_EVENTS) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires permission " + android.Manifest.permission.FILTER_EVENTS);
  }
  final String annotation;
  if (reason == null) {
    annotation="Input dispatching timed out";
  }
 else {
    annotation="Input dispatching timed out (" + reason + ")";
  }
  if (proc != null) {
synchronized (this) {
      if (proc.debugging) {
        return false;
      }
      if (mDidDexOpt) {
        mDidDexOpt=false;
        return false;
      }
      if (proc.instrumentationClass != null) {
        Bundle info=new Bundle();
        info.putString("shortMsg","keyDispatchingTimedOut");
        info.putString("longMsg",annotation);
        finishInstrumentationLocked(proc,Activity.RESULT_CANCELED,info);
        return true;
      }
    }
    mHandler.post(new Runnable(){
      @Override public void run(){
        mAppErrors.appNotResponding(proc,activity,parent,aboveSystem,annotation);
      }
    }
);
  }
  return true;
}
