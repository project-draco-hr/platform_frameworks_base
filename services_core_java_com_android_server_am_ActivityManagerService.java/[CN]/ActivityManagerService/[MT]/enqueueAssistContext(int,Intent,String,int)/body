{
  enforceCallingPermission(android.Manifest.permission.GET_TOP_ACTIVITY_INFO,"getAssistContextExtras()");
  PendingAssistExtras pae;
  Bundle extras=new Bundle();
synchronized (this) {
    ActivityRecord activity=getFocusedStack().mResumedActivity;
    if (activity == null) {
      Slog.w(TAG,"getAssistContextExtras failed: no resumed activity");
      return null;
    }
    extras.putString(Intent.EXTRA_ASSIST_PACKAGE,activity.packageName);
    if (activity.app == null || activity.app.thread == null) {
      Slog.w(TAG,"getAssistContextExtras failed: no process for " + activity);
      return null;
    }
    if (activity.app.pid == Binder.getCallingPid()) {
      Slog.w(TAG,"getAssistContextExtras failed: request process same as " + activity);
      return null;
    }
    pae=new PendingAssistExtras(activity,extras,intent,hint,userHandle);
    try {
      activity.app.thread.requestAssistContextExtras(activity.appToken,pae,requestType);
      mPendingAssistExtras.add(pae);
      mHandler.postDelayed(pae,PENDING_ASSIST_EXTRAS_TIMEOUT);
    }
 catch (    RemoteException e) {
      Slog.w(TAG,"getAssistContextExtras failed: crash calling " + activity);
      return null;
    }
    return pae;
  }
}
