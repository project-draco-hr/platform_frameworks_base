{
synchronized (mPidsSelfLocked) {
    ProcessRecord curProc=mPidsSelfLocked.get(pid);
    if (curProc != app) {
      Slog.w(TAG,"Spurious death for " + app + ", curProc for "+ pid+ ": "+ curProc);
      return;
    }
  }
  BatteryStatsImpl stats=mBatteryStatsService.getActiveStatistics();
synchronized (stats) {
    stats.noteProcessDiedLocked(app.info.uid,pid);
  }
  if (!app.killed) {
    if (!fromBinderDied) {
      Process.killProcessQuiet(pid);
    }
    killProcessGroup(app.uid,pid);
    app.killed=true;
  }
  if (app.pid == pid && app.thread != null && app.thread.asBinder() == thread.asBinder()) {
    boolean doLowMem=app.instrumentationClass == null;
    boolean doOomAdj=doLowMem;
    if (!app.killedByAm) {
      Slog.i(TAG,"Process " + app.processName + " (pid "+ pid+ ") has died");
      mAllowLowerMemLevel=true;
    }
 else {
      mAllowLowerMemLevel=false;
      doLowMem=false;
    }
    EventLog.writeEvent(EventLogTags.AM_PROC_DIED,app.userId,app.pid,app.processName);
    if (DEBUG_CLEANUP)     Slog.v(TAG_CLEANUP,"Dying app: " + app + ", pid: "+ pid+ ", thread: "+ thread.asBinder());
    handleAppDiedLocked(app,false,true);
    if (doOomAdj) {
      updateOomAdjLocked();
    }
    if (doLowMem) {
      doLowMemReportIfNeededLocked(app);
    }
  }
 else   if (app.pid != pid) {
    Slog.i(TAG,"Process " + app.processName + " (pid "+ pid+ ") has died and restarted (pid "+ app.pid+ ").");
    EventLog.writeEvent(EventLogTags.AM_PROC_DIED,app.userId,app.pid,app.processName);
  }
 else   if (DEBUG_PROCESSES) {
    Slog.d(TAG_PROCESSES,"Received spurious death notification for thread " + thread.asBinder());
  }
}
