{
  ActivityManager.RecentTaskInfo rti=new ActivityManager.RecentTaskInfo();
  rti.id=tr.numActivities > 0 ? tr.taskId : -1;
  rti.persistentId=tr.taskId;
  rti.baseIntent=new Intent(tr.getBaseIntent());
  rti.origActivity=tr.origActivity;
  rti.description=tr.lastDescription;
  rti.stackId=tr.stack.mStackId;
  rti.userId=tr.userId;
  final ArrayList<ActivityRecord> activities=tr.mActivities;
  int activityNdx;
  final int numActivities=activities.size();
  for (activityNdx=Math.min(numActivities,1); activityNdx < numActivities; ++activityNdx) {
    final ActivityRecord r=activities.get(activityNdx);
    if (r.intent != null && (r.intent.getFlags() & Intent.FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET) != 0) {
      break;
    }
  }
  if (activityNdx > 0) {
    rti.activityValues=new ActivityManager.RecentsActivityValues();
    for (--activityNdx; activityNdx >= 0; --activityNdx) {
      final ActivityRecord r=activities.get(activityNdx);
      if (r.activityValues != null) {
        if (rti.activityValues.label == null) {
          rti.activityValues.label=r.activityValues.label;
          tr.lastActivityValues.label=r.activityValues.label;
        }
        if (rti.activityValues.icon == null) {
          rti.activityValues.icon=r.activityValues.icon;
          tr.lastActivityValues.icon=r.activityValues.icon;
        }
        if (rti.activityValues.colorPrimary == 0) {
          rti.activityValues.colorPrimary=r.activityValues.colorPrimary;
          tr.lastActivityValues.colorPrimary=r.activityValues.colorPrimary;
        }
      }
    }
  }
 else {
    rti.activityValues=new ActivityManager.RecentsActivityValues(tr.lastActivityValues);
  }
  return rti;
}
