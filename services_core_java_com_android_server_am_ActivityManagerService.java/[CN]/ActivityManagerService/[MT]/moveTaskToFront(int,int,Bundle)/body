{
  enforceCallingPermission(android.Manifest.permission.REORDER_TASKS,"moveTaskToFront()");
  if (DEBUG_STACK)   Slog.d(TAG,"moveTaskToFront: moving taskId=" + taskId);
synchronized (this) {
    if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),"Task to front")) {
      ActivityOptions.abort(options);
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    try {
      final TaskRecord task=mStackSupervisor.anyTaskForIdLocked(taskId);
      if (task == null) {
        return;
      }
      if (mStackSupervisor.isLockTaskModeViolation(task)) {
        mStackSupervisor.showLockTaskToast();
        Slog.e(TAG,"moveTaskToFront: Attempt to violate Lock Task Mode");
        return;
      }
      final ActivityRecord prev=mStackSupervisor.topRunningActivityLocked();
      if (prev != null && prev.isRecentsActivity()) {
        task.setTaskToReturnTo(ActivityRecord.RECENTS_ACTIVITY_TYPE);
      }
      mStackSupervisor.findTaskToMoveToFrontLocked(task,flags,options);
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
    ActivityOptions.abort(options);
  }
}
