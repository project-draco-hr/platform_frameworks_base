{
  final TaskRecord lockTask=mStackSupervisor.getLockedTaskLocked();
  if (lockTask == null) {
    return;
  }
  final int callingUid=Binder.getCallingUid();
  final int lockTaskUid=lockTask.mLockTaskUid;
  final int lockTaskModeState=mStackSupervisor.getLockTaskModeState();
  if (lockTaskModeState == ActivityManager.LOCK_TASK_MODE_NONE) {
    return;
  }
 else {
    if (checkCallingPermission(MANAGE_ACTIVITY_STACKS) != PERMISSION_GRANTED && callingUid != lockTaskUid && (lockTaskUid != 0 || callingUid != lockTask.effectiveUid)) {
      throw new SecurityException("Invalid uid, expected " + lockTaskUid + " callingUid="+ callingUid+ " effectiveUid="+ lockTask.effectiveUid);
    }
  }
  long ident=Binder.clearCallingIdentity();
  try {
    Log.d(TAG,"stopLockTaskMode");
synchronized (this) {
      mStackSupervisor.setLockTaskModeLocked(null,ActivityManager.LOCK_TASK_MODE_NONE,"stopLockTask",true);
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
