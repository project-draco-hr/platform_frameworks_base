{
  if (r != null && mFocusedActivity != r) {
    if (DEBUG_FOCUS)     Slog.d(TAG_FOCUS,"setFocusedActivityLocked: r=" + r);
    mFocusedActivity=r;
    if (r.task != null && r.task.voiceInteractor != null) {
      startRunningVoiceLocked(r.task.voiceSession,r.info.applicationInfo.uid);
    }
 else {
      finishRunningVoiceLocked();
    }
    if (mStackSupervisor.setFocusedStack(r,reason + " setFocusedActivity")) {
      mWindowManager.setFocusedApp(r.appToken,true);
    }
    applyUpdateLockStateLocked(r);
  }
  EventLog.writeEvent(EventLogTags.AM_FOCUSED_ACTIVITY,mCurrentUserId,mFocusedActivity == null ? "NULL" : mFocusedActivity.shortComponentName);
}
