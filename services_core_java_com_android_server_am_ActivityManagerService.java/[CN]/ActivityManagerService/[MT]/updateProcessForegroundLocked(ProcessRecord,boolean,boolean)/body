{
  if (isForeground != proc.foregroundServices) {
    proc.foregroundServices=isForeground;
    ArrayList<ProcessRecord> curProcs=mForegroundPackages.get(proc.info.packageName,proc.info.uid);
    if (isForeground) {
      if (curProcs == null) {
        curProcs=new ArrayList<ProcessRecord>();
        mForegroundPackages.put(proc.info.packageName,proc.info.uid,curProcs);
      }
      if (!curProcs.contains(proc)) {
        curProcs.add(proc);
        mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_FOREGROUND_START,proc.info.packageName,proc.info.uid);
      }
    }
 else {
      if (curProcs != null) {
        if (curProcs.remove(proc)) {
          mBatteryStatsService.noteEvent(BatteryStats.HistoryItem.EVENT_FOREGROUND_FINISH,proc.info.packageName,proc.info.uid);
          if (curProcs.size() <= 0) {
            mForegroundPackages.remove(proc.info.packageName,proc.info.uid);
          }
        }
      }
    }
    if (oomAdj) {
      updateOomAdjLocked();
    }
  }
}
