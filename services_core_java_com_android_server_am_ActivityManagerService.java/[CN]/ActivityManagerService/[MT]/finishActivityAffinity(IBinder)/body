{
synchronized (this) {
    final long origId=Binder.clearCallingIdentity();
    try {
      ActivityRecord r=ActivityRecord.isInStackLocked(token);
      ActivityRecord rootR=r.task.getRootActivity();
      if (r.task == mStackSupervisor.mLockTaskModeTask) {
        if (rootR == r) {
          Binder.restoreCallingIdentity(origId);
          return false;
        }
      }
      boolean res=false;
      if (r != null) {
        res=r.task.stack.finishActivityAffinityLocked(r);
      }
      return res;
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
  }
}
