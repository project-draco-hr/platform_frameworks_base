{
  if (getPackageManagerInternalLocked().isPermissionsReviewRequired(cpi.packageName,userId)) {
    final boolean callerForeground=r == null || r.setSchedGroup != ProcessList.SCHED_GROUP_BACKGROUND;
    if (!callerForeground) {
      Slog.w(TAG,"u" + userId + " Instantiating a provider in package"+ cpi.packageName+ " requires a permissions review");
      return false;
    }
    final Intent intent=new Intent(Intent.ACTION_REVIEW_PERMISSIONS);
    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS);
    intent.putExtra(Intent.EXTRA_PACKAGE_NAME,cpi.packageName);
    if (DEBUG_PERMISSIONS_REVIEW) {
      Slog.i(TAG,"u" + userId + " Launching permission review "+ "for package "+ cpi.packageName);
    }
    final UserHandle userHandle=new UserHandle(userId);
    mHandler.post(new Runnable(){
      @Override public void run(){
        mContext.startActivityAsUser(intent,userHandle);
      }
    }
);
    return false;
  }
  return true;
}
