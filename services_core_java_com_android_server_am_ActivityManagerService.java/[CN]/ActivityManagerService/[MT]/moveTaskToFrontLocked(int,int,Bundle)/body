{
  ActivityOptions options=ActivityOptions.fromBundle(bOptions);
  if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),-1,-1,"Task to front")) {
    ActivityOptions.abort(options);
    return;
  }
  final long origId=Binder.clearCallingIdentity();
  try {
    final TaskRecord task=mStackSupervisor.anyTaskForIdLocked(taskId);
    if (task == null) {
      Slog.d(TAG,"Could not find task for id: " + taskId);
      return;
    }
    if (mStackSupervisor.isLockTaskModeViolation(task)) {
      mStackSupervisor.showLockTaskToast();
      Slog.e(TAG,"moveTaskToFront: Attempt to violate Lock Task Mode");
      return;
    }
    final ActivityRecord prev=mStackSupervisor.topRunningActivityLocked();
    if (prev != null && prev.isRecentsActivity()) {
      task.setTaskToReturnTo(ActivityRecord.RECENTS_ACTIVITY_TYPE);
    }
    mStackSupervisor.findTaskToMoveToFrontLocked(task,flags,options,"moveTaskToFront",false);
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
  ActivityOptions.abort(options);
}
