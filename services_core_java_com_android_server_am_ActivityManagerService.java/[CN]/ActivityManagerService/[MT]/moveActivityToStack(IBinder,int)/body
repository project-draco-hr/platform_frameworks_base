{
  if (stackId == HOME_STACK_ID) {
    throw new IllegalArgumentException("moveTaskToStack: Attempt to move token " + token + " to home stack");
  }
synchronized (this) {
    long ident=Binder.clearCallingIdentity();
    try {
      final ActivityRecord r=ActivityRecord.forTokenLocked(token);
      if (r == null) {
        throw new IllegalArgumentException("moveActivityToStack: No activity record matching token=" + token);
      }
      if (DEBUG_STACK)       Slog.d(TAG_STACK,"moveActivityToStack: moving r=" + r + " to stackId="+ stackId);
      mStackSupervisor.moveTaskToStackLocked(r.task.taskId,stackId,ON_TOP);
      if (mFocusedActivity != r) {
        setFocusedActivityLocked(r,"moveActivityToStack");
      }
 else {
        mStackSupervisor.setFocusedStack(r,"moveActivityToStack");
      }
      mStackSupervisor.resumeTopActivitiesLocked(r.task.stack,null,null);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
