{
  final boolean inLaunching=mLaunchingProviders.contains(cpr);
  if (!inLaunching || always) {
synchronized (cpr) {
      cpr.launchingApp=null;
      cpr.notifyAll();
    }
    mProviderMap.removeProviderByClass(cpr.name,UserHandle.getUserId(cpr.uid));
    String names[]=cpr.info.authority.split(";");
    for (int j=0; j < names.length; j++) {
      mProviderMap.removeProviderByName(names[j],UserHandle.getUserId(cpr.uid));
    }
  }
  for (int i=cpr.connections.size() - 1; i >= 0; i--) {
    ContentProviderConnection conn=cpr.connections.get(i);
    if (conn.waiting) {
      if (inLaunching && !always) {
        continue;
      }
    }
    ProcessRecord capp=conn.client;
    conn.dead=true;
    if (conn.stableCount > 0) {
      if (!capp.persistent && capp.thread != null && capp.pid != 0 && capp.pid != MY_PID) {
        capp.kill("depends on provider " + cpr.name.flattenToShortString() + " in dying proc "+ (proc != null ? proc.processName : "??"),true);
      }
    }
 else     if (capp.thread != null && conn.provider.provider != null) {
      try {
        capp.thread.unstableProviderDied(conn.provider.provider.asBinder());
      }
 catch (      RemoteException e) {
      }
      cpr.connections.remove(i);
      if (conn.client.conProviders.remove(conn)) {
        stopAssociationLocked(capp.uid,capp.processName,cpr.uid,cpr.name);
      }
    }
  }
  if (inLaunching && always) {
    mLaunchingProviders.remove(cpr);
  }
  return inLaunching;
}
