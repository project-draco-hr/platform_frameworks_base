{
synchronized (this) {
    ActivityRecord r=ActivityRecord.isInStackLocked(token);
    if (r == null) {
      return;
    }
    TaskRecord task=r.task;
    if (task != null && (!task.mFullscreen || !task.stack.mFullscreen)) {
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    mWindowManager.setAppOrientation(r.appToken,requestedOrientation);
    Configuration config=mWindowManager.updateOrientationFromAppTokens(mConfiguration,r.mayFreezeScreenLocked(r.app) ? r.appToken : null);
    if (config != null) {
      r.frozenBeforeDestroy=true;
      if (!updateConfigurationLocked(config,r,false)) {
        mStackSupervisor.resumeFocusedStackTopActivityLocked();
      }
    }
    Binder.restoreCallingIdentity(origId);
  }
}
