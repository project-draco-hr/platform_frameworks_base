{
  if (checkCallingPermission(android.Manifest.permission.SHUTDOWN) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires permission " + android.Manifest.permission.SHUTDOWN);
  }
  boolean timedout=false;
synchronized (this) {
    mShuttingDown=true;
    updateEventDispatchingLocked();
    timedout=mStackSupervisor.shutdownLocked(timeout);
  }
  mAppOpsService.shutdown();
  if (mUsageStatsService != null) {
    mUsageStatsService.prepareShutdown();
  }
  mBatteryStatsService.shutdown();
synchronized (this) {
    mProcessStats.shutdownLocked();
    notifyTaskPersisterLocked(null,true);
  }
  return timedout;
}
