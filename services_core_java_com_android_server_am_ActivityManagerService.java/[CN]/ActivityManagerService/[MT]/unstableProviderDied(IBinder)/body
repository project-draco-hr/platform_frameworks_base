{
  ContentProviderConnection conn;
  try {
    conn=(ContentProviderConnection)connection;
  }
 catch (  ClassCastException e) {
    String msg="refContentProvider: " + connection + " not a ContentProviderConnection";
    Slog.w(TAG,msg);
    throw new IllegalArgumentException(msg);
  }
  if (conn == null) {
    throw new NullPointerException("connection is null");
  }
  IContentProvider provider;
synchronized (this) {
    provider=conn.provider.provider;
  }
  if (provider == null) {
    return;
  }
  if (provider.asBinder().pingBinder()) {
synchronized (this) {
      Slog.w(TAG,"unstableProviderDied: caller " + Binder.getCallingUid() + " says "+ conn+ " died, but we don't agree");
      return;
    }
  }
synchronized (this) {
    if (conn.provider.provider != provider) {
      return;
    }
    ProcessRecord proc=conn.provider.proc;
    if (proc == null || proc.thread == null) {
      return;
    }
    Slog.i(TAG,"Process " + proc.processName + " (pid "+ proc.pid+ ") early provider death");
    final long ident=Binder.clearCallingIdentity();
    try {
      appDiedLocked(proc,proc.pid,proc.thread);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
