{
  if (r != null) {
    for (int i=0; i < r.conProviders.size(); i++) {
      ContentProviderConnection conn=r.conProviders.get(i);
      if (conn.provider == cpr) {
        if (DEBUG_PROVIDER)         Slog.v(TAG_PROVIDER,"Adding provider requested by " + r.processName + " from process "+ cpr.info.processName+ ": "+ cpr.name.flattenToShortString()+ " scnt="+ conn.stableCount+ " uscnt="+ conn.unstableCount);
        if (stable) {
          conn.stableCount++;
          conn.numStableIncs++;
        }
 else {
          conn.unstableCount++;
          conn.numUnstableIncs++;
        }
        return conn;
      }
    }
    ContentProviderConnection conn=new ContentProviderConnection(cpr,r);
    if (stable) {
      conn.stableCount=1;
      conn.numStableIncs=1;
    }
 else {
      conn.unstableCount=1;
      conn.numUnstableIncs=1;
    }
    cpr.connections.add(conn);
    r.conProviders.add(conn);
    startAssociationLocked(r.uid,r.processName,r.curProcState,cpr.uid,cpr.name,cpr.info.processName);
    return conn;
  }
  cpr.addExternalProcessHandleLocked(externalProcessToken);
  return null;
}
