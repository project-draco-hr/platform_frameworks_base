{
  if (resultData != null && resultData.hasFileDescriptors() == true) {
    throw new IllegalArgumentException("File descriptors passed in Intent");
  }
synchronized (this) {
    ActivityRecord r=ActivityRecord.isInStackLocked(token);
    if (r == null) {
      return true;
    }
    TaskRecord tr=r.task;
    ActivityRecord rootR=tr.getRootActivity();
    if (mController != null) {
      ActivityRecord next=r.task.stack.topRunningActivityLocked(token,0);
      if (next != null) {
        boolean resumeOK=true;
        try {
          resumeOK=mController.activityResuming(next.packageName);
        }
 catch (        RemoteException e) {
          mController=null;
          Watchdog.getInstance().setActivityController(null);
        }
        if (!resumeOK) {
          return false;
        }
      }
    }
    final long origId=Binder.clearCallingIdentity();
    try {
      boolean res;
      if (finishTask && r == rootR) {
        res=removeTaskByIdLocked(tr.taskId,0);
      }
 else {
        res=tr.stack.requestFinishActivityLocked(token,resultCode,resultData,"app-request",true);
      }
      return res;
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
  }
}
