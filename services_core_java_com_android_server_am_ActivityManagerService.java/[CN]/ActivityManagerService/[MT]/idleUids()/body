{
synchronized (this) {
    final long nowElapsed=SystemClock.elapsedRealtime();
    final long maxBgTime=nowElapsed - BACKGROUND_SETTLE_TIME;
    long nextTime=0;
    for (int i=mActiveUids.size() - 1; i >= 0; i--) {
      final UidRecord uidRec=mActiveUids.valueAt(i);
      final long bgTime=uidRec.lastBackgroundTime;
      if (bgTime > 0 && !uidRec.idle) {
        if (bgTime <= maxBgTime) {
          uidRec.idle=true;
          doStopUidLocked(uidRec.uid,uidRec);
        }
 else {
          if (nextTime == 0 || nextTime > bgTime) {
            nextTime=bgTime;
          }
        }
      }
    }
    if (nextTime > 0) {
      mHandler.removeMessages(IDLE_UIDS_MSG);
      mHandler.sendEmptyMessageDelayed(IDLE_UIDS_MSG,nextTime + BACKGROUND_SETTLE_TIME - nowElapsed);
    }
  }
}
