{
  UidRecord uidRec=mActiveUids.get(uid);
  if (uidRec == null || uidRec.idle) {
    if (callingPid >= 0) {
      ProcessRecord proc;
synchronized (mPidsSelfLocked) {
        proc=mPidsSelfLocked.get(callingPid);
      }
      if (proc != null && proc.curProcState < ActivityManager.PROCESS_STATE_RECEIVER) {
        return true;
      }
    }
    if (mAppOpsService.noteOperation(AppOpsManager.OP_RUN_IN_BACKGROUND,uid,packageName) != AppOpsManager.MODE_ALLOWED) {
      return false;
    }
  }
  return true;
}
