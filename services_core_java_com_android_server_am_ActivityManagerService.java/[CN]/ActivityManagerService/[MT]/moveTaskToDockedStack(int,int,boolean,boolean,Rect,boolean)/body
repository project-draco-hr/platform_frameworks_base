{
  enforceCallingPermission(MANAGE_ACTIVITY_STACKS,"moveTaskToDockedStack()");
synchronized (this) {
    long ident=Binder.clearCallingIdentity();
    try {
      if (DEBUG_STACK)       Slog.d(TAG_STACK,"moveTaskToDockedStack: moving task=" + taskId + " to createMode="+ createMode+ " toTop="+ toTop);
      mWindowManager.setDockedStackCreateState(createMode,initialBounds);
      final boolean moved=mStackSupervisor.moveTaskToStackLocked(taskId,DOCKED_STACK_ID,toTop,!FORCE_FOCUS,"moveTaskToDockedStack",animate,DEFER_RESUME);
      if (moved) {
        if (moveHomeStackFront) {
          mStackSupervisor.moveHomeStackToFront("moveTaskToDockedStack");
        }
        mStackSupervisor.ensureActivitiesVisibleLocked(null,0,!PRESERVE_WINDOWS);
      }
      return moved;
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
