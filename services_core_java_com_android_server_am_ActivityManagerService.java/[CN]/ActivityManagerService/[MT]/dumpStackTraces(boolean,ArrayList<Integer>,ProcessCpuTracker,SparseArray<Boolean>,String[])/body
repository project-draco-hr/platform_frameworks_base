{
  String tracesPath=SystemProperties.get("dalvik.vm.stack-trace-file",null);
  if (tracesPath == null || tracesPath.length() == 0) {
    return null;
  }
  File tracesFile=new File(tracesPath);
  try {
    File tracesDir=tracesFile.getParentFile();
    if (!tracesDir.exists()) {
      tracesDir.mkdirs();
      if (!SELinux.restorecon(tracesDir)) {
        return null;
      }
    }
    FileUtils.setPermissions(tracesDir.getPath(),0775,-1,-1);
    if (clearTraces && tracesFile.exists())     tracesFile.delete();
    tracesFile.createNewFile();
    FileUtils.setPermissions(tracesFile.getPath(),0666,-1,-1);
  }
 catch (  IOException e) {
    Slog.w(TAG,"Unable to prepare ANR traces file: " + tracesPath,e);
    return null;
  }
  dumpStackTraces(tracesPath,firstPids,processCpuTracker,lastPids,nativeProcs);
  return tracesFile;
}
