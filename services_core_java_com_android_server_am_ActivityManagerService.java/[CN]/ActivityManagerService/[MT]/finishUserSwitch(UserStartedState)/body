{
synchronized (this) {
    if (uss.mState == UserStartedState.STATE_BOOTING && mStartedUsers.get(uss.mHandle.getIdentifier()) == uss) {
      uss.mState=UserStartedState.STATE_RUNNING;
      final int userId=uss.mHandle.getIdentifier();
      Intent intent=new Intent(Intent.ACTION_BOOT_COMPLETED,null);
      intent.putExtra(Intent.EXTRA_USER_HANDLE,userId);
      intent.addFlags(Intent.FLAG_RECEIVER_NO_ABORT);
      broadcastIntentLocked(null,null,intent,null,null,0,null,null,android.Manifest.permission.RECEIVE_BOOT_COMPLETED,AppOpsManager.OP_NONE,true,false,MY_PID,Process.SYSTEM_UID,userId);
    }
    startProfilesLocked();
    int num=mUserLru.size();
    int i=0;
    while (num > MAX_RUNNING_USERS && i < mUserLru.size()) {
      Integer oldUserId=mUserLru.get(i);
      UserStartedState oldUss=mStartedUsers.get(oldUserId);
      if (oldUss == null) {
        mUserLru.remove(i);
        num--;
        continue;
      }
      if (oldUss.mState == UserStartedState.STATE_STOPPING || oldUss.mState == UserStartedState.STATE_SHUTDOWN) {
        num--;
        i++;
        continue;
      }
      if (oldUserId == UserHandle.USER_OWNER || oldUserId == mCurrentUserId) {
        i++;
        continue;
      }
      stopUserLocked(oldUserId,null);
      num--;
      i++;
    }
  }
}
