{
  if (DEBUG_BACKUP)   Slog.v(TAG,"bindBackupAgent: app=" + app + " mode="+ backupMode);
  enforceCallingPermission("android.permission.BACKUP","bindBackupAgent");
synchronized (this) {
    BatteryStatsImpl.Uid.Pkg.Serv ss=null;
    BatteryStatsImpl stats=mBatteryStatsService.getActiveStatistics();
synchronized (stats) {
      ss=stats.getServiceStatsLocked(app.uid,app.packageName,app.name);
    }
    try {
      AppGlobals.getPackageManager().setPackageStoppedState(app.packageName,false,UserHandle.getUserId(app.uid));
    }
 catch (    RemoteException e) {
    }
catch (    IllegalArgumentException e) {
      Slog.w(TAG,"Failed trying to unstop package " + app.packageName + ": "+ e);
    }
    BackupRecord r=new BackupRecord(ss,app,backupMode);
    ComponentName hostingName=(backupMode == IApplicationThread.BACKUP_MODE_INCREMENTAL) ? new ComponentName(app.packageName,app.backupAgentName) : new ComponentName("android","FullBackupAgent");
    ProcessRecord proc=startProcessLocked(app.processName,app,false,0,"backup",hostingName,false,false,false);
    if (proc == null) {
      Slog.e(TAG,"Unable to start backup agent process " + r);
      return false;
    }
    r.app=proc;
    mBackupTarget=r;
    mBackupAppName=app.packageName;
    updateOomAdjLocked(proc);
    if (proc.thread != null) {
      if (DEBUG_BACKUP)       Slog.v(TAG,"Agent proc already running: " + proc);
      try {
        proc.thread.scheduleCreateBackupAgent(app,compatibilityInfoForPackageLocked(app),backupMode);
      }
 catch (      RemoteException e) {
      }
    }
 else {
      if (DEBUG_BACKUP)       Slog.v(TAG,"Agent proc not running, waiting for attach");
    }
  }
  return true;
}
