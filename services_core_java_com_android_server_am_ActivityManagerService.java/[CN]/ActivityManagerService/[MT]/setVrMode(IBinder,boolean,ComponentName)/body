{
  if (!mContext.getPackageManager().hasSystemFeature(PackageManager.FEATURE_VR_MODE)) {
    throw new UnsupportedOperationException("VR mode not supported on this device!");
  }
  final VrManagerInternal vrService=LocalServices.getService(VrManagerInternal.class);
  ActivityRecord r;
synchronized (this) {
    r=ActivityRecord.isInStackLocked(token);
  }
  if (r == null) {
    throw new IllegalArgumentException();
  }
  int err;
  if ((err=vrService.hasVrPackage(packageName,r.userId)) != VrManagerInternal.NO_ERROR) {
    return err;
  }
synchronized (this) {
    r.requestedVrComponent=(enabled) ? packageName : null;
    if (r == mFocusedActivity) {
      applyUpdateVrModeLocked(r);
    }
    return 0;
  }
}
