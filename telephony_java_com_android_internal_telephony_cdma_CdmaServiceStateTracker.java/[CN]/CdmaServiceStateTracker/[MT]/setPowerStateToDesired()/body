{
  if (mDesiredPowerState && cm.getRadioState() == CommandsInterface.RadioState.RADIO_OFF) {
    cm.setRadioPower(true,null);
  }
 else   if (!mDesiredPowerState && cm.getRadioState().isOn()) {
    DataConnectionTracker dcTracker=phone.mDataConnection;
    if (!dcTracker.isDataConnectionAsDesired()) {
      EventLog.List val=new EventLog.List(dcTracker.getStateInString(),(dcTracker.getAnyDataEnabled() ? 1 : 0));
      EventLog.writeEvent(TelephonyEventLog.EVENT_LOG_DATA_STATE_RADIO_OFF,val);
    }
    Message msg=dcTracker.obtainMessage(DataConnectionTracker.EVENT_CLEAN_UP_CONNECTION);
    msg.arg1=1;
    msg.obj=CDMAPhone.REASON_RADIO_TURNED_OFF;
    dcTracker.sendMessage(msg);
    for (int i=0; i < MAX_NUM_DATA_STATE_READS; i++) {
      DataConnectionTracker.State currentState=dcTracker.getState();
      if (currentState != DataConnectionTracker.State.CONNECTED && currentState != DataConnectionTracker.State.DISCONNECTING) {
        if (DBG)         log("Data shutdown complete.");
        break;
      }
      SystemClock.sleep(DATA_STATE_POLL_SLEEP_MS);
    }
    cm.setRadioPower(false,null);
  }
}
