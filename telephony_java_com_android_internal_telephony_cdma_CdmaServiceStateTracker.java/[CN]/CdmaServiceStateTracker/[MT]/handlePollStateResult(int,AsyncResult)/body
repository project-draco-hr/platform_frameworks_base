{
  if (ar.userObj != pollingContext)   return;
  if (ar.exception != null) {
    CommandException.Error err=null;
    if (ar.exception instanceof CommandException) {
      err=((CommandException)(ar.exception)).getCommandError();
    }
    if (err == CommandException.Error.RADIO_NOT_AVAILABLE) {
      cancelPollState();
      return;
    }
    if (!cm.getRadioState().isOn()) {
      cancelPollState();
      return;
    }
    if (err != CommandException.Error.OP_NOT_ALLOWED_BEFORE_REG_NW) {
      loge("handlePollStateResult: RIL returned an error where it must succeed" + ar.exception);
    }
  }
 else   try {
    handlePollStateResultMessage(what,ar);
  }
 catch (  RuntimeException ex) {
    loge("handlePollStateResult: Exception while polling service state. " + "Probably malformed RIL response." + ex);
  }
  pollingContext[0]--;
  if (pollingContext[0] == 0) {
    boolean namMatch=false;
    if (!isSidsAllZeros() && isHomeSid(newSS.getSystemId())) {
      namMatch=true;
    }
    if (isSubscriptionFromRuim) {
      newSS.setRoaming(isRoamingBetweenOperators(mCdmaRoaming,newSS));
    }
 else {
      newSS.setRoaming(mCdmaRoaming);
    }
    newSS.setCdmaDefaultRoamingIndicator(mDefaultRoamingIndicator);
    newSS.setCdmaRoamingIndicator(mRoamingIndicator);
    boolean isPrlLoaded=true;
    if (TextUtils.isEmpty(mPrlVersion)) {
      isPrlLoaded=false;
    }
    if (!isPrlLoaded) {
      newSS.setCdmaRoamingIndicator(EriInfo.ROAMING_INDICATOR_OFF);
    }
 else     if (!isSidsAllZeros()) {
      if (!namMatch && !mIsInPrl) {
        newSS.setCdmaRoamingIndicator(mDefaultRoamingIndicator);
      }
 else       if (namMatch && !mIsInPrl) {
        newSS.setCdmaRoamingIndicator(EriInfo.ROAMING_INDICATOR_FLASH);
      }
 else       if (!namMatch && mIsInPrl) {
        newSS.setCdmaRoamingIndicator(mRoamingIndicator);
      }
 else {
        if ((mRoamingIndicator <= 2)) {
          newSS.setCdmaRoamingIndicator(EriInfo.ROAMING_INDICATOR_OFF);
        }
 else {
          newSS.setCdmaRoamingIndicator(mRoamingIndicator);
        }
      }
    }
    int roamingIndicator=newSS.getCdmaRoamingIndicator();
    newSS.setCdmaEriIconIndex(phone.mEriManager.getCdmaEriIconIndex(roamingIndicator,mDefaultRoamingIndicator));
    newSS.setCdmaEriIconMode(phone.mEriManager.getCdmaEriIconMode(roamingIndicator,mDefaultRoamingIndicator));
    if (DBG) {
      log("Set CDMA Roaming Indicator to: " + newSS.getCdmaRoamingIndicator() + ". mCdmaRoaming = "+ mCdmaRoaming+ ", isPrlLoaded = "+ isPrlLoaded+ ". namMatch = "+ namMatch+ " , mIsInPrl = "+ mIsInPrl+ ", mRoamingIndicator = "+ mRoamingIndicator+ ", mDefaultRoamingIndicator= "+ mDefaultRoamingIndicator);
    }
    pollStateDone();
  }
}
