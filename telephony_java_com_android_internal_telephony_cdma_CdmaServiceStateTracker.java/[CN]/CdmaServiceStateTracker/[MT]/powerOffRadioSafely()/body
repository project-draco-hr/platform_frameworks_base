{
  DataConnectionTracker dcTracker=phone.mDataConnection;
  Message msg=dcTracker.obtainMessage(DataConnectionTracker.EVENT_CLEAN_UP_CONNECTION);
  msg.obj=CDMAPhone.REASON_RADIO_TURNED_OFF;
synchronized (this) {
    if (!mPendingRadioPowerOffAfterDataOff) {
      DataConnectionTracker.State currentState=dcTracker.getState();
      if (currentState != DataConnectionTracker.State.CONNECTED && currentState != DataConnectionTracker.State.DISCONNECTING && currentState != DataConnectionTracker.State.INITING) {
        msg.arg1=0;
        dcTracker.sendMessage(msg);
        if (DBG)         log("Data disconnected, turn off radio right away.");
        hangupAndPowerOff();
      }
 else {
        msg.arg1=1;
        dcTracker.sendMessage(msg);
        if (sendEmptyMessageDelayed(EVENT_SET_RADIO_POWER_OFF,30000)) {
          if (DBG)           log("Wait upto 30s for data to disconnect, then turn off radio.");
          mPendingRadioPowerOffAfterDataOff=true;
        }
 else {
          Log.w(LOG_TAG,"Cannot send delayed Msg, turn off radio right away.");
          hangupAndPowerOff();
        }
      }
    }
  }
}
