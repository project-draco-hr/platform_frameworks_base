{
  Bundle metaData=receiver.metaData;
  if (metaData == null) {
    return;
  }
  int configResId=metaData.getInt(InputManager.META_DATA_KEYBOARD_LAYOUTS);
  if (configResId == 0) {
    Slog.w(TAG,"Missing meta-data '" + InputManager.META_DATA_KEYBOARD_LAYOUTS + "' on receiver "+ receiver.packageName+ "/"+ receiver.name);
    return;
  }
  CharSequence receiverLabel=receiver.loadLabel(pm);
  String collection=receiverLabel != null ? receiverLabel.toString() : "";
  int priority;
  if ((receiver.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0) {
    priority=requestedPriority;
  }
 else {
    priority=0;
  }
  try {
    Resources resources=pm.getResourcesForApplication(receiver.applicationInfo);
    XmlResourceParser parser=resources.getXml(configResId);
    try {
      XmlUtils.beginDocument(parser,"keyboard-layouts");
      for (; ; ) {
        XmlUtils.nextElement(parser);
        String element=parser.getName();
        if (element == null) {
          break;
        }
        if (element.equals("keyboard-layout")) {
          TypedArray a=resources.obtainAttributes(parser,com.android.internal.R.styleable.KeyboardLayout);
          try {
            String name=a.getString(com.android.internal.R.styleable.KeyboardLayout_name);
            String label=a.getString(com.android.internal.R.styleable.KeyboardLayout_label);
            int keyboardLayoutResId=a.getResourceId(com.android.internal.R.styleable.KeyboardLayout_keyboardLayout,0);
            String languageTags=a.getString(com.android.internal.R.styleable.KeyboardLayout_locale);
            Locale[] locales=getLocalesFromLanguageTags(languageTags);
            int vid=a.getInt(com.android.internal.R.styleable.KeyboardLayout_vendorId,-1);
            int pid=a.getInt(com.android.internal.R.styleable.KeyboardLayout_productId,-1);
            if (name == null || label == null || keyboardLayoutResId == 0) {
              Slog.w(TAG,"Missing required 'name', 'label' or 'keyboardLayout' " + "attributes in keyboard layout " + "resource from receiver " + receiver.packageName + "/"+ receiver.name);
            }
 else {
              String descriptor=KeyboardLayoutDescriptor.format(receiver.packageName,receiver.name,name);
              if (keyboardName == null || name.equals(keyboardName)) {
                KeyboardLayout layout=new KeyboardLayout(descriptor,label,collection,priority,locales,vid,pid);
                visitor.visitKeyboardLayout(resources,keyboardLayoutResId,layout);
              }
            }
          }
  finally {
            a.recycle();
          }
        }
 else {
          Slog.w(TAG,"Skipping unrecognized element '" + element + "' in keyboard layout resource from receiver "+ receiver.packageName+ "/"+ receiver.name);
        }
      }
    }
  finally {
      parser.close();
    }
  }
 catch (  Exception ex) {
    Slog.w(TAG,"Could not parse keyboard layout resource from receiver " + receiver.packageName + "/"+ receiver.name,ex);
  }
}
