{
  final ArrayList<KeyboardLayout> list=new ArrayList<KeyboardLayout>();
  visitAllKeyboardLayouts(new KeyboardLayoutVisitor(){
    boolean mHasSeenDeviceSpecificLayout;
    @Override public void visitKeyboardLayout(    Resources resources,    int keyboardLayoutResId,    KeyboardLayout layout){
      if (layout.getVendorId() == identifier.getVendorId() && layout.getProductId() == identifier.getProductId()) {
        if (!mHasSeenDeviceSpecificLayout) {
          mHasSeenDeviceSpecificLayout=true;
          list.clear();
        }
        list.add(layout);
      }
 else       if (layout.getVendorId() == -1 && layout.getProductId() == -1 && !mHasSeenDeviceSpecificLayout) {
        list.add(layout);
      }
    }
  }
);
  return list.toArray(new KeyboardLayout[list.size()]);
}
