{
  if (!checkCallingPermission(android.Manifest.permission.SET_KEYBOARD_LAYOUT,"removeKeyboardLayoutForInputDevice()")) {
    throw new SecurityException("Requires SET_KEYBOARD_LAYOUT permission");
  }
  if (keyboardLayoutDescriptor == null) {
    throw new IllegalArgumentException("keyboardLayoutDescriptor must not be null");
  }
  String key=getLayoutDescriptor(identifier);
synchronized (mDataStore) {
    try {
      String oldLayout=mDataStore.getCurrentKeyboardLayout(key);
      if (oldLayout == null && !key.equals(identifier.getDescriptor())) {
        oldLayout=mDataStore.getCurrentKeyboardLayout(identifier.getDescriptor());
      }
      boolean removed=mDataStore.removeKeyboardLayout(key,keyboardLayoutDescriptor);
      if (!key.equals(identifier.getDescriptor())) {
        removed|=mDataStore.removeKeyboardLayout(identifier.getDescriptor(),keyboardLayoutDescriptor);
      }
      if (removed && !Objects.equal(oldLayout,mDataStore.getCurrentKeyboardLayout(key))) {
        mHandler.sendEmptyMessage(MSG_RELOAD_KEYBOARD_LAYOUTS);
      }
    }
  finally {
      mDataStore.saveIfNeeded();
    }
  }
}
