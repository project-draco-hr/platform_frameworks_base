{
  if (x + w < X || X + WIDTH < x || y + h < Y || Y + HEIGHT < y) {
    return;
  }
  int destX, destY, destWidth, destHeight, endX, endY, srcEndX, srcEndY;
  int newOffset=off;
  endX=X + WIDTH;
  endY=Y + HEIGHT;
  srcEndX=x + w;
  srcEndY=y + h;
  if (x <= X) {
    destX=0;
    newOffset+=X;
    if (endX >= srcEndX) {
      destWidth=srcEndX - X;
    }
 else {
      destWidth=WIDTH;
    }
  }
 else {
    destX=x - X;
    if (endX >= srcEndX) {
      destWidth=w;
    }
 else {
      destWidth=endX - x;
    }
  }
  if (y <= Y) {
    newOffset+=scansize * (Y - y);
    destY=0;
    if (endY >= srcEndY) {
      destHeight=srcEndY - Y;
    }
 else {
      destHeight=HEIGHT;
    }
  }
 else {
    destY=y - Y;
    if (endY >= srcEndY) {
      destHeight=h;
    }
 else {
      destHeight=endY - y;
    }
  }
  consumer.setPixels(destX,destY,destWidth,destHeight,model,pixels,newOffset,scansize);
}
