{
  super.setUp();
  mInstrumentation=getInstrumentation();
  mContext=mInstrumentation.getTargetContext();
  try {
    mOutputWriter=new BufferedWriter(new FileWriter(new File(Environment.getExternalStorageDirectory(),OUTPUT_FILE),true));
  }
 catch (  IOException e) {
    Log.w(TAG,"Test output file could not be opened",e);
    mOutputWriter=null;
  }
  IntentFilter filter=new IntentFilter();
  filter.addAction(BluetoothAdapter.ACTION_DISCOVERY_FINISHED);
  filter.addAction(BluetoothAdapter.ACTION_DISCOVERY_STARTED);
  filter.addAction(BluetoothAdapter.ACTION_SCAN_MODE_CHANGED);
  filter.addAction(BluetoothAdapter.ACTION_STATE_CHANGED);
  filter.addAction(BluetoothDevice.ACTION_BOND_STATE_CHANGED);
  filter.addAction(BluetoothA2dp.ACTION_SINK_STATE_CHANGED);
  filter.addAction(BluetoothHeadset.ACTION_STATE_CHANGED);
  mContext.registerReceiver(mReceiver,filter);
  mA2dp=new BluetoothA2dp(mContext);
  mHeadset=new BluetoothHeadset(mContext,mHeadsetServiceListener);
}
