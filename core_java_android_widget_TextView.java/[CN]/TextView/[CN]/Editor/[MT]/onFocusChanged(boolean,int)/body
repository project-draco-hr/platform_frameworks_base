{
  mShowCursor=SystemClock.uptimeMillis();
  ensureEndedBatchEdit();
  if (focused) {
    int selStart=getSelectionStart();
    int selEnd=getSelectionEnd();
    final boolean isFocusHighlighted=mSelectAllOnFocus && selStart == 0 && selEnd == mText.length();
    mCreatedWithASelection=mFrozenWithFocus && hasSelection() && !isFocusHighlighted;
    if (!mFrozenWithFocus || (selStart < 0 || selEnd < 0)) {
      final int lastTapPosition=getLastTapPosition();
      if (lastTapPosition >= 0) {
        Selection.setSelection((Spannable)mText,lastTapPosition);
      }
      if (mMovement != null) {
        mMovement.onTakeFocus(TextView.this,(Spannable)mText,direction);
      }
      if (((TextView.this instanceof ExtractEditText) || mSelectionMoved) && selStart >= 0 && selEnd >= 0) {
        Selection.setSelection((Spannable)mText,selStart,selEnd);
      }
      if (mSelectAllOnFocus) {
        selectAll();
      }
      mTouchFocusSelected=true;
    }
    mFrozenWithFocus=false;
    mSelectionMoved=false;
    if (mError != null) {
      showError();
    }
    makeBlink();
  }
 else {
    if (mError != null) {
      hideError();
    }
    onEndBatchEdit();
    if (TextView.this instanceof ExtractEditText) {
      final int selStart=getSelectionStart();
      final int selEnd=getSelectionEnd();
      hideControllers();
      Selection.setSelection((Spannable)mText,selStart,selEnd);
    }
 else {
      hideControllers();
      downgradeEasyCorrectionSpans();
    }
    if (mSelectionModifierCursorController != null) {
      mSelectionModifierCursorController.resetTouchOffsets();
    }
  }
}
