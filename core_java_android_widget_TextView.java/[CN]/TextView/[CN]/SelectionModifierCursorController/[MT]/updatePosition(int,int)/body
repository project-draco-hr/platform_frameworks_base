{
  int selectionStart=getSelectionStart();
  int selectionEnd=getSelectionEnd();
  final int previousOffset=mStartHandle.isDragging() ? selectionStart : selectionEnd;
  int offset=getHysteresisOffset(x,y,previousOffset);
  if (mStartHandle.isDragging()) {
    if (offset <= selectionEnd) {
      if (selectionStart == offset) {
        return;
      }
      selectionStart=offset;
    }
 else {
      selectionStart=selectionEnd;
      selectionEnd=offset;
      HandleView temp=mStartHandle;
      mStartHandle=mEndHandle;
      mEndHandle=temp;
    }
  }
 else {
    if (offset >= selectionStart) {
      if (selectionEnd == offset) {
        return;
      }
      selectionEnd=offset;
    }
 else {
      selectionEnd=selectionStart;
      selectionStart=offset;
      HandleView temp=mStartHandle;
      mStartHandle=mEndHandle;
      mEndHandle=temp;
    }
  }
  Selection.setSelection((Spannable)mText,selectionStart,selectionEnd);
  updatePosition();
}
