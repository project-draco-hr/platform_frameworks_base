{
  if (mIsVisible) {
    postInvalidate(mBounds.left,mBounds.top,mBounds.right,mBounds.bottom);
  }
  final int offset=Selection.getSelectionStart(mText);
  if (offset < 0) {
    Log.w(LOG_TAG,"Update cursor controller position called with no cursor",null);
    mIsVisible=false;
    return;
  }
  final int cursorControllerDrawableWidth=mDrawable.getIntrinsicWidth();
  final int cursorControllerDrawableHeight=mDrawable.getIntrinsicHeight();
  final int line=mLayout.getLineForOffset(offset);
  mBounds.left=(int)(mLayout.getPrimaryHorizontal(offset) - 0.5 - cursorControllerDrawableWidth / 2.0);
  mBounds.top=mLayout.getLineTop(line + 1);
  if (line == mLayout.getLineCount() - 1) {
    mBounds.top-=Math.max(0,cursorControllerDrawableHeight / 2 - getExtendedPaddingBottom());
  }
  mBounds.right=mBounds.left + cursorControllerDrawableWidth;
  mBounds.bottom=mBounds.top + cursorControllerDrawableHeight;
  convertFromViewportToContentCoordinates(mBounds);
  mDrawable.setBounds(mBounds);
  mFadeOutTimerStart=System.currentTimeMillis();
  mDrawable.setAlpha(255);
  postInvalidate(mBounds.left,mBounds.top,mBounds.right,mBounds.bottom);
}
