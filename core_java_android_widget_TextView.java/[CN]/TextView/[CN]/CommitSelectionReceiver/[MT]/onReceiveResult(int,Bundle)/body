{
  int start=mNewStart;
  int end=mNewEnd;
  if (resultCode == InputMethodManager.RESULT_SHOWN) {
    start=mPrevStart;
    end=mPrevEnd;
  }
  final int len=mText.length();
  if (start > len) {
    start=len;
  }
  if (end > len) {
    end=len;
  }
  Selection.setSelection((Spannable)mText,start,end);
}
