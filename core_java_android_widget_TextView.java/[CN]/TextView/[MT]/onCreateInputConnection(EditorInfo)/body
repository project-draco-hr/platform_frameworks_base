{
  createEditorIfNeeded("onCreateInputConnection");
  if (onCheckIsTextEditor() && isEnabled()) {
    if (getEditor().mInputMethodState == null) {
      getEditor().mInputMethodState=new InputMethodState();
    }
    outAttrs.inputType=getInputType();
    if (getEditor().mInputContentType != null) {
      outAttrs.imeOptions=getEditor().mInputContentType.imeOptions;
      outAttrs.privateImeOptions=getEditor().mInputContentType.privateImeOptions;
      outAttrs.actionLabel=getEditor().mInputContentType.imeActionLabel;
      outAttrs.actionId=getEditor().mInputContentType.imeActionId;
      outAttrs.extras=getEditor().mInputContentType.extras;
    }
 else {
      outAttrs.imeOptions=EditorInfo.IME_NULL;
    }
    if (focusSearch(FOCUS_DOWN) != null) {
      outAttrs.imeOptions|=EditorInfo.IME_FLAG_NAVIGATE_NEXT;
    }
    if (focusSearch(FOCUS_UP) != null) {
      outAttrs.imeOptions|=EditorInfo.IME_FLAG_NAVIGATE_PREVIOUS;
    }
    if ((outAttrs.imeOptions & EditorInfo.IME_MASK_ACTION) == EditorInfo.IME_ACTION_UNSPECIFIED) {
      if ((outAttrs.imeOptions & EditorInfo.IME_FLAG_NAVIGATE_NEXT) != 0) {
        outAttrs.imeOptions|=EditorInfo.IME_ACTION_NEXT;
      }
 else {
        outAttrs.imeOptions|=EditorInfo.IME_ACTION_DONE;
      }
      if (!shouldAdvanceFocusOnEnter()) {
        outAttrs.imeOptions|=EditorInfo.IME_FLAG_NO_ENTER_ACTION;
      }
    }
    if (isMultilineInputType(outAttrs.inputType)) {
      outAttrs.imeOptions|=EditorInfo.IME_FLAG_NO_ENTER_ACTION;
    }
    outAttrs.hintText=mHint;
    if (mText instanceof Editable) {
      InputConnection ic=new EditableInputConnection(this);
      outAttrs.initialSelStart=getSelectionStart();
      outAttrs.initialSelEnd=getSelectionEnd();
      outAttrs.initialCapsMode=ic.getCursorCapsMode(getInputType());
      return ic;
    }
  }
  return null;
}
