{
  final InputMethodState ims=mInputMethodState;
  if (ims != null && ims.mContentChanged) {
    ims.mContentChanged=false;
    final ExtractedTextRequest req=mInputMethodState.mExtracting;
    if (req != null) {
      InputMethodManager imm=InputMethodManager.peekInstance();
      if (imm != null) {
        if (DEBUG_EXTRACT)         Log.v(TAG,"Retrieving extracted start=" + ims.mChangedStart + " end="+ ims.mChangedEnd+ " delta="+ ims.mChangedDelta);
        if (extractTextInternal(req,ims.mChangedStart,ims.mChangedEnd,ims.mChangedDelta,ims.mTmpExtracted)) {
          if (DEBUG_EXTRACT)           Log.v(TAG,"Reporting extracted start=" + ims.mTmpExtracted.partialStartOffset + " end="+ ims.mTmpExtracted.partialEndOffset+ ": "+ ims.mTmpExtracted.text);
          imm.updateExtractedText(this,req.token,mInputMethodState.mTmpExtracted);
          return true;
        }
      }
    }
  }
  return false;
}
