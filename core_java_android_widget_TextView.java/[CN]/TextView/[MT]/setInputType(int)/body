{
  final boolean wasPassword=isPasswordInputType(mInputType);
  final boolean wasVisiblePassword=isVisiblePasswordInputType(mInputType);
  setInputType(type,false);
  final boolean isPassword=isPasswordInputType(type);
  final boolean isVisiblePassword=isVisiblePasswordInputType(type);
  boolean forceUpdate=false;
  if (isPassword) {
    setTransformationMethod(PasswordTransformationMethod.getInstance());
    setTypefaceByIndex(MONOSPACE,0);
  }
 else   if (isVisiblePassword) {
    if (mTransformation == PasswordTransformationMethod.getInstance()) {
      forceUpdate=true;
    }
    setTypefaceByIndex(MONOSPACE,0);
  }
 else   if (wasPassword || wasVisiblePassword) {
    setTypefaceByIndex(-1,-1);
    if (mTransformation == PasswordTransformationMethod.getInstance()) {
      forceUpdate=true;
    }
  }
  boolean multiLine=(type & (EditorInfo.TYPE_MASK_CLASS | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE)) == (EditorInfo.TYPE_CLASS_TEXT | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE);
  if (mSingleLine == multiLine || forceUpdate) {
    applySingleLine(!multiLine,!isPassword);
  }
  InputMethodManager imm=InputMethodManager.peekInstance();
  if (imm != null)   imm.restartInput(this);
}
