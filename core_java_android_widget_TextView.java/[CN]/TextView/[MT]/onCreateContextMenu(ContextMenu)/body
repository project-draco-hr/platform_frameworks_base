{
  super.onCreateContextMenu(menu);
  boolean added=false;
  mContextMenuTriggeredByKey=mDPadCenterIsDown || mEnterKeyIsDown;
  mDPadCenterIsDown=mEnterKeyIsDown=false;
  MenuHandler handler=new MenuHandler();
  if (mText instanceof Spanned && hasSelectionController()) {
    long lastTouchOffset=getLastTouchOffsets();
    final int selStart=extractRangeStartFromLong(lastTouchOffset);
    final int selEnd=extractRangeEndFromLong(lastTouchOffset);
    URLSpan[] urls=((Spanned)mText).getSpans(selStart,selEnd,URLSpan.class);
    if (urls.length > 0) {
      menu.add(0,ID_COPY_URL,0,com.android.internal.R.string.copyUrl).setOnMenuItemClickListener(handler);
      added=true;
    }
  }
  if (menu.size() > 0) {
    menu.add(0,ID_SELECTION_MODE,0,com.android.internal.R.string.selectTextMode).setOnMenuItemClickListener(handler);
    added=true;
  }
  if (added) {
    menu.setHeaderTitle(com.android.internal.R.string.editTextMenuTitle);
  }
}
