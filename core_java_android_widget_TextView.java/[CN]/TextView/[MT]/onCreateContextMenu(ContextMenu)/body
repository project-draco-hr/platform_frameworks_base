{
  super.onCreateContextMenu(menu);
  boolean added=false;
  if (!isFocused()) {
    if (isFocusable() && mInput != null) {
      if (canCopy()) {
        MenuHandler handler=new MenuHandler();
        int name=com.android.internal.R.string.copyAll;
        menu.add(0,ID_COPY,0,name).setOnMenuItemClickListener(handler).setAlphabeticShortcut('c');
        menu.setHeaderTitle(com.android.internal.R.string.editTextMenuTitle);
      }
    }
    return;
  }
  MenuHandler handler=new MenuHandler();
  if (canSelectAll()) {
    menu.add(0,ID_SELECT_ALL,0,com.android.internal.R.string.selectAll).setOnMenuItemClickListener(handler).setAlphabeticShortcut('a');
    added=true;
  }
  boolean selection=getSelectionStart() != getSelectionEnd();
  if (canCut()) {
    int name;
    if (selection) {
      name=com.android.internal.R.string.cut;
    }
 else {
      name=com.android.internal.R.string.cutAll;
    }
    menu.add(0,ID_CUT,0,name).setOnMenuItemClickListener(handler).setAlphabeticShortcut('x');
    added=true;
  }
  if (canCopy()) {
    int name;
    if (selection) {
      name=com.android.internal.R.string.copy;
    }
 else {
      name=com.android.internal.R.string.copyAll;
    }
    menu.add(0,ID_COPY,0,name).setOnMenuItemClickListener(handler).setAlphabeticShortcut('c');
    added=true;
  }
  if (canPaste()) {
    menu.add(0,ID_PASTE,0,com.android.internal.R.string.paste).setOnMenuItemClickListener(handler).setAlphabeticShortcut('v');
    added=true;
  }
  if (mText instanceof Spanned) {
    int selStart=getSelectionStart();
    int selEnd=getSelectionEnd();
    int min=Math.min(selStart,selEnd);
    int max=Math.max(selStart,selEnd);
    URLSpan[] urls=((Spanned)mText).getSpans(min,max,URLSpan.class);
    if (urls.length == 1) {
      menu.add(0,ID_COPY_URL,0,com.android.internal.R.string.copyUrl).setOnMenuItemClickListener(handler);
      added=true;
    }
  }
  InputMethodManager imm=InputMethodManager.peekInstance();
  if (imm != null && imm.isActive(this)) {
    menu.add(1,ID_SWITCH_IME,0,com.android.internal.R.string.inputMethod).setOnMenuItemClickListener(handler);
    added=true;
  }
  if (added) {
    menu.setHeaderTitle(com.android.internal.R.string.editTextMenuTitle);
  }
}
