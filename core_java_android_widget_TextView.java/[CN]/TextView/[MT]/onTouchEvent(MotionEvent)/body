{
  final int action=event.getActionMasked();
  if (hasSelectionController()) {
    getSelectionController().onTouchEvent(event);
  }
  if (mShowSuggestionRunnable != null) {
    removeCallbacks(mShowSuggestionRunnable);
  }
  if (action == MotionEvent.ACTION_DOWN) {
    mLastDownPositionX=event.getX();
    mLastDownPositionY=event.getY();
    mTouchFocusSelected=false;
    mIgnoreActionUpEvent=false;
  }
  final boolean superResult=super.onTouchEvent(event);
  if (mDiscardNextActionUp && action == MotionEvent.ACTION_UP) {
    mDiscardNextActionUp=false;
    return superResult;
  }
  final boolean touchIsFinished=(action == MotionEvent.ACTION_UP) && !mIgnoreActionUpEvent && isFocused();
  if ((mMovement != null || onCheckIsTextEditor()) && isEnabled() && mText instanceof Spannable&& mLayout != null) {
    boolean handled=false;
    if (mMovement != null) {
      handled|=mMovement.onTouchEvent(this,(Spannable)mText,event);
    }
    if (touchIsFinished && mLinksClickable && mAutoLinkMask != 0 && mTextIsSelectable) {
      ClickableSpan[] links=((Spannable)mText).getSpans(getSelectionStart(),getSelectionEnd(),ClickableSpan.class);
      if (links.length > 0) {
        links[0].onClick(this);
        handled=true;
      }
    }
    if (touchIsFinished && (isTextEditable() || mTextIsSelectable)) {
      final InputMethodManager imm=InputMethodManager.peekInstance();
      viewClicked(imm);
      if (!mTextIsSelectable && mSoftInputShownOnFocus) {
        handled|=imm != null && imm.showSoftInput(this,0);
      }
      boolean selectAllGotFocus=mSelectAllOnFocus && didTouchFocusSelect();
      hideControllers();
      if (!selectAllGotFocus && mText.length() > 0) {
        if (mSpellChecker != null) {
          mSpellChecker.onSelectionChanged();
        }
        if (!extractedTextModeWillBeStarted()) {
          if (isCursorInsideEasyCorrectionSpan()) {
            if (mShowSuggestionRunnable == null) {
              mShowSuggestionRunnable=new Runnable(){
                public void run(){
                  showSuggestions();
                }
              }
;
            }
            postDelayed(mShowSuggestionRunnable,ViewConfiguration.getDoubleTapTimeout());
          }
 else           if (hasInsertionController()) {
            final int offset=getOffsetForPosition(event.getX(),event.getY());
            Selection.setSelection((Spannable)mText,offset);
            getInsertionController().show();
          }
        }
      }
      handled=true;
    }
    if (handled) {
      return true;
    }
  }
  return superResult;
}
