{
  x-=getTotalPaddingLeft();
  y-=getTotalPaddingTop();
  if (x < 0) {
    x=0;
  }
 else   if (x >= (getWidth() - getTotalPaddingRight())) {
    x=getWidth() - getTotalPaddingRight() - 1;
  }
  if (y < 0) {
    y=0;
  }
 else   if (y >= (getHeight() - getTotalPaddingBottom())) {
    y=getHeight() - getTotalPaddingBottom() - 1;
  }
  x+=getScrollX();
  y+=getScrollY();
  Layout layout=getLayout();
  final int line=layout.getLineForVertical(y);
  final int offset=layout.getOffsetForHorizontal(line,x);
  return offset;
}
