{
  super.onWindowFocusChanged(hasWindowFocus);
  if (hasWindowFocus) {
    if (mBlink != null) {
      mBlink.uncancel();
      makeBlink();
    }
    if (getSpellChecker().isSessionActive() && (mSuggestionsPopupWindow == null || !mSuggestionsPopupWindow.mSuggestionPopupWindowVisible)) {
      updateSpellCheckSpans(0,mText.length());
    }
  }
 else {
    if (mBlink != null) {
      mBlink.cancel();
    }
    onEndBatchEdit();
    if (mInputContentType != null) {
      mInputContentType.enterDown=false;
    }
    hideControllers();
    if (mSpellChecker != null && (mSuggestionsPopupWindow == null || !mSuggestionsPopupWindow.mSuggestionPopupWindowVisible)) {
      mSpellChecker.closeSession();
      removeMisspelledSpans();
      mSpellChecker=null;
    }
  }
  startStopMarquee(hasWindowFocus);
}
