{
  Editable content=getEditableText();
  if (content == null) {
    setText(text.text,TextView.BufferType.EDITABLE);
  }
 else   if (text.partialStartOffset < 0) {
    removeParcelableSpans(content,0,content.length());
    content.replace(0,content.length(),text.text);
  }
 else {
    final int N=content.length();
    int start=text.partialStartOffset;
    if (start > N)     start=N;
    int end=text.partialEndOffset;
    if (end > N)     end=N;
    removeParcelableSpans(content,start,end);
    content.replace(start,end,text.text);
  }
  Selection.setSelection((Spannable)getText(),text.selectionStart,text.selectionEnd);
}
