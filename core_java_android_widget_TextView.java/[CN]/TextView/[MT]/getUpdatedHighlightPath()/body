{
  Path highlight=null;
  Paint highlightPaint=mHighlightPaint;
  final int selStart=getSelectionStart();
  final int selEnd=getSelectionEnd();
  if (mMovement != null && (isFocused() || isPressed()) && selStart >= 0) {
    if (selStart == selEnd) {
      if (mEditor != null && getEditor().isCursorVisible() && (SystemClock.uptimeMillis() - getEditor().mShowCursor) % (2 * Editor.BLINK) < Editor.BLINK) {
        if (mHighlightPathBogus) {
          if (mHighlightPath == null)           mHighlightPath=new Path();
          mHighlightPath.reset();
          mLayout.getCursorPath(selStart,mHighlightPath,mText);
          getEditor().updateCursorsPositions();
          mHighlightPathBogus=false;
        }
        highlightPaint.setColor(mCurTextColor);
        if (mCurrentAlpha != 255) {
          highlightPaint.setAlpha((mCurrentAlpha * Color.alpha(mCurTextColor)) / 255);
        }
        highlightPaint.setStyle(Paint.Style.STROKE);
        highlight=mHighlightPath;
      }
    }
 else {
      if (mHighlightPathBogus) {
        if (mHighlightPath == null)         mHighlightPath=new Path();
        mHighlightPath.reset();
        mLayout.getSelectionPath(selStart,selEnd,mHighlightPath);
        mHighlightPathBogus=false;
      }
      highlightPaint.setColor(mHighlightColor);
      if (mCurrentAlpha != 255) {
        highlightPaint.setAlpha((mCurrentAlpha * Color.alpha(mHighlightColor)) / 255);
      }
      highlightPaint.setStyle(Paint.Style.FILL);
      highlight=mHighlightPath;
    }
  }
  return highlight;
}
