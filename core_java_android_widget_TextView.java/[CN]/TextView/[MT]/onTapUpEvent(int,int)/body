{
  final int start=getSelectionStart();
  final int end=getSelectionEnd();
  if (start == end) {
    boolean tapInsideSelectAllOnFocus=mSelectAllOnFocus && prevStart == 0 && prevEnd == mText.length();
    if (start >= prevStart && start < prevEnd && !tapInsideSelectAllOnFocus) {
      Selection.setSelection((Spannable)mText,prevStart,prevEnd);
      if (!mNoContextMenuOnUp)       showContextMenu();
    }
 else {
      stopTextSelectionMode();
      boolean selectAllGotFocus=mSelectAllOnFocus && mTouchFocusSelected;
      if (hasInsertionController() && !selectAllGotFocus) {
        getInsertionController().show();
      }
    }
  }
}
