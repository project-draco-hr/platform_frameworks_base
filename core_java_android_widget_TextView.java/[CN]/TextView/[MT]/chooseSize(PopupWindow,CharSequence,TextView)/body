{
  int wid=tv.getPaddingLeft() + tv.getPaddingRight();
  int ht=tv.getPaddingTop() + tv.getPaddingBottom();
  int defaultWidthInPixels=(int)(DEFAULT_ERROR_POPUP_MAX_WIDTH_IN_DP * getResources().getDisplayMetrics().density);
  Layout l=new StaticLayout(text,tv.getPaint(),defaultWidthInPixels,Layout.Alignment.ALIGN_NORMAL,1,0,true);
  float max=0;
  for (int i=0; i < l.getLineCount(); i++) {
    max=Math.max(max,l.getLineWidth(i));
  }
  pop.setWidth(wid + (int)Math.ceil(max));
  pop.setHeight(ht + l.getHeight());
}
