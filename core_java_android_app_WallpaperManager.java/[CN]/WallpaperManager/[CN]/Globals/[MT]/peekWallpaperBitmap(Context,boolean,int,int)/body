{
synchronized (this) {
    if (mService != null) {
      try {
        if (!mService.isWallpaperSupported(context.getOpPackageName())) {
          return null;
        }
      }
 catch (      RemoteException e) {
        throw e.rethrowFromSystemServer();
      }
    }
    if (mCachedWallpaper != null && mCachedWallpaperUserId == userId) {
      return mCachedWallpaper;
    }
    mCachedWallpaper=null;
    mCachedWallpaperUserId=0;
    try {
      mCachedWallpaper=getCurrentWallpaperLocked(userId);
      mCachedWallpaperUserId=userId;
    }
 catch (    OutOfMemoryError e) {
      Log.w(TAG,"No memory load current wallpaper",e);
    }
    if (mCachedWallpaper != null) {
      return mCachedWallpaper;
    }
    if (returnDefault) {
      if (mDefaultWallpaper == null) {
        mDefaultWallpaper=getDefaultWallpaperLocked(context,which);
      }
      return mDefaultWallpaper;
    }
    return null;
  }
}
