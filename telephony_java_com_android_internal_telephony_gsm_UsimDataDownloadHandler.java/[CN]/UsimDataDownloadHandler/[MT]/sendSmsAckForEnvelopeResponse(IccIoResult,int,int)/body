{
  int sw1=response.sw1;
  int sw2=response.sw2;
  boolean success;
  if ((sw1 == 0x90 && sw2 == 0x00) || sw1 == 0x91) {
    Log.d(TAG,"USIM data download succeeded: " + response.toString());
    success=true;
  }
 else   if (sw1 == 0x93 && sw2 == 0x00) {
    Log.e(TAG,"USIM data download failed: Toolkit busy");
    acknowledgeSmsWithError(CommandsInterface.GSM_SMS_FAIL_CAUSE_USIM_APP_TOOLKIT_BUSY);
    return;
  }
 else   if (sw1 == 0x62 || sw1 == 0x63) {
    Log.e(TAG,"USIM data download failed: " + response.toString());
    success=false;
  }
 else {
    Log.e(TAG,"Unexpected SW1/SW2 response from UICC: " + response.toString());
    success=false;
  }
  byte[] responseBytes=response.payload;
  if (responseBytes == null || responseBytes.length == 0) {
    if (success) {
      mCI.acknowledgeLastIncomingGsmSms(true,0,null);
    }
 else {
      acknowledgeSmsWithError(CommandsInterface.GSM_SMS_FAIL_CAUSE_USIM_DATA_DOWNLOAD_ERROR);
    }
    return;
  }
  byte[] smsAckPdu;
  int index=0;
  if (success) {
    smsAckPdu=new byte[responseBytes.length + 5];
    smsAckPdu[index++]=0x00;
    smsAckPdu[index++]=0x07;
  }
 else {
    smsAckPdu=new byte[responseBytes.length + 6];
    smsAckPdu[index++]=0x00;
    smsAckPdu[index++]=(byte)CommandsInterface.GSM_SMS_FAIL_CAUSE_USIM_DATA_DOWNLOAD_ERROR;
    smsAckPdu[index++]=0x07;
  }
  smsAckPdu[index++]=(byte)pid;
  smsAckPdu[index++]=(byte)dcs;
  if (is7bitDcs(dcs)) {
    int septetCount=responseBytes.length * 8 / 7;
    smsAckPdu[index++]=(byte)septetCount;
  }
 else {
    smsAckPdu[index++]=(byte)responseBytes.length;
  }
  System.arraycopy(responseBytes,0,smsAckPdu,index,responseBytes.length);
  mCI.acknowledgeIncomingGsmSmsWithPdu(success,IccUtils.bytesToHexString(smsAckPdu),null);
}
