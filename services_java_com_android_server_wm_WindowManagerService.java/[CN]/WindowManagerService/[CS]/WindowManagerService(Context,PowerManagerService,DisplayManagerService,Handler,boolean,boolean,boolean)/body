{
  mContext=context;
  mHaveInputMethods=haveInputMethods;
  mAllowBootMessages=showBootMsgs;
  mOnlyCore=onlyCore;
  mLimitedAlphaCompositing=context.getResources().getBoolean(com.android.internal.R.bool.config_sf_limitedAlpha);
  mDisplayManagerService=displayManager;
  mHeadless=displayManager.isHeadless();
  mDisplayManager=(DisplayManager)context.getSystemService(Context.DISPLAY_SERVICE);
  mDisplayManager.registerDisplayListener(this,null);
  Display[] displays=mDisplayManager.getDisplays();
  for (  Display display : displays) {
    createDisplayContent(display);
  }
  mKeyguardDisableHandler=new KeyguardDisableHandler(mContext,mPolicy);
  mPowerManager=pm;
  mPowerManager.setPolicy(mPolicy);
  PowerManager pmc=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mScreenFrozenLock=pmc.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"SCREEN_FROZEN");
  mScreenFrozenLock.setReferenceCounted(false);
  mActivityManager=ActivityManagerNative.getDefault();
  mBatteryStats=BatteryStatsService.getService();
  mWindowAnimationScale=Settings.System.getFloat(context.getContentResolver(),Settings.System.WINDOW_ANIMATION_SCALE,mWindowAnimationScale);
  mTransitionAnimationScale=Settings.System.getFloat(context.getContentResolver(),Settings.System.TRANSITION_ANIMATION_SCALE,mTransitionAnimationScale);
  setAnimatorDurationScale(Settings.System.getFloat(context.getContentResolver(),Settings.System.ANIMATOR_DURATION_SCALE,mTransitionAnimationScale));
  IntentFilter filter=new IntentFilter();
  filter.addAction(DevicePolicyManager.ACTION_DEVICE_POLICY_MANAGER_STATE_CHANGED);
  filter.addAction(Intent.ACTION_USER_SWITCHED);
  mContext.registerReceiver(mBroadcastReceiver,filter);
  mHoldingScreenWakeLock=pmc.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK | PowerManager.ON_AFTER_RELEASE,TAG);
  mHoldingScreenWakeLock.setReferenceCounted(false);
  mInputManager=new InputManagerService(context,mInputMonitor);
  mFxSession=new SurfaceSession();
  mAnimator=new WindowAnimator(this);
  initPolicy(uiHandler);
  mInputManager.start();
  Watchdog.getInstance().addMonitor(this);
  Surface.openTransaction();
  try {
    createWatermarkInTransaction();
  }
  finally {
    Surface.closeTransaction();
  }
}
