{
  DisplayContent displayContent=task.getDisplayContent();
  AppTokenList tokens=task.mAppTokens;
  final int numTokens=tokens.size();
  for (int tokenNdx=numTokens - 1; tokenNdx >= 0; --tokenNdx) {
    tmpRemoveAppWindowsLocked(tokens.get(tokenNdx));
  }
  int pos=findAppWindowInsertionPointLocked(tokens.get(0));
  for (int tokenNdx=0; tokenNdx < numTokens; ++tokenNdx) {
    final AppWindowToken wtoken=tokens.get(tokenNdx);
    if (wtoken != null) {
      final int newPos=reAddAppWindowsLocked(displayContent,pos,wtoken);
      if (newPos != pos) {
        displayContent.layoutNeeded=true;
      }
      pos=newPos;
    }
  }
  if (!updateFocusedWindowLocked(UPDATE_FOCUS_WILL_PLACE_SURFACES,false)) {
    assignLayersLocked(displayContent.getWindowList());
  }
  updateFocusedWindowLocked(UPDATE_FOCUS_WILL_PLACE_SURFACES,false);
  mInputMonitor.setUpdateInputWindowsNeededLw();
  performLayoutAndPlaceSurfacesLocked();
  mInputMonitor.updateInputWindowsLw(false);
}
