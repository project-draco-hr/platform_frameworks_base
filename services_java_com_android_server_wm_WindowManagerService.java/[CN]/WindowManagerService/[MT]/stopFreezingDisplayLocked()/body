{
  if (!mDisplayFrozen) {
    return;
  }
  if (mWaitingForConfig || mAppsFreezingScreen > 0 || mWindowsFreezingScreen || mClientFreezingScreen) {
    if (DEBUG_ORIENTATION)     Slog.d(TAG,"stopFreezingDisplayLocked: Returning mWaitingForConfig=" + mWaitingForConfig + ", mAppsFreezingScreen="+ mAppsFreezingScreen+ ", mWindowsFreezingScreen="+ mWindowsFreezingScreen+ ", mClientFreezingScreen="+ mClientFreezingScreen);
    return;
  }
  mDisplayFrozen=false;
  mH.removeMessages(H.APP_FREEZE_TIMEOUT);
  mH.removeMessages(H.CLIENT_FREEZE_TIMEOUT);
  if (PROFILE_ORIENTATION) {
    Debug.stopMethodTracing();
  }
  boolean updateRotation=false;
  if (CUSTOM_SCREEN_ROTATION && mAnimator.mScreenRotationAnimation != null && mAnimator.mScreenRotationAnimation.hasScreenshot()) {
    if (DEBUG_ORIENTATION)     Slog.i(TAG,"**** Dismissing screen rotation animation");
    DisplayInfo displayInfo=getDefaultDisplayContentLocked().getDisplayInfo();
    if (mAnimator.mScreenRotationAnimation.dismiss(mFxSession,MAX_ANIMATION_DURATION,mTransitionAnimationScale,displayInfo.logicalWidth,displayInfo.logicalHeight)) {
      updateLayoutToAnimationLocked();
    }
 else {
      mAnimator.mScreenRotationAnimation.kill();
      mAnimator.mScreenRotationAnimation=null;
      updateRotation=true;
    }
  }
 else {
    if (mAnimator.mScreenRotationAnimation != null) {
      mAnimator.mScreenRotationAnimation.kill();
      mAnimator.mScreenRotationAnimation=null;
    }
    updateRotation=true;
  }
  mInputMonitor.thawInputDispatchingLw();
  boolean configChanged;
  configChanged=updateOrientationFromAppTokensLocked(false);
  mH.removeMessages(H.FORCE_GC);
  mH.sendMessageDelayed(mH.obtainMessage(H.FORCE_GC),2000);
  mScreenFrozenLock.release();
  if (updateRotation) {
    if (DEBUG_ORIENTATION)     Slog.d(TAG,"Performing post-rotate rotation");
    configChanged|=updateRotationUncheckedLocked(false);
  }
  if (configChanged) {
    mH.sendEmptyMessage(H.SEND_NEW_CONFIGURATION);
  }
}
