{
synchronized (mWindowMap) {
    if (mDisplayEnabled) {
      return;
    }
    if (!mSystemBooted && !mShowingBootMessages) {
      return;
    }
    if (!mForceDisplayEnabled) {
      boolean haveBootMsg=false;
      boolean haveApp=false;
      boolean haveWallpaper=false;
      boolean haveKeyguard=false;
      final int N=mWindows.size();
      for (int i=0; i < N; i++) {
        WindowState w=mWindows.get(i);
        if (w.isVisibleLw() && !w.mObscured && !w.isDrawnLw()) {
          return;
        }
        if (w.isDrawnLw()) {
          if (w.mAttrs.type == WindowManager.LayoutParams.TYPE_BOOT_PROGRESS) {
            haveBootMsg=true;
          }
 else           if (w.mAttrs.type == WindowManager.LayoutParams.TYPE_APPLICATION) {
            haveApp=true;
          }
 else           if (w.mAttrs.type == WindowManager.LayoutParams.TYPE_WALLPAPER) {
            haveWallpaper=true;
          }
 else           if (w.mAttrs.type == WindowManager.LayoutParams.TYPE_KEYGUARD) {
            haveKeyguard=true;
          }
        }
      }
      if (DEBUG_SCREEN_ON) {
        Slog.i(TAG,"******** booted=" + mSystemBooted + " msg="+ mShowingBootMessages+ " haveBoot="+ haveBootMsg+ " haveApp="+ haveApp+ " haveWall="+ haveWallpaper+ " haveKeyguard="+ haveKeyguard);
      }
      if (!mSystemBooted && !haveBootMsg) {
        return;
      }
      if (mSystemBooted && ((!haveApp && !haveKeyguard) || !haveWallpaper)) {
        return;
      }
    }
    mDisplayEnabled=true;
    if (DEBUG_SCREEN_ON)     Slog.i(TAG,"******************** ENABLING SCREEN!");
    if (false) {
      StringWriter sw=new StringWriter();
      PrintWriter pw=new PrintWriter(sw);
      this.dump(null,pw,null);
      Slog.i(TAG,sw.toString());
    }
    try {
      IBinder surfaceFlinger=ServiceManager.getService("SurfaceFlinger");
      if (surfaceFlinger != null) {
        Parcel data=Parcel.obtain();
        data.writeInterfaceToken("android.ui.ISurfaceComposer");
        surfaceFlinger.transact(IBinder.FIRST_CALL_TRANSACTION,data,null,0);
        data.recycle();
      }
    }
 catch (    RemoteException ex) {
      Slog.e(TAG,"Boot completed: SurfaceFlinger is dead!");
    }
  }
  mPolicy.enableScreenAfterBoot();
  updateRotationUnchecked(false);
}
