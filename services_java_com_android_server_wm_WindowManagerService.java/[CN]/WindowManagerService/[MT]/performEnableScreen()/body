{
synchronized (mWindowMap) {
    if (DEBUG_BOOT) {
      RuntimeException here=new RuntimeException("here");
      here.fillInStackTrace();
      Slog.i(TAG,"performEnableScreen: mDisplayEnabled=" + mDisplayEnabled + " mForceDisplayEnabled="+ mForceDisplayEnabled+ " mShowingBootMessages="+ mShowingBootMessages+ " mSystemBooted="+ mSystemBooted+ " mOnlyCore="+ mOnlyCore,here);
    }
    if (mDisplayEnabled) {
      return;
    }
    if (!mSystemBooted && !mShowingBootMessages) {
      return;
    }
    if (!mForceDisplayEnabled) {
      boolean haveBootMsg=false;
      boolean haveApp=false;
      boolean haveWallpaper=false;
      boolean wallpaperEnabled=mContext.getResources().getBoolean(com.android.internal.R.bool.config_enableWallpaperService) && !mOnlyCore;
      boolean haveKeyguard=true;
      final WindowList windows=getDefaultWindowListLocked();
      final int N=windows.size();
      for (int i=0; i < N; i++) {
        WindowState w=windows.get(i);
        if (w.mAttrs.type == TYPE_KEYGUARD) {
          boolean vis=w.mViewVisibility == View.VISIBLE && w.mPolicyVisibility;
          haveKeyguard=!vis;
        }
        if (w.isVisibleLw() && !w.mObscured && !w.isDrawnLw()) {
          return;
        }
        if (w.isDrawnLw()) {
          if (w.mAttrs.type == TYPE_BOOT_PROGRESS) {
            haveBootMsg=true;
          }
 else           if (w.mAttrs.type == TYPE_APPLICATION) {
            haveApp=true;
          }
 else           if (w.mAttrs.type == TYPE_WALLPAPER) {
            haveWallpaper=true;
          }
 else           if (w.mAttrs.type == TYPE_KEYGUARD) {
            haveKeyguard=true;
          }
        }
      }
      if (DEBUG_SCREEN_ON || DEBUG_BOOT) {
        Slog.i(TAG,"******** booted=" + mSystemBooted + " msg="+ mShowingBootMessages+ " haveBoot="+ haveBootMsg+ " haveApp="+ haveApp+ " haveWall="+ haveWallpaper+ " wallEnabled="+ wallpaperEnabled+ " haveKeyguard="+ haveKeyguard);
      }
      if (!mSystemBooted && !haveBootMsg) {
        return;
      }
      if (mSystemBooted && ((!haveApp && !haveKeyguard) || (wallpaperEnabled && !haveWallpaper))) {
        return;
      }
    }
    mDisplayEnabled=true;
    if (DEBUG_SCREEN_ON || DEBUG_BOOT)     Slog.i(TAG,"******************** ENABLING SCREEN!");
    if (false) {
      StringWriter sw=new StringWriter();
      PrintWriter pw=new PrintWriter(sw);
      this.dump(null,pw,null);
      Slog.i(TAG,sw.toString());
    }
    try {
      IBinder surfaceFlinger=ServiceManager.getService("SurfaceFlinger");
      if (surfaceFlinger != null) {
        Parcel data=Parcel.obtain();
        data.writeInterfaceToken("android.ui.ISurfaceComposer");
        surfaceFlinger.transact(IBinder.FIRST_CALL_TRANSACTION,data,null,0);
        data.recycle();
      }
    }
 catch (    RemoteException ex) {
      Slog.e(TAG,"Boot completed: SurfaceFlinger is dead!");
    }
    mInputMonitor.setEventDispatchingLw(mEventDispatchingEnabled);
  }
  mPolicy.enableScreenAfterBoot();
  updateRotationUnchecked(false,false);
}
