{
  if (!checkCallingPermission(android.Manifest.permission.MANAGE_APP_TOKENS,"addAppToken()")) {
    throw new SecurityException("Requires MANAGE_APP_TOKENS permission");
  }
  long inputDispatchingTimeoutNanos;
  try {
    inputDispatchingTimeoutNanos=token.getKeyDispatchingTimeout() * 1000000L;
  }
 catch (  RemoteException ex) {
    Slog.w(TAG,"Could not get dispatching timeout.",ex);
    inputDispatchingTimeoutNanos=DEFAULT_INPUT_DISPATCHING_TIMEOUT_NANOS;
  }
synchronized (mWindowMap) {
    AppWindowToken wtoken=findAppWindowToken(token.asBinder());
    if (wtoken != null) {
      Slog.w(TAG,"Attempted to add existing app token: " + token);
      return;
    }
    wtoken=new AppWindowToken(this,token);
    wtoken.inputDispatchingTimeoutNanos=inputDispatchingTimeoutNanos;
    wtoken.groupId=groupId;
    wtoken.appFullscreen=fullscreen;
    wtoken.requestedOrientation=requestedOrientation;
    if (DEBUG_TOKEN_MOVEMENT || DEBUG_ADD_REMOVE)     Slog.v(TAG,"addAppToken: " + wtoken + " at "+ addPos);
    mAppTokens.add(addPos,wtoken);
    addAppTokenToAnimating(addPos,wtoken);
    mTokenMap.put(token.asBinder(),wtoken);
    wtoken.hidden=true;
    wtoken.hiddenRequested=true;
  }
}
