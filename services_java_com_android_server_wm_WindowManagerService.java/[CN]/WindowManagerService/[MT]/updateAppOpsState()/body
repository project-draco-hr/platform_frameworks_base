{
synchronized (mWindowMap) {
    mTmpWindowsIterator.reset(FORWARD_ITERATOR);
    while (mTmpWindowsIterator.hasNext()) {
      final WindowState win=mTmpWindowsIterator.next();
      if (win.mAppOp != AppOpsManager.OP_NONE) {
        final int mode=mAppOps.checkOpNoThrow(win.mAppOp,win.getOwningUid(),win.getOwningPackage());
        win.setAppOpVisibilityLw(mode == AppOpsManager.MODE_ALLOWED);
      }
    }
  }
}
