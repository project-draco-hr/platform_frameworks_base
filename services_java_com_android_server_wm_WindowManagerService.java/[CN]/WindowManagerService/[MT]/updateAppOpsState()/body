{
synchronized (mWindowMap) {
    AllWindowsIterator iterator=new AllWindowsIterator();
    while (iterator.hasNext()) {
      final WindowState win=iterator.next();
      if (win.mAppOp != AppOpsManager.OP_NONE) {
        final int mode=mAppOps.checkOpNoThrow(win.mAppOp,win.getOwningUid(),win.getOwningPackage());
        win.setAppOpVisibilityLw(mode == AppOpsManager.MODE_ALLOWED);
      }
    }
  }
}
