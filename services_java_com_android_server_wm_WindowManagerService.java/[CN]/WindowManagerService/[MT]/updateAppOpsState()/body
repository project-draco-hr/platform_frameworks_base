{
synchronized (mWindowMap) {
    final int numDisplays=mDisplayContents.size();
    for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
      final WindowList windows=mDisplayContents.valueAt(displayNdx).getWindowList();
      final int numWindows=windows.size();
      for (int winNdx=0; winNdx < numWindows; ++winNdx) {
        final WindowState win=windows.get(winNdx);
        if (win.mAppOp != AppOpsManager.OP_NONE) {
          final int mode=mAppOps.checkOpNoThrow(win.mAppOp,win.getOwningUid(),win.getOwningPackage());
          win.setAppOpVisibilityLw(mode == AppOpsManager.MODE_ALLOWED);
        }
      }
    }
  }
}
