{
  final int dw=mDisplayInfo.appWidth;
  final int dh=mDisplayInfo.appHeight;
  WindowState target=mWallpaperTarget;
  if (target != null) {
    if (target.mWallpaperX >= 0) {
      mLastWallpaperX=target.mWallpaperX;
    }
 else     if (changingTarget.mWallpaperX >= 0) {
      mLastWallpaperX=changingTarget.mWallpaperX;
    }
    if (target.mWallpaperY >= 0) {
      mLastWallpaperY=target.mWallpaperY;
    }
 else     if (changingTarget.mWallpaperY >= 0) {
      mLastWallpaperY=changingTarget.mWallpaperY;
    }
  }
  int curTokenIndex=mWallpaperTokens.size();
  while (curTokenIndex > 0) {
    curTokenIndex--;
    WindowToken token=mWallpaperTokens.get(curTokenIndex);
    int curWallpaperIndex=token.windows.size();
    while (curWallpaperIndex > 0) {
      curWallpaperIndex--;
      WindowState wallpaper=token.windows.get(curWallpaperIndex);
      if (updateWallpaperOffsetLocked(wallpaper,dw,dh,sync)) {
        WindowStateAnimator winAnimator=wallpaper.mWinAnimator;
        winAnimator.computeShownFrameLocked();
        if (winAnimator.mSurfaceX != wallpaper.mShownFrame.left || winAnimator.mSurfaceY != wallpaper.mShownFrame.top) {
          winAnimator.setWallpaperOffset((int)wallpaper.mShownFrame.left,(int)wallpaper.mShownFrame.top);
        }
        sync=false;
      }
    }
  }
}
