{
  long downTime=ev.getDownTime();
  long eventTime=ev.getEventTime();
  int action=ev.getAction();
  int code=ev.getKeyCode();
  int repeatCount=ev.getRepeatCount();
  int metaState=ev.getMetaState();
  int deviceId=ev.getDeviceId();
  int scancode=ev.getScanCode();
  int source=ev.getSource();
  int flags=ev.getFlags();
  if (source == InputDevice.SOURCE_UNKNOWN) {
    source=InputDevice.SOURCE_KEYBOARD;
  }
  if (eventTime == 0)   eventTime=SystemClock.uptimeMillis();
  if (downTime == 0)   downTime=eventTime;
  KeyEvent newEvent=new KeyEvent(downTime,eventTime,action,code,repeatCount,metaState,deviceId,scancode,flags | KeyEvent.FLAG_FROM_SYSTEM,source);
  final int pid=Binder.getCallingPid();
  final int uid=Binder.getCallingUid();
  final long ident=Binder.clearCallingIdentity();
  final int result=mInputManager.injectInputEvent(newEvent,pid,uid,sync ? InputManager.INPUT_EVENT_INJECTION_SYNC_WAIT_FOR_FINISH : InputManager.INPUT_EVENT_INJECTION_SYNC_WAIT_FOR_RESULT,INJECTION_TIMEOUT_MILLIS);
  Binder.restoreCallingIdentity(ident);
  return reportInjectionResult(result);
}
