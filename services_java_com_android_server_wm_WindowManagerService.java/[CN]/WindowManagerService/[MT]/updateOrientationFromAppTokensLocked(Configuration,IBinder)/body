{
  Configuration config=null;
  if (updateOrientationFromAppTokensLocked(false)) {
    if (freezeThisOneIfNeeded != null) {
      AppWindowToken atoken=findAppWindowToken(freezeThisOneIfNeeded);
      if (atoken != null) {
        startAppFreezingScreenLocked(atoken,ActivityInfo.CONFIG_ORIENTATION);
      }
    }
    config=computeNewConfigurationLocked();
  }
 else   if (currentConfig != null) {
    mTempConfiguration.setToDefaults();
    mTempConfiguration.fontScale=currentConfig.fontScale;
    if (computeScreenConfigurationLocked(mTempConfiguration)) {
      if (currentConfig.diff(mTempConfiguration) != 0) {
        mWaitingForConfig=true;
        getDefaultDisplayContentLocked().layoutNeeded=true;
        int anim[]=new int[2];
        if (mAnimator.isDimmingLocked(Display.DEFAULT_DISPLAY)) {
          anim[0]=anim[1]=0;
        }
 else {
          mPolicy.selectRotationAnimationLw(anim);
        }
        startFreezingDisplayLocked(false,anim[0],anim[1]);
        config=new Configuration(mTempConfiguration);
      }
    }
  }
  return config;
}
