{
  Configuration config=null;
  if (updateOrientationFromAppTokensLocked(false)) {
    if (freezeThisOneIfNeeded != null) {
      AppWindowToken wtoken=findAppWindowToken(freezeThisOneIfNeeded);
      if (wtoken != null) {
        startAppFreezingScreenLocked(wtoken,ActivityInfo.CONFIG_ORIENTATION);
      }
    }
    config=computeNewConfigurationLocked();
  }
 else   if (currentConfig != null) {
    mTempConfiguration.setToDefaults();
    mTempConfiguration.fontScale=currentConfig.fontScale;
    if (computeNewConfigurationLocked(mTempConfiguration)) {
      if (currentConfig.diff(mTempConfiguration) != 0) {
        mWaitingForConfig=true;
        mLayoutNeeded=true;
        startFreezingDisplayLocked(false);
        config=new Configuration(mTempConfiguration);
      }
    }
  }
  return config;
}
