{
  final int pid=Binder.getCallingPid();
  final int uid=Binder.getCallingUid();
  final long ident=Binder.clearCallingIdentity();
  MotionEvent newEvent=MotionEvent.obtain(ev);
  if ((newEvent.getSource() & InputDevice.SOURCE_CLASS_TRACKBALL) == 0) {
    newEvent.setSource(InputDevice.SOURCE_TRACKBALL);
  }
  final int result=mInputManager.injectInputEvent(newEvent,pid,uid,sync ? InputManagerService.INPUT_EVENT_INJECTION_SYNC_WAIT_FOR_FINISH : InputManagerService.INPUT_EVENT_INJECTION_SYNC_WAIT_FOR_RESULT,INJECTION_TIMEOUT_MILLIS);
  Binder.restoreCallingIdentity(ident);
  return reportInjectionResult(result,pid);
}
