{
  if (!mInputMonitor.waitForInputDevicesReady(INPUT_DEVICES_READY_FOR_SAFE_MODE_DETECTION_TIMEOUT_MILLIS)) {
    Slog.w(TAG,"Devices still not ready after waiting " + INPUT_DEVICES_READY_FOR_SAFE_MODE_DETECTION_TIMEOUT_MILLIS + " milliseconds before attempting to detect safe mode.");
  }
  int menuState=mInputManager.getKeyCodeState(-1,InputDevice.SOURCE_ANY,KeyEvent.KEYCODE_MENU);
  int sState=mInputManager.getKeyCodeState(-1,InputDevice.SOURCE_ANY,KeyEvent.KEYCODE_S);
  int dpadState=mInputManager.getKeyCodeState(-1,InputDevice.SOURCE_DPAD,KeyEvent.KEYCODE_DPAD_CENTER);
  int trackballState=mInputManager.getScanCodeState(-1,InputDevice.SOURCE_TRACKBALL,InputManagerService.BTN_MOUSE);
  int volumeDownState=mInputManager.getKeyCodeState(-1,InputDevice.SOURCE_ANY,KeyEvent.KEYCODE_VOLUME_DOWN);
  mSafeMode=menuState > 0 || sState > 0 || dpadState > 0 || trackballState > 0 || volumeDownState > 0;
  try {
    if (SystemProperties.getInt(ShutdownThread.REBOOT_SAFEMODE_PROPERTY,0) != 0) {
      mSafeMode=true;
      SystemProperties.set(ShutdownThread.REBOOT_SAFEMODE_PROPERTY,"");
    }
  }
 catch (  IllegalArgumentException e) {
  }
  if (mSafeMode) {
    Log.i(TAG,"SAFE MODE ENABLED (menu=" + menuState + " s="+ sState+ " dpad="+ dpadState+ " trackball="+ trackballState+ ")");
  }
 else {
    Log.i(TAG,"SAFE MODE not enabled");
  }
  mPolicy.setSafeMode(mSafeMode);
  return mSafeMode;
}
