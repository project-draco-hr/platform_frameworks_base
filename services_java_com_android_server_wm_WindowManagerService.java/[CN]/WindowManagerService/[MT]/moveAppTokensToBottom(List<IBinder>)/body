{
  if (!checkCallingPermission(android.Manifest.permission.MANAGE_APP_TOKENS,"moveAppTokensToBottom()")) {
    throw new SecurityException("Requires MANAGE_APP_TOKENS permission");
  }
  final long origId=Binder.clearCallingIdentity();
synchronized (mWindowMap) {
    DisplayContent displayContent=null;
    final int N=tokens.size();
    if (N > 0) {
      AppWindowToken wt=findAppWindowToken(tokens.get(0));
      if (wt != null) {
        displayContent=mTaskIdToDisplayContents.get(wt.groupId);
        displayContent.refillAnimatingAppTokens();
      }
    }
    removeAppTokensLocked(tokens);
    int pos=0;
    for (int i=0; i < N; i++) {
      AppWindowToken wt=findAppWindowToken(tokens.get(i));
      if (wt != null) {
        if (DEBUG_TOKEN_MOVEMENT) {
          Slog.v(TAG,"Adding next to bottom: " + wt + " at "+ pos);
          if (displayContent != null && displayContent != mTaskIdToDisplayContents.get(wt.groupId))           Slog.e(TAG,"moveAppTokensToBottom: Not all tokens on same display");
        }
        displayContent=mTaskIdToDisplayContents.get(wt.groupId);
        displayContent.mAppTokens.add(pos,wt);
        if (mAppTransition.isTransitionSet()) {
          wt.sendingToBottom=true;
        }
        pos++;
      }
    }
    displayContent.refillAnimatingAppTokens();
    moveAppWindowsLocked(tokens,displayContent,0);
  }
  Binder.restoreCallingIdentity(origId);
}
