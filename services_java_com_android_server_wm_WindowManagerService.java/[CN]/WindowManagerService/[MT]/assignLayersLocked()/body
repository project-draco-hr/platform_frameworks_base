{
  int N=mWindows.size();
  int curBaseLayer=0;
  int curLayer=0;
  int i;
  if (DEBUG_LAYERS) {
    RuntimeException here=new RuntimeException("here");
    here.fillInStackTrace();
    Slog.v(TAG,"Assigning layers",here);
  }
  for (i=0; i < N; i++) {
    WindowState w=mWindows.get(i);
    if (w.mBaseLayer == curBaseLayer || w.mIsImWindow || (i > 0 && w.mIsWallpaper)) {
      curLayer+=WINDOW_LAYER_MULTIPLIER;
      w.mLayer=curLayer;
    }
 else {
      curBaseLayer=curLayer=w.mBaseLayer;
      w.mLayer=curLayer;
    }
    if (w.mTargetAppToken != null) {
      w.mWinAnimator.mAnimLayer=w.mLayer + w.mTargetAppToken.mAppAnimator.animLayerAdjustment;
    }
 else     if (w.mAppToken != null) {
      w.mWinAnimator.mAnimLayer=w.mLayer + w.mAppToken.mAppAnimator.animLayerAdjustment;
    }
 else {
      w.mWinAnimator.mAnimLayer=w.mLayer;
    }
    if (w.mIsImWindow) {
      w.mWinAnimator.mAnimLayer+=mInputMethodAnimLayerAdjustment;
    }
 else     if (w.mIsWallpaper) {
      w.mWinAnimator.mAnimLayer+=mWallpaperAnimLayerAdjustment;
    }
    if (DEBUG_LAYERS)     Slog.v(TAG,"Assign layer " + w + ": "+ w.mWinAnimator.mAnimLayer);
  }
}
