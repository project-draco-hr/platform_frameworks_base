{
  int w=mPolicy.getNonDecorDisplayWidth(dw,dh,rotation);
  int h=mPolicy.getNonDecorDisplayHeight(dw,dh,rotation);
  int screenLayoutSize;
  boolean screenLayoutLong;
  boolean screenLayoutCompatNeeded;
  int longSize=w;
  int shortSize=h;
  if (longSize < shortSize) {
    int tmp=longSize;
    longSize=shortSize;
    shortSize=tmp;
  }
  longSize=(int)(longSize / density);
  shortSize=(int)(shortSize / density);
  if (longSize < 470) {
    screenLayoutSize=Configuration.SCREENLAYOUT_SIZE_SMALL;
    screenLayoutLong=false;
    screenLayoutCompatNeeded=false;
  }
 else {
    if (longSize >= 960 && shortSize >= 720) {
      screenLayoutSize=Configuration.SCREENLAYOUT_SIZE_XLARGE;
    }
 else     if (longSize >= 640 && shortSize >= 480) {
      screenLayoutSize=Configuration.SCREENLAYOUT_SIZE_LARGE;
    }
 else {
      screenLayoutSize=Configuration.SCREENLAYOUT_SIZE_NORMAL;
    }
    if (shortSize > 321 || longSize > 570) {
      screenLayoutCompatNeeded=true;
    }
 else {
      screenLayoutCompatNeeded=false;
    }
    if (((longSize * 3) / 5) >= (shortSize - 1)) {
      screenLayoutLong=true;
    }
 else {
      screenLayoutLong=false;
    }
  }
  if (!screenLayoutLong) {
    curLayout=(curLayout & ~Configuration.SCREENLAYOUT_LONG_MASK) | Configuration.SCREENLAYOUT_LONG_NO;
  }
  if (screenLayoutCompatNeeded) {
    curLayout|=Configuration.SCREENLAYOUT_COMPAT_NEEDED;
  }
  int curSize=curLayout & Configuration.SCREENLAYOUT_SIZE_MASK;
  if (screenLayoutSize < curSize) {
    curLayout=(curLayout & ~Configuration.SCREENLAYOUT_SIZE_MASK) | screenLayoutSize;
  }
  return curLayout;
}
