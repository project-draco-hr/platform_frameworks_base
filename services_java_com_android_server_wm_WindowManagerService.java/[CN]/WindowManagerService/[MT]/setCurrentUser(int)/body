{
synchronized (mWindowMap) {
    int oldUserId=mCurrentUserId;
    mCurrentUserId=newUserId;
    mPolicy.setCurrentUserLw(newUserId);
    final int numDisplays=mDisplayContents.size();
    for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
      final DisplayContent displayContent=mDisplayContents.valueAt(displayNdx);
      displayContent.switchUserStacks(oldUserId,newUserId);
      rebuildAppWindowListLocked(displayContent);
    }
    performLayoutAndPlaceSurfacesLocked();
  }
}
