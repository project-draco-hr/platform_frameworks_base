{
synchronized (mWindowMap) {
    int oldUserId=mCurrentUserId;
    mCurrentUserId=newUserId;
    mAppTransition.setCurrentUser(newUserId);
    mPolicy.setCurrentUserLw(newUserId);
    DisplayContentsIterator iterator=new DisplayContentsIterator();
    while (iterator.hasNext()) {
      DisplayContent displayContent=iterator.next();
      displayContent.switchUserStacks(oldUserId,newUserId);
      rebuildAppWindowListLocked(displayContent);
    }
    performLayoutAndPlaceSurfacesLocked();
  }
}
