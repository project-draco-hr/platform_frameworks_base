{
synchronized (mWindowMap) {
    mCurrentUserId=newUserId;
    mAppTransition.setCurrentUser(newUserId);
    mPolicy.setCurrentUserLw(newUserId);
    final int numDisplays=mDisplayContents.size();
    for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
      final DisplayContent displayContent=mDisplayContents.valueAt(displayNdx);
      final WindowList windows=displayContent.getWindowList();
      for (int i=0; i < windows.size(); i++) {
        final WindowState win=windows.get(i);
        if (win.isHiddenFromUserLocked()) {
          Slog.w(TAG,"current user violation " + newUserId + " hiding "+ win+ ", attrs="+ win.mAttrs.type+ ", belonging to "+ win.mOwnerUid);
          win.hideLw(false);
        }
      }
    }
    performLayoutAndPlaceSurfacesLocked();
  }
}
