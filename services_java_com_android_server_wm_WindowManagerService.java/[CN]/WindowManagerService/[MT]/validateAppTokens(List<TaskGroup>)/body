{
  int t=tasks.size() - 1;
  if (t < 0) {
    Slog.w(TAG,"validateAppTokens: empty task list");
    return;
  }
  TaskGroup task=tasks.get(0);
  int taskId=task.taskId;
  DisplayContent displayContent=mTaskIdToDisplayContents.get(taskId);
  if (displayContent == null) {
    Slog.w(TAG,"validateAppTokens: no Display for taskId=" + taskId);
    return;
  }
  AppTokenList appTokens=displayContent.mAppTokens;
  int m=appTokens.size() - 1;
  for (; t >= 0; --t) {
    task=tasks.get(t);
    List<IApplicationToken> tokens=task.tokens;
    int v=task.tokens.size() - 1;
    DisplayContent lastDisplayContent=displayContent;
    displayContent=mTaskIdToDisplayContents.get(taskId);
    if (displayContent != lastDisplayContent) {
      Slog.w(TAG,"validateAppTokens: displayContent changed in TaskGroup list!");
      return;
    }
    while (v >= 0 && m >= 0) {
      AppWindowToken atoken=appTokens.get(m);
      if (atoken.removed) {
        m--;
        continue;
      }
      if (tokens.get(v) != atoken.token) {
        Slog.w(TAG,"Tokens out of sync: external is " + tokens.get(v) + " @ "+ v+ ", internal is "+ atoken.token+ " @ "+ m);
      }
      v--;
      m--;
    }
    while (v >= 0) {
      Slog.w(TAG,"External token not found: " + tokens.get(v) + " @ "+ v);
      v--;
    }
  }
  while (m >= 0) {
    AppWindowToken atoken=appTokens.get(m);
    if (!atoken.removed) {
      Slog.w(TAG,"Invalid internal atoken: " + atoken.token + " @ "+ m);
    }
    m--;
  }
}
