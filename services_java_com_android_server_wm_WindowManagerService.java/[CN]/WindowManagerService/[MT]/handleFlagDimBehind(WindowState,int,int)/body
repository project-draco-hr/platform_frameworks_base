{
  final WindowManager.LayoutParams attrs=w.mAttrs;
  if ((attrs.flags & FLAG_DIM_BEHIND) != 0 && w.isDisplayedLw() && !w.mExiting) {
    mInnerFields.mDimming=true;
    final WindowStateAnimator winAnimator=w.mWinAnimator;
    if (!mAnimator.isDimmingLocked(winAnimator)) {
      final int width, height;
      if (attrs.type == TYPE_BOOT_PROGRESS) {
        final DisplayInfo displayInfo=w.mDisplayContent.getDisplayInfo();
        width=displayInfo.logicalWidth;
        height=displayInfo.logicalHeight;
      }
 else {
        width=innerDw;
        height=innerDh;
      }
      if (localLOGV)       Slog.v(TAG,"Win " + w + " start dimming.");
      startDimmingLocked(winAnimator,w.mExiting ? 0 : w.mAttrs.dimAmount,width,height);
    }
  }
}
