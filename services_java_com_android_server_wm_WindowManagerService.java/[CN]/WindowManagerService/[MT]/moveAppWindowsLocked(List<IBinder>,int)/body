{
  final int N=tokens.size();
  int i;
  for (i=0; i < N; i++) {
    WindowToken token=mTokenMap.get(tokens.get(i));
    if (token != null) {
      tmpRemoveAppWindowsLocked(token);
    }
  }
  DisplayContentsIterator iterator=new DisplayContentsIterator();
  while (iterator.hasNext()) {
    final DisplayContent displayContent=iterator.next();
    final WindowList windows=displayContent.getWindowList();
    int pos=findWindowOffsetLocked(windows,tokenPos);
    for (i=0; i < N; i++) {
      WindowToken token=mTokenMap.get(tokens.get(i));
      if (token != null) {
        pos=reAddAppWindowsLocked(displayContent,pos,token);
      }
    }
    if (!updateFocusedWindowLocked(UPDATE_FOCUS_WILL_PLACE_SURFACES,false)) {
      assignLayersLocked(windows);
    }
  }
  mInputMonitor.setUpdateInputWindowsNeededLw();
  mLayoutNeeded=true;
  performLayoutAndPlaceSurfacesLocked();
  mInputMonitor.updateInputWindowsLw(false);
}
