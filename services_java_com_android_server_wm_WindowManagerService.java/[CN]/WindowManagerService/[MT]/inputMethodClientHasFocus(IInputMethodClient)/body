{
synchronized (mWindowMap) {
    int idx=findDesiredInputMethodWindowIndexLocked(false);
    WindowState imFocus;
    if (idx > 0) {
      imFocus=mWindows.get(idx - 1);
      if (DEBUG_INPUT_METHOD) {
        Slog.i(TAG,"Desired input method target: " + imFocus);
        Slog.i(TAG,"Current focus: " + this.mCurrentFocus);
        Slog.i(TAG,"Last focus: " + this.mLastFocus);
      }
      if (imFocus != null) {
        if (imFocus.mAttrs.type == LayoutParams.TYPE_APPLICATION_STARTING && imFocus.mAppToken != null) {
          for (int i=0; i < imFocus.mAppToken.windows.size(); i++) {
            WindowState w=imFocus.mAppToken.windows.get(i);
            if (w != imFocus) {
              Log.i(TAG,"Switching to real app window: " + w);
              imFocus=w;
              break;
            }
          }
        }
        if (DEBUG_INPUT_METHOD) {
          Slog.i(TAG,"IM target client: " + imFocus.mSession.mClient);
          if (imFocus.mSession.mClient != null) {
            Slog.i(TAG,"IM target client binder: " + imFocus.mSession.mClient.asBinder());
            Slog.i(TAG,"Requesting client binder: " + client.asBinder());
          }
        }
        if (imFocus.mSession.mClient != null && imFocus.mSession.mClient.asBinder() == client.asBinder()) {
          return true;
        }
        if (mCurrentFocus != null && mCurrentFocus.mSession.mClient != null && mCurrentFocus.mSession.mClient.asBinder() == client.asBinder()) {
          return true;
        }
      }
    }
  }
  return false;
}
