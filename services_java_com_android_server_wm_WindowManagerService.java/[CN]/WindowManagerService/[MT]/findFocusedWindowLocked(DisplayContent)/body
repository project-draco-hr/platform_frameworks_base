{
  final AppTokenList appTokens=displayContent.mAppTokens;
  int nextAppIndex=appTokens.size() - 1;
  WindowToken nextApp=nextAppIndex >= 0 ? appTokens.get(nextAppIndex) : null;
  final WindowList windows=displayContent.getWindowList();
  for (int i=windows.size() - 1; i >= 0; i--) {
    final WindowState win=windows.get(i);
    if (localLOGV || DEBUG_FOCUS)     Slog.v(TAG,"Looking for focus: " + i + " = "+ win+ ", flags="+ win.mAttrs.flags+ ", canReceive="+ win.canReceiveKeys());
    AppWindowToken thisApp=win.mAppToken;
    if (thisApp != null && (thisApp.removed || thisApp.sendingToBottom)) {
      if (DEBUG_FOCUS)       Slog.v(TAG,"Skipping app because " + (thisApp.removed ? "removed" : "sendingToBottom"));
      continue;
    }
    if (thisApp != null && nextApp != null && thisApp != nextApp && win.mAttrs.type != TYPE_APPLICATION_STARTING) {
      int origAppIndex=nextAppIndex;
      while (nextAppIndex > 0) {
        if (nextApp == mFocusedApp) {
          if (localLOGV || DEBUG_FOCUS)           Slog.v(TAG,"Reached focused app: " + mFocusedApp);
          return null;
        }
        nextAppIndex--;
        nextApp=appTokens.get(nextAppIndex);
        if (nextApp == thisApp) {
          break;
        }
      }
      if (thisApp != nextApp) {
        nextAppIndex=origAppIndex;
        nextApp=appTokens.get(nextAppIndex);
      }
    }
    if (win.canReceiveKeys()) {
      if (DEBUG_FOCUS)       Slog.v(TAG,"Found focus @ " + i + " = "+ win);
      return win;
    }
  }
  return null;
}
