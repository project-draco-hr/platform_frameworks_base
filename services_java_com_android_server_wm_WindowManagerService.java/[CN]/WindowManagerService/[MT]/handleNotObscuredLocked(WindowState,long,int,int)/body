{
  final WindowManager.LayoutParams attrs=w.mAttrs;
  final int attrFlags=attrs.flags;
  final boolean canBeSeen=w.isDisplayedLw();
  if (w.mSurface != null) {
    if ((attrFlags & FLAG_KEEP_SCREEN_ON) != 0) {
      mInnerFields.mHoldScreen=w.mSession;
    }
    if (!mInnerFields.mSyswin && w.mAttrs.screenBrightness >= 0 && mInnerFields.mScreenBrightness < 0) {
      mInnerFields.mScreenBrightness=w.mAttrs.screenBrightness;
    }
    if (!mInnerFields.mSyswin && w.mAttrs.buttonBrightness >= 0 && mInnerFields.mButtonBrightness < 0) {
      mInnerFields.mButtonBrightness=w.mAttrs.buttonBrightness;
    }
    if (canBeSeen && (attrs.type == WindowManager.LayoutParams.TYPE_SYSTEM_DIALOG || attrs.type == WindowManager.LayoutParams.TYPE_KEYGUARD || attrs.type == WindowManager.LayoutParams.TYPE_SYSTEM_ERROR)) {
      mInnerFields.mSyswin=true;
    }
  }
  boolean opaqueDrawn=canBeSeen && w.isOpaqueDrawn();
  if (opaqueDrawn && w.isFullscreen(innerDw,innerDh)) {
    mInnerFields.mObscured=true;
  }
 else   if (canBeSeen && (attrFlags & (FLAG_BLUR_BEHIND | FLAG_DIM_BEHIND)) != 0) {
    if (localLOGV)     Slog.v(TAG,"Win " + w + ": blurring="+ mInnerFields.mBlurring+ " obscured="+ mInnerFields.mObscured);
    if ((attrFlags & FLAG_DIM_BEHIND) != 0) {
      if (!mInnerFields.mDimming) {
        mInnerFields.mDimming=true;
        if (mDimAnimator == null) {
          mDimAnimator=new DimAnimator(mFxSession);
        }
        if (attrs.type == WindowManager.LayoutParams.TYPE_BOOT_PROGRESS) {
          mDimAnimator.show(mCurDisplayWidth,mCurDisplayHeight);
        }
 else {
          mDimAnimator.show(innerDw,innerDh);
        }
        mDimAnimator.show(innerDw,innerDh);
        mDimAnimator.updateParameters(mContext.getResources(),w,currentTime);
      }
    }
    if ((attrFlags & FLAG_BLUR_BEHIND) != 0) {
      if (!mInnerFields.mBlurring) {
        mInnerFields.mBlurring=true;
        if (mBlurSurface == null) {
          try {
            mBlurSurface=new Surface(mFxSession,0,"BlurSurface",-1,16,16,PixelFormat.OPAQUE,Surface.FX_SURFACE_BLUR);
          }
 catch (          Exception e) {
            Slog.e(TAG,"Exception creating Blur surface",e);
          }
          if (SHOW_TRANSACTIONS)           Slog.i(TAG,"  BLUR " + mBlurSurface + ": CREATE");
        }
        final int dw=mCurDisplayWidth;
        final int dh=mCurDisplayHeight;
        if (mBlurSurface != null) {
          if (SHOW_TRANSACTIONS)           Slog.i(TAG,"  BLUR " + mBlurSurface + ": pos=(0,0) ("+ dw+ "x"+ dh+ "), layer="+ (w.mAnimLayer - 1));
          mBlurSurface.setPosition(0,0);
          mBlurSurface.setSize(dw,dh);
          mBlurSurface.setLayer(w.mAnimLayer - LAYER_OFFSET_BLUR);
          if (!mBlurShown) {
            try {
              if (SHOW_TRANSACTIONS)               Slog.i(TAG,"  BLUR " + mBlurSurface + ": SHOW");
              mBlurSurface.show();
            }
 catch (            RuntimeException e) {
              Slog.w(TAG,"Failure showing blur surface",e);
            }
            mBlurShown=true;
          }
        }
      }
    }
  }
}
