{
  final WindowManager.LayoutParams attrs=w.mAttrs;
  final int attrFlags=attrs.flags;
  final boolean canBeSeen=w.isDisplayedLw();
  if (w.mHasSurface) {
    if ((attrFlags & FLAG_KEEP_SCREEN_ON) != 0) {
      mInnerFields.mHoldScreen=w.mSession;
    }
    if (!mInnerFields.mSyswin && w.mAttrs.screenBrightness >= 0 && mInnerFields.mScreenBrightness < 0) {
      mInnerFields.mScreenBrightness=w.mAttrs.screenBrightness;
    }
    if (!mInnerFields.mSyswin && w.mAttrs.buttonBrightness >= 0 && mInnerFields.mButtonBrightness < 0) {
      mInnerFields.mButtonBrightness=w.mAttrs.buttonBrightness;
    }
    if (canBeSeen && (attrs.type == WindowManager.LayoutParams.TYPE_SYSTEM_DIALOG || attrs.type == WindowManager.LayoutParams.TYPE_KEYGUARD || attrs.type == WindowManager.LayoutParams.TYPE_SYSTEM_ERROR)) {
      mInnerFields.mSyswin=true;
    }
  }
  boolean opaqueDrawn=canBeSeen && w.isOpaqueDrawn();
  if (opaqueDrawn && w.isFullscreen(innerDw,innerDh)) {
    mInnerFields.mObscured=true;
  }
 else   if (canBeSeen && (attrFlags & FLAG_DIM_BEHIND) != 0 && !(w.mAppToken != null && w.mAppToken.hiddenRequested) && !w.mExiting) {
    if (localLOGV)     Slog.v(TAG,"Win " + w + " obscured="+ mInnerFields.mObscured);
    if (!mInnerFields.mDimming) {
      mInnerFields.mDimming=true;
      final WindowStateAnimator winAnimator=w.mWinAnimator;
      if (!mAnimator.isDimming(winAnimator)) {
        final int width, height;
        if (attrs.type == WindowManager.LayoutParams.TYPE_BOOT_PROGRESS) {
          width=mCurDisplayWidth;
          height=mCurDisplayHeight;
        }
 else {
          width=innerDw;
          height=innerDh;
        }
        startDimming(winAnimator,w.mExiting ? 0 : w.mAttrs.dimAmount,width,height);
      }
    }
  }
}
