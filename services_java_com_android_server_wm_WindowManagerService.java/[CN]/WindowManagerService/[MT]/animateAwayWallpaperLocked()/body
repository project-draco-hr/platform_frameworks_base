{
  int changes=0;
  WindowState oldWallpaper=mWallpaperTarget;
  if (mLowerWallpaperTarget != null && mLowerWallpaperTarget.mAppToken != null) {
    if (DEBUG_WALLPAPER)     Slog.v(TAG,"wallpaperForceHiding changed with lower=" + mLowerWallpaperTarget);
    if (DEBUG_WALLPAPER)     Slog.v(TAG,"hidden=" + mLowerWallpaperTarget.mAppToken.hidden + " hiddenRequested="+ mLowerWallpaperTarget.mAppToken.hiddenRequested);
    if (mLowerWallpaperTarget.mAppToken.hidden) {
      mLowerWallpaperTarget=mUpperWallpaperTarget=null;
      changes|=PhoneWindowManager.FINISH_LAYOUT_REDO_ANIM;
    }
  }
  mInnerFields.mAdjResult|=adjustWallpaperWindowsLocked();
  mInnerFields.mWallpaperMayChange=false;
  mInnerFields.mWallpaperForceHidingChanged=false;
  if (DEBUG_WALLPAPER)   Slog.v(TAG,"****** OLD: " + oldWallpaper + " NEW: "+ mWallpaperTarget+ " LOWER: "+ mLowerWallpaperTarget);
  if (mLowerWallpaperTarget == null) {
    mAnimator.mForceHiding=false;
    for (int i=mWindows.size() - 1; i >= 0; i--) {
      WindowState w=mWindows.get(i);
      if (w.mWinAnimator.mSurface != null) {
        final WindowManager.LayoutParams attrs=w.mAttrs;
        if (mPolicy.doesForceHide(w,attrs) && w.isVisibleLw()) {
          if (DEBUG_FOCUS)           Slog.i(TAG,"win=" + w + " force hides other windows");
          mAnimator.mForceHiding=true;
        }
 else         if (mPolicy.canBeForceHidden(w,attrs)) {
          if (!w.mWinAnimator.mAnimating) {
            w.mWinAnimator.clearAnimation();
          }
        }
      }
    }
  }
  return changes;
}
