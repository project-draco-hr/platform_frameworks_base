{
  if (DEBUG_FOCUS_LIGHT)   Slog.d(TAG,"addWindowToListInOrderLocked: win=" + win + " Callers="+ Debug.getCallers(4));
  if (win.mAttachedWindow == null) {
    final WindowToken token=win.mToken;
    int tokenWindowsPos=0;
    if (token.appWindowToken != null) {
      tokenWindowsPos=addAppWindowToListLocked(win);
    }
 else {
      addFreeWindowToListLocked(win);
    }
    if (addToToken) {
      if (DEBUG_ADD_REMOVE)       Slog.v(TAG,"Adding " + win + " to "+ token);
      token.windows.add(tokenWindowsPos,win);
    }
  }
 else {
    addAttachedWindowToListLocked(win,addToToken);
  }
  if (win.mAppToken != null && addToToken) {
    win.mAppToken.allAppWindows.add(win);
  }
}
