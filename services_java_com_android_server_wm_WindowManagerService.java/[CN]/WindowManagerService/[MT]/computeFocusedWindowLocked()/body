{
  WindowState result=null;
  WindowState win;
  int nextAppIndex=mAppTokens.size() - 1;
  WindowToken nextApp=nextAppIndex >= 0 ? mAppTokens.get(nextAppIndex) : null;
  for (int i=mWindows.size() - 1; i >= 0; i--) {
    win=mWindows.get(i);
    if (localLOGV || DEBUG_FOCUS)     Slog.v(TAG,"Looking for focus: " + i + " = "+ win+ ", flags="+ win.mAttrs.flags+ ", canReceive="+ win.canReceiveKeys());
    AppWindowToken thisApp=win.mAppToken;
    if (thisApp != null && (thisApp.removed || thisApp.sendingToBottom)) {
      continue;
    }
    if (thisApp != null && nextApp != null && thisApp != nextApp && win.mAttrs.type != TYPE_APPLICATION_STARTING) {
      int origAppIndex=nextAppIndex;
      while (nextAppIndex > 0) {
        if (nextApp == mFocusedApp) {
          if (localLOGV || DEBUG_FOCUS)           Slog.v(TAG,"Reached focused app: " + mFocusedApp);
          return null;
        }
        nextAppIndex--;
        nextApp=mAppTokens.get(nextAppIndex);
        if (nextApp == thisApp) {
          break;
        }
      }
      if (thisApp != nextApp) {
        nextAppIndex=origAppIndex;
        nextApp=mAppTokens.get(nextAppIndex);
      }
    }
    if (win.canReceiveKeys()) {
      if (DEBUG_FOCUS)       Slog.v(TAG,"Found focus @ " + i + " = "+ win);
      result=win;
      break;
    }
  }
  return result;
}
