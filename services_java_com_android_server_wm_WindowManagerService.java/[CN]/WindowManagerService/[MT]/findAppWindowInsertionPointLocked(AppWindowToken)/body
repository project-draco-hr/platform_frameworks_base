{
  final int taskId=target.groupId;
  DisplayContent displayContent=mTaskIdToDisplayContents.get(taskId);
  if (displayContent == null) {
    Slog.w(TAG,"findTopAppWindowLocked: no DisplayContent for " + target);
    return 0;
  }
  final WindowList windows=displayContent.getWindowList();
  final int NW=windows.size();
  AppTokenIterator iterator=displayContent.new AppTokenIterator(true);
  while (iterator.hasNext()) {
    if (iterator.next() == target) {
      break;
    }
  }
  while (iterator.hasNext()) {
    final AppWindowToken wtoken=iterator.next();
    if (DEBUG_REORDER)     Slog.v(TAG,"Looking for lower windows in " + wtoken.token);
    if (wtoken.sendingToBottom) {
      if (DEBUG_REORDER)       Slog.v(TAG,"Skipping token -- currently sending to bottom");
      continue;
    }
    for (int i=wtoken.windows.size() - 1; i >= 0; --i) {
      WindowState win=wtoken.windows.get(i);
      for (int j=win.mChildWindows.size() - 1; j >= 0; --j) {
        WindowState cwin=win.mChildWindows.get(j);
        if (cwin.mSubLayer >= 0) {
          for (int pos=NW - 1; pos >= 0; pos--) {
            if (windows.get(pos) == cwin) {
              if (DEBUG_REORDER)               Slog.v(TAG,"Found child win @" + (pos + 1));
              return pos + 1;
            }
          }
        }
      }
      for (int pos=NW - 1; pos >= 0; pos--) {
        if (windows.get(pos) == win) {
          if (DEBUG_REORDER)           Slog.v(TAG,"Found win @" + (pos + 1));
          return pos + 1;
        }
      }
    }
  }
  return 0;
}
