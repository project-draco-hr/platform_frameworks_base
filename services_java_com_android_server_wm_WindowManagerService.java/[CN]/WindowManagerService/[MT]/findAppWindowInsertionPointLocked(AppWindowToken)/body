{
  final int taskId=target.groupId;
  DisplayContent displayContent=mTaskIdToDisplayContents.get(taskId);
  if (displayContent == null) {
    Slog.w(TAG,"findTopAppWindowLocked: no DisplayContent for " + target);
    return 0;
  }
  final WindowList windows=displayContent.getWindowList();
  final int NW=windows.size();
  boolean found=false;
  final ArrayList<TaskList> tasks=displayContent.mTaskLists;
  for (int taskNdx=tasks.size() - 1; taskNdx >= 0; --taskNdx) {
    final TaskList task=tasks.get(taskNdx);
    if (!found && task.taskId != taskId) {
      continue;
    }
    AppTokenList tokens=task.mAppTokens;
    for (int tokenNdx=tokens.size() - 1; tokenNdx >= 0; --tokenNdx) {
      final AppWindowToken wtoken=tokens.get(tokenNdx);
      if (!found && wtoken == target) {
        found=true;
      }
      if (found) {
        if (DEBUG_REORDER)         Slog.v(TAG,"Looking for lower windows in " + wtoken.token);
        if (wtoken.sendingToBottom) {
          if (DEBUG_REORDER)           Slog.v(TAG,"Skipping token -- currently sending to bottom");
          continue;
        }
        for (int i=wtoken.windows.size() - 1; i >= 0; --i) {
          WindowState win=wtoken.windows.get(i);
          for (int j=win.mChildWindows.size() - 1; j >= 0; --j) {
            WindowState cwin=win.mChildWindows.get(j);
            if (cwin.mSubLayer >= 0) {
              for (int pos=NW - 1; pos >= 0; pos--) {
                if (windows.get(pos) == cwin) {
                  if (DEBUG_REORDER)                   Slog.v(TAG,"Found child win @" + (pos + 1));
                  return pos + 1;
                }
              }
            }
          }
          for (int pos=NW - 1; pos >= 0; pos--) {
            if (windows.get(pos) == win) {
              if (DEBUG_REORDER)               Slog.v(TAG,"Found win @" + (pos + 1));
              return pos + 1;
            }
          }
        }
      }
    }
  }
  return 0;
}
