{
  if (mDisplayFrozen) {
    return;
  }
  mScreenFrozenLock.acquire();
  mDisplayFrozen=true;
  mInputMonitor.freezeInputDispatchingLw();
  if (mNextAppTransition != WindowManagerPolicy.TRANSIT_UNSET) {
    mNextAppTransition=WindowManagerPolicy.TRANSIT_UNSET;
    mNextAppTransitionPackage=null;
    mAppTransitionReady=true;
  }
  if (PROFILE_ORIENTATION) {
    File file=new File("/data/system/frozen");
    Debug.startMethodTracing(file.toString(),8 * 1024 * 1024);
  }
  if (CUSTOM_SCREEN_ROTATION) {
    if (mScreenRotationAnimation != null && mScreenRotationAnimation.isAnimating()) {
      mScreenRotationAnimation.kill();
      mScreenRotationAnimation=null;
    }
    if (mScreenRotationAnimation == null) {
      mScreenRotationAnimation=new ScreenRotationAnimation(mContext,mFxSession,inTransaction,mCurDisplayWidth,mCurDisplayHeight,mDisplay.getRotation());
    }
    if (!mScreenRotationAnimation.hasScreenshot()) {
      Surface.freezeDisplay(0);
    }
  }
 else {
    Surface.freezeDisplay(0);
  }
}
