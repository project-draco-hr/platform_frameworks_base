{
  final Cursor c=query(Settings.Secure.CONTENT_URI,new String[]{Settings.NameValueTable.VALUE},Settings.NameValueTable.NAME + "=?",new String[]{Settings.Secure.ANDROID_ID},null);
  try {
    final String value=c.moveToNext() ? c.getString(0) : null;
    if (value == null) {
      final SecureRandom random=SecureRandom.getInstance("SHA1PRNG");
      String serial=SystemProperties.get("ro.serialno","");
      random.setSeed((serial + System.nanoTime() + new SecureRandom().nextLong()).getBytes());
      final String newAndroidIdValue=Long.toHexString(random.nextLong());
      Log.d(TAG,"Generated and saved new ANDROID_ID [" + newAndroidIdValue + "]");
      final ContentValues values=new ContentValues();
      values.put(Settings.NameValueTable.NAME,Settings.Secure.ANDROID_ID);
      values.put(Settings.NameValueTable.VALUE,newAndroidIdValue);
      final Uri uri=insert(Settings.Secure.CONTENT_URI,values);
      if (uri == null) {
        return false;
      }
    }
    return true;
  }
 catch (  NoSuchAlgorithmException e) {
    return false;
  }
 finally {
    c.close();
  }
}
