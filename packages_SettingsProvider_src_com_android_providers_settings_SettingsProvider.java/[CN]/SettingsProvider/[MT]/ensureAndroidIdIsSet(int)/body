{
  final Cursor c=queryForUser(Settings.Secure.CONTENT_URI,new String[]{Settings.NameValueTable.VALUE},Settings.NameValueTable.NAME + "=?",new String[]{Settings.Secure.ANDROID_ID},null,userHandle);
  try {
    final String value=c.moveToNext() ? c.getString(0) : null;
    if (value == null) {
      final UserInfo user=mUserManager.getUserInfo(userHandle);
      if (user == null) {
        return false;
      }
      final SecureRandom random=new SecureRandom();
      final String newAndroidIdValue=Long.toHexString(random.nextLong());
      final ContentValues values=new ContentValues();
      values.put(Settings.NameValueTable.NAME,Settings.Secure.ANDROID_ID);
      values.put(Settings.NameValueTable.VALUE,newAndroidIdValue);
      final Uri uri=insertForUser(Settings.Secure.CONTENT_URI,values,userHandle);
      if (uri == null) {
        Slog.e(TAG,"Unable to generate new ANDROID_ID for user " + userHandle);
        return false;
      }
      Slog.d(TAG,"Generated and saved new ANDROID_ID [" + newAndroidIdValue + "] for user "+ userHandle);
      if (user.isRestricted()) {
        DropBoxManager dbm=(DropBoxManager)getContext().getSystemService(Context.DROPBOX_SERVICE);
        if (dbm != null && dbm.isTagEnabled(DROPBOX_TAG_USERLOG)) {
          dbm.addText(DROPBOX_TAG_USERLOG,System.currentTimeMillis() + ",restricted_profile_ssaid," + newAndroidIdValue+ "\n");
        }
      }
    }
    return true;
  }
  finally {
    c.close();
  }
}
