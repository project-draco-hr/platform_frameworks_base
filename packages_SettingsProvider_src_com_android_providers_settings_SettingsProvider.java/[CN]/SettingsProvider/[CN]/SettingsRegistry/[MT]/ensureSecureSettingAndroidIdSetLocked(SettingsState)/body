{
  Setting value=secureSettings.getSettingLocked(Settings.Secure.ANDROID_ID);
  if (!value.isNull()) {
    return;
  }
  final int userId=getUserIdFromKey(secureSettings.mKey);
  final UserInfo user;
  final long identity=Binder.clearCallingIdentity();
  try {
    user=mUserManager.getUserInfo(userId);
  }
  finally {
    Binder.restoreCallingIdentity(identity);
  }
  if (user == null) {
    return;
  }
  String androidId=Long.toHexString(new SecureRandom().nextLong());
  secureSettings.insertSettingLocked(Settings.Secure.ANDROID_ID,androidId,SettingsState.SYSTEM_PACKAGE_NAME);
  Slog.d(LOG_TAG,"Generated and saved new ANDROID_ID [" + androidId + "] for user "+ userId);
  if (user.isRestricted()) {
    DropBoxManager dbm=(DropBoxManager)getContext().getSystemService(Context.DROPBOX_SERVICE);
    if (dbm != null && dbm.isTagEnabled(DROPBOX_TAG_USERLOG)) {
      dbm.addText(DROPBOX_TAG_USERLOG,System.currentTimeMillis() + "," + DROPBOX_TAG_USERLOG+ ","+ androidId+ "\n");
    }
  }
}
