{
  final boolean forceAllowOnExternal=Settings.Global.getInt(context.getContentResolver(),Settings.Global.FORCE_ALLOW_ON_EXTERNAL,0) != 0;
  if (VolumeInfo.ID_PRIVATE_INTERNAL.equals(vol.getId())) {
    return true;
  }
  if (app.isSystemApp()) {
    return false;
  }
  if (!forceAllowOnExternal && (app.installLocation == PackageInfo.INSTALL_LOCATION_INTERNAL_ONLY || app.installLocation == PackageInfo.INSTALL_LOCATION_UNSPECIFIED)) {
    return false;
  }
  if (!vol.isMountedWritable()) {
    return false;
  }
  if (vol.isPrimaryPhysical()) {
    return app.isInternal();
  }
  return (vol.getType() == VolumeInfo.TYPE_PRIVATE);
}
