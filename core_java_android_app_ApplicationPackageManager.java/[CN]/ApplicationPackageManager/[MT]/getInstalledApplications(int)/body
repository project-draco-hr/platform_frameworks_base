{
  int userId=UserId.getUserId(Process.myUid());
  try {
    final List<ApplicationInfo> applicationInfos=new ArrayList<ApplicationInfo>();
    ApplicationInfo lastItem=null;
    ParceledListSlice<ApplicationInfo> slice;
    do {
      final String lastKey=lastItem != null ? lastItem.packageName : null;
      slice=mPM.getInstalledApplications(flags,lastKey,userId);
      lastItem=slice.populateList(applicationInfos,ApplicationInfo.CREATOR);
    }
 while (!slice.isLastSlice());
    return applicationInfos;
  }
 catch (  RemoteException e) {
    throw new RuntimeException("Package manager has died",e);
  }
}
