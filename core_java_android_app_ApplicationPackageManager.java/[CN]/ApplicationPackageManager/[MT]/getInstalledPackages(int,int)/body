{
  try {
    final List<PackageInfo> packageInfos=new ArrayList<PackageInfo>();
    PackageInfo lastItem=null;
    ParceledListSlice<PackageInfo> slice;
    do {
      final String lastKey=lastItem != null ? lastItem.packageName : null;
      slice=mPM.getInstalledPackages(flags,lastKey,userId);
      lastItem=slice.populateList(packageInfos,PackageInfo.CREATOR);
    }
 while (!slice.isLastSlice());
    return packageInfos;
  }
 catch (  RemoteException e) {
    throw new RuntimeException("Package manager has died",e);
  }
}
