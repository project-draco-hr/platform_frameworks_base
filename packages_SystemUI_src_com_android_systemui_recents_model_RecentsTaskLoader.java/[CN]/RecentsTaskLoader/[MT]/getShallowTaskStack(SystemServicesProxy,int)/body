{
  RecentsConfiguration config=RecentsConfiguration.getInstance();
  List<ActivityManager.RecentTaskInfo> tasks=getRecentTasks(ssp,numTasks);
  TaskStack stack=new TaskStack();
  int taskCount=tasks.size();
  for (int i=0; i < taskCount; i++) {
    ActivityManager.RecentTaskInfo t=tasks.get(i);
    ActivityInfo info=ssp.getActivityInfo(t.baseIntent.getComponent(),t.userId);
    if (info == null)     continue;
    stack.addTask(new Task(t.persistentId,true,t.baseIntent,t.affiliatedTaskId,t.affiliatedTaskColor,null,null,0,0,t.firstActiveTime,t.lastActiveTime,(i == (taskCount - 1)),config.lockToAppEnabled));
  }
  stack.createAffiliatedGroupings(config);
  return stack;
}
