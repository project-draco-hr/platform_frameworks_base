{
  long t1=System.currentTimeMillis();
  if (Console.Enabled) {
    Console.log(Constants.Log.App.TaskDataLoader,"[RecentsTaskLoader|reload]");
  }
  RecentsConfiguration config=RecentsConfiguration.getInstance();
  Resources res=context.getResources();
  LinkedHashSet<Task> tasksToLoad=new LinkedHashSet<Task>();
  TaskStack stack=new TaskStack();
  SpaceNode root=new SpaceNode();
  root.setStack(stack);
  SystemServicesProxy ssp=mSystemServicesProxy;
  List<ActivityManager.RecentTaskInfo> tasks=getRecentTasks(ssp);
  t1=System.currentTimeMillis();
  int taskCount=tasks.size();
  for (int i=0; i < taskCount; i++) {
    ActivityManager.RecentTaskInfo t=tasks.get(i);
    ActivityInfo info=ssp.getActivityInfo(t.baseIntent.getComponent(),t.userId);
    if (info == null)     continue;
    ActivityManager.TaskDescription av=t.taskDescription;
    String activityLabel=null;
    Drawable activityIcon=null;
    int activityColor=config.taskBarViewDefaultBackgroundColor;
    if (av != null) {
      activityLabel=(av.getLabel() != null ? av.getLabel() : ssp.getActivityLabel(info));
      activityIcon=(av.getIcon() != null) ? ssp.getBadgedIcon(new BitmapDrawable(res,av.getIcon()),t.userId) : null;
      if (av.getPrimaryColor() != 0) {
        activityColor=av.getPrimaryColor();
      }
    }
 else {
      activityLabel=ssp.getActivityLabel(info);
    }
    boolean isForemostTask=(i == (taskCount - 1));
    Task task=new Task(t.persistentId,(t.id > -1),t.baseIntent,t.affiliatedTaskId,activityLabel,activityIcon,activityColor,t.userId,t.firstActiveTime,t.lastActiveTime,(i == (taskCount - 1)));
    if (i >= (taskCount - preloadCount)) {
      if (Console.Enabled) {
        Console.log(Constants.Log.App.TaskDataLoader,"[RecentsTaskLoader|preloadTask]","i: " + i + " task: "+ t.baseIntent.getComponent().getPackageName());
      }
      task.applicationIcon=mApplicationIconCache.getCheckLastActiveTime(task.key);
      if (task.applicationIcon == null) {
        if (isForemostTask) {
          task.applicationIcon=ssp.getActivityIcon(info,task.userId);
          if (task.applicationIcon == null) {
            task.applicationIcon=mDefaultApplicationIcon;
          }
          mApplicationIconCache.put(task.key,task.applicationIcon);
        }
 else {
          tasksToLoad.add(task);
        }
      }
      task.thumbnail=mThumbnailCache.getCheckLastActiveTime(task.key);
      if (task.thumbnail == null) {
        if (Console.Enabled) {
          Console.log(Constants.Log.App.TaskDataLoader,"[RecentsTaskLoader|loadingTaskThumbnail]");
        }
        if (isForemostTask) {
          task.thumbnail=ssp.getTaskThumbnail(task.key.id);
          if (task.thumbnail != null) {
            task.thumbnail.setHasAlpha(false);
          }
 else {
            task.thumbnail=mDefaultThumbnail;
          }
          mThumbnailCache.put(task.key,task.thumbnail);
        }
 else {
          tasksToLoad.add(task);
        }
      }
    }
    if (Console.Enabled) {
      Console.log(Constants.Log.App.TaskDataLoader,"  [RecentsTaskLoader|task]",t.baseIntent.getComponent().getPackageName());
    }
    stack.addTask(task);
  }
  if (Console.Enabled) {
    Console.log(Constants.Log.App.TimeSystemCalls,"[RecentsTaskLoader|getAllTaskTopThumbnail]","" + (System.currentTimeMillis() - t1) + "ms");
  }
  stack.createAffiliatedGroupings();
  mLoader.start(context);
  for (  Task t : tasksToLoad) {
    mLoadQueue.addTask(t);
  }
  mPackageMonitor.setTasks(tasks);
  return root;
}
