{
  RecentsConfiguration config=RecentsConfiguration.getInstance();
  List<ActivityManager.RecentTaskInfo> tasks=getRecentTasks(ssp,numTasks);
  ArrayList<Task> tasksToAdd=new ArrayList<Task>();
  TaskStack stack=new TaskStack();
  int taskCount=tasks.size();
  for (int i=0; i < taskCount; i++) {
    ActivityManager.RecentTaskInfo t=tasks.get(i);
    ActivityManager.TaskDescription av=t.taskDescription;
    BitmapDrawable icon=null;
    if (av.getIcon() != null) {
      icon=new BitmapDrawable(resources,av.getIcon());
    }
    Task.TaskKey taskKey=new Task.TaskKey(t.persistentId,t.baseIntent,t.userId,t.firstActiveTime,t.lastActiveTime);
    tasksToAdd.add(new Task(taskKey,true,t.affiliatedTaskId,t.affiliatedTaskColor,av.getLabel(),icon,av.getPrimaryColor(),(i == (taskCount - 1)),config.lockToAppEnabled));
  }
  stack.setTasks(tasksToAdd);
  stack.createAffiliatedGroupings(config);
  return stack;
}
