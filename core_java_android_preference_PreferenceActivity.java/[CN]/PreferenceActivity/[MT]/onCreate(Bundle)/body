{
  super.onCreate(savedInstanceState);
  setContentView(com.android.internal.R.layout.preference_list_content);
  mPrefsContainer=findViewById(com.android.internal.R.id.prefs);
  boolean hidingHeaders=onIsHidingHeaders();
  mSinglePane=hidingHeaders || !onIsMultiPane();
  String initialFragment=getIntent().getStringExtra(EXTRA_SHOW_FRAGMENT);
  Bundle initialArguments=getIntent().getBundleExtra(EXTRA_SHOW_FRAGMENT_ARGUMENTS);
  if (initialFragment != null && mSinglePane) {
    getListView().setVisibility(View.GONE);
    mPrefsContainer.setVisibility(View.VISIBLE);
    switchToHeader(initialFragment,initialArguments);
  }
 else {
    onBuildHeaders(mHeaders);
    if (mHeaders.size() > 0) {
      mAdapter=new HeaderAdapter(this,mHeaders);
      setListAdapter(mAdapter);
      if (!mSinglePane) {
        mPrefsContainer.setVisibility(View.VISIBLE);
        if (initialFragment == null) {
          Header h=onGetInitialHeader();
          initialFragment=h.fragment;
          initialArguments=h.fragmentArguments;
        }
        switchToHeader(initialFragment,initialArguments);
      }
    }
 else {
      mPreferenceManager=new PreferenceManager(this,FIRST_REQUEST_CODE);
      mPreferenceManager.setOnPreferenceTreeClickListener(this);
    }
  }
  getListView().setScrollBarStyle(View.SCROLLBARS_INSIDE_OVERLAY);
  Intent intent=getIntent();
  if (intent.getBooleanExtra(EXTRA_PREFS_SHOW_BUTTON_BAR,false)) {
    findViewById(com.android.internal.R.id.button_bar).setVisibility(View.VISIBLE);
    Button backButton=(Button)findViewById(com.android.internal.R.id.back_button);
    backButton.setOnClickListener(new OnClickListener(){
      public void onClick(      View v){
        setResult(RESULT_CANCELED);
        finish();
      }
    }
);
    Button skipButton=(Button)findViewById(com.android.internal.R.id.skip_button);
    skipButton.setOnClickListener(new OnClickListener(){
      public void onClick(      View v){
        setResult(RESULT_OK);
        finish();
      }
    }
);
    mNextButton=(Button)findViewById(com.android.internal.R.id.next_button);
    mNextButton.setOnClickListener(new OnClickListener(){
      public void onClick(      View v){
        setResult(RESULT_OK);
        finish();
      }
    }
);
    if (intent.hasExtra(EXTRA_PREFS_SET_NEXT_TEXT)) {
      String buttonText=intent.getStringExtra(EXTRA_PREFS_SET_NEXT_TEXT);
      if (TextUtils.isEmpty(buttonText)) {
        mNextButton.setVisibility(View.GONE);
      }
 else {
        mNextButton.setText(buttonText);
      }
    }
    if (intent.hasExtra(EXTRA_PREFS_SET_BACK_TEXT)) {
      String buttonText=intent.getStringExtra(EXTRA_PREFS_SET_BACK_TEXT);
      if (TextUtils.isEmpty(buttonText)) {
        backButton.setVisibility(View.GONE);
      }
 else {
        backButton.setText(buttonText);
      }
    }
    if (intent.getBooleanExtra(EXTRA_PREFS_SHOW_SKIP,false)) {
      skipButton.setVisibility(View.VISIBLE);
    }
  }
}
