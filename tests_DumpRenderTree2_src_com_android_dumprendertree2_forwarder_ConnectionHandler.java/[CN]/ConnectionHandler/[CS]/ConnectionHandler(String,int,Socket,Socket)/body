{
  mRemoteMachineIpAddress=remoteMachineIp;
  mPort=port;
  mFromSocket=fromSocket;
  mToSocket=toSocket;
  try {
    mFromSocketInputStream=mFromSocket.getInputStream();
    mToSocketInputStream=mToSocket.getInputStream();
    mFromSocketOutputStream=mFromSocket.getOutputStream();
    mToSocketOutputStream=mToSocket.getOutputStream();
    if (!AdbUtils.configureConnection(mToSocketInputStream,mToSocketOutputStream,mRemoteMachineIpAddress,mPort)) {
      throw new IOException("Configuring socket failed!");
    }
  }
 catch (  IOException e) {
    Log.e(LOG_TAG,"Unable to start ConnectionHandler",e);
    closeStreams();
    return;
  }
  mFromToPipe=new SocketPipeThread(mFromSocketInputStream,mToSocketOutputStream);
  mToFromPipe=new SocketPipeThread(mToSocketInputStream,mFromSocketOutputStream);
}
