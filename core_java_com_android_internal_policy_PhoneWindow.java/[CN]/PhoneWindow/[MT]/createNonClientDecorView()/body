{
  boolean needsDecor=true;
  NonClientDecorView nonClientDecorView=null;
  final WindowManager.LayoutParams attrs=getAttributes();
  boolean isFullscreen=0 != ((mDecor.getWindowSystemUiVisibility() | mDecor.getSystemUiVisibility()) & (View.SYSTEM_UI_FLAG_FULLSCREEN | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION));
  boolean isApplication=attrs.type != TYPE_BASE_APPLICATION && attrs.type != TYPE_APPLICATION;
  if (isFloating() || isFullscreen || isApplication) {
    needsDecor=false;
  }
  if (needsDecor) {
    boolean windowHasShadow=true;
    TypedValue value=new TypedValue();
    getContext().getTheme().resolveAttribute(R.attr.colorPrimary,value,true);
    if (Color.brightness(value.data) < 0.5) {
      nonClientDecorView=(NonClientDecorView)mLayoutInflater.inflate(R.layout.non_client_decor_dark,null);
    }
 else {
      nonClientDecorView=(NonClientDecorView)mLayoutInflater.inflate(R.layout.non_client_decor_light,null);
    }
    nonClientDecorView.setPhoneWindow(this,windowHasShadow);
  }
  mDecor.enableNonClientDecor(needsDecor);
  return nonClientDecorView;
}
