{
  NonClientDecorView nonClientDecorView=null;
  for (int i=mDecor.getChildCount() - 1; i >= 0 && nonClientDecorView == null; i--) {
    View view=mDecor.getChildAt(i);
    if (view instanceof NonClientDecorView) {
      nonClientDecorView=(NonClientDecorView)view;
      mDecor.removeViewAt(i);
    }
  }
  final WindowManager.LayoutParams attrs=getAttributes();
  boolean isApplication=attrs.type == TYPE_BASE_APPLICATION || attrs.type == TYPE_APPLICATION;
  mWorkspaceId=getWorkspaceId();
  if (!isFloating() && isApplication && mWorkspaceId != HOME_STACK_ID && mWorkspaceId < FIRST_DYNAMIC_STACK_ID) {
    if (nonClientDecorView == null) {
      Context context=mDecor.getContext();
      TypedValue value=new TypedValue();
      context.getTheme().resolveAttribute(R.attr.colorPrimary,value,true);
      LayoutInflater inflater=mLayoutInflater.from(context);
      if (Color.luminance(value.data) < 0.5) {
        nonClientDecorView=(NonClientDecorView)inflater.inflate(R.layout.non_client_decor_dark,null);
      }
 else {
        nonClientDecorView=(NonClientDecorView)inflater.inflate(R.layout.non_client_decor_light,null);
      }
    }
    nonClientDecorView.setPhoneWindow(this,hasNonClientDecor(mWorkspaceId),nonClientDecorHasShadow(mWorkspaceId));
  }
  mDecor.enableNonClientDecor(nonClientDecorView != null && hasNonClientDecor(mWorkspaceId));
  return nonClientDecorView;
}
