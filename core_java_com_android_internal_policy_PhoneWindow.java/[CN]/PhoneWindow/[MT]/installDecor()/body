{
  mForceDecorInstall=false;
  if (mDecor == null) {
    mDecor=generateDecor(-1);
    mDecor.setWindow(this);
    mDecor.setDescendantFocusability(ViewGroup.FOCUS_AFTER_DESCENDANTS);
    mDecor.setIsRootNamespace(true);
    if (!mInvalidatePanelMenuPosted && mInvalidatePanelMenuFeatures != 0) {
      mDecor.postOnAnimation(mInvalidatePanelMenuRunnable);
    }
  }
 else {
    mDecor.setWindow(this);
  }
  if (mContentParent == null) {
    mContentParent=generateLayout(mDecor);
    mDecor.makeOptionalFitsSystemWindows();
    final DecorContentParent decorContentParent=(DecorContentParent)mDecor.findViewById(R.id.decor_content_parent);
    if (decorContentParent != null) {
      mDecorContentParent=decorContentParent;
      mDecorContentParent.setWindowCallback(getCallback());
      if (mDecorContentParent.getTitle() == null) {
        mDecorContentParent.setWindowTitle(mTitle);
      }
      final int localFeatures=getLocalFeatures();
      for (int i=0; i < FEATURE_MAX; i++) {
        if ((localFeatures & (1 << i)) != 0) {
          mDecorContentParent.initFeature(i);
        }
      }
      mDecorContentParent.setUiOptions(mUiOptions);
      if ((mResourcesSetFlags & FLAG_RESOURCE_SET_ICON) != 0 || (mIconRes != 0 && !mDecorContentParent.hasIcon())) {
        mDecorContentParent.setIcon(mIconRes);
      }
 else       if ((mResourcesSetFlags & FLAG_RESOURCE_SET_ICON) == 0 && mIconRes == 0 && !mDecorContentParent.hasIcon()) {
        mDecorContentParent.setIcon(getContext().getPackageManager().getDefaultActivityIcon());
        mResourcesSetFlags|=FLAG_RESOURCE_SET_ICON_FALLBACK;
      }
      if ((mResourcesSetFlags & FLAG_RESOURCE_SET_LOGO) != 0 || (mLogoRes != 0 && !mDecorContentParent.hasLogo())) {
        mDecorContentParent.setLogo(mLogoRes);
      }
      PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,false);
      if (!isDestroyed() && (st == null || st.menu == null) && !mIsStartingWindow) {
        invalidatePanelMenu(FEATURE_ACTION_BAR);
      }
    }
 else {
      mTitleView=(TextView)findViewById(R.id.title);
      if (mTitleView != null) {
        mTitleView.setLayoutDirection(mDecor.getLayoutDirection());
        if ((getLocalFeatures() & (1 << FEATURE_NO_TITLE)) != 0) {
          View titleContainer=findViewById(R.id.title_container);
          if (titleContainer != null) {
            titleContainer.setVisibility(View.GONE);
          }
 else {
            mTitleView.setVisibility(View.GONE);
          }
          if (mContentParent instanceof FrameLayout) {
            ((FrameLayout)mContentParent).setForeground(null);
          }
        }
 else {
          mTitleView.setText(mTitle);
        }
      }
    }
    if (mDecor.getBackground() == null && mBackgroundFallbackResource != 0) {
      mDecor.setBackgroundFallback(mBackgroundFallbackResource);
    }
    if (hasFeature(FEATURE_ACTIVITY_TRANSITIONS)) {
      if (mTransitionManager == null) {
        final int transitionRes=getWindowStyle().getResourceId(R.styleable.Window_windowContentTransitionManager,0);
        if (transitionRes != 0) {
          final TransitionInflater inflater=TransitionInflater.from(getContext());
          mTransitionManager=inflater.inflateTransitionManager(transitionRes,mContentParent);
        }
 else {
          mTransitionManager=new TransitionManager();
        }
      }
      mEnterTransition=getTransition(mEnterTransition,null,R.styleable.Window_windowEnterTransition);
      mReturnTransition=getTransition(mReturnTransition,USE_DEFAULT_TRANSITION,R.styleable.Window_windowReturnTransition);
      mExitTransition=getTransition(mExitTransition,null,R.styleable.Window_windowExitTransition);
      mReenterTransition=getTransition(mReenterTransition,USE_DEFAULT_TRANSITION,R.styleable.Window_windowReenterTransition);
      mSharedElementEnterTransition=getTransition(mSharedElementEnterTransition,null,R.styleable.Window_windowSharedElementEnterTransition);
      mSharedElementReturnTransition=getTransition(mSharedElementReturnTransition,USE_DEFAULT_TRANSITION,R.styleable.Window_windowSharedElementReturnTransition);
      mSharedElementExitTransition=getTransition(mSharedElementExitTransition,null,R.styleable.Window_windowSharedElementExitTransition);
      mSharedElementReenterTransition=getTransition(mSharedElementReenterTransition,USE_DEFAULT_TRANSITION,R.styleable.Window_windowSharedElementReenterTransition);
      if (mAllowEnterTransitionOverlap == null) {
        mAllowEnterTransitionOverlap=getWindowStyle().getBoolean(R.styleable.Window_windowAllowEnterTransitionOverlap,true);
      }
      if (mAllowReturnTransitionOverlap == null) {
        mAllowReturnTransitionOverlap=getWindowStyle().getBoolean(R.styleable.Window_windowAllowReturnTransitionOverlap,true);
      }
      if (mBackgroundFadeDurationMillis < 0) {
        mBackgroundFadeDurationMillis=getWindowStyle().getInteger(R.styleable.Window_windowTransitionBackgroundFadeDuration,DEFAULT_BACKGROUND_FADE_DURATION_MS);
      }
      if (mSharedElementsUseOverlay == null) {
        mSharedElementsUseOverlay=getWindowStyle().getBoolean(R.styleable.Window_windowSharedElementsUseOverlay,true);
      }
    }
  }
}
