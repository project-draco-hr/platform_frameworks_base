{
  final long origId=Binder.clearCallingIdentity();
  if (stopProfiling) {
synchronized (this) {
      ActivityStack stack=ActivityRecord.getStackLocked(token);
      if (stack != null) {
        ActivityRecord r=stack.activityIdleInternal(token,false,config);
        if ((mProfileProc == r.app) && (mProfileFd != null)) {
          try {
            mProfileFd.close();
          }
 catch (          IOException e) {
          }
          clearProfilerLocked();
        }
      }
    }
  }
  Binder.restoreCallingIdentity(origId);
}
