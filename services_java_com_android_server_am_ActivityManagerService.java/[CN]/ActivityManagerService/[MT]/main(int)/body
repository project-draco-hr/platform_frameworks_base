{
  AThread thr=new AThread();
  thr.start();
synchronized (thr) {
    while (thr.mService == null) {
      try {
        thr.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  ActivityManagerService m=thr.mService;
  mSelf=m;
  ActivityThread at=ActivityThread.systemMain();
  mSystemThread=at;
  Context context=at.getSystemContext();
  context.setTheme(android.R.style.Theme_Holo);
  m.mContext=context;
  m.mFactoryTest=factoryTest;
  m.mIntentFirewall=new IntentFirewall(m.new IntentFirewallInterface());
  m.mStackSupervisor=new ActivityStackSupervisor(m,context,thr.mLooper);
  m.mStackSupervisor.init(m.mCurrentUserId);
  m.mBatteryStatsService.publish(context);
  m.mUsageStatsService.publish(context);
  m.mAppOpsService.publish(context);
synchronized (thr) {
    thr.mReady=true;
    thr.notifyAll();
  }
  m.startRunning(null,null,null,null);
  return context;
}
