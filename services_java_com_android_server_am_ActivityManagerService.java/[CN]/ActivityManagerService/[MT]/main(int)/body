{
  AThread thr=new AThread();
  thr.start();
synchronized (thr) {
    while (thr.mService == null) {
      try {
        thr.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  ActivityManagerService m=thr.mService;
  mSelf=m;
  ActivityThread at=ActivityThread.systemMain();
  mSystemThread=at;
  Context context=at.getSystemContext();
  m.mContext=context;
  m.mFactoryTest=factoryTest;
  PowerManager pm=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  m.mGoingToSleep=pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"ActivityManager-Sleep");
  m.mLaunchingActivity=pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"ActivityManager-Launch");
  m.mLaunchingActivity.setReferenceCounted(false);
  m.mBatteryStatsService.publish(context);
synchronized (thr) {
    thr.mReady=true;
    thr.notifyAll();
  }
  m.startRunning(null,null,null,null);
  return context;
}
