{
  ComponentName cls=intent.getComponent();
  if (info.targetActivity != null) {
    cls=new ComponentName(info.packageName,info.targetActivity);
  }
  TaskRecord cp=null;
  final int N=mHistory.size();
  for (int i=(N - 1); i >= 0; i--) {
    HistoryRecord r=(HistoryRecord)mHistory.get(i);
    if (!r.finishing && r.task != cp && r.launchMode != ActivityInfo.LAUNCH_SINGLE_INSTANCE) {
      cp=r.task;
      if (r.task.affinity != null) {
        if (r.task.affinity.equals(info.taskAffinity)) {
          return r;
        }
      }
 else       if (r.task.intent != null && r.task.intent.getComponent().equals(cls)) {
        return r;
      }
 else       if (r.task.affinityIntent != null && r.task.affinityIntent.getComponent().equals(cls)) {
        return r;
      }
    }
  }
  return null;
}
