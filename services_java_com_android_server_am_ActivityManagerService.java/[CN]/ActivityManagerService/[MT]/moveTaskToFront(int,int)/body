{
  enforceCallingPermission(android.Manifest.permission.REORDER_TASKS,"moveTaskToFront()");
synchronized (this) {
    if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),"Task to front")) {
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    try {
      TaskRecord tr=taskForIdLocked(task);
      if (tr != null) {
        if ((flags & ActivityManager.MOVE_TASK_NO_USER_ACTION) == 0) {
          mMainStack.mUserLeaving=true;
        }
        if ((flags & ActivityManager.MOVE_TASK_WITH_HOME) != 0) {
          mMainStack.moveHomeToFrontLocked();
        }
        mMainStack.moveTaskToFrontLocked(tr,null);
        return;
      }
      for (int i=mMainStack.mHistory.size() - 1; i >= 0; i--) {
        ActivityRecord hr=(ActivityRecord)mMainStack.mHistory.get(i);
        if (hr.task.taskId == task) {
          if ((flags & ActivityManager.MOVE_TASK_NO_USER_ACTION) == 0) {
            mMainStack.mUserLeaving=true;
          }
          if ((flags & ActivityManager.MOVE_TASK_WITH_HOME) != 0) {
            mMainStack.moveHomeToFrontLocked();
          }
          mMainStack.moveTaskToFrontLocked(hr.task,null);
          return;
        }
      }
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
  }
}
