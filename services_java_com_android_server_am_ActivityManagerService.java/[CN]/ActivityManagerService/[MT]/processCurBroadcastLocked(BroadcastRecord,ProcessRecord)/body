{
  if (app.thread == null) {
    throw new RemoteException();
  }
  r.receiver=app.thread.asBinder();
  r.curApp=app;
  app.curReceiver=r;
  updateLRUListLocked(app,true);
  r.intent.setComponent(r.curComponent);
  boolean started=false;
  try {
    if (DEBUG_BROADCAST)     Log.v(TAG,"Delivering to component " + r.curComponent + ": "+ r);
    app.thread.scheduleReceiver(new Intent(r.intent),r.curReceiver,r.resultCode,r.resultData,r.resultExtras,r.ordered);
    started=true;
  }
  finally {
    if (!started) {
      r.receiver=null;
      r.curApp=null;
      app.curReceiver=null;
    }
  }
}
