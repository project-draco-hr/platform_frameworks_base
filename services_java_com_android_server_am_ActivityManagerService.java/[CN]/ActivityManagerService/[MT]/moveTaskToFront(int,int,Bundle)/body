{
  enforceCallingPermission(android.Manifest.permission.REORDER_TASKS,"moveTaskToFront()");
synchronized (this) {
    if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),"Task to front")) {
      ActivityOptions.abort(options);
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    try {
      TaskRecord tr=recentTaskForIdLocked(task);
      if (tr != null) {
        ActivityStack stack=tr.stack;
        if ((flags & ActivityManager.MOVE_TASK_NO_USER_ACTION) == 0) {
          stack.mUserLeaving=true;
        }
        if ((flags & ActivityManager.MOVE_TASK_WITH_HOME) != 0) {
          stack.moveHomeToFrontLocked();
        }
        stack.moveTaskToFrontLocked(tr,null,options);
        return;
      }
      for (int stackNdx=mStacks.size() - 1; stackNdx >= 0; --stackNdx) {
        if (mStacks.get(stackNdx).findTaskToMoveToFrontLocked(task,flags,options)) {
          return;
        }
      }
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
    ActivityOptions.abort(options);
  }
}
