{
  enforceCallingPermission(android.Manifest.permission.REORDER_TASKS,"moveTaskToFront()");
synchronized (this) {
    if (!checkAppSwitchAllowedLocked(Binder.getCallingPid(),Binder.getCallingUid(),"Task to front")) {
      ActivityOptions.abort(options);
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    try {
      TaskRecord tr=taskForIdLocked(task);
      if (tr != null) {
        if ((flags & ActivityManager.MOVE_TASK_NO_USER_ACTION) == 0) {
          mMainStack.mUserLeaving=true;
        }
        if ((flags & ActivityManager.MOVE_TASK_WITH_HOME) != 0) {
          mMainStack.moveHomeToFrontLocked();
        }
        mMainStack.moveTaskToFrontLocked(tr,null,options);
        return;
      }
      if (mMainStack.findTaskToMoveToFrontLocked(task,flags,options)) {
        return;
      }
    }
  finally {
      Binder.restoreCallingIdentity(origId);
    }
    ActivityOptions.abort(options);
  }
}
