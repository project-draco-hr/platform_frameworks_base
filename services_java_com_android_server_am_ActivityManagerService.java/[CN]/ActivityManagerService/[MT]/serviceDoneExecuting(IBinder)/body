{
synchronized (this) {
    if (!(token instanceof ServiceRecord)) {
      throw new IllegalArgumentException("Invalid service token");
    }
    ServiceRecord r=(ServiceRecord)token;
    boolean inStopping=mStoppingServices.contains(token);
    if (r != null) {
      if (DEBUG_SERVICE)       Log.v(TAG,"DONE EXECUTING SERVICE " + r.name + ": nesting="+ r.executeNesting+ ", inStopping="+ inStopping);
      if (r != token) {
        Log.w(TAG,"Done executing service " + r.name + " with incorrect token: given "+ token+ ", expected "+ r);
        return;
      }
      final long origId=Binder.clearCallingIdentity();
      serviceDoneExecutingLocked(r,inStopping);
      Binder.restoreCallingIdentity(origId);
    }
 else {
      Log.w(TAG,"Done executing unknown service " + r.name + " with token "+ token);
    }
  }
}
