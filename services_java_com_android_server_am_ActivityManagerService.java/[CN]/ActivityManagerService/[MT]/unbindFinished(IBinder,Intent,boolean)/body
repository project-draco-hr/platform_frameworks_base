{
  if (intent != null && intent.hasFileDescriptors() == true) {
    throw new IllegalArgumentException("File descriptors passed in Intent");
  }
synchronized (this) {
    if (!(token instanceof ServiceRecord)) {
      throw new IllegalArgumentException("Invalid service token");
    }
    ServiceRecord r=(ServiceRecord)token;
    final long origId=Binder.clearCallingIdentity();
    if (r != null) {
      Intent.FilterComparison filter=new Intent.FilterComparison(intent);
      IntentBindRecord b=r.bindings.get(filter);
      if (DEBUG_SERVICE)       Slog.v(TAG,"unbindFinished in " + r + " at "+ b+ ": apps="+ (b != null ? b.apps.size() : 0));
      boolean inStopping=mStoppingServices.contains(r);
      if (b != null) {
        if (b.apps.size() > 0 && !inStopping) {
          requestServiceBindingLocked(r,b,true);
        }
 else {
          b.doRebind=true;
        }
      }
      serviceDoneExecutingLocked(r,inStopping);
      Binder.restoreCallingIdentity(origId);
    }
  }
}
