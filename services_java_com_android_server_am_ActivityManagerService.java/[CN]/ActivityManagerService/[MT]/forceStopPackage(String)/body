{
  if (checkCallingPermission(android.Manifest.permission.FORCE_STOP_PACKAGES) != PackageManager.PERMISSION_GRANTED) {
    String msg="Permission Denial: forceStopPackage() from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " requires "+ android.Manifest.permission.FORCE_STOP_PACKAGES;
    Slog.w(TAG,msg);
    throw new SecurityException(msg);
  }
  final int userId=UserId.getCallingUserId();
  long callingId=Binder.clearCallingIdentity();
  try {
    IPackageManager pm=AppGlobals.getPackageManager();
    int pkgUid=-1;
synchronized (this) {
      try {
        pkgUid=pm.getPackageUid(packageName,userId);
      }
 catch (      RemoteException e) {
      }
      if (pkgUid == -1) {
        Slog.w(TAG,"Invalid packageName: " + packageName);
        return;
      }
      forceStopPackageLocked(packageName,pkgUid);
      try {
        pm.setPackageStoppedState(packageName,true,userId);
      }
 catch (      RemoteException e) {
      }
catch (      IllegalArgumentException e) {
        Slog.w(TAG,"Failed trying to unstop package " + packageName + ": "+ e);
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingId);
  }
}
