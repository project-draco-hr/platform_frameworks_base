{
  String proc=customProcess != null ? customProcess : info.processName;
  BatteryStatsImpl.Uid.Proc ps=null;
  BatteryStatsImpl stats=mBatteryStatsService.getActiveStatistics();
  int uid=info.uid;
  if (isolated) {
    int userId=UserHandle.getUserId(uid);
    int stepsLeft=Process.LAST_ISOLATED_UID - Process.FIRST_ISOLATED_UID + 1;
    uid=0;
    while (true) {
      if (mNextIsolatedProcessUid < Process.FIRST_ISOLATED_UID || mNextIsolatedProcessUid > Process.LAST_ISOLATED_UID) {
        mNextIsolatedProcessUid=Process.FIRST_ISOLATED_UID;
      }
      uid=UserHandle.getUid(userId,mNextIsolatedProcessUid);
      mNextIsolatedProcessUid++;
      if (mIsolatedProcesses.indexOfKey(uid) < 0) {
        break;
      }
      stepsLeft--;
      if (stepsLeft <= 0) {
        return null;
      }
    }
  }
synchronized (stats) {
    ps=stats.getProcessStatsLocked(info.uid,proc);
  }
  return new ProcessRecord(ps,thread,info,proc,uid);
}
