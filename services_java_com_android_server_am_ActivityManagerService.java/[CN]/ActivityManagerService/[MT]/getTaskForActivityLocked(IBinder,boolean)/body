{
  final int N=mHistory.size();
  TaskRecord lastTask=null;
  for (int i=0; i < N; i++) {
    HistoryRecord r=(HistoryRecord)mHistory.get(i);
    if (r == token) {
      if (!onlyRoot || lastTask != r.task) {
        return r.task.taskId;
      }
      return -1;
    }
    lastTask=r.task;
  }
  return -1;
}
