{
  int uid=Binder.getCallingUid();
  int pid=Binder.getCallingPid();
  long callingId=Binder.clearCallingIdentity();
  try {
    IPackageManager pm=ActivityThread.getPackageManager();
    int pkgUid=-1;
synchronized (this) {
      try {
        pkgUid=pm.getPackageUid(packageName);
      }
 catch (      RemoteException e) {
      }
      if (pkgUid == -1) {
        Log.w(TAG,"Invalid packageName:" + packageName);
        return false;
      }
      if (uid == pkgUid || checkComponentPermission(android.Manifest.permission.CLEAR_APP_USER_DATA,pid,uid,-1) == PackageManager.PERMISSION_GRANTED) {
        restartPackageLocked(packageName,pkgUid);
      }
 else {
        throw new SecurityException(pid + " does not have permission:" + android.Manifest.permission.CLEAR_APP_USER_DATA+ " to clear data"+ "for process:"+ packageName);
      }
    }
    try {
      pm.clearApplicationUserData(packageName,observer);
      Intent intent=new Intent(Intent.ACTION_PACKAGE_DATA_CLEARED,Uri.fromParts("package",packageName,null));
      intent.putExtra(Intent.EXTRA_UID,pkgUid);
      broadcastIntentLocked(null,null,intent,null,null,0,null,null,null,false,false,MY_PID,Process.SYSTEM_UID);
    }
 catch (    RemoteException e) {
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingId);
  }
  return true;
}
