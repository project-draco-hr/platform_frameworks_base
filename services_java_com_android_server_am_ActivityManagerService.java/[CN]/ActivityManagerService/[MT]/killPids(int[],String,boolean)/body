{
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("killPids only available to the system");
  }
  String reason=(pReason == null) ? "Unknown" : pReason;
  boolean killed=false;
synchronized (mPidsSelfLocked) {
    int[] types=new int[pids.length];
    int worstType=0;
    for (int i=0; i < pids.length; i++) {
      ProcessRecord proc=mPidsSelfLocked.get(pids[i]);
      if (proc != null) {
        int type=proc.setAdj;
        types[i]=type;
        if (type > worstType) {
          worstType=type;
        }
      }
    }
    if (worstType < ProcessList.HIDDEN_APP_MAX_ADJ && worstType > ProcessList.HIDDEN_APP_MIN_ADJ) {
      worstType=ProcessList.HIDDEN_APP_MIN_ADJ;
    }
    if (!secure && worstType < ProcessList.SERVICE_ADJ) {
      worstType=ProcessList.SERVICE_ADJ;
    }
    Slog.w(TAG,"Killing processes " + reason + " at adjustment "+ worstType);
    for (int i=0; i < pids.length; i++) {
      ProcessRecord proc=mPidsSelfLocked.get(pids[i]);
      if (proc == null) {
        continue;
      }
      int adj=proc.setAdj;
      if (adj >= worstType && !proc.killedBackground) {
        Slog.w(TAG,"Killing " + proc + " (adj "+ adj+ "): "+ reason);
        EventLog.writeEvent(EventLogTags.AM_KILL,proc.pid,proc.processName,adj,reason);
        killed=true;
        proc.killedBackground=true;
        Process.killProcessQuiet(pids[i]);
      }
    }
  }
  return killed;
}
