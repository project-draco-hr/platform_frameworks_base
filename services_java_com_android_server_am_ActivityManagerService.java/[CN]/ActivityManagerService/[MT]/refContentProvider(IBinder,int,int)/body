{
  ContentProviderConnection conn;
  try {
    conn=(ContentProviderConnection)connection;
  }
 catch (  ClassCastException e) {
    String msg="refContentProvider: " + connection + " not a ContentProviderConnection";
    Slog.w(TAG,msg);
    throw new IllegalArgumentException(msg);
  }
  if (conn == null) {
    throw new NullPointerException("connection is null");
  }
synchronized (this) {
    if (stable > 0) {
      conn.numStableIncs+=stable;
    }
    stable=conn.stableCount + stable;
    if (stable < 0) {
      throw new IllegalStateException("stableCount < 0: " + stable);
    }
    if (unstable > 0) {
      conn.numUnstableIncs+=unstable;
    }
    unstable=conn.unstableCount + unstable;
    if (unstable < 0) {
      throw new IllegalStateException("unstableCount < 0: " + unstable);
    }
    if ((stable + unstable) <= 0) {
      throw new IllegalStateException("ref counts can't go to zero here: stable=" + stable + " unstable="+ unstable);
    }
    conn.stableCount=stable;
    conn.unstableCount=unstable;
    return !conn.dead;
  }
}
