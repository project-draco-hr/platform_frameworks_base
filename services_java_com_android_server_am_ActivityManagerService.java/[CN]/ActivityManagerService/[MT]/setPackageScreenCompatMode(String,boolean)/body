{
synchronized (this) {
    ApplicationInfo ai=null;
    try {
      ai=AppGlobals.getPackageManager().getApplicationInfo(packageName,STOCK_PM_FLAGS);
    }
 catch (    RemoteException e) {
    }
    if (ai == null) {
      Slog.w(TAG,"setPackageScreenCompatMode failed: unknown package " + packageName);
      return;
    }
    boolean changed=false;
    if (compatEnabled) {
      if (!mScreenCompatPackages.contains(packageName)) {
        changed=true;
        mScreenCompatPackages.add(packageName);
      }
    }
 else {
      if (mScreenCompatPackages.contains(packageName)) {
        changed=true;
        mScreenCompatPackages.remove(packageName);
      }
    }
    if (changed) {
      CompatibilityInfo ci=compatibilityInfoForPackageLocked(ai);
      for (int i=mLruProcesses.size() - 1; i >= 0; i--) {
        ProcessRecord app=mLruProcesses.get(i);
        if (!app.pkgList.contains(packageName)) {
          continue;
        }
        try {
          if (app.thread != null) {
            if (DEBUG_CONFIGURATION)             Slog.v(TAG,"Sending to proc " + app.processName + " new compat "+ ci);
            app.thread.updatePackageCompatibilityInfo(packageName,ci);
          }
        }
 catch (        Exception e) {
        }
      }
      for (int i=mMainStack.mHistory.size() - 1; i >= 0; i--) {
        ActivityRecord a=(ActivityRecord)mMainStack.mHistory.get(i);
        if (a.info.packageName.equals(packageName)) {
          a.forceNewConfig=true;
        }
      }
      ActivityRecord starting=mMainStack.topRunningActivityLocked(null);
      if (starting != null) {
        mMainStack.ensureActivityConfigurationLocked(starting,0);
        mMainStack.ensureActivitiesVisibleLocked(starting,0);
      }
    }
  }
}
