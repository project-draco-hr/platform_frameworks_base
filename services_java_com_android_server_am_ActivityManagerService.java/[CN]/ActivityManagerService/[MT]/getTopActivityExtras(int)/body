{
  enforceCallingPermission(android.Manifest.permission.GET_TOP_ACTIVITY_INFO,"getTopActivityExtras()");
  PendingActivityExtras pae;
  Bundle extras=new Bundle();
synchronized (this) {
    ActivityRecord activity=mMainStack.mResumedActivity;
    if (activity == null) {
      Slog.w(TAG,"getTopActivityExtras failed: no resumed activity");
      return null;
    }
    extras.putString(Intent.EXTRA_ASSIST_PACKAGE,activity.packageName);
    if (activity.app == null || activity.app.thread == null) {
      Slog.w(TAG,"getTopActivityExtras failed: no process for " + activity);
      return extras;
    }
    if (activity.app.pid == Binder.getCallingPid()) {
      Slog.w(TAG,"getTopActivityExtras failed: request process same as " + activity);
      return extras;
    }
    pae=new PendingActivityExtras(activity);
    try {
      activity.app.thread.requestActivityExtras(activity.appToken,pae,requestType);
      mPendingActivityExtras.add(pae);
      mHandler.postDelayed(pae,PENDING_ACTIVITY_RESULT_TIMEOUT);
    }
 catch (    RemoteException e) {
      Slog.w(TAG,"getTopActivityExtras failed: crash calling " + activity);
      return extras;
    }
  }
synchronized (pae) {
    while (!pae.haveResult) {
      try {
        pae.wait();
      }
 catch (      InterruptedException e) {
      }
    }
    if (pae.result != null) {
      extras.putBundle(Intent.EXTRA_ASSIST_CONTEXT,pae.result);
    }
  }
synchronized (this) {
    mPendingActivityExtras.remove(pae);
    mHandler.removeCallbacks(pae);
  }
  return extras;
}
