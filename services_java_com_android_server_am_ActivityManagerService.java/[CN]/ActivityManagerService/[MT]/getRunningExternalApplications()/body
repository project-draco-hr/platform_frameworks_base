{
  enforceNotIsolatedCaller("getRunningExternalApplications");
  List<ActivityManager.RunningAppProcessInfo> runningApps=getRunningAppProcesses();
  List<ApplicationInfo> retList=new ArrayList<ApplicationInfo>();
  if (runningApps != null && runningApps.size() > 0) {
    Set<String> extList=new HashSet<String>();
    for (    ActivityManager.RunningAppProcessInfo app : runningApps) {
      if (app.pkgList != null) {
        for (        String pkg : app.pkgList) {
          extList.add(pkg);
        }
      }
    }
    IPackageManager pm=AppGlobals.getPackageManager();
    for (    String pkg : extList) {
      try {
        ApplicationInfo info=pm.getApplicationInfo(pkg,0,UserHandle.getCallingUserId());
        if ((info.flags & ApplicationInfo.FLAG_EXTERNAL_STORAGE) != 0) {
          retList.add(info);
        }
      }
 catch (      RemoteException e) {
      }
    }
  }
  return retList;
}
