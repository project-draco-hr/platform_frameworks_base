{
  if (checkCallingPermission(android.Manifest.permission.SHUTDOWN) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires permission " + android.Manifest.permission.SHUTDOWN);
  }
  boolean timedout=false;
synchronized (this) {
    mShuttingDown=true;
    updateEventDispatchingLocked();
    timedout=mStackSupervisor.shutdownLocked(timeout);
  }
  mAppOpsService.shutdown();
  mUsageStatsService.shutdown();
  mBatteryStatsService.shutdown();
synchronized (this) {
    mProcessStats.shutdownLocked();
  }
  return timedout;
}
