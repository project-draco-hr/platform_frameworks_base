{
  mProcDeaths[0]++;
  BatteryStatsImpl stats=mBatteryStatsService.getActiveStatistics();
synchronized (stats) {
    stats.noteProcessDiedLocked(app.info.uid,pid);
  }
  if (app.pid == pid && app.thread != null && app.thread.asBinder() == thread.asBinder()) {
    if (!app.killedBackground) {
      Slog.i(TAG,"Process " + app.processName + " (pid "+ pid+ ") has died.");
    }
    EventLog.writeEvent(EventLogTags.AM_PROC_DIED,app.userId,app.pid,app.processName);
    if (localLOGV)     Slog.v(TAG,"Dying app: " + app + ", pid: "+ pid+ ", thread: "+ thread.asBinder());
    boolean doLowMem=app.instrumentationClass == null;
    handleAppDiedLocked(app,false,true);
    if (doLowMem) {
      boolean haveBg=false;
      for (int i=mLruProcesses.size() - 1; i >= 0; i--) {
        ProcessRecord rec=mLruProcesses.get(i);
        if (rec.thread != null && rec.setAdj >= ProcessList.HIDDEN_APP_MIN_ADJ) {
          haveBg=true;
          break;
        }
      }
      if (!haveBg) {
        EventLog.writeEvent(EventLogTags.AM_LOW_MEMORY,mLruProcesses.size());
        long now=SystemClock.uptimeMillis();
        for (int i=mLruProcesses.size() - 1; i >= 0; i--) {
          ProcessRecord rec=mLruProcesses.get(i);
          if (rec != app && rec.thread != null && (rec.lastLowMemory + GC_MIN_INTERVAL) <= now) {
            if (rec.setAdj <= ProcessList.HEAVY_WEIGHT_APP_ADJ) {
              rec.lastRequestedGc=0;
            }
 else {
              rec.lastRequestedGc=rec.lastLowMemory;
            }
            rec.reportLowMemory=true;
            rec.lastLowMemory=now;
            mProcessesToGc.remove(rec);
            addProcessToGcListLocked(rec);
          }
        }
        mHandler.sendEmptyMessage(REPORT_MEM_USAGE);
        scheduleAppGcsLocked();
      }
    }
  }
 else   if (app.pid != pid) {
    Slog.i(TAG,"Process " + app.processName + " (pid "+ pid+ ") has died and restarted (pid "+ app.pid+ ").");
    EventLog.writeEvent(EventLogTags.AM_PROC_DIED,app.userId,app.pid,app.processName);
  }
 else   if (DEBUG_PROCESSES) {
    Slog.d(TAG,"Received spurious death notification for thread " + thread.asBinder());
  }
}
