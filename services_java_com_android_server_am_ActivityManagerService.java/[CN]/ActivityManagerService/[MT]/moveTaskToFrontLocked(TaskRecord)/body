{
  if (DEBUG_SWITCH)   Log.v(TAG,"moveTaskToFront: " + tr);
  final int task=tr.taskId;
  int top=mHistory.size() - 1;
  if (top < 0 || ((HistoryRecord)mHistory.get(top)).task.taskId == task) {
    return;
  }
  if (DEBUG_TRANSITION)   Log.v(TAG,"Prepare to front transition: task=" + tr);
  mWindowManager.prepareAppTransition(WindowManagerPolicy.TRANSIT_TASK_TO_FRONT);
  ArrayList moved=new ArrayList();
  top=mHistory.size() - 1;
  int pos=top;
  while (pos >= 0) {
    HistoryRecord r=(HistoryRecord)mHistory.get(pos);
    if (localLOGV)     Log.v(TAG,"At " + pos + " ckp "+ r.task+ ": "+ r);
    boolean first=true;
    if (r.task.taskId == task) {
      if (localLOGV)       Log.v(TAG,"Removing and adding at " + top);
      mHistory.remove(pos);
      mHistory.add(top,r);
      moved.add(0,r);
      top--;
      if (first) {
        addRecentTask(r.task);
        first=false;
      }
    }
    pos--;
  }
  mWindowManager.moveAppTokensToTop(moved);
  if (VALIDATE_TOKENS) {
    mWindowManager.validateAppTokens(mHistory);
  }
  finishTaskMove(task);
  EventLog.writeEvent(LOG_TASK_TO_FRONT,task);
}
