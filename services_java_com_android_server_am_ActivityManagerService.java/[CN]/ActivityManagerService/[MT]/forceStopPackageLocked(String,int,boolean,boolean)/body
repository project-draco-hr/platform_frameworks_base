{
  int i, N;
  if (uid < 0) {
    try {
      uid=ActivityThread.getPackageManager().getPackageUid(name);
    }
 catch (    RemoteException e) {
    }
  }
  Log.i(TAG,"Force stopping package " + name + " uid="+ uid);
  Iterator<SparseArray<Long>> badApps=mProcessCrashTimes.getMap().values().iterator();
  while (badApps.hasNext()) {
    SparseArray<Long> ba=badApps.next();
    if (ba.get(uid) != null) {
      badApps.remove();
    }
  }
  killPackageProcessesLocked(name,uid,-100,callerWillRestart);
  for (i=mHistory.size() - 1; i >= 0; i--) {
    HistoryRecord r=(HistoryRecord)mHistory.get(i);
    if (r.packageName.equals(name)) {
      Log.i(TAG,"  Force finishing activity " + r);
      if (r.app != null) {
        r.app.removed=true;
      }
      r.app=null;
      finishActivityLocked(r,i,Activity.RESULT_CANCELED,null,"uninstall");
    }
  }
  ArrayList<ServiceRecord> services=new ArrayList<ServiceRecord>();
  for (  ServiceRecord service : mServices.values()) {
    if (service.packageName.equals(name)) {
      Log.i(TAG,"  Force stopping service " + service);
      if (service.app != null) {
        service.app.removed=true;
      }
      service.app=null;
      services.add(service);
    }
  }
  N=services.size();
  for (i=0; i < N; i++) {
    bringDownServiceLocked(services.get(i),true);
  }
  resumeTopActivityLocked(null);
  if (purgeCache) {
    AttributeCache ac=AttributeCache.instance();
    if (ac != null) {
      ac.removePackage(name);
    }
  }
}
