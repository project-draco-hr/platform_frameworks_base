{
  int j;
  TaskRecord startTask=((HistoryRecord)mHistory.get(startIndex)).task;
  TaskRecord jt=startTask;
  for (j=startIndex - 1; j >= 0; j--) {
    HistoryRecord r=(HistoryRecord)mHistory.get(j);
    if (r.task != jt) {
      jt=r.task;
      if (affinity.equals(jt.affinity)) {
        return j;
      }
    }
  }
  final int N=mHistory.size();
  jt=startTask;
  for (j=startIndex + 1; j < N; j++) {
    HistoryRecord r=(HistoryRecord)mHistory.get(j);
    if (r.task != jt) {
      if (affinity.equals(jt.affinity)) {
        return j;
      }
      jt=r.task;
    }
  }
  if (affinity.equals(((HistoryRecord)mHistory.get(N - 1)).task.affinity)) {
    return N - 1;
  }
  return -1;
}
