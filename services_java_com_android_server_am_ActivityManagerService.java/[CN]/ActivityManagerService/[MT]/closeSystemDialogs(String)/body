{
  enforceNotIsolatedCaller("closeSystemDialogs");
  Intent intent=new Intent(Intent.ACTION_CLOSE_SYSTEM_DIALOGS);
  intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
  if (reason != null) {
    intent.putExtra("reason",reason);
  }
  final int uid=Binder.getCallingUid();
  final long origId=Binder.clearCallingIdentity();
synchronized (this) {
    mWindowManager.closeSystemDialogs(reason);
    for (int i=mMainStack.mHistory.size() - 1; i >= 0; i--) {
      ActivityRecord r=(ActivityRecord)mMainStack.mHistory.get(i);
      if ((r.info.flags & ActivityInfo.FLAG_FINISH_ON_CLOSE_SYSTEM_DIALOGS) != 0) {
        r.stack.finishActivityLocked(r,i,Activity.RESULT_CANCELED,null,"close-sys");
      }
    }
    broadcastIntentLocked(null,null,intent,null,null,0,null,null,null,false,false,-1,uid,0);
  }
  Binder.restoreCallingIdentity(origId);
}
