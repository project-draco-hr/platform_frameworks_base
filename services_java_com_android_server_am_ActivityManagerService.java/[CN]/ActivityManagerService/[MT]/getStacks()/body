{
synchronized (this) {
    ArrayList<ActivityManager.StackInfo> list=new ArrayList<ActivityManager.StackInfo>();
    ArrayList<ActivityStack> stacks=mStackSupervisor.getStacks();
    for (    ActivityStack stack : stacks) {
      ActivityManager.StackInfo stackInfo=new ActivityManager.StackInfo();
      int stackId=stack.mStackId;
      stackInfo.stackId=stackId;
      stackInfo.bounds=mWindowManager.getStackBounds(stackId);
      ArrayList<TaskRecord> tasks=stack.getAllTasks();
      final int numTasks=tasks.size();
      int[] taskIds=new int[numTasks];
      String[] taskNames=new String[numTasks];
      for (int i=0; i < numTasks; ++i) {
        final TaskRecord task=tasks.get(i);
        taskIds[i]=task.taskId;
        taskNames[i]=task.origActivity != null ? task.origActivity.flattenToString() : task.realActivity != null ? task.realActivity.flattenToString() : task.getTopActivity() != null ? task.getTopActivity().packageName : "unknown";
      }
      stackInfo.taskIds=taskIds;
      stackInfo.taskNames=taskNames;
      list.add(stackInfo);
    }
    return list;
  }
}
