{
  try {
synchronized (this) {
      if (checkCallingPermission(android.Manifest.permission.SET_ACTIVITY_WATCHER) != PackageManager.PERMISSION_GRANTED) {
        throw new SecurityException("Requires permission " + android.Manifest.permission.SET_ACTIVITY_WATCHER);
      }
      if (start && fd == null) {
        throw new IllegalArgumentException("null fd");
      }
      ProcessRecord proc=null;
      if (process != null) {
        try {
          int pid=Integer.parseInt(process);
synchronized (mPidsSelfLocked) {
            proc=mPidsSelfLocked.get(pid);
          }
        }
 catch (        NumberFormatException e) {
        }
        if (proc == null) {
          HashMap<String,SparseArray<ProcessRecord>> all=mProcessNames.getMap();
          SparseArray<ProcessRecord> procs=all.get(process);
          if (procs != null && procs.size() > 0) {
            proc=procs.valueAt(0);
          }
        }
      }
      if (start && (proc == null || proc.thread == null)) {
        throw new IllegalArgumentException("Unknown process: " + process);
      }
      if (start) {
        stopProfilerLocked(null,null,0);
        setProfileApp(proc.info,proc.processName,path,fd,false);
        mProfileProc=proc;
        mProfileType=profileType;
        try {
          fd=fd.dup();
        }
 catch (        IOException e) {
          fd=null;
        }
        proc.thread.profilerControl(start,path,fd,profileType);
        fd=null;
        mProfileFd=null;
      }
 else {
        stopProfilerLocked(proc,path,profileType);
        if (fd != null) {
          try {
            fd.close();
          }
 catch (          IOException e) {
          }
        }
      }
      return true;
    }
  }
 catch (  RemoteException e) {
    throw new IllegalStateException("Process disappeared");
  }
 finally {
    if (fd != null) {
      try {
        fd.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
