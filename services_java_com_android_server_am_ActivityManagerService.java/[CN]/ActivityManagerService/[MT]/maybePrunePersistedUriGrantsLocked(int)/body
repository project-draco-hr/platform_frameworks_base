{
  final ArrayMap<Uri,UriPermission> perms=mGrantedUriPermissions.get(uid);
  if (perms == null)   return false;
  if (perms.size() < MAX_PERSISTED_URI_GRANTS)   return false;
  final ArrayList<UriPermission> persisted=Lists.newArrayList();
  for (  UriPermission perm : perms.values()) {
    if (perm.persistedModeFlags != 0) {
      persisted.add(perm);
    }
  }
  final int trimCount=persisted.size() - MAX_PERSISTED_URI_GRANTS;
  if (trimCount <= 0)   return false;
  Collections.sort(persisted,new UriPermission.PersistedTimeComparator());
  for (int i=0; i < trimCount; i++) {
    final UriPermission perm=persisted.get(i);
    if (DEBUG_URI_PERMISSION) {
      Slog.v(TAG,"Trimming grant created at " + perm.persistedCreateTime);
    }
    perm.releasePersistableModes(~0);
    removeUriPermissionIfNeededLocked(perm);
  }
  return true;
}
