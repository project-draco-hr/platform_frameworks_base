{
synchronized (this) {
    ActivityRecord self=mMainStack.isInStackLocked(token);
    if (self == null) {
      return;
    }
    final long origId=Binder.clearCallingIdentity();
    int i;
    for (i=mMainStack.mHistory.size() - 1; i >= 0; i--) {
      ActivityRecord r=(ActivityRecord)mMainStack.mHistory.get(i);
      if (r.resultTo == self && r.requestCode == requestCode) {
        if ((r.resultWho == null && resultWho == null) || (r.resultWho != null && r.resultWho.equals(resultWho))) {
          mMainStack.finishActivityLocked(r,i,Activity.RESULT_CANCELED,null,"request-sub");
        }
      }
    }
    Binder.restoreCallingIdentity(origId);
  }
}
