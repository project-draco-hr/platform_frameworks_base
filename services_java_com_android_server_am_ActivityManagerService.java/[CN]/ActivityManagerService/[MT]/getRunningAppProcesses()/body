{
  List<ActivityManager.RunningAppProcessInfo> runList=null;
synchronized (this) {
    for (int i=mLruProcesses.size() - 1; i >= 0; i--) {
      ProcessRecord app=mLruProcesses.get(i);
      if ((app.thread != null) && (!app.crashing && !app.notResponding)) {
        ActivityManager.RunningAppProcessInfo currApp=new ActivityManager.RunningAppProcessInfo(app.processName,app.pid,app.getPackageList());
        currApp.uid=app.info.uid;
        if (mHeavyWeightProcess == app) {
          currApp.flags|=ActivityManager.RunningAppProcessInfo.FLAG_CANT_SAVE_STATE;
        }
        if (app.persistent) {
          currApp.flags|=ActivityManager.RunningAppProcessInfo.FLAG_PERSISTENT;
        }
        int adj=app.curAdj;
        if (adj >= EMPTY_APP_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_EMPTY;
        }
 else         if (adj >= HIDDEN_APP_MIN_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_BACKGROUND;
          currApp.lru=adj - HIDDEN_APP_MIN_ADJ + 1;
        }
 else         if (adj >= HOME_APP_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_BACKGROUND;
          currApp.lru=0;
        }
 else         if (adj >= SECONDARY_SERVER_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_SERVICE;
        }
 else         if (adj >= HEAVY_WEIGHT_APP_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_CANT_SAVE_STATE;
        }
 else         if (adj >= PERCEPTIBLE_APP_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_PERCEPTIBLE;
        }
 else         if (adj >= VISIBLE_APP_ADJ) {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_VISIBLE;
        }
 else {
          currApp.importance=ActivityManager.RunningAppProcessInfo.IMPORTANCE_FOREGROUND;
        }
        currApp.importanceReasonCode=app.adjTypeCode;
        if (app.adjSource instanceof ProcessRecord) {
          currApp.importanceReasonPid=((ProcessRecord)app.adjSource).pid;
        }
 else         if (app.adjSource instanceof ActivityRecord) {
          ActivityRecord r=(ActivityRecord)app.adjSource;
          if (r.app != null)           currApp.importanceReasonPid=r.app.pid;
        }
        if (app.adjTarget instanceof ComponentName) {
          currApp.importanceReasonComponent=(ComponentName)app.adjTarget;
        }
        if (runList == null) {
          runList=new ArrayList<ActivityManager.RunningAppProcessInfo>();
        }
        runList.add(currApp);
      }
    }
  }
  return runList;
}
