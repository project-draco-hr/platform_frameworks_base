{
  if (service != null && service.hasFileDescriptors() == true) {
    throw new IllegalArgumentException("File descriptors passed in Intent");
  }
synchronized (this) {
    if (DEBUG_SERVICE)     Log.v(TAG,"stopService: " + service + " type="+ resolvedType);
    final ProcessRecord callerApp=getRecordForAppLocked(caller);
    if (caller != null && callerApp == null) {
      throw new SecurityException("Unable to find app for caller " + caller + " (pid="+ Binder.getCallingPid()+ ") when stopping service "+ service);
    }
    ServiceLookupResult r=findServiceLocked(service,resolvedType);
    if (r != null) {
      if (r.record != null) {
synchronized (r.record.stats.getBatteryStats()) {
          r.record.stats.stopRunningLocked();
        }
        r.record.startRequested=false;
        r.record.callStart=false;
        final long origId=Binder.clearCallingIdentity();
        bringDownServiceLocked(r.record,false);
        Binder.restoreCallingIdentity(origId);
        return 1;
      }
      return -1;
    }
  }
  return 0;
}
