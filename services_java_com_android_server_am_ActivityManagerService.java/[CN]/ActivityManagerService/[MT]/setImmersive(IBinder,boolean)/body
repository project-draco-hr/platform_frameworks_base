{
synchronized (this) {
    final ActivityRecord r=mMainStack.isInStackLocked(token);
    if (r == null) {
      throw new IllegalArgumentException();
    }
    r.immersive=immersive;
    if (r == mMainStack.topRunningActivityLocked(null)) {
      long oldId=Binder.clearCallingIdentity();
      try {
        if (DEBUG_IMMERSIVE) {
          Slog.d(TAG,"Frontmost changed immersion: " + r);
        }
        applyUpdateLockStateLocked(r);
      }
  finally {
        Binder.restoreCallingIdentity(oldId);
      }
    }
  }
}
