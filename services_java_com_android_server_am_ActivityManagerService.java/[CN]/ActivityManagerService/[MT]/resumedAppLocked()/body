{
  ActivityRecord resumedActivity=mMainStack.mResumedActivity;
  if (resumedActivity == null || resumedActivity.app == null) {
    for (int i=mMainStack.mPausingActivities.size() - 1; i >= 0; i--) {
      ActivityRecord r=mMainStack.mPausingActivities.get(i);
      if (r.app != null) {
        resumedActivity=r;
        break;
      }
    }
    if (resumedActivity == null || resumedActivity.app == null) {
      resumedActivity=mMainStack.topRunningActivityLocked(null);
    }
  }
  return resumedActivity;
}
