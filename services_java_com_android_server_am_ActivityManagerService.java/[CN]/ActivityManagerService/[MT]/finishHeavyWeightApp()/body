{
  if (checkCallingPermission(android.Manifest.permission.FORCE_STOP_PACKAGES) != PackageManager.PERMISSION_GRANTED) {
    String msg="Permission Denial: finishHeavyWeightApp() from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " requires "+ android.Manifest.permission.FORCE_STOP_PACKAGES;
    Slog.w(TAG,msg);
    throw new SecurityException(msg);
  }
synchronized (this) {
    if (mHeavyWeightProcess == null) {
      return;
    }
    ArrayList<ActivityRecord> activities=new ArrayList<ActivityRecord>(mHeavyWeightProcess.activities);
    for (int i=0; i < activities.size(); i++) {
      ActivityRecord r=activities.get(i);
      if (!r.finishing) {
        int index=mMainStack.indexOfTokenLocked(r.appToken);
        if (index >= 0) {
          mMainStack.finishActivityLocked(r,index,Activity.RESULT_CANCELED,null,"finish-heavy");
        }
      }
    }
    mHandler.sendMessage(mHandler.obtainMessage(CANCEL_HEAVY_NOTIFICATION_MSG,mHeavyWeightProcess.userId,0));
    mHeavyWeightProcess=null;
  }
}
