{
  if (checkCallingPermission(android.Manifest.permission.FORCE_STOP_PACKAGES) != PackageManager.PERMISSION_GRANTED) {
    String msg="Permission Denial: finishHeavyWeightApp() from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " requires "+ android.Manifest.permission.FORCE_STOP_PACKAGES;
    Slog.w(TAG,msg);
    throw new SecurityException(msg);
  }
synchronized (this) {
    if (mHeavyWeightProcess == null) {
      return;
    }
    ArrayList<HistoryRecord> activities=new ArrayList<HistoryRecord>(mHeavyWeightProcess.activities);
    for (int i=0; i < activities.size(); i++) {
      HistoryRecord r=activities.get(i);
      if (!r.finishing) {
        int index=indexOfTokenLocked(r);
        if (index >= 0) {
          finishActivityLocked(r,index,Activity.RESULT_CANCELED,null,"finish-heavy");
        }
      }
    }
    mHeavyWeightProcess=null;
    mHandler.sendEmptyMessage(CANCEL_HEAVY_NOTIFICATION_MSG);
  }
}
