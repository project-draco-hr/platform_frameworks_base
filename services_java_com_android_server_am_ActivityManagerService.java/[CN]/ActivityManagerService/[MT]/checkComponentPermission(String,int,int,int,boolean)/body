{
  Identity tlsIdentity=sCallerIdentity.get();
  if (tlsIdentity != null) {
    Slog.d(TAG,"checkComponentPermission() adjusting {pid,uid} to {" + tlsIdentity.pid + ","+ tlsIdentity.uid+ "}");
    uid=tlsIdentity.uid;
    pid=tlsIdentity.pid;
  }
  if (uid == 0 || uid == Process.SYSTEM_UID || pid == MY_PID) {
    return PackageManager.PERMISSION_GRANTED;
  }
  if (owningUid >= 0 && uid == owningUid) {
    return PackageManager.PERMISSION_GRANTED;
  }
  if (!exported) {
    Slog.w(TAG,"Permission denied: checkComponentPermission() owningUid=" + owningUid);
    return PackageManager.PERMISSION_DENIED;
  }
  if (permission == null) {
    return PackageManager.PERMISSION_GRANTED;
  }
  try {
    return AppGlobals.getPackageManager().checkUidPermission(permission,uid);
  }
 catch (  RemoteException e) {
    Slog.e(TAG,"PackageManager is dead?!?",e);
  }
  return PackageManager.PERMISSION_DENIED;
}
