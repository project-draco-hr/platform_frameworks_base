{
  int changes=0;
  boolean kept=true;
  if (values != null) {
    Configuration newConfig=new Configuration(mConfiguration);
    changes=newConfig.updateFrom(values);
    if (changes != 0) {
      if (DEBUG_SWITCH || DEBUG_CONFIGURATION) {
        Log.i(TAG,"Updating configuration to: " + values);
      }
      EventLog.writeEvent(LOG_CONFIGURATION_CHANGED,changes);
      if (values.locale != null) {
        saveLocaleLocked(values.locale,!values.locale.equals(mConfiguration.locale),values.userSetLocale);
      }
      mConfiguration=newConfig;
      Log.i(TAG,"Config changed: " + newConfig);
      Message msg=mHandler.obtainMessage(UPDATE_CONFIGURATION_MSG);
      msg.obj=new Configuration(mConfiguration);
      mHandler.sendMessage(msg);
      final int N=mLRUProcesses.size();
      for (int i=0; i < N; i++) {
        ProcessRecord app=mLRUProcesses.get(i);
        try {
          if (app.thread != null) {
            if (DEBUG_CONFIGURATION)             Log.v(TAG,"Sending to proc " + app.processName + " new config "+ mConfiguration);
            app.thread.scheduleConfigurationChanged(mConfiguration);
          }
        }
 catch (        Exception e) {
        }
      }
      Intent intent=new Intent(Intent.ACTION_CONFIGURATION_CHANGED);
      intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
      broadcastIntentLocked(null,null,intent,null,null,0,null,null,null,false,false,MY_PID,Process.SYSTEM_UID);
      if ((changes & ActivityInfo.CONFIG_LOCALE) != 0) {
        broadcastIntentLocked(null,null,new Intent(Intent.ACTION_LOCALE_CHANGED),null,null,0,null,null,null,false,false,MY_PID,Process.SYSTEM_UID);
      }
      AttributeCache ac=AttributeCache.instance();
      if (ac != null) {
        ac.updateConfiguration(mConfiguration);
      }
    }
  }
  if (changes != 0 && starting == null) {
    starting=topRunningActivityLocked(null);
  }
  if (starting != null) {
    kept=ensureActivityConfigurationLocked(starting,changes);
    if (kept) {
      if (DEBUG_SWITCH)       Log.i(TAG,"Config didn't destroy " + starting + ", ensuring others are correct.");
      ensureActivitiesVisibleLocked(starting,changes);
    }
  }
  return kept;
}
