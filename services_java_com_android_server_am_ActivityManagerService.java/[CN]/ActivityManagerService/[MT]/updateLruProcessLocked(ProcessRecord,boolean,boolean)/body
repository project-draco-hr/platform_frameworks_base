{
  final boolean hasActivity=app.activities.size() > 0;
  final boolean hasService=false;
  if (!activityChange && hasActivity) {
    return;
  }
  mLruSeq++;
  final long now=SystemClock.uptimeMillis();
  app.lastActivityTime=now;
  int lrui=mLruProcesses.lastIndexOf(app);
  if (lrui >= 0) {
    if (lrui < mLruProcessActivityStart) {
      mLruProcessActivityStart--;
    }
    if (lrui < mLruProcessServiceStart) {
      mLruProcessServiceStart--;
    }
    mLruProcesses.remove(lrui);
  }
  int nextIndex;
  if (hasActivity) {
    mLruProcesses.add(app);
    nextIndex=mLruProcessActivityStart;
  }
 else   if (hasService) {
    mLruProcesses.add(mLruProcessActivityStart,app);
    nextIndex=mLruProcessServiceStart;
    mLruProcessActivityStart++;
  }
 else {
    mLruProcesses.add(mLruProcessServiceStart,app);
    nextIndex=mLruProcessServiceStart - 1;
    mLruProcessActivityStart++;
    mLruProcessServiceStart++;
  }
  for (int j=app.connections.size() - 1; j >= 0; j--) {
    ConnectionRecord cr=app.connections.valueAt(j);
    if (cr.binding != null && !cr.serviceDead && cr.binding.service != null && cr.binding.service.app != null && cr.binding.service.app.lruSeq != mLruSeq) {
      nextIndex=updateLruProcessInternalLocked(cr.binding.service.app,now,nextIndex,"service connection",cr,app);
    }
  }
  for (int j=app.conProviders.size() - 1; j >= 0; j--) {
    ContentProviderRecord cpr=app.conProviders.get(j).provider;
    if (cpr.proc != null && cpr.proc.lruSeq != mLruSeq) {
      nextIndex=updateLruProcessInternalLocked(cpr.proc,now,nextIndex,"provider reference",cpr,app);
    }
  }
  if (oomAdj) {
    updateOomAdjLocked();
  }
}
