{
  boolean needSep=false;
  pw.println("ACTIVITY MANAGER SERVICES (dumpsys activity services)");
  if (mServices.size() > 0) {
    pw.println("  Active services:");
    long nowReal=SystemClock.elapsedRealtime();
    Iterator<ServiceRecord> it=mServices.values().iterator();
    needSep=false;
    while (it.hasNext()) {
      ServiceRecord r=it.next();
      if (needSep) {
        pw.println();
      }
      pw.print("  * ");
      pw.println(r);
      if (dumpAll) {
        r.dump(pw,"    ");
        needSep=true;
      }
 else {
        pw.print("    app=");
        pw.println(r.app);
        pw.print("    created=");
        TimeUtils.formatDuration(r.createTime,nowReal,pw);
        pw.print(" started=");
        pw.print(r.startRequested);
        pw.print(" connections=");
        pw.println(r.connections.size());
      }
      if (dumpClient && r.app != null && r.app.thread != null) {
        pw.println("    Client:");
        pw.flush();
        try {
          TransferPipe tp=new TransferPipe();
          try {
            r.app.thread.dumpService(tp.getWriteFd().getFileDescriptor(),r,args);
            tp.setBufferPrefix("      ");
            tp.go(fd,2000);
          }
  finally {
            tp.kill();
          }
        }
 catch (        IOException e) {
          pw.println("      Failure while dumping the service: " + e);
        }
catch (        RemoteException e) {
          pw.println("      Got a RemoteException while dumping the service");
        }
        needSep=true;
      }
    }
    needSep=true;
  }
  if (mPendingServices.size() > 0) {
    if (needSep)     pw.println(" ");
    pw.println("  Pending services:");
    for (int i=0; i < mPendingServices.size(); i++) {
      ServiceRecord r=mPendingServices.get(i);
      pw.print("  * Pending ");
      pw.println(r);
      r.dump(pw,"    ");
    }
    needSep=true;
  }
  if (mRestartingServices.size() > 0) {
    if (needSep)     pw.println(" ");
    pw.println("  Restarting services:");
    for (int i=0; i < mRestartingServices.size(); i++) {
      ServiceRecord r=mRestartingServices.get(i);
      pw.print("  * Restarting ");
      pw.println(r);
      r.dump(pw,"    ");
    }
    needSep=true;
  }
  if (mStoppingServices.size() > 0) {
    if (needSep)     pw.println(" ");
    pw.println("  Stopping services:");
    for (int i=0; i < mStoppingServices.size(); i++) {
      ServiceRecord r=mStoppingServices.get(i);
      pw.print("  * Stopping ");
      pw.println(r);
      r.dump(pw,"    ");
    }
    needSep=true;
  }
  if (dumpAll) {
    if (mServiceConnections.size() > 0) {
      if (needSep)       pw.println(" ");
      pw.println("  Connection bindings to services:");
      Iterator<ArrayList<ConnectionRecord>> it=mServiceConnections.values().iterator();
      while (it.hasNext()) {
        ArrayList<ConnectionRecord> r=it.next();
        for (int i=0; i < r.size(); i++) {
          pw.print("  * ");
          pw.println(r.get(i));
          r.get(i).dump(pw,"    ");
        }
      }
      needSep=true;
    }
  }
  return needSep;
}
