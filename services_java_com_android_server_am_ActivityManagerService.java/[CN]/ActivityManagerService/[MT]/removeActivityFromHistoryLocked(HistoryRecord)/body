{
  if (r.state != ActivityState.DESTROYED) {
    mHistory.remove(r);
    r.inHistory=false;
    r.state=ActivityState.DESTROYED;
    mWindowManager.removeAppToken(r);
    if (VALIDATE_TOKENS) {
      mWindowManager.validateAppTokens(mHistory);
    }
    cleanUpActivityServicesLocked(r);
    removeActivityUriPermissionsLocked(r);
  }
}
