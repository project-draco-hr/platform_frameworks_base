{
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("killPidsForMemory only available to the system");
  }
  boolean killed=false;
synchronized (mPidsSelfLocked) {
    int[] types=new int[pids.length];
    int worstType=0;
    for (int i=0; i < pids.length; i++) {
      ProcessRecord proc=mPidsSelfLocked.get(pids[i]);
      if (proc != null) {
        int type=proc.setAdj;
        types[i]=type;
        if (type > worstType) {
          worstType=type;
        }
      }
    }
    if (worstType < EMPTY_APP_ADJ && worstType > HIDDEN_APP_MIN_ADJ) {
      worstType=HIDDEN_APP_MIN_ADJ;
    }
    Log.w(TAG,"Killing processes for memory at adjustment " + worstType);
    for (int i=0; i < pids.length; i++) {
      ProcessRecord proc=mPidsSelfLocked.get(pids[i]);
      if (proc == null) {
        continue;
      }
      int adj=proc.setAdj;
      if (adj >= worstType) {
        Log.w(TAG,"Killing for memory: " + proc + " (adj "+ adj+ ")");
        EventLog.writeEvent(LOG_AM_KILL_FOR_MEMORY,proc.pid,proc.processName,adj);
        killed=true;
        Process.killProcess(pids[i]);
      }
    }
  }
  return killed;
}
