{
  enforceNotIsolatedCaller("clearApplicationUserData");
  int uid=Binder.getCallingUid();
  int pid=Binder.getCallingPid();
  userId=handleIncomingUser(pid,uid,userId,false,true,"clearApplicationUserData",null);
  long callingId=Binder.clearCallingIdentity();
  try {
    IPackageManager pm=AppGlobals.getPackageManager();
    int pkgUid=-1;
synchronized (this) {
      try {
        pkgUid=pm.getPackageUid(packageName,userId);
      }
 catch (      RemoteException e) {
      }
      if (pkgUid == -1) {
        Slog.w(TAG,"Invalid packageName: " + packageName);
        if (observer != null) {
          try {
            observer.onRemoveCompleted(packageName,false);
          }
 catch (          RemoteException e) {
            Slog.i(TAG,"Observer no longer exists.");
          }
        }
        return false;
      }
      if (uid == pkgUid || checkComponentPermission(android.Manifest.permission.CLEAR_APP_USER_DATA,pid,uid,-1,true) == PackageManager.PERMISSION_GRANTED) {
        forceStopPackageLocked(packageName,pkgUid);
      }
 else {
        throw new SecurityException(pid + " does not have permission:" + android.Manifest.permission.CLEAR_APP_USER_DATA+ " to clear data"+ "for process:"+ packageName);
      }
    }
    try {
      pm.clearApplicationUserData(packageName,observer,userId);
      removeUriPermissionsForPackageLocked(packageName,userId,true);
      Intent intent=new Intent(Intent.ACTION_PACKAGE_DATA_CLEARED,Uri.fromParts("package",packageName,null));
      intent.putExtra(Intent.EXTRA_UID,pkgUid);
      broadcastIntentInPackage("android",Process.SYSTEM_UID,intent,null,null,0,null,null,null,false,false,userId);
    }
 catch (    RemoteException e) {
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingId);
  }
  return true;
}
