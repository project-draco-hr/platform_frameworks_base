{
  if (checkCallingPermission(android.Manifest.permission.DEVICE_POWER) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires permission " + android.Manifest.permission.DEVICE_POWER);
  }
synchronized (this) {
    mWentToSleep=true;
    updateEventDispatchingLocked();
    if (!mSleeping) {
      mSleeping=true;
      final int numStacks=mStacks.size();
      for (int stackNdx=0; stackNdx < numStacks; ++stackNdx) {
        final ActivityStack stack=mStacks.get(stackNdx);
        stack.stopIfSleepingLocked();
      }
      checkExcessivePowerUsageLocked(false);
      mHandler.removeMessages(CHECK_EXCESSIVE_WAKE_LOCKS_MSG);
      Message nmsg=mHandler.obtainMessage(CHECK_EXCESSIVE_WAKE_LOCKS_MSG);
      mHandler.sendMessageDelayed(nmsg,POWER_CHECK_DELAY);
    }
  }
}
