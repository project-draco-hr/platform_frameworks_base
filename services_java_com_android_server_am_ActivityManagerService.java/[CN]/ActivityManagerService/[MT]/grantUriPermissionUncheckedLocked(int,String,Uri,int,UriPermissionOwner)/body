{
  final boolean persist=(modeFlags & Intent.FLAG_PERSIST_GRANT_URI_PERMISSION) != 0;
  modeFlags&=(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
  if (modeFlags == 0) {
    return;
  }
  if (DEBUG_URI_PERMISSION)   Slog.v(TAG,"Granting " + targetPkg + "/"+ targetUid+ " permission to "+ uri);
  final String authority=uri.getAuthority();
  final ProviderInfo pi=getProviderInfoLocked(authority,UserHandle.getUserId(targetUid));
  if (pi == null) {
    Slog.w(TAG,"No content provider found for grant: " + uri.toSafeString());
    return;
  }
  final UriPermission perm=findOrCreateUriPermissionLocked(pi.packageName,targetPkg,targetUid,uri);
  final boolean persistChanged=perm.grantModes(modeFlags,persist,owner);
  if (persistChanged) {
    mHandler.removeMessages(PERSIST_URI_GRANTS_MSG);
    mHandler.obtainMessage(PERSIST_URI_GRANTS_MSG).sendToTarget();
  }
}
