{
  r.totalRestartCount++;
  if (r.restartDelay == 0) {
    r.restartCount++;
    r.restartDelay=SERVICE_RESTART_DURATION;
  }
 else {
    long now=SystemClock.uptimeMillis();
    if (now > (r.restartTime + (SERVICE_RESTART_DURATION * 2 * 2* 2))) {
      r.restartCount=1;
      r.restartDelay=SERVICE_RESTART_DURATION;
    }
 else {
      r.restartDelay*=2;
    }
  }
  if (!mRestartingServices.contains(r)) {
    mRestartingServices.add(r);
  }
  r.cancelNotification();
  mHandler.removeCallbacks(r.restarter);
  mHandler.postDelayed(r.restarter,r.restartDelay);
  r.nextRestartTime=SystemClock.uptimeMillis() + r.restartDelay;
  Log.w(TAG,"Scheduling restart of crashed service " + r.shortName + " in "+ r.restartDelay+ "ms");
  EventLog.writeEvent(LOG_AM_SCHEDULE_SERVICE_RESTART,r.shortName,r.restartDelay);
  Message msg=Message.obtain();
  msg.what=SERVICE_ERROR_MSG;
  msg.obj=r;
  mHandler.sendMessage(msg);
}
