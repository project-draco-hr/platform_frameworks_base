{
  if (localLOGV)   Slog.v(TAG,"Activity stopped: token=" + token);
  if (icicle != null && icicle.hasFileDescriptors()) {
    throw new IllegalArgumentException("File descriptors passed in Bundle");
  }
  ActivityRecord r=null;
  final long origId=Binder.clearCallingIdentity();
synchronized (this) {
    int index=mMainStack.indexOfTokenLocked(token);
    if (index >= 0) {
      r=(ActivityRecord)mMainStack.mHistory.get(index);
      r.icicle=icicle;
      r.haveState=true;
      if (thumbnail != null) {
        r.thumbnail=thumbnail;
        if (r.task != null) {
          r.task.lastThumbnail=r.thumbnail;
        }
      }
      r.description=description;
      if (r.task != null) {
        r.task.lastDescription=r.description;
      }
      r.stopped=true;
      r.state=ActivityState.STOPPED;
      if (!r.finishing) {
        if (r.configDestroy) {
          r.stack.destroyActivityLocked(r,true);
          r.stack.resumeTopActivityLocked(null);
        }
      }
    }
  }
  if (r != null) {
    sendPendingThumbnail(r,null,null,null,false);
  }
  trimApplications();
  Binder.restoreCallingIdentity(origId);
}
