{
  final Object[] sps=text.getSpans(0,text.length(),Object.class);
  if (sps != null) {
    for (int i=sps.length - 1; i >= 0; i--) {
      final Object o=sps[i];
      if (o == COMPOSING) {
        text.removeSpan(o);
        continue;
      }
      final int fl=text.getSpanFlags(o);
      if ((fl & (Spanned.SPAN_COMPOSING | Spanned.SPAN_POINT_MARK_MASK)) != (Spanned.SPAN_COMPOSING | Spanned.SPAN_EXCLUSIVE_EXCLUSIVE)) {
        text.setSpan(o,text.getSpanStart(o),text.getSpanEnd(o),(fl & Spanned.SPAN_POINT_MARK_MASK) | Spanned.SPAN_COMPOSING | Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
    }
  }
  text.setSpan(COMPOSING,0,text.length(),Spanned.SPAN_EXCLUSIVE_EXCLUSIVE | Spanned.SPAN_COMPOSING);
}
