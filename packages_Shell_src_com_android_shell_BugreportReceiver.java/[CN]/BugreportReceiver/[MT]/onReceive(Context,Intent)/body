{
  final File bugreportFile=getFileExtra(intent,EXTRA_BUGREPORT);
  final File screenshotFile=getFileExtra(intent,EXTRA_SCREENSHOT);
  final Uri bugreportUri=FileProvider.getUriForFile(context,AUTHORITY,bugreportFile);
  final Uri screenshotUri=FileProvider.getUriForFile(context,AUTHORITY,screenshotFile);
  Intent sendIntent=buildSendIntent(context,bugreportUri,screenshotUri);
  Intent notifIntent;
  if (getWarningState(context,STATE_SHOW) == STATE_SHOW) {
    notifIntent=buildWarningIntent(context,sendIntent);
  }
 else {
    notifIntent=sendIntent;
  }
  notifIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
  final Notification.Builder builder=new Notification.Builder(context);
  builder.setSmallIcon(com.android.internal.R.drawable.stat_sys_adb);
  builder.setContentTitle(context.getString(R.string.bugreport_finished_title));
  builder.setContentText(context.getString(R.string.bugreport_finished_text));
  builder.setContentIntent(PendingIntent.getActivity(context,0,notifIntent,PendingIntent.FLAG_CANCEL_CURRENT));
  builder.setAutoCancel(true);
  NotificationManager.from(context).notify(TAG,0,builder.build());
  final PendingResult result=goAsync();
  new AsyncTask<Void,Void,Void>(){
    @Override protected Void doInBackground(    Void... params){
      deleteOlderFiles(bugreportFile.getParentFile(),NUM_OLD_FILES);
      result.finish();
      return null;
    }
  }
.execute();
}
