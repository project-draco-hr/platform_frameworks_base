{
  if (allDay) {
    return format("%Y-%m-%d");
  }
 else   if (TIMEZONE_UTC.equals(timezone)) {
    return format("%Y-%m-%dT%H:%M:%S.000Z");
  }
 else {
    String base=format("%Y-%m-%dT%H:%M:%S.000");
    String sign=(gmtoff < 0) ? "-" : "+";
    int offset=(int)Math.abs(gmtoff);
    int minutes=(offset % 3600) / 60;
    int hours=offset / 3600;
    return String.format("%s%s%02d:%02d",base,sign,hours,minutes);
  }
}
