{
  if (DEBUG_APP_TRANSITIONS)   Slog.v(TAG,"Prepare app transition:" + " transit=" + appTransitionToString(transit) + " "+ this+ " alwaysKeepCurrent="+ alwaysKeepCurrent+ " Callers="+ Debug.getCallers(3));
  if (!isTransitionSet() || mNextAppTransition == TRANSIT_NONE) {
    setAppTransition(transit);
  }
 else   if (!alwaysKeepCurrent) {
    if (transit == TRANSIT_TASK_OPEN && isTransitionEqual(TRANSIT_TASK_CLOSE)) {
      setAppTransition(transit);
    }
 else     if (transit == TRANSIT_ACTIVITY_OPEN && isTransitionEqual(TRANSIT_ACTIVITY_CLOSE)) {
      setAppTransition(transit);
    }
  }
  boolean prepared=prepare();
  if (isTransitionSet()) {
    mService.mH.removeMessages(H.APP_TRANSITION_TIMEOUT);
    mService.mH.sendEmptyMessageDelayed(H.APP_TRANSITION_TIMEOUT,APP_TRANSITION_TIMEOUT_MS);
  }
  return prepared;
}
