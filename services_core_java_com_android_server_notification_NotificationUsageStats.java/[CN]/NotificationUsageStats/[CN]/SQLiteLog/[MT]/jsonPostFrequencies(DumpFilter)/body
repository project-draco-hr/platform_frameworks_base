{
  JSONArray frequencies=new JSONArray();
  SQLiteDatabase db=mHelper.getReadableDatabase();
  long midnight=getMidnightMs();
  String q=String.format(STATS_QUERY,midnight,filter.since);
  Cursor cursor=db.rawQuery(q,null);
  try {
    for (cursor.moveToFirst(); !cursor.isAfterLast(); cursor.moveToNext()) {
      int userId=cursor.getInt(0);
      String pkg=cursor.getString(1);
      if (filter != null && !filter.matches(pkg))       continue;
      int day=cursor.getInt(2);
      int count=cursor.getInt(3);
      int muted=cursor.getInt(4);
      int noisy=cursor.getInt(5);
      int demoted=cursor.getInt(6);
      JSONObject row=new JSONObject();
      row.put("user_id",userId);
      row.put("package",pkg);
      row.put("day",day);
      row.put("count",count);
      row.put("noisy",noisy);
      row.put("muted",muted);
      row.put("demoted",demoted);
      frequencies.put(row);
    }
  }
  finally {
    cursor.close();
  }
  return frequencies;
}
