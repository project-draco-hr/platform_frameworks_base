{
  float totalAdvance=0;
  FontRenderContext f=font.mMetrics.getFontRenderContext();
  FontRenderContext frc=new FontRenderContext(f.getTransform(),paint.isAntiAliased(),f.usesFractionalMetrics());
  GlyphVector gv=font.mFont.layoutGlyphVector(frc,text,start,limit,flag);
  int ng=gv.getNumGlyphs();
  int[] ci=gv.getGlyphCharIndices(0,ng,null);
  for (int i=0; i < ng; i++) {
    float adv=gv.getGlyphMetrics(i).getAdvanceX();
    if (advances != null) {
      int adv_idx=advancesIndex + ci[i];
      advances[adv_idx]+=adv;
    }
    totalAdvance+=adv;
  }
  if (draw && graphics != null) {
    graphics.drawGlyphVector(gv,x,y);
  }
  return x + totalAdvance;
}
