{
  List<FontInfo> fonts=mPaint.getFonts();
  if (fonts == null || preferredFont == null) {
    return;
  }
  while (start < limit) {
    boolean foundFont=false;
    int canDisplayUpTo=preferredFont.mFont.canDisplayUpTo(mText,start,limit);
    if (canDisplayUpTo == -1) {
      render(start,limit,preferredFont,flag,advances,advancesIndex,draw);
      return;
    }
    if (canDisplayUpTo > start) {
      render(start,canDisplayUpTo,preferredFont,flag,advances,advancesIndex,draw);
      advancesIndex+=canDisplayUpTo - start;
      start=canDisplayUpTo;
    }
    int charCount=Character.isHighSurrogate(mText[start]) ? 2 : 1;
    for (    FontInfo font : fonts) {
      canDisplayUpTo=font.mFont.canDisplayUpTo(mText,start,start + charCount);
      if (canDisplayUpTo == -1) {
        render(start,start + charCount,font,flag,advances,advancesIndex,draw);
        start+=charCount;
        advancesIndex+=charCount;
        foundFont=true;
        break;
      }
    }
    if (!foundFont) {
      render(start,start + charCount,preferredFont,flag,advances,advancesIndex,draw);
      start+=charCount;
      advancesIndex+=charCount;
    }
  }
}
