{
  final SuggestionSpan targetSuggestionSpan=findEquivalentSuggestionSpan(suggestionInfo.mSuggestionSpanInfo);
  if (targetSuggestionSpan == null) {
    return;
  }
  final Editable editable=(Editable)mTextView.getText();
  final int spanStart=editable.getSpanStart(targetSuggestionSpan);
  final int spanEnd=editable.getSpanEnd(targetSuggestionSpan);
  if (spanStart < 0 || spanEnd <= spanStart) {
    return;
  }
  final String originalText=TextUtils.substring(editable,spanStart,spanEnd);
  SuggestionSpan[] suggestionSpans=editable.getSpans(spanStart,spanEnd,SuggestionSpan.class);
  final int length=suggestionSpans.length;
  int[] suggestionSpansStarts=new int[length];
  int[] suggestionSpansEnds=new int[length];
  int[] suggestionSpansFlags=new int[length];
  for (int i=0; i < length; i++) {
    final SuggestionSpan suggestionSpan=suggestionSpans[i];
    suggestionSpansStarts[i]=editable.getSpanStart(suggestionSpan);
    suggestionSpansEnds[i]=editable.getSpanEnd(suggestionSpan);
    suggestionSpansFlags[i]=editable.getSpanFlags(suggestionSpan);
    int suggestionSpanFlags=suggestionSpan.getFlags();
    if ((suggestionSpanFlags & SuggestionSpan.FLAG_MISSPELLED) != 0) {
      suggestionSpanFlags&=~SuggestionSpan.FLAG_MISSPELLED;
      suggestionSpanFlags&=~SuggestionSpan.FLAG_EASY_CORRECT;
      suggestionSpan.setFlags(suggestionSpanFlags);
    }
  }
  targetSuggestionSpan.notifySelection(mTextView.getContext(),originalText,suggestionInfo.mSuggestionIndex);
  final int suggestionStart=suggestionInfo.mSuggestionStart;
  final int suggestionEnd=suggestionInfo.mSuggestionEnd;
  final String suggestion=suggestionInfo.mText.subSequence(suggestionStart,suggestionEnd).toString();
  mTextView.replaceText_internal(spanStart,spanEnd,suggestion);
  String[] suggestions=targetSuggestionSpan.getSuggestions();
  suggestions[suggestionInfo.mSuggestionIndex]=originalText;
  final int lengthDelta=suggestion.length() - (spanEnd - spanStart);
  for (int i=0; i < length; i++) {
    if (suggestionSpansStarts[i] <= spanStart && suggestionSpansEnds[i] >= spanEnd) {
      mTextView.setSpan_internal(suggestionSpans[i],suggestionSpansStarts[i],suggestionSpansEnds[i] + lengthDelta,suggestionSpansFlags[i]);
    }
  }
  final int newCursorPosition=spanEnd + lengthDelta;
  mTextView.setCursorPosition_internal(newCursorPosition,newCursorPosition);
}
