{
  final int selectionEnd=mTextView.getSelectionEnd();
  final Layout layout=mTextView.getLayout();
  int initialOffset=mTextView.getOffsetForPosition(x,y);
  int currLine=mTextView.getLineAtCoordinate(y);
  boolean positionCursor=false;
  if (initialOffset >= selectionEnd) {
    currLine=layout != null ? layout.getLineForOffset(selectionEnd) : mPrevLine;
    initialOffset=mTextView.getOffsetAtCoordinate(currLine,x);
  }
  int offset=initialOffset;
  int end=getWordEnd(offset);
  int start=getWordStart(offset);
  if (offset < mPreviousOffset) {
    if (!mInWord || currLine < mPrevLine) {
      int offsetToWord=Math.min((end - start) / 2,2);
      if (offset <= end - offsetToWord || currLine < mPrevLine) {
        offset=start;
      }
 else {
        offset=mPreviousOffset;
      }
    }
    if (layout != null && offset < initialOffset) {
      final float adjustedX=layout.getPrimaryHorizontal(offset);
      mTouchWordDelta=mTextView.convertToLocalHorizontalCoordinate(x) - adjustedX;
    }
 else {
      mTouchWordDelta=0.0f;
    }
    positionCursor=true;
  }
 else {
    final int adjustedOffset=mTextView.getOffsetAtCoordinate(currLine,x - mTouchWordDelta);
    if (adjustedOffset > mPreviousOffset || currLine > mPrevLine) {
      if (currLine > mPrevLine) {
        offset=start;
        if (layout != null && offset < initialOffset) {
          final float adjustedX=layout.getPrimaryHorizontal(offset);
          mTouchWordDelta=mTextView.convertToLocalHorizontalCoordinate(x) - adjustedX;
        }
 else {
          mTouchWordDelta=0.0f;
        }
      }
 else {
        offset=adjustedOffset;
      }
      positionCursor=true;
    }
  }
  if (positionCursor) {
    if (offset >= selectionEnd) {
      offset=getNextCursorOffset(selectionEnd,false);
      mTouchWordDelta=0.0f;
    }
    positionAtCursorOffset(offset,false);
  }
}
