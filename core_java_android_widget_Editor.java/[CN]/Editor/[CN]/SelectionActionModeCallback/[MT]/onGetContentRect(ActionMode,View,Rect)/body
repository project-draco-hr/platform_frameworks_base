{
  if (!view.equals(mTextView) || mTextView.getLayout() == null) {
    super.onGetContentRect(mode,view,outRect);
    return;
  }
  if (mTextView.getSelectionStart() != mTextView.getSelectionEnd()) {
    mSelectionPath.reset();
    mTextView.getLayout().getSelectionPath(mTextView.getSelectionStart(),mTextView.getSelectionEnd(),mSelectionPath);
    mSelectionPath.computeBounds(mSelectionBounds,true);
    mSelectionBounds.bottom+=mSelectionHandleHeight;
  }
 else {
    int line=mTextView.getLayout().getLineForOffset(mTextView.getSelectionStart());
    float primaryHorizontal=mTextView.getLayout().getPrimaryHorizontal(mTextView.getSelectionStart());
    mSelectionBounds.set(primaryHorizontal,mTextView.getLayout().getLineTop(line),primaryHorizontal + 1,mTextView.getLayout().getLineTop(line + 1) + mInsertionHandleHeight);
  }
  int textHorizontalOffset=mTextView.viewportToContentHorizontalOffset();
  int textVerticalOffset=mTextView.viewportToContentVerticalOffset();
  outRect.set((int)Math.floor(mSelectionBounds.left + textHorizontalOffset),(int)Math.floor(mSelectionBounds.top + textVerticalOffset),(int)Math.ceil(mSelectionBounds.right + textHorizontalOffset),(int)Math.ceil(mSelectionBounds.bottom + textVerticalOffset));
}
