{
  final boolean result=super.onTouchEvent(ev);
switch (ev.getActionMasked()) {
case MotionEvent.ACTION_DOWN:
    mDownPositionX=ev.getRawX();
  mDownPositionY=ev.getRawY();
break;
case MotionEvent.ACTION_UP:
if (!offsetHasBeenChanged()) {
final float deltaX=mDownPositionX - ev.getRawX();
final float deltaY=mDownPositionY - ev.getRawY();
final float distanceSquared=deltaX * deltaX + deltaY * deltaY;
final ViewConfiguration viewConfiguration=ViewConfiguration.get(mTextView.getContext());
final int touchSlop=viewConfiguration.getScaledTouchSlop();
if (distanceSquared < touchSlop * touchSlop) {
  if (mTextActionMode != null) {
    mTextActionMode.finish();
  }
 else {
    startInsertionActionMode();
  }
}
}
 else {
if (mTextActionMode != null) {
  mTextActionMode.invalidateContentRect();
}
}
hideAfterDelay();
break;
case MotionEvent.ACTION_CANCEL:
hideAfterDelay();
break;
default :
break;
}
return result;
}
