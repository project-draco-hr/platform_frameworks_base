{
  adjustSpans(buffer,start,after);
  if (mTextView.getWindowVisibility() != View.VISIBLE) {
    return;
  }
  if (mTextView.getLayout() == null) {
    return;
  }
  InputMethodManager imm=InputMethodManager.peekInstance();
  if (!(mTextView instanceof ExtractEditText) && imm != null && imm.isFullscreenMode()) {
    return;
  }
  if (mEasyEditSpan != null) {
    if (buffer instanceof Spannable) {
      ((Spannable)buffer).removeSpan(mEasyEditSpan);
    }
    mEasyEditSpan=null;
  }
  if (mPopupWindow != null && mPopupWindow.isShowing()) {
    mPopupWindow.hide();
  }
  if (buffer instanceof Spanned) {
    mEasyEditSpan=getSpan((Spanned)buffer);
    if (mEasyEditSpan != null) {
      if (mPopupWindow == null) {
        mPopupWindow=new EasyEditPopupWindow();
        mHidePopup=new Runnable(){
          @Override public void run(){
            hide();
          }
        }
;
      }
      mPopupWindow.show(mEasyEditSpan);
      mTextView.removeCallbacks(mHidePopup);
      mTextView.postDelayed(mHidePopup,DISPLAY_TIMEOUT_MS);
    }
  }
}
