{
  Layout layout=mTextView.getLayout();
  if (layout == null) {
    prepareCursorControllers();
    return;
  }
  layout=mTextView.getLayout();
  boolean offsetChanged=offset != mPreviousOffset;
  if (offsetChanged || forceUpdatePosition) {
    if (offsetChanged) {
      updateSelection(offset);
      addPositionToTouchUpFilter(offset);
    }
    final int line=layout.getLineForOffset(offset);
    mPrevLine=line;
    mPositionX=getCursorHorizontalPosition(layout,offset) - mHotspotX - getHorizontalOffset() + getCursorOffset();
    mPositionY=layout.getLineBottom(line);
    mPositionX+=mTextView.viewportToContentHorizontalOffset();
    mPositionY+=mTextView.viewportToContentVerticalOffset();
    mPreviousOffset=offset;
    mPositionHasChanged=true;
  }
}
