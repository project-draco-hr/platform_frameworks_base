{
  Layout layout=mTextView.getLayout();
  if (layout == null) {
    prepareCursorControllers();
    return;
  }
  boolean offsetChanged=offset != mPreviousOffset;
  if (offsetChanged || parentScrolled) {
    if (offsetChanged) {
      updateSelection(offset);
      addPositionToTouchUpFilter(offset);
    }
    final int line=layout.getLineForOffset(offset);
    mPositionX=(int)(layout.getPrimaryHorizontal(offset) - 0.5f - mHotspotX- getHorizontalOffset() + getCursorOffset());
    mPositionY=layout.getLineBottom(line);
    mPositionX+=mTextView.viewportToContentHorizontalOffset();
    mPositionY+=mTextView.viewportToContentVerticalOffset();
    mPreviousOffset=offset;
    mPositionHasChanged=true;
  }
}
