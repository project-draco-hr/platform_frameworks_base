{
  Application initialApplication=AppGlobals.getInitialApplication();
  try {
    WebViewProviderResponse response=null;
    Trace.traceBegin(Trace.TRACE_TAG_WEBVIEW,"WebViewUpdateService.waitForAndGetProvider()");
    try {
      response=getUpdateService().waitForAndGetProvider();
    }
  finally {
      Trace.traceEnd(Trace.TRACE_TAG_WEBVIEW);
    }
    if (response.status != LIBLOAD_SUCCESS && response.status != LIBLOAD_FAILED_WAITING_FOR_RELRO) {
      throw new MissingWebViewPackageException("Failed to load WebView provider: " + getWebViewPreparationErrorReason(response.status));
    }
    Trace.traceBegin(Trace.TRACE_TAG_WEBVIEW,"ActivityManager.addPackageDependency()");
    try {
      ActivityManagerNative.getDefault().addPackageDependency(response.packageInfo.packageName);
    }
  finally {
      Trace.traceEnd(Trace.TRACE_TAG_WEBVIEW);
    }
    PackageInfo newPackageInfo=null;
    Trace.traceBegin(Trace.TRACE_TAG_WEBVIEW,"PackageManager.getPackageInfo()");
    try {
      newPackageInfo=initialApplication.getPackageManager().getPackageInfo(response.packageInfo.packageName,PackageManager.GET_SHARED_LIBRARY_FILES | PackageManager.MATCH_DEBUG_TRIAGED_MISSING | PackageManager.MATCH_UNINSTALLED_PACKAGES| PackageManager.GET_SIGNATURES| PackageManager.GET_META_DATA);
    }
  finally {
      Trace.traceEnd(Trace.TRACE_TAG_WEBVIEW);
    }
    verifyPackageInfo(response.packageInfo,newPackageInfo);
    Trace.traceBegin(Trace.TRACE_TAG_WEBVIEW,"initialApplication.createApplicationContext");
    try {
      Context webViewContext=initialApplication.createApplicationContext(newPackageInfo.applicationInfo,Context.CONTEXT_INCLUDE_CODE | Context.CONTEXT_IGNORE_SECURITY);
      sPackageInfo=newPackageInfo;
      return webViewContext;
    }
  finally {
      Trace.traceEnd(Trace.TRACE_TAG_WEBVIEW);
    }
  }
 catch (  RemoteException|PackageManager.NameNotFoundException e) {
    throw new MissingWebViewPackageException("Failed to load WebView provider: " + e);
  }
}
