{
  mRS=RenderScript.create(this);
  mRS.setMessageHandler(new FilterCallback());
  mInPixelsAllocation=Allocation.createFromBitmap(mRS,mBitmapIn,Allocation.MipmapControl.MIPMAP_NONE,Allocation.USAGE_SCRIPT);
  mOutPixelsAllocation=Allocation.createFromBitmap(mRS,mBitmapOut,Allocation.MipmapControl.MIPMAP_NONE,Allocation.USAGE_SCRIPT);
  Type.Builder tb=new Type.Builder(mRS,Element.F32_4(mRS));
  tb.setX(mBitmapIn.getWidth());
  tb.setY(mBitmapIn.getHeight());
  mScratchPixelsAllocation1=Allocation.createTyped(mRS,tb.create());
  mScratchPixelsAllocation2=Allocation.createTyped(mRS,tb.create());
  mScriptVBlur=new ScriptC_vertical_blur(mRS,getResources(),R.raw.vertical_blur);
  mScriptHBlur=new ScriptC_horizontal_blur(mRS,getResources(),R.raw.horizontal_blur);
  mScript=new ScriptC_threshold(mRS,getResources(),R.raw.threshold);
  mScript.set_width(mBitmapIn.getWidth());
  mScript.set_height(mBitmapIn.getHeight());
  mScript.set_radius(mRadius);
  mScriptVBlur.invoke_setLevels(mInBlack,mOutBlack,mInWhite,mOutWhite);
  mScriptVBlur.invoke_setGamma(mGamma);
  mScriptVBlur.invoke_setSaturation(mSaturation);
  mScript.bind_InPixel(mInPixelsAllocation);
  mScript.bind_OutPixel(mOutPixelsAllocation);
  mScript.bind_ScratchPixel1(mScratchPixelsAllocation1);
  mScript.bind_ScratchPixel2(mScratchPixelsAllocation2);
  mScript.set_vBlurScript(mScriptVBlur);
  mScript.set_hBlurScript(mScriptHBlur);
}
