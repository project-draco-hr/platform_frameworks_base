{
  mRS=RenderScript.create();
  mRS.mMessageCallback=new FilterCallback();
  mInPixelsAllocation=Allocation.createBitmapRef(mRS,mBitmapIn);
  mOutPixelsAllocation=Allocation.createBitmapRef(mRS,mBitmapOut);
  Type.Builder tb=new Type.Builder(mRS,Element.F32_4(mRS));
  tb.add(android.renderscript.Dimension.X,mBitmapIn.getWidth());
  tb.add(android.renderscript.Dimension.Y,mBitmapIn.getHeight());
  mScratchPixelsAllocation1=Allocation.createTyped(mRS,tb.create());
  mScratchPixelsAllocation2=Allocation.createTyped(mRS,tb.create());
  mScriptVBlur=new ScriptC_vertical_blur(mRS,getResources(),R.raw.vertical_blur,false);
  mScriptHBlur=new ScriptC_horizontal_blur(mRS,getResources(),R.raw.horizontal_blur,false);
  mScript=new ScriptC_threshold(mRS,getResources(),R.raw.threshold,false);
  mScript.set_width(mBitmapIn.getWidth());
  mScript.set_height(mBitmapIn.getHeight());
  mScript.set_radius(mRadius);
  mScriptVBlur.invoke_setLevels(mInBlack,mOutBlack,mInWhite,mOutWhite);
  mScriptVBlur.invoke_setGamma(mGamma);
  mScriptVBlur.invoke_setSaturation(mSaturation);
  mScript.bind_InPixel(mInPixelsAllocation);
  mScript.bind_OutPixel(mOutPixelsAllocation);
  mScript.bind_ScratchPixel1(mScratchPixelsAllocation1);
  mScript.bind_ScratchPixel2(mScratchPixelsAllocation2);
  mScript.set_vBlurScript(mScriptVBlur);
  mScript.set_hBlurScript(mScriptHBlur);
}
