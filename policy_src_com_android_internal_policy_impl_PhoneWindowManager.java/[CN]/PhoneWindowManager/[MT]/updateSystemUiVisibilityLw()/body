{
  if (mFocusedWindow == null) {
    return 0;
  }
  if (mFocusedWindow.getAttrs().type == TYPE_KEYGUARD && mHideLockScreen == true) {
    return 0;
  }
  int tmpVisibility=mFocusedWindow.getSystemUiVisibility() & ~mResettingSystemUiFlags & ~mForceClearedSystemUiFlags;
  if (mForcingShowNavBar && mFocusedWindow.getSurfaceLayer() < mForcingShowNavBarLayer) {
    tmpVisibility&=~View.SYSTEM_UI_CLEARABLE_FLAGS;
  }
  boolean hideybarsAllowed=(mFocusedWindow.getAttrs().flags & WindowManager.LayoutParams.FLAG_FULLSCREEN) != 0 || mFocusedWindow.getAttrs().type == TYPE_STATUS_BAR;
  if (mHideybars == HIDEYBARS_SHOWING) {
    if (!hideybarsAllowed) {
      mHideybars=HIDEYBARS_NONE;
      if ((tmpVisibility & View.SYSTEM_UI_FLAG_FULLSCREEN) != 0) {
        int newVal=mResettingSystemUiFlags | View.SYSTEM_UI_CLEARABLE_FLAGS;
        if (newVal != mResettingSystemUiFlags) {
          mResettingSystemUiFlags=newVal;
          mWindowManagerFuncs.reevaluateStatusBarVisibility();
        }
      }
    }
 else {
      tmpVisibility|=View.STATUS_BAR_OVERLAY;
      if ((mLastSystemUiFlags & View.STATUS_BAR_OVERLAY) == 0) {
        mStatusBar.showLw(true);
      }
    }
  }
  final int visibility=tmpVisibility;
  int diff=visibility ^ mLastSystemUiFlags;
  final boolean needsMenu=mFocusedWindow.getNeedsMenuLw(mTopFullscreenOpaqueWindowState);
  if (diff == 0 && mLastFocusNeedsMenu == needsMenu && mFocusedApp == mFocusedWindow.getAppToken()) {
    return 0;
  }
  mLastSystemUiFlags=visibility;
  mLastFocusNeedsMenu=needsMenu;
  mFocusedApp=mFocusedWindow.getAppToken();
  mHandler.post(new Runnable(){
    public void run(){
      try {
        IStatusBarService statusbar=getStatusBarService();
        if (statusbar != null) {
          statusbar.setSystemUiVisibility(visibility,0xffffffff);
          statusbar.topAppWindowChanged(needsMenu);
        }
      }
 catch (      RemoteException e) {
        mStatusBarService=null;
      }
    }
  }
);
  return diff;
}
