{
  if (mFocusedWindow == null) {
    return 0;
  }
  final int visibility=mFocusedWindow.getSystemUiVisibility() & ~mForceClearingStatusBarVisibility;
  int diff=visibility ^ mLastSystemUiVisibility;
  if (diff == 0) {
    return 0;
  }
  mLastSystemUiVisibility=visibility;
  mHandler.post(new Runnable(){
    public void run(){
      if (mStatusBarService == null) {
        mStatusBarService=IStatusBarService.Stub.asInterface(ServiceManager.getService("statusbar"));
      }
      if (mStatusBarService != null) {
        try {
          mStatusBarService.setSystemUiVisibility(visibility);
        }
 catch (        RemoteException e) {
          mStatusBarService=null;
        }
      }
    }
  }
);
  return diff;
}
