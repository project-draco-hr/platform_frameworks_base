{
  if (OverlayTesting.enabled) {
    tmpVisibility=OverlayTesting.applyForced(mFocusedWindow,tmpVisibility);
  }
  boolean statusBarHasFocus=mFocusedWindow.getAttrs().type == TYPE_STATUS_BAR;
  if (statusBarHasFocus) {
    int flags=View.SYSTEM_UI_FLAG_FULLSCREEN | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION | View.SYSTEM_UI_FLAG_ALLOW_OVERLAY;
    tmpVisibility=(tmpVisibility & ~flags) | (mLastSystemUiFlags & flags);
  }
  boolean overlayAllowed=(tmpVisibility & View.SYSTEM_UI_FLAG_ALLOW_OVERLAY) != 0;
  if (mStatusHideybar == HIDEYBAR_SHOWING) {
    boolean hideStatusBarWM=(mFocusedWindow.getAttrs().flags & WindowManager.LayoutParams.FLAG_FULLSCREEN) != 0;
    boolean hideStatusBarSysui=(tmpVisibility & View.SYSTEM_UI_FLAG_FULLSCREEN) != 0;
    boolean statusHideyAllowed=hideStatusBarWM || (hideStatusBarSysui && overlayAllowed) || statusBarHasFocus;
    if (mStatusBar == null || !statusHideyAllowed) {
      mStatusHideybar=HIDEYBAR_NONE;
      if (mStatusBar != null && hideStatusBarSysui) {
        int newVal=mResettingSystemUiFlags | View.SYSTEM_UI_CLEARABLE_FLAGS;
        if (newVal != mResettingSystemUiFlags) {
          mResettingSystemUiFlags=newVal;
          mWindowManagerFuncs.reevaluateStatusBarVisibility();
        }
      }
    }
 else {
      tmpVisibility|=View.STATUS_BAR_OVERLAY;
      if ((mLastSystemUiFlags & View.STATUS_BAR_OVERLAY) == 0) {
        tmpVisibility&=~View.SYSTEM_UI_FLAG_LOW_PROFILE;
        setBarShowingLw(mStatusBar,true);
      }
    }
  }
  if (mNavigationHideybar == HIDEYBAR_SHOWING) {
    boolean hideNavigationBarSysui=(tmpVisibility & View.SYSTEM_UI_FLAG_HIDE_NAVIGATION) != 0;
    boolean navigationHideyAllowed=hideNavigationBarSysui && overlayAllowed && mNavigationBar != null;
    if (!navigationHideyAllowed) {
      mNavigationHideybar=HIDEYBAR_NONE;
    }
 else {
      tmpVisibility|=View.NAVIGATION_BAR_OVERLAY;
      if ((mLastSystemUiFlags & View.NAVIGATION_BAR_OVERLAY) == 0) {
        tmpVisibility&=~View.SYSTEM_UI_FLAG_LOW_PROFILE;
        setBarShowingLw(mNavigationBar,true);
      }
    }
  }
  return tmpVisibility;
}
