{
  ContentResolver resolver=mContext.getContentResolver();
  boolean updateRotation=false;
  View addView=null;
  View removeView=null;
synchronized (mLock) {
    mEndcallBehavior=Settings.System.getInt(resolver,Settings.System.END_BUTTON_BEHAVIOR,Settings.System.END_BUTTON_BEHAVIOR_DEFAULT);
    mIncallPowerBehavior=Settings.Secure.getInt(resolver,Settings.Secure.INCALL_POWER_BUTTON_BEHAVIOR,Settings.Secure.INCALL_POWER_BUTTON_BEHAVIOR_DEFAULT);
    int accelerometerDefault=Settings.System.getInt(resolver,Settings.System.ACCELEROMETER_ROTATION,DEFAULT_ACCELEROMETER_ROTATION);
    mUserRotationMode=(accelerometerDefault == 0) ? WindowManagerPolicy.USER_ROTATION_LOCKED : WindowManagerPolicy.USER_ROTATION_FREE;
    mUserRotation=Settings.System.getInt(resolver,Settings.System.USER_ROTATION,Surface.ROTATION_0);
    if (mAccelerometerDefault != accelerometerDefault) {
      mAccelerometerDefault=accelerometerDefault;
      updateOrientationListenerLp();
    }
    mOrientationListener.setLogEnabled(Settings.System.getInt(resolver,Settings.System.WINDOW_ORIENTATION_LISTENER_LOG,0) != 0);
    if (mSystemReady) {
      int pointerLocation=Settings.System.getInt(resolver,Settings.System.POINTER_LOCATION,0);
      if (mPointerLocationMode != pointerLocation) {
        mPointerLocationMode=pointerLocation;
        if (pointerLocation != 0) {
          if (mPointerLocationView == null) {
            mPointerLocationView=new PointerLocationView(mContext);
            mPointerLocationView.setPrintCoords(false);
            addView=mPointerLocationView;
          }
        }
 else {
          removeView=mPointerLocationView;
          mPointerLocationView=null;
        }
      }
    }
    mLockScreenTimeout=Settings.System.getInt(resolver,Settings.System.SCREEN_OFF_TIMEOUT,0);
    String imId=Settings.Secure.getString(resolver,Settings.Secure.DEFAULT_INPUT_METHOD);
    boolean hasSoftInput=imId != null && imId.length() > 0;
    if (mHasSoftInput != hasSoftInput) {
      mHasSoftInput=hasSoftInput;
      updateRotation=true;
    }
    mScreenSaverEnabledByUser=0 != Settings.Secure.getInt(resolver,Settings.Secure.SCREENSAVER_ENABLED,1);
    if (SEPARATE_TIMEOUT_FOR_SCREEN_SAVER) {
      mScreenSaverTimeout=Settings.Secure.getInt(resolver,"screensaver_timeout",0);
    }
 else {
      mScreenSaverTimeout=Settings.System.getInt(resolver,Settings.System.SCREEN_OFF_TIMEOUT,0);
      if (mScreenSaverTimeout > 0) {
        mScreenSaverTimeout-=5000;
      }
    }
    updateScreenSaverTimeoutLocked();
  }
  if (updateRotation) {
    updateRotation(true);
  }
  if (addView != null) {
    WindowManager.LayoutParams lp=new WindowManager.LayoutParams(WindowManager.LayoutParams.MATCH_PARENT,WindowManager.LayoutParams.MATCH_PARENT);
    lp.type=WindowManager.LayoutParams.TYPE_SECURE_SYSTEM_OVERLAY;
    lp.flags=WindowManager.LayoutParams.FLAG_FULLSCREEN | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE| WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;
    lp.format=PixelFormat.TRANSLUCENT;
    lp.setTitle("PointerLocation");
    WindowManager wm=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
    lp.inputFeatures|=WindowManager.LayoutParams.INPUT_FEATURE_NO_INPUT_CHANNEL;
    wm.addView(addView,lp);
    if (mPointerLocationInputChannel == null) {
      try {
        mPointerLocationInputChannel=mWindowManager.monitorInput("PointerLocationView");
        mPointerLocationInputEventReceiver=new PointerLocationInputEventReceiver(mPointerLocationInputChannel,mHandler.getLooper());
      }
 catch (      RemoteException ex) {
        Slog.e(TAG,"Could not set up input monitoring channel for PointerLocation.",ex);
      }
    }
  }
  if (removeView != null) {
    if (mPointerLocationInputEventReceiver != null) {
      mPointerLocationInputEventReceiver.dispose();
      mPointerLocationInputEventReceiver=null;
    }
    if (mPointerLocationInputChannel != null) {
      mPointerLocationInputChannel.dispose();
      mPointerLocationInputChannel=null;
    }
    WindowManager wm=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
    wm.removeView(removeView);
  }
}
