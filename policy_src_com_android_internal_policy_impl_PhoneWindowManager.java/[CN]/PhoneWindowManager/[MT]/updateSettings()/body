{
  ContentResolver resolver=mContext.getContentResolver();
  boolean updateRotation=false;
  View addView=null;
  View removeView=null;
synchronized (mLock) {
    mEndcallBehavior=Settings.System.getInt(resolver,Settings.System.END_BUTTON_BEHAVIOR,Settings.System.END_BUTTON_BEHAVIOR_DEFAULT);
    mIncallPowerBehavior=Settings.Secure.getInt(resolver,Settings.Secure.INCALL_POWER_BUTTON_BEHAVIOR,Settings.Secure.INCALL_POWER_BUTTON_BEHAVIOR_DEFAULT);
    mFancyRotationAnimation=Settings.System.getInt(resolver,"fancy_rotation_anim",0) != 0 ? 0x80 : 0;
    int accelerometerDefault=Settings.System.getInt(resolver,Settings.System.ACCELEROMETER_ROTATION,DEFAULT_ACCELEROMETER_ROTATION);
    mUserRotationMode=(mAccelerometerDefault == 0) ? WindowManagerPolicy.USER_ROTATION_LOCKED : WindowManagerPolicy.USER_ROTATION_FREE;
    mUserRotation=Settings.System.getInt(resolver,Settings.System.USER_ROTATION,Surface.ROTATION_0);
    if (mAccelerometerDefault != accelerometerDefault) {
      mAccelerometerDefault=accelerometerDefault;
      updateOrientationListenerLp();
    }
    if (mSystemReady) {
      int pointerLocation=Settings.System.getInt(resolver,Settings.System.POINTER_LOCATION,0);
      if (mPointerLocationMode != pointerLocation) {
        mPointerLocationMode=pointerLocation;
        if (pointerLocation != 0) {
          if (mPointerLocationView == null) {
            mPointerLocationView=new PointerLocationView(mContext);
            mPointerLocationView.setPrintCoords(false);
            addView=mPointerLocationView;
          }
        }
 else {
          removeView=mPointerLocationView;
          mPointerLocationView=null;
        }
      }
    }
    mLockScreenTimeout=Settings.System.getInt(resolver,Settings.System.SCREEN_OFF_TIMEOUT,0);
    String imId=Settings.Secure.getString(resolver,Settings.Secure.DEFAULT_INPUT_METHOD);
    boolean hasSoftInput=imId != null && imId.length() > 0;
    if (mHasSoftInput != hasSoftInput) {
      mHasSoftInput=hasSoftInput;
      updateRotation=true;
    }
  }
  if (updateRotation) {
    updateRotation(0);
  }
  if (addView != null) {
    WindowManager.LayoutParams lp=new WindowManager.LayoutParams(WindowManager.LayoutParams.MATCH_PARENT,WindowManager.LayoutParams.MATCH_PARENT);
    lp.type=WindowManager.LayoutParams.TYPE_SECURE_SYSTEM_OVERLAY;
    lp.flags=WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;
    lp.format=PixelFormat.TRANSLUCENT;
    lp.setTitle("PointerLocation");
    WindowManagerImpl wm=(WindowManagerImpl)mContext.getSystemService(Context.WINDOW_SERVICE);
    wm.addView(addView,lp);
    if (mPointerLocationInputChannel == null) {
      try {
        mPointerLocationInputChannel=mWindowManager.monitorInput("PointerLocationView");
        InputQueue.registerInputChannel(mPointerLocationInputChannel,mPointerLocationInputHandler,mHandler.getLooper().getQueue());
      }
 catch (      RemoteException ex) {
        Slog.e(TAG,"Could not set up input monitoring channel for PointerLocation.",ex);
      }
    }
  }
  if (removeView != null) {
    if (mPointerLocationInputChannel != null) {
      InputQueue.unregisterInputChannel(mPointerLocationInputChannel);
      mPointerLocationInputChannel.dispose();
      mPointerLocationInputChannel=null;
    }
    WindowManagerImpl wm=(WindowManagerImpl)mContext.getSystemService(Context.WINDOW_SERVICE);
    wm.removeView(removeView);
  }
}
