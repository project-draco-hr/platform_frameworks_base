{
  final boolean keyguardOn=keyguardOn();
  final int keyCode=event.getKeyCode();
  final int repeatCount=event.getRepeatCount();
  final int metaState=event.getMetaState();
  final int flags=event.getFlags();
  final boolean down=event.getAction() == KeyEvent.ACTION_DOWN;
  final boolean canceled=event.isCanceled();
  if (DEBUG_INPUT) {
    Log.d(TAG,"interceptKeyTi keyCode=" + keyCode + " down="+ down+ " repeatCount="+ repeatCount+ " keyguardOn="+ keyguardOn+ " mHomePressed="+ mHomePressed+ " canceled="+ canceled);
  }
  if (mScreenshotChordEnabled && (flags & KeyEvent.FLAG_FALLBACK) == 0) {
    if (mVolumeDownKeyTriggered && !mPowerKeyTriggered) {
      final long now=SystemClock.uptimeMillis();
      final long timeoutTime=mVolumeDownKeyTime + SCREENSHOT_CHORD_DEBOUNCE_DELAY_MILLIS;
      if (now < timeoutTime) {
        return timeoutTime - now;
      }
    }
    if (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN && mVolumeDownKeyConsumedByScreenshotChord) {
      if (!down) {
        mVolumeDownKeyConsumedByScreenshotChord=false;
      }
      return -1;
    }
  }
  if (keyCode == KeyEvent.KEYCODE_HOME) {
    if (!down) {
      final boolean homeWasLongPressed=mHomeLongPressed;
      mHomePressed=false;
      mHomeLongPressed=false;
      if (!homeWasLongPressed) {
        try {
          mStatusBarService.cancelPreloadRecentApps();
        }
 catch (        RemoteException e) {
          Slog.e(TAG,"RemoteException when showing recent apps",e);
        }
        mHomePressed=false;
        if (!canceled) {
          boolean incomingRinging=false;
          try {
            ITelephony telephonyService=getTelephonyService();
            if (telephonyService != null) {
              incomingRinging=telephonyService.isRinging();
            }
          }
 catch (          RemoteException ex) {
            Log.w(TAG,"RemoteException from getPhoneInterface()",ex);
          }
          if (incomingRinging) {
            Log.i(TAG,"Ignoring HOME; there's a ringing incoming call.");
          }
 else {
            launchHomeFromHotKey();
          }
        }
 else {
          Log.i(TAG,"Ignoring HOME; event canceled.");
        }
        return -1;
      }
    }
    WindowManager.LayoutParams attrs=win != null ? win.getAttrs() : null;
    if (attrs != null) {
      final int type=attrs.type;
      if (type == WindowManager.LayoutParams.TYPE_KEYGUARD || type == WindowManager.LayoutParams.TYPE_KEYGUARD_DIALOG) {
        return 0;
      }
      final int typeCount=WINDOW_TYPES_WHERE_HOME_DOESNT_WORK.length;
      for (int i=0; i < typeCount; i++) {
        if (type == WINDOW_TYPES_WHERE_HOME_DOESNT_WORK[i]) {
          return -1;
        }
      }
    }
    if (down) {
      if (!mHomePressed) {
        try {
          mStatusBarService.preloadRecentApps();
        }
 catch (        RemoteException e) {
          Slog.e(TAG,"RemoteException when preloading recent apps",e);
        }
      }
      if (repeatCount == 0) {
        mHomePressed=true;
      }
 else       if ((event.getFlags() & KeyEvent.FLAG_LONG_PRESS) != 0) {
        if (!keyguardOn) {
          handleLongPressOnHome();
        }
      }
    }
    return -1;
  }
 else   if (keyCode == KeyEvent.KEYCODE_MENU) {
    final int chordBug=KeyEvent.META_SHIFT_ON;
    if (down && repeatCount == 0) {
      if (mEnableShiftMenuBugReports && (metaState & chordBug) == chordBug) {
        Intent intent=new Intent(Intent.ACTION_BUG_REPORT);
        mContext.sendOrderedBroadcast(intent,null);
        return -1;
      }
 else       if (SHOW_PROCESSES_ON_ALT_MENU && (metaState & KeyEvent.META_ALT_ON) == KeyEvent.META_ALT_ON) {
        Intent service=new Intent();
        service.setClassName(mContext,"com.android.server.LoadAverageService");
        ContentResolver res=mContext.getContentResolver();
        boolean shown=Settings.System.getInt(res,Settings.System.SHOW_PROCESSES,0) != 0;
        if (!shown) {
          mContext.startService(service);
        }
 else {
          mContext.stopService(service);
        }
        Settings.System.putInt(res,Settings.System.SHOW_PROCESSES,shown ? 0 : 1);
        return -1;
      }
    }
  }
 else   if (keyCode == KeyEvent.KEYCODE_SEARCH) {
    if (down) {
      if (repeatCount == 0) {
        mSearchKeyShortcutPending=true;
        mConsumeSearchKeyUp=false;
      }
    }
 else {
      mSearchKeyShortcutPending=false;
      if (mConsumeSearchKeyUp) {
        mConsumeSearchKeyUp=false;
        return -1;
      }
    }
    return 0;
  }
 else   if (keyCode == KeyEvent.KEYCODE_APP_SWITCH) {
    if (down && repeatCount == 0 && !keyguardOn) {
      showOrHideRecentAppsDialog(RECENT_APPS_BEHAVIOR_SHOW_OR_DISMISS);
    }
    return -1;
  }
  if (mSearchKeyShortcutPending) {
    final KeyCharacterMap kcm=event.getKeyCharacterMap();
    if (kcm.isPrintingKey(keyCode)) {
      mConsumeSearchKeyUp=true;
      mSearchKeyShortcutPending=false;
      if (down && repeatCount == 0 && !keyguardOn) {
        Intent shortcutIntent=mShortcutManager.getIntent(kcm,keyCode,metaState);
        if (shortcutIntent != null) {
          shortcutIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
          try {
            mContext.startActivity(shortcutIntent);
          }
 catch (          ActivityNotFoundException ex) {
            Slog.w(TAG,"Dropping shortcut key combination because " + "the activity to which it is registered was not found: " + "SEARCH+"+ KeyEvent.keyCodeToString(keyCode),ex);
          }
        }
 else {
          Slog.i(TAG,"Dropping unregistered shortcut key combination: " + "SEARCH+" + KeyEvent.keyCodeToString(keyCode));
        }
      }
      return -1;
    }
  }
  if (down && repeatCount == 0 && !keyguardOn && (metaState & KeyEvent.META_META_ON) != 0) {
    final KeyCharacterMap kcm=event.getKeyCharacterMap();
    if (kcm.isPrintingKey(keyCode)) {
      Intent shortcutIntent=mShortcutManager.getIntent(kcm,keyCode,metaState & ~(KeyEvent.META_META_ON | KeyEvent.META_META_LEFT_ON | KeyEvent.META_META_RIGHT_ON));
      if (shortcutIntent != null) {
        shortcutIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        try {
          mContext.startActivity(shortcutIntent);
        }
 catch (        ActivityNotFoundException ex) {
          Slog.w(TAG,"Dropping shortcut key combination because " + "the activity to which it is registered was not found: " + "META+"+ KeyEvent.keyCodeToString(keyCode),ex);
        }
        return -1;
      }
    }
  }
  if (down && repeatCount == 0 && !keyguardOn) {
    String category=sApplicationLaunchKeyCategories.get(keyCode);
    if (category != null) {
      Intent intent=Intent.makeMainSelectorActivity(Intent.ACTION_MAIN,category);
      intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
      try {
        mContext.startActivity(intent);
      }
 catch (      ActivityNotFoundException ex) {
        Slog.w(TAG,"Dropping application launch key because " + "the activity to which it is registered was not found: " + "keyCode=" + keyCode + ", category="+ category,ex);
      }
      return -1;
    }
  }
  if (down && repeatCount == 0 && keyCode == KeyEvent.KEYCODE_TAB) {
    if (mRecentAppsDialogHeldModifiers == 0 && !keyguardOn) {
      final int shiftlessModifiers=event.getModifiers() & ~KeyEvent.META_SHIFT_MASK;
      if (KeyEvent.metaStateHasModifiers(shiftlessModifiers,KeyEvent.META_ALT_ON) || KeyEvent.metaStateHasModifiers(shiftlessModifiers,KeyEvent.META_META_ON)) {
        mRecentAppsDialogHeldModifiers=shiftlessModifiers;
        showOrHideRecentAppsDialog(RECENT_APPS_BEHAVIOR_EXIT_TOUCH_MODE_AND_SHOW);
        return -1;
      }
    }
  }
 else   if (!down && mRecentAppsDialogHeldModifiers != 0 && (metaState & mRecentAppsDialogHeldModifiers) == 0) {
    mRecentAppsDialogHeldModifiers=0;
    showOrHideRecentAppsDialog(keyguardOn ? RECENT_APPS_BEHAVIOR_DISMISS : RECENT_APPS_BEHAVIOR_DISMISS_AND_SWITCH);
  }
  if (down && repeatCount == 0 && (keyCode == KeyEvent.KEYCODE_LANGUAGE_SWITCH || (keyCode == KeyEvent.KEYCODE_SPACE && (metaState & KeyEvent.META_CTRL_MASK) != 0))) {
    int direction=(metaState & KeyEvent.META_SHIFT_MASK) != 0 ? -1 : 1;
    mWindowManagerFuncs.switchKeyboardLayout(event.getDeviceId(),direction);
    return -1;
  }
  if (mLanguageSwitchKeyPressed && !down && (keyCode == KeyEvent.KEYCODE_LANGUAGE_SWITCH || keyCode == KeyEvent.KEYCODE_SPACE)) {
    mLanguageSwitchKeyPressed=false;
    return -1;
  }
  return 0;
}
