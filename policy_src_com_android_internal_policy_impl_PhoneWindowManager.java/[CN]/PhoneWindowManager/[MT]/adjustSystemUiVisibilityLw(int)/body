{
  if (mStatusBar != null && mStatusTransientBar == TRANSIENT_BAR_SHOWING && 0 == (visibility & View.STATUS_BAR_TRANSIENT)) {
    mStatusTransientBar=TRANSIENT_BAR_HIDING;
    setBarShowingLw(mStatusBar,false);
  }
  if (mNavigationBar != null && mNavigationTransientBar == TRANSIENT_BAR_SHOWING && 0 == (visibility & View.NAVIGATION_BAR_TRANSIENT)) {
    mNavigationTransientBar=TRANSIENT_BAR_HIDING;
    setBarShowingLw(mNavigationBar,false);
  }
  mResettingSystemUiFlags&=visibility;
  return visibility & ~mResettingSystemUiFlags & ~mForceClearedSystemUiFlags;
}
