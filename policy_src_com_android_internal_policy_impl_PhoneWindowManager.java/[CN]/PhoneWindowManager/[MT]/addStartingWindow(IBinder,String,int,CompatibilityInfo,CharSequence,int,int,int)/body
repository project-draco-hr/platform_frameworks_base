{
  if (!SHOW_STARTING_ANIMATIONS) {
    return null;
  }
  if (packageName == null) {
    return null;
  }
  try {
    Context context=mContext;
    if (DEBUG_STARTING_WINDOW)     Slog.d(TAG,"addStartingWindow " + packageName + ": nonLocalizedLabel="+ nonLocalizedLabel+ " theme="+ Integer.toHexString(theme));
    if (theme != context.getThemeResId() || labelRes != 0) {
      try {
        context=context.createPackageContext(packageName,0);
        context.setTheme(theme);
      }
 catch (      PackageManager.NameNotFoundException e) {
      }
    }
    Window win=PolicyManager.makeNewWindow(context);
    final TypedArray ta=win.getWindowStyle();
    if (ta.getBoolean(com.android.internal.R.styleable.Window_windowDisablePreview,false) || ta.getBoolean(com.android.internal.R.styleable.Window_windowShowWallpaper,false)) {
      return null;
    }
    Resources r=context.getResources();
    win.setTitle(r.getText(labelRes,nonLocalizedLabel));
    win.setType(WindowManager.LayoutParams.TYPE_APPLICATION_STARTING);
    win.setFlags(windowFlags | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE| WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM,windowFlags | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE| WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM);
    if (!compatInfo.supportsScreen()) {
      win.addFlags(WindowManager.LayoutParams.FLAG_COMPATIBLE_WINDOW);
    }
    win.setLayout(WindowManager.LayoutParams.MATCH_PARENT,WindowManager.LayoutParams.MATCH_PARENT);
    final WindowManager.LayoutParams params=win.getAttributes();
    params.token=appToken;
    params.packageName=packageName;
    params.windowAnimations=win.getWindowStyle().getResourceId(com.android.internal.R.styleable.Window_windowAnimationStyle,0);
    params.privateFlags|=WindowManager.LayoutParams.PRIVATE_FLAG_FAKE_HARDWARE_ACCELERATED;
    params.privateFlags|=WindowManager.LayoutParams.PRIVATE_FLAG_SHOW_FOR_ALL_USERS;
    params.setTitle("Starting " + packageName);
    WindowManager wm=(WindowManager)context.getSystemService(Context.WINDOW_SERVICE);
    View view=win.getDecorView();
    if (win.isFloating()) {
      return null;
    }
    if (DEBUG_STARTING_WINDOW)     Slog.d(TAG,"Adding starting window for " + packageName + " / "+ appToken+ ": "+ (view.getParent() != null ? view : null));
    wm.addView(view,params);
    return view.getParent() != null ? view : null;
  }
 catch (  WindowManager.BadTokenException e) {
    Log.w(TAG,appToken + " already running, starting window not displayed");
  }
catch (  RuntimeException e) {
    Log.w(TAG,appToken + " failed creating starting window",e);
  }
  return null;
}
