{
  if (mUserRotationMode == WindowManagerPolicy.USER_ROTATION_LOCKED) {
    if (isAnyPortrait(mUserRotation)) {
      return mUserRotation;
    }
 else {
      return mPortraitRotation;
    }
  }
  int sensorRotation=mOrientationListener.getCurrentRotation(lastRotation);
  if (isAnyPortrait(sensorRotation)) {
    return sensorRotation;
  }
  if (isAnyPortrait(lastRotation)) {
    return lastRotation;
  }
  return mPortraitRotation;
}
