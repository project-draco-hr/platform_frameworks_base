{
  if (mPortraitRotation < 0) {
    Display d=((WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();
    if (d.getWidth() > d.getHeight()) {
      mPortraitRotation=Surface.ROTATION_90;
      mLandscapeRotation=Surface.ROTATION_0;
    }
 else {
      mPortraitRotation=Surface.ROTATION_0;
      mLandscapeRotation=Surface.ROTATION_90;
    }
  }
synchronized (mLock) {
switch (orientation) {
case ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE:
      return mLandscapeRotation;
case ActivityInfo.SCREEN_ORIENTATION_PORTRAIT:
    return mPortraitRotation;
}
if (mLidOpen) {
  return mLidOpenRotation;
}
 else if (mDockMode == Intent.EXTRA_DOCK_STATE_CAR && mCarDockRotation >= 0) {
  return mCarDockRotation;
}
 else if (mDockMode == Intent.EXTRA_DOCK_STATE_DESK && mDeskDockRotation >= 0) {
  return mDeskDockRotation;
}
 else {
  if (useSensorForOrientationLp(orientation)) {
    return mOrientationListener.getCurrentRotation(lastRotation);
  }
  return Surface.ROTATION_0;
}
}
}
