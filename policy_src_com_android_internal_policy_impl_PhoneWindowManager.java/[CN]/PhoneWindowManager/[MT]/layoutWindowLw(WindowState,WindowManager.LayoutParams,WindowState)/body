{
  if (win == mStatusBar || win == mNavigationBar) {
    return;
  }
  final boolean isDefaultDisplay=win.isDefaultDisplay();
  final boolean needsToOffsetInputMethodTarget=isDefaultDisplay && (win == mLastInputMethodTargetWindow && mLastInputMethodWindow != null);
  if (needsToOffsetInputMethodTarget) {
    if (DEBUG_LAYOUT) {
      Slog.i(TAG,"Offset ime target window by the last ime window state");
    }
    offsetInputMethodWindowLw(mLastInputMethodWindow);
  }
  final int fl=attrs.flags;
  final int sim=attrs.softInputMode;
  final int sysUiFl=win.getSystemUiVisibility();
  final Rect pf=mTmpParentFrame;
  final Rect df=mTmpDisplayFrame;
  final Rect cf=mTmpContentFrame;
  final Rect vf=mTmpVisibleFrame;
  final boolean hasNavBar=(isDefaultDisplay && mHasNavigationBar && mNavigationBar != null && mNavigationBar.isVisibleLw());
  final int adjust=sim & SOFT_INPUT_MASK_ADJUST;
  if (!isDefaultDisplay) {
    if (attached != null) {
      setAttachedWindowFrames(win,fl,adjust,attached,true,pf,df,cf,vf);
    }
 else {
      pf.left=df.left=cf.left=mUnrestrictedScreenLeft;
      pf.top=df.top=cf.top=mUnrestrictedScreenTop;
      pf.right=df.right=cf.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
      pf.bottom=df.bottom=cf.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
    }
  }
 else   if (attrs.type == TYPE_INPUT_METHOD) {
    pf.left=df.left=cf.left=vf.left=mDockLeft;
    pf.top=df.top=cf.top=vf.top=mDockTop;
    pf.right=df.right=cf.right=vf.right=mDockRight;
    pf.bottom=df.bottom=cf.bottom=vf.bottom=mDockBottom;
    attrs.gravity=Gravity.BOTTOM;
    mDockLayer=win.getSurfaceLayer();
  }
 else {
    if ((fl & (FLAG_LAYOUT_IN_SCREEN | FLAG_FULLSCREEN | FLAG_LAYOUT_INSET_DECOR)) == (FLAG_LAYOUT_IN_SCREEN | FLAG_LAYOUT_INSET_DECOR) && (sysUiFl & View.SYSTEM_UI_FLAG_FULLSCREEN) == 0) {
      if (DEBUG_LAYOUT)       Log.v(TAG,"layoutWindowLw(" + attrs.getTitle() + "): IN_SCREEN, INSET_DECOR, !FULLSCREEN");
      if (attached != null) {
        setAttachedWindowFrames(win,fl,adjust,attached,true,pf,df,cf,vf);
      }
 else {
        if (attrs.type == TYPE_STATUS_BAR_PANEL || attrs.type == TYPE_STATUS_BAR_SUB_PANEL) {
          pf.left=df.left=hasNavBar ? mDockLeft : mUnrestrictedScreenLeft;
          pf.top=df.top=mUnrestrictedScreenTop;
          pf.right=df.right=hasNavBar ? mRestrictedScreenLeft + mRestrictedScreenWidth : mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
          pf.bottom=df.bottom=hasNavBar ? mRestrictedScreenTop + mRestrictedScreenHeight : mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
          if (DEBUG_LAYOUT) {
            Log.v(TAG,String.format("Laying out status bar window: (%d,%d - %d,%d)",pf.left,pf.top,pf.right,pf.bottom));
          }
        }
 else         if (mCanHideNavigationBar && (sysUiFl & View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION) != 0 && attrs.type >= WindowManager.LayoutParams.FIRST_APPLICATION_WINDOW && attrs.type <= WindowManager.LayoutParams.LAST_SUB_WINDOW) {
          pf.left=df.left=mUnrestrictedScreenLeft;
          pf.top=df.top=mUnrestrictedScreenTop;
          pf.right=df.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
          pf.bottom=df.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
        }
 else {
          pf.left=df.left=mRestrictedScreenLeft;
          pf.top=df.top=mRestrictedScreenTop;
          pf.right=df.right=mRestrictedScreenLeft + mRestrictedScreenWidth;
          pf.bottom=df.bottom=mRestrictedScreenTop + mRestrictedScreenHeight;
        }
        if (adjust != SOFT_INPUT_ADJUST_RESIZE) {
          cf.left=mDockLeft;
          cf.top=mDockTop;
          cf.right=mDockRight;
          cf.bottom=mDockBottom;
        }
 else {
          cf.left=mContentLeft;
          cf.top=mContentTop;
          cf.right=mContentRight;
          cf.bottom=mContentBottom;
        }
        applyStableConstraints(sysUiFl,fl,cf);
        if (adjust != SOFT_INPUT_ADJUST_NOTHING) {
          vf.left=mCurLeft;
          vf.top=mCurTop;
          vf.right=mCurRight;
          vf.bottom=mCurBottom;
        }
 else {
          vf.set(cf);
        }
      }
    }
 else     if ((fl & FLAG_LAYOUT_IN_SCREEN) != 0 || (sysUiFl & (View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION)) != 0) {
      if (DEBUG_LAYOUT)       Log.v(TAG,"layoutWindowLw(" + attrs.getTitle() + "): IN_SCREEN");
      if (attrs.type == TYPE_STATUS_BAR_PANEL || attrs.type == TYPE_STATUS_BAR_SUB_PANEL) {
        pf.left=df.left=cf.left=hasNavBar ? mDockLeft : mUnrestrictedScreenLeft;
        pf.top=df.top=cf.top=mUnrestrictedScreenTop;
        pf.right=df.right=cf.right=hasNavBar ? mRestrictedScreenLeft + mRestrictedScreenWidth : mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
        pf.bottom=df.bottom=cf.bottom=hasNavBar ? mRestrictedScreenTop + mRestrictedScreenHeight : mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
        if (DEBUG_LAYOUT) {
          Log.v(TAG,String.format("Laying out IN_SCREEN status bar window: (%d,%d - %d,%d)",pf.left,pf.top,pf.right,pf.bottom));
        }
      }
 else       if (attrs.type == TYPE_NAVIGATION_BAR || attrs.type == TYPE_NAVIGATION_BAR_PANEL) {
        pf.left=df.left=mUnrestrictedScreenLeft;
        pf.top=df.top=mUnrestrictedScreenTop;
        pf.right=df.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
        pf.bottom=df.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
        if (DEBUG_LAYOUT) {
          Log.v(TAG,String.format("Laying out navigation bar window: (%d,%d - %d,%d)",pf.left,pf.top,pf.right,pf.bottom));
        }
      }
 else       if ((attrs.type == TYPE_SECURE_SYSTEM_OVERLAY || attrs.type == TYPE_BOOT_PROGRESS) && ((fl & FLAG_FULLSCREEN) != 0)) {
        pf.left=df.left=mUnrestrictedScreenLeft;
        pf.top=df.top=mUnrestrictedScreenTop;
        pf.right=df.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
        pf.bottom=df.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
      }
 else       if (attrs.type == TYPE_BOOT_PROGRESS || attrs.type == TYPE_UNIVERSE_BACKGROUND) {
        pf.left=df.left=cf.left=mUnrestrictedScreenLeft;
        pf.top=df.top=cf.top=mUnrestrictedScreenTop;
        pf.right=df.right=cf.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
        pf.bottom=df.bottom=cf.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
      }
 else       if (mCanHideNavigationBar && (sysUiFl & View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION) != 0 && attrs.type >= WindowManager.LayoutParams.FIRST_APPLICATION_WINDOW && attrs.type <= WindowManager.LayoutParams.LAST_SUB_WINDOW) {
        pf.left=df.left=cf.left=mUnrestrictedScreenLeft;
        pf.top=df.top=cf.top=mUnrestrictedScreenTop;
        pf.right=df.right=cf.right=mUnrestrictedScreenLeft + mUnrestrictedScreenWidth;
        pf.bottom=df.bottom=cf.bottom=mUnrestrictedScreenTop + mUnrestrictedScreenHeight;
      }
 else {
        pf.left=df.left=cf.left=mRestrictedScreenLeft;
        pf.top=df.top=cf.top=mRestrictedScreenTop;
        pf.right=df.right=cf.right=mRestrictedScreenLeft + mRestrictedScreenWidth;
        pf.bottom=df.bottom=cf.bottom=mRestrictedScreenTop + mRestrictedScreenHeight;
      }
      applyStableConstraints(sysUiFl,fl,cf);
      if (adjust != SOFT_INPUT_ADJUST_NOTHING) {
        vf.left=mCurLeft;
        vf.top=mCurTop;
        vf.right=mCurRight;
        vf.bottom=mCurBottom;
      }
 else {
        vf.set(cf);
      }
    }
 else     if (attached != null) {
      if (DEBUG_LAYOUT)       Log.v(TAG,"layoutWindowLw(" + attrs.getTitle() + "): attached to "+ attached);
      setAttachedWindowFrames(win,fl,adjust,attached,false,pf,df,cf,vf);
    }
 else {
      if (DEBUG_LAYOUT)       Log.v(TAG,"layoutWindowLw(" + attrs.getTitle() + "): normal window");
      if (attrs.type == TYPE_STATUS_BAR_PANEL) {
        pf.left=df.left=cf.left=mRestrictedScreenLeft;
        pf.top=df.top=cf.top=mRestrictedScreenTop;
        pf.right=df.right=cf.right=mRestrictedScreenLeft + mRestrictedScreenWidth;
        pf.bottom=df.bottom=cf.bottom=mRestrictedScreenTop + mRestrictedScreenHeight;
      }
 else {
        pf.left=mContentLeft;
        pf.top=mContentTop;
        pf.right=mContentRight;
        pf.bottom=mContentBottom;
        if (adjust != SOFT_INPUT_ADJUST_RESIZE) {
          df.left=cf.left=mDockLeft;
          df.top=cf.top=mDockTop;
          df.right=cf.right=mDockRight;
          df.bottom=cf.bottom=mDockBottom;
        }
 else {
          df.left=cf.left=mContentLeft;
          df.top=cf.top=mContentTop;
          df.right=cf.right=mContentRight;
          df.bottom=cf.bottom=mContentBottom;
        }
        if (adjust != SOFT_INPUT_ADJUST_NOTHING) {
          vf.left=mCurLeft;
          vf.top=mCurTop;
          vf.right=mCurRight;
          vf.bottom=mCurBottom;
        }
 else {
          vf.set(cf);
        }
      }
    }
  }
  if ((fl & FLAG_LAYOUT_NO_LIMITS) != 0) {
    df.left=df.top=cf.left=cf.top=vf.left=vf.top=-10000;
    df.right=df.bottom=cf.right=cf.bottom=vf.right=vf.bottom=10000;
  }
  if (DEBUG_LAYOUT)   Log.v(TAG,"Compute frame " + attrs.getTitle() + ": sim=#"+ Integer.toHexString(sim)+ " attach="+ attached+ " type="+ attrs.type+ String.format(" flags=0x%08x",fl)+ " pf="+ pf.toShortString()+ " df="+ df.toShortString()+ " cf="+ cf.toShortString()+ " vf="+ vf.toShortString());
  win.computeFrameLw(pf,df,cf,vf);
  if (attrs.type == TYPE_INPUT_METHOD && !win.getGivenInsetsPendingLw()) {
    setLastInputMethodWindowLw(null,null);
    offsetInputMethodWindowLw(win);
  }
}
