{
  if (false) {
    Slog.v(TAG,"rotationForOrientationLw(orient=" + orientation + ", last="+ lastRotation+ "); user="+ mUserRotation+ " "+ ((mUserRotationMode == WindowManagerPolicy.USER_ROTATION_LOCKED) ? "USER_ROTATION_LOCKED" : ""));
  }
synchronized (mLock) {
    int sensorRotation=mOrientationListener.getCurrentRotation();
    int preferredRotation=-1;
    if (mHdmiPlugged) {
      preferredRotation=mLandscapeRotation;
    }
 else     if (mLidOpen == LID_OPEN && mLidOpenRotation >= 0) {
      preferredRotation=mLidOpenRotation;
    }
 else     if (mDockMode == Intent.EXTRA_DOCK_STATE_CAR && ((mCarDockEnablesAccelerometer && sensorRotation >= 0) || mCarDockRotation >= 0)) {
      preferredRotation=mCarDockEnablesAccelerometer && sensorRotation >= 0 ? sensorRotation : mCarDockRotation;
    }
 else     if (mDockMode == Intent.EXTRA_DOCK_STATE_DESK && ((mDeskDockEnablesAccelerometer && sensorRotation >= 0) || mDeskDockRotation >= 0)) {
      preferredRotation=mDeskDockEnablesAccelerometer && sensorRotation >= 0 ? sensorRotation : mDeskDockRotation;
    }
 else     if (mUserRotationMode == WindowManagerPolicy.USER_ROTATION_LOCKED) {
      preferredRotation=mUserRotation;
    }
 else     if ((mAccelerometerDefault != 0 && (orientation == ActivityInfo.SCREEN_ORIENTATION_USER || orientation == ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED)) || orientation == ActivityInfo.SCREEN_ORIENTATION_SENSOR || orientation == ActivityInfo.SCREEN_ORIENTATION_FULL_SENSOR || orientation == ActivityInfo.SCREEN_ORIENTATION_SENSOR_LANDSCAPE || orientation == ActivityInfo.SCREEN_ORIENTATION_SENSOR_PORTRAIT) {
      if (mAllowAllRotations < 0) {
        mAllowAllRotations=mContext.getResources().getBoolean(com.android.internal.R.bool.config_allowAllRotations) ? 1 : 0;
      }
      if (sensorRotation != Surface.ROTATION_180 || mAllowAllRotations == 1 || orientation == ActivityInfo.SCREEN_ORIENTATION_FULL_SENSOR) {
        preferredRotation=sensorRotation;
      }
 else {
        preferredRotation=lastRotation;
      }
    }
switch (orientation) {
case ActivityInfo.SCREEN_ORIENTATION_PORTRAIT:
      return mPortraitRotation;
case ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE:
    return mLandscapeRotation;
case ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT:
  return mUpsideDownRotation;
case ActivityInfo.SCREEN_ORIENTATION_REVERSE_LANDSCAPE:
return mSeascapeRotation;
case ActivityInfo.SCREEN_ORIENTATION_SENSOR_LANDSCAPE:
if (isLandscapeOrSeascape(preferredRotation)) {
return preferredRotation;
}
if (isLandscapeOrSeascape(lastRotation)) {
return lastRotation;
}
return mLandscapeRotation;
case ActivityInfo.SCREEN_ORIENTATION_SENSOR_PORTRAIT:
if (isAnyPortrait(preferredRotation)) {
return preferredRotation;
}
if (isAnyPortrait(lastRotation)) {
return lastRotation;
}
return mPortraitRotation;
default :
if (preferredRotation >= 0) {
return preferredRotation;
}
return Surface.ROTATION_0;
}
}
}
