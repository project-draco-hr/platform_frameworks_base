{
  boolean overlap=true;
  if (enterTransition != null && exitTransition != null) {
    overlap=isBack ? inFragment.getAllowReturnTransitionOverlap() : inFragment.getAllowEnterTransitionOverlap();
  }
  Transition transition;
  if (overlap) {
    transition=TransitionUtils.mergeTransitions(enterTransition,exitTransition,sharedElementTransition);
  }
 else {
    TransitionSet staggered=new TransitionSet().addTransition(exitTransition).addTransition(enterTransition).setOrdering(TransitionSet.ORDERING_SEQUENTIAL);
    transition=TransitionUtils.mergeTransitions(staggered,sharedElementTransition);
  }
  return transition;
}
