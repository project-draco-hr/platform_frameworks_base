{
  if (mCommitted)   throw new IllegalStateException("commit already called");
  if (FragmentManagerImpl.DEBUG) {
    Log.v(TAG,"Commit: " + this);
    LogWriter logw=new LogWriter(Log.VERBOSE,TAG);
    PrintWriter pw=new PrintWriter(logw);
    dump("  ",null,pw,null);
  }
  mCommitted=true;
  if (mAddToBackStack) {
    mIndex=mManager.allocBackStackIndex(this);
  }
 else {
    mIndex=-1;
  }
  mManager.enqueueAction(this,allowStateLoss);
  return mIndex;
}
