{
  if (LOGV)   Slog.v(TAG,"readPolicyLocked()");
  mNetworkPolicy.clear();
  mUidPolicy.clear();
  FileInputStream fis=null;
  try {
    fis=mPolicyFile.openRead();
    final XmlPullParser in=Xml.newPullParser();
    in.setInput(fis,null);
    int type;
    int version=VERSION_INIT;
    while ((type=in.next()) != END_DOCUMENT) {
      final String tag=in.getName();
      if (type == START_TAG) {
        if (TAG_POLICY_LIST.equals(tag)) {
          version=readIntAttribute(in,ATTR_VERSION);
        }
 else         if (TAG_NETWORK_POLICY.equals(tag)) {
          final int networkTemplate=readIntAttribute(in,ATTR_NETWORK_TEMPLATE);
          final String subscriberId=in.getAttributeValue(null,ATTR_SUBSCRIBER_ID);
          final int cycleDay=readIntAttribute(in,ATTR_CYCLE_DAY);
          final long warningBytes=readLongAttribute(in,ATTR_WARNING_BYTES);
          final long limitBytes=readLongAttribute(in,ATTR_LIMIT_BYTES);
          final long lastSnooze;
          if (version >= VERSION_ADDED_SNOOZE) {
            lastSnooze=readLongAttribute(in,ATTR_LAST_SNOOZE);
          }
 else {
            lastSnooze=SNOOZE_NEVER;
          }
          final NetworkTemplate template=new NetworkTemplate(networkTemplate,subscriberId);
          mNetworkPolicy.put(template,new NetworkPolicy(template,cycleDay,warningBytes,limitBytes,lastSnooze));
        }
 else         if (TAG_UID_POLICY.equals(tag)) {
          final int uid=readIntAttribute(in,ATTR_UID);
          final int policy=readIntAttribute(in,ATTR_POLICY);
          if (isUidValidForPolicy(mContext,uid)) {
            setUidPolicyUnchecked(uid,policy,false);
          }
 else {
            Slog.w(TAG,"unable to apply policy to UID " + uid + "; ignoring");
          }
        }
      }
    }
  }
 catch (  FileNotFoundException e) {
  }
catch (  IOException e) {
    Slog.e(TAG,"problem reading network stats",e);
  }
catch (  XmlPullParserException e) {
    Slog.e(TAG,"problem reading network stats",e);
  }
 finally {
    IoUtils.closeQuietly(fis);
  }
}
