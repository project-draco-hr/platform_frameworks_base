{
  final int oldPolicy;
synchronized (mRulesLock) {
    oldPolicy=getAppPolicy(appId);
    mAppPolicy.put(appId,policy);
    updateRulesForAppLocked(appId);
    if (persist) {
      writePolicyLocked();
    }
  }
}
