{
  if (LOGV)   Slog.v(TAG,"updateNotificationsLocked()");
  final HashSet<String> beforeNotifs=Sets.newHashSet();
  beforeNotifs.addAll(mActiveNotifs);
  mActiveNotifs.clear();
  final long currentTime=currentTimeMillis(true);
  for (  NetworkPolicy policy : mNetworkPolicy.values()) {
    if (!isTemplateRelevant(policy.template))     continue;
    final long start=computeLastCycleBoundary(currentTime,policy);
    final long end=currentTime;
    final long totalBytes=getTotalBytes(policy.template,start,end);
    if (policy.limitBytes != LIMIT_DISABLED && totalBytes >= policy.limitBytes) {
      if (policy.lastSnooze >= start) {
        enqueueNotification(policy,TYPE_LIMIT_SNOOZED,totalBytes);
      }
 else {
        enqueueNotification(policy,TYPE_LIMIT,totalBytes);
        notifyOverLimitLocked(policy.template);
      }
    }
 else {
      notifyUnderLimitLocked(policy.template);
      if (policy.warningBytes != WARNING_DISABLED && totalBytes >= policy.warningBytes) {
        enqueueNotification(policy,TYPE_WARNING,totalBytes);
      }
    }
  }
  if (mRestrictBackground) {
    enqueueRestrictedNotification(TAG_ALLOW_BACKGROUND);
  }
  for (  String tag : beforeNotifs) {
    if (!mActiveNotifs.contains(tag)) {
      cancelNotification(tag);
    }
  }
}
