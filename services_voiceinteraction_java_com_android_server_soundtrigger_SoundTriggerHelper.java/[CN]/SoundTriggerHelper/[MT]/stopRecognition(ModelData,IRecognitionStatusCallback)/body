{
synchronized (mLock) {
    if (callback == null) {
      return STATUS_ERROR;
    }
    if (mModuleProperties == null || mModule == null) {
      Slog.w(TAG,"Attempting stopRecognition without the capability");
      return STATUS_ERROR;
    }
    IRecognitionStatusCallback currentCallback=modelData.getCallback();
    if (modelData == null || currentCallback == null || (!modelData.isRequested() && !modelData.isModelStarted())) {
      Slog.w(TAG,"Attempting stopRecognition without a successful startRecognition");
      return STATUS_ERROR;
    }
    if (currentCallback.asBinder() != callback.asBinder()) {
      Slog.w(TAG,"Attempting stopRecognition for another recognition");
      return STATUS_ERROR;
    }
    modelData.setRequested(false);
    int status=updateRecognitionLocked(modelData,isRecognitionAllowed(),false);
    if (status != SoundTrigger.STATUS_OK) {
      return status;
    }
    modelData.setLoaded();
    modelData.clearCallback();
    modelData.setRecognitionConfig(null);
    if (!computeRecognitionRunningLocked()) {
      internalClearGlobalStateLocked();
    }
    return status;
  }
}
