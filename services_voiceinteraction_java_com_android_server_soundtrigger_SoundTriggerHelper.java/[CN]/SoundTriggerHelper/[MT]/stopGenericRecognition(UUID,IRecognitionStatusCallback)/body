{
  if (listener == null) {
    return STATUS_ERROR;
  }
synchronized (mLock) {
    ModelData modelData=mGenericModelDataMap.get(modelId);
    if (modelData == null) {
      Slog.w(TAG,"Attempting stopRecognition on invalid model with id:" + modelId);
      return STATUS_ERROR;
    }
    IRecognitionStatusCallback currentCallback=modelData.getCallback();
    if (DBG) {
      Slog.d(TAG,"stopRecognition for modelId=" + modelId + ", listener="+ listener.asBinder());
      Slog.d(TAG,"current callback =" + (currentCallback == null ? "null" : currentCallback.asBinder()));
    }
    if (mModuleProperties == null || mModule == null) {
      Slog.w(TAG,"Attempting stopRecognition without the capability");
      return STATUS_ERROR;
    }
    if (currentCallback == null || !modelData.isModelStarted()) {
      Slog.w(TAG,"Attempting stopGenericRecognition without a successful" + " startGenericRecognition");
      return STATUS_ERROR;
    }
    if (currentCallback.asBinder() != listener.asBinder()) {
      Slog.w(TAG,"Attempting stopGenericRecognition for another recognition");
      return STATUS_ERROR;
    }
    int status=stopGenericRecognitionLocked(modelData,false);
    if (status != SoundTrigger.STATUS_OK) {
      Slog.w(TAG,"stopGenericRecognition failed: " + status);
      return status;
    }
    modelData.setLoaded();
    modelData.clearCallback();
    if (!computeRecognitionRunningLocked()) {
      internalClearGlobalStateLocked();
    }
    return status;
  }
}
