{
synchronized (mLock) {
    if (mCurrentUserId == userId && mInitialized) {
      return;
    }
    UserState oldUserState=getCurrentUserStateLocked();
    oldUserState.onSwitchToAnotherUser();
    if (oldUserState.mClients.getRegisteredCallbackCount() > 0) {
      mMainHandler.obtainMessage(MainHandler.MSG_SEND_CLEARED_STATE_TO_CLIENTS_FOR_USER,oldUserState.mUserId,0).sendToTarget();
    }
    UserManager userManager=(UserManager)mContext.getSystemService(Context.USER_SERVICE);
    final boolean announceNewUser=userManager.getUsers().size() > 1;
    mCurrentUserId=userId;
    UserState userState=getCurrentUserStateLocked();
    if (userState.mUiAutomationService != null) {
      userState.mUiAutomationService.binderDied();
    }
    readConfigurationForUserStateLocked(userState);
    onUserStateChangedLocked(userState);
    if (announceNewUser) {
      mMainHandler.sendEmptyMessageDelayed(MainHandler.MSG_ANNOUNCE_NEW_USER_IF_NEEDED,WAIT_FOR_USER_STATE_FULLY_INITIALIZED_MILLIS);
    }
  }
}
