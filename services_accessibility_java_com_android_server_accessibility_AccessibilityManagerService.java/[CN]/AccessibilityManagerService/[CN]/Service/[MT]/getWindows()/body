{
synchronized (mLock) {
    final int resolvedUserId=mSecurityPolicy.resolveCallingUserIdEnforcingPermissionsLocked(UserHandle.getCallingUserId());
    if (resolvedUserId != mCurrentUserId) {
      return null;
    }
    final boolean permissionGranted=mSecurityPolicy.canRetrieveWindowsLocked(this);
    if (!permissionGranted) {
      return null;
    }
    List<AccessibilityWindowInfo> windows=new ArrayList<AccessibilityWindowInfo>();
    final int windowCount=mSecurityPolicy.mWindows.size();
    for (int i=0; i < windowCount; i++) {
      AccessibilityWindowInfo window=mSecurityPolicy.mWindows.get(i);
      AccessibilityWindowInfo windowClone=AccessibilityWindowInfo.obtain(window);
      windowClone.setConnectionId(mId);
      mIntrospectedWindows.put(window.getId(),windowClone);
      windows.add(windowClone);
    }
    return windows;
  }
}
