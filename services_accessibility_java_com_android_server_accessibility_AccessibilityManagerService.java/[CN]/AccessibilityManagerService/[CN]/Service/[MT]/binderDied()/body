{
synchronized (mLock) {
    if (!isConnectedLocked()) {
      return;
    }
    mWasConnectedAndDied=true;
    mKeyEventDispatcher.flush();
    UserState userState=getUserStateLocked(mUserId);
    removeServiceLocked(this,userState);
    resetLocked();
    if (mIsAutomation) {
      userState.mInstalledServices.remove(mAccessibilityServiceInfo);
      userState.mEnabledServices.remove(mComponentName);
      userState.destroyUiAutomationService();
      if (readConfigurationForUserStateLocked(userState)) {
        onUserStateChangedLocked(userState);
      }
    }
  }
}
