{
  AsyncResult ar;
  int serviceClassX;
  serviceClassX=CommandsInterface.SERVICE_CLASS_VOICE + CommandsInterface.SERVICE_CLASS_DATA + CommandsInterface.SERVICE_CLASS_FAX;
switch (msg.what) {
case EVENT_RADIO_OFF_OR_NOT_AVAILABLE:
    status=null;
  updateStateProperty();
broadcastSimStateChangedIntent(SimCard.INTENT_VALUE_SIM_NOT_READY,null);
break;
case EVENT_SIM_READY:
phone.mCM.getSimStatus(obtainMessage(EVENT_GET_SIM_STATUS_DONE));
phone.mCM.queryFacilityLock(CommandsInterface.CB_FACILITY_BA_SIM,"",serviceClassX,obtainMessage(EVENT_QUERY_FACILITY_LOCK_DONE));
phone.mCM.queryFacilityLock(CommandsInterface.CB_FACILITY_BA_FD,"",serviceClassX,obtainMessage(EVENT_QUERY_FACILITY_FDN_DONE));
break;
case EVENT_SIM_LOCKED_OR_ABSENT:
phone.mCM.getSimStatus(obtainMessage(EVENT_GET_SIM_STATUS_DONE));
phone.mCM.queryFacilityLock(CommandsInterface.CB_FACILITY_BA_SIM,"",serviceClassX,obtainMessage(EVENT_QUERY_FACILITY_LOCK_DONE));
break;
case EVENT_GET_SIM_STATUS_DONE:
ar=(AsyncResult)msg.obj;
getSimStatusDone(ar);
break;
case EVENT_PINPUK_DONE:
ar=(AsyncResult)msg.obj;
AsyncResult.forMessage(((Message)ar.userObj)).exception=ar.exception;
phone.mCM.getSimStatus(obtainMessage(EVENT_REPOLL_STATUS_DONE,ar.userObj));
break;
case EVENT_REPOLL_STATUS_DONE:
ar=(AsyncResult)msg.obj;
getSimStatusDone(ar);
((Message)ar.userObj).sendToTarget();
break;
case EVENT_QUERY_FACILITY_LOCK_DONE:
ar=(AsyncResult)msg.obj;
onQueryFacilityLock(ar);
break;
case EVENT_QUERY_FACILITY_FDN_DONE:
ar=(AsyncResult)msg.obj;
onQueryFdnEnabled(ar);
break;
case EVENT_CHANGE_FACILITY_LOCK_DONE:
ar=(AsyncResult)msg.obj;
if (ar.exception == null) {
mSimPinLocked=mDesiredPinLocked;
if (DBG) log("EVENT_CHANGE_FACILITY_LOCK_DONE: " + "mSimPinLocked= " + mSimPinLocked);
}
 else {
Log.e(LOG_TAG,"Error change facility lock with exception " + ar.exception);
}
AsyncResult.forMessage(((Message)ar.userObj)).exception=ar.exception;
((Message)ar.userObj).sendToTarget();
break;
case EVENT_CHANGE_FACILITY_FDN_DONE:
ar=(AsyncResult)msg.obj;
if (ar.exception == null) {
mSimFdnEnabled=mDesiredFdnEnabled;
if (DBG) log("EVENT_CHANGE_FACILITY_FDN_DONE: " + "mSimFdnEnabled=" + mSimFdnEnabled);
}
 else {
Log.e(LOG_TAG,"Error change facility fdn with exception " + ar.exception);
}
AsyncResult.forMessage(((Message)ar.userObj)).exception=ar.exception;
((Message)ar.userObj).sendToTarget();
break;
case EVENT_CHANGE_SIM_PASSWORD_DONE:
ar=(AsyncResult)msg.obj;
if (ar.exception != null) {
Log.e(LOG_TAG,"Error in change sim password with exception" + ar.exception);
}
AsyncResult.forMessage(((Message)ar.userObj)).exception=ar.exception;
((Message)ar.userObj).sendToTarget();
break;
default :
Log.e(LOG_TAG,"[GsmSimCard] Unknown Event " + msg.what);
}
}
