{
  final ListAdapter adapter=mAdapter;
  if (adapter == null) {
    return mListPadding.top + mListPadding.bottom;
  }
  int returnedHeight=mListPadding.top + mListPadding.bottom;
  final int dividerHeight=((mDividerHeight > 0) && mDivider != null) ? mDividerHeight : 0;
  int prevHeightWithoutPartialChild=0;
  int i;
  View child;
  endPosition=(endPosition == NO_POSITION) ? adapter.getCount() - 1 : endPosition;
  final AbsListView.RecycleBin recycleBin=mRecycler;
  for (i=startPosition; i <= endPosition; ++i) {
    child=obtainView(i);
    final int childViewType=adapter.getItemViewType(i);
    AbsListView.LayoutParams lp=(AbsListView.LayoutParams)child.getLayoutParams();
    if (lp == null) {
      lp=new AbsListView.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,ViewGroup.LayoutParams.WRAP_CONTENT,0);
      child.setLayoutParams(lp);
    }
    lp.viewType=childViewType;
    if (i > 0) {
      returnedHeight+=dividerHeight;
    }
    child.measure(widthMeasureSpec,lp.height >= 0 ? MeasureSpec.makeMeasureSpec(lp.height,MeasureSpec.EXACTLY) : MeasureSpec.makeMeasureSpec(0,MeasureSpec.UNSPECIFIED));
    if (recycleBin.shouldRecycleViewType(childViewType)) {
      recycleBin.addScrapView(child);
    }
    returnedHeight+=child.getMeasuredHeight();
    if (returnedHeight >= maxHeight) {
      return (disallowPartialChildPosition >= 0) && (i > disallowPartialChildPosition) && (prevHeightWithoutPartialChild > 0)&& (returnedHeight != maxHeight) ? prevHeightWithoutPartialChild : maxHeight;
    }
    if ((disallowPartialChildPosition >= 0) && (i >= disallowPartialChildPosition)) {
      prevHeightWithoutPartialChild=returnedHeight;
    }
  }
  return returnedHeight;
}
