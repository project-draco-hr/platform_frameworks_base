{
  final int dividerHeight=mDividerHeight;
  if (dividerHeight > 0 && mDivider != null) {
    final Rect bounds=mTempRect;
    bounds.left=mPaddingLeft;
    bounds.right=mRight - mLeft - mPaddingRight;
    final int count=getChildCount();
    final int headerCount=mHeaderViewInfos.size();
    final int footerLimit=mItemCount - mFooterViewInfos.size() - 1;
    final boolean headerDividers=mHeaderDividersEnabled;
    final boolean footerDividers=mFooterDividersEnabled;
    final int first=mFirstPosition;
    final boolean areAllItemsSelectable=mAreAllItemsSelectable;
    final ListAdapter adapter=mAdapter;
    final boolean fillForMissingDividers=isOpaque() && !super.isOpaque();
    if (fillForMissingDividers && mDividerPaint == null && mIsCacheColorOpaque) {
      mDividerPaint=new Paint();
      mDividerPaint.setColor(getCacheColorHint());
    }
    final Paint paint=mDividerPaint;
    if (!mStackFromBottom) {
      int bottom;
      int listBottom=mBottom - mTop - mListPadding.bottom;
      for (int i=0; i < count; i++) {
        if ((headerDividers || first + i >= headerCount) && (footerDividers || first + i < footerLimit)) {
          View child=getChildAt(i);
          bottom=child.getBottom();
          if (bottom < listBottom) {
            if ((areAllItemsSelectable || (adapter.isEnabled(first + i) && (i == count - 1 || adapter.isEnabled(first + i + 1))))) {
              bounds.top=bottom;
              bounds.bottom=bottom + dividerHeight;
              drawDivider(canvas,bounds,i);
            }
 else             if (fillForMissingDividers) {
              bounds.top=bottom;
              bounds.bottom=bottom + dividerHeight;
              canvas.drawRect(bounds,paint);
            }
          }
        }
      }
    }
 else {
      int top;
      int listTop=mListPadding.top;
      for (int i=0; i < count; i++) {
        if ((headerDividers || first + i >= headerCount) && (footerDividers || first + i < footerLimit)) {
          View child=getChildAt(i);
          top=child.getTop();
          if (top > listTop) {
            if ((areAllItemsSelectable || (adapter.isEnabled(first + i) && (i == count - 1 || adapter.isEnabled(first + i + 1))))) {
              bounds.top=top - dividerHeight;
              bounds.bottom=top;
              drawDivider(canvas,bounds,i - 1);
            }
 else             if (fillForMissingDividers) {
              bounds.top=top - dividerHeight;
              bounds.bottom=top;
              canvas.drawRect(bounds,paint);
            }
          }
        }
      }
    }
  }
  super.dispatchDraw(canvas);
}
