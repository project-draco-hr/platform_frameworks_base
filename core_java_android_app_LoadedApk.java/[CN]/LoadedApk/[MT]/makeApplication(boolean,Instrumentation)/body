{
  if (mApplication != null) {
    return mApplication;
  }
  Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,"makeApplication");
  Application app=null;
  String appClass=mApplicationInfo.className;
  if (forceDefaultAppClass || (appClass == null)) {
    appClass="android.app.Application";
  }
  try {
    java.lang.ClassLoader cl=getClassLoader();
    if (!mPackageName.equals("android")) {
      Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,"initializeJavaContextClassLoader");
      initializeJavaContextClassLoader();
      Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
    }
    ContextImpl appContext=ContextImpl.createAppContext(mActivityThread,this);
    app=mActivityThread.mInstrumentation.newApplication(cl,appClass,appContext);
    appContext.setOuterContext(app);
  }
 catch (  Exception e) {
    if (!mActivityThread.mInstrumentation.onException(app,e)) {
      Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
      throw new RuntimeException("Unable to instantiate application " + appClass + ": "+ e.toString(),e);
    }
  }
  mActivityThread.mAllApplications.add(app);
  mApplication=app;
  if (instrumentation != null) {
    try {
      instrumentation.callApplicationOnCreate(app);
    }
 catch (    Exception e) {
      if (!instrumentation.onException(app,e)) {
        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
        throw new RuntimeException("Unable to create application " + app.getClass().getName() + ": "+ e.toString(),e);
      }
    }
  }
  SparseArray<String> packageIdentifiers=getAssets(mActivityThread).getAssignedPackageIdentifiers();
  final int N=packageIdentifiers.size();
  for (int i=0; i < N; i++) {
    final int id=packageIdentifiers.keyAt(i);
    if (id == 0x01 || id == 0x7f) {
      continue;
    }
    rewriteRValues(getClassLoader(),packageIdentifiers.valueAt(i),id);
  }
  Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
  return app;
}
