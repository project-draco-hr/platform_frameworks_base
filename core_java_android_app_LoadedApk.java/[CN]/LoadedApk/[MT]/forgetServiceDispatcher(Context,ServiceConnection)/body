{
synchronized (mServices) {
    ArrayMap<ServiceConnection,LoadedApk.ServiceDispatcher> map=mServices.get(context);
    LoadedApk.ServiceDispatcher sd=null;
    if (map != null) {
      sd=map.get(c);
      if (sd != null) {
        map.remove(c);
        sd.doForget();
        if (map.size() == 0) {
          mServices.remove(context);
        }
        if ((sd.getFlags() & Context.BIND_DEBUG_UNBIND) != 0) {
          ArrayMap<ServiceConnection,LoadedApk.ServiceDispatcher> holder=mUnboundServices.get(context);
          if (holder == null) {
            holder=new ArrayMap<ServiceConnection,LoadedApk.ServiceDispatcher>();
            mUnboundServices.put(context,holder);
          }
          RuntimeException ex=new IllegalArgumentException("Originally unbound here:");
          ex.fillInStackTrace();
          sd.setUnbindLocation(ex);
          holder.put(c,sd);
        }
        return sd.getIServiceConnection();
      }
    }
    ArrayMap<ServiceConnection,LoadedApk.ServiceDispatcher> holder=mUnboundServices.get(context);
    if (holder != null) {
      sd=holder.get(c);
      if (sd != null) {
        RuntimeException ex=sd.getUnbindLocation();
        throw new IllegalArgumentException("Unbinding Service " + c + " that was already unbound",ex);
      }
    }
    if (context == null) {
      throw new IllegalStateException("Unbinding Service " + c + " from Context that is no longer in use: "+ context);
    }
 else {
      throw new IllegalArgumentException("Service not registered: " + c);
    }
  }
}
