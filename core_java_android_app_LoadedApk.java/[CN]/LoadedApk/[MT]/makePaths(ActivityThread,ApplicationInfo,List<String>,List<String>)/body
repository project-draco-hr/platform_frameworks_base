{
  final String appDir=aInfo.sourceDir;
  final String[] splitAppDirs=aInfo.splitSourceDirs;
  final String libDir=aInfo.nativeLibraryDir;
  final String[] sharedLibraries=aInfo.sharedLibraryFiles;
  outZipPaths.clear();
  outZipPaths.add(appDir);
  if (splitAppDirs != null) {
    Collections.addAll(outZipPaths,splitAppDirs);
  }
  if (outLibPaths != null) {
    outLibPaths.clear();
  }
  String instrumentationPackageName=activityThread.mInstrumentationPackageName;
  String instrumentationAppDir=activityThread.mInstrumentationAppDir;
  String[] instrumentationSplitAppDirs=activityThread.mInstrumentationSplitAppDirs;
  String instrumentationLibDir=activityThread.mInstrumentationLibDir;
  String instrumentedAppDir=activityThread.mInstrumentedAppDir;
  String[] instrumentedSplitAppDirs=activityThread.mInstrumentedSplitAppDirs;
  String instrumentedLibDir=activityThread.mInstrumentedLibDir;
  String[] instrumentationLibs=null;
  if (appDir.equals(instrumentationAppDir) || appDir.equals(instrumentedAppDir)) {
    outZipPaths.clear();
    outZipPaths.add(instrumentationAppDir);
    if (instrumentationSplitAppDirs != null) {
      Collections.addAll(outZipPaths,instrumentationSplitAppDirs);
    }
    if (!instrumentationAppDir.equals(instrumentedAppDir)) {
      outZipPaths.add(instrumentedAppDir);
      if (instrumentedSplitAppDirs != null) {
        Collections.addAll(outZipPaths,instrumentedSplitAppDirs);
      }
    }
    if (outLibPaths != null) {
      outLibPaths.add(instrumentationLibDir);
      if (!instrumentationLibDir.equals(instrumentedLibDir)) {
        outLibPaths.add(instrumentedLibDir);
      }
    }
    if (!instrumentedAppDir.equals(instrumentationAppDir)) {
      instrumentationLibs=getLibrariesFor(instrumentationPackageName);
    }
  }
  if (outLibPaths != null) {
    if (outLibPaths.isEmpty()) {
      outLibPaths.add(libDir);
    }
    if (aInfo.primaryCpuAbi != null) {
      if (aInfo.targetSdkVersion <= 23) {
        outLibPaths.add("/system/fake-libs" + (VMRuntime.is64BitAbi(aInfo.primaryCpuAbi) ? "64" : ""));
      }
      for (      String apk : outZipPaths) {
        outLibPaths.add(apk + "!/lib/" + aInfo.primaryCpuAbi);
      }
    }
    if (aInfo.isSystemApp() && !aInfo.isUpdatedSystemApp()) {
      outLibPaths.add(System.getProperty("java.library.path"));
    }
  }
  if (sharedLibraries != null) {
    for (    String lib : sharedLibraries) {
      if (!outZipPaths.contains(lib)) {
        outZipPaths.add(0,lib);
      }
    }
  }
  if (instrumentationLibs != null) {
    for (    String lib : instrumentationLibs) {
      if (!outZipPaths.contains(lib)) {
        outZipPaths.add(0,lib);
      }
    }
  }
}
