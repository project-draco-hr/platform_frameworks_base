{
  final Rect bounds=getBounds();
  final boolean clearColorFilter;
  if (mTintFilter != null && getPaint().getColorFilter() == null) {
    mPaint.setColorFilter(mTintFilter);
    clearColorFilter=true;
  }
 else {
    clearColorFilter=false;
  }
  final boolean needsMirroring=needsMirroring();
  if (needsMirroring) {
    canvas.save();
    canvas.translate(bounds.right - bounds.left,0);
    canvas.scale(-1.0f,1.0f);
  }
  final int restoreAlpha;
  if (mNinePatchState.mBaseAlpha != 1.0f) {
    final Paint p=getPaint();
    restoreAlpha=p.getAlpha();
    p.setAlpha((int)(restoreAlpha * mNinePatchState.mBaseAlpha + 0.5f));
  }
 else {
    restoreAlpha=-1;
  }
  mNinePatch.draw(canvas,bounds,mPaint);
  if (needsMirroring) {
    canvas.restore();
  }
  if (clearColorFilter) {
    mPaint.setColorFilter(null);
  }
  if (restoreAlpha >= 0) {
    mPaint.setAlpha(restoreAlpha);
  }
}
