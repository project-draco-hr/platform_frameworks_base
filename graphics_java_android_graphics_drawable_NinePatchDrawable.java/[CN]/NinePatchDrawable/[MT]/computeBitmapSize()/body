{
  final int sdensity=mNinePatch.getDensity();
  final int tdensity=mTargetDensity;
  if (sdensity == tdensity) {
    mBitmapWidth=mNinePatch.getWidth();
    mBitmapHeight=mNinePatch.getHeight();
    mOpticalInsets=mNinePatchState.mOpticalInsets;
  }
 else {
    mBitmapWidth=Drawable.scaleFromDensity(mNinePatch.getWidth(),sdensity,tdensity,true);
    mBitmapHeight=Drawable.scaleFromDensity(mNinePatch.getHeight(),sdensity,tdensity,true);
    if (mNinePatchState.mPadding != null && mPadding != null) {
      Rect dest=mPadding;
      Rect src=mNinePatchState.mPadding;
      if (dest == src) {
        mPadding=dest=new Rect(src);
      }
      dest.left=Drawable.scaleFromDensity(src.left,sdensity,tdensity,true);
      dest.top=Drawable.scaleFromDensity(src.top,sdensity,tdensity,true);
      dest.right=Drawable.scaleFromDensity(src.right,sdensity,tdensity,true);
      dest.bottom=Drawable.scaleFromDensity(src.bottom,sdensity,tdensity,true);
    }
    mOpticalInsets=scaleFromDensity(mNinePatchState.mOpticalInsets,sdensity,tdensity);
  }
}
