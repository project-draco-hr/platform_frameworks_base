{
  String firstPackage="first";
  String secondPackage="second";
  WebViewProviderInfo[] packages=new WebViewProviderInfo[]{new WebViewProviderInfo(firstPackage,"",true,false,null),new WebViewProviderInfo(secondPackage,"",true,false,null)};
  setupWithPackages(packages);
  setEnabledAndValidPackageInfos(packages);
  runWebViewBootPreparationOnMainSync();
  Mockito.verify(mTestSystemImpl).onWebViewProviderChanged(Mockito.argThat(new IsPackageInfoWithName(firstPackage)));
  mWebViewUpdateServiceImpl.changeProviderAndSetting(secondPackage);
  mTestSystemImpl.setPackageInfo(createPackageInfo(firstPackage,true,false,true,null,0));
  mTestSystemImpl.setPackageInfo(createPackageInfo(secondPackage,true,false,true));
  mWebViewUpdateServiceImpl.notifyRelroCreationCompleted();
  WebViewProviderResponse response=mWebViewUpdateServiceImpl.waitForAndGetProvider();
  assertEquals(WebViewFactory.LIBLOAD_FAILED_LISTING_WEBVIEW_PACKAGES,response.status);
  mTestSystemImpl.setPackageInfo(createPackageInfo(firstPackage,true,true,true,null,1));
  mWebViewUpdateServiceImpl.packageStateChanged(firstPackage,WebViewUpdateService.PACKAGE_ADDED_REPLACED,0);
  checkPreparationPhasesForPackage(firstPackage,2);
}
