{
  String firstPackage="first";
  String secondPackage="second";
  WebViewProviderInfo[] packages=new WebViewProviderInfo[]{new WebViewProviderInfo(firstPackage,"",true,false,null),new WebViewProviderInfo(secondPackage,"",true,false,null)};
  checkCertainPackageUsedAfterWebViewBootPreparation(firstPackage,packages);
  mTestSystemImpl.setPackageInfo(createPackageInfo(firstPackage,true,false));
  mTestSystemImpl.setPackageInfo(createPackageInfo(secondPackage,true,false));
  if (settingsChange) {
    mWebViewUpdateServiceImpl.changeProviderAndSetting(secondPackage);
  }
 else {
    mWebViewUpdateServiceImpl.packageStateChanged(secondPackage,WebViewUpdateService.PACKAGE_ADDED_REPLACED);
  }
  WebViewProviderResponse response=mWebViewUpdateServiceImpl.waitForAndGetProvider();
  assertEquals(WebViewFactory.LIBLOAD_FAILED_LISTING_WEBVIEW_PACKAGES,response.status);
  mTestSystemImpl.setPackageInfo(createPackageInfo(secondPackage,true,true));
  mWebViewUpdateServiceImpl.packageStateChanged(secondPackage,WebViewUpdateService.PACKAGE_ADDED_REPLACED);
  checkPreparationPhasesForPackage(secondPackage,1);
}
