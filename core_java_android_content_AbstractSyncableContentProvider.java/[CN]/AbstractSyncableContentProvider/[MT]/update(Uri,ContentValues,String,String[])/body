{
  mDb=mOpenHelper.getWritableDatabase();
  final boolean notApplyingBatch=!applyingBatch();
  if (notApplyingBatch) {
    mDb.beginTransaction();
  }
  try {
    if (isTemporary() && mSyncState.matches(url)) {
      int numRows=mSyncState.asContentProvider().update(url,values,selection,selectionArgs);
      if (notApplyingBatch) {
        mDb.setTransactionSuccessful();
      }
      return numRows;
    }
    int result=updateInternal(url,values,selection,selectionArgs);
    if (notApplyingBatch) {
      mDb.setTransactionSuccessful();
    }
    if (!isTemporary() && result > 0) {
      if (notApplyingBatch) {
        getContext().getContentResolver().notifyChange(url,null,changeRequiresLocalSync(url));
      }
 else {
        mPendingBatchNotifications.get().add(url);
      }
    }
    return result;
  }
  finally {
    if (notApplyingBatch) {
      mDb.endTransaction();
    }
  }
}
