{
  if (mApplyingBatch.get() == null) {
    mApplyingBatch.set(false);
    mPendingBatchNotifications.set(new HashSet<Uri>());
  }
  if (applyingBatch()) {
    throw new IllegalStateException("applyBatch is not reentrant but mApplyingBatch is already set");
  }
  getDatabase().beginTransaction();
  try {
    mApplyingBatch.set(true);
    ContentProviderResult[] results=super.applyBatch(operations);
    getDatabase().setTransactionSuccessful();
    return results;
  }
  finally {
    mApplyingBatch.set(false);
    getDatabase().endTransaction();
    for (    Uri url : mPendingBatchNotifications.get()) {
      getContext().getContentResolver().notifyChange(url,null,changeRequiresLocalSync(url));
    }
  }
}
