{
synchronized (mSetModeDeathHandlers) {
    Log.w(TAG,"setMode() client died");
    int index=mSetModeDeathHandlers.indexOf(this);
    if (index < 0) {
      Log.w(TAG,"unregistered setMode() client died");
    }
 else {
      mSetModeDeathHandlers.remove(this);
      if (index == 0) {
        SetModeDeathHandler hdlr=mSetModeDeathHandlers.get(0);
        int mode=hdlr.getMode();
        if (AudioService.this.mMode != mode) {
          if (AudioSystem.setPhoneState(mode) == AudioSystem.AUDIO_STATUS_OK) {
            AudioService.this.mMode=mode;
            if (mode != AudioSystem.MODE_NORMAL) {
synchronized (mScoClients) {
                checkScoAudioState();
                if (mScoAudioState == SCO_STATE_ACTIVE_EXTERNAL) {
                  mBluetoothHeadset.stopVoiceRecognition(mBluetoothHeadsetDevice);
                  mBluetoothHeadset.stopVirtualVoiceCall(mBluetoothHeadsetDevice);
                }
 else {
                  clearAllScoClients(mCb,true);
                }
              }
            }
          }
        }
      }
    }
  }
}
