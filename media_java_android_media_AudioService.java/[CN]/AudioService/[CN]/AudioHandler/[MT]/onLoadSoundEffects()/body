{
  int status;
synchronized (mSoundEffectsLock) {
    if (!mSystemReady) {
      Log.w(TAG,"onLoadSoundEffects() called before boot complete");
      return false;
    }
    if (mSoundPool != null) {
      return true;
    }
    loadTouchSoundAssets();
    mSoundPool=new SoundPool(NUM_SOUNDPOOL_CHANNELS,AudioSystem.STREAM_SYSTEM,0);
    mSoundPoolCallBack=null;
    mSoundPoolListenerThread=new SoundPoolListenerThread();
    mSoundPoolListenerThread.start();
    int attempts=3;
    while ((mSoundPoolCallBack == null) && (attempts-- > 0)) {
      try {
        mSoundEffectsLock.wait(SOUND_EFFECTS_LOAD_TIMEOUT_MS);
      }
 catch (      InterruptedException e) {
        Log.w(TAG,"Interrupted while waiting sound pool listener thread.");
      }
    }
    if (mSoundPoolCallBack == null) {
      Log.w(TAG,"onLoadSoundEffects() SoundPool listener or thread creation error");
      if (mSoundPoolLooper != null) {
        mSoundPoolLooper.quit();
        mSoundPoolLooper=null;
      }
      mSoundPoolListenerThread=null;
      mSoundPool.release();
      mSoundPool=null;
      return false;
    }
    int[] poolId=new int[SOUND_EFFECT_FILES.size()];
    for (int fileIdx=0; fileIdx < SOUND_EFFECT_FILES.size(); fileIdx++) {
      poolId[fileIdx]=-1;
    }
    int numSamples=0;
    for (int effect=0; effect < AudioManager.NUM_SOUND_EFFECTS; effect++) {
      if (SOUND_EFFECT_FILES_MAP[effect][1] == 0) {
        continue;
      }
      if (poolId[SOUND_EFFECT_FILES_MAP[effect][0]] == -1) {
        String filePath=Environment.getRootDirectory() + SOUND_EFFECTS_PATH + SOUND_EFFECT_FILES.get(SOUND_EFFECT_FILES_MAP[effect][0]);
        int sampleId=mSoundPool.load(filePath,0);
        if (sampleId <= 0) {
          Log.w(TAG,"Soundpool could not load file: " + filePath);
        }
 else {
          SOUND_EFFECT_FILES_MAP[effect][1]=sampleId;
          poolId[SOUND_EFFECT_FILES_MAP[effect][0]]=sampleId;
          numSamples++;
        }
      }
 else {
        SOUND_EFFECT_FILES_MAP[effect][1]=poolId[SOUND_EFFECT_FILES_MAP[effect][0]];
      }
    }
    if (numSamples > 0) {
      mSoundPoolCallBack.setSamples(poolId);
      attempts=3;
      status=1;
      while ((status == 1) && (attempts-- > 0)) {
        try {
          mSoundEffectsLock.wait(SOUND_EFFECTS_LOAD_TIMEOUT_MS);
          status=mSoundPoolCallBack.status();
        }
 catch (        InterruptedException e) {
          Log.w(TAG,"Interrupted while waiting sound pool callback.");
        }
      }
    }
 else {
      status=-1;
    }
    if (mSoundPoolLooper != null) {
      mSoundPoolLooper.quit();
      mSoundPoolLooper=null;
    }
    mSoundPoolListenerThread=null;
    if (status != 0) {
      Log.w(TAG,"onLoadSoundEffects(), Error " + status + " while loading samples");
      for (int effect=0; effect < AudioManager.NUM_SOUND_EFFECTS; effect++) {
        if (SOUND_EFFECT_FILES_MAP[effect][1] > 0) {
          SOUND_EFFECT_FILES_MAP[effect][1]=-1;
        }
      }
      mSoundPool.release();
      mSoundPool=null;
    }
  }
  return (status == 0);
}
