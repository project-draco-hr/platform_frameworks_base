{
  boolean adjustVolumeIndex=true;
  int ringerMode=getRingerMode();
switch (ringerMode) {
case RINGER_MODE_NORMAL:
    if (direction == AudioManager.ADJUST_LOWER) {
      if (mHasVibrator) {
        if (step <= oldIndex && oldIndex < 2 * step) {
          ringerMode=RINGER_MODE_VIBRATE;
        }
      }
 else {
        if ((oldIndex < step) && mPrevVolDirection != AudioManager.ADJUST_LOWER) {
          ringerMode=RINGER_MODE_SILENT;
        }
      }
    }
  break;
case RINGER_MODE_VIBRATE:
if (!mHasVibrator) {
  Log.e(TAG,"checkForRingerModeChange() current ringer mode is vibrate" + "but no vibrator is present");
  break;
}
if ((direction == AudioManager.ADJUST_LOWER)) {
if (mPrevVolDirection != AudioManager.ADJUST_LOWER) {
  ringerMode=RINGER_MODE_SILENT;
}
}
 else if (direction == AudioManager.ADJUST_RAISE) {
ringerMode=RINGER_MODE_NORMAL;
}
adjustVolumeIndex=false;
break;
case RINGER_MODE_SILENT:
if (direction == AudioManager.ADJUST_RAISE) {
if (mHasVibrator) {
ringerMode=RINGER_MODE_VIBRATE;
}
 else {
ringerMode=RINGER_MODE_NORMAL;
}
}
adjustVolumeIndex=false;
break;
default :
Log.e(TAG,"checkForRingerModeChange() wrong ringer mode: " + ringerMode);
break;
}
setRingerMode(ringerMode);
mPrevVolDirection=direction;
return adjustVolumeIndex;
}
