{
  int result=FLAG_ADJUST_VOLUME;
  int ringerMode=getRingerModeInternal();
switch (ringerMode) {
case RINGER_MODE_NORMAL:
    if (direction == AudioManager.ADJUST_LOWER) {
      if (mHasVibrator) {
        if (step <= oldIndex && oldIndex < 2 * step) {
          ringerMode=RINGER_MODE_VIBRATE;
        }
      }
 else {
        if ((oldIndex < step) && VOLUME_SETS_RINGER_MODE_SILENT && mPrevVolDirection != AudioManager.ADJUST_LOWER) {
          ringerMode=RINGER_MODE_SILENT;
        }
      }
    }
  break;
case RINGER_MODE_VIBRATE:
if (!mHasVibrator) {
  Log.e(TAG,"checkForRingerModeChange() current ringer mode is vibrate" + "but no vibrator is present");
  break;
}
if ((direction == AudioManager.ADJUST_LOWER)) {
if (mPrevVolDirection != AudioManager.ADJUST_LOWER) {
  if (VOLUME_SETS_RINGER_MODE_SILENT) {
    ringerMode=RINGER_MODE_SILENT;
  }
 else {
    result|=AudioManager.FLAG_SHOW_VIBRATE_HINT;
  }
}
}
 else if (direction == AudioManager.ADJUST_RAISE) {
ringerMode=RINGER_MODE_NORMAL;
}
result&=~FLAG_ADJUST_VOLUME;
break;
case RINGER_MODE_SILENT:
if (direction == AudioManager.ADJUST_RAISE) {
if (PREVENT_VOLUME_ADJUSTMENT_IF_SILENT) {
result|=AudioManager.FLAG_SHOW_SILENT_HINT;
}
 else {
if (mHasVibrator) {
ringerMode=RINGER_MODE_VIBRATE;
}
 else {
ringerMode=RINGER_MODE_NORMAL;
}
}
}
result&=~FLAG_ADJUST_VOLUME;
break;
default :
Log.e(TAG,"checkForRingerModeChange() wrong ringer mode: " + ringerMode);
break;
}
setRingerMode(ringerMode,TAG + ".checkForRingerModeChange",false);
mPrevVolDirection=direction;
return result;
}
