{
  if (DEBUG_RC)   Log.i(TAG,"Register remote control client rcClient=" + rcClient);
  int rccId=RemoteControlClient.RCSE_ID_UNREGISTERED;
synchronized (mAudioFocusLock) {
synchronized (mRCStack) {
      Iterator<RemoteControlStackEntry> stackIterator=mRCStack.iterator();
      while (stackIterator.hasNext()) {
        RemoteControlStackEntry rcse=stackIterator.next();
        if (rcse.mMediaIntent.equals(mediaIntent)) {
          if (rcse.mRcClientDeathHandler != null) {
            rcse.unlinkToRcClientDeath();
          }
          rcse.mRcClient=rcClient;
          rcse.mCallingPackageName=callingPackageName;
          rcse.mCallingUid=Binder.getCallingUid();
          if (rcClient == null) {
            rcse.resetPlaybackInfo();
            break;
          }
          rccId=rcse.mRccId;
          if (mRcDisplay != null) {
            try {
              rcse.mRcClient.plugRemoteControlDisplay(mRcDisplay);
            }
 catch (            RemoteException e) {
              Log.e(TAG,"Error connecting remote control display to client: " + e);
              e.printStackTrace();
            }
          }
          IBinder b=rcse.mRcClient.asBinder();
          RcClientDeathHandler rcdh=new RcClientDeathHandler(b,rcse.mMediaIntent);
          try {
            b.linkToDeath(rcdh,0);
          }
 catch (          RemoteException e) {
            Log.w(TAG,"registerRemoteControlClient() has a dead client " + b);
            rcse.mRcClient=null;
          }
          rcse.mRcClientDeathHandler=rcdh;
          break;
        }
      }
      if (isCurrentRcController(mediaIntent)) {
        checkUpdateRemoteControlDisplay_syncAfRcs(RC_INFO_ALL);
      }
    }
  }
  return rccId;
}
