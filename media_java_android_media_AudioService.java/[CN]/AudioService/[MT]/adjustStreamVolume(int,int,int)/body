{
  ensureValidDirection(direction);
  ensureValidStreamType(streamType);
  boolean notificationsUseRingVolume=Settings.System.getInt(mContentResolver,Settings.System.NOTIFICATIONS_USE_RING_VOLUME,1) == 1;
  if (notificationsUseRingVolume && streamType == AudioManager.STREAM_NOTIFICATION) {
    streamType=AudioManager.STREAM_RING;
  }
  VolumeStreamState streamState=mStreamStates[streamType];
  final int oldIndex=streamState.mIndex;
  boolean adjustVolume=true;
  if ((flags & AudioManager.FLAG_ALLOW_RINGER_MODES) != 0 || isStreamAffectedByRingerMode(streamType)) {
    adjustVolume=checkForRingerModeChange(oldIndex,direction);
  }
  if (adjustVolume && streamState.adjustIndex(direction)) {
    boolean alsoUpdateNotificationVolume=notificationsUseRingVolume && streamType == AudioManager.STREAM_RING;
    if (alsoUpdateNotificationVolume) {
      mStreamStates[AudioManager.STREAM_NOTIFICATION].adjustIndex(direction);
    }
    if (streamState.muteCount() == 0) {
      sendMsg(mAudioHandler,MSG_SET_SYSTEM_VOLUME,streamType,SENDMSG_NOOP,0,0,streamState,0);
      if (alsoUpdateNotificationVolume) {
        sendMsg(mAudioHandler,MSG_SET_SYSTEM_VOLUME,AudioManager.STREAM_NOTIFICATION,SENDMSG_NOOP,0,0,mStreamStates[AudioManager.STREAM_NOTIFICATION],0);
      }
    }
  }
  mVolumePanel.postVolumeChanged(streamType,flags);
  sendVolumeUpdate(streamType);
}
