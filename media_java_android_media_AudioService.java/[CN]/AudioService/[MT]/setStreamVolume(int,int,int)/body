{
  ensureValidStreamType(streamType);
  VolumeStreamState streamState=mStreamStates[mStreamVolumeAlias[streamType]];
  final int device=getDeviceForStream(streamType);
  int oldIndex;
  oldIndex=streamState.getIndex(device,(streamState.muteCount() != 0));
  index=rescaleIndex(index * 10,streamType,mStreamVolumeAlias[streamType]);
  flags&=~AudioManager.FLAG_FIXED_VOLUME;
  if ((mStreamVolumeAlias[streamType] == AudioSystem.STREAM_MUSIC) && ((device & mFixedVolumeDevices) != 0)) {
    flags|=AudioManager.FLAG_FIXED_VOLUME;
    if (index != 0) {
      if (mSafeMediaVolumeState == SAFE_MEDIA_VOLUME_ACTIVE && (device & mSafeMediaVolumeDevices) != 0) {
        index=mSafeMediaVolumeIndex;
      }
 else {
        index=streamState.getMaxIndex();
      }
    }
  }
  if (!checkSafeMediaVolume(mStreamVolumeAlias[streamType],index,device)) {
    return;
  }
  if (((flags & AudioManager.FLAG_ALLOW_RINGER_MODES) != 0) || (mStreamVolumeAlias[streamType] == getMasterStreamType())) {
    int newRingerMode;
    if (index == 0) {
      newRingerMode=mHasVibrator ? AudioManager.RINGER_MODE_VIBRATE : AudioManager.RINGER_MODE_SILENT;
      setStreamVolumeInt(mStreamVolumeAlias[streamType],index,device,false,true);
    }
 else {
      newRingerMode=AudioManager.RINGER_MODE_NORMAL;
    }
    setRingerMode(newRingerMode);
  }
  setStreamVolumeInt(mStreamVolumeAlias[streamType],index,device,false,true);
  index=mStreamStates[streamType].getIndex(device,(mStreamStates[streamType].muteCount() != 0));
  sendVolumeUpdate(streamType,oldIndex,index,flags);
}
