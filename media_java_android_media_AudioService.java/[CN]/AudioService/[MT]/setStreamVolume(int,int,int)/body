{
  ensureValidStreamType(streamType);
  VolumeStreamState streamState=mStreamStates[STREAM_VOLUME_ALIAS[streamType]];
  final int device=getDeviceForStream(streamType);
  final int oldIndex=streamState.getIndex(device,(streamState.muteCount() != 0));
  if (mVoiceCapable && (((flags & AudioManager.FLAG_ALLOW_RINGER_MODES) != 0) || (STREAM_VOLUME_ALIAS[streamType] == AudioSystem.STREAM_RING))) {
    int newRingerMode;
    if (index == 0) {
      newRingerMode=System.getInt(mContentResolver,System.VIBRATE_IN_SILENT,1) == 1 ? AudioManager.RINGER_MODE_VIBRATE : AudioManager.RINGER_MODE_SILENT;
      setStreamVolumeInt(STREAM_VOLUME_ALIAS[streamType],index,device,false,true);
    }
 else {
      newRingerMode=AudioManager.RINGER_MODE_NORMAL;
    }
    setRingerMode(newRingerMode);
  }
  index=rescaleIndex(index * 10,streamType,STREAM_VOLUME_ALIAS[streamType]);
  setStreamVolumeInt(STREAM_VOLUME_ALIAS[streamType],index,device,false,true);
  index=streamState.getIndex(device,(streamState.muteCount() != 0));
  sendVolumeUpdate(streamType,oldIndex,index,flags);
}
