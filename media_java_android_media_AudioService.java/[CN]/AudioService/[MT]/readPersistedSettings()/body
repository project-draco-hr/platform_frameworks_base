{
  final ContentResolver cr=mContentResolver;
  int ringerModeFromSettings=Settings.Global.getInt(cr,Settings.Global.MODE_RINGER,AudioManager.RINGER_MODE_NORMAL);
  int ringerMode=ringerModeFromSettings;
  if (!AudioManager.isValidRingerMode(ringerMode)) {
    ringerMode=AudioManager.RINGER_MODE_NORMAL;
  }
  if ((ringerMode == AudioManager.RINGER_MODE_VIBRATE) && !mHasVibrator) {
    ringerMode=AudioManager.RINGER_MODE_SILENT;
  }
  if (ringerMode != ringerModeFromSettings) {
    Settings.Global.putInt(cr,Settings.Global.MODE_RINGER,ringerMode);
  }
  if (mUseFixedVolume) {
    ringerMode=AudioManager.RINGER_MODE_NORMAL;
  }
synchronized (mSettingsLock) {
    mRingerMode=ringerMode;
    mVibrateSetting=getValueForVibrateSetting(0,AudioManager.VIBRATE_TYPE_NOTIFICATION,mHasVibrator ? AudioManager.VIBRATE_SETTING_ONLY_SILENT : AudioManager.VIBRATE_SETTING_OFF);
    mVibrateSetting=getValueForVibrateSetting(mVibrateSetting,AudioManager.VIBRATE_TYPE_RINGER,mHasVibrator ? AudioManager.VIBRATE_SETTING_ONLY_SILENT : AudioManager.VIBRATE_SETTING_OFF);
    mRingerModeAffectedStreams=Settings.System.getIntForUser(cr,Settings.System.MODE_RINGER_STREAMS_AFFECTED,((1 << AudioSystem.STREAM_RING) | (1 << AudioSystem.STREAM_NOTIFICATION) | (1 << AudioSystem.STREAM_SYSTEM)| (1 << AudioSystem.STREAM_SYSTEM_ENFORCED)),UserHandle.USER_CURRENT);
    mRingerModeAffectedStreams|=(1 << AudioSystem.STREAM_RING) | (1 << AudioSystem.STREAM_NOTIFICATION) | (1 << AudioSystem.STREAM_SYSTEM);
    if (mVoiceCapable) {
      mRingerModeAffectedStreams&=~(1 << AudioSystem.STREAM_MUSIC);
    }
 else {
      mRingerModeAffectedStreams|=(1 << AudioSystem.STREAM_MUSIC);
    }
synchronized (mCameraSoundForced) {
      if (mCameraSoundForced) {
        mRingerModeAffectedStreams&=~(1 << AudioSystem.STREAM_SYSTEM_ENFORCED);
      }
 else {
        mRingerModeAffectedStreams|=(1 << AudioSystem.STREAM_SYSTEM_ENFORCED);
      }
    }
    Settings.System.putIntForUser(cr,Settings.System.MODE_RINGER_STREAMS_AFFECTED,mRingerModeAffectedStreams,UserHandle.USER_CURRENT);
    readDockAudioSettings(cr);
  }
  mMuteAffectedStreams=System.getIntForUser(cr,System.MUTE_STREAMS_AFFECTED,((1 << AudioSystem.STREAM_MUSIC) | (1 << AudioSystem.STREAM_RING) | (1 << AudioSystem.STREAM_SYSTEM)),UserHandle.USER_CURRENT);
  boolean masterMute=System.getIntForUser(cr,System.VOLUME_MASTER_MUTE,0,UserHandle.USER_CURRENT) == 1;
  if (mUseFixedVolume) {
    masterMute=false;
    AudioSystem.setMasterVolume(1.0f);
  }
  AudioSystem.setMasterMute(masterMute);
  broadcastMasterMuteStatus(masterMute);
  broadcastRingerMode(ringerMode);
  broadcastVibrateSetting(AudioManager.VIBRATE_TYPE_RINGER);
  broadcastVibrateSetting(AudioManager.VIBRATE_TYPE_NOTIFICATION);
}
