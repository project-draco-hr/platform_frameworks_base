{
  AudioDevicePort speaker=findAudioDevicePort(AudioSystem.DEVICE_OUT_SPEAKER);
  if (speaker == null) {
    Log.w(TAG,"Has no speaker output.");
    return;
  }
  AudioPortConfig portConfig=speaker.activeConfig();
  AudioGainConfig gainConfig=portConfig.gain();
  int[] newGains;
  if (on) {
    if (gainConfig == null) {
      Log.w(TAG,"Speaker has no gain control.");
      return;
    }
    mSpeakerGains=Arrays.copyOf(gainConfig.values(),gainConfig.values().length);
    newGains=new int[gainConfig.values().length];
  }
 else {
    if (mSpeakerGains == null) {
      Log.w(TAG,"mSpeakerGains should not be null.");
      return;
    }
    newGains=Arrays.copyOf(mSpeakerGains,mSpeakerGains.length);
  }
  gainConfig=gainConfig.mGain.buildConfig(gainConfig.mode(),gainConfig.channelMask(),newGains,gainConfig.rampDurationMs());
  AudioManager audioManager=(AudioManager)mContext.getSystemService(Context.AUDIO_SERVICE);
  if (AudioSystem.SUCCESS != audioManager.setAudioPortGain(speaker,gainConfig)) {
    Log.w(TAG,"Failed to update audio port config.");
  }
}
