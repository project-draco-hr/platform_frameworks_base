{
  if (mHdmiTvClient == null) {
    Log.w(TAG,"Only Hdmi-Cec enabled TV device supports system audio mode.");
    return;
  }
  if ((device & AudioSystem.DEVICE_OUT_ALL_HDMI_SYSTEM_AUDIO) == 0) {
    Log.w(TAG,"Unsupported Hdmi-Cec system audio output:" + device);
    return;
  }
  VolumeStreamState streamState=mStreamStates[AudioSystem.STREAM_MUSIC];
  int oldStreamDevice=getDeviceForStream(AudioSystem.STREAM_MUSIC);
  int oldIndex=streamState.getIndex(oldStreamDevice);
synchronized (mHdmiTvClient) {
    mHdmiSystemAudioSupported=on;
  }
  int newStreamDevice=getDeviceForStream(AudioSystem.STREAM_MUSIC);
  boolean updateSpeakerVolume=false;
  if (on) {
    if ((oldStreamDevice & AudioSystem.DEVICE_OUT_SPEAKER) != 0) {
      streamState.setIndex(0,AudioSystem.DEVICE_OUT_SPEAKER);
      updateSpeakerVolume=true;
    }
  }
 else {
    if ((newStreamDevice & AudioSystem.DEVICE_OUT_SPEAKER) != 0) {
      streamState.setIndex(oldIndex,AudioSystem.DEVICE_OUT_SPEAKER);
      updateSpeakerVolume=true;
    }
  }
  if (updateSpeakerVolume) {
    sendMsg(mAudioHandler,MSG_SET_DEVICE_VOLUME,SENDMSG_QUEUE,AudioSystem.DEVICE_OUT_SPEAKER,0,streamState,0);
  }
}
