{
  if (ringerMode != mRingerMode) {
    mRingerMode=ringerMode;
    if (mRingerMode == AudioManager.RINGER_MODE_NORMAL) {
      for (int streamType=AudioSystem.NUM_STREAMS - 1; streamType >= 0; streamType--) {
        if (!isStreamAffectedByRingerMode(streamType))         continue;
        setStreamVolumeInt(streamType,mStreamStates[streamType].mLastAudibleIndex);
      }
    }
 else {
      for (int streamType=AudioSystem.NUM_STREAMS - 1; streamType >= 0; streamType--) {
        if (!isStreamAffectedByRingerMode(streamType))         continue;
        setStreamVolumeInt(streamType,0);
      }
    }
    broadcastRingerMode();
    sendMsg(mAudioHandler,MSG_PERSIST_RINGER_MODE,SHARED_MSG,SENDMSG_REPLACE,0,0,null,PERSIST_DELAY);
  }
}
