{
synchronized (mSettingsLock) {
    mRingerMode=ringerMode;
  }
  int numStreamTypes=AudioSystem.getNumStreamTypes();
  for (int streamType=numStreamTypes - 1; streamType >= 0; streamType--) {
    if (isStreamMutedByRingerMode(streamType)) {
      if (!isStreamAffectedByRingerMode(streamType) || ringerMode == AudioManager.RINGER_MODE_NORMAL) {
        if (mVoiceCapable && mStreamVolumeAlias[streamType] == AudioSystem.STREAM_RING) {
synchronized (mStreamStates[streamType]) {
            Set set=mStreamStates[streamType].mLastAudibleIndex.entrySet();
            Iterator i=set.iterator();
            while (i.hasNext()) {
              Map.Entry entry=(Map.Entry)i.next();
              if ((Integer)entry.getValue() == 0) {
                entry.setValue(10);
              }
            }
          }
        }
        mStreamStates[streamType].mute(null,false);
        mRingerModeMutedStreams&=~(1 << streamType);
      }
    }
 else {
      if (isStreamAffectedByRingerMode(streamType) && ringerMode != AudioManager.RINGER_MODE_NORMAL) {
        mStreamStates[streamType].mute(null,true);
        mRingerModeMutedStreams|=(1 << streamType);
      }
    }
  }
  if (persist) {
    sendMsg(mAudioHandler,MSG_PERSIST_RINGER_MODE,SENDMSG_REPLACE,0,0,null,PERSIST_DELAY);
  }
}
