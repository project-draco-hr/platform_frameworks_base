{
  if (!isValidMediaKeyEvent(keyEvent)) {
    Log.e(TAG,"not dispatching invalid media key event " + keyEvent);
    return;
  }
synchronized (mRingingLock) {
    if (mIsRinging || (getMode() == AudioSystem.MODE_IN_CALL) || (getMode() == AudioSystem.MODE_IN_COMMUNICATION)|| (getMode() == AudioSystem.MODE_RINGTONE)) {
      return;
    }
  }
  if (needWakeLock) {
    mMediaEventWakeLock.acquire();
  }
  Intent keyIntent=new Intent(Intent.ACTION_MEDIA_BUTTON,null);
  keyIntent.putExtra(Intent.EXTRA_KEY_EVENT,keyEvent);
synchronized (mRCStack) {
    if (!mRCStack.empty()) {
      try {
        mRCStack.peek().mMediaIntent.send(mContext,needWakeLock ? WAKELOCK_RELEASE_ON_FINISHED : 0,keyIntent,AudioService.this,mAudioHandler);
      }
 catch (      CanceledException e) {
        Log.e(TAG,"Error sending pending intent " + mRCStack.peek());
        e.printStackTrace();
      }
    }
 else {
      if (needWakeLock) {
        keyIntent.putExtra(EXTRA_WAKELOCK_ACQUIRED,WAKELOCK_RELEASE_ON_FINISHED);
      }
      mContext.sendOrderedBroadcast(keyIntent,null,mKeyEventDone,mAudioHandler,Activity.RESULT_OK,null,null);
    }
  }
}
