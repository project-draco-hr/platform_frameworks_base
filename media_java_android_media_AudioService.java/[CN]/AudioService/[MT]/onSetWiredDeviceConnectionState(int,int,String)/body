{
synchronized (mConnectedDevices) {
    if ((state == 0) && ((device == AudioSystem.DEVICE_OUT_WIRED_HEADSET) || (device == AudioSystem.DEVICE_OUT_WIRED_HEADPHONE))) {
      setBluetoothA2dpOnInt(true);
    }
    boolean isUsb=((device & ~AudioSystem.DEVICE_OUT_ALL_USB) == 0) || (((device & AudioSystem.DEVICE_BIT_IN) != 0) && ((device & ~AudioSystem.DEVICE_IN_ALL_USB) == 0));
    handleDeviceConnection((state == 1),device,(isUsb ? name : ""));
    if (state != 0) {
      if ((device == AudioSystem.DEVICE_OUT_WIRED_HEADSET) || (device == AudioSystem.DEVICE_OUT_WIRED_HEADPHONE)) {
        setBluetoothA2dpOnInt(false);
      }
      if ((device & mSafeMediaVolumeDevices) != 0) {
        sendMsg(mAudioHandler,MSG_CHECK_MUSIC_ACTIVE,SENDMSG_REPLACE,0,0,null,MUSIC_ACTIVE_POLL_PERIOD_MS);
      }
    }
    if (!isUsb && (device != AudioSystem.DEVICE_IN_WIRED_HEADSET)) {
      sendDeviceConnectionIntent(device,state,name);
    }
  }
}
