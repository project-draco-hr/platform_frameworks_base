{
synchronized (mConnectedDevices) {
    if ((state == 0) && ((device == AudioSystem.DEVICE_OUT_WIRED_HEADSET) || (device == AudioSystem.DEVICE_OUT_WIRED_HEADPHONE))) {
      setBluetoothA2dpOnInt(true);
    }
    boolean isUsb=((device & AudioSystem.DEVICE_OUT_ALL_USB) != 0);
    handleDeviceConnection((state == 1),device,(isUsb ? name : ""));
    if ((state != 0) && ((device == AudioSystem.DEVICE_OUT_WIRED_HEADSET) || (device == AudioSystem.DEVICE_OUT_WIRED_HEADPHONE))) {
      setBluetoothA2dpOnInt(false);
    }
    if (!isUsb) {
      sendDeviceConnectionIntent(device,state,name);
    }
  }
}
