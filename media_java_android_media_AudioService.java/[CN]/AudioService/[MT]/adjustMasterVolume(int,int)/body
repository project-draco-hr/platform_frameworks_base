{
  ensureValidDirection(direction);
  float volume=AudioSystem.getMasterVolume();
  Log.d(TAG,"adjustMasterVolume old=" + volume);
  if (volume >= 0.0) {
    int oldVolume=getMasterVolume();
    if (direction == AudioManager.ADJUST_RAISE) {
      volume+=MASTER_VOLUME_INCREMENT;
      if (volume > 1.0f)       volume=1.0f;
    }
 else     if (direction == AudioManager.ADJUST_LOWER) {
      volume-=MASTER_VOLUME_INCREMENT;
      if (volume < 0.0f)       volume=0.0f;
    }
    AudioSystem.setMasterVolume(volume);
    sendMsg(mAudioHandler,MSG_PERSIST_MASTER_VOLUME,0,SENDMSG_REPLACE,Math.round(volume * (float)1000.0),0,null,PERSIST_DELAY);
    sendMasterVolumeUpdate(flags,oldVolume,getMasterVolume());
  }
  Log.d(TAG,"adjustMasterVolume new=" + volume);
}
