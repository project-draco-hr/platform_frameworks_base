{
synchronized (mSafeMediaVolumeState) {
    if (mSafeMediaVolumeState == SAFE_MEDIA_VOLUME_INACTIVE) {
      int device=getDeviceForStream(AudioSystem.STREAM_MUSIC);
      if ((device & mSafeMediaVolumeDevices) != 0) {
        sendMsg(mAudioHandler,MSG_CHECK_MUSIC_ACTIVE,SENDMSG_REPLACE,0,0,null,MUSIC_ACTIVE_POLL_PERIOD_MS);
        int index=mStreamStates[AudioSystem.STREAM_MUSIC].getIndex(device);
        if (AudioSystem.isStreamActive(AudioSystem.STREAM_MUSIC,0) && (index > mSafeMediaVolumeIndex)) {
          mMusicActiveMs+=MUSIC_ACTIVE_POLL_PERIOD_MS;
          if (mMusicActiveMs > UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX) {
            setSafeMediaVolumeEnabled(true);
            mMusicActiveMs=0;
          }
        }
      }
    }
  }
}
