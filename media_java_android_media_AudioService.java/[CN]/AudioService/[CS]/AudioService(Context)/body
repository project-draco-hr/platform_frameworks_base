{
  mContext=context;
  mContentResolver=context.getContentResolver();
  mVoiceCapable=mContext.getResources().getBoolean(com.android.internal.R.bool.config_voice_capable);
  mSafeMediaVolumeIndex=mContext.getResources().getInteger(com.android.internal.R.integer.config_safe_media_volume_index) * 10;
  PowerManager pm=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mMediaEventWakeLock=pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"handleMediaEvent");
  Vibrator vibrator=(Vibrator)context.getSystemService(Context.VIBRATOR_SERVICE);
  mHasVibrator=vibrator == null ? false : vibrator.hasVibrator();
  MAX_STREAM_VOLUME[AudioSystem.STREAM_VOICE_CALL]=SystemProperties.getInt("ro.config.vc_call_vol_steps",MAX_STREAM_VOLUME[AudioSystem.STREAM_VOICE_CALL]);
  sSoundEffectVolumeDb=context.getResources().getInteger(com.android.internal.R.integer.config_soundEffectVolumeDb);
  mVolumePanel=new VolumePanel(context,this);
  mMode=AudioSystem.MODE_NORMAL;
  mForcedUseForComm=AudioSystem.FORCE_NONE;
  createAudioSystemThread();
  readPersistedSettings();
  mSettingsObserver=new SettingsObserver();
  updateStreamVolumeAlias(false);
  createStreamStates();
synchronized (mSafeMediaVolumeEnabled) {
    enforceSafeMediaVolume();
  }
  mMediaServerOk=true;
  mRingerModeMutedStreams=0;
  setRingerModeInt(getRingerMode(),false);
  AudioSystem.setErrorCallback(mAudioSystemCallback);
  IntentFilter intentFilter=new IntentFilter(BluetoothHeadset.ACTION_AUDIO_STATE_CHANGED);
  intentFilter.addAction(BluetoothHeadset.ACTION_CONNECTION_STATE_CHANGED);
  intentFilter.addAction(Intent.ACTION_DOCK_EVENT);
  intentFilter.addAction(Intent.ACTION_USB_AUDIO_ACCESSORY_PLUG);
  intentFilter.addAction(Intent.ACTION_USB_AUDIO_DEVICE_PLUG);
  intentFilter.addAction(Intent.ACTION_BOOT_COMPLETED);
  intentFilter.addAction(Intent.ACTION_SCREEN_ON);
  intentFilter.addAction(Intent.ACTION_SCREEN_OFF);
  intentFilter.addAction(Intent.ACTION_USER_SWITCHED);
  if (SystemProperties.getBoolean("ro.audio.monitorOrientation",false)) {
    Log.v(TAG,"monitoring device orientation");
    intentFilter.addAction(Intent.ACTION_CONFIGURATION_CHANGED);
    setOrientationForAudioSystem();
  }
  context.registerReceiver(mReceiver,intentFilter);
  IntentFilter pkgFilter=new IntentFilter();
  pkgFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  pkgFilter.addDataScheme("package");
  context.registerReceiver(mReceiver,pkgFilter);
  TelephonyManager tmgr=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  tmgr.listen(mPhoneStateListener,PhoneStateListener.LISTEN_CALL_STATE);
  mUseMasterVolume=context.getResources().getBoolean(com.android.internal.R.bool.config_useMasterVolume);
  restoreMasterVolume();
  mMasterVolumeRamp=context.getResources().getIntArray(com.android.internal.R.array.config_masterVolumeRamp);
  mMainRemote=new RemotePlaybackState(-1,MAX_STREAM_VOLUME[AudioManager.STREAM_MUSIC],MAX_STREAM_VOLUME[AudioManager.STREAM_MUSIC]);
  mHasRemotePlayback=false;
  mMainRemoteIsActive=false;
  postReevaluateRemote();
}
