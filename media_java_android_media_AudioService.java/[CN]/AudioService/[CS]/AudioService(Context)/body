{
  mContext=context;
  mContentResolver=context.getContentResolver();
  mVoiceCapable=mContext.getResources().getBoolean(com.android.internal.R.bool.config_voice_capable);
  MAX_STREAM_VOLUME[AudioSystem.STREAM_VOICE_CALL]=SystemProperties.getInt("ro.config.vc_call_vol_steps",MAX_STREAM_VOLUME[AudioSystem.STREAM_VOICE_CALL]);
  SOUND_EFFECT_VOLUME_DB=SystemProperties.getInt("ro.config.sound_fx_volume",SOUND_EFFECT_DEFAULT_VOLUME_DB);
  mVolumePanel=new VolumePanel(context,this);
  mForcedUseForComm=AudioSystem.FORCE_NONE;
  createAudioSystemThread();
  readPersistedSettings();
  mSettingsObserver=new SettingsObserver();
  createStreamStates();
  mMode=AudioSystem.MODE_NORMAL;
  mMediaServerOk=true;
  mRingerModeMutedStreams=0;
  setRingerModeInt(getRingerMode(),false);
  AudioSystem.setErrorCallback(mAudioSystemCallback);
  IntentFilter intentFilter=new IntentFilter(Intent.ACTION_HEADSET_PLUG);
  intentFilter.addAction(BluetoothA2dp.ACTION_CONNECTION_STATE_CHANGED);
  intentFilter.addAction(BluetoothHeadset.ACTION_AUDIO_STATE_CHANGED);
  intentFilter.addAction(BluetoothHeadset.ACTION_CONNECTION_STATE_CHANGED);
  intentFilter.addAction(Intent.ACTION_DOCK_EVENT);
  intentFilter.addAction(Intent.ACTION_USB_ANLG_HEADSET_PLUG);
  intentFilter.addAction(Intent.ACTION_USB_DGTL_HEADSET_PLUG);
  intentFilter.addAction(Intent.ACTION_HDMI_AUDIO_PLUG);
  intentFilter.addAction(Intent.ACTION_BOOT_COMPLETED);
  intentFilter.addAction(Intent.ACTION_SCREEN_ON);
  intentFilter.addAction(Intent.ACTION_SCREEN_OFF);
  context.registerReceiver(mReceiver,intentFilter);
  IntentFilter pkgFilter=new IntentFilter();
  pkgFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  pkgFilter.addDataScheme("package");
  context.registerReceiver(mReceiver,pkgFilter);
  intentFilter=new IntentFilter(Intent.ACTION_MEDIA_BUTTON);
  intentFilter.setPriority(Integer.MAX_VALUE);
  context.registerReceiver(mMediaButtonReceiver,intentFilter);
  TelephonyManager tmgr=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  tmgr.listen(mPhoneStateListener,PhoneStateListener.LISTEN_CALL_STATE);
  if (context.getResources().getBoolean(com.android.internal.R.bool.config_useMasterVolume)) {
    float volume=Settings.System.getFloat(mContentResolver,Settings.System.VOLUME_MASTER,-1.0f);
    if (volume >= 0.0f) {
      AudioSystem.setMasterVolume(volume);
    }
  }
}
