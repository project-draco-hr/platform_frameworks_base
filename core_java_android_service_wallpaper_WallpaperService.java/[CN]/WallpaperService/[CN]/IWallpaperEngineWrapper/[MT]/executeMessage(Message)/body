{
switch (message.what) {
case DO_ATTACH:
{
      Engine engine=onCreateEngine();
      mEngine=engine;
      engine.attach(this);
      return;
    }
case DO_DETACH:
{
    mEngine.detach();
    return;
  }
case MSG_UPDATE_SURFACE:
mEngine.updateSurface(false);
break;
case MSG_VISIBILITY_CHANGED:
if (DEBUG) Log.v(TAG,"Visibility change in " + mEngine + ": "+ message.arg1);
mEngine.onVisibilityChanged(message.arg1 != 0);
break;
case MSG_WALLPAPER_OFFSETS:
{
float xOffset;
float yOffset;
synchronized (mEngine.mLock) {
xOffset=mEngine.mPendingXOffset;
yOffset=mEngine.mPendingYOffset;
mEngine.mOffsetMessageEnqueued=false;
}
if (DEBUG) Log.v(TAG,"Offsets change in " + mEngine + ": "+ xOffset+ ","+ yOffset);
final int availw=mReqWidth - mEngine.mCurWidth;
final int xPixels=availw > 0 ? -(int)(availw * xOffset + .5f) : 0;
final int availh=mReqHeight - mEngine.mCurHeight;
final int yPixels=availh > 0 ? -(int)(availh * yOffset + .5f) : 0;
mEngine.onOffsetsChanged(xOffset,yOffset,xPixels,yPixels);
}
break;
default :
Log.w(TAG,"Unknown message type " + message.what);
}
}
