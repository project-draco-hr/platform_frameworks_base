{
  enforceCallingPermission();
synchronized (this) {
    if (mOnBattery != onBattery) {
      if (onBattery) {
        mTrackBatteryUptimeStart=SystemClock.uptimeMillis();
        mTrackBatteryRealtimeStart=SystemClock.elapsedRealtime();
      }
 else {
        mTrackBatteryPastUptime+=SystemClock.uptimeMillis() - mTrackBatteryUptimeStart;
        mTrackBatteryPastRealtime+=SystemClock.elapsedRealtime() - mTrackBatteryRealtimeStart;
      }
      mOnBattery=onBattery;
    }
  }
}
