{
  int childCount=mChildren.size();
  int yPosition=mNotificationHeaderHeight;
  boolean firstChild=true;
  int maxAllowedVisibleChildren=getMaxAllowedVisibleChildren();
  int lastVisibleIndex=maxAllowedVisibleChildren - 1;
  float expandFactor=0;
  if (mUserLocked) {
    expandFactor=getChildExpandFraction();
  }
  for (int i=0; i < childCount; i++) {
    ExpandableNotificationRow child=mChildren.get(i);
    if (!firstChild) {
      if (mUserLocked) {
        yPosition+=NotificationUtils.interpolate(mChildPadding,mDividerHeight,expandFactor);
      }
 else {
        yPosition+=mChildrenExpanded ? mDividerHeight : mChildPadding;
      }
    }
 else {
      if (mUserLocked) {
        yPosition+=NotificationUtils.interpolate(0,mNotificatonTopPadding + mDividerHeight,expandFactor);
      }
 else {
        yPosition+=mChildrenExpanded ? mNotificatonTopPadding + mDividerHeight : 0;
      }
      firstChild=false;
    }
    StackViewState childState=resultState.getViewStateForView(child);
    int intrinsicHeight=child.getIntrinsicHeight();
    childState.yTranslation=yPosition;
    childState.zTranslation=0;
    childState.height=intrinsicHeight;
    childState.dimmed=parentState.dimmed;
    childState.dark=parentState.dark;
    childState.hideSensitive=parentState.hideSensitive;
    childState.belowSpeedBump=parentState.belowSpeedBump;
    childState.clipTopAmount=0;
    childState.topOverLap=0;
    boolean visible=i <= lastVisibleIndex;
    childState.alpha=visible ? 1 : 0;
    childState.location=parentState.location;
    yPosition+=intrinsicHeight;
  }
}
