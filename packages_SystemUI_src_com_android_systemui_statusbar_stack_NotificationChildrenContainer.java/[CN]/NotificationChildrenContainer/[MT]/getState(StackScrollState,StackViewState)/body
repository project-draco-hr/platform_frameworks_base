{
  int childCount=mChildren.size();
  int yPosition=mNotificationHeaderHeight;
  boolean firstChild=true;
  int maxAllowedVisibleChildren=getMaxAllowedVisibleChildren();
  boolean hasOverflow=!mChildrenExpanded && childCount > maxAllowedVisibleChildren && maxAllowedVisibleChildren != NUMBER_OF_CHILDREN_WHEN_CHILDREN_EXPANDED;
  int lastVisibleIndex=hasOverflow ? maxAllowedVisibleChildren - 2 : maxAllowedVisibleChildren - 1;
  for (int i=0; i < childCount; i++) {
    ExpandableNotificationRow child=mChildren.get(i);
    if (!firstChild) {
      yPosition+=mChildPadding;
    }
 else {
      if (child.hasSameBgColor(mNotificationParent)) {
        yPosition-=mHeaderTopPaddingSubstraction;
      }
      firstChild=false;
    }
    StackViewState childState=resultState.getViewStateForView(child);
    int intrinsicHeight=child.getIntrinsicHeight();
    childState.yTranslation=yPosition;
    childState.zTranslation=0;
    childState.height=intrinsicHeight;
    childState.dimmed=parentState.dimmed;
    childState.dark=parentState.dark;
    childState.hideSensitive=parentState.hideSensitive;
    childState.belowSpeedBump=parentState.belowSpeedBump;
    childState.scale=1.0f;
    childState.clipTopAmount=0;
    childState.topOverLap=0;
    boolean visible=i <= lastVisibleIndex;
    childState.alpha=visible ? 1 : 0;
    childState.location=parentState.location;
    yPosition+=intrinsicHeight;
  }
  if (mGroupOverflowContainer != null) {
    mGroupOverFlowState.initFrom(mGroupOverflowContainer);
    if (hasOverflow) {
      StackViewState firstOverflowState=resultState.getViewStateForView(mChildren.get(lastVisibleIndex + 1));
      mGroupOverFlowState.yTranslation=firstOverflowState.yTranslation;
    }
    mGroupOverFlowState.alpha=mChildrenExpanded || !hasOverflow ? 0.0f : 1.0f;
  }
}
