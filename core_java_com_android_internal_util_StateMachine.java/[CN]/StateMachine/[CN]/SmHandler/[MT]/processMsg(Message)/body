{
  StateInfo curStateInfo=mStateStack[mStateStackTopIndex];
  if (mDbg) {
    Log.d(TAG,"processMsg: " + curStateInfo.state.getName());
  }
  if (isQuit(msg)) {
    transitionTo(mQuittingState);
  }
 else {
    while (!curStateInfo.state.processMessage(msg)) {
      curStateInfo=curStateInfo.parentStateInfo;
      if (curStateInfo == null) {
        mSm.unhandledMessage(msg);
        break;
      }
      if (mDbg) {
        Log.d(TAG,"processMsg: " + curStateInfo.state.getName());
      }
    }
    if (mSm.recordLogRec(msg)) {
      if (curStateInfo != null) {
        State orgState=mStateStack[mStateStackTopIndex].state;
        mLogRecords.add(msg,mSm.getLogRecString(msg),curStateInfo.state,orgState);
      }
 else {
        mLogRecords.add(msg,mSm.getLogRecString(msg),null,null);
      }
    }
  }
}
