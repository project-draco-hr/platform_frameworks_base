{
  State destState=null;
  State orgState=mStateStack[mStateStackTopIndex].state;
  boolean recordLogMsg=mSm.recordLogRec(mMsg);
  while (mDestState != null) {
    if (mDbg)     Log.d(TAG,"handleMessage: new destination call exit");
    destState=mDestState;
    mDestState=null;
    StateInfo commonStateInfo=setupTempStateStackWithStatesToEnter(destState);
    invokeExitMethods(commonStateInfo);
    int stateStackEnteringIndex=moveTempStateStackToStateStack();
    invokeEnterMethods(stateStackEnteringIndex);
    moveDeferredMessageAtFrontOfQueue();
  }
  if (destState != null) {
    if (destState == mQuittingState) {
      mSm.onQuitting();
      cleanupAfterQuitting();
    }
 else     if (destState == mHaltingState) {
      mSm.onHalting();
    }
  }
  if (mLogRecords.logOnlyTransitions()) {
    if (destState != null) {
      mLogRecords.add(mMsg,mSm.getLogRecString(mMsg),msgProcessedState,orgState,destState);
    }
  }
 else   if (recordLogMsg) {
    mLogRecords.add(mMsg,mSm.getLogRecString(mMsg),msgProcessedState,orgState,destState);
  }
}
