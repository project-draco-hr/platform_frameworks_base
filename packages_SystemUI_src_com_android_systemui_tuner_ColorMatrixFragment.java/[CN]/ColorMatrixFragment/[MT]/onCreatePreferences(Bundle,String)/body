{
  final Context context=getPreferenceManager().getContext();
  setPreferenceScreen(getPreferenceManager().createPreferenceScreen(context));
  mSelectPreference=new DropDownPreference(context);
  mSelectPreference.setTitle(R.string.color_transform);
  mSelectPreference.setSummary("%s");
  mSelectPreference.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener(){
    @Override public boolean onPreferenceChange(    Preference preference,    Object newValue){
      if (Objects.equals(newValue,DisplayController.AUTO_STRING)) {
        Settings.Secure.putInt(context.getContentResolver(),DisplayController.COLOR_STATE,DisplayController.COLOR_STATE_AUTO);
        return true;
      }
      if (Objects.equals(newValue,DisplayController.NONE_STRING)) {
        Settings.Secure.putString(context.getContentResolver(),Settings.Secure.ACCESSIBILITY_DISPLAY_COLOR_MATRIX,null);
        return true;
      }
      Settings.Secure.putInt(context.getContentResolver(),DisplayController.COLOR_STATE,DisplayController.COLOR_STATE_ENABLED);
      final String value=(String)newValue;
      Settings.Secure.putString(context.getContentResolver(),Settings.Secure.ACCESSIBILITY_DISPLAY_COLOR_MATRIX,value);
      return true;
    }
  }
);
  getPreferenceScreen().addPreference(mSelectPreference);
  mEnableCustomPreference=new SwitchPreference(context);
  mEnableCustomPreference.setTitle(R.string.color_enable_custom);
  mEnableCustomPreference.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener(){
    @Override public boolean onPreferenceChange(    Preference preference,    Object newValue){
      boolean enabled=(Boolean)newValue;
      if (!enabled && Objects.equals(mCurrentValue,mCustomValues)) {
        Settings.Secure.putString(context.getContentResolver(),Settings.Secure.ACCESSIBILITY_DISPLAY_COLOR_MATRIX,null);
      }
      Settings.Secure.putInt(context.getContentResolver(),DisplayController.COLOR_MATRIX_CUSTOM_ENABLED,enabled ? 1 : 0);
      return true;
    }
  }
);
  getPreferenceScreen().addPreference(mEnableCustomPreference);
  mCustomPreference=new MatrixPreference(context);
  getPreferenceScreen().addPreference(mCustomPreference);
}
