{
  if (DBG)   Log.d(TAG,getName() + message.toString() + "\n");
  WpsConfiguration wpsConfig;
switch (message.what) {
case WifiStateMachine.CMD_START_WPS:
    mWpsConfig=(WpsConfiguration)message.obj;
  boolean success=false;
switch (mWpsConfig.setup) {
case PBC:
  success=WifiConfigStore.startWpsPbc(mWpsConfig);
break;
case PIN_FROM_ACCESS_POINT:
success=WifiConfigStore.startWpsWithPinFromAccessPoint(mWpsConfig);
break;
case PIN_FROM_DEVICE:
String pin=WifiConfigStore.startWpsWithPinFromDevice(mWpsConfig);
success=(pin != null);
mReplyChannel.replyToMessage(message,message.what,pin);
break;
default :
Log.e(TAG,"Invalid setup for WPS");
break;
}
if (success) {
transitionTo(mActiveState);
}
 else {
Log.e(TAG,"Failed to start WPS with config " + mWpsConfig.toString());
}
break;
default :
Log.e(TAG,"Failed to handle " + message);
break;
}
return HANDLED;
}
