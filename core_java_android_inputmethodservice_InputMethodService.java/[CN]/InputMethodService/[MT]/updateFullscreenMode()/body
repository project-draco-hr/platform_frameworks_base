{
  boolean isFullscreen=mShowInputRequested && onEvaluateFullscreenMode();
  boolean changed=mLastShowInputRequested != mShowInputRequested;
  if (mIsFullscreen != isFullscreen || !mFullscreenApplied) {
    changed=true;
    mIsFullscreen=isFullscreen;
    InputConnection ic=getCurrentInputConnection();
    if (ic != null)     ic.reportFullscreenMode(isFullscreen);
    mFullscreenApplied=true;
    initialize();
    Drawable bg=onCreateBackgroundDrawable();
    if (bg == null) {
      bg=getResources().getDrawable(android.R.color.transparent);
    }
    mWindow.getWindow().setBackgroundDrawable(bg);
    mExtractFrame.setVisibility(isFullscreen ? View.VISIBLE : View.GONE);
    if (isFullscreen) {
      if (mExtractView == null) {
        View v=onCreateExtractTextView();
        if (v != null) {
          setExtractView(v);
        }
      }
      startExtractingText(false);
    }
  }
  if (changed) {
    onConfigureWindow(mWindow.getWindow(),isFullscreen,!mShowInputRequested);
    mLastShowInputRequested=mShowInputRequested;
  }
}
