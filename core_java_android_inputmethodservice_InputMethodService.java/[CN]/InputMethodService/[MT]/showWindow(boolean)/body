{
  if (DEBUG)   Log.v(TAG,"Showing window: showInput=" + showInput + " mShowInputRequested="+ mShowInputRequested+ " mWindowAdded="+ mWindowAdded+ " mWindowCreated="+ mWindowCreated+ " mWindowVisible="+ mWindowVisible+ " mInputStarted="+ mInputStarted);
  boolean doShowInput=false;
  boolean wasVisible=mWindowVisible;
  boolean wasCreated=mWindowCreated;
  mWindowVisible=true;
  if (!mShowInputRequested) {
    if (mInputStarted) {
      if (showInput) {
        doShowInput=true;
        mShowInputRequested=true;
      }
    }
  }
 else {
    showInput=true;
  }
  if (DEBUG)   Log.v(TAG,"showWindow: updating UI");
  initialize();
  updateFullscreenMode();
  updateInputViewShown();
  if (!mWindowAdded || !mWindowCreated) {
    mWindowAdded=true;
    mWindowCreated=true;
    initialize();
    if (DEBUG)     Log.v(TAG,"CALL: onCreateCandidatesView");
    View v=onCreateCandidatesView();
    if (DEBUG)     Log.v(TAG,"showWindow: candidates=" + v);
    if (v != null) {
      setCandidatesView(v);
    }
  }
  if (mShowInputRequested) {
    if (!mInputViewStarted) {
      if (DEBUG)       Log.v(TAG,"CALL: onStartInputView");
      mInputViewStarted=true;
      onStartInputView(mInputEditorInfo,false);
    }
  }
 else   if (!mCandidatesViewStarted) {
    if (DEBUG)     Log.v(TAG,"CALL: onStartCandidatesView");
    mCandidatesViewStarted=true;
    onStartCandidatesView(mInputEditorInfo,false);
  }
  if (doShowInput) {
    startExtractingText();
  }
  if (!wasVisible) {
    if (DEBUG)     Log.v(TAG,"showWindow: showing!");
    mWindow.show();
  }
  if (!wasVisible || !wasCreated) {
    InputConnection ic=getCurrentInputConnection();
    if (ic != null) {
      ic.showStatusIcon(getPackageName(),mStatusIcon);
    }
  }
}
