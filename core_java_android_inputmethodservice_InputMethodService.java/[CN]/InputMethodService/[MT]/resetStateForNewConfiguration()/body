{
  boolean visible=mWindowVisible;
  int showFlags=mShowInputFlags;
  boolean showingInput=mShowInputRequested;
  CompletionInfo[] completions=mCurCompletions;
  initViews();
  mInputViewStarted=false;
  mCandidatesViewStarted=false;
  if (mInputStarted) {
    doStartInput(getCurrentInputConnection(),getCurrentInputEditorInfo(),true);
  }
  if (visible) {
    if (showingInput) {
      if (dispatchOnShowInputRequested(showFlags,true)) {
        showWindow(true);
        if (completions != null) {
          mCurCompletions=completions;
          onDisplayCompletions(completions);
        }
      }
 else {
        doHideWindow();
      }
    }
 else     if (mCandidatesVisibility == View.VISIBLE) {
      showWindow(false);
    }
 else {
      doHideWindow();
    }
    boolean showing=onEvaluateInputViewShown();
    mImm.setImeWindowStatus(mToken,IME_ACTIVE | (showing ? IME_VISIBLE : 0),mBackDisposition);
  }
}
