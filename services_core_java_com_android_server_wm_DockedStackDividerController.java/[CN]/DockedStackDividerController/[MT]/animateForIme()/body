{
  boolean updated=false;
  boolean animating=false;
  final ArrayList<TaskStack> stacks=mDisplayContent.getStacks();
  for (int i=stacks.size() - 1; i >= 0; --i) {
    final TaskStack stack=stacks.get(i);
    if (stack != null && stack.isAdjustedForIme()) {
      updated|=stack.updateAdjustForIme();
      animating|=stack.isAnimatingForIme();
    }
  }
  if (updated) {
    mService.mWindowPlacerLocked.performSurfacePlacement();
  }
  if (!animating) {
    mAnimatingForIme=false;
    for (int i=stacks.size() - 1; i >= 0; --i) {
      final TaskStack stack=stacks.get(i);
      if (stack != null) {
        stack.clearImeGoingAway();
      }
    }
  }
  return animating;
}
