{
  if (pdu == null || pdu.length < PDU_HEADER_LENGTH) {
    throw new IllegalArgumentException("Illegal PDU");
  }
  if (pdu.length <= PDU_LENGTH_ETWS) {
    format=FORMAT_ETWS_PRIMARY;
    geographicalScope=(pdu[0] & 0xc0) >> 6;
    serialNumber=((pdu[0] & 0xff) << 8) | (pdu[1] & 0xff);
    messageIdentifier=((pdu[2] & 0xff) << 8) | (pdu[3] & 0xff);
    dataCodingScheme=-1;
    pageIndex=-1;
    nrOfPages=-1;
    boolean emergencyUserAlert=(pdu[4] & 0x1) != 0;
    boolean activatePopup=(pdu[5] & 0x80) != 0;
    int warningType=(pdu[4] & 0xfe) >> 1;
    byte[] warningSecurityInfo;
    if (pdu.length > PDU_HEADER_LENGTH) {
      warningSecurityInfo=Arrays.copyOfRange(pdu,6,pdu.length);
    }
 else {
      warningSecurityInfo=null;
    }
    mEtwsInfo=new SmsCbEtwsInfo(warningType,emergencyUserAlert,activatePopup,warningSecurityInfo);
    mCmasInfo=null;
    return;
  }
 else   if (pdu.length <= PDU_LENGTH_GSM) {
    format=FORMAT_GSM;
    geographicalScope=(pdu[0] & 0xc0) >> 6;
    serialNumber=((pdu[0] & 0xff) << 8) | (pdu[1] & 0xff);
    messageIdentifier=((pdu[2] & 0xff) << 8) | (pdu[3] & 0xff);
    dataCodingScheme=pdu[4] & 0xff;
    int pageIndex=(pdu[5] & 0xf0) >> 4;
    int nrOfPages=pdu[5] & 0x0f;
    if (pageIndex == 0 || nrOfPages == 0 || pageIndex > nrOfPages) {
      pageIndex=1;
      nrOfPages=1;
    }
    this.pageIndex=pageIndex;
    this.nrOfPages=nrOfPages;
  }
 else {
    format=FORMAT_UMTS;
    int messageType=pdu[0];
    if (messageType != MESSAGE_TYPE_CBS_MESSAGE) {
      throw new IllegalArgumentException("Unsupported message type " + messageType);
    }
    messageIdentifier=((pdu[1] & 0xff) << 8) | pdu[2] & 0xff;
    geographicalScope=(pdu[3] & 0xc0) >> 6;
    serialNumber=((pdu[3] & 0xff) << 8) | (pdu[4] & 0xff);
    dataCodingScheme=pdu[5] & 0xff;
    pageIndex=1;
    nrOfPages=1;
  }
  if (isEtwsMessage()) {
    boolean emergencyUserAlert=isEtwsEmergencyUserAlert();
    boolean activatePopup=isEtwsPopupAlert();
    int warningType=getEtwsWarningType();
    mEtwsInfo=new SmsCbEtwsInfo(warningType,emergencyUserAlert,activatePopup,null);
    mCmasInfo=null;
  }
 else   if (isCmasMessage()) {
    int messageClass=getCmasMessageClass();
    int severity=getCmasSeverity();
    int urgency=getCmasUrgency();
    int certainty=getCmasCertainty();
    mEtwsInfo=null;
    mCmasInfo=new SmsCbCmasInfo(messageClass,SmsCbCmasInfo.CMAS_CATEGORY_UNKNOWN,SmsCbCmasInfo.CMAS_RESPONSE_TYPE_UNKNOWN,severity,urgency,certainty);
  }
 else {
    mEtwsInfo=null;
    mCmasInfo=null;
  }
}
