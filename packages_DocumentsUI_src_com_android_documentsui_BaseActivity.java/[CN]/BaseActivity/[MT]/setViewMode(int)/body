{
  checkState(mState.stack.root != null);
  LocalPreferences.setViewMode(this,mState.stack.root,mode);
  mState.derivedMode=mode;
  invalidateOptionsMenu();
  DirectoryFragment dir=getDirectoryFragment();
  if (dir != null) {
    dir.onViewModeChanged();
  }
  ;
}
