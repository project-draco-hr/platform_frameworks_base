{
  if (icicle != null) {
    State state=icicle.<State>getParcelable(Shared.EXTRA_STATE);
    if (DEBUG)     Log.d(mTag,"Recovered existing state object: " + state);
    return state;
  }
  State state=new State();
  final Intent intent=getIntent();
  state.localOnly=intent.getBooleanExtra(Intent.EXTRA_LOCAL_ONLY,false);
  state.forceSize=intent.getBooleanExtra(DocumentsContract.EXTRA_SHOW_FILESIZE,false);
  state.showSize=state.forceSize || LocalPreferences.getDisplayFileSize(this);
  state.initAcceptMimes(intent);
  state.excludedAuthorities=getExcludedAuthorities();
  includeState(state);
  boolean forceAdvanced=Shared.shouldShowDeviceRoot(this,intent);
  boolean chosenAdvanced=LocalPreferences.getShowDeviceRoot(this,state.action);
  state.showAdvanced=forceAdvanced || chosenAdvanced;
  state.showAdvancedOption=!forceAdvanced && (Shared.shouldShowFancyFeatures(this) || state.action == ACTION_OPEN || state.action == ACTION_CREATE || state.action == ACTION_OPEN_TREE || state.action == ACTION_PICK_COPY_DESTINATION || state.action == ACTION_GET_CONTENT);
  if (DEBUG)   Log.d(mTag,"Created new state object: " + state);
  return state;
}
