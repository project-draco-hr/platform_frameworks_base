{
  if (mBeginTransition != null) {
    final long transitionDurationMs=mBeginTransition.getDuration();
    final List<Effect> effects=getAllEffects();
    for (    Effect effect : effects) {
      if (effect.getStartTime() < transitionDurationMs) {
        mBeginTransition.invalidate();
        break;
      }
    }
  }
  if (mEndTransition != null) {
    final long transitionDurationMs=mEndTransition.getDuration();
    final List<Effect> effects=getAllEffects();
    for (    Effect effect : effects) {
      if (effect.getStartTime() + effect.getDuration() > mDurationMs - transitionDurationMs) {
        mEndTransition.invalidate();
        break;
      }
    }
    if (mEndTransition.isGenerated()) {
      final List<Overlay> overlays=getAllOverlays();
      for (      Overlay overlay : overlays) {
        if (overlay.getStartTime() + overlay.getDuration() > mDurationMs - transitionDurationMs) {
          mEndTransition.invalidate();
          break;
        }
      }
    }
  }
  mDurationMs=durationMs;
  adjustTransitions();
  adjustOverlays();
  adjustEffects();
}
