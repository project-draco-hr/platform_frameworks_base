{
  if (mForegroundAppPkgName != null && !mForegroundAppPkgName.equals(appPkgName)) {
    if (isForegroundApp(mForegroundAppPkgName)) {
      if (DBG)       logd("application is NOT foreground");
      return false;
    }
    sendDetachedMsg(WifiP2pManager.NOT_IN_FOREGROUND);
  }
  if (isReset) {
    if (DBG)     logd("reset dialog listener");
    mForegroundAppMessenger=null;
    mForegroundAppPkgName=null;
    return true;
  }
  if (!isForegroundApp(appPkgName)) {
    return false;
  }
  mForegroundAppMessenger=m;
  mForegroundAppPkgName=appPkgName;
  if (DBG)   logd("set dialog listener. app=" + appPkgName);
  return true;
}
