{
  Collection<WifiP2pDevice> devices=mGroup.getClientList();
  boolean changed=false;
  for (  WifiP2pDevice d : mPeers.getDeviceList()) {
    if (devices.contains(d) || mGroup.getOwner().equals(d)) {
      d.status=WifiP2pDevice.AVAILABLE;
      changed=true;
    }
  }
  if (mGroup.isGroupOwner()) {
    stopDhcpServer(mGroup.getInterface());
  }
 else {
    if (DBG)     logd("stop DHCP client");
    mDhcpStateMachine.sendMessage(DhcpStateMachine.CMD_STOP_DHCP);
    mDhcpStateMachine.doQuit();
    mDhcpStateMachine=null;
  }
  try {
    mNwService.clearInterfaceAddresses(mGroup.getInterface());
  }
 catch (  Exception e) {
    loge("Failed to clear addresses " + e);
  }
  NetworkUtils.resetConnections(mGroup.getInterface(),NetworkUtils.RESET_ALL_ADDRESSES);
  mGroup=null;
  mWifiNative.p2pFlush();
  if (mPeers.remove(mPeersLostDuringConnection))   sendP2pPeersChangedBroadcast();
  mPeersLostDuringConnection.clear();
  mServiceDiscReqId=null;
  if (changed)   sendP2pPeersChangedBroadcast();
}
