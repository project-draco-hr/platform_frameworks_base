{
  final WifiDisplayStatus oldStatus=sStatic.mLastKnownWifiDisplayStatus;
  boolean wantScan=false;
  boolean blockScan=false;
  WifiDisplay[] oldDisplays=oldStatus != null ? oldStatus.getDisplays() : WifiDisplay.EMPTY_ARRAY;
  WifiDisplay[] newDisplays;
  WifiDisplay activeDisplay;
  if (newStatus.getFeatureState() == WifiDisplayStatus.FEATURE_STATE_ON) {
    newDisplays=newStatus.getDisplays();
    activeDisplay=newStatus.getActiveDisplay();
  }
 else {
    newDisplays=WifiDisplay.EMPTY_ARRAY;
    activeDisplay=null;
  }
  for (int i=0; i < newDisplays.length; i++) {
    final WifiDisplay d=newDisplays[i];
    if (d.isRemembered()) {
      RouteInfo route=findWifiDisplayRoute(d);
      if (route == null) {
        route=makeWifiDisplayRoute(d,newStatus);
        addRouteStatic(route);
        wantScan=true;
      }
 else {
        updateWifiDisplayRoute(route,d,newStatus);
      }
      if (d.equals(activeDisplay)) {
        selectRouteStatic(route.getSupportedTypes(),route);
        blockScan=true;
      }
    }
  }
  for (int i=0; i < oldDisplays.length; i++) {
    final WifiDisplay d=oldDisplays[i];
    if (d.isRemembered()) {
      final WifiDisplay newDisplay=findMatchingDisplay(d,newDisplays);
      if (newDisplay == null || !newDisplay.isRemembered()) {
        removeRoute(findWifiDisplayRoute(d));
      }
    }
  }
  if (wantScan && !blockScan) {
    sStatic.mDisplayService.scanWifiDisplays();
  }
  sStatic.mLastKnownWifiDisplayStatus=newStatus;
}
