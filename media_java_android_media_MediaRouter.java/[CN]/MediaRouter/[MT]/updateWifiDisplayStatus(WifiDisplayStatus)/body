{
  WifiDisplay[] displays;
  WifiDisplay activeDisplay;
  if (status.getFeatureState() == WifiDisplayStatus.FEATURE_STATE_ON) {
    displays=status.getDisplays();
    activeDisplay=status.getActiveDisplay();
    if (!sStatic.mCanConfigureWifiDisplays) {
      if (activeDisplay != null) {
        displays=new WifiDisplay[]{activeDisplay};
      }
 else {
        displays=WifiDisplay.EMPTY_ARRAY;
      }
    }
  }
 else {
    displays=WifiDisplay.EMPTY_ARRAY;
    activeDisplay=null;
  }
  String activeDisplayAddress=activeDisplay != null ? activeDisplay.getDeviceAddress() : null;
  for (int i=0; i < displays.length; i++) {
    final WifiDisplay d=displays[i];
    if (shouldShowWifiDisplay(d,activeDisplay)) {
      RouteInfo route=findWifiDisplayRoute(d);
      if (route == null) {
        route=makeWifiDisplayRoute(d,status);
        addRouteStatic(route);
      }
 else {
        String address=d.getDeviceAddress();
        boolean disconnected=!address.equals(activeDisplayAddress) && address.equals(sStatic.mPreviousActiveWifiDisplayAddress);
        updateWifiDisplayRoute(route,d,status,disconnected);
      }
      if (d.equals(activeDisplay)) {
        selectRouteStatic(route.getSupportedTypes(),route,false);
      }
    }
  }
  for (int i=sStatic.mRoutes.size(); i-- > 0; ) {
    RouteInfo route=sStatic.mRoutes.get(i);
    if (route.mDeviceAddress != null) {
      WifiDisplay d=findWifiDisplay(displays,route.mDeviceAddress);
      if (d == null || !shouldShowWifiDisplay(d,activeDisplay)) {
        removeRouteStatic(route);
      }
    }
  }
  sStatic.mPreviousActiveWifiDisplayAddress=activeDisplayAddress;
}
