{
  boolean wantScan=false;
  WifiDisplay[] displays;
  WifiDisplay activeDisplay;
  if (status.getFeatureState() == WifiDisplayStatus.FEATURE_STATE_ON) {
    displays=status.getDisplays();
    activeDisplay=status.getActiveDisplay();
  }
 else {
    displays=WifiDisplay.EMPTY_ARRAY;
    activeDisplay=null;
  }
  for (int i=0; i < displays.length; i++) {
    final WifiDisplay d=displays[i];
    if (shouldShowWifiDisplay(d,activeDisplay)) {
      RouteInfo route=findWifiDisplayRoute(d);
      if (route == null) {
        route=makeWifiDisplayRoute(d,status);
        addRouteStatic(route);
        wantScan=true;
      }
 else {
        updateWifiDisplayRoute(route,d,status);
      }
      if (d.equals(activeDisplay)) {
        selectRouteStatic(route.getSupportedTypes(),route,false);
      }
    }
  }
  for (int i=sStatic.mRoutes.size(); i-- > 0; ) {
    RouteInfo route=sStatic.mRoutes.get(i);
    if (route.mDeviceAddress != null) {
      WifiDisplay d=findWifiDisplay(displays,route.mDeviceAddress);
      if (d == null || !shouldShowWifiDisplay(d,activeDisplay)) {
        removeRouteStatic(route);
      }
    }
  }
  if (wantScan && activeDisplay != null) {
    sStatic.mDisplayService.scanWifiDisplays();
  }
}
