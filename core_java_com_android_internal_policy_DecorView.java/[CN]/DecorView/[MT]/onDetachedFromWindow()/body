{
  super.onDetachedFromWindow();
  final Window.Callback cb=mWindow.getCallback();
  if (cb != null && mFeatureId < 0) {
    cb.onDetachedFromWindow();
  }
  if (mWindow.mDecorContentParent != null) {
    mWindow.mDecorContentParent.dismissPopups();
  }
  if (mPrimaryActionModePopup != null) {
    removeCallbacks(mShowPrimaryActionModePopup);
    if (mPrimaryActionModePopup.isShowing()) {
      mPrimaryActionModePopup.dismiss();
    }
    mPrimaryActionModePopup=null;
  }
  if (mFloatingToolbar != null) {
    mFloatingToolbar.dismiss();
    mFloatingToolbar=null;
  }
  PhoneWindow.PanelFeatureState st=mWindow.getPanelState(Window.FEATURE_OPTIONS_PANEL,false);
  if (st != null && st.menu != null && mFeatureId < 0) {
    st.menu.close();
  }
  releaseThreadedRenderer();
  if (mWindowResizeCallbacksAdded) {
    getViewRootImpl().removeWindowCallbacks(this);
    mWindowResizeCallbacksAdded=false;
  }
}
