{
  state.present=size > 0 && (sysUiVis & state.systemUiHideFlag) == 0 && (mWindow.getAttributes().flags & state.hideWindowFlag) == 0 && ((mWindow.getAttributes().flags & FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS) != 0 || force);
  boolean show=state.present && (color & Color.BLACK) != 0 && ((mWindow.getAttributes().flags & state.translucentFlag) == 0 || force);
  boolean visibilityChanged=false;
  View view=state.view;
  int resolvedHeight=verticalBar ? LayoutParams.MATCH_PARENT : size;
  int resolvedWidth=verticalBar ? size : LayoutParams.MATCH_PARENT;
  int resolvedGravity=verticalBar ? state.horizontalGravity : state.verticalGravity;
  if (view == null) {
    if (show) {
      state.view=view=new View(mContext);
      view.setBackgroundColor(color);
      view.setTransitionName(state.transitionName);
      view.setId(state.id);
      visibilityChanged=true;
      view.setVisibility(INVISIBLE);
      state.targetVisibility=VISIBLE;
      LayoutParams lp=new LayoutParams(resolvedWidth,resolvedHeight,resolvedGravity);
      lp.rightMargin=rightMargin;
      addView(view,lp);
      updateColorViewTranslations();
    }
  }
 else {
    int vis=show ? VISIBLE : INVISIBLE;
    visibilityChanged=state.targetVisibility != vis;
    state.targetVisibility=vis;
    LayoutParams lp=(LayoutParams)view.getLayoutParams();
    if (lp.height != resolvedHeight || lp.width != resolvedWidth || lp.gravity != resolvedGravity || lp.rightMargin != rightMargin) {
      lp.height=resolvedHeight;
      lp.width=resolvedWidth;
      lp.gravity=resolvedGravity;
      lp.rightMargin=rightMargin;
      view.setLayoutParams(lp);
    }
    if (show) {
      view.setBackgroundColor(color);
    }
  }
  if (visibilityChanged) {
    view.animate().cancel();
    if (animate) {
      if (show) {
        if (view.getVisibility() != VISIBLE) {
          view.setVisibility(VISIBLE);
          view.setAlpha(0.0f);
        }
        view.animate().alpha(1.0f).setInterpolator(mShowInterpolator).setDuration(mBarEnterExitDuration);
      }
 else {
        view.animate().alpha(0.0f).setInterpolator(mHideInterpolator).setDuration(mBarEnterExitDuration).withEndAction(new Runnable(){
          @Override public void run(){
            state.view.setAlpha(1.0f);
            state.view.setVisibility(INVISIBLE);
          }
        }
);
      }
    }
 else {
      view.setAlpha(1.0f);
      view.setVisibility(show ? VISIBLE : INVISIBLE);
    }
  }
}
