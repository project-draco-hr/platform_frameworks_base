{
  DecorCaptionView DecorCaptionView=null;
  for (int i=getChildCount() - 1; i >= 0 && DecorCaptionView == null; i--) {
    View view=getChildAt(i);
    if (view instanceof DecorCaptionView) {
      DecorCaptionView=(DecorCaptionView)view;
      removeViewAt(i);
    }
  }
  final WindowManager.LayoutParams attrs=mWindow.getAttributes();
  final boolean isApplication=attrs.type == TYPE_BASE_APPLICATION || attrs.type == TYPE_APPLICATION;
  if (!mWindow.isFloating() && isApplication && ActivityManager.StackId.hasWindowDecor(mStackId)) {
    if (DecorCaptionView == null) {
      Context context=getContext();
      TypedValue value=new TypedValue();
      context.getTheme().resolveAttribute(R.attr.colorPrimary,value,true);
      inflater=inflater.from(context);
      if (Color.luminance(value.data) < 0.5) {
        DecorCaptionView=(DecorCaptionView)inflater.inflate(R.layout.decor_caption_dark,null);
      }
 else {
        DecorCaptionView=(DecorCaptionView)inflater.inflate(R.layout.decor_caption_light,null);
      }
    }
    DecorCaptionView.setPhoneWindow(mWindow,true);
  }
 else {
    DecorCaptionView=null;
  }
  enableCaption(DecorCaptionView != null);
  return DecorCaptionView;
}
