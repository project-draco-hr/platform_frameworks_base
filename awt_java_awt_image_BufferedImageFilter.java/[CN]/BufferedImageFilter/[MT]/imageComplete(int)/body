{
  if (status == STATICIMAGEDONE || status == SINGLEFRAMEDONE) {
    BufferedImage bim=new BufferedImage(cm,raster,cm.isAlphaPremultiplied,null);
    bim=op.filter(bim,null);
    DataBuffer dstDb=bim.getRaster().getDataBuffer();
    ColorModel dstCm=bim.getColorModel();
    int dstW=bim.getWidth();
    int dstH=bim.getHeight();
    consumer.setDimensions(dstW,dstH);
    if (dstDb.getDataType() == DataBuffer.TYPE_INT) {
      consumer.setColorModel(dstCm);
      consumer.setPixels(0,0,dstW,dstH,dstCm,accessor.getDataInt(dstDb),0,dstW);
    }
 else     if (dstDb.getDataType() == DataBuffer.TYPE_BYTE) {
      consumer.setColorModel(dstCm);
      consumer.setPixels(0,0,dstW,dstH,dstCm,accessor.getDataByte(dstDb),0,dstW);
    }
 else {
      int dstData[]=bim.getRGB(0,0,dstW,dstH,null,0,dstW);
      dstCm=ColorModel.getRGBdefault();
      consumer.setColorModel(dstCm);
      consumer.setPixels(0,0,dstW,dstH,dstCm,dstData,0,dstW);
    }
  }
 else   if (status == IMAGEERROR || status == IMAGEABORTED) {
    reset();
  }
  consumer.imageComplete(status);
}
