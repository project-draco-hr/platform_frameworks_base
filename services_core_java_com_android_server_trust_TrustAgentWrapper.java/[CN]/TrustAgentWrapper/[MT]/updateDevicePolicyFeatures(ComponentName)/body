{
  boolean trustDisabled=false;
  if (DEBUG)   Slog.v(TAG,"updateDevicePolicyFeatures(" + name + ")");
  try {
    if (mTrustAgentService != null) {
      DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
      if (dpm != null) {
        if ((dpm.getKeyguardDisabledFeatures(null) & DevicePolicyManager.KEYGUARD_DISABLE_TRUST_AGENTS) != 0) {
          List<String> features=dpm.getTrustAgentFeaturesEnabled(null,name);
          if (DEBUG)           Slog.v(TAG,"Detected trust agents disabled. Features = " + features);
          if (features != null && features.size() > 0) {
            Bundle bundle=new Bundle();
            bundle.putStringArrayList(TrustAgentService.KEY_FEATURES,(ArrayList<String>)features);
            if (DEBUG) {
              Slog.v(TAG,"TrustAgent " + name.flattenToShortString() + " disabled except "+ features);
            }
            trustDisabled=mTrustAgentService.setTrustAgentFeaturesEnabled(bundle);
          }
 else {
            if (DEBUG)             Slog.v(TAG,"TrustAgent " + name + " disabled by flag");
            trustDisabled=true;
          }
        }
      }
 else {
        Log.e(TAG,"Can't get DevicePolicyManagerService: is it running?",new IllegalStateException("Stack trace:"));
      }
    }
  }
 catch (  RemoteException e) {
    onError(e);
  }
  if (mTrustDisabledByDpm != trustDisabled) {
    mTrustDisabledByDpm=trustDisabled;
    mTrustManagerService.updateTrust(mUserId);
  }
  return trustDisabled;
}
