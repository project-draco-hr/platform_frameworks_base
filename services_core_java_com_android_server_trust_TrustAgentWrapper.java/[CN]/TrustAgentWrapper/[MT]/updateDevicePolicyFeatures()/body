{
  boolean trustDisabled=false;
  if (DEBUG)   Slog.v(TAG,"updateDevicePolicyFeatures(" + mName + ")");
  try {
    if (mTrustAgentService != null) {
      DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
      if ((dpm.getKeyguardDisabledFeatures(null,mUserId) & DevicePolicyManager.KEYGUARD_DISABLE_TRUST_AGENTS) != 0) {
        List<PersistableBundle> config=dpm.getTrustAgentConfiguration(null,mName,mUserId);
        trustDisabled=true;
        if (DEBUG)         Slog.v(TAG,"Detected trust agents disabled. Config = " + config);
        if (config != null && config.size() > 0) {
          if (DEBUG) {
            Slog.v(TAG,"TrustAgent " + mName.flattenToShortString() + " disabled until it acknowledges "+ config);
          }
          mSetTrustAgentFeaturesToken=new Binder();
          mTrustAgentService.onConfigure(config,mSetTrustAgentFeaturesToken);
        }
      }
 else {
        mTrustAgentService.onConfigure(Collections.EMPTY_LIST,null);
      }
      final long maxTimeToLock=dpm.getMaximumTimeToLockForUserAndProfiles(mUserId);
      if (maxTimeToLock != mMaximumTimeToLock) {
        mMaximumTimeToLock=maxTimeToLock;
        if (mAlarmPendingIntent != null) {
          mAlarmManager.cancel(mAlarmPendingIntent);
          mAlarmPendingIntent=null;
          mHandler.sendEmptyMessage(MSG_TRUST_TIMEOUT);
        }
      }
    }
  }
 catch (  RemoteException e) {
    onError(e);
  }
  if (mTrustDisabledByDpm != trustDisabled) {
    mTrustDisabledByDpm=trustDisabled;
    mTrustManagerService.updateTrust(mUserId,0);
  }
  return trustDisabled;
}
