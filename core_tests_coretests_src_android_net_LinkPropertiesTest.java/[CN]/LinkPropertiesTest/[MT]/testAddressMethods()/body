{
  LinkProperties lp=new LinkProperties();
  assertFalse(lp.hasIPv4Address());
  assertFalse(lp.hasGlobalIPv6Address());
  LinkProperties stacked=new LinkProperties();
  stacked.setInterfaceName("stacked");
  lp.addStackedLink(stacked);
  stacked.addLinkAddress(LINKADDRV4);
  stacked.addLinkAddress(LINKADDRV6);
  assertTrue(stacked.hasIPv4Address());
  assertTrue(stacked.hasGlobalIPv6Address());
  assertFalse(lp.hasIPv4Address());
  assertFalse(lp.hasGlobalIPv6Address());
  lp.removeStackedLink(stacked);
  assertFalse(lp.hasIPv4Address());
  assertFalse(lp.hasGlobalIPv6Address());
  assertEquals(0,lp.getLinkAddresses().size());
  assertTrue(lp.addLinkAddress(LINKADDRV6));
  assertEquals(1,lp.getLinkAddresses().size());
  assertFalse(lp.hasIPv4Address());
  assertTrue(lp.hasGlobalIPv6Address());
  assertTrue(lp.removeLinkAddress(LINKADDRV6));
  assertEquals(0,lp.getLinkAddresses().size());
  assertTrue(lp.addLinkAddress(LINKADDRV6LINKLOCAL));
  assertEquals(1,lp.getLinkAddresses().size());
  assertFalse(lp.hasGlobalIPv6Address());
  assertTrue(lp.addLinkAddress(LINKADDRV4));
  assertEquals(2,lp.getLinkAddresses().size());
  assertTrue(lp.hasIPv4Address());
  assertFalse(lp.hasGlobalIPv6Address());
  assertTrue(lp.addLinkAddress(LINKADDRV6));
  assertEquals(3,lp.getLinkAddresses().size());
  assertTrue(lp.hasIPv4Address());
  assertTrue(lp.hasGlobalIPv6Address());
  assertTrue(lp.removeLinkAddress(LINKADDRV6LINKLOCAL));
  assertEquals(2,lp.getLinkAddresses().size());
  assertTrue(lp.hasIPv4Address());
  assertTrue(lp.hasGlobalIPv6Address());
  assertFalse(lp.addLinkAddress(LINKADDRV4));
  assertEquals(2,lp.getLinkAddresses().size());
  assertTrue(lp.hasIPv4Address());
  assertTrue(lp.removeLinkAddress(LINKADDRV4));
  assertEquals(1,lp.getLinkAddresses().size());
  assertFalse(lp.hasIPv4Address());
  assertFalse(lp.removeLinkAddress(LINKADDRV4));
  assertEquals(1,lp.getLinkAddresses().size());
  assertEquals(1,lp.getLinkAddresses().size());
  assertEquals(LINKADDRV6,getFirstLinkAddress(lp));
  LinkAddress deprecated=new LinkAddress(ADDRV6,128,OsConstants.IFA_F_DEPRECATED,OsConstants.RT_SCOPE_UNIVERSE);
  assertTrue(deprecated.isSameAddressAs(LINKADDRV6));
  assertFalse(deprecated.equals(LINKADDRV6));
  assertTrue(lp.addLinkAddress(deprecated));
  assertEquals(1,lp.getLinkAddresses().size());
  assertEquals(deprecated,getFirstLinkAddress(lp));
  assertFalse(LINKADDRV6.equals(getFirstLinkAddress(lp)));
  assertTrue(lp.removeLinkAddress(LINKADDRV6));
  assertEquals(0,lp.getLinkAddresses().size());
}
