{
  byte[] bytes=pattern.getBytes(StandardCharsets.US_ASCII);
  if (bytes.length == 0) {
    return;
  }
  ByteBuffer formatBuffer=ByteBuffer.wrap(bytes);
  while (formatBuffer.remaining() > 0) {
    boolean outputCurrentByte=true;
    char currentByteAsChar=convertToChar(formatBuffer.get(formatBuffer.position()));
    if (currentByteAsChar == '%') {
      outputCurrentByte=handleToken(formatBuffer,wallTime,zoneInfo);
    }
    if (outputCurrentByte) {
      currentByteAsChar=convertToChar(formatBuffer.get(formatBuffer.position()));
      outputBuilder.append(currentByteAsChar);
    }
    formatBuffer.position(formatBuffer.position() + 1);
  }
}
