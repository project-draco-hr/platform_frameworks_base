{
  int offset1=offset;
  int remainLength=count;
  if (buffer == null) {
    throw new NullPointerException("buffer is null");
  }
  if ((offset | count) < 0 || count > buffer.length - offset) {
    throw new IndexOutOfBoundsException("index outof bound");
  }
  ensureOpen();
  parent.ensureNotDone();
  if (count < maxPacketSize) {
    output.write(buffer,offset,count);
  }
 else {
    while (remainLength >= maxPacketSize) {
      output.write(buffer,offset1,maxPacketSize);
      offset1+=maxPacketSize;
      remainLength=count - offset1;
      parent.continueOperation(true,false);
    }
    if (remainLength > 0) {
      output.write(buffer,offset1,remainLength);
    }
  }
}
