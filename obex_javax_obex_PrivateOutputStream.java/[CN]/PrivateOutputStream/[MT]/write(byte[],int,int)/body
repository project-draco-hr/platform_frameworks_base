{
  int offset1=offset;
  int remainLength=count;
  if (buffer == null) {
    throw new IOException("buffer is null");
  }
  if ((offset | count) < 0 || count > buffer.length - offset) {
    throw new IndexOutOfBoundsException("index outof bound");
  }
  ensureOpen();
  mParent.ensureNotDone();
  while ((mArray.size() + remainLength) >= mMaxPacketSize) {
    int bufferLeft=mMaxPacketSize - mArray.size();
    mArray.write(buffer,offset1,bufferLeft);
    offset1+=bufferLeft;
    remainLength-=bufferLeft;
    mParent.continueOperation(true,false);
  }
  if (remainLength > 0) {
    mArray.write(buffer,offset1,remainLength);
  }
}
