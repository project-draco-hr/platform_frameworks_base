{
  mWindowManager.addWindowChangeListener(this);
  BufferedWriter out=null;
  try {
    out=new BufferedWriter(new OutputStreamWriter(mClient.getOutputStream()));
    while (!Thread.interrupted()) {
synchronized (this) {
        while (!mNeedWindowListUpdate) {
          wait();
        }
        mNeedWindowListUpdate=false;
      }
      out.write("UPDATE\n");
      out.flush();
    }
  }
 catch (  Exception e) {
    Slog.w(LOG_TAG,"Connection error: ",e);
  }
 finally {
    if (out != null) {
      try {
        out.close();
      }
 catch (      IOException e) {
      }
    }
    mWindowManager.removeWindowChangeListener(this);
  }
  return true;
}
