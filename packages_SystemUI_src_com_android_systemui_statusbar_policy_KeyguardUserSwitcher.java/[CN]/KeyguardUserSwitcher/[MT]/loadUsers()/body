{
  ArrayList<UserInfo> users=(ArrayList<UserInfo>)mUserManager.getUsers(true);
  int N=users.size();
  ArrayList<UserData> result=new ArrayList<>(N);
  int currentUser=-1;
  try {
    currentUser=ActivityManagerNative.getDefault().getCurrentUser().id;
  }
 catch (  RemoteException e) {
    Log.e(TAG,"Couln't get current user.",e);
  }
  final int avatarSize=mContext.getResources().getDimensionPixelSize(R.dimen.max_avatar_size);
  for (int i=0; i < N; i++) {
    UserInfo user=users.get(i);
    if (user.supportsSwitchTo()) {
      boolean isCurrent=user.id == currentUser;
      final Bitmap picture=BitmapHelper.createCircularClip(mUserManager.getUserIcon(user.id),avatarSize,avatarSize);
      result.add(new UserData(user,picture,isCurrent));
    }
  }
  return result;
}
