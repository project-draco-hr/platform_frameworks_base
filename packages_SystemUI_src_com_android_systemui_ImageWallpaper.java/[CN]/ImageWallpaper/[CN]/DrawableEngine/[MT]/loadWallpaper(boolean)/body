{
  mNeedsDrawAfterLoadingWallpaper|=needsDraw;
  if (mLoader != null) {
    if (DEBUG) {
      Log.d(TAG,"Skipping loadWallpaper, already in flight ");
    }
    return;
  }
  mLoader=new AsyncTask<Void,Void,Bitmap>(){
    @Override protected Bitmap doInBackground(    Void... params){
      Throwable exception;
      try {
        return mWallpaperManager.getBitmap();
      }
 catch (      RuntimeException|OutOfMemoryError e) {
        exception=e;
      }
      if (exception != null) {
        Log.w(TAG,"Unable to load wallpaper!",exception);
        try {
          mWallpaperManager.clear();
        }
 catch (        IOException ex) {
          Log.w(TAG,"Unable reset to default wallpaper!",ex);
        }
        try {
          return mWallpaperManager.getBitmap();
        }
 catch (        RuntimeException|OutOfMemoryError e) {
          Log.w(TAG,"Unable to load default wallpaper!",e);
        }
      }
      return null;
    }
    @Override protected void onPostExecute(    Bitmap b){
      mBackground=null;
      mBackgroundWidth=-1;
      mBackgroundHeight=-1;
      if (b != null) {
        mBackground=b;
        mBackgroundWidth=mBackground.getWidth();
        mBackgroundHeight=mBackground.getHeight();
      }
      if (DEBUG) {
        Log.d(TAG,"Wallpaper loaded: " + mBackground);
      }
      updateSurfaceSize(getSurfaceHolder(),getDefaultDisplayInfo(),false);
      if (mNeedsDrawAfterLoadingWallpaper) {
        drawFrame();
      }
      mLoader=null;
      mNeedsDrawAfterLoadingWallpaper=false;
    }
  }
.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);
}
