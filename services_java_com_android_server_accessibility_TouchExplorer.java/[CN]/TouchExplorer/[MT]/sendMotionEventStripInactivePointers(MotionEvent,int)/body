{
  PointerTracker pointerTracker=mPointerTracker;
  if (prototype.getPointerCount() == pointerTracker.getActivePointerCount()) {
    sendMotionEvent(prototype,policyFlags);
    return;
  }
  if (pointerTracker.getActivePointerCount() == 0 && !pointerTracker.wasLastReceivedUpPointerActive()) {
    return;
  }
  final PointerProperties[] pointerProperties=mTempPointerProperties;
  final PointerCoords[] pointerCoords=mTempPointerCoords;
  int[] newToOldPointerIndexMap=mTempNewToOldPointerIndexMap;
  int newPointerIndex=0;
  int actionIndex=prototype.getActionIndex();
  final int oldPointerCount=prototype.getPointerCount();
  for (int oldPointerIndex=0; oldPointerIndex < oldPointerCount; oldPointerIndex++) {
    final int pointerId=prototype.getPointerId(oldPointerIndex);
    if (!pointerTracker.isActiveOrWasLastActiveUpPointer(pointerId)) {
      if (oldPointerIndex <= prototype.getActionIndex()) {
        actionIndex--;
      }
      continue;
    }
    newToOldPointerIndexMap[newPointerIndex]=oldPointerIndex;
    prototype.getPointerProperties(oldPointerIndex,pointerProperties[newPointerIndex]);
    prototype.getPointerCoords(oldPointerIndex,pointerCoords[newPointerIndex]);
    newPointerIndex++;
  }
  if (newPointerIndex == 0) {
    return;
  }
  final long downTime=pointerTracker.getLastInjectedDownEventTime();
  final int action=computeInjectionAction(prototype.getActionMasked(),actionIndex);
  final int newPointerCount=newPointerIndex;
  MotionEvent prunedEvent=MotionEvent.obtain(downTime,prototype.getEventTime(),action,newPointerCount,pointerProperties,pointerCoords,prototype.getMetaState(),prototype.getButtonState(),prototype.getXPrecision(),prototype.getYPrecision(),prototype.getDeviceId(),prototype.getEdgeFlags(),prototype.getSource(),prototype.getFlags());
  final int historySize=prototype.getHistorySize();
  for (int historyIndex=0; historyIndex < historySize; historyIndex++) {
    for (int pointerIndex=0; pointerIndex < newPointerCount; pointerIndex++) {
      final int oldPointerIndex=newToOldPointerIndexMap[pointerIndex];
      prototype.getPointerCoords(oldPointerIndex,pointerCoords[pointerIndex]);
    }
    final long historicalTime=prototype.getHistoricalEventTime(historyIndex);
    prunedEvent.addBatch(historicalTime,pointerCoords,0);
  }
  sendMotionEvent(prunedEvent,policyFlags);
  prunedEvent.recycle();
}
