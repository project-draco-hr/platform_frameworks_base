{
  prototype.setAction(action);
  MotionEvent event=null;
  if (pointerIdBits == ALL_POINTER_ID_BITS) {
    event=prototype;
  }
 else {
    event=prototype.split(pointerIdBits);
  }
  if (action == MotionEvent.ACTION_DOWN) {
    event.setDownTime(event.getEventTime());
  }
 else {
    event.setDownTime(mInjectedPointerTracker.getLastInjectedDownEventTime());
  }
  if (DEBUG) {
    Slog.d(LOG_TAG,"Injecting event: " + event + ", policyFlags=0x"+ Integer.toHexString(policyFlags));
  }
  policyFlags|=WindowManagerPolicy.FLAG_PASS_TO_USER;
  mInputFilter.sendInputEvent(event,policyFlags);
  mInjectedPointerTracker.onMotionEvent(event);
  if (event != prototype) {
    event.recycle();
  }
}
