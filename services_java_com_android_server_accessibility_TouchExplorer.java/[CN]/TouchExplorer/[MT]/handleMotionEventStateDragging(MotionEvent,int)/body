{
  final int pointerIdBits=(1 << mDraggingPointerId);
switch (event.getActionMasked()) {
case MotionEvent.ACTION_DOWN:
{
      throw new IllegalStateException("Dragging state can be reached only if two " + "pointers are already down");
    }
case MotionEvent.ACTION_POINTER_DOWN:
{
    mCurrentState=STATE_DELEGATING;
    sendMotionEvent(event,MotionEvent.ACTION_UP,pointerIdBits,policyFlags);
    sendDownForAllActiveNotInjectedPointers(event,policyFlags);
  }
break;
case MotionEvent.ACTION_MOVE:
{
final int activePointerCount=mReceivedPointerTracker.getActivePointerCount();
switch (activePointerCount) {
case 1:
{
  }
break;
case 2:
{
if (isDraggingGesture(event)) {
  int[] pointerIds=mTempPointerIds;
  mReceivedPointerTracker.populateActivePointerIds(pointerIds);
  final int firstPtrIndex=event.findPointerIndex(pointerIds[0]);
  final int secondPtrIndex=event.findPointerIndex(pointerIds[1]);
  final float firstPtrX=event.getX(firstPtrIndex);
  final float firstPtrY=event.getY(firstPtrIndex);
  final float secondPtrX=event.getX(secondPtrIndex);
  final float secondPtrY=event.getY(secondPtrIndex);
  final float deltaX=firstPtrX - secondPtrX;
  final float deltaY=firstPtrY - secondPtrY;
  final double distance=Math.hypot(deltaX,deltaY);
  if (distance > mScaledMinPointerDistanceToUseMiddleLocation) {
    event.setLocation(deltaX / 2,deltaY / 2);
  }
  sendMotionEvent(event,MotionEvent.ACTION_MOVE,pointerIdBits,policyFlags);
}
 else {
  mCurrentState=STATE_DELEGATING;
  sendMotionEvent(event,MotionEvent.ACTION_UP,pointerIdBits,policyFlags);
  sendDownForAllActiveNotInjectedPointers(event,policyFlags);
}
}
break;
default :
{
mCurrentState=STATE_DELEGATING;
sendMotionEvent(event,MotionEvent.ACTION_UP,pointerIdBits,policyFlags);
sendDownForAllActiveNotInjectedPointers(event,policyFlags);
}
}
}
break;
case MotionEvent.ACTION_POINTER_UP:
{
final int pointerId=event.getPointerId(event.getActionIndex());
if (pointerId == mDraggingPointerId) {
mDraggingPointerId=INVALID_POINTER_ID;
sendMotionEvent(event,MotionEvent.ACTION_UP,pointerIdBits,policyFlags);
}
}
break;
case MotionEvent.ACTION_UP:
{
sendAccessibilityEvent(AccessibilityEvent.TYPE_TOUCH_INTERACTION_END);
final int pointerId=event.getPointerId(event.getActionIndex());
if (pointerId == mDraggingPointerId) {
mDraggingPointerId=INVALID_POINTER_ID;
sendMotionEvent(event,MotionEvent.ACTION_UP,pointerIdBits,policyFlags);
}
mCurrentState=STATE_TOUCH_EXPLORING;
}
break;
case MotionEvent.ACTION_CANCEL:
{
clear(event,policyFlags);
}
break;
}
}
