{
  FileInputStream fis;
  try {
    fis=new FileInputStream(rulesFile);
  }
 catch (  FileNotFoundException ex) {
    return;
  }
  try {
    XmlPullParser parser=Xml.newPullParser();
    parser.setInput(fis,null);
    XmlUtils.beginDocument(parser,TAG_RULES);
    int outerDepth=parser.getDepth();
    while (XmlUtils.nextElementWithin(parser,outerDepth)) {
      IntentResolver<FirewallIntentFilter,Rule> resolver=null;
      String tagName=parser.getName();
      if (tagName.equals(TAG_ACTIVITY)) {
        resolver=mActivityResolver;
      }
 else       if (tagName.equals(TAG_SERVICE)) {
        resolver=mServiceResolver;
      }
 else       if (tagName.equals(TAG_BROADCAST)) {
        resolver=mBroadcastResolver;
      }
      if (resolver != null) {
        Rule rule=new Rule();
        try {
          rule.readFromXml(parser);
        }
 catch (        XmlPullParserException ex) {
          Slog.e(TAG,"Error reading intent firewall rule",ex);
          continue;
        }
catch (        IOException ex) {
          Slog.e(TAG,"Error reading intent firewall rule",ex);
          continue;
        }
        for (int i=0; i < rule.getIntentFilterCount(); i++) {
          resolver.addFilter(rule.getIntentFilter(i));
        }
      }
    }
  }
 catch (  XmlPullParserException ex) {
    Slog.e(TAG,"Error reading intent firewall rules",ex);
  }
catch (  IOException ex) {
    Slog.e(TAG,"Error reading intent firewall rules",ex);
  }
 finally {
    try {
      fis.close();
    }
 catch (    IOException ex) {
      Slog.e(TAG,"Error while closing " + rulesFile,ex);
    }
  }
}
