{
  PackageInfo oldPackage=null;
  PackageInfo newPackage=null;
synchronized (mLock) {
    oldPackage=mCurrentWebViewPackage;
    mSystemInterface.updateUserSetting(mContext,newProviderName);
    try {
      newPackage=findPreferredWebViewPackage();
      if (oldPackage != null && newPackage.packageName.equals(oldPackage.packageName)) {
        mSystemInterface.updateUserSetting(mContext,newPackage.packageName);
        return newPackage.packageName;
      }
    }
 catch (    WebViewFactory.MissingWebViewPackageException e) {
      Slog.e(TAG,"Tried to change WebView provider but failed to fetch WebView " + "package " + e);
      return newProviderName;
    }
    onWebViewProviderChanged(newPackage);
  }
  if (oldPackage != null) {
    mSystemInterface.killPackageDependents(oldPackage.packageName);
  }
  return newPackage.packageName;
}
