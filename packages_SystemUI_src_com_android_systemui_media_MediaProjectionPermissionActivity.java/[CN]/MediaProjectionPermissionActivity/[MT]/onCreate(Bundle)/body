{
  super.onCreate(icicle);
  Intent intent=getIntent();
  mPackageName=getCallingPackage();
  IBinder b=ServiceManager.getService(MEDIA_PROJECTION_SERVICE);
  mService=IMediaProjectionManager.Stub.asInterface(b);
  if (mPackageName == null) {
    finish();
    return;
  }
  PackageManager packageManager=getPackageManager();
  ApplicationInfo aInfo;
  try {
    aInfo=packageManager.getApplicationInfo(mPackageName,0);
    mUid=aInfo.uid;
  }
 catch (  PackageManager.NameNotFoundException e) {
    Log.e(TAG,"unable to look up package name",e);
    finish();
    return;
  }
  try {
    if (mService.hasProjectionPermission(mUid,mPackageName)) {
      setResult(RESULT_OK,getMediaProjectionIntent(mUid,mPackageName,false));
      finish();
      return;
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"Error checking projection permissions",e);
    finish();
    return;
  }
  String appName=aInfo.loadLabel(packageManager).toString();
  final AlertController.AlertParams ap=mAlertParams;
  ap.mIcon=aInfo.loadIcon(packageManager);
  ap.mMessage=getString(R.string.media_projection_dialog_text,appName);
  ap.mPositiveButtonText=getString(R.string.media_projection_action_text);
  ap.mNegativeButtonText=getString(android.R.string.cancel);
  ap.mPositiveButtonListener=this;
  ap.mNegativeButtonListener=this;
  LayoutInflater inflater=(LayoutInflater)getSystemService(Context.LAYOUT_INFLATER_SERVICE);
  ap.mView=inflater.inflate(R.layout.remember_permission_checkbox,null);
  CheckBox rememberPermissionCheckbox=(CheckBox)ap.mView.findViewById(R.id.remember);
  rememberPermissionCheckbox.setOnCheckedChangeListener(this);
  setupAlert();
}
