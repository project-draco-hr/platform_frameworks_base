{
  super.onAttachedToWindow();
  if (!mAttached) {
    mAttached=true;
    IntentFilter filter=new IntentFilter();
    filter.addAction(Intent.ACTION_TIME_TICK);
    filter.addAction(Intent.ACTION_TIME_CHANGED);
    filter.addAction(Intent.ACTION_TIMEZONE_CHANGED);
    filter.addAction(Intent.ACTION_CONFIGURATION_CHANGED);
    filter.addAction(Intent.ACTION_USER_SWITCHED);
    getContext().registerReceiverAsUser(mIntentReceiver,UserHandle.ALL,filter,null,getHandler());
  }
  mCalendar=Calendar.getInstance(TimeZone.getDefault());
  updateClock();
}
