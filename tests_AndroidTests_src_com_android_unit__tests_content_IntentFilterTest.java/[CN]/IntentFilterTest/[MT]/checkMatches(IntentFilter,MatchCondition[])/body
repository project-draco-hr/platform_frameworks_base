{
  for (int i=0; i < results.length; i++) {
    MatchCondition mc=results[i];
    HashSet<String> categories=null;
    if (mc.categories != null) {
      for (int j=0; j < mc.categories.length; j++) {
        if (categories == null) {
          categories=new HashSet<String>();
        }
        categories.add(mc.categories[j]);
      }
    }
    int result=filter.match(mc.action,mc.mimeType,mc.data != null ? mc.data.getScheme() : null,mc.data,categories,"test");
    if ((result & IntentFilter.MATCH_CATEGORY_MASK) != (mc.result & IntentFilter.MATCH_CATEGORY_MASK)) {
      StringBuilder msg=new StringBuilder();
      msg.append("Error matching against IntentFilter:\n");
      filter.dump(new StringBuilderPrinter(msg),"    ");
      msg.append("Match action: ");
      msg.append(mc.action);
      msg.append("\nMatch mimeType: ");
      msg.append(mc.mimeType);
      msg.append("\nMatch data: ");
      msg.append(mc.data);
      msg.append("\nMatch categories: ");
      if (mc.categories != null) {
        for (int j=0; j < mc.categories.length; j++) {
          if (j > 0)           msg.append(", ");
          msg.append(mc.categories[j]);
        }
      }
      msg.append("\nExpected result: 0x");
      msg.append(Integer.toHexString(mc.result));
      msg.append(", got result: 0x");
      msg.append(Integer.toHexString(result));
      throw new RuntimeException(msg.toString());
    }
  }
}
