{
  mContext=context;
  mAlsaManager=new UsbAlsaManager(context);
  final PackageManager pm=mContext.getPackageManager();
  if (pm.hasSystemFeature(PackageManager.FEATURE_USB_HOST)) {
    mHostManager=new UsbHostManager(context,mAlsaManager);
  }
  if (new File("/sys/class/android_usb").exists()) {
    mDeviceManager=new UsbDeviceManager(context,mAlsaManager);
  }
  if (mHostManager != null || mDeviceManager != null) {
    mPortManager=new UsbPortManager(context);
  }
  setCurrentUser(UserHandle.USER_SYSTEM);
  final IntentFilter filter=new IntentFilter();
  filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
  filter.addAction(Intent.ACTION_USER_SWITCHED);
  filter.addAction(Intent.ACTION_USER_STOPPED);
  filter.addAction(DevicePolicyManager.ACTION_DEVICE_POLICY_MANAGER_STATE_CHANGED);
  mContext.registerReceiver(mReceiver,filter,null,null);
}
