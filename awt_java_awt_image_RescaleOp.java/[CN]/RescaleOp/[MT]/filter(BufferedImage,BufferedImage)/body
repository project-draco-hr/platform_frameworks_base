{
  ColorModel srcCM=src.getColorModel();
  if (srcCM instanceof IndexColorModel) {
    throw new IllegalArgumentException(Messages.getString("awt.220"));
  }
  int nComponents=srcCM.getNumComponents();
  boolean skipAlpha;
  if (srcCM.hasAlpha()) {
    if (scaleFactors.length == 1 || scaleFactors.length == nComponents - 1) {
      skipAlpha=true;
    }
 else     if (scaleFactors.length == nComponents) {
      skipAlpha=false;
    }
 else {
      throw new IllegalArgumentException(Messages.getString("awt.21E"));
    }
  }
 else   if (scaleFactors.length == 1 || scaleFactors.length == nComponents) {
    skipAlpha=false;
  }
 else {
    throw new IllegalArgumentException(Messages.getString("awt.21E"));
  }
  BufferedImage finalDst=null;
  if (dst == null) {
    finalDst=dst;
    dst=createCompatibleDestImage(src,srcCM);
  }
 else   if (!srcCM.equals(dst.getColorModel())) {
    if (!((src.getType() == BufferedImage.TYPE_INT_RGB || src.getType() == BufferedImage.TYPE_INT_ARGB) && (dst.getType() == BufferedImage.TYPE_INT_RGB || dst.getType() == BufferedImage.TYPE_INT_ARGB))) {
      finalDst=dst;
      dst=createCompatibleDestImage(src,srcCM);
    }
  }
  if (slowFilter(src.getRaster(),dst.getRaster(),skipAlpha) != 0) {
    throw new ImagingOpException(Messages.getString("awt.21F"));
  }
  if (finalDst != null) {
    Graphics2D g=finalDst.createGraphics();
    g.setComposite(AlphaComposite.Src);
    g.drawImage(dst,0,0,null);
  }
 else {
    finalDst=dst;
  }
  return finalDst;
}
