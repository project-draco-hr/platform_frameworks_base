{
  if (dstCM == null) {
    dstCM=src.getColorModel();
  }
  if (dstCM instanceof IndexColorModel) {
    dstCM=ColorModel.getRGBdefault();
  }
  WritableRaster r=dstCM.isCompatibleSampleModel(src.getSampleModel()) ? src.getRaster().createCompatibleWritableRaster(src.getWidth(),src.getHeight()) : dstCM.createCompatibleWritableRaster(src.getWidth(),src.getHeight());
  return new BufferedImage(dstCM,r,dstCM.isAlphaPremultiplied(),null);
}
