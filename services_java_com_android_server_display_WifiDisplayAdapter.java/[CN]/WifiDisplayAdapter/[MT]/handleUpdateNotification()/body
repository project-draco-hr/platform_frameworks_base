{
  final int state;
  final WifiDisplay display;
synchronized (getSyncRoot()) {
    if (!mPendingNotificationUpdate) {
      return;
    }
    mPendingNotificationUpdate=false;
    state=mActiveDisplayState;
    display=mActiveDisplay;
  }
  mNotificationManager.cancelAsUser(null,R.string.wifi_display_notification_disconnect,UserHandle.ALL);
  if (state == WifiDisplayStatus.DISPLAY_STATE_CONNECTING || state == WifiDisplayStatus.DISPLAY_STATE_CONNECTED) {
    Context context=getContext();
    if (mSettingsPendingIntent == null) {
      Intent settingsIntent=new Intent(Settings.ACTION_WIFI_DISPLAY_SETTINGS);
      settingsIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED | Intent.FLAG_ACTIVITY_CLEAR_TOP);
      mSettingsPendingIntent=PendingIntent.getActivityAsUser(context,0,settingsIntent,0,null,UserHandle.CURRENT);
    }
    if (mDisconnectPendingIntent == null) {
      Intent disconnectIntent=new Intent(ACTION_DISCONNECT);
      mDisconnectPendingIntent=PendingIntent.getBroadcastAsUser(context,0,disconnectIntent,0,UserHandle.CURRENT);
    }
    Resources r=context.getResources();
    Notification notification;
    if (state == WifiDisplayStatus.DISPLAY_STATE_CONNECTING) {
      notification=new Notification.Builder(context).setContentTitle(r.getString(R.string.wifi_display_notification_connecting_title)).setContentText(r.getString(R.string.wifi_display_notification_connecting_message,display.getFriendlyDisplayName())).setContentIntent(mSettingsPendingIntent).setSmallIcon(R.drawable.ic_notification_cast_connecting).setOngoing(true).addAction(android.R.drawable.ic_menu_close_clear_cancel,r.getString(R.string.wifi_display_notification_disconnect),mDisconnectPendingIntent).build();
    }
 else {
      notification=new Notification.Builder(context).setContentTitle(r.getString(R.string.wifi_display_notification_connected_title)).setContentText(r.getString(R.string.wifi_display_notification_connected_message,display.getFriendlyDisplayName())).setContentIntent(mSettingsPendingIntent).setSmallIcon(R.drawable.ic_notification_cast_on).setOngoing(true).addAction(android.R.drawable.ic_menu_close_clear_cancel,r.getString(R.string.wifi_display_notification_disconnect),mDisconnectPendingIntent).build();
    }
    mNotificationManager.notifyAsUser(null,R.string.wifi_display_notification_disconnect,notification,UserHandle.ALL);
  }
}
