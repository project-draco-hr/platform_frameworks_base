{
  removeDisplayDeviceLocked();
  if (mPersistentDataStore.rememberWifiDisplay(display)) {
    mPersistentDataStore.saveIfNeeded();
    updateRememberedDisplaysLocked();
    scheduleStatusChangedBroadcastLocked();
  }
  boolean secure=(flags & RemoteDisplay.DISPLAY_FLAG_SECURE) != 0;
  int deviceFlags=0;
  if (secure) {
    deviceFlags|=DisplayDeviceInfo.FLAG_SECURE;
    if (mSupportsProtectedBuffers) {
      deviceFlags|=DisplayDeviceInfo.FLAG_SUPPORTS_PROTECTED_BUFFERS;
    }
  }
  float refreshRate=60.0f;
  String name=display.getFriendlyDisplayName();
  String address=display.getDeviceAddress();
  IBinder displayToken=Surface.createDisplay(name,secure);
  mDisplayDevice=new WifiDisplayDevice(displayToken,name,width,height,refreshRate,deviceFlags,address,surface);
  sendDisplayDeviceEventLocked(mDisplayDevice,DISPLAY_DEVICE_EVENT_ADDED);
  scheduleUpdateNotificationLocked();
}
