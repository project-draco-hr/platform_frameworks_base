{
  handleDisconnectLocked();
  if (mPersistentDataStore.rememberWifiDisplay(display)) {
    mPersistentDataStore.saveIfNeeded();
    updateRememberedDisplaysLocked();
    scheduleStatusChangedBroadcastLocked();
  }
  int deviceFlags=0;
  if ((flags & RemoteDisplay.DISPLAY_FLAG_SECURE) != 0) {
    deviceFlags|=DisplayDeviceInfo.FLAG_SECURE;
  }
  if (mSupportsProtectedBuffers) {
    deviceFlags|=DisplayDeviceInfo.FLAG_SUPPORTS_PROTECTED_BUFFERS;
  }
  float refreshRate=60.0f;
  String name=display.getFriendlyDisplayName();
  IBinder displayToken=Surface.createDisplay(name);
  mDisplayDevice=new WifiDisplayDevice(displayToken,name,width,height,refreshRate,deviceFlags,surface);
  sendDisplayDeviceEventLocked(mDisplayDevice,DISPLAY_DEVICE_EVENT_ADDED);
  scheduleUpdateNotificationLocked();
}
