{
  if (mTransitioning || mDown)   return;
  mTransitioning=true;
  enableWindowExitAnimation(false);
  final int navHeight=mInsets.bottom;
  final int navWidth=mInsets.right;
  mPreview.getLocationInWindow(mTmpLoc);
  final float pvHeight=mPreview.getHeight() * mPreview.getScaleY();
  final float pvCenter=mTmpLoc[1] + pvHeight / 2f;
  final ViewGroup root=(ViewGroup)getRootView();
  if (DEBUG) {
    Log.d(TAG,"root = " + root.getLeft() + ","+ root.getTop()+ " "+ root.getWidth()+ "x"+ root.getHeight());
  }
  if (mFullscreenPreview == null) {
    mFullscreenPreview=getPreviewWidget(mContext,mWidgetInfo);
    mFullscreenPreview.setClickable(false);
    root.addView(mFullscreenPreview,new FrameLayout.LayoutParams(root.getWidth() - navWidth,root.getHeight() - navHeight));
  }
  final float fsHeight=root.getHeight() - navHeight;
  final float fsCenter=root.getTop() + fsHeight / 2;
  final float fsScaleY=mPreview.getScaleY();
  final float fsTransY=pvCenter - fsCenter;
  final float fsScaleX=fsScaleY;
  mPreview.setVisibility(View.GONE);
  mFullscreenPreview.setVisibility(View.VISIBLE);
  mFullscreenPreview.setTranslationY(fsTransY);
  mFullscreenPreview.setScaleX(fsScaleX);
  mFullscreenPreview.setScaleY(fsScaleY);
  mFullscreenPreview.animate().scaleX(1).scaleY(1).translationX(0).translationY(0).setDuration(WIDGET_ANIMATION_DURATION).withEndAction(mPostTransitionToCameraEndAction).start();
  if (navHeight > 0 || navWidth > 0) {
    final boolean atBottom=navHeight > 0;
    if (mFakeNavBar == null) {
      mFakeNavBar=new View(mContext);
      mFakeNavBar.setBackgroundColor(Color.BLACK);
      root.addView(mFakeNavBar,new FrameLayout.LayoutParams(atBottom ? FrameLayout.LayoutParams.MATCH_PARENT : navWidth,atBottom ? navHeight : FrameLayout.LayoutParams.MATCH_PARENT,atBottom ? Gravity.BOTTOM | Gravity.FILL_HORIZONTAL : Gravity.RIGHT | Gravity.FILL_VERTICAL));
      mFakeNavBar.setPivotY(navHeight);
      mFakeNavBar.setPivotX(navWidth);
    }
    mFakeNavBar.setAlpha(0f);
    if (atBottom) {
      mFakeNavBar.setScaleY(0.5f);
    }
 else {
      mFakeNavBar.setScaleX(0.5f);
    }
    mFakeNavBar.setVisibility(View.VISIBLE);
    mFakeNavBar.animate().alpha(1f).scaleY(1f).scaleY(1f).setDuration(WIDGET_ANIMATION_DURATION).start();
  }
  mCallbacks.onLaunchingCamera();
}
