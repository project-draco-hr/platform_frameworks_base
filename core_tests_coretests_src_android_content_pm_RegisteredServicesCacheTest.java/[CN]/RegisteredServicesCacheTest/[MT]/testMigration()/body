{
  String oldFile="<?xml version='1.0' encoding='utf-8' standalone='yes' ?>\n" + "<services>\n" + "    <service uid=\"1\" type=\"type1\" value=\"value1\" />\n"+ "    <service uid=\"100002\" type=\"type2\" value=\"value2\" />\n"+ "<services>\n";
  File file=new File(mSyncDir,TestServicesCache.SERVICE_INTERFACE + ".xml");
  FileUtils.copyToFile(new ByteArrayInputStream(oldFile.getBytes()),file);
  int u0=0;
  int u1=1;
  TestServicesCache cache=new TestServicesCache();
  assertEquals(1,cache.getPersistentServicesSize(u0));
  assertEquals(1,cache.getPersistentServicesSize(u1));
  assertNotEmptyFileCreated(cache,u0);
  assertNotEmptyFileCreated(cache,u1);
  File markerFile=new File(mSyncDir,TestServicesCache.SERVICE_INTERFACE + ".xml.migrated");
  assertTrue("Marker file should be created at " + markerFile,markerFile.exists());
  cache.addServiceForQuerying(0,r1,newServiceInfo(t1,1));
  cache.addServiceForQuerying(0,r2,newServiceInfo(t2,2));
  assertEquals(2,cache.getAllServicesSize(u0));
  assertEquals(0,cache.getAllServicesSize(u1));
  cache=new TestServicesCache();
  assertEquals(2,cache.getPersistentServicesSize(u0));
  assertEquals(0,cache.getPersistentServicesSize(u1));
}
