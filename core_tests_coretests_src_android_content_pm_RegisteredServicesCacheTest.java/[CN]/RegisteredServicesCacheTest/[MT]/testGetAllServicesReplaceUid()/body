{
  TestServicesCache cache=new TestServicesCache();
  cache.addServiceForQuerying(U0,r1,newServiceInfo(t1,UID1));
  cache.addServiceForQuerying(U0,r2,newServiceInfo(t2,UID2));
  cache.getAllServices(U0);
  cache.invalidateCache(U0);
  cache.clearServicesForQuerying();
  cache.addServiceForQuerying(U0,r1,newServiceInfo(t1,UID1));
  cache.addServiceForQuerying(U0,r2,newServiceInfo(t2,SYSTEM_IMAGE_UID));
  Collection<RegisteredServicesCache.ServiceInfo<TestServiceType>> allServices=cache.getAllServices(U0);
  assertEquals(2,allServices.size());
  Set<Integer> uids=new HashSet<>();
  for (  RegisteredServicesCache.ServiceInfo<TestServiceType> srv : allServices) {
    uids.add(srv.uid);
  }
  assertTrue("UID must be updated to the new value",uids.contains(SYSTEM_IMAGE_UID));
  assertFalse("UID must be updated to the new value",uids.contains(UID2));
}
