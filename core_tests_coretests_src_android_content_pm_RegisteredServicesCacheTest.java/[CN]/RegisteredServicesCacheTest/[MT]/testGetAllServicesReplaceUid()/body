{
  TestServicesCache cache=new TestServicesCache(mContext,mDataDir);
  cache.addServiceForQuerying(0,r1,new RegisteredServicesCache.ServiceInfo<>(t1,null,1));
  cache.addServiceForQuerying(0,r2,new RegisteredServicesCache.ServiceInfo<>(t2,null,2));
  cache.getAllServices(0);
  cache.invalidateCache(0);
  cache.clearServicesForQuerying();
  cache.addServiceForQuerying(0,r1,new RegisteredServicesCache.ServiceInfo<>(t1,null,1));
  cache.addServiceForQuerying(0,r2,new RegisteredServicesCache.ServiceInfo<>(t2,null,TestServicesCache.SYSTEM_IMAGE_UID));
  Collection<RegisteredServicesCache.ServiceInfo<TestServiceType>> allServices=cache.getAllServices(0);
  assertEquals(2,allServices.size());
  Set<Integer> uids=new HashSet<>();
  for (  RegisteredServicesCache.ServiceInfo<TestServiceType> srv : allServices) {
    uids.add(srv.uid);
  }
  assertTrue("UID must be updated to the new value",uids.contains(TestServicesCache.SYSTEM_IMAGE_UID));
  assertFalse("UID must be updated to the new value",uids.contains(2));
}
