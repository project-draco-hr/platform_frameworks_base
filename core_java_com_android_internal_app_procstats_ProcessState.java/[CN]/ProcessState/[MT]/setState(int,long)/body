{
  ensureNotDead();
  if (mCurState != state) {
    commitStateTime(now);
    mCurState=state;
  }
}
