{
  if (DEBUG) {
    Log.i(LOG_TAG,"read history completed " + FusedPrintersProvider.this.hashCode());
  }
  Set<ComponentName> enabledComponents=new ArraySet<>();
  final int installedServiceCount=mEnabledServices.size();
  for (int i=0; i < installedServiceCount; i++) {
    ServiceInfo serviceInfo=mEnabledServices.get(i).getResolveInfo().serviceInfo;
    ComponentName componentName=new ComponentName(serviceInfo.packageName,serviceInfo.name);
    enabledComponents.add(componentName);
  }
  mAreEnabledServicesUpdated=false;
  final int printerCount=printers.size();
  for (int i=printerCount - 1; i >= 0; i--) {
    ComponentName printerServiceName=printers.get(i).first.getId().getServiceName();
    if (!enabledComponents.contains(printerServiceName)) {
      printers.remove(i);
    }
  }
  mHistoricalPrinters=printers;
  mFavoritePrinters.clear();
  mFavoritePrinters.addAll(sortFavoritePrinters(mHistoricalPrinters));
  mReadHistoryCompleted=true;
  updatePrinters(mDiscoverySession.getPrinters(),mFavoritePrinters,getCurrentLocation());
  mReadTask=null;
  loadInternal();
}
