{
  Map<PrinterId,PrinterRecord> recordMap=new ArrayMap<>();
  float currentWeight=1.0f;
  final int printerCount=printers.size();
  for (int i=printerCount - 1; i >= 0; i--) {
    PrinterId printerId=printers.get(i).first.getId();
    PrinterRecord record=recordMap.get(printerId);
    if (record == null) {
      record=new PrinterRecord();
      recordMap.put(printerId,record);
    }
    record.printers.add(printers.get(i));
    record.weight+=currentWeight;
    currentWeight*=WEIGHT_DECAY_COEFFICIENT;
  }
  List<PrinterRecord> favoriteRecords=new ArrayList<>(recordMap.values());
  Collections.sort(favoriteRecords);
  final int recordCount=favoriteRecords.size();
  List<Pair<PrinterInfo,Location>> favoritePrinters=new ArrayList<>(printerCount);
  for (int i=0; i < recordCount; i++) {
    favoritePrinters.addAll(favoriteRecords.get(i).printers);
  }
  return favoritePrinters;
}
