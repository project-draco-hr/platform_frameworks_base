{
  int ret=PackageManager.INSTALL_FAILED_INTERNAL_ERROR;
  if (mContainerService != null) {
    int loc=params.getInstallLocation(mContainerService);
    if (loc == PackageHelper.RECOMMEND_FAILED_INSUFFICIENT_STORAGE) {
      ret=PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
    }
 else     if (loc == PackageHelper.RECOMMEND_FAILED_INVALID_APK) {
      ret=PackageManager.INSTALL_FAILED_INVALID_APK;
    }
 else {
      if ((params.flags & PackageManager.INSTALL_EXTERNAL) == 0) {
        if (loc == PackageHelper.RECOMMEND_INSTALL_EXTERNAL) {
          params.flags|=PackageManager.INSTALL_EXTERNAL;
        }
 else {
          params.flags&=~PackageManager.INSTALL_EXTERNAL;
        }
      }
      if ((params.flags & PackageManager.INSTALL_FORWARD_LOCK) != 0 && (params.flags & PackageManager.INSTALL_EXTERNAL) != 0) {
        Log.w(TAG,"Cannot install protected apps on sdcard");
        ret=PackageManager.INSTALL_FAILED_INVALID_INSTALL_LOCATION;
      }
 else {
        ret=PackageManager.INSTALL_SUCCEEDED;
      }
    }
  }
  mHandler.sendEmptyMessage(MCS_UNBIND);
  InstallArgs args=createInstallArgs(params);
  if (ret == PackageManager.INSTALL_SUCCEEDED) {
    args.createCopyFile();
    ret=args.copyApk(mContainerService);
  }
  processPendingInstall(args,ret);
}
