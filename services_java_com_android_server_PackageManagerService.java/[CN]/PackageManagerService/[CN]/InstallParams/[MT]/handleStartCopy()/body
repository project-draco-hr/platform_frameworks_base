{
  int ret=PackageManager.INSTALL_SUCCEEDED;
  boolean fwdLocked=(flags & PackageManager.INSTALL_FORWARD_LOCK) != 0;
  boolean onSd=(flags & PackageManager.INSTALL_EXTERNAL) != 0;
  if (fwdLocked && onSd) {
    Slog.w(TAG,"Cannot install fwd locked apps on sdcard");
    ret=PackageManager.INSTALL_FAILED_INVALID_INSTALL_LOCATION;
  }
 else {
    PackageInfoLite pkgLite=mContainerService.getMinimalPackageInfo(packageURI);
    int loc=pkgLite.recommendedInstallLocation;
    if (loc == PackageHelper.RECOMMEND_FAILED_INVALID_LOCATION) {
      ret=PackageManager.INSTALL_FAILED_INVALID_INSTALL_LOCATION;
    }
 else     if (loc == PackageHelper.RECOMMEND_FAILED_ALREADY_EXISTS) {
      ret=PackageManager.INSTALL_FAILED_ALREADY_EXISTS;
    }
 else     if (loc == PackageHelper.RECOMMEND_FAILED_INSUFFICIENT_STORAGE) {
      ret=PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
    }
 else     if (loc == PackageHelper.RECOMMEND_FAILED_INVALID_APK) {
      ret=PackageManager.INSTALL_FAILED_INVALID_APK;
    }
 else     if (loc == PackageHelper.RECOMMEND_MEDIA_UNAVAILABLE) {
      ret=PackageManager.INSTALL_FAILED_MEDIA_UNAVAILABLE;
    }
 else {
      loc=installLocationPolicy(pkgLite,flags);
      if ((flags & PackageManager.INSTALL_EXTERNAL) == 0) {
        if (loc == PackageHelper.RECOMMEND_INSTALL_EXTERNAL) {
          flags|=PackageManager.INSTALL_EXTERNAL;
        }
 else {
          flags&=~PackageManager.INSTALL_EXTERNAL;
        }
      }
    }
  }
  mArgs=createInstallArgs(this);
  if (ret == PackageManager.INSTALL_SUCCEEDED) {
    ret=mArgs.copyApk(mContainerService,true);
  }
  mRet=ret;
}
