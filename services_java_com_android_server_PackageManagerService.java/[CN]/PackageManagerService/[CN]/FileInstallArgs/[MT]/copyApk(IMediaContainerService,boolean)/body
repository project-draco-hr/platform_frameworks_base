{
  if (temp) {
    createCopyFile();
  }
  File codeFile=new File(codeFileName);
  if (!created) {
    try {
      codeFile.createNewFile();
      if (!setPermissions()) {
        return PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
      }
    }
 catch (    IOException e) {
      Slog.w(TAG,"Failed to create file " + codeFile);
      return PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
    }
  }
  ParcelFileDescriptor out=null;
  try {
    out=ParcelFileDescriptor.open(codeFile,ParcelFileDescriptor.MODE_READ_WRITE);
  }
 catch (  FileNotFoundException e) {
    Slog.e(TAG,"Failed to create file descritpor for : " + codeFileName);
    return PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
  }
  int ret=PackageManager.INSTALL_FAILED_INSUFFICIENT_STORAGE;
  try {
    if (imcs.copyResource(packageURI,out)) {
      ret=PackageManager.INSTALL_SUCCEEDED;
    }
  }
  finally {
    try {
      if (out != null)       out.close();
    }
 catch (    IOException e) {
    }
  }
  if (!temp) {
    NativeLibraryHelper.copyNativeBinariesLI(codeFile,new File(libraryPath));
  }
  return ret;
}
