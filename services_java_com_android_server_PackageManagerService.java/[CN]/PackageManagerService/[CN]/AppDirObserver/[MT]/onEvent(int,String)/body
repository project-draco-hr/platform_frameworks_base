{
  String removedPackage=null;
  int removedUid=-1;
  String addedPackage=null;
  int addedUid=-1;
synchronized (mInstallLock) {
    String fullPathStr=null;
    File fullPath=null;
    if (path != null) {
      fullPath=new File(mRootDir,path);
      fullPathStr=fullPath.getPath();
    }
    if (Config.LOGV)     Log.v(TAG,"File " + fullPathStr + " changed: "+ Integer.toHexString(event));
    if (!isPackageFilename(path)) {
      if (Config.LOGV)       Log.v(TAG,"Ignoring change of non-package file: " + fullPathStr);
      return;
    }
    if ((event & REMOVE_EVENTS) != 0) {
synchronized (mInstallLock) {
        PackageParser.Package p=mAppDirs.get(fullPathStr);
        if (p != null) {
          removePackageLI(p,true);
          removedPackage=p.applicationInfo.packageName;
          removedUid=p.applicationInfo.uid;
        }
      }
    }
    if ((event & ADD_EVENTS) != 0) {
      PackageParser.Package p=mAppDirs.get(fullPathStr);
      if (p == null) {
        p=scanPackageLI(fullPath,fullPath,fullPath,(mIsRom ? PackageParser.PARSE_IS_SYSTEM : 0) | PackageParser.PARSE_CHATTY | PackageParser.PARSE_MUST_BE_APK,SCAN_MONITOR);
        if (p != null) {
synchronized (mPackages) {
            grantPermissionsLP(p,false);
          }
          addedPackage=p.applicationInfo.packageName;
          addedUid=p.applicationInfo.uid;
        }
      }
    }
synchronized (mPackages) {
      mSettings.writeLP();
    }
  }
  if (removedPackage != null) {
    Bundle extras=new Bundle(1);
    extras.putInt(Intent.EXTRA_UID,removedUid);
    sendPackageBroadcast(Intent.ACTION_PACKAGE_REMOVED,removedPackage,extras);
  }
  if (addedPackage != null) {
    Bundle extras=new Bundle(1);
    extras.putInt(Intent.EXTRA_UID,addedUid);
    sendPackageBroadcast(Intent.ACTION_PACKAGE_ADDED,addedPackage,extras);
  }
}
