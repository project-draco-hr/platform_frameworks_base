{
  String name=null;
  String idStr=null;
  int pkgFlags=0;
  SharedUserSetting su=null;
  try {
    name=parser.getAttributeValue(null,"name");
    idStr=parser.getAttributeValue(null,"userId");
    int userId=idStr != null ? Integer.parseInt(idStr) : 0;
    if ("true".equals(parser.getAttributeValue(null,"system"))) {
      pkgFlags|=ApplicationInfo.FLAG_SYSTEM;
    }
    if (name == null) {
      reportSettingsProblem(Log.WARN,"Error in package manager settings: <shared-user> has no name at " + parser.getPositionDescription());
    }
 else     if (userId == 0) {
      reportSettingsProblem(Log.WARN,"Error in package manager settings: shared-user " + name + " has bad userId "+ idStr+ " at "+ parser.getPositionDescription());
    }
 else {
      if ((su=addSharedUserLP(name.intern(),userId,pkgFlags)) == null) {
        reportSettingsProblem(Log.ERROR,"Occurred while parsing settings at " + parser.getPositionDescription());
      }
    }
  }
 catch (  NumberFormatException e) {
    reportSettingsProblem(Log.WARN,"Error in package manager settings: package " + name + " has bad userId "+ idStr+ " at "+ parser.getPositionDescription());
  }
  ;
  if (su != null) {
    int outerDepth=parser.getDepth();
    int type;
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT && (type != XmlPullParser.END_TAG || parser.getDepth() > outerDepth)) {
      if (type == XmlPullParser.END_TAG || type == XmlPullParser.TEXT) {
        continue;
      }
      String tagName=parser.getName();
      if (tagName.equals("sigs")) {
        su.signatures.readXml(parser,mPastSignatures);
      }
 else       if (tagName.equals("perms")) {
        readGrantedPermissionsLP(parser,su.loadedPermissions);
      }
 else {
        reportSettingsProblem(Log.WARN,"Unknown element under <shared-user>: " + parser.getName());
        XmlUtils.skipCurrentTag(parser);
      }
    }
  }
 else {
    XmlUtils.skipCurrentTag(parser);
  }
}
