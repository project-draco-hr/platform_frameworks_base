{
  if (packageName == null) {
    Log.w(TAG,"Attempt to delete null packageName.");
    return false;
  }
  PackageParser.Package p;
  boolean dataOnly=false;
synchronized (mPackages) {
    p=mPackages.get(packageName);
    if (p == null) {
      dataOnly=true;
      PackageSetting ps=mSettings.mPackages.get(packageName);
      if (ps == null) {
        Log.w(TAG,"Package named '" + packageName + "' doesn't exist.");
        return false;
      }
      p=ps.pkg;
    }
  }
  if (p == null) {
    Log.w(TAG,"Package named '" + packageName + "' doesn't exist.");
    return false;
  }
  if (dataOnly) {
    removePackageDataLI(p,outInfo,flags);
    return true;
  }
  if (p.applicationInfo == null) {
    Log.w(TAG,"Package " + p.packageName + " has no applicationInfo.");
    return false;
  }
  boolean onSd=(p.applicationInfo.flags & ApplicationInfo.FLAG_ON_SDCARD) != 0;
  if (onSd) {
    mountSdDir(p.packageName,Process.SYSTEM_UID);
  }
  boolean ret=false;
  if ((p.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0) {
    Log.i(TAG,"Removing system package:" + p.packageName);
    ret=deleteSystemPackageLI(p,flags,outInfo);
  }
 else {
    Log.i(TAG,"Removing non-system package:" + p.packageName);
    ret=deleteInstalledPackageLI(p,deleteCodeAndResources,flags,outInfo);
  }
  if (ret && onSd) {
    sendDelayedDestroySdDir(packageName);
  }
  return ret;
}
