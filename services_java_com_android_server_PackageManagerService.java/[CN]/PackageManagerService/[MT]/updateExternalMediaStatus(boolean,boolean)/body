{
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("Media status can only be updated by the system");
  }
synchronized (mPackages) {
    Log.i(TAG,"Updating external media status from " + (mMediaMounted ? "mounted" : "unmounted") + " to "+ (mediaStatus ? "mounted" : "unmounted"));
    if (DEBUG_SD_INSTALL)     Log.i(TAG,"updateExternalMediaStatus:: mediaStatus=" + mediaStatus + ", mMediaMounted="+ mMediaMounted);
    if (mediaStatus == mMediaMounted) {
      if (reportStatus) {
        mHandler.sendEmptyMessage(UPDATED_MEDIA_STATUS);
      }
      return;
    }
    mMediaMounted=mediaStatus;
  }
  mHandler.post(new Runnable(){
    public void run(){
      mHandler.removeCallbacks(this);
      try {
        updateExternalMediaStatusInner(mediaStatus);
      }
  finally {
        if (reportStatus) {
          mHandler.sendEmptyMessage(UPDATED_MEDIA_STATUS);
        }
      }
    }
  }
);
}
