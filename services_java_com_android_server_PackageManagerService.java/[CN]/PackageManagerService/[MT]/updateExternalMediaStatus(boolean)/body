{
  final boolean ret;
synchronized (mPackages) {
    Log.i(TAG,"Updating external media status from " + (mMediaMounted ? "mounted" : "unmounted") + " to "+ (mediaStatus ? "mounted" : "unmounted"));
    if (DEBUG_SD_INSTALL)     Log.i(TAG,"updateExternalMediaStatus:: mediaStatus=" + mediaStatus + ", mMediaMounted="+ mMediaMounted);
    if (mediaStatus == mMediaMounted) {
      return false;
    }
    mMediaMounted=mediaStatus;
    Set<String> appList=mSettings.findPackagesWithFlag(ApplicationInfo.FLAG_EXTERNAL_STORAGE);
    ret=appList != null && appList.size() > 0;
    if (DEBUG_SD_INSTALL) {
      if (appList != null) {
        for (        String app : appList) {
          Log.i(TAG,"Should enable " + app + " on sdcard");
        }
      }
    }
    if (DEBUG_SD_INSTALL)     Log.i(TAG,"updateExternalMediaStatus returning " + ret);
  }
  mHandler.post(new Runnable(){
    public void run(){
      mHandler.removeCallbacks(this);
      updateExternalMediaStatusInner(mediaStatus,ret);
    }
  }
);
  return ret;
}
