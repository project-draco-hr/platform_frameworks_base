{
synchronized (mPackages) {
    if (DEBUG_SD_INSTALL)     Log.i(TAG,"updateExternalMediaStatus:: mediaStatus=" + mediaStatus + ", mMediaMounted="+ mMediaMounted);
    if (mediaStatus == mMediaMounted) {
      return false;
    }
    mMediaMounted=mediaStatus;
    boolean ret=false;
synchronized (mPackages) {
      Set<String> appList=mSettings.findPackagesWithFlag(ApplicationInfo.FLAG_ON_SDCARD);
      ret=appList != null && appList.size() > 0;
    }
    if (!ret) {
      return false;
    }
    mHandler.post(new Runnable(){
      public void run(){
        mHandler.removeCallbacks(this);
        final HashMap<SdInstallArgs,String> processCids=new HashMap<SdInstallArgs,String>();
        final int[] uidArr=getExternalMediaPackages(mediaStatus,processCids);
        if (mediaStatus) {
          if (DEBUG_SD_INSTALL)           Log.i(TAG,"Loading packages");
          loadMediaPackages(processCids,uidArr);
          startCleaningPackages();
        }
 else {
          if (DEBUG_SD_INSTALL)           Log.i(TAG,"Unloading packages");
          unloadMediaPackages(processCids,uidArr);
        }
      }
    }
);
    return true;
  }
}
