{
  if (DEBUG_SD_INSTALL)   Log.i(TAG,"unloading media packages");
  ArrayList<String> pkgList=new ArrayList<String>();
  ArrayList<SdInstallArgs> failedList=new ArrayList<SdInstallArgs>();
  Set<SdInstallArgs> keys=processCids.keySet();
  for (  SdInstallArgs args : keys) {
    String cid=args.cid;
    String pkgName=args.getPackageName();
    if (DEBUG_SD_INSTALL)     Log.i(TAG,"Trying to unload pkg : " + pkgName);
    PackageRemovedInfo outInfo=new PackageRemovedInfo();
synchronized (mInstallLock) {
      boolean res=deletePackageLI(pkgName,false,PackageManager.DONT_DELETE_DATA,outInfo);
      if (res) {
        pkgList.add(pkgName);
      }
 else {
        Log.e(TAG,"Failed to delete pkg  from sdcard : " + pkgName);
        failedList.add(args);
      }
    }
  }
  sendResourcesChangedBroadcast(false,pkgList,uidArr);
  if (pkgList.size() > 0) {
    Runtime.getRuntime().gc();
  }
  for (  SdInstallArgs args : failedList) {
synchronized (mInstallLock) {
      args.doPostDeleteLI(false);
    }
  }
}
