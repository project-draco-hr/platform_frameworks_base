{
  ApplicationInfo applicationInfo=p.applicationInfo;
  if (applicationInfo == null) {
    Log.w(TAG,"Package " + p.packageName + " has no applicationInfo.");
    return false;
  }
  PackageSetting ps=null;
synchronized (mPackages) {
    ps=mSettings.getDisabledSystemPkg(p.packageName);
  }
  if (ps == null) {
    Log.w(TAG,"Attempt to delete system package " + p.packageName);
    return false;
  }
 else {
    Log.i(TAG,"Deleting system pkg from data partition");
  }
  outInfo.isRemovedPackageSystemUpdate=true;
  boolean ret=deleteInstalledPackageLI(p,deleteCodeAndResources,flags,outInfo);
  if (!ret) {
    return false;
  }
synchronized (mPackages) {
    mSettings.enableSystemPackageLP(p.packageName);
  }
  PackageParser.Package newPkg=scanPackageLI(ps.codePath,ps.codePath,ps.resourcePath,PackageParser.PARSE_MUST_BE_APK | PackageParser.PARSE_IS_SYSTEM,SCAN_MONITOR);
  if (newPkg == null) {
    Log.w(TAG,"Failed to restore system package:" + p.packageName + " with error:"+ mLastScanError);
    return false;
  }
synchronized (mPackages) {
    mSettings.writeLP();
  }
  return true;
}
