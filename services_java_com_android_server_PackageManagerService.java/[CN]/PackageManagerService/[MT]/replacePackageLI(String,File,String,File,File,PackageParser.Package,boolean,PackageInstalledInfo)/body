{
  PackageParser.Package deletedPackage;
synchronized (mPackages) {
    deletedPackage=mPackages.get(pkgName);
    if (checkSignaturesLP(pkg,deletedPackage) != PackageManager.SIGNATURE_MATCH) {
      res.returnCode=PackageManager.INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES;
      return;
    }
  }
  boolean sysPkg=((deletedPackage.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0);
  if (sysPkg) {
    replaceSystemPackageLI(deletedPackage,tmpPackageFile,destFilePath,destPackageFile,destResourceFile,pkg,forwardLocked,res);
  }
 else {
    replaceNonSystemPackageLI(deletedPackage,tmpPackageFile,destFilePath,destPackageFile,destResourceFile,pkg,forwardLocked,res);
  }
}
