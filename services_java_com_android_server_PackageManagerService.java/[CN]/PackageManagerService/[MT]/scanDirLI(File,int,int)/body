{
  Log.d(TAG,"Scanning app dir " + dir);
  String[] files=dir.list();
  int i;
  for (i=0; i < files.length; i++) {
    File file=new File(dir,files[i]);
    File resFile=file;
    if ((scanMode & SCAN_FORWARD_LOCKED) != 0) {
      resFile=null;
    }
    PackageParser.Package pkg=scanPackageLI(file,file,resFile,flags | PackageParser.PARSE_MUST_BE_APK,scanMode);
    if (pkg == null && (flags & PackageParser.PARSE_IS_SYSTEM) == 0) {
      Log.w(TAG,"Cleaning up failed install of " + file);
      file.delete();
    }
  }
}
