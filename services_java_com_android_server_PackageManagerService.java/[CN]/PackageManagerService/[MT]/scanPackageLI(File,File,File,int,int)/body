{
  mLastScanError=PackageManager.INSTALL_SUCCEEDED;
  parseFlags|=mDefParseFlags;
  PackageParser pp=new PackageParser(scanFile.getPath());
  pp.setSeparateProcesses(mSeparateProcesses);
  pp.setSdkVersion(mSdkVersion);
  final PackageParser.Package pkg=pp.parsePackage(scanFile,destCodeFile.getAbsolutePath(),mMetrics,parseFlags);
  if (pkg == null) {
    mLastScanError=pp.getParseError();
    return null;
  }
  PackageSetting ps;
synchronized (mPackages) {
    ps=mSettings.peekPackageLP(pkg.packageName,scanFile.toString());
  }
  if (!collectCertificatesLI(pp,ps,pkg,scanFile,parseFlags)) {
    return null;
  }
  if (ps != null && !ps.codePath.equals(ps.resourcePath)) {
    scanMode|=SCAN_FORWARD_LOCKED;
  }
  return scanPackageLI(scanFile,destCodeFile,destResourceFile,pkg,parseFlags,scanMode | SCAN_UPDATE_SIGNATURE);
}
