{
  final ZipOutputStream publicZipOutStream=new ZipOutputStream(new FileOutputStream(publicZipFile));
  final ZipFile privateZip=new ZipFile(newPackage.mPath);
  final Enumeration<? extends ZipEntry> privateZipEntries=privateZip.entries();
  while (privateZipEntries.hasMoreElements()) {
    final ZipEntry zipEntry=privateZipEntries.nextElement();
    final String zipEntryName=zipEntry.getName();
    if ("AndroidManifest.xml".equals(zipEntryName) || "resources.arsc".equals(zipEntryName) || zipEntryName.startsWith("res/")) {
      try {
        copyZipEntry(zipEntry,privateZip,publicZipOutStream);
      }
 catch (      IOException e) {
        try {
          publicZipOutStream.close();
          throw e;
        }
  finally {
          publicZipFile.delete();
        }
      }
    }
  }
  publicZipOutStream.close();
  FileUtils.setPermissions(publicZipFile.getAbsolutePath(),FileUtils.S_IRUSR | FileUtils.S_IWUSR | FileUtils.S_IRGRP| FileUtils.S_IROTH,-1,-1);
}
