{
synchronized (mPackages) {
    if (info.labelRes == 0 && info.nonLocalizedLabel == null) {
      throw new SecurityException("Label must be specified in permission");
    }
    BasePermission tree=checkPermissionTreeLP(info.name);
    BasePermission bp=mSettings.mPermissions.get(info.name);
    boolean added=bp == null;
    if (added) {
      bp=new BasePermission(info.name,tree.sourcePackage,BasePermission.TYPE_DYNAMIC);
    }
 else     if (bp.type != BasePermission.TYPE_DYNAMIC) {
      throw new SecurityException("Not allowed to modify non-dynamic permission " + info.name);
    }
    bp.protectionLevel=info.protectionLevel;
    bp.perm=new PackageParser.Permission(tree.perm.owner,new PermissionInfo(info));
    bp.perm.info.packageName=tree.perm.info.packageName;
    bp.uid=tree.uid;
    if (added) {
      mSettings.mPermissions.put(info.name,bp);
    }
    mSettings.writeLP();
    return added;
  }
}
