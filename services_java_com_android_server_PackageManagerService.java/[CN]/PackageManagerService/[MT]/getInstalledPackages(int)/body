{
  ArrayList<PackageInfo> finalList=new ArrayList<PackageInfo>();
synchronized (mPackages) {
    Iterator<PackageParser.Package> i=mPackages.values().iterator();
    while (i.hasNext()) {
      final PackageParser.Package p=i.next();
      PackageInfo pi=generatePackageInfo(p,flags);
      if (pi != null) {
        finalList.add(pi);
      }
    }
  }
  return finalList;
}
