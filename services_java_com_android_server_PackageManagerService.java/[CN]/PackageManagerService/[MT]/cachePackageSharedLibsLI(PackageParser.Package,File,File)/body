{
  File sharedLibraryDir=new File(dataPath.getPath() + "/lib");
  final String sharedLibraryABI="armeabi";
  final String apkLibraryDirectory="lib/" + sharedLibraryABI + "/";
  final String apkSharedLibraryPrefix=apkLibraryDirectory + "lib";
  final String sharedLibrarySuffix=".so";
  boolean createdSharedLib=false;
  try {
    ZipFile zipFile=new ZipFile(scanFile);
    Enumeration<ZipEntry> entries=(Enumeration<ZipEntry>)zipFile.entries();
    while (entries.hasMoreElements()) {
      ZipEntry entry=entries.nextElement();
      if (entry.isDirectory()) {
        continue;
      }
      String entryName=entry.getName();
      if (!(entryName.startsWith(apkSharedLibraryPrefix) && entryName.endsWith(sharedLibrarySuffix))) {
        continue;
      }
      String libFileName=entryName.substring(apkLibraryDirectory.length());
      if (libFileName.contains("/") || (!FileUtils.isFilenameSafe(new File(libFileName)))) {
        continue;
      }
      String sharedLibraryFilePath=sharedLibraryDir.getPath() + File.separator + libFileName;
      File sharedLibraryFile=new File(sharedLibraryFilePath);
      if (!sharedLibraryFile.exists() || sharedLibraryFile.length() != entry.getSize() || sharedLibraryFile.lastModified() != entry.getTime()) {
        if (Config.LOGD) {
          Log.d(TAG,"Caching shared lib " + entry.getName());
        }
        if (mInstaller == null) {
          sharedLibraryDir.mkdir();
          createdSharedLib=true;
        }
        cacheSharedLibLI(pkg,zipFile,entry,sharedLibraryDir,sharedLibraryFile);
      }
    }
  }
 catch (  IOException e) {
    Log.e(TAG,"Failed to cache package shared libs",e);
    if (createdSharedLib) {
      sharedLibraryDir.delete();
    }
    throw e;
  }
}
