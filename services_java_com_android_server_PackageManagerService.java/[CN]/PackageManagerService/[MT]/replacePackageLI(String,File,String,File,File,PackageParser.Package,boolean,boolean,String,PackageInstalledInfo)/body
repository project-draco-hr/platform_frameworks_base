{
  PackageParser.Package oldPackage;
synchronized (mPackages) {
    oldPackage=mPackages.get(pkgName);
    if (checkSignaturesLP(pkg.mSignatures,oldPackage.mSignatures) != PackageManager.SIGNATURE_MATCH) {
      res.returnCode=PackageManager.INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES;
      return;
    }
  }
  boolean sysPkg=((oldPackage.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0);
  if (sysPkg) {
    replaceSystemPackageLI(oldPackage,tmpPackageFile,destFilePath,destPackageFile,destResourceFile,pkg,forwardLocked,newInstall,installerPackageName,res);
  }
 else {
    replaceNonSystemPackageLI(oldPackage,tmpPackageFile,destFilePath,destPackageFile,destResourceFile,pkg,forwardLocked,newInstall,installerPackageName,res);
  }
}
