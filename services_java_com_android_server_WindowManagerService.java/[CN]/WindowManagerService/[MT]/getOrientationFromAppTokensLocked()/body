{
  int pos=mAppTokens.size() - 1;
  int curGroup=0;
  int lastOrientation=ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;
  boolean findingBehind=false;
  boolean haveGroup=false;
  boolean lastFullscreen=false;
  while (pos >= 0) {
    AppWindowToken wtoken=mAppTokens.get(pos);
    pos--;
    if (!findingBehind && (!wtoken.hidden && wtoken.hiddenRequested)) {
      continue;
    }
    if (!haveGroup) {
      if (wtoken.hiddenRequested || wtoken.willBeHidden) {
        continue;
      }
      haveGroup=true;
      curGroup=wtoken.groupId;
      lastOrientation=wtoken.requestedOrientation;
    }
 else     if (curGroup != wtoken.groupId) {
      if (lastOrientation != ActivityInfo.SCREEN_ORIENTATION_BEHIND && lastFullscreen) {
        return lastOrientation;
      }
    }
    int or=wtoken.requestedOrientation;
    lastFullscreen=wtoken.appFullscreen;
    if (lastFullscreen && or != ActivityInfo.SCREEN_ORIENTATION_BEHIND) {
      return or;
    }
    if (or != ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED && or != ActivityInfo.SCREEN_ORIENTATION_BEHIND) {
      return or;
    }
    findingBehind|=(or == ActivityInfo.SCREEN_ORIENTATION_BEHIND);
  }
  return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;
}
