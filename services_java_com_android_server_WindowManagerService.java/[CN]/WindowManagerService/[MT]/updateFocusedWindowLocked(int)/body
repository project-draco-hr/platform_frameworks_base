{
  WindowState newFocus=computeFocusedWindowLocked();
  if (mCurrentFocus != newFocus) {
    if (mLastFocus == mCurrentFocus) {
      mH.sendEmptyMessage(H.REPORT_FOCUS_CHANGE);
    }
    if (localLOGV)     Log.v(TAG,"Changing focus from " + mCurrentFocus + " to "+ newFocus);
    final WindowState oldFocus=mCurrentFocus;
    mCurrentFocus=newFocus;
    mLosingFocus.remove(newFocus);
    if (newFocus != null) {
      mKeyWaiter.handleNewWindowLocked(newFocus);
    }
    final WindowState imWindow=mInputMethodWindow;
    if (newFocus != imWindow && oldFocus != imWindow) {
      moveInputMethodWindowsIfNeededLocked(mode != UPDATE_FOCUS_WILL_ASSIGN_LAYERS && mode != UPDATE_FOCUS_WILL_PLACE_SURFACES);
      mLayoutNeeded=true;
      if (mode == UPDATE_FOCUS_PLACING_SURFACES) {
        performLayoutLockedInner();
      }
 else       if (mode != UPDATE_FOCUS_WILL_PLACE_SURFACES) {
        mLayoutNeeded=true;
        performLayoutAndPlaceSurfacesLocked();
      }
    }
    return true;
  }
  return false;
}
