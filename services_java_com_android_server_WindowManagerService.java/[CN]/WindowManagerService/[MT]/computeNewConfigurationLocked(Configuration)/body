{
  if (mDisplay == null) {
    return false;
  }
  mInputManager.getInputConfiguration(config);
  final boolean rotated=(mRotation == Surface.ROTATION_90 || mRotation == Surface.ROTATION_270);
  final int dw=rotated ? mInitialDisplayHeight : mInitialDisplayWidth;
  final int dh=rotated ? mInitialDisplayWidth : mInitialDisplayHeight;
  int orientation=Configuration.ORIENTATION_SQUARE;
  if (dw < dh) {
    orientation=Configuration.ORIENTATION_PORTRAIT;
  }
 else   if (dw > dh) {
    orientation=Configuration.ORIENTATION_LANDSCAPE;
  }
  config.orientation=orientation;
  DisplayMetrics dm=new DisplayMetrics();
  mDisplay.getMetrics(dm);
  CompatibilityInfo.updateCompatibleScreenFrame(dm,orientation,mCompatibleScreenFrame);
  if (mScreenLayout == Configuration.SCREENLAYOUT_SIZE_UNDEFINED) {
    int longSize=dw;
    int shortSize=dh;
    if (longSize < shortSize) {
      int tmp=longSize;
      longSize=shortSize;
      shortSize=tmp;
    }
    longSize=(int)(longSize / dm.density);
    shortSize=(int)(shortSize / dm.density);
    if (longSize < 470) {
      mScreenLayout=Configuration.SCREENLAYOUT_SIZE_SMALL | Configuration.SCREENLAYOUT_LONG_NO;
    }
 else {
      if (longSize >= 800 && shortSize >= 600) {
        mScreenLayout=Configuration.SCREENLAYOUT_SIZE_XLARGE;
      }
 else       if (longSize >= 530 && shortSize >= 400) {
        mScreenLayout=Configuration.SCREENLAYOUT_SIZE_LARGE;
      }
 else {
        mScreenLayout=Configuration.SCREENLAYOUT_SIZE_NORMAL;
      }
      if (shortSize > 321 || longSize > 570) {
        mScreenLayout|=Configuration.SCREENLAYOUT_COMPAT_NEEDED;
      }
      if (((longSize * 3) / 5) >= (shortSize - 1)) {
        mScreenLayout|=Configuration.SCREENLAYOUT_LONG_YES;
      }
 else {
        mScreenLayout|=Configuration.SCREENLAYOUT_LONG_NO;
      }
    }
  }
  config.screenLayout=mScreenLayout;
  config.keyboardHidden=Configuration.KEYBOARDHIDDEN_NO;
  config.hardKeyboardHidden=Configuration.HARDKEYBOARDHIDDEN_NO;
  mPolicy.adjustConfigurationLw(config);
  boolean hardKeyboardAvailable=config.keyboard != Configuration.KEYBOARD_NOKEYS;
  if (hardKeyboardAvailable != mHardKeyboardAvailable) {
    mHardKeyboardAvailable=hardKeyboardAvailable;
    mHardKeyboardEnabled=hardKeyboardAvailable;
    mH.removeMessages(H.REPORT_HARD_KEYBOARD_STATUS_CHANGE);
    mH.sendEmptyMessage(H.REPORT_HARD_KEYBOARD_STATUS_CHANGE);
  }
  if (!mHardKeyboardEnabled) {
    config.keyboard=Configuration.KEYBOARD_NOKEYS;
    config.hardKeyboardHidden=Configuration.HARDKEYBOARDHIDDEN_NO;
  }
  return true;
}
