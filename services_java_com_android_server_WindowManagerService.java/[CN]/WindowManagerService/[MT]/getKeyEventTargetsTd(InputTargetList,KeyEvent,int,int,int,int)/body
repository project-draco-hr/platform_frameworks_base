{
  if (DEBUG_INPUT)   Slog.v(TAG,"Dispatch key: " + event);
  WindowState focus=getFocusedWindow();
  if (!checkInjectionPermissionTd(focus,injectorPid,injectorUid)) {
    return InputManager.INPUT_EVENT_INJECTION_PERMISSION_DENIED;
  }
  if (mPolicy.interceptKeyTi(focus,event.getKeyCode(),event.getMetaState(),event.getAction() == KeyEvent.ACTION_DOWN,event.getRepeatCount(),event.getFlags())) {
    return InputManager.INPUT_EVENT_INJECTION_SUCCEEDED;
  }
  if (focus == null) {
    return InputManager.INPUT_EVENT_INJECTION_FAILED;
  }
  wakeupIfNeeded(focus,LocalPowerManager.BUTTON_EVENT);
  addInputTargetTd(inputTargets,focus,InputTarget.FLAG_SYNC);
  return InputManager.INPUT_EVENT_INJECTION_SUCCEEDED;
}
