{
  if (!mDisplayFrozen) {
    return;
  }
  if (mWaitingForConfig || mAppsFreezingScreen > 0 || mWindowsFreezingScreen) {
    return;
  }
  mDisplayFrozen=false;
  mH.removeMessages(H.APP_FREEZE_TIMEOUT);
  if (PROFILE_ORIENTATION) {
    Debug.stopMethodTracing();
  }
  boolean updateRotation=false;
  if (CUSTOM_SCREEN_ROTATION) {
    if (mScreenRotationAnimation != null) {
      if (mScreenRotationAnimation.dismiss(MAX_ANIMATION_DURATION,mTransitionAnimationScale)) {
        requestAnimationLocked(0);
      }
 else {
        mScreenRotationAnimation=null;
        updateRotation=true;
      }
    }
  }
 else {
    Surface.unfreezeDisplay(0);
  }
  mInputMonitor.thawInputDispatchingLw();
  if (updateOrientationFromAppTokensLocked(false)) {
    mH.sendEmptyMessage(H.SEND_NEW_CONFIGURATION);
  }
  mH.removeMessages(H.FORCE_GC);
  mH.sendMessageDelayed(mH.obtainMessage(H.FORCE_GC),2000);
  mScreenFrozenLock.release();
  if (updateRotation) {
    if (DEBUG_ORIENTATION)     Slog.d(TAG,"Performing post-rotate rotation");
    boolean changed=setRotationUncheckedLocked(WindowManagerPolicy.USE_LAST_ROTATION,0,false);
    if (changed) {
      sendNewConfiguration();
    }
  }
}
