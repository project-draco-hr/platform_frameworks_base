{
  final WindowState imWin=mInputMethodWindow;
  final int DN=mInputMethodDialogs.size();
  if (imWin == null && DN == 0) {
    return false;
  }
  int imPos=findDesiredInputMethodWindowIndexLocked();
  if (imPos >= 0) {
    WindowState firstImWin=imPos < DN ? (WindowState)mWindows.get(imPos) : null;
    if (imWin != null) {
      if (imWin == firstImWin) {
        return false;
      }
    }
 else {
      if (mInputMethodDialogs.get(0) == firstImWin) {
        return false;
      }
    }
    if (imWin != null) {
      int oldPos=mWindows.indexOf(imWin);
      mWindows.remove(oldPos);
      if (imPos > oldPos)       imPos--;
      imWin.mTargetAppToken=mInputMethodTarget.mAppToken;
      mWindows.add(imPos,imWin);
      if (DN > 0)       moveInputMethodDialogsLocked(imPos + 1);
    }
 else {
      moveInputMethodDialogsLocked(imPos);
    }
  }
 else {
    if (imWin != null) {
      mWindows.remove(imWin);
      imWin.mTargetAppToken=null;
      addWindowToListInOrderLocked(imWin);
      if (DN > 0)       moveInputMethodDialogsLocked(-1);
      ;
    }
 else {
      moveInputMethodDialogsLocked(-1);
      ;
    }
  }
  if (needAssignLayers) {
    assignLayersLocked();
  }
  return true;
}
