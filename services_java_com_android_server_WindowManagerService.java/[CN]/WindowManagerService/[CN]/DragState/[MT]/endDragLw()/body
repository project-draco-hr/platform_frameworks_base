{
  mDragState.broadcastDragEndedLw();
  mDragState.unregister();
  mInputMonitor.setUpdateInputWindowsNeededLw();
  mInputMonitor.updateInputWindowsLw();
  final boolean performRotation=mPerformDeferredRotation;
  final int rotation=mRotation;
  final int animFlags=mAnimFlags;
  mDragState.reset();
  mDragState=null;
  if (performRotation) {
    if (DEBUG_ORIENTATION)     Slog.d(TAG,"Performing post-drag rotation");
    boolean changed=setRotationUncheckedLocked(rotation,animFlags,false);
    if (changed) {
      sendNewConfiguration();
    }
  }
}
