{
  if (appToken == null) {
    return;
  }
  int numInteresting=0;
  int numVisible=0;
  boolean nowGone=true;
  if (DEBUG_VISIBILITY)   Slog.v(TAG,"Update reported visibility: " + this);
  final int N=allAppWindows.size();
  for (int i=0; i < N; i++) {
    WindowState win=allAppWindows.get(i);
    if (win == startingWindow || win.mAppFreezing || win.mViewVisibility != View.VISIBLE || win.mAttrs.type == TYPE_APPLICATION_STARTING || win.mDestroying) {
      continue;
    }
    if (DEBUG_VISIBILITY) {
      Slog.v(TAG,"Win " + win + ": isDrawn="+ win.isDrawnLw()+ ", isAnimating="+ win.isAnimating());
      if (!win.isDrawnLw()) {
        Slog.v(TAG,"Not displayed: s=" + win.mSurface + " pv="+ win.mPolicyVisibility+ " dp="+ win.mDrawPending+ " cdp="+ win.mCommitDrawPending+ " ah="+ win.mAttachedHidden+ " th="+ (win.mAppToken != null ? win.mAppToken.hiddenRequested : false)+ " a="+ win.mAnimating);
      }
    }
    numInteresting++;
    if (win.isDrawnLw()) {
      if (!win.isAnimating()) {
        numVisible++;
      }
      nowGone=false;
    }
 else     if (win.isAnimating()) {
      nowGone=false;
    }
  }
  boolean nowVisible=numInteresting > 0 && numVisible >= numInteresting;
  if (DEBUG_VISIBILITY)   Slog.v(TAG,"VIS " + this + ": interesting="+ numInteresting+ " visible="+ numVisible);
  if (nowVisible != reportedVisible) {
    if (DEBUG_VISIBILITY)     Slog.v(TAG,"Visibility changed in " + this + ": vis="+ nowVisible);
    reportedVisible=nowVisible;
    Message m=mH.obtainMessage(H.REPORT_APPLICATION_TOKEN_WINDOWS,nowVisible ? 1 : 0,nowGone ? 1 : 0,this);
    mH.sendMessage(m);
  }
}
