{
  mDimSurface.setLayer(w.mAnimLayer - 1);
  final float target=w.mExiting ? 0 : w.mAttrs.dimAmount;
  if (SHOW_TRANSACTIONS)   Log.i(TAG,"  DIM " + mDimSurface + ": layer="+ (w.mAnimLayer - 1)+ " target="+ target);
  if (mDimTargetAlpha != target) {
    mLastDimAnimTime=currentTime;
    long duration=(w.mAnimating && w.mAnimation != null) ? w.mAnimation.computeDurationHint() : DEFAULT_DIM_DURATION;
    if (target > mDimTargetAlpha) {
      duration*=DIM_DURATION_MULTIPLIER;
    }
    if (duration < 1) {
      duration=1;
    }
    mDimTargetAlpha=target;
    mDimDeltaPerMs=(mDimTargetAlpha - mDimCurrentAlpha) / duration;
  }
}
