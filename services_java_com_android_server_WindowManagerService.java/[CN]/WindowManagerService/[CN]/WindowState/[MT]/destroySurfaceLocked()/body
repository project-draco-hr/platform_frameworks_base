{
  if (!ENABLE_NATIVE_INPUT_DISPATCH) {
    mKeyWaiter.finishedKey(mSession,mClient,true,KeyWaiter.RETURN_NOTHING);
    mKeyWaiter.releasePendingPointerLocked(mSession);
    mKeyWaiter.releasePendingTrackballLocked(mSession);
  }
  if (mAppToken != null && this == mAppToken.startingWindow) {
    mAppToken.startingDisplayed=false;
  }
  if (mSurface != null) {
    mDrawPending=false;
    mCommitDrawPending=false;
    mReadyToShow=false;
    int i=mChildWindows.size();
    while (i > 0) {
      i--;
      WindowState c=(WindowState)mChildWindows.get(i);
      c.mAttachedHidden=true;
      if (ENABLE_NATIVE_INPUT_DISPATCH) {
        mInputMonitor.windowIsBecomingInvisibleLw(c);
      }
    }
    if (mReportDestroySurface) {
      mReportDestroySurface=false;
      mSurfacePendingDestroy=true;
      try {
        mClient.dispatchGetNewSurface();
        return;
      }
 catch (      RemoteException e) {
      }
    }
    try {
      if (DEBUG_VISIBILITY) {
        RuntimeException e=null;
        if (!HIDE_STACK_CRAWLS) {
          e=new RuntimeException();
          e.fillInStackTrace();
        }
        Slog.w(TAG,"Window " + this + " destroying surface "+ mSurface+ ", session "+ mSession,e);
      }
      if (SHOW_TRANSACTIONS) {
        RuntimeException e=null;
        if (!HIDE_STACK_CRAWLS) {
          e=new RuntimeException();
          e.fillInStackTrace();
        }
        if (SHOW_TRANSACTIONS)         logSurface(this,"DESTROY",e);
      }
      mSurface.destroy();
    }
 catch (    RuntimeException e) {
      Slog.w(TAG,"Exception thrown when destroying Window " + this + " surface "+ mSurface+ " session "+ mSession+ ": "+ e.toString());
    }
    mSurfaceShown=false;
    mSurface=null;
  }
}
