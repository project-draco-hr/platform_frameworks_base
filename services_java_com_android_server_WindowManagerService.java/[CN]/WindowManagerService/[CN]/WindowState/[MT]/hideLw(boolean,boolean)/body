{
  if (doAnimation) {
    if (mDisplayFrozen || !mPolicy.isScreenOn()) {
      doAnimation=false;
    }
  }
  boolean current=doAnimation ? mPolicyVisibilityAfterAnim : mPolicyVisibility;
  if (!current) {
    return false;
  }
  if (doAnimation) {
    applyAnimationLocked(this,WindowManagerPolicy.TRANSIT_EXIT,false);
    if (mAnimation == null) {
      doAnimation=false;
    }
  }
  if (doAnimation) {
    mPolicyVisibilityAfterAnim=false;
  }
 else {
    if (DEBUG_VISIBILITY)     Slog.v(TAG,"Policy visibility false: " + this);
    mPolicyVisibilityAfterAnim=false;
    mPolicyVisibility=false;
    enableScreenIfNeededLocked();
    if (mCurrentFocus == this) {
      mFocusMayChange=true;
    }
  }
  if (requestAnim) {
    requestAnimationLocked(0);
  }
  return true;
}
