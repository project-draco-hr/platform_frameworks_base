{
  IBinder token=window.asBinder();
  if (DEBUG_DRAG) {
    Slog.d(TAG,"Drop result=" + consumed + " reported by "+ token);
  }
synchronized (mWindowMap) {
    long ident=Binder.clearCallingIdentity();
    try {
      if (mDragState.mToken != token) {
        Slog.w(TAG,"Invalid drop-result claim by " + window);
        throw new IllegalStateException("reportDropResult() by non-recipient");
      }
      mH.removeMessages(H.DRAG_END_TIMEOUT,window.asBinder());
      WindowState callingWin=windowForClientLocked(null,window,false);
      if (callingWin == null) {
        Slog.w(TAG,"Bad result-reporting window " + window);
        return;
      }
      mDragState.mDragResult=consumed;
      mDragState.endDragLw();
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
