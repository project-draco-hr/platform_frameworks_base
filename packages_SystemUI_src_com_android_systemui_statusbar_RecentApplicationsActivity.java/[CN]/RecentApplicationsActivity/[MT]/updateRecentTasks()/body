{
  final PackageManager pm=getPackageManager();
  final ActivityManager am=(ActivityManager)getSystemService(Context.ACTIVITY_SERVICE);
  final List<ActivityManager.RecentTaskInfo> recentTasks=am.getRecentTasks(MAX_TASKS,ActivityManager.RECENT_IGNORE_UNAVAILABLE);
  ActivityInfo homeInfo=new Intent(Intent.ACTION_MAIN).addCategory(Intent.CATEGORY_HOME).resolveActivityInfo(pm,0);
  int numTasks=recentTasks.size();
  mActivityDescriptions.clear();
  for (int i=0, index=0; i < numTasks && (index < MAX_TASKS); ++i) {
    final ActivityManager.RecentTaskInfo recentInfo=recentTasks.get(i);
    Intent intent=new Intent(recentInfo.baseIntent);
    if (recentInfo.origActivity != null) {
      intent.setComponent(recentInfo.origActivity);
    }
    if (homeInfo != null && homeInfo.packageName.equals(intent.getComponent().getPackageName()) && homeInfo.name.equals(intent.getComponent().getClassName())) {
      continue;
    }
    intent.setFlags((intent.getFlags() & ~Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) | Intent.FLAG_ACTIVITY_NEW_TASK);
    final ResolveInfo resolveInfo=pm.resolveActivity(intent,0);
    if (resolveInfo != null) {
      final ActivityInfo info=resolveInfo.activityInfo;
      final String title=info.loadLabel(pm).toString();
      Drawable icon=info.loadIcon(pm);
      int id=recentTasks.get(i).id;
      if (id != -1 && title != null && title.length() > 0 && icon != null) {
        ActivityDescription item=new ActivityDescription(null,icon,title,null,id,index);
        item.intent=intent;
        mActivityDescriptions.add(item);
        if (DBG)         Log.v(TAG,"Added item[" + index + "], id="+ item.id+ ", title="+ item.label);
        ++index;
      }
 else {
        if (DBG)         Log.v(TAG,"SKIPPING item " + id);
      }
    }
  }
}
