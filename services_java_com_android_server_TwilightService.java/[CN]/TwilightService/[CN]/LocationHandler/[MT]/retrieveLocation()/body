{
  Location location=null;
  final Iterator<String> providers=mLocationManager.getProviders(new Criteria(),true).iterator();
  while (providers.hasNext()) {
    final Location lastKnownLocation=mLocationManager.getLastKnownLocation(providers.next());
    if (location == null || (lastKnownLocation != null && location.getElapsedRealtimeNano() < lastKnownLocation.getElapsedRealtimeNano())) {
      location=lastKnownLocation;
    }
  }
  if (location == null) {
    Time currentTime=new Time();
    currentTime.set(System.currentTimeMillis());
    double lngOffset=FACTOR_GMT_OFFSET_LONGITUDE * (currentTime.gmtoff - (currentTime.isDst > 0 ? 3600 : 0));
    location=new Location("fake");
    location.setLongitude(lngOffset);
    location.setLatitude(0);
    location.setAccuracy(417000.0f);
    location.setTime(System.currentTimeMillis());
    location.setElapsedRealtimeNano(SystemClock.elapsedRealtimeNanos());
    if (DEBUG) {
      Slog.d(TAG,"Estimated location from timezone: " + location);
    }
  }
  setLocation(location);
}
