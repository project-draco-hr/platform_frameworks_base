{
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    Slog.w(TAG,"Non-system process uid=" + Binder.getCallingUid() + " attemping install-time restore");
    return;
  }
  long restoreSet=getAvailableRestoreToken(packageName);
  if (DEBUG)   Slog.v(TAG,"restoreAtInstall pkg=" + packageName + " token="+ Integer.toHexString(token)+ " restoreSet="+ Long.toHexString(restoreSet));
  if (mAutoRestore && mProvisioned && restoreSet != 0) {
    IBackupTransport transport=getTransport(mCurrentTransport);
    if (transport == null) {
      if (DEBUG)       Slog.w(TAG,"No transport for install-time restore");
      return;
    }
    try {
      String dirName=transport.transportDirName();
      PackageInfo pkg=new PackageInfo();
      pkg.packageName=packageName;
      mWakelock.acquire();
      Message msg=mBackupHandler.obtainMessage(MSG_RUN_RESTORE);
      msg.obj=new RestoreParams(transport,dirName,null,restoreSet,pkg,token,true);
      mBackupHandler.sendMessage(msg);
    }
 catch (    RemoteException e) {
      Slog.e(TAG,"Unable to contact transport for install-time restore");
    }
  }
 else {
    if (DEBUG)     Slog.v(TAG,"No restore set -- skipping restore");
    try {
      mPackageManagerBinder.finishPackageInstall(token);
    }
 catch (    RemoteException e) {
    }
  }
}
