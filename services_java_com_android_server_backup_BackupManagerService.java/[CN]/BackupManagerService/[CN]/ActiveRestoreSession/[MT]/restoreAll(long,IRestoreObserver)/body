{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BACKUP,"performRestore");
  if (DEBUG)   Slog.d(TAG,"restoreAll token=" + Long.toHexString(token) + " observer="+ observer);
  if (mEnded) {
    throw new IllegalStateException("Restore session already ended");
  }
  if (mRestoreTransport == null || mRestoreSets == null) {
    Slog.e(TAG,"Ignoring restoreAll() with no restore set");
    return -1;
  }
  if (mPackageName != null) {
    Slog.e(TAG,"Ignoring restoreAll() on single-package session");
    return -1;
  }
synchronized (mQueueLock) {
    for (int i=0; i < mRestoreSets.length; i++) {
      if (token == mRestoreSets[i].token) {
        long oldId=Binder.clearCallingIdentity();
        mWakelock.acquire();
        Message msg=mBackupHandler.obtainMessage(MSG_RUN_RESTORE);
        msg.obj=new RestoreParams(mRestoreTransport,observer,token,true);
        mBackupHandler.sendMessage(msg);
        Binder.restoreCallingIdentity(oldId);
        return 0;
      }
    }
  }
  Slog.w(TAG,"Restore token " + Long.toHexString(token) + " not found");
  return -1;
}
