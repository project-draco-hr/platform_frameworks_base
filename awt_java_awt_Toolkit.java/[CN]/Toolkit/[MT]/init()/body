{
  lockAWT();
  try {
    ComponentInternals.setComponentInternals(new ComponentInternalsImpl());
    new EventQueue(this);
    dispatcher=new Dispatcher(this);
    final String className=getWTKClassName();
    desktopProperties=new HashMap<String,Object>();
    desktopPropsSupport=new PropertyChangeSupport(this);
    awtEventsManager=new AWTEventsManager();
    dispatchThread=new EventDispatchThread(this,dispatcher);
    nativeThread=new NativeEventThread();
    NativeEventThread.Init init=new NativeEventThread.Init(){
      public WTK init(){
        wtk=createWTK(className);
        wtk.getNativeEventQueue().setShutdownWatchdog(shutdownWatchdog);
        synchronizer.setEnvironment(wtk,dispatchThread);
        ContextStorage.setWTK(wtk);
        return wtk;
      }
    }
;
    nativeThread.start(init);
    dispatchThread.start();
    wtk.getNativeEventQueue().awake();
  }
  finally {
    unlockAWT();
  }
}
