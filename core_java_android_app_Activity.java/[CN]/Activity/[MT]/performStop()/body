{
  if (mLoadersStarted) {
    mLoadersStarted=false;
    if (mLoaderManager != null) {
      if (!mChangingConfigurations) {
        mLoaderManager.doStop();
      }
 else {
        mLoaderManager.doRetain();
      }
    }
  }
  if (!mStopped) {
    if (mWindow != null) {
      mWindow.closeAllPanels();
    }
    if (mToken != null && mParent == null) {
      WindowManagerImpl.getDefault().setStoppedState(mToken,true);
    }
    mFragments.dispatchStop();
    mCalled=false;
    mInstrumentation.callActivityOnStop(this);
    if (!mCalled) {
      throw new SuperNotCalledException("Activity " + mComponent.toShortString() + " did not call through to super.onStop()");
    }
synchronized (mManagedCursors) {
      final int N=mManagedCursors.size();
      for (int i=0; i < N; i++) {
        ManagedCursor mc=mManagedCursors.get(i);
        if (!mc.mReleased) {
          mc.mCursor.deactivate();
          mc.mReleased=true;
        }
      }
    }
    mStopped=true;
  }
  mResumed=false;
}
