{
  java.awt.geom.AffineTransform canvasMatrix;
  try {
    canvasMatrix=xform.createInverse();
  }
 catch (  java.awt.geom.NoninvertibleTransformException e) {
    Bridge.getLog().fidelityWarning(LayoutLog.TAG_MATRIX_INVERSE,"Unable to inverse matrix in BitmapShader",e,null);
    canvasMatrix=new java.awt.geom.AffineTransform();
  }
  java.awt.geom.AffineTransform localMatrix=getLocalMatrix();
  try {
    localMatrix=localMatrix.createInverse();
  }
 catch (  java.awt.geom.NoninvertibleTransformException e) {
    Bridge.getLog().fidelityWarning(LayoutLog.TAG_MATRIX_INVERSE,"Unable to inverse matrix in BitmapShader",e,null);
    localMatrix=new java.awt.geom.AffineTransform();
  }
  if (!colorModel.isCompatibleRaster(mImage.getRaster())) {
    colorModel=ColorModel.getRGBdefault();
  }
  return new BitmapShaderContext(canvasMatrix,localMatrix,colorModel);
}
