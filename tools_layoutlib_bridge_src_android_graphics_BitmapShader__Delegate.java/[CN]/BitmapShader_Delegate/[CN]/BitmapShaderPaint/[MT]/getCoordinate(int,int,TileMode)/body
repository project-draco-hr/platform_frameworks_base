{
  if (i < 0) {
switch (mode) {
case CLAMP:
      i=0;
    break;
case REPEAT:
  i=size - 1 - (-i % size);
break;
case MIRROR:
i=-i;
int count=i / size;
i=i % size;
if ((count % 2) == 1) {
i=size - 1 - i;
}
break;
}
}
 else if (i >= size) {
switch (mode) {
case CLAMP:
i=size - 1;
break;
case REPEAT:
i=i % size;
break;
case MIRROR:
int count=i / size;
i=i % size;
if ((count % 2) == 1) {
i=size - 1 - i;
}
break;
}
}
return i;
}
