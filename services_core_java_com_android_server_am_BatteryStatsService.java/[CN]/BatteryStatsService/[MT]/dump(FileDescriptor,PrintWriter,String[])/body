{
  if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.DUMP) != PackageManager.PERMISSION_GRANTED) {
    pw.println("Permission Denial: can't dump BatteryStats from from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " without permission "+ android.Manifest.permission.DUMP);
    return;
  }
  int flags=0;
  boolean isCheckin=false;
  boolean noOutput=false;
  long historyStart=-1;
  int reqUid=-1;
  if (args != null) {
    for (int i=0; i < args.length; i++) {
      String arg=args[i];
      if ("--checkin".equals(arg)) {
        isCheckin=true;
      }
 else       if ("--history".equals(arg)) {
        flags|=BatteryStats.DUMP_HISTORY_ONLY;
      }
 else       if ("--history-start".equals(arg)) {
        flags|=BatteryStats.DUMP_HISTORY_ONLY;
        i++;
        if (i >= args.length) {
          pw.println("Missing time argument for --history-since");
          dumpHelp(pw);
          return;
        }
        historyStart=Long.parseLong(args[i]);
      }
 else       if ("-c".equals(arg)) {
        isCheckin=true;
        flags|=BatteryStats.DUMP_INCLUDE_HISTORY;
      }
 else       if ("--unplugged".equals(arg)) {
        flags|=BatteryStats.DUMP_UNPLUGGED_ONLY;
      }
 else       if ("--charged".equals(arg)) {
        flags|=BatteryStats.DUMP_CHARGED_ONLY;
      }
 else       if ("--reset".equals(arg)) {
synchronized (mStats) {
          mStats.resetAllStatsCmdLocked();
          pw.println("Battery stats reset.");
          noOutput=true;
        }
      }
 else       if ("--write".equals(arg)) {
synchronized (mStats) {
          mStats.writeSyncLocked();
          pw.println("Battery stats written.");
          noOutput=true;
        }
      }
 else       if ("--enable".equals(arg)) {
        i=doEnableOrDisable(pw,i,args,true);
        if (i < 0) {
          return;
        }
        pw.println("Enabled: " + args[i]);
        return;
      }
 else       if ("--disable".equals(arg)) {
        i=doEnableOrDisable(pw,i,args,false);
        if (i < 0) {
          return;
        }
        pw.println("Disabled: " + args[i]);
        return;
      }
 else       if ("-h".equals(arg)) {
        dumpHelp(pw);
        return;
      }
 else       if ("-a".equals(arg)) {
        flags|=BatteryStats.DUMP_VERBOSE;
      }
 else       if (arg.length() > 0 && arg.charAt(0) == '-') {
        pw.println("Unknown option: " + arg);
        dumpHelp(pw);
        return;
      }
 else {
        try {
          reqUid=mContext.getPackageManager().getPackageUid(arg,UserHandle.getCallingUserId());
        }
 catch (        PackageManager.NameNotFoundException e) {
          pw.println("Unknown package: " + arg);
          dumpHelp(pw);
          return;
        }
      }
    }
  }
  if (noOutput) {
    return;
  }
  if (isCheckin) {
    List<ApplicationInfo> apps=mContext.getPackageManager().getInstalledApplications(0);
synchronized (mStats) {
      mStats.dumpCheckinLocked(mContext,pw,apps,flags,historyStart);
    }
  }
 else {
synchronized (mStats) {
      mStats.dumpLocked(mContext,pw,flags,reqUid,historyStart);
    }
  }
}
