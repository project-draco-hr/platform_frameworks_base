{
  if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.DUMP) != PackageManager.PERMISSION_GRANTED) {
    pw.println("Permission Denial: can't dump BatteryStats from from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " without permission "+ android.Manifest.permission.DUMP);
    return;
  }
  boolean isCheckin=false;
  boolean includeHistory=false;
  boolean isUnpluggedOnly=false;
  boolean noOutput=false;
  int reqUid=-1;
  if (args != null) {
    for (    String arg : args) {
      if ("--checkin".equals(arg)) {
        isCheckin=true;
      }
 else       if ("-c".equals(arg)) {
        isCheckin=true;
        includeHistory=true;
      }
 else       if ("--unplugged".equals(arg)) {
        isUnpluggedOnly=true;
      }
 else       if ("--reset".equals(arg)) {
synchronized (mStats) {
          mStats.resetAllStatsLocked();
          pw.println("Battery stats reset.");
          noOutput=true;
        }
      }
 else       if ("--write".equals(arg)) {
synchronized (mStats) {
          mStats.writeSyncLocked();
          pw.println("Battery stats written.");
          noOutput=true;
        }
      }
 else       if ("-h".equals(arg)) {
        dumpHelp(pw);
        return;
      }
 else       if ("-a".equals(arg)) {
      }
 else       if (arg.length() > 0 && arg.charAt(0) == '-') {
        pw.println("Unknown option: " + arg);
        dumpHelp(pw);
        return;
      }
 else {
        try {
          reqUid=mContext.getPackageManager().getPackageUid(arg,UserHandle.getCallingUserId());
        }
 catch (        PackageManager.NameNotFoundException e) {
          pw.println("Unknown package: " + arg);
          dumpHelp(pw);
          return;
        }
      }
    }
  }
  if (noOutput) {
    return;
  }
  if (isCheckin) {
    List<ApplicationInfo> apps=mContext.getPackageManager().getInstalledApplications(0);
synchronized (mStats) {
      mStats.dumpCheckinLocked(pw,apps,isUnpluggedOnly,includeHistory);
    }
  }
 else {
synchronized (mStats) {
      mStats.dumpLocked(pw,isUnpluggedOnly,reqUid);
    }
  }
}
