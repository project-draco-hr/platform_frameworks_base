{
  if (mWifiManager == null) {
    mWifiManager=IWifiManager.Stub.asInterface(ServiceManager.getService(Context.WIFI_SERVICE));
    if (mWifiManager == null) {
      return null;
    }
  }
  try {
    WifiActivityEnergyInfo info=mWifiManager.reportActivityInfo();
    if (info != null && info.isValid()) {
      if (info.mControllerEnergyUsed < 0 || info.mControllerIdleTimeMs < 0 || info.mControllerRxTimeMs < 0 || info.mControllerTxTimeMs < 0) {
        Slog.wtf(TAG,"Reported WiFi energy data is invalid: " + info);
        return null;
      }
      final WifiActivityEnergyInfo result=mLastInfo;
      result.mTimestamp=info.getTimeStamp();
      result.mStackState=info.getStackState();
      result.mControllerTxTimeMs=info.mControllerTxTimeMs - mLastInfo.mControllerTxTimeMs;
      result.mControllerRxTimeMs=info.mControllerRxTimeMs - mLastInfo.mControllerRxTimeMs;
      result.mControllerIdleTimeMs=Math.max(0,info.mControllerIdleTimeMs - mLastInfo.mControllerIdleTimeMs);
      result.mControllerEnergyUsed=Math.max(0,info.mControllerEnergyUsed - mLastInfo.mControllerEnergyUsed);
      if (result.mControllerTxTimeMs < 0 || result.mControllerRxTimeMs < 0) {
        result.mControllerEnergyUsed=info.mControllerEnergyUsed;
        result.mControllerRxTimeMs=info.mControllerRxTimeMs;
        result.mControllerTxTimeMs=info.mControllerTxTimeMs;
        result.mControllerIdleTimeMs=info.mControllerIdleTimeMs;
        Slog.v(TAG,"WiFi energy data was reset, new WiFi energy data is " + result);
      }
      mLastInfo=info;
      return result;
    }
  }
 catch (  RemoteException e) {
  }
  return null;
}
