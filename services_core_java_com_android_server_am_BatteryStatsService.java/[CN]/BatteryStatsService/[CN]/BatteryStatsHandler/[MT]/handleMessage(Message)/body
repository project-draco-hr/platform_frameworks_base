{
switch (msg.what) {
case MSG_SYNC_EXTERNAL_STATS:
    final int updateFlags;
synchronized (this) {
    removeMessages(MSG_SYNC_EXTERNAL_STATS);
    updateFlags=mUpdateFlags;
    mUpdateFlags=0;
  }
updateExternalStats((String)msg.obj,updateFlags);
synchronized (mStats) {
synchronized (this) {
  final int numUidsToRemove=mUidsToRemove.size();
  for (int i=0; i < numUidsToRemove; i++) {
    mStats.removeIsolatedUidLocked(mUidsToRemove.get(i));
  }
}
mUidsToRemove.clear();
}
break;
case MSG_WRITE_TO_DISK:
updateExternalStats("write",UPDATE_ALL);
synchronized (mStats) {
mStats.writeAsyncLocked();
}
break;
}
}
