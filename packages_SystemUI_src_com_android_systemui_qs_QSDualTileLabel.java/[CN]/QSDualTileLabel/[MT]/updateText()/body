{
  if (getWidth() == 0)   return;
  if (TextUtils.isEmpty(mText)) {
    mFirstLine.setText(null);
    mSecondLine.setText(null);
    mSecondLine.setVisibility(GONE);
    return;
  }
  final float maxWidth=getWidth() - mFirstLineCaret.getWidth() - mHorizontalPaddingPx- getPaddingLeft()- getPaddingRight();
  float width=mFirstLine.getPaint().measureText(mText);
  if (width <= maxWidth) {
    mFirstLine.setText(mText);
    mSecondLine.setText(null);
    mSecondLine.setVisibility(GONE);
    return;
  }
  final int n=mText.length();
  int lastWordBoundary=-1;
  boolean inWhitespace=false;
  int i=0;
  for (i=1; i < n; i++) {
    width=mFirstLine.getPaint().measureText(mText.substring(0,i));
    final boolean done=width > maxWidth;
    if (Character.isWhitespace(mText.charAt(i))) {
      if (!inWhitespace && !done) {
        lastWordBoundary=i;
      }
      inWhitespace=true;
    }
 else {
      inWhitespace=false;
    }
    if (done) {
      break;
    }
  }
  if (lastWordBoundary == -1) {
    lastWordBoundary=i - 1;
  }
  mFirstLine.setText(mText.substring(0,lastWordBoundary));
  mSecondLine.setText(mText.substring(lastWordBoundary).trim());
  mSecondLine.setVisibility(VISIBLE);
}
