{
  mContext=context;
  mDisplay=display;
  display.getMetrics(mDisplayMetrics);
  Bitmap screenshot=Surface.screenshot(0,0);
  if (screenshot != null) {
    mSnapshotRotation=0;
    mWidth=screenshot.getWidth();
    mHeight=screenshot.getHeight();
  }
 else {
    mSnapshotRotation=display.getRotation();
    mWidth=mDisplayMetrics.widthPixels;
    mHeight=mDisplayMetrics.heightPixels;
  }
  mOriginalRotation=display.getRotation();
  mOriginalWidth=mDisplayMetrics.widthPixels;
  mOriginalHeight=mDisplayMetrics.heightPixels;
  Surface.openTransaction();
  try {
    mSurface=new Surface(session,0,"FreezeSurface",-1,mWidth,mHeight,PixelFormat.OPAQUE,0);
    mSurface.setLayer(WindowManagerService.TYPE_LAYER_MULTIPLIER * 200);
  }
 catch (  Surface.OutOfResourcesException e) {
    Slog.w(TAG,"Unable to allocate freeze surface",e);
  }
  if (false) {
    try {
      int size=mOriginalWidth > mOriginalHeight ? mOriginalWidth : mOriginalHeight;
      mBlackSurface=new Surface(session,0,"BlackSurface",-1,size,size,PixelFormat.OPAQUE,Surface.FX_SURFACE_DIM);
      mBlackSurface.setAlpha(1.0f);
      mBlackSurface.setLayer(0);
    }
 catch (    Surface.OutOfResourcesException e) {
      Slog.w(TAG,"Unable to allocate black surface",e);
    }
  }
  setRotation(display.getRotation());
  if (mSurface != null) {
    Rect dirty=new Rect(0,0,mWidth,mHeight);
    Canvas c=null;
    try {
      c=mSurface.lockCanvas(dirty);
    }
 catch (    IllegalArgumentException e) {
      Slog.w(TAG,"Unable to lock surface",e);
      return;
    }
catch (    Surface.OutOfResourcesException e) {
      Slog.w(TAG,"Unable to lock surface",e);
      return;
    }
    if (c == null) {
      Slog.w(TAG,"Null surface");
      return;
    }
    if (screenshot != null) {
      c.drawBitmap(screenshot,0,0,new Paint(0));
    }
 else {
      c.drawColor(Color.GREEN);
    }
    mSurface.unlockCanvasAndPost(c);
  }
  Surface.closeTransaction();
  if (screenshot != null) {
    screenshot.recycle();
  }
}
