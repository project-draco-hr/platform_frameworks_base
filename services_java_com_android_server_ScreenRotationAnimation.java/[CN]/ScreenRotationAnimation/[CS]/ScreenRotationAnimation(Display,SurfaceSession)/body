{
  final DisplayMetrics dm=new DisplayMetrics();
  display.getMetrics(dm);
  Bitmap screenshot=Surface.screenshot(0,0);
  if (screenshot != null) {
    mBaseRotation=0;
    mWidth=screenshot.getWidth();
    mHeight=screenshot.getHeight();
  }
 else {
    mBaseRotation=display.getRotation();
    mWidth=dm.widthPixels;
    mHeight=dm.heightPixels;
  }
  Surface.openTransaction();
  if (mSurface != null) {
    mSurface.destroy();
    mSurface=null;
  }
  try {
    mSurface=new Surface(session,0,"FreezeSurface",-1,mWidth,mHeight,PixelFormat.OPAQUE,0);
  }
 catch (  Surface.OutOfResourcesException e) {
    Slog.w(TAG,"Unable to allocate freeze surface",e);
  }
  mSurface.setLayer(WindowManagerService.TYPE_LAYER_MULTIPLIER * 200);
  setRotation(display.getRotation());
  Rect dirty=new Rect(0,0,mWidth,mHeight);
  Canvas c=null;
  try {
    c=mSurface.lockCanvas(dirty);
  }
 catch (  IllegalArgumentException e) {
    Slog.w(TAG,"Unable to lock surface",e);
    return;
  }
catch (  Surface.OutOfResourcesException e) {
    Slog.w(TAG,"Unable to lock surface",e);
    return;
  }
  if (c == null) {
    Slog.w(TAG,"Null surface");
    return;
  }
  if (screenshot != null) {
    c.drawBitmap(screenshot,0,0,new Paint(0));
  }
 else {
    c.drawColor(Color.GREEN);
  }
  mSurface.unlockCanvasAndPost(c);
  Surface.closeTransaction();
  screenshot.recycle();
}
