{
  if (DEBUG)   Log.d(TAG,"updateConnectionState " + BluetoothUtil.deviceToString(device) + " "+ BluetoothUtil.profileToString(profile)+ " "+ BluetoothUtil.connectionStateToString(state));
  DeviceInfo info=updateInfo(device);
  int stateIndex=0;
  for (int i=0; i < CONNECTION_STATES.length; i++) {
    if (CONNECTION_STATES[i] == state) {
      stateIndex=i;
      break;
    }
  }
  info.profileStates.put(profile,stateIndex);
  info.connectionStateIndex=0;
  final int N=info.profileStates.size();
  for (int i=0; i < N; i++) {
    if (info.profileStates.valueAt(i) > info.connectionStateIndex) {
      info.connectionStateIndex=info.profileStates.valueAt(i);
    }
  }
  if (state == BluetoothProfile.STATE_CONNECTED) {
    info.connectedProfiles.put(profile,true);
  }
 else {
    info.connectedProfiles.remove(profile);
  }
}
