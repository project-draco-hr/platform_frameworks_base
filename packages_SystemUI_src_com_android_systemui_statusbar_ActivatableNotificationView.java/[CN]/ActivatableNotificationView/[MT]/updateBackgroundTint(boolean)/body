{
  if (mBackgroundColorAnimator != null) {
    mBackgroundColorAnimator.cancel();
  }
  int rippleColor=getRippleColor();
  mBackgroundDimmed.setRippleColor(rippleColor);
  mBackgroundNormal.setRippleColor(rippleColor);
  int color=calculateBgColor();
  if (!animated) {
    setBackgroundTintColor(color);
  }
 else   if (color != mCurrentBackgroundTint) {
    mStartTint=mCurrentBackgroundTint;
    mTargetTint=color;
    mBackgroundColorAnimator=ValueAnimator.ofFloat(0.0f,1.0f);
    mBackgroundColorAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener(){
      @Override public void onAnimationUpdate(      ValueAnimator animation){
        int newColor=NotificationUtils.interpolateColors(mStartTint,mTargetTint,animation.getAnimatedFraction());
        setBackgroundTintColor(newColor);
      }
    }
);
    mBackgroundColorAnimator.setDuration(StackStateAnimator.ANIMATION_DURATION_STANDARD);
    mBackgroundColorAnimator.setInterpolator(Interpolators.LINEAR);
    mBackgroundColorAnimator.addListener(new AnimatorListenerAdapter(){
      @Override public void onAnimationEnd(      Animator animation){
        mBackgroundColorAnimator=null;
      }
    }
);
    mBackgroundColorAnimator.start();
  }
}
