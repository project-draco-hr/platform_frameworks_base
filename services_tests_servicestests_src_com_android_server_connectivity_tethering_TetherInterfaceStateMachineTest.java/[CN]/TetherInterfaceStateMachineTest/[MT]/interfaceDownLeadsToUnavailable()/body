{
  for (  boolean shouldThrow : new boolean[]{true,false}) {
    initTetheredStateMachine(ConnectivityManager.TETHERING_USB,null);
    if (shouldThrow) {
      doThrow(RemoteException.class).when(mNMService).untetherInterface(IFACE_NAME);
    }
    dispatchCommand(TetherInterfaceStateMachine.CMD_INTERFACE_DOWN);
    InOrder usbTeardownOrder=inOrder(mNMService,mInterfaceConfiguration);
    usbTeardownOrder.verify(mInterfaceConfiguration).setInterfaceDown();
    usbTeardownOrder.verify(mNMService).setInterfaceConfig(IFACE_NAME,mInterfaceConfiguration);
    verify(mTetherHelper).notifyInterfaceTetheringReadiness(false,mTestedSm);
    assertFalse("Should not be available",mTestedSm.isAvailable());
    assertFalse("Should not be tethered",mTestedSm.isTethered());
  }
}
