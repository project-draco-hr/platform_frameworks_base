{
  XmlUtils.writeLongAttribute(xml,END_TIME_ATTR,stats.endTime - stats.beginTime);
  xml.startTag(null,PACKAGES_TAG);
  final int statsCount=stats.packageStats.size();
  for (int i=0; i < statsCount; i++) {
    writeUsageStats(xml,stats,stats.packageStats.valueAt(i));
  }
  xml.endTag(null,PACKAGES_TAG);
  xml.startTag(null,CONFIGURATIONS_TAG);
  final int configCount=stats.configurations.size();
  for (int i=0; i < configCount; i++) {
    boolean active=stats.activeConfiguration.equals(stats.configurations.keyAt(i));
    writeConfigStats(xml,stats,stats.configurations.valueAt(i),active);
  }
  xml.endTag(null,CONFIGURATIONS_TAG);
  xml.startTag(null,EVENT_LOG_TAG);
  final int eventCount=stats.events != null ? stats.events.size() : 0;
  for (int i=0; i < eventCount; i++) {
    writeEvent(xml,stats,stats.events.valueAt(i));
  }
  xml.endTag(null,EVENT_LOG_TAG);
}
