{
  String packageName=XmlUtils.readStringAttribute(parser,PACKAGE_ATTR);
  String className;
  if (packageName == null) {
    final String componentName=XmlUtils.readStringAttribute(parser,NAME_ATTR);
    if (componentName == null) {
      throw new ProtocolException("no " + NAME_ATTR + " or "+ PACKAGE_ATTR+ " attribute present");
    }
    ComponentName component=ComponentName.unflattenFromString(componentName);
    if (component == null) {
      throw new ProtocolException("ComponentName " + componentName + " is invalid");
    }
    packageName=component.getPackageName();
    className=component.getClassName();
  }
 else {
    className=XmlUtils.readStringAttribute(parser,CLASS_ATTR);
  }
  UsageEvents.Event event=statsOut.buildEvent(packageName,className);
  event.mEventType=XmlUtils.readIntAttribute(parser,TYPE_ATTR);
  event.mTimeStamp=XmlUtils.readLongAttribute(parser,TIME_ATTR);
  if (event.mEventType == UsageEvents.Event.CONFIGURATION_CHANGE) {
    event.mConfiguration=new Configuration();
    Configuration.readXmlAttrs(parser,event.mConfiguration);
  }
  if (statsOut.events == null) {
    statsOut.events=new TimeSparseArray<>();
  }
  statsOut.events.put(event.mTimeStamp,event);
}
