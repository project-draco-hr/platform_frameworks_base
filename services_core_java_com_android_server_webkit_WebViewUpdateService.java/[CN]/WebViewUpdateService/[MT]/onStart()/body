{
  mWebViewUpdatedReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      if (intent.getAction().equals(Intent.ACTION_PACKAGE_REMOVED) && intent.getExtras().getBoolean(Intent.EXTRA_REPLACING)) {
synchronized (WebViewUpdateService.this) {
          if (mCurrentWebViewPackage == null)           return;
          String webViewPackage="package:" + mCurrentWebViewPackage.packageName;
          if (webViewPackage.equals(intent.getDataString()))           mCurrentProviderBeingReplaced=true;
        }
        return;
      }
      if (intent.getAction().equals(Intent.ACTION_PACKAGE_CHANGED)) {
        if (!WebViewFactory.entirePackageChanged(intent)) {
          return;
        }
      }
      if (intent.getAction().equals(Intent.ACTION_USER_ADDED)) {
        int userId=intent.getIntExtra(Intent.EXTRA_USER_HANDLE,UserHandle.USER_NULL);
        handleNewUser(userId);
        return;
      }
      updateFallbackState(context,intent);
      for (      WebViewProviderInfo provider : mWebViewUtility.getWebViewPackages()) {
        String webviewPackage="package:" + provider.packageName;
        if (webviewPackage.equals(intent.getDataString())) {
          boolean updateWebView=false;
          boolean removedOrChangedOldPackage=false;
          String oldProviderName=null;
          PackageInfo newPackage=null;
synchronized (WebViewUpdateService.this) {
            try {
              updateValidWebViewPackages();
              newPackage=findPreferredWebViewPackage();
              if (mCurrentWebViewPackage != null)               oldProviderName=mCurrentWebViewPackage.packageName;
              updateWebView=provider.packageName.equals(newPackage.packageName) || provider.packageName.equals(oldProviderName) || mCurrentWebViewPackage == null;
              removedOrChangedOldPackage=provider.packageName.equals(oldProviderName);
              if (updateWebView) {
                onWebViewProviderChanged(newPackage);
              }
            }
 catch (            WebViewFactory.MissingWebViewPackageException e) {
              Slog.e(TAG,"Could not find valid WebView package to create " + "relro with " + e);
            }
          }
          if (updateWebView && !removedOrChangedOldPackage && oldProviderName != null) {
            mWebViewUtility.killPackageDependents(oldProviderName);
          }
          return;
        }
      }
    }
  }
;
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_PACKAGE_ADDED);
  filter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  filter.addAction(Intent.ACTION_PACKAGE_CHANGED);
  filter.addDataScheme("package");
  for (  WebViewProviderInfo provider : mWebViewUtility.getWebViewPackages()) {
    filter.addDataSchemeSpecificPart(provider.packageName,PatternMatcher.PATTERN_LITERAL);
  }
  getContext().registerReceiver(mWebViewUpdatedReceiver,filter);
  IntentFilter userAddedFilter=new IntentFilter();
  userAddedFilter.addAction(Intent.ACTION_USER_ADDED);
  getContext().registerReceiver(mWebViewUpdatedReceiver,userAddedFilter);
  publishBinderService("webviewupdate",new BinderService(),true);
}
