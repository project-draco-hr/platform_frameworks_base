{
  PackageInfo oldPackage=null;
  PackageInfo newPackage=null;
synchronized (this) {
    oldPackage=mCurrentWebViewPackage;
    mWebViewUtility.updateUserSetting(getContext(),newProviderName);
    try {
      newPackage=findPreferredWebViewPackage();
      if (oldPackage != null && newPackage.packageName.equals(oldPackage.packageName)) {
        mWebViewUtility.updateUserSetting(getContext(),newPackage.packageName);
        return newPackage.packageName;
      }
    }
 catch (    WebViewFactory.MissingWebViewPackageException e) {
      Slog.e(TAG,"Tried to change WebView provider but failed to fetch WebView package " + e);
      return newProviderName;
    }
    onWebViewProviderChanged(newPackage);
  }
  if (oldPackage != null) {
    mWebViewUtility.killPackageDependents(oldPackage.packageName);
  }
  return newPackage.packageName;
}
