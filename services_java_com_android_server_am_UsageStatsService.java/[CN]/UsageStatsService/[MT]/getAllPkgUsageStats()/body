{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.PACKAGE_USAGE_STATS,null);
synchronized (mStatsLock) {
    int size=mLastResumeTimes.size();
    if (size <= 0) {
      return null;
    }
    PkgUsageStats retArr[]=new PkgUsageStats[size];
    int i=0;
    for (    Map.Entry<String,Map<String,Long>> entry : mLastResumeTimes.entrySet()) {
      String pkg=entry.getKey();
      long usageTime=0;
      int launchCount=0;
      PkgUsageStatsExtended pus=mStats.get(pkg);
      if (pus != null) {
        usageTime=pus.mUsageTime;
        launchCount=pus.mLaunchCount;
      }
      retArr[i]=new PkgUsageStats(pkg,launchCount,usageTime,entry.getValue());
      i++;
    }
    return retArr;
  }
}
