{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.PACKAGE_USAGE_STATS,null);
synchronized (mStatsLock) {
    int size=mLastResumeTimes.size();
    if (size <= 0) {
      return null;
    }
    PkgUsageStats retArr[]=new PkgUsageStats[size];
    for (int i=0; i < size; i++) {
      String pkg=mLastResumeTimes.keyAt(i);
      long usageTime=0;
      int launchCount=0;
      PkgUsageStatsExtended pus=mStats.get(pkg);
      if (pus != null) {
        usageTime=pus.mUsageTime;
        launchCount=pus.mLaunchCount;
      }
      retArr[i]=new PkgUsageStats(pkg,launchCount,usageTime,mLastResumeTimes.valueAt(i));
    }
    return retArr;
  }
}
