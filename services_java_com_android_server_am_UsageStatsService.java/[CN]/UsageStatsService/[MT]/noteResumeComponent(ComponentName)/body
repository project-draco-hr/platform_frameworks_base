{
  enforceCallingPermission();
  String pkgName;
synchronized (mStatsLock) {
    if ((componentName == null) || ((pkgName=componentName.getPackageName()) == null)) {
      return;
    }
    final boolean samePackage=pkgName.equals(mLastResumedPkg);
    if (mIsResumed) {
      if (mLastResumedPkg != null) {
        if (REPORT_UNEXPECTED)         Slog.i(TAG,"Unexpected resume of " + pkgName + " while already resumed in "+ mLastResumedPkg);
        PkgUsageStatsExtended pus=mStats.get(mLastResumedPkg);
        if (pus != null) {
          pus.updatePause();
        }
      }
    }
    final boolean sameComp=samePackage && componentName.getClassName().equals(mLastResumedComp);
    mIsResumed=true;
    mLastResumedPkg=pkgName;
    mLastResumedComp=componentName.getClassName();
    if (localLOGV)     Slog.i(TAG,"started component:" + pkgName);
    PkgUsageStatsExtended pus=mStats.get(pkgName);
    if (pus == null) {
      pus=new PkgUsageStatsExtended();
      mStats.put(pkgName,pus);
    }
    pus.updateResume(mLastResumedComp,!samePackage);
    if (!sameComp) {
      pus.addLaunchCount(mLastResumedComp);
    }
    Map<String,Long> componentResumeTimes=mLastResumeTimes.get(pkgName);
    if (componentResumeTimes == null) {
      componentResumeTimes=new HashMap<String,Long>();
      mLastResumeTimes.put(pkgName,componentResumeTimes);
    }
    componentResumeTimes.put(mLastResumedComp,System.currentTimeMillis());
  }
}
