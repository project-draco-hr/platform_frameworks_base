{
synchronized (mFileLock) {
    long currTime=new Date().getTime();
    boolean dayChanged=((currTime - mLastTime) >= (24 * 60 * 60* 1000));
    long currRealTime=SystemClock.elapsedRealtime();
    if (((currRealTime - mLastWriteRealTime) < _FILE_WRITE_INTERVAL) && (!dayChanged)) {
      return;
    }
    String todayStr=getCurrentDateStr(mFilePrefix);
    File backupFile=new File(mFile.getPath() + ".bak");
    mFile.renameTo(backupFile);
    try {
      checkFileLimitFLOCK();
      mFile.createNewFile();
      writeStatsFLOCK();
      mLastWriteRealTime=currRealTime;
      mLastTime=currTime;
      if (dayChanged) {
synchronized (mStats) {
          mStats.clear();
        }
        mFile=new File(todayStr);
      }
      if (backupFile != null) {
        backupFile.delete();
      }
    }
 catch (    IOException e) {
      Log.w(TAG,"Failed writing stats to file:" + mFile);
      if (backupFile != null) {
        backupFile.renameTo(mFile);
      }
    }
  }
}
