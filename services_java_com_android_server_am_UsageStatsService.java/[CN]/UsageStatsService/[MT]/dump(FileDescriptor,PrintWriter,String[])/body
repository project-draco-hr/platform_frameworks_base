{
  if (mContext.checkCallingPermission(android.Manifest.permission.DUMP) != PackageManager.PERMISSION_GRANTED) {
    pw.println("Permission Denial: can't dump UsageStats from from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " without permission "+ android.Manifest.permission.DUMP);
    return;
  }
  final boolean isCheckinRequest=scanArgs(args,"--checkin");
  final boolean isCompactOutput=isCheckinRequest || scanArgs(args,"-c");
  final boolean deleteAfterPrint=isCheckinRequest || scanArgs(args,"-d");
  final String rawPackages=scanArgsData(args,"--packages");
  if (!deleteAfterPrint) {
    writeStatsToFile(true,false);
  }
  HashSet<String> packages=null;
  if (rawPackages != null) {
    if (!"*".equals(rawPackages)) {
      String[] names=rawPackages.split(",");
      if (names.length != 0) {
        packages=new HashSet<String>();
      }
      for (      String n : names) {
        packages.add(n);
      }
    }
  }
 else   if (isCheckinRequest) {
    Slog.w(TAG,"Checkin without packages");
    return;
  }
synchronized (mFileLock) {
    collectDumpInfoFLOCK(pw,isCompactOutput,deleteAfterPrint,packages);
  }
}
