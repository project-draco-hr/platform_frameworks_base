{
  if (!mAmbientLuxValid || (time - mLightSensorEnableTime) < mLightSensorWarmUpTimeConfig) {
    if (DEBUG) {
      Slog.d(TAG,"updateAmbientLux: Initializing, " + "mAmbientLux=" + (mAmbientLuxValid ? mAmbientLux : -1) + ", mRecentShortTermAverageLux="+ mRecentShortTermAverageLux+ ", mRecentLongTermAverageLux="+ mRecentLongTermAverageLux);
    }
    mAmbientLux=mRecentShortTermAverageLux;
    mAmbientLuxValid=true;
    mLastAmbientBrightenTime=time;
    mLastAmbientDarkenTime=time;
    updateAutoBrightness(true);
    return;
  }
  float minAmbientLux=mAmbientLux * (1.0f + BRIGHTENING_LIGHT_HYSTERESIS);
  if (mRecentShortTermAverageLux > minAmbientLux && mRecentLongTermAverageLux > minAmbientLux) {
    long debounceTime=mLastAmbientDarkenTime + BRIGHTENING_LIGHT_DEBOUNCE;
    if (time >= debounceTime) {
      if (DEBUG) {
        Slog.d(TAG,"updateAmbientLux: Brightened: " + "mAmbientLux=" + mAmbientLux + ", mRecentShortTermAverageLux="+ mRecentShortTermAverageLux+ ", mRecentLongTermAverageLux="+ mRecentLongTermAverageLux);
      }
      mLastAmbientBrightenTime=time;
      mAmbientLux=mRecentShortTermAverageLux;
      updateAutoBrightness(true);
    }
 else {
      mHandler.sendEmptyMessageAtTime(MSG_LIGHT_SENSOR_DEBOUNCED,debounceTime);
    }
    return;
  }
  float maxAmbientLux=mAmbientLux * (1.0f - DARKENING_LIGHT_HYSTERESIS);
  if (mRecentShortTermAverageLux < maxAmbientLux && mRecentLongTermAverageLux < maxAmbientLux) {
    long debounceTime=mLastAmbientBrightenTime + DARKENING_LIGHT_DEBOUNCE;
    if (time >= debounceTime) {
      if (DEBUG) {
        Slog.d(TAG,"updateAmbientLux: Darkened: " + "mAmbientLux=" + mAmbientLux + ", mRecentShortTermAverageLux="+ mRecentShortTermAverageLux+ ", mRecentLongTermAverageLux="+ mRecentLongTermAverageLux);
      }
      mLastAmbientDarkenTime=time;
      mAmbientLux=mRecentShortTermAverageLux;
      updateAutoBrightness(true);
    }
 else {
      mHandler.sendEmptyMessageAtTime(MSG_LIGHT_SENSOR_DEBOUNCED,debounceTime);
    }
  }
}
