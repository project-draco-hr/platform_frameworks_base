{
  if (lastSunset < 0 || nextSunrise < 0 || now < lastSunset || now > nextSunrise) {
    return 1.0f;
  }
  if (now < lastSunset + TWILIGHT_ADJUSTMENT_TIME) {
    return lerp(1.0f,TWILIGHT_ADJUSTMENT_MAX_GAMMA,(float)(now - lastSunset) / TWILIGHT_ADJUSTMENT_TIME);
  }
  if (now > nextSunrise - TWILIGHT_ADJUSTMENT_TIME) {
    return lerp(1.0f,TWILIGHT_ADJUSTMENT_MAX_GAMMA,(float)(nextSunrise - now) / TWILIGHT_ADJUSTMENT_TIME);
  }
  return TWILIGHT_ADJUSTMENT_MAX_GAMMA;
}
