{
  if (overlay.getMediaItem() != this) {
    throw new IllegalArgumentException("Media item mismatch");
  }
  if (mOverlays.contains(overlay)) {
    throw new IllegalArgumentException("Overlay already exists: " + overlay.getId());
  }
  if (overlay.getStartTime() + overlay.getDuration() > getDuration()) {
    throw new IllegalArgumentException("Overlay start time + overlay duration > media clip duration");
  }
  if (overlay instanceof OverlayFrame) {
    final OverlayFrame frame=(OverlayFrame)overlay;
    final Bitmap bitmap=frame.getBitmap();
    if (bitmap == null) {
      throw new IllegalArgumentException("Overlay bitmap not specified");
    }
    final int scaledWidth, scaledHeight;
    if (this instanceof MediaVideoItem) {
      scaledWidth=getWidth();
      scaledHeight=getHeight();
    }
 else {
      scaledWidth=((MediaImageItem)this).getScaledWidth();
      scaledHeight=((MediaImageItem)this).getScaledHeight();
    }
    if (bitmap.getWidth() != scaledWidth || bitmap.getHeight() != scaledHeight) {
      throw new IllegalArgumentException("Bitmap dimensions must match media item dimensions");
    }
  }
 else {
    throw new IllegalArgumentException("Overlay not supported");
  }
  mOverlays.add(overlay);
  invalidateTransitions(overlay.getStartTime(),overlay.getDuration());
}
