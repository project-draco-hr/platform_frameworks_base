{
  if (mLaunchBounds != null) {
    mInTask.updateOverrideConfiguration(mLaunchBounds);
    int stackId=mInTask.getLaunchStackId();
    if (stackId != mInTask.stack.mStackId) {
      final ActivityStack stack=mSupervisor.moveTaskToStackUncheckedLocked(mInTask,stackId,ON_TOP,!FORCE_FOCUS,"inTaskToFront");
      stackId=stack.mStackId;
    }
    if (StackId.resizeStackWithLaunchBounds(stackId)) {
      mService.resizeStack(stackId,mLaunchBounds,true,!PRESERVE_WINDOWS,ANIMATE);
    }
  }
  mTargetStack=mInTask.stack;
  mTargetStack.moveTaskToFrontLocked(mInTask,mNoAnimation,mOptions,mStartActivity.appTimeTracker,"inTaskToFront");
  ActivityRecord top=mInTask.getTopActivity();
  if (top != null && top.realActivity.equals(mStartActivity.realActivity) && top.userId == mStartActivity.userId) {
    if ((mLaunchFlags & FLAG_ACTIVITY_SINGLE_TOP) != 0 || mLaunchSingleTop || mLaunchSingleTask) {
      ActivityStack.logStartActivity(AM_NEW_INTENT,top,top.task);
      if ((mStartFlags & START_FLAG_ONLY_IF_NEEDED) != 0) {
        return START_RETURN_INTENT_TO_CALLER;
      }
      top.deliverNewIntentLocked(mCallingUid,mStartActivity.intent,mStartActivity.launchedFromPackage);
      return START_DELIVERED_TO_TOP;
    }
  }
  if (!mAddingToTask) {
    ActivityOptions.abort(mOptions);
    return START_TASK_TO_FRONT;
  }
  mStartActivity.setTask(mInTask,null);
  if (DEBUG_TASKS)   Slog.v(TAG_TASKS,"Starting new activity " + mStartActivity + " in explicit task "+ mStartActivity.task);
  return START_SUCCESS;
}
