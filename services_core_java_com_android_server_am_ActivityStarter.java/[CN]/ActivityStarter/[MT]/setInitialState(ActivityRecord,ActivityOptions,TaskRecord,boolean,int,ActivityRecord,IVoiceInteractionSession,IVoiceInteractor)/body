{
  reset();
  mStartActivity=r;
  mIntent=r.intent;
  mOptions=options;
  mCallingUid=r.launchedFromUid;
  mSourceRecord=sourceRecord;
  mVoiceSession=voiceSession;
  mVoiceInteractor=voiceInteractor;
  mLaunchBounds=getOverrideBounds(r,options,inTask);
  mLaunchSingleTop=r.launchMode == LAUNCH_SINGLE_TOP;
  mLaunchSingleInstance=r.launchMode == LAUNCH_SINGLE_INSTANCE;
  mLaunchSingleTask=r.launchMode == LAUNCH_SINGLE_TASK;
  mLaunchFlags=adjustLaunchFlagsToDocumentMode(r,mLaunchSingleInstance,mLaunchSingleTask,mIntent.getFlags());
  mLaunchTaskBehind=r.mLaunchTaskBehind && !mLaunchSingleTask && !mLaunchSingleInstance&& (mLaunchFlags & FLAG_ACTIVITY_NEW_DOCUMENT) != 0;
  sendNewTaskResultRequestIfNeeded();
  if ((mLaunchFlags & FLAG_ACTIVITY_NEW_DOCUMENT) != 0 && r.resultTo == null) {
    mLaunchFlags|=FLAG_ACTIVITY_NEW_TASK;
  }
  if ((mLaunchFlags & FLAG_ACTIVITY_NEW_TASK) != 0) {
    if (mLaunchTaskBehind || r.info.documentLaunchMode == DOCUMENT_LAUNCH_ALWAYS) {
      mLaunchFlags|=FLAG_ACTIVITY_MULTIPLE_TASK;
    }
  }
  mSupervisor.mUserLeaving=(mLaunchFlags & FLAG_ACTIVITY_NO_USER_ACTION) == 0;
  if (DEBUG_USER_LEAVING)   Slog.v(TAG_USER_LEAVING,"startActivity() => mUserLeaving=" + mSupervisor.mUserLeaving);
  mDoResume=doResume;
  if (!doResume || !mSupervisor.okToShowLocked(r)) {
    r.delayedResume=true;
    mDoResume=false;
  }
  if (mOptions != null && mOptions.getLaunchTaskId() != -1 && mOptions.getTaskOverlay()) {
    r.mTaskOverlay=true;
    final TaskRecord task=mSupervisor.anyTaskForIdLocked(mOptions.getLaunchTaskId());
    final ActivityRecord top=task != null ? task.getTopActivity() : null;
    if (top != null && !top.visible) {
      mDoResume=false;
      mAvoidMoveToFront=true;
    }
  }
  mNotTop=(mLaunchFlags & FLAG_ACTIVITY_PREVIOUS_IS_TOP) != 0 ? r : null;
  mInTask=inTask;
  if (inTask != null && !inTask.inRecents) {
    Slog.w(TAG,"Starting activity in task not in recents: " + inTask);
    mInTask=null;
  }
  mStartFlags=startFlags;
  if ((startFlags & START_FLAG_ONLY_IF_NEEDED) != 0) {
    ActivityRecord checkedCaller=sourceRecord;
    if (checkedCaller == null) {
      checkedCaller=mSupervisor.mFocusedStack.topRunningNonDelayedActivityLocked(mNotTop);
    }
    if (!checkedCaller.realActivity.equals(r.realActivity)) {
      mStartFlags&=~START_FLAG_ONLY_IF_NEEDED;
    }
  }
  mNoAnimation=(mLaunchFlags & FLAG_ACTIVITY_NO_ANIMATION) != 0;
}
