{
  Slog.i(TAG,"Applying SELinux policy");
  File contexts=new File(updateDir.getParentFile(),"contexts");
  File current=new File(updateDir.getParentFile(),"current");
  File update=new File(updateDir.getParentFile(),"update");
  File tmp=new File(updateDir.getParentFile(),"tmp");
  if (current.exists()) {
    Libcore.os.symlink(updateDir.getPath(),update.getPath());
    Libcore.os.rename(update.getPath(),current.getPath());
  }
 else {
    Libcore.os.symlink(updateDir.getPath(),current.getPath());
  }
  contexts.mkdirs();
  backupContexts(contexts);
  copyUpdate(contexts);
  Libcore.os.symlink(contexts.getPath(),tmp.getPath());
  Libcore.os.rename(tmp.getPath(),current.getPath());
  SystemProperties.set("selinux.reload_policy","1");
}
