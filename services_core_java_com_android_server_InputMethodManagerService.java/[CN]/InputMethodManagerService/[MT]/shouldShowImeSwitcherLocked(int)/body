{
  if (!mShowOngoingImeSwitcherForPhones)   return false;
  if (mSwitchingDialog != null)   return false;
  if (isScreenLocked())   return false;
  if ((visibility & InputMethodService.IME_ACTIVE) == 0)   return false;
  if (mWindowManagerService.isHardKeyboardAvailable()) {
    return true;
  }
  if ((visibility & InputMethodService.IME_VISIBLE) == 0)   return false;
  List<InputMethodInfo> imis=mSettings.getEnabledInputMethodListLocked();
  final int N=imis.size();
  if (N > 2)   return true;
  if (N < 1)   return false;
  int nonAuxCount=0;
  int auxCount=0;
  InputMethodSubtype nonAuxSubtype=null;
  InputMethodSubtype auxSubtype=null;
  for (int i=0; i < N; ++i) {
    final InputMethodInfo imi=imis.get(i);
    final List<InputMethodSubtype> subtypes=mSettings.getEnabledInputMethodSubtypeListLocked(mContext,imi,true);
    final int subtypeCount=subtypes.size();
    if (subtypeCount == 0) {
      ++nonAuxCount;
    }
 else {
      for (int j=0; j < subtypeCount; ++j) {
        final InputMethodSubtype subtype=subtypes.get(j);
        if (!subtype.isAuxiliary()) {
          ++nonAuxCount;
          nonAuxSubtype=subtype;
        }
 else {
          ++auxCount;
          auxSubtype=subtype;
        }
      }
    }
  }
  if (nonAuxCount > 1 || auxCount > 1) {
    return true;
  }
 else   if (nonAuxCount == 1 && auxCount == 1) {
    if (nonAuxSubtype != null && auxSubtype != null && (nonAuxSubtype.getLocale().equals(auxSubtype.getLocale()) || auxSubtype.overridesImplicitlyEnabledSubtype() || nonAuxSubtype.overridesImplicitlyEnabledSubtype()) && nonAuxSubtype.containsExtraValueKey(TAG_TRY_SUPPRESSING_IME_SWITCHER)) {
      return false;
    }
    return true;
  }
  return false;
}
