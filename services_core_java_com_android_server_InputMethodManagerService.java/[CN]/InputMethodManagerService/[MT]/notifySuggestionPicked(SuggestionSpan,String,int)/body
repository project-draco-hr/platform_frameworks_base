{
  if (!calledFromValidUser()) {
    return false;
  }
synchronized (mMethodMap) {
    final InputMethodInfo targetImi=mSecureSuggestionSpans.get(span);
    if (targetImi != null) {
      final String[] suggestions=span.getSuggestions();
      if (index < 0 || index >= suggestions.length)       return false;
      final String className=span.getNotificationTargetClassName();
      final Intent intent=new Intent();
      intent.setClassName(targetImi.getPackageName(),className);
      intent.setAction(SuggestionSpan.ACTION_SUGGESTION_PICKED);
      intent.putExtra(SuggestionSpan.SUGGESTION_SPAN_PICKED_BEFORE,originalString);
      intent.putExtra(SuggestionSpan.SUGGESTION_SPAN_PICKED_AFTER,suggestions[index]);
      intent.putExtra(SuggestionSpan.SUGGESTION_SPAN_PICKED_HASHCODE,span.hashCode());
      final long ident=Binder.clearCallingIdentity();
      try {
        mContext.sendBroadcastAsUser(intent,UserHandle.CURRENT);
      }
  finally {
        Binder.restoreCallingIdentity(ident);
      }
      return true;
    }
  }
  return false;
}
