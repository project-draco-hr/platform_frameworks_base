{
  if (!calledFromValidUser()) {
    return false;
  }
synchronized (mMethodMap) {
    if (!calledWithValidToken(token)) {
      final int uid=Binder.getCallingUid();
      Slog.e(TAG,"Ignoring switchToNextInputMethod due to an invalid token. uid:" + uid + " token:"+ token);
      return false;
    }
    final ImeSubtypeListItem nextSubtype=mSwitchingController.getNextInputMethodLocked(onlyCurrentIme,mMethodMap.get(mCurMethodId),mCurrentSubtype,true);
    if (nextSubtype == null) {
      return false;
    }
    setInputMethodWithSubtypeIdLocked(token,nextSubtype.mImi.getId(),nextSubtype.mSubtypeId);
    return true;
  }
}
