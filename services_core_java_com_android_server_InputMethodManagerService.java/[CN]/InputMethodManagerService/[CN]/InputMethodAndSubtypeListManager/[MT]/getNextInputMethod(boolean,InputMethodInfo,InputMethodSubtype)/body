{
  if (imi == null) {
    return null;
  }
  final List<ImeSubtypeListItem> imList=getSortedInputMethodAndSubtypeList();
  if (imList.size() <= 1) {
    return null;
  }
  final int N=imList.size();
  final int currentSubtypeId=subtype != null ? InputMethodUtils.getSubtypeIdFromHashCode(imi,subtype.hashCode()) : NOT_A_SUBTYPE_ID;
  for (int i=0; i < N; ++i) {
    final ImeSubtypeListItem isli=imList.get(i);
    if (isli.mImi.equals(imi) && isli.mSubtypeId == currentSubtypeId) {
      if (!onlyCurrentIme) {
        return imList.get((i + 1) % N);
      }
      for (int j=0; j < N - 1; ++j) {
        final ImeSubtypeListItem candidate=imList.get((i + j + 1) % N);
        if (candidate.mImi.equals(imi)) {
          return candidate;
        }
      }
      return null;
    }
  }
  return null;
}
