{
  int opcode=cmd.getOpcode();
  int src=cmd.getSource();
  byte[] params=cmd.getParams();
  if (mDeviceLogicalAddress != src) {
    return false;
  }
  if (mState == STATE_WAITING_FOR_SET_OSD_NAME) {
    if (opcode == HdmiCec.MESSAGE_SET_OSD_NAME) {
      try {
        mDisplayName=new String(params,"US-ASCII");
      }
 catch (      UnsupportedEncodingException e) {
        Slog.e(TAG,"Failed to get OSD name: " + e.getMessage());
      }
      mState=STATE_WAITING_FOR_DEVICE_VENDOR_ID;
      requestVendorId();
      return true;
    }
 else     if (opcode == HdmiCec.MESSAGE_FEATURE_ABORT) {
      int requestOpcode=params[1] & 0xff;
      if (requestOpcode == HdmiCec.MESSAGE_SET_OSD_NAME) {
        mState=STATE_WAITING_FOR_DEVICE_VENDOR_ID;
        requestVendorId();
        return true;
      }
    }
  }
 else   if (mState == STATE_WAITING_FOR_DEVICE_VENDOR_ID) {
    if (opcode == HdmiCec.MESSAGE_DEVICE_VENDOR_ID) {
      if (params.length == 3) {
        mVendorId=((params[0] & 0xff) << 16) + ((params[1] & 0xff) << 8) + (params[2] & 0xff);
      }
 else {
        Slog.e(TAG,"Failed to get device vendor ID: ");
      }
      addDeviceInfo();
      finish();
      return true;
    }
 else     if (opcode == HdmiCec.MESSAGE_FEATURE_ABORT) {
      int requestOpcode=params[1] & 0xff;
      if (requestOpcode == HdmiCec.MESSAGE_DEVICE_VENDOR_ID) {
        addDeviceInfo();
        finish();
        return true;
      }
    }
  }
  return false;
}
