{
  if (mPortraitRotation < 0) {
    Display d=((WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();
    if (d.getWidth() > d.getHeight()) {
      mPortraitRotation=Surface.ROTATION_90;
      mLandscapeRotation=Surface.ROTATION_0;
    }
 else {
      mPortraitRotation=Surface.ROTATION_0;
      mLandscapeRotation=Surface.ROTATION_90;
    }
  }
synchronized (mLock) {
switch (orientation) {
case ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE:
      return mLandscapeRotation;
case ActivityInfo.SCREEN_ORIENTATION_PORTRAIT:
    return mPortraitRotation;
}
if (mLidOpen) {
  return Surface.ROTATION_90;
}
 else {
  if (useSensorForOrientationLp(orientation)) {
    int curRotation=mOrientationListener.getCurrentRotation();
    return curRotation >= 0 ? curRotation : lastRotation;
  }
  return Surface.ROTATION_0;
}
}
}
