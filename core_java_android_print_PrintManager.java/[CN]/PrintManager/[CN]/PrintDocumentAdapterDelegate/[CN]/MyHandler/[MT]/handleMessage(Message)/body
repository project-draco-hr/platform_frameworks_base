{
  if (isFinished()) {
    return;
  }
switch (message.what) {
case MSG_START:
{
      mDocumentAdapter.onStart();
    }
  break;
case MSG_LAYOUT:
{
  final CancellationSignal cancellation;
  final LayoutSpec layoutSpec;
synchronized (mLock) {
    layoutSpec=mLastLayoutSpec;
    mLastLayoutSpec=null;
    cancellation=new CancellationSignal();
    mLayoutOrWriteCancellation=cancellation;
  }
  if (layoutSpec != null) {
    if (DEBUG) {
      Log.i(LOG_TAG,"Performing layout");
    }
    mDocumentAdapter.onLayout(layoutSpec.oldAttributes,layoutSpec.newAttributes,cancellation,new MyLayoutResultCallback(layoutSpec.callback,layoutSpec.sequence),layoutSpec.metadata);
  }
}
break;
case MSG_WRITE:
{
final CancellationSignal cancellation;
final WriteSpec writeSpec;
synchronized (mLock) {
writeSpec=mLastWriteSpec;
mLastWriteSpec=null;
cancellation=new CancellationSignal();
mLayoutOrWriteCancellation=cancellation;
}
if (writeSpec != null) {
if (DEBUG) {
  Log.i(LOG_TAG,"Performing write");
}
mDocumentAdapter.onWrite(writeSpec.pages,writeSpec.fd,cancellation,new MyWriteResultCallback(writeSpec.callback,writeSpec.fd,writeSpec.sequence));
}
}
break;
case MSG_FINISH:
{
if (DEBUG) {
Log.i(LOG_TAG,"Performing finish");
}
mDocumentAdapter.onFinish();
doFinish();
}
break;
default :
{
throw new IllegalArgumentException("Unknown message: " + message.what);
}
}
}
