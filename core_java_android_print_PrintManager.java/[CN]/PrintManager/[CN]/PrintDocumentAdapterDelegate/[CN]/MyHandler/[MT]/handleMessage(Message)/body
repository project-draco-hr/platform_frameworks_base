{
  if (isFinished()) {
    return;
  }
switch (message.what) {
case MSG_START:
{
      final PrintDocumentAdapter adapter;
synchronized (mLock) {
        adapter=mDocumentAdapter;
      }
      if (adapter != null) {
        adapter.onStart();
      }
    }
  break;
case MSG_LAYOUT:
{
  final PrintDocumentAdapter adapter;
  final CancellationSignal cancellation;
  final LayoutSpec layoutSpec;
synchronized (mLock) {
    adapter=mDocumentAdapter;
    layoutSpec=mLastLayoutSpec;
    mLastLayoutSpec=null;
    cancellation=new CancellationSignal();
    mLayoutOrWriteCancellation=cancellation;
  }
  if (layoutSpec != null && adapter != null) {
    if (DEBUG) {
      Log.i(LOG_TAG,"Performing layout");
    }
    adapter.onLayout(layoutSpec.oldAttributes,layoutSpec.newAttributes,cancellation,new MyLayoutResultCallback(layoutSpec.callback,layoutSpec.sequence),layoutSpec.metadata);
  }
}
break;
case MSG_WRITE:
{
final PrintDocumentAdapter adapter;
final CancellationSignal cancellation;
final WriteSpec writeSpec;
synchronized (mLock) {
adapter=mDocumentAdapter;
writeSpec=mLastWriteSpec;
mLastWriteSpec=null;
cancellation=new CancellationSignal();
mLayoutOrWriteCancellation=cancellation;
}
if (writeSpec != null && adapter != null) {
if (DEBUG) {
  Log.i(LOG_TAG,"Performing write");
}
adapter.onWrite(writeSpec.pages,writeSpec.fd,cancellation,new MyWriteResultCallback(writeSpec.callback,writeSpec.fd,writeSpec.sequence));
}
}
break;
case MSG_FINISH:
{
if (DEBUG) {
Log.i(LOG_TAG,"Performing finish");
}
final PrintDocumentAdapter adapter;
final Activity activity;
synchronized (mLock) {
adapter=mDocumentAdapter;
activity=mActivity;
clearLocked();
}
if (adapter != null) {
adapter.onFinish();
}
if (activity != null) {
activity.getApplication().unregisterActivityLifecycleCallbacks(PrintDocumentAdapterDelegate.this);
}
}
break;
default :
{
throw new IllegalArgumentException("Unknown message: " + message.what);
}
}
}
