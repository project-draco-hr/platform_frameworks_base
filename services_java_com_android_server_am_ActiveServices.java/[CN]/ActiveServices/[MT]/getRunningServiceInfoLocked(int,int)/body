{
  ArrayList<ActivityManager.RunningServiceInfo> res=new ArrayList<ActivityManager.RunningServiceInfo>();
  int userId=UserHandle.getUserId(Binder.getCallingUid());
  if (mServiceMap.getAllServices(userId).size() > 0) {
    Iterator<ServiceRecord> it=mServiceMap.getAllServices(userId).iterator();
    while (it.hasNext() && res.size() < maxNum) {
      res.add(makeRunningServiceInfoLocked(it.next()));
    }
  }
  for (int i=0; i < mRestartingServices.size() && res.size() < maxNum; i++) {
    ServiceRecord r=mRestartingServices.get(i);
    ActivityManager.RunningServiceInfo info=makeRunningServiceInfoLocked(r);
    info.restarting=r.nextRestartTime;
    res.add(info);
  }
  return res;
}
