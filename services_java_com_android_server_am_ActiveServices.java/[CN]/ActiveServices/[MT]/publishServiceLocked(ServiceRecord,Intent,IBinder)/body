{
  final long origId=Binder.clearCallingIdentity();
  try {
    if (DEBUG_SERVICE)     Slog.v(TAG,"PUBLISHING " + r + " "+ intent+ ": "+ service);
    if (r != null) {
      Intent.FilterComparison filter=new Intent.FilterComparison(intent);
      IntentBindRecord b=r.bindings.get(filter);
      if (b != null && !b.received) {
        b.binder=service;
        b.requested=true;
        b.received=true;
        if (r.connections.size() > 0) {
          Iterator<ArrayList<ConnectionRecord>> it=r.connections.values().iterator();
          while (it.hasNext()) {
            ArrayList<ConnectionRecord> clist=it.next();
            for (int i=0; i < clist.size(); i++) {
              ConnectionRecord c=clist.get(i);
              if (!filter.equals(c.binding.intent.intent)) {
                if (DEBUG_SERVICE)                 Slog.v(TAG,"Not publishing to: " + c);
                if (DEBUG_SERVICE)                 Slog.v(TAG,"Bound intent: " + c.binding.intent.intent);
                if (DEBUG_SERVICE)                 Slog.v(TAG,"Published intent: " + intent);
                continue;
              }
              if (DEBUG_SERVICE)               Slog.v(TAG,"Publishing to: " + c);
              try {
                c.conn.connected(r.name,service);
              }
 catch (              Exception e) {
                Slog.w(TAG,"Failure sending service " + r.name + " to connection "+ c.conn.asBinder()+ " (in "+ c.binding.client.processName+ ")",e);
              }
            }
          }
        }
      }
      serviceDoneExecutingLocked(r,mStoppingServices.contains(r));
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
}
