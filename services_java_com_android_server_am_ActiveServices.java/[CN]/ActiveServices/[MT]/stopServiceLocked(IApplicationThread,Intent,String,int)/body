{
  if (DEBUG_SERVICE)   Slog.v(TAG,"stopService: " + service + " type="+ resolvedType);
  final ProcessRecord callerApp=mAm.getRecordForAppLocked(caller);
  if (caller != null && callerApp == null) {
    throw new SecurityException("Unable to find app for caller " + caller + " (pid="+ Binder.getCallingPid()+ ") when stopping service "+ service);
  }
  ServiceLookupResult r=retrieveServiceLocked(service,resolvedType,Binder.getCallingPid(),Binder.getCallingUid(),userId,false);
  if (r != null) {
    if (r.record != null) {
      final long origId=Binder.clearCallingIdentity();
      try {
        stopServiceLocked(r.record);
      }
  finally {
        Binder.restoreCallingIdentity(origId);
      }
      return 1;
    }
    return -1;
  }
  return 0;
}
