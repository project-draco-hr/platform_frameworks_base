{
  List<String> notificationsToUnAutobundle=new ArrayList<>();
  boolean removeSummary=false;
synchronized (mUnbundledNotifications) {
    Map<String,LinkedHashSet<String>> unbundledNotificationsByUser=mUnbundledNotifications.get(sbn.getUserId());
    if (unbundledNotificationsByUser == null || unbundledNotificationsByUser.size() == 0) {
      return;
    }
    LinkedHashSet<String> notificationsForPackage=unbundledNotificationsByUser.get(sbn.getPackageName());
    if (notificationsForPackage == null || notificationsForPackage.size() == 0) {
      return;
    }
    if (notificationsForPackage.remove(sbn.getKey())) {
      if (!notificationGone) {
        notificationsToUnAutobundle.add(sbn.getKey());
      }
      if (notificationsForPackage.size() == AUTOBUNDLE_AT_COUNT - 1) {
        removeSummary=true;
        for (        String key : notificationsForPackage) {
          notificationsToUnAutobundle.add(key);
        }
      }
    }
  }
  if (notificationsToUnAutobundle.size() > 0) {
    if (removeSummary) {
      adjustAutobundlingSummary(sbn.getPackageName(),null,false,user);
    }
    adjustNotificationBundling(sbn.getPackageName(),notificationsToUnAutobundle,false,user);
  }
}
