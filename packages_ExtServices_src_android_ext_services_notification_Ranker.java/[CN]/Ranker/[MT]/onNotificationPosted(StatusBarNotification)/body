{
  if (DEBUG)   Log.i(TAG,"POSTED " + sbn.getKey());
  try {
    List<String> notificationsToBundle=new ArrayList<>();
    if (!sbn.isAppGroup()) {
synchronized (mUnbundledNotifications) {
        Map<String,LinkedHashSet<String>> unbundledNotificationsByUser=mUnbundledNotifications.get(sbn.getUserId());
        if (unbundledNotificationsByUser == null) {
          unbundledNotificationsByUser=new HashMap<>();
        }
        mUnbundledNotifications.put(sbn.getUserId(),unbundledNotificationsByUser);
        LinkedHashSet<String> notificationsForPackage=unbundledNotificationsByUser.get(sbn.getPackageName());
        if (notificationsForPackage == null) {
          notificationsForPackage=new LinkedHashSet<>();
        }
        notificationsForPackage.add(sbn.getKey());
        unbundledNotificationsByUser.put(sbn.getPackageName(),notificationsForPackage);
        if (notificationsForPackage.size() >= AUTOBUNDLE_AT_COUNT) {
          for (          String key : notificationsForPackage) {
            notificationsToBundle.add(key);
          }
        }
      }
      if (notificationsToBundle.size() > 0) {
        adjustAutobundlingSummary(sbn.getPackageName(),notificationsToBundle.get(0),true,sbn.getUserId());
        adjustNotificationBundling(sbn.getPackageName(),notificationsToBundle,true,sbn.getUserId());
      }
    }
 else {
      maybeUnbundle(sbn,false,sbn.getUserId());
    }
  }
 catch (  Exception e) {
    Slog.e(TAG,"Failure processing new notification",e);
  }
}
