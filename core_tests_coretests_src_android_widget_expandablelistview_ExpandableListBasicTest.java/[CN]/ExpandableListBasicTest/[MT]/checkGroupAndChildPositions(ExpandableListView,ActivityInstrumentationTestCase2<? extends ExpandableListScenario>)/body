{
  PositionTesterContextMenuListener menuListener=new PositionTesterContextMenuListener();
  elv.setOnCreateContextMenuListener(menuListener);
  ListUtil listUtil=new ListUtil(elv,activityInstrumentation.getInstrumentation());
  ExpandableListAdapter adapter=elv.getExpandableListAdapter();
  Instrumentation instrumentation=activityInstrumentation.getInstrumentation();
  int index=elv.getHeaderViewsCount();
  int groupCount=adapter.getGroupCount();
  for (int groupIndex=0; groupIndex < groupCount; groupIndex++) {
    assertFalse("Group is already expanded",elv.isGroupExpanded(groupIndex));
    listUtil.arrowScrollToSelectedPosition(index);
    instrumentation.waitForIdleSync();
    activityInstrumentation.sendKeys(KeyEvent.KEYCODE_DPAD_CENTER);
    activityInstrumentation.getInstrumentation().waitForIdleSync();
    assertTrue("Group did not expand " + groupIndex,elv.isGroupExpanded(groupIndex));
    menuListener.expectGroupContextMenu(groupIndex);
    listUtil.arrowScrollToSelectedPosition(index);
    View groupChild=elv.getChildAt(index - elv.getFirstVisiblePosition());
    elv.showContextMenuForChild(groupChild);
    index++;
    final int childrenCount=adapter.getChildrenCount(groupIndex);
    for (int childIndex=0; childIndex < childrenCount; childIndex++) {
      listUtil.arrowScrollToSelectedPosition(index);
      menuListener.expectChildContextMenu(groupIndex,childIndex);
      View child=elv.getChildAt(index - elv.getFirstVisiblePosition());
      elv.showContextMenuForChild(child);
      index++;
    }
  }
  elv.setOnCreateContextMenuListener(null);
}
