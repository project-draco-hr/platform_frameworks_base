{
  if (mState != STATE_PROCESSING_KEYCODE) {
    Slog.w(TAG,"Not in a valid state");
    return;
  }
  if (isPressed) {
    if (keycode != mLastKeycode) {
      sendKeyDown(keycode);
      mLastSendKeyTime=getCurrentTime();
      if (!HdmiCecKeycode.isRepeatableKey(keycode)) {
        sendKeyUp();
        finish();
        return;
      }
    }
 else {
      if (getCurrentTime() - mLastSendKeyTime >= IRT_MS) {
        sendKeyDown(keycode);
        mLastSendKeyTime=getCurrentTime();
      }
    }
    mActionTimer.clearTimerMessage();
    addTimer(mState,AWAIT_RELEASE_KEY_MS);
    mLastKeycode=keycode;
  }
 else {
    if (keycode == mLastKeycode) {
      sendKeyUp();
      finish();
    }
  }
}
