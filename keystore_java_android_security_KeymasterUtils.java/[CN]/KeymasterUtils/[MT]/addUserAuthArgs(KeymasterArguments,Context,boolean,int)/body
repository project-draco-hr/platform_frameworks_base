{
  if (!userAuthenticationRequired) {
    args.addBoolean(KeymasterDefs.KM_TAG_NO_AUTH_REQUIRED);
    return;
  }
  if (userAuthenticationValidityDurationSeconds == -1) {
    FingerprintManager fingerprintManager=context.getSystemService(FingerprintManager.class);
    if ((fingerprintManager == null) || (!fingerprintManager.isHardwareDetected())) {
      throw new IllegalStateException("This device does not support keys which require authentication for every" + " use -- this requires fingerprint authentication which is not" + " available on this device");
    }
    long fingerprintOnlySid=fingerprintManager.getAuthenticatorId();
    if (fingerprintOnlySid == 0) {
      throw new IllegalStateException("At least one fingerprint must be enrolled to create keys requiring user" + " authentication for every use");
    }
    args.addLong(KeymasterDefs.KM_TAG_USER_SECURE_ID,fingerprintOnlySid);
    args.addInt(KeymasterDefs.KM_TAG_USER_AUTH_TYPE,KeymasterDefs.HW_AUTH_FINGERPRINT);
  }
 else {
    long rootSid=GateKeeper.getSecureUserId();
    if (rootSid == 0) {
      throw new IllegalStateException("Secure lock screen must be enabled" + " to create keys requiring user authentication");
    }
    args.addLong(KeymasterDefs.KM_TAG_USER_SECURE_ID,rootSid);
    args.addInt(KeymasterDefs.KM_TAG_USER_AUTH_TYPE,KeymasterDefs.HW_AUTH_PASSWORD | KeymasterDefs.HW_AUTH_FINGERPRINT);
    args.addInt(KeymasterDefs.KM_TAG_AUTH_TIMEOUT,userAuthenticationValidityDurationSeconds);
  }
}
