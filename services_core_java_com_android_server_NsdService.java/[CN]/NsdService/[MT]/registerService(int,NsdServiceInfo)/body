{
  if (DBG)   Slog.d(TAG,"registerService: " + regId + " "+ service);
  try {
    Command cmd=new Command("mdnssd","register",regId,service.getServiceName(),service.getServiceType(),service.getPort());
    Map<String,byte[]> txtRecords=service.getAttributes();
    for (    String key : txtRecords.keySet()) {
      try {
        byte[] recordValue=txtRecords.get(key);
        cmd.appendArg(String.format(Locale.US,"%s=%s",key,recordValue != null ? new String(recordValue,"UTF_8") : ""));
      }
 catch (      UnsupportedEncodingException e) {
        Slog.e(TAG,"Failed to encode txtRecord " + e);
      }
    }
    mNativeConnector.execute(cmd);
  }
 catch (  NativeDaemonConnectorException e) {
    Slog.e(TAG,"Failed to execute registerService " + e);
    return false;
  }
  return true;
}
