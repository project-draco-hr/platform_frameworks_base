{
  super.panelExpansionChanged(panel,frac);
  if (DEBUG) {
    Log.v(TAG,"panelExpansionChanged: f=" + frac);
  }
  if (panel == mFadingPanel && mScrimColor != 0 && ActivityManager.isHighEndGfx()) {
    if (mShouldFade) {
      frac=mPanelExpandedFractionSum;
      frac=frac * 1.2f - 0.2f;
      if (frac <= 0) {
        mBar.mStatusBarWindow.setBackgroundColor(0);
      }
 else {
        final float k=(float)(1f - 0.5f * (1f - Math.cos(3.14159f * Math.pow(1f - frac,2f))));
        final int color=(int)((mScrimColor >>> 24) * k) << 24 | (mScrimColor & 0xFFFFFF);
        mBar.mStatusBarWindow.setBackgroundColor(color);
      }
    }
  }
  final int H=mBar.getStatusBarHeight();
  final float ph=panel.getExpandedHeight() + panel.getPaddingBottom();
  float alpha=1f;
  if (ph < 2 * H) {
    if (ph < H)     alpha=0f;
 else     alpha=(ph - H) / H;
    alpha=alpha * alpha;
  }
  if (panel.getAlpha() != alpha) {
    panel.setAlpha(alpha);
  }
  mBar.animateHeadsUp(mNotificationPanel == panel,mPanelExpandedFractionSum);
  mBar.updateCarrierLabelVisibility(false);
}
