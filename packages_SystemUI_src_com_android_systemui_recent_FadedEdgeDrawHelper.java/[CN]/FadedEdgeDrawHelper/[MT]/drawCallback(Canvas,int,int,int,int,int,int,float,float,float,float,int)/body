{
  if ((mSoftwareRendered && OPTIMIZE_SW_RENDERED_RECENTS) || USE_DARK_FADE_IN_HW_ACCELERATED_MODE) {
    if (mFadePaint == null) {
      mFadePaint=new Paint();
      mFadeMatrix=new Matrix();
      mFade=new LinearGradient(0,0,0,1,0xCC000000,0,Shader.TileMode.CLAMP);
      mFadePaint.setShader(mFade);
    }
    boolean drawTop=false;
    boolean drawBottom=false;
    boolean drawLeft=false;
    boolean drawRight=false;
    float topFadeStrength=0.0f;
    float bottomFadeStrength=0.0f;
    float leftFadeStrength=0.0f;
    float rightFadeStrength=0.0f;
    final float fadeHeight=mFadingEdgeLength;
    int length=(int)fadeHeight;
    if (mIsVertical && (top + length > bottom - length)) {
      length=(bottom - top) / 2;
    }
    if (!mIsVertical && (left + length > right - length)) {
      length=(right - left) / 2;
    }
    if (mIsVertical) {
      topFadeStrength=Math.max(0.0f,Math.min(1.0f,topFadingEdgeStrength));
      drawTop=topFadeStrength * fadeHeight > 1.0f;
      bottomFadeStrength=Math.max(0.0f,Math.min(1.0f,bottomFadingEdgeStrength));
      drawBottom=bottomFadeStrength * fadeHeight > 1.0f;
    }
    if (!mIsVertical) {
      leftFadeStrength=Math.max(0.0f,Math.min(1.0f,leftFadingEdgeStrength));
      drawLeft=leftFadeStrength * fadeHeight > 1.0f;
      rightFadeStrength=Math.max(0.0f,Math.min(1.0f,rightFadingEdgeStrength));
      drawRight=rightFadeStrength * fadeHeight > 1.0f;
    }
    if (drawTop) {
      mFadeMatrix.setScale(1,fadeHeight * topFadeStrength);
      mFadeMatrix.postTranslate(left,top);
      mFade.setLocalMatrix(mFadeMatrix);
      canvas.drawRect(left,top,right,top + length,mFadePaint);
      if (mBlackPaint == null) {
        mBlackPaint=new Paint();
        mBlackPaint.setColor(0xFF000000);
      }
      canvas.drawRect(left,top - mPaddingTop,right,top,mBlackPaint);
    }
    if (drawBottom) {
      mFadeMatrix.setScale(1,fadeHeight * bottomFadeStrength);
      mFadeMatrix.postRotate(180);
      mFadeMatrix.postTranslate(left,bottom);
      mFade.setLocalMatrix(mFadeMatrix);
      canvas.drawRect(left,bottom - length,right,bottom,mFadePaint);
    }
    if (drawLeft) {
      mFadeMatrix.setScale(1,fadeHeight * leftFadeStrength);
      mFadeMatrix.postRotate(-90);
      mFadeMatrix.postTranslate(left,top);
      mFade.setLocalMatrix(mFadeMatrix);
      canvas.drawRect(left,top,left + length,bottom,mFadePaint);
    }
    if (drawRight) {
      mFadeMatrix.setScale(1,fadeHeight * rightFadeStrength);
      mFadeMatrix.postRotate(90);
      mFadeMatrix.postTranslate(right,top);
      mFade.setLocalMatrix(mFadeMatrix);
      canvas.drawRect(right - length,top,right,bottom,mFadePaint);
    }
  }
}
