{
  ArrayMap<String,ArraySet<RestoredPermissionGrant>> grantsByPackage=mRestoredUserGrants.get(userId);
  if (grantsByPackage == null) {
    grantsByPackage=new ArrayMap<String,ArraySet<RestoredPermissionGrant>>();
    mRestoredUserGrants.put(userId,grantsByPackage);
  }
  ArraySet<RestoredPermissionGrant> grants=grantsByPackage.get(pkgName);
  if (grants == null) {
    grants=new ArraySet<RestoredPermissionGrant>();
    grantsByPackage.put(pkgName,grants);
  }
  RestoredPermissionGrant grant=new RestoredPermissionGrant(permission,isGranted,restoredFlagSet);
  grants.add(grant);
}
