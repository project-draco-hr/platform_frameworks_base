{
synchronized (mCrossProfileIntentResolvers) {
    if (mCrossProfileIntentResolvers.get(userId) != null) {
      mCrossProfileIntentResolvers.remove(userId);
      writePackageRestrictionsLPr(userId);
    }
    int count=mCrossProfileIntentResolvers.size();
    for (int i=0; i < count; i++) {
      int sourceUserId=mCrossProfileIntentResolvers.keyAt(i);
      CrossProfileIntentResolver cpir=mCrossProfileIntentResolvers.get(sourceUserId);
      boolean needsWriting=false;
      ArraySet<CrossProfileIntentFilter> cpifs=new ArraySet<CrossProfileIntentFilter>(cpir.filterSet());
      for (      CrossProfileIntentFilter cpif : cpifs) {
        if (cpif.getTargetUserId() == userId) {
          needsWriting=true;
          cpir.removeFilter(cpif);
        }
      }
      if (needsWriting) {
        writePackageRestrictionsLPr(sourceUserId);
      }
    }
  }
}
