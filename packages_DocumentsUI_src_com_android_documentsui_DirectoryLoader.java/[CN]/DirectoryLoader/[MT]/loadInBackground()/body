{
synchronized (this) {
    if (isLoadInBackgroundCanceled()) {
      throw new OperationCanceledException();
    }
    mSignal=new CancellationSignal();
  }
  final ContentResolver resolver=getContext().getContentResolver();
  final String authority=mUri.getAuthority();
  final DirectoryResult result=new DirectoryResult();
  result.doc=mDoc;
  if (mSearchMode) {
    final Uri docUri=DocumentsContract.buildDocumentUri(mRoot.authority,mRoot.documentId);
    try {
      mDoc=DocumentInfo.fromUri(resolver,docUri);
    }
 catch (    FileNotFoundException e) {
      Log.w(TAG,"Failed to query",e);
      result.exception=e;
      return result;
    }
  }
  if (mUserSortOrder != State.SORT_ORDER_UNKNOWN) {
    result.sortOrder=mUserSortOrder;
  }
 else {
    if ((mDoc.flags & Document.FLAG_DIR_PREFERS_LAST_MODIFIED) != 0) {
      result.sortOrder=State.SORT_ORDER_LAST_MODIFIED;
    }
 else {
      result.sortOrder=State.SORT_ORDER_DISPLAY_NAME;
    }
  }
  if (mSearchMode) {
    result.sortOrder=State.SORT_ORDER_UNKNOWN;
  }
  if (DEBUG)   Log.d(TAG,"userSortOrder=" + mUserSortOrder + ", sortOrder="+ result.sortOrder);
  ContentProviderClient client=null;
  Cursor cursor=null;
  try {
    client=DocumentsApplication.acquireUnstableProviderOrThrow(resolver,authority);
    cursor=client.query(mUri,null,null,null,getQuerySortOrder(result.sortOrder),mSignal);
    if (cursor == null) {
      throw new RemoteException("Provider returned null");
    }
    cursor.registerContentObserver(mObserver);
    cursor=new RootCursorWrapper(mUri.getAuthority(),mRoot.rootId,cursor,-1);
    if (mSearchMode) {
      cursor=new FilteringCursorWrapper(cursor,null,SEARCH_REJECT_MIMES);
    }
    result.client=client;
    result.cursor=cursor;
  }
 catch (  Exception e) {
    Log.w(TAG,"Failed to query",e);
    result.exception=e;
    ContentProviderClient.releaseQuietly(client);
  }
 finally {
synchronized (this) {
      mSignal=null;
    }
  }
  return result;
}
