{
  if (mCurViewStackEntry != null) {
    if (mCurViewStackEntry.curChild < mCurViewStackEntry.numChildren) {
      if (DEBUG_PARCEL_TREE)       Log.d(TAG,"Writing child #" + mCurViewStackEntry.curChild + " in "+ mCurViewStackEntry.node);
      ViewNode child=mCurViewStackEntry.node.mChildren[mCurViewStackEntry.curChild];
      mCurViewStackEntry.curChild++;
      if (DEBUG_PARCEL)       Log.d(TAG,"write view: at " + out.dataPosition() + ", windows="+ mNumWrittenWindows+ ", views="+ mNumWrittenViews);
      out.writeInt(1);
      int flags=child.writeSelfToParcel(out,pwriter,mTmpMatrix);
      mNumWrittenViews++;
      if ((flags & ViewNode.FLAGS_HAS_CHILDREN) != 0) {
        if (DEBUG_PARCEL_TREE)         Log.d(TAG,"Preparing to write " + child.mChildren.length + " children under "+ child);
        out.writeInt(child.mChildren.length);
        int pos=++mCurViewStackPos;
        pushViewStackEntry(child,pos);
      }
      return true;
    }
    do {
      int pos=--mCurViewStackPos;
      if (DEBUG_PARCEL_TREE)       Log.d(TAG,"Done with " + mCurViewStackEntry.node + "; popping up to "+ pos);
      if (pos < 0) {
        if (DEBUG_PARCEL_TREE)         Log.d(TAG,"Done with view hierarchy!");
        mCurViewStackEntry=null;
        break;
      }
      mCurViewStackEntry=mViewStack.get(pos);
    }
 while (mCurViewStackEntry.curChild >= mCurViewStackEntry.numChildren);
    return true;
  }
  int pos=mCurWindow;
  if (pos < mNumWindows) {
    WindowNode win=as.mWindowNodes.get(pos);
    mCurWindow++;
    if (DEBUG_PARCEL)     Log.d(TAG,"write window #" + pos + ": at "+ out.dataPosition()+ ", windows="+ mNumWrittenWindows+ ", views="+ mNumWrittenViews);
    out.writeInt(1);
    win.writeSelfToParcel(out,pwriter,mTmpMatrix);
    mNumWrittenWindows++;
    ViewNode root=win.mRoot;
    mCurViewStackPos=0;
    if (DEBUG_PARCEL_TREE)     Log.d(TAG,"Pushing initial root view " + root);
    pushViewStackEntry(root,0);
    return true;
  }
  return false;
}
