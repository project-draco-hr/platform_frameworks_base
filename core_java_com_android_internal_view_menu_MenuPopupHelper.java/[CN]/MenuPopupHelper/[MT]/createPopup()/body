{
  final boolean enableCascadingSubmenus=mContext.getResources().getBoolean(com.android.internal.R.bool.config_enableCascadingSubmenus);
  final MenuPopup popup;
  if (enableCascadingSubmenus) {
    popup=new CascadingMenuPopup(mContext,mAnchorView,mPopupStyleAttr,mPopupStyleRes,mOverflowOnly);
  }
 else {
    popup=new StandardMenuPopup(mContext,mMenu,mAnchorView,mPopupStyleAttr,mPopupStyleRes,mOverflowOnly);
  }
  popup.addMenu(mMenu);
  popup.setOnDismissListener(mInternalOnDismissListener);
  popup.setAnchorView(mAnchorView);
  popup.setCallback(mPresenterCallback);
  popup.setForceShowIcon(mForceShowIcon);
  popup.setGravity(mDropDownGravity);
  return popup;
}
