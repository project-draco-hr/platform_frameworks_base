{
  mPopup=new ListPopupWindow(mContext,null,com.android.internal.R.attr.popupMenuStyle);
  mPopup.setOnItemClickListener(this);
  mPopup.setOnDismissListener(mDismissListener);
  final MenuAdapter adapter=mOverflowOnly ? mMenu.getOverflowMenuAdapter(MenuBuilder.TYPE_POPUP) : mMenu.getMenuAdapter(MenuBuilder.TYPE_POPUP);
  mPopup.setAdapter(adapter);
  mPopup.setModal(true);
  if (mAnchorView != null) {
    mPopup.setAnchorView(mAnchorView.get());
  }
 else   if (mMenu instanceof SubMenuBuilder) {
    SubMenuBuilder subMenu=(SubMenuBuilder)mMenu;
    final MenuItemImpl itemImpl=(MenuItemImpl)subMenu.getItem();
    mPopup.setAnchorView(itemImpl.getItemView(MenuBuilder.TYPE_ACTION_BUTTON,null));
  }
 else {
    throw new IllegalStateException("MenuPopupHelper cannot be used without an anchor");
  }
  mPopup.setContentWidth(Math.min(measureContentWidth(adapter),mPopupMaxWidth));
  mPopup.show();
  mPopup.getListView().setOnKeyListener(this);
}
