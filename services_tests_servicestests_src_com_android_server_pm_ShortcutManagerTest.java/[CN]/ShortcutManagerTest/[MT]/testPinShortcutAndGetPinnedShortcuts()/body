{
  setCaller(CALLING_PACKAGE_1);
  final ShortcutInfo s1_1=makeShortcutWithTimestamp("s1",1000);
  final ShortcutInfo s1_2=makeShortcutWithTimestamp("s2",2000);
  assertTrue(mManager.setDynamicShortcuts(Arrays.asList(s1_1,s1_2)));
  setCaller(CALLING_PACKAGE_2);
  final ShortcutInfo s2_2=makeShortcutWithTimestamp("s2",1500);
  final ShortcutInfo s2_3=makeShortcutWithTimestamp("s3",3000);
  final ShortcutInfo s2_4=makeShortcutWithTimestamp("s4",500);
  assertTrue(mManager.setDynamicShortcuts(Arrays.asList(s2_2,s2_3,s2_4)));
  setCaller(CALLING_PACKAGE_3);
  final ShortcutInfo s3_2=makeShortcutWithTimestamp("s2",1000);
  assertTrue(mManager.setDynamicShortcuts(Arrays.asList(s2_2)));
  setCaller(LAUNCHER_1);
  mInternal.pinShortcuts(getCallingPackage(),CALLING_PACKAGE_1,Arrays.asList("s2","s3"),getCallingUserId());
  mInternal.pinShortcuts(getCallingPackage(),CALLING_PACKAGE_2,Arrays.asList("s3","s4","s5"),getCallingUserId());
  mInternal.pinShortcuts(getCallingPackage(),CALLING_PACKAGE_3,Arrays.asList("s3"),getCallingUserId());
  setCaller(CALLING_PACKAGE_1);
  assertShortcutIds(mManager.getPinnedShortcuts(),"s2");
  mManager.deleteDynamicShortcut("s2");
  assertShortcutIds(mManager.getPinnedShortcuts(),"s2");
  setCaller(CALLING_PACKAGE_2);
  assertShortcutIds(mManager.getPinnedShortcuts(),"s3","s4");
  mManager.deleteDynamicShortcut("s3");
  assertShortcutIds(mManager.getPinnedShortcuts(),"s3","s4");
  setCaller(CALLING_PACKAGE_3);
  assertShortcutIds(mManager.getPinnedShortcuts());
  mManager.deleteDynamicShortcut("s2");
  assertShortcutIds(mManager.getPinnedShortcuts());
  setCaller(LAUNCHER_1);
  assertShortcutIds(assertAllPinned(mInternal.getShortcuts(getCallingPackage(),0,CALLING_PACKAGE_1,null,ShortcutQuery.FLAG_GET_PINNED,getCallingUserId())),"s2");
  assertShortcutIds(assertAllPinned(mInternal.getShortcuts(getCallingPackage(),0,CALLING_PACKAGE_2,null,ShortcutQuery.FLAG_GET_PINNED,getCallingUserId())),"s3","s4");
  assertShortcutIds(assertAllPinned(mInternal.getShortcuts(getCallingPackage(),0,CALLING_PACKAGE_3,null,ShortcutQuery.FLAG_GET_PINNED,getCallingUserId())));
}
