{
  final Icon res32x32=Icon.createWithResource(getTestContext(),R.drawable.black_32x32);
  final Icon res64x64=Icon.createWithResource(getTestContext(),R.drawable.black_64x64);
  final Icon res512x512=Icon.createWithResource(getTestContext(),R.drawable.black_512x512);
  final Icon bmp32x32=Icon.createWithBitmap(BitmapFactory.decodeResource(getTestContext().getResources(),R.drawable.black_32x32));
  final Icon bmp64x64=Icon.createWithBitmap(BitmapFactory.decodeResource(getTestContext().getResources(),R.drawable.black_64x64));
  final Icon bmp512x512=Icon.createWithBitmap(BitmapFactory.decodeResource(getTestContext().getResources(),R.drawable.black_512x512));
  setCaller(CALLING_PACKAGE_1);
  assertTrue(mManager.setDynamicShortcuts(list(makeShortcutWithIcon("res32x32",res32x32),makeShortcutWithIcon("res64x64",res64x64),makeShortcutWithIcon("bmp32x32",bmp32x32),makeShortcutWithIcon("bmp64x64",bmp64x64),makeShortcutWithIcon("bmp512x512",bmp512x512),makeShortcut("none"))));
  assertShortcutIds(assertAllNotHaveIcon(mManager.getDynamicShortcuts()),"res32x32","res64x64","bmp32x32","bmp64x64","bmp512x512","none");
  setCaller(CALLING_PACKAGE_2);
  assertTrue(mManager.setDynamicShortcuts(list(makeShortcutWithIcon("res32x32",res512x512),makeShortcutWithIcon("res64x64",res512x512),makeShortcutWithIcon("none",res512x512))));
  assertShortcutIds(assertAllNotHaveIcon(mManager.getDynamicShortcuts()),"res32x32","res64x64","none");
  setCaller(CALLING_PACKAGE_1,USER_P0);
  assertTrue(mManager.setDynamicShortcuts(list(makeShortcutWithIcon("res32x32",res512x512),makeShortcutWithIcon("bmp32x32",bmp512x512))));
  assertShortcutIds(assertAllNotHaveIcon(mManager.getDynamicShortcuts()),"res32x32","bmp32x32");
  mService.saveDirtyInfo();
  initService();
  Bitmap bmp;
  setCaller(LAUNCHER_1);
  assertShortcutIds(assertAllHaveIconResId(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res32x32",USER_0))),"res32x32");
  assertShortcutIds(assertAllHaveIconResId(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res64x64",USER_0))),"res64x64");
  assertShortcutIds(assertAllHaveIconFile(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp32x32",USER_0))),"bmp32x32");
  assertShortcutIds(assertAllHaveIconFile(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp64x64",USER_0))),"bmp64x64");
  assertShortcutIds(assertAllHaveIconFile(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp512x512",USER_0))),"bmp512x512");
  assertShortcutIds(assertAllHaveIconResId(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res32x32",USER_P0))),"res32x32");
  assertShortcutIds(assertAllHaveIconFile(list(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp32x32",USER_P0))),"bmp32x32");
  assertEquals(R.drawable.black_32x32,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res32x32",USER_0)));
  assertEquals(R.drawable.black_64x64,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res64x64",USER_0)));
  assertEquals(0,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp32x32",USER_0)));
  assertEquals(0,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp64x64",USER_0)));
  assertEquals(0,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp512x512",USER_0)));
  bmp=pfdToBitmap(mLauncherApps.getShortcutIconFd(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp32x32",USER_0)));
  assertBitmapSize(32,32,bmp);
  bmp=pfdToBitmap(mLauncherApps.getShortcutIconFd(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp64x64",USER_0)));
  assertBitmapSize(64,64,bmp);
  bmp=pfdToBitmap(mLauncherApps.getShortcutIconFd(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp512x512",USER_0)));
  assertBitmapSize(128,128,bmp);
  assertEquals(R.drawable.black_512x512,mLauncherApps.getShortcutIconResId(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"res32x32",USER_P0)));
  bmp=pfdToBitmap(mLauncherApps.getShortcutIconFd(getShortcutInfoAsLauncher(CALLING_PACKAGE_1,"bmp32x32",USER_P0)));
  assertBitmapSize(128,128,bmp);
  assertEquals(R.drawable.black_32x32,mLauncherApps.getShortcutIconResId(CALLING_PACKAGE_1,"res32x32",HANDLE_USER_0));
  assertEquals(R.drawable.black_64x64,mLauncherApps.getShortcutIconResId(CALLING_PACKAGE_1,"res64x64",HANDLE_USER_0));
  assertEquals(R.drawable.black_512x512,mLauncherApps.getShortcutIconResId(CALLING_PACKAGE_1,"res32x32",HANDLE_USER_P0));
  bmp=pfdToBitmap(mLauncherApps.getShortcutIconFd(CALLING_PACKAGE_1,"bmp32x32",HANDLE_USER_P0));
  assertBitmapSize(128,128,bmp);
}
