{
  final Icon icon1=Icon.createWithResource(mContext,R.drawable.icon1);
  final Icon icon2=Icon.createWithBitmap(BitmapFactory.decodeResource(mContext.getResources(),R.drawable.icon2));
  final ShortcutInfo si1=makeShortcut("shortcut1","Title 1",makeComponent(ShortcutActivity.class),icon1,makeIntent(Intent.ACTION_ASSIST,ShortcutActivity2.class,"key1","val1","nest",makeBundle("key",123)),10);
  final ShortcutInfo si2=makeShortcut("shortcut2","Title 2",null,icon2,makeIntent(Intent.ACTION_ASSIST,ShortcutActivity3.class),12);
  assertTrue(mManager.setDynamicShortcuts(Arrays.asList(si1,si2)));
  assertEquals(START_TIME + INTERVAL,mManager.getRateLimitResetTime());
  assertEquals(2,mManager.getRemainingCallCount());
  Log.i(TAG,"Saved state");
  dumpsysOnLogcat();
  dumpUserFile(0);
  initService();
  assertEquals(0,mService.getShortcutsForTest().size());
  mService.onStartUserLocked(UserHandle.USER_SYSTEM);
  assertEquals(1,mService.getShortcutsForTest().size());
  mService.onStartUserLocked(10);
  assertEquals(2,mService.getShortcutsForTest().size());
  Log.i(TAG,"Dumping the new instance");
  List<ShortcutInfo> loaded=mManager.getDynamicShortcuts();
  Log.i(TAG,"Loaded state");
  dumpsysOnLogcat();
  assertEquals(2,loaded.size());
  assertEquals(START_TIME + INTERVAL,mManager.getRateLimitResetTime());
  assertEquals(2,mManager.getRemainingCallCount());
  mService.onCleanupUserInner(UserHandle.USER_SYSTEM);
  assertEquals(1,mService.getShortcutsForTest().size());
}
