{
  InetAddress dns=getDns();
  if (dns == null) {
    if (V) {
      myLogV("checkDnsConnectivity: Invalid DNS, returning false");
    }
    return false;
  }
  if (V) {
    myLogV("checkDnsConnectivity: Checking " + dns.getHostAddress() + " for connectivity");
  }
  int numInitialIgnoredPings=getInitialIgnoredPingCount();
  int numPings=getPingCount();
  int pingDelay=getPingDelayMs();
  int acceptableLoss=getAcceptablePacketLossPercentage();
  int ignoredPingCounter=0;
  int pingCounter=0;
  int successCounter=0;
  if (numPings == 0) {
    return true;
  }
  for (; ignoredPingCounter < numInitialIgnoredPings; ignoredPingCounter++) {
    if (shouldCancel())     return false;
    boolean dnsAlive=DnsPinger.isDnsReachable(dns,getPingTimeoutMs());
    if (dnsAlive) {
      pingCounter++;
      successCounter++;
    }
    if (V) {
      Slog.v(TAG,(dnsAlive ? "  +" : "  Ignored: -"));
    }
    if (shouldCancel())     return false;
    try {
      Thread.sleep(pingDelay);
    }
 catch (    InterruptedException e) {
      Slog.w(TAG,"Interrupted while pausing between pings",e);
    }
  }
  for (; pingCounter < numPings; pingCounter++) {
    if (shouldCancel())     return false;
    if (DnsPinger.isDnsReachable(dns,getPingTimeoutMs())) {
      successCounter++;
      if (V) {
        Slog.v(TAG,"  +");
      }
    }
 else {
      if (V) {
        Slog.v(TAG,"  -");
      }
    }
    if (shouldCancel())     return false;
    try {
      Thread.sleep(pingDelay);
    }
 catch (    InterruptedException e) {
      Slog.w(TAG,"Interrupted while pausing between pings",e);
    }
  }
  int packetLossPercentage=100 * (numPings - successCounter) / numPings;
  if (D) {
    Slog.d(TAG,packetLossPercentage + "% packet loss (acceptable is " + acceptableLoss+ "%)");
  }
  return !shouldCancel() && (packetLossPercentage <= acceptableLoss);
}
