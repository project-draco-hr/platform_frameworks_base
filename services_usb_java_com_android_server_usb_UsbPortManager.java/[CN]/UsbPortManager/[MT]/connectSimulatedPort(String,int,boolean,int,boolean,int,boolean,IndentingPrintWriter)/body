{
synchronized (mLock) {
    final SimulatedPortInfo portInfo=mSimulatedPorts.get(portId);
    if (portInfo == null) {
      pw.println("Cannot connect simulated port which does not exist.");
      return;
    }
    if (mode == 0 || powerRole == 0 || dataRole == 0) {
      pw.println("Cannot connect simulated port in null mode, " + "power role, or data role.");
      return;
    }
    if ((portInfo.mSupportedModes & mode) == 0) {
      pw.println("Simulated port does not support mode: " + UsbPort.modeToString(mode));
      return;
    }
    pw.println("Connecting simulated port: portId=" + portId + ", mode="+ UsbPort.modeToString(mode)+ ", canChangeMode="+ canChangeMode+ ", powerRole="+ UsbPort.powerRoleToString(powerRole)+ ", canChangePowerRole="+ canChangePowerRole+ ", dataRole="+ UsbPort.dataRoleToString(dataRole)+ ", canChangeDataRole="+ canChangeDataRole);
    portInfo.mCurrentMode=mode;
    portInfo.mCanChangeMode=canChangeMode;
    portInfo.mCurrentPowerRole=powerRole;
    portInfo.mCanChangePowerRole=canChangePowerRole;
    portInfo.mCurrentDataRole=dataRole;
    portInfo.mCanChangeDataRole=canChangeDataRole;
    updatePortsLocked(pw);
  }
}
