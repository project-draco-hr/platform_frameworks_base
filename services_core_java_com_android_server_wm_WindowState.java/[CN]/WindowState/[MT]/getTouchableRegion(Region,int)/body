{
  final boolean modal=(flags & (FLAG_NOT_TOUCH_MODAL | FLAG_NOT_FOCUSABLE)) == 0;
  if (modal && mAppToken != null) {
    flags|=FLAG_NOT_TOUCH_MODAL;
    final DimLayer.DimLayerUser dimLayerUser=getDimLayerUser();
    if (dimLayerUser != null) {
      dimLayerUser.getDimBounds(mTmpRect);
    }
 else {
      getVisibleBounds(mTmpRect);
    }
    if (inFreeformWorkspace()) {
      final DisplayMetrics displayMetrics=getDisplayContent().getDisplayMetrics();
      final int delta=WindowManagerService.dipToPixel(RESIZE_HANDLE_WIDTH_IN_DP,displayMetrics);
      mTmpRect.inset(-delta,-delta);
    }
    region.set(mTmpRect);
    cropRegionToStackBoundsIfNeeded(region);
  }
 else {
    getTouchableRegion(region);
  }
  return flags;
}
