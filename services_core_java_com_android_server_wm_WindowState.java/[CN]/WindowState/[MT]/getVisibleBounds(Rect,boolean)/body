{
  boolean intersectWithStackBounds=mAppToken != null && mAppToken.mCropWindowsToStack;
  boolean isFreeform=false;
  bounds.setEmpty();
  mTmpRect.setEmpty();
  if (intersectWithStackBounds) {
    final TaskStack stack=getStack();
    if (stack != null) {
      stack.getBounds(mTmpRect);
    }
 else {
      intersectWithStackBounds=false;
    }
  }
  final Task task=getTask();
  if (task != null) {
    task.getBounds(bounds);
    isFreeform=task.inFreeformWorkspace();
    if (intersectWithStackBounds) {
      bounds.intersect(mTmpRect);
    }
  }
  if (bounds.isEmpty()) {
    bounds.set(mFrame);
    if (intersectWithStackBounds) {
      bounds.intersect(mTmpRect);
    }
    return;
  }
  if (forTouch && isFreeform) {
    final DisplayMetrics displayMetrics=getDisplayContent().getDisplayMetrics();
    final int delta=mService.dipToPixel(RESIZE_HANDLE_WIDTH_IN_DP,displayMetrics);
    bounds.inset(-delta,-delta);
  }
}
