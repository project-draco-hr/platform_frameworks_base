{
  final boolean useStackBounds=mAppToken != null && mAppToken.mCropWindowsToStack;
  boolean isFreeform=false;
  bounds.setEmpty();
  if (useStackBounds) {
    final TaskStack stack=getStack();
    if (stack != null) {
      stack.getBounds(bounds);
      isFreeform=stack.mStackId == FREEFORM_WORKSPACE_STACK_ID;
    }
  }
 else {
    final Task task=getTask();
    if (task != null) {
      task.getBounds(bounds);
      isFreeform=task.inFreeformWorkspace();
    }
  }
  if (bounds.isEmpty()) {
    bounds.set(mFrame);
    return;
  }
  if (forTouch && isFreeform) {
    final DisplayMetrics displayMetrics=getDisplayContent().getDisplayMetrics();
    final int delta=mService.dipToPixel(RESIZE_HANDLE_WIDTH_IN_DP,displayMetrics);
    bounds.inset(-delta,-delta);
  }
}
