{
  boolean intersectWithStackBounds=mAppToken != null && mAppToken.mCropWindowsToStack;
  bounds.setEmpty();
  mTmpRect.setEmpty();
  if (intersectWithStackBounds) {
    final TaskStack stack=getStack();
    if (stack != null) {
      stack.getBounds(mTmpRect);
    }
 else {
      intersectWithStackBounds=false;
    }
  }
  bounds.set(mVisibleFrame);
  if (intersectWithStackBounds) {
    bounds.intersect(mTmpRect);
  }
  if (bounds.isEmpty()) {
    bounds.set(mFrame);
    if (intersectWithStackBounds) {
      bounds.intersect(mTmpRect);
    }
    return;
  }
  if (forTouch && inFreeformWorkspace()) {
    final DisplayMetrics displayMetrics=getDisplayContent().getDisplayMetrics();
    final int delta=mService.dipToPixel(RESIZE_HANDLE_WIDTH_IN_DP,displayMetrics);
    bounds.inset(-delta,-delta);
  }
}
