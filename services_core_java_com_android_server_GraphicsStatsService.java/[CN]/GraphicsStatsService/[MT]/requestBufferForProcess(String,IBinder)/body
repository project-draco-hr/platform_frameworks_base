{
  int uid=Binder.getCallingUid();
  int pid=Binder.getCallingPid();
  ParcelFileDescriptor pfd=null;
  long callingIdentity=Binder.clearCallingIdentity();
  try {
    if (!isValid(uid,packageName)) {
      throw new RemoteException("Invalid package name");
    }
synchronized (mLock) {
      pfd=requestBufferForProcessLocked(token,uid,pid,packageName);
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingIdentity);
  }
  return pfd;
}
