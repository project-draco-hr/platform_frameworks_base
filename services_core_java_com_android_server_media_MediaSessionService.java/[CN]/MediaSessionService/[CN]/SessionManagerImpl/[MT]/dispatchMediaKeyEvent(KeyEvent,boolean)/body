{
  if (keyEvent == null || !KeyEvent.isMediaKey(keyEvent.getKeyCode())) {
    Log.w(TAG,"Attempted to dispatch null or non-media key event.");
    return;
  }
  final int pid=Binder.getCallingPid();
  final int uid=Binder.getCallingUid();
  final long token=Binder.clearCallingIdentity();
  if (DEBUG) {
    Log.d(TAG,"dispatchMediaKeyEvent, pid=" + pid + ", uid="+ uid+ ", event="+ keyEvent);
  }
  try {
synchronized (mLock) {
      UserRecord ur=mUserRecords.get(ActivityManager.getCurrentUser());
      boolean useNotPlayingSessions=ur.mLastMediaButtonReceiver == null && ur.mRestoredMediaButtonReceiver == null;
      MediaSessionRecord session=mPriorityStack.getDefaultMediaButtonSession(mCurrentUserId,useNotPlayingSessions);
      if (isVoiceKey(keyEvent.getKeyCode())) {
        handleVoiceKeyEventLocked(keyEvent,needWakeLock,session);
      }
 else {
        dispatchMediaKeyEventLocked(keyEvent,needWakeLock,session);
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(token);
  }
}
