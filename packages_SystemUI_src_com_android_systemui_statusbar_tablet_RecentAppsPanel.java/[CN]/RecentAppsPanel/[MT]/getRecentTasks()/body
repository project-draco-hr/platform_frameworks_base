{
  ArrayList<ActivityDescription> activityDescriptions=new ArrayList<ActivityDescription>();
  final PackageManager pm=mContext.getPackageManager();
  final ActivityManager am=(ActivityManager)mContext.getSystemService(Context.ACTIVITY_SERVICE);
  final List<ActivityManager.RecentTaskInfo> recentTasks=am.getRecentTasks(MAX_TASKS,ActivityManager.RECENT_IGNORE_UNAVAILABLE | ActivityManager.TASKS_GET_THUMBNAILS);
  ActivityInfo homeInfo=new Intent(Intent.ACTION_MAIN).addCategory(Intent.CATEGORY_HOME).resolveActivityInfo(pm,0);
  int numTasks=recentTasks.size();
  final int first=1;
  for (int i=first, index=0; i < numTasks && (index < MAX_TASKS); ++i) {
    final ActivityManager.RecentTaskInfo recentInfo=recentTasks.get(i);
    Intent intent=new Intent(recentInfo.baseIntent);
    if (recentInfo.origActivity != null) {
      intent.setComponent(recentInfo.origActivity);
    }
    if (homeInfo != null && homeInfo.packageName.equals(intent.getComponent().getPackageName()) && homeInfo.name.equals(intent.getComponent().getClassName())) {
      continue;
    }
    intent.setFlags((intent.getFlags() & ~Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) | Intent.FLAG_ACTIVITY_NEW_TASK);
    final ResolveInfo resolveInfo=pm.resolveActivity(intent,0);
    if (resolveInfo != null) {
      final ActivityInfo info=resolveInfo.activityInfo;
      final String title=info.loadLabel(pm).toString();
      Drawable icon=getFullResIcon(resolveInfo,pm);
      int id=recentTasks.get(i).id;
      if (title != null && title.length() > 0 && icon != null) {
        if (DEBUG)         Log.v(TAG,"creating activity desc for id=" + id + ", label="+ title);
        ActivityDescription item=new ActivityDescription(crop(recentInfo.thumbnail),icon,title,recentInfo.description,intent,id,index,info.packageName);
        activityDescriptions.add(item);
        ++index;
      }
 else {
        if (DEBUG)         Log.v(TAG,"SKIPPING item " + id);
      }
    }
  }
  return activityDescriptions;
}
