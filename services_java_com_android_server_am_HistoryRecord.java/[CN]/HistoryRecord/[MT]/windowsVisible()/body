{
synchronized (service) {
    if (startTime != 0) {
      long time=SystemClock.uptimeMillis() - startTime;
      if (ActivityManagerService.SHOW_ACTIVITY_START_TIME) {
        EventLog.writeEvent(ActivityManagerService.LOG_ACTIVITY_LAUNCH_TIME,System.identityHashCode(this),shortComponentName,time);
        Log.i(ActivityManagerService.TAG,"Displayed activity " + shortComponentName + ": "+ time+ " ms");
      }
      if (time > 0) {
        service.mUsageStatsService.noteLaunchTime(realActivity,(int)time);
      }
      startTime=0;
    }
    if (ActivityManagerService.DEBUG_SWITCH)     Log.v(ActivityManagerService.TAG,"windowsVisible(): " + this);
    if (!nowVisible) {
      nowVisible=true;
      if (!idle) {
        service.processStoppingActivitiesLocked(false);
      }
 else {
        final int N=service.mWaitingVisibleActivities.size();
        if (N > 0) {
          for (int i=0; i < N; i++) {
            HistoryRecord r=(HistoryRecord)service.mWaitingVisibleActivities.get(i);
            r.waitingVisible=false;
            if (ActivityManagerService.DEBUG_SWITCH)             Log.v(ActivityManagerService.TAG,"Was waiting for visible: " + r);
          }
          service.mWaitingVisibleActivities.clear();
          Message msg=Message.obtain();
          msg.what=ActivityManagerService.IDLE_NOW_MSG;
          service.mHandler.sendMessage(msg);
        }
      }
      service.scheduleAppGcsLocked();
    }
  }
}
