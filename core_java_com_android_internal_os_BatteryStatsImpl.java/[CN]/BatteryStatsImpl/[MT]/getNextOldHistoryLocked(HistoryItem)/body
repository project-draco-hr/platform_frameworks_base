{
  boolean end=mHistoryBuffer.dataPosition() >= mHistoryBuffer.dataSize();
  if (!end) {
    readHistoryDelta(mHistoryBuffer,mHistoryReadTmp);
    mReadOverflow|=mHistoryReadTmp.cmd == HistoryItem.CMD_OVERFLOW;
  }
  HistoryItem cur=mHistoryIterator;
  if (cur == null) {
    if (!mReadOverflow && !end) {
      Slog.w(TAG,"Old history ends before new history!");
    }
    return false;
  }
  out.setTo(cur);
  mHistoryIterator=cur.next;
  if (!mReadOverflow) {
    if (end) {
      Slog.w(TAG,"New history ends before old history!");
    }
 else     if (!out.same(mHistoryReadTmp)) {
      long now=getHistoryBaseTime() + SystemClock.elapsedRealtime();
      PrintWriter pw=new FastPrintWriter(new LogWriter(android.util.Log.WARN,TAG));
      pw.println("Histories differ!");
      pw.println("Old history:");
      (new HistoryPrinter()).printNextItem(pw,out,now,false,true);
      pw.println("New history:");
      (new HistoryPrinter()).printNextItem(pw,mHistoryReadTmp,now,false,true);
      pw.flush();
    }
  }
  return true;
}
