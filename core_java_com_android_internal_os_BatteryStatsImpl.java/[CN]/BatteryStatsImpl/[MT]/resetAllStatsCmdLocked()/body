{
  resetAllStatsLocked();
  long uptime=SystemClock.uptimeMillis() * 1000;
  long mSecRealtime=SystemClock.elapsedRealtime();
  long realtime=mSecRealtime * 1000;
  mDischargeStartLevel=mHistoryCur.batteryLevel;
  pullPendingStateUpdatesLocked();
  addHistoryRecordLocked(mSecRealtime);
  mDischargeCurrentLevel=mDischargeUnplugLevel=mHistoryCur.batteryLevel;
  if ((mHistoryCur.states & HistoryItem.STATE_BATTERY_PLUGGED_FLAG) != 0) {
    mTrackBatteryPastUptime=0;
    mTrackBatteryPastRealtime=0;
  }
 else {
    mTrackBatteryUptimeStart=uptime;
    mTrackBatteryRealtimeStart=realtime;
    mUnpluggedBatteryUptime=getBatteryUptimeLocked(uptime);
    mUnpluggedBatteryRealtime=getBatteryRealtimeLocked(realtime);
    if (mScreenOn) {
      mDischargeScreenOnUnplugLevel=mHistoryCur.batteryLevel;
      mDischargeScreenOffUnplugLevel=0;
    }
 else {
      mDischargeScreenOnUnplugLevel=0;
      mDischargeScreenOffUnplugLevel=mHistoryCur.batteryLevel;
    }
    mDischargeAmountScreenOn=0;
    mDischargeAmountScreenOff=0;
  }
  initActiveHistoryEventsLocked(mSecRealtime);
}
