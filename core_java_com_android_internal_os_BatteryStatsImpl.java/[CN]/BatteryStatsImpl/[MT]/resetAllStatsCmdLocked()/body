{
  resetAllStatsLocked();
  long uptime=SystemClock.uptimeMillis() * 1000;
  long mSecRealtime=SystemClock.elapsedRealtime();
  long realtime=mSecRealtime * 1000;
  mDischargeStartLevel=mHistoryCur.batteryLevel;
  pullPendingStateUpdatesLocked();
  addHistoryRecordLocked(mSecRealtime);
  mDischargeCurrentLevel=mDischargeUnplugLevel=mHistoryCur.batteryLevel;
  mOnBatteryTimeBase.reset(uptime,realtime);
  mOnBatteryScreenOffTimeBase.reset(uptime,realtime);
  if ((mHistoryCur.states & HistoryItem.STATE_BATTERY_PLUGGED_FLAG) == 0) {
    if (mScreenOn) {
      mDischargeScreenOnUnplugLevel=mHistoryCur.batteryLevel;
      mDischargeScreenOffUnplugLevel=0;
    }
 else {
      mDischargeScreenOnUnplugLevel=0;
      mDischargeScreenOffUnplugLevel=mHistoryCur.batteryLevel;
    }
    mDischargeAmountScreenOn=0;
    mDischargeAmountScreenOff=0;
  }
  initActiveHistoryEventsLocked(mSecRealtime);
}
