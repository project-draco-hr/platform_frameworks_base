{
  if (!mHaveBatteryLevel || !mRecordingHistory) {
    return;
  }
  if (mHistoryEnd != null && mHistoryEnd.cmd == HistoryItem.CMD_UPDATE && (mHistoryBaseTime + curTime) < (mHistoryEnd.time + 100)) {
    if (mHistoryLastEnd != null && mHistoryLastEnd.cmd == HistoryItem.CMD_UPDATE && mHistoryLastEnd.same(mHistoryCur)) {
      mHistoryLastEnd.next=null;
      mHistoryEnd.next=mHistoryCache;
      mHistoryCache=mHistoryEnd;
      mHistoryEnd=mHistoryLastEnd;
      mHistoryLastEnd=null;
    }
 else {
      mHistoryEnd.setTo(mHistoryEnd.time,HistoryItem.CMD_UPDATE,mHistoryCur);
    }
    return;
  }
  if (mNumHistoryItems >= MAX_HISTORY_ITEMS) {
    if (mHistoryEnd != null && mHistoryEnd.batteryLevel == mHistoryCur.batteryLevel) {
      return;
    }
  }
  addHistoryRecordLocked(curTime,HistoryItem.CMD_UPDATE);
}
