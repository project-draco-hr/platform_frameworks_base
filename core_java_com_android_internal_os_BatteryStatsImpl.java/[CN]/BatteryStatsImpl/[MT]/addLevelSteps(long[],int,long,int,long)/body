{
  if (lastStepTime >= 0 && numStepLevels > 0) {
    long duration=elapsedRealtime - lastStepTime;
    for (int i=0; i < numStepLevels; i++) {
      System.arraycopy(steps,0,steps,1,steps.length - 1);
      long thisDuration=duration / (numStepLevels - i);
      duration-=thisDuration;
      steps[0]=thisDuration;
    }
    stepCount+=numStepLevels;
    if (stepCount > steps.length) {
      stepCount=steps.length;
    }
  }
  return stepCount;
}
