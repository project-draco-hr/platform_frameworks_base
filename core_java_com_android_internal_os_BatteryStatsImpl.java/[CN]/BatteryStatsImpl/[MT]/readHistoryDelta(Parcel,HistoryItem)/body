{
  int firstToken=src.readInt();
  int deltaTimeToken=firstToken & DELTA_TIME_MASK;
  cur.cmd=(byte)((firstToken >> DELTA_CMD_SHIFT) & DELTA_CMD_MASK);
  cur.numReadInts=1;
  if (DEBUG)   Slog.i(TAG,"READ DELTA: firstToken=0x" + Integer.toHexString(firstToken) + " deltaTimeToken="+ deltaTimeToken);
  if (deltaTimeToken < DELTA_TIME_ABS) {
    cur.time+=deltaTimeToken;
  }
 else   if (deltaTimeToken == DELTA_TIME_ABS) {
    cur.time=src.readLong();
    cur.numReadInts+=2;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: ABS time=" + cur.time);
    cur.readFromParcel(src);
    return;
  }
 else   if (deltaTimeToken == DELTA_TIME_INT) {
    int delta=src.readInt();
    cur.time+=delta;
    cur.numReadInts+=1;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: time delta=" + delta + " new time="+ cur.time);
  }
 else {
    long delta=src.readLong();
    if (DEBUG)     Slog.i(TAG,"READ DELTA: time delta=" + delta + " new time="+ cur.time);
    cur.time+=delta;
    cur.numReadInts+=2;
  }
  if ((firstToken & DELTA_BATTERY_LEVEL_FLAG) != 0) {
    int batteryLevelInt=src.readInt();
    cur.batteryLevel=(byte)((batteryLevelInt >> 25) & 0x7f);
    cur.batteryTemperature=(short)((batteryLevelInt << 7) >> 21);
    cur.batteryVoltage=(char)(batteryLevelInt & 0x3fff);
    cur.numReadInts+=1;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: batteryToken=0x" + Integer.toHexString(batteryLevelInt) + " batteryLevel="+ cur.batteryLevel+ " batteryTemp="+ cur.batteryTemperature+ " batteryVolt="+ (int)cur.batteryVoltage);
  }
  if ((firstToken & DELTA_STATE_FLAG) != 0) {
    int stateInt=src.readInt();
    cur.states=(firstToken & DELTA_STATE_MASK) | (stateInt & (~DELTA_STATE_MASK));
    cur.batteryStatus=(byte)((stateInt >> 28) & 0xf);
    cur.batteryHealth=(byte)((stateInt >> 24) & 0xf);
    cur.batteryPlugType=(byte)((stateInt >> 22) & 0x3);
    cur.numReadInts+=1;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: stateToken=0x" + Integer.toHexString(stateInt) + " batteryStatus="+ cur.batteryStatus+ " batteryHealth="+ cur.batteryHealth+ " batteryPlugType="+ cur.batteryPlugType+ " states=0x"+ Integer.toHexString(cur.states));
  }
 else {
    cur.states=(firstToken & DELTA_STATE_MASK) | (cur.states & (~DELTA_STATE_MASK));
  }
  if ((firstToken & DELTA_WAKELOCK_FLAG) != 0) {
    cur.wakelockTag=cur.localWakelockTag;
    int index=src.readInt();
    readHistoryTag(index,cur.wakelockTag);
    cur.numReadInts+=1;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: wakelockTag=#" + cur.wakelockTag.poolIdx + " "+ cur.wakelockTag.uid+ ":"+ cur.wakelockTag.string);
  }
 else {
    cur.wakelockTag=null;
  }
  if (cur.cmd == HistoryItem.CMD_EVENT) {
    cur.eventTag=cur.localEventTag;
    final int codeAndIndex=src.readInt();
    cur.eventCode=(codeAndIndex & 0xffff);
    final int index=((codeAndIndex >> 16) & 0xffff);
    readHistoryTag(index,cur.eventTag);
    cur.numReadInts+=1;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: event=" + cur.eventCode + " tag=#"+ cur.eventTag.poolIdx+ " "+ cur.eventTag.uid+ ":"+ cur.eventTag.string);
  }
 else {
    cur.eventCode=HistoryItem.EVENT_NONE;
  }
}
