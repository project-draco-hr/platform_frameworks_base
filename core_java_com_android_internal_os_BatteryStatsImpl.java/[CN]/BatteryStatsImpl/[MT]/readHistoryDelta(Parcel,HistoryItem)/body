{
  int firstToken=src.readInt();
  int deltaTimeToken=firstToken & DELTA_TIME_MASK;
  cur.cmd=(byte)((firstToken >> DELTA_CMD_SHIFT) & DELTA_CMD_MASK);
  if (DEBUG)   Slog.i(TAG,"READ DELTA: firstToken=0x" + Integer.toHexString(firstToken) + " deltaTimeToken="+ deltaTimeToken);
  if (deltaTimeToken < DELTA_TIME_ABS) {
    cur.time+=deltaTimeToken;
  }
 else   if (deltaTimeToken == DELTA_TIME_ABS) {
    cur.time=src.readLong();
    cur.readFromParcel(src);
    return;
  }
 else   if (deltaTimeToken == DELTA_TIME_INT) {
    int delta=src.readInt();
    cur.time+=delta;
    if (DEBUG)     Slog.i(TAG,"READ DELTA: time delta=" + delta + " new time="+ cur.time);
  }
 else {
    long delta=src.readLong();
    if (DEBUG)     Slog.i(TAG,"READ DELTA: time delta=" + delta + " new time="+ cur.time);
    cur.time+=delta;
  }
  if ((firstToken & DELTA_BATTERY_LEVEL_FLAG) != 0) {
    int batteryLevelInt=src.readInt();
    cur.batteryLevel=(byte)((batteryLevelInt >> 25) & 0x7f);
    cur.batteryTemperature=(short)((batteryLevelInt << 7) >> 21);
    cur.batteryVoltage=(char)(batteryLevelInt & 0x3fff);
    if (DEBUG)     Slog.i(TAG,"READ DELTA: batteryToken=0x" + Integer.toHexString(batteryLevelInt) + " batteryLevel="+ cur.batteryLevel+ " batteryTemp="+ cur.batteryTemperature+ " batteryVolt="+ (int)cur.batteryVoltage);
  }
  if ((firstToken & DELTA_STATE_FLAG) != 0) {
    int stateInt=src.readInt();
    cur.states=(firstToken & DELTA_STATE_MASK) | (stateInt & (~DELTA_STATE_MASK));
    cur.batteryStatus=(byte)((stateInt >> 28) & 0xf);
    cur.batteryHealth=(byte)((stateInt >> 24) & 0xf);
    cur.batteryPlugType=(byte)((stateInt >> 22) & 0x3);
    if (DEBUG)     Slog.i(TAG,"READ DELTA: stateToken=0x" + Integer.toHexString(stateInt) + " batteryStatus="+ cur.batteryStatus+ " batteryHealth="+ cur.batteryHealth+ " batteryPlugType="+ cur.batteryPlugType+ " states=0x"+ Integer.toHexString(cur.states));
  }
 else {
    cur.states=(firstToken & DELTA_STATE_MASK) | (cur.states & (~DELTA_STATE_MASK));
  }
  if (cur.cmd == HistoryItem.CMD_EVENT) {
    cur.eventCode=src.readInt();
    cur.eventUid=src.readInt();
    cur.eventName=src.readString();
  }
 else {
    cur.eventCode=HistoryItem.EVENT_NONE;
  }
}
