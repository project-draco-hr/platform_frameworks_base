{
  if (!SystemProperties.getBoolean(PROP_QTAGUID_ENABLED,false))   return;
  final NetworkStats snapshot;
  try {
    snapshot=mNetworkStatsFactory.readNetworkStatsDetail();
  }
 catch (  IOException e) {
    Log.wtf(TAG,"Failed to read network stats",e);
    return;
  }
  if (mLastSnapshot == null) {
    mLastSnapshot=snapshot;
    return;
  }
  final NetworkStats delta=snapshot.subtract(mLastSnapshot);
  mLastSnapshot=snapshot;
  NetworkStats.Entry entry=null;
  final int size=delta.size();
  for (int i=0; i < size; i++) {
    entry=delta.getValues(i,entry);
    if (entry.rxBytes == 0 || entry.txBytes == 0)     continue;
    if (entry.tag != NetworkStats.TAG_NONE)     continue;
    final Uid u=getUidStatsLocked(entry.uid);
    if (mMobileIfaces.contains(entry.iface)) {
      u.noteNetworkActivityLocked(NETWORK_MOBILE_RX_DATA,entry.rxBytes,entry.rxPackets);
      u.noteNetworkActivityLocked(NETWORK_MOBILE_TX_DATA,entry.txBytes,entry.txPackets);
      mNetworkByteActivityCounters[NETWORK_MOBILE_RX_DATA].addCountLocked(entry.rxBytes);
      mNetworkByteActivityCounters[NETWORK_MOBILE_TX_DATA].addCountLocked(entry.txBytes);
      mNetworkPacketActivityCounters[NETWORK_MOBILE_RX_DATA].addCountLocked(entry.rxPackets);
      mNetworkPacketActivityCounters[NETWORK_MOBILE_TX_DATA].addCountLocked(entry.txPackets);
    }
 else     if (mWifiIfaces.contains(entry.iface)) {
      u.noteNetworkActivityLocked(NETWORK_WIFI_RX_DATA,entry.rxBytes,entry.rxPackets);
      u.noteNetworkActivityLocked(NETWORK_WIFI_TX_DATA,entry.txBytes,entry.txPackets);
      mNetworkByteActivityCounters[NETWORK_WIFI_RX_DATA].addCountLocked(entry.rxBytes);
      mNetworkByteActivityCounters[NETWORK_WIFI_TX_DATA].addCountLocked(entry.txBytes);
      mNetworkPacketActivityCounters[NETWORK_WIFI_RX_DATA].addCountLocked(entry.rxPackets);
      mNetworkPacketActivityCounters[NETWORK_WIFI_TX_DATA].addCountLocked(entry.txPackets);
    }
  }
}
