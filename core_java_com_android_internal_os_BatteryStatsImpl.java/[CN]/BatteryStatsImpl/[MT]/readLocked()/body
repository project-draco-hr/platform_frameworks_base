{
  if (mDailyFile != null) {
    readDailyStatsLocked();
  }
  if (mFile == null) {
    Slog.w("BatteryStats","readLocked: no file associated with this instance");
    return;
  }
  mUidStats.clear();
  try {
    File file=mFile.chooseForRead();
    if (!file.exists()) {
      return;
    }
    FileInputStream stream=new FileInputStream(file);
    byte[] raw=BatteryStatsHelper.readFully(stream);
    Parcel in=Parcel.obtain();
    in.unmarshall(raw,0,raw.length);
    in.setDataPosition(0);
    stream.close();
    readSummaryFromParcel(in);
  }
 catch (  Exception e) {
    Slog.e("BatteryStats","Error reading battery statistics",e);
    resetAllStatsLocked();
  }
  mEndPlatformVersion=Build.ID;
  if (mHistoryBuffer.dataPosition() > 0) {
    mRecordingHistory=true;
    final long elapsedRealtime=mClocks.elapsedRealtime();
    final long uptime=mClocks.uptimeMillis();
    if (USE_OLD_HISTORY) {
      addHistoryRecordLocked(elapsedRealtime,uptime,HistoryItem.CMD_START,mHistoryCur);
    }
    addHistoryBufferLocked(elapsedRealtime,uptime,HistoryItem.CMD_START,mHistoryCur);
    startRecordingHistory(elapsedRealtime,uptime,false);
  }
  recordDailyStatsIfNeededLocked(false);
}
