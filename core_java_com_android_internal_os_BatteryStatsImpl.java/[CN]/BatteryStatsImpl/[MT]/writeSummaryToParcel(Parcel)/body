{
  final long NOW=getBatteryUptimeLocked();
  final long NOW_SYS=SystemClock.uptimeMillis() * 1000;
  final long NOWREAL_SYS=SystemClock.elapsedRealtime() * 1000;
  out.writeInt(VERSION);
  out.writeInt(mStartCount);
  out.writeLong(computeBatteryUptime(NOW_SYS,STATS_TOTAL));
  out.writeLong(computeBatteryUptime(NOW_SYS,STATS_CURRENT));
  out.writeLong(computeBatteryRealtime(NOWREAL_SYS,STATS_TOTAL));
  out.writeLong(computeBatteryRealtime(NOWREAL_SYS,STATS_CURRENT));
  out.writeLong(computeUptime(NOW_SYS,STATS_TOTAL));
  out.writeLong(computeUptime(NOW_SYS,STATS_CURRENT));
  out.writeLong(computeRealtime(NOWREAL_SYS,STATS_TOTAL));
  out.writeLong(computeRealtime(NOWREAL_SYS,STATS_CURRENT));
  final int NU=mUidStats.size();
  out.writeInt(NU);
  for (int iu=0; iu < NU; iu++) {
    out.writeInt(mUidStats.keyAt(iu));
    Uid u=mUidStats.valueAt(iu);
    int NW=u.mWakelockStats.size();
    out.writeInt(NW);
    if (NW > 0) {
      for (      Map.Entry<String,BatteryStatsImpl.Uid.Wakelock> ent : u.mWakelockStats.entrySet()) {
        out.writeString(ent.getKey());
        Uid.Wakelock wl=ent.getValue();
        if (wl.wakeTimeFull != null) {
          out.writeInt(1);
          wl.wakeTimeFull.writeSummaryFromParcelLocked(out,NOW);
        }
 else {
          out.writeInt(0);
        }
        if (wl.wakeTimePartial != null) {
          out.writeInt(1);
          wl.wakeTimePartial.writeSummaryFromParcelLocked(out,NOW);
        }
 else {
          out.writeInt(0);
        }
        if (wl.wakeTimeWindow != null) {
          out.writeInt(1);
          wl.wakeTimeWindow.writeSummaryFromParcelLocked(out,NOW);
        }
 else {
          out.writeInt(0);
        }
      }
    }
    int NSE=u.mSensorStats.size();
    out.writeInt(NSE);
    if (NSE > 0) {
      for (      Map.Entry<Integer,BatteryStatsImpl.Uid.Sensor> ent : u.mSensorStats.entrySet()) {
        out.writeInt(ent.getKey());
        Uid.Sensor se=ent.getValue();
        if (se.sensorTime != null) {
          out.writeInt(1);
          se.sensorTime.writeSummaryFromParcelLocked(out,NOW);
        }
 else {
          out.writeInt(0);
        }
      }
    }
    int NP=u.mProcessStats.size();
    out.writeInt(NP);
    if (NP > 0) {
      for (      Map.Entry<String,BatteryStatsImpl.Uid.Proc> ent : u.mProcessStats.entrySet()) {
        out.writeString(ent.getKey());
        Uid.Proc ps=ent.getValue();
        out.writeLong(ps.mUserTime);
        out.writeLong(ps.mUserTime - ps.mLoadedUserTime);
        out.writeLong(ps.mSystemTime);
        out.writeLong(ps.mSystemTime - ps.mLoadedSystemTime);
        out.writeInt(ps.mStarts);
        out.writeInt(ps.mStarts - ps.mLoadedStarts);
      }
    }
    NP=u.mPackageStats.size();
    out.writeInt(NP);
    if (NP > 0) {
      for (      Map.Entry<String,BatteryStatsImpl.Uid.Pkg> ent : u.mPackageStats.entrySet()) {
        out.writeString(ent.getKey());
        Uid.Pkg ps=ent.getValue();
        out.writeInt(ps.mWakeups);
        out.writeInt(ps.mWakeups - ps.mLoadedWakeups);
        final int NS=ps.mServiceStats.size();
        out.writeInt(NS);
        if (NS > 0) {
          for (          Map.Entry<String,BatteryStatsImpl.Uid.Pkg.Serv> sent : ps.mServiceStats.entrySet()) {
            out.writeString(sent.getKey());
            BatteryStatsImpl.Uid.Pkg.Serv ss=sent.getValue();
            long time=ss.getStartTimeToNowLocked(NOW);
            out.writeLong(time);
            out.writeLong(time - ss.mLoadedStartTime);
            out.writeInt(ss.mStarts);
            out.writeInt(ss.mStarts - ss.mLoadedStarts);
            out.writeInt(ss.mLaunches);
            out.writeInt(ss.mLaunches - ss.mLoadedLaunches);
          }
        }
      }
    }
  }
}
