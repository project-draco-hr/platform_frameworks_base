{
  int bin;
  if (mPhoneServiceState == ServiceState.STATE_POWER_OFF || mPhoneServiceState == ServiceState.STATE_OUT_OF_SERVICE) {
    return;
  }
  if (!signalStrength.isGsm()) {
    int dBm=signalStrength.getCdmaDbm();
    if (dBm >= -75)     bin=SIGNAL_STRENGTH_GREAT;
 else     if (dBm >= -85)     bin=SIGNAL_STRENGTH_GOOD;
 else     if (dBm >= -95)     bin=SIGNAL_STRENGTH_MODERATE;
 else     if (dBm >= -100)     bin=SIGNAL_STRENGTH_POOR;
 else     bin=SIGNAL_STRENGTH_NONE_OR_UNKNOWN;
  }
 else {
    int asu=signalStrength.getGsmSignalStrength();
    if (asu < 0 || asu >= 99)     bin=SIGNAL_STRENGTH_NONE_OR_UNKNOWN;
 else     if (asu >= 16)     bin=SIGNAL_STRENGTH_GREAT;
 else     if (asu >= 8)     bin=SIGNAL_STRENGTH_GOOD;
 else     if (asu >= 4)     bin=SIGNAL_STRENGTH_MODERATE;
 else     bin=SIGNAL_STRENGTH_POOR;
  }
  if (mPhoneSignalStrengthBin != bin) {
    mHistoryCur.states=(mHistoryCur.states & ~BatteryHistoryRecord.STATE_SIGNAL_STRENGTH_MASK) | (bin << BatteryHistoryRecord.STATE_SIGNAL_STRENGTH_SHIFT);
    if (DEBUG_HISTORY)     Slog.v(TAG,"Signal strength " + bin + " to: "+ Integer.toHexString(mHistoryCur.states));
    addHistoryRecord(SystemClock.elapsedRealtime());
    if (mPhoneSignalStrengthBin >= 0) {
      mPhoneSignalStrengthsTimer[mPhoneSignalStrengthBin].stopRunningLocked(this);
    }
    mPhoneSignalStrengthBin=bin;
    mPhoneSignalStrengthsTimer[bin].startRunningLocked(this);
  }
}
