{
  if (mOnBatteryTimeBase.setRunning(unplugged,uptime,realtime)) {
    if (unplugged) {
      mBluetoothPingStart=getCurrentBluetoothPingCount();
      mBluetoothPingCount=0;
    }
 else {
      mBluetoothPingCount=getBluetoothPingCount();
      mBluetoothPingStart=-1;
    }
  }
  boolean unpluggedScreenOff=unplugged && screenOff;
  if (unpluggedScreenOff != mOnBatteryScreenOffTimeBase.isRunning()) {
    updateKernelWakelocksLocked();
    requestWakelockCpuUpdate();
    if (!unpluggedScreenOff) {
      mDistributeWakelockCpu=true;
    }
    mOnBatteryScreenOffTimeBase.setRunning(unpluggedScreenOff,uptime,realtime);
  }
}
