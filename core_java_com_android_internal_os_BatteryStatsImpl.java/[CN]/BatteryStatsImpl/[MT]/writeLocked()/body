{
  if (mFile == null) {
    Slog.w("BatteryStats","writeLocked: no file associated with this instance");
    return;
  }
  if (mShuttingDown) {
    return;
  }
  try {
    FileOutputStream stream=new FileOutputStream(mFile.chooseForWrite());
    Parcel out=Parcel.obtain();
    writeSummaryToParcel(out);
    stream.write(out.marshall());
    out.recycle();
    stream.flush();
    stream.close();
    mFile.commit();
    mLastWriteTime=SystemClock.elapsedRealtime();
    return;
  }
 catch (  IOException e) {
    Slog.w("BatteryStats","Error writing battery statistics",e);
  }
  mFile.rollback();
}
