{
  if ((mFile == null) || (mBackupFile == null)) {
    Log.w("BatteryStats","writeLocked: no file associated with this instance");
    return;
  }
  if (mFile.exists()) {
    if (mBackupFile.exists()) {
      mBackupFile.delete();
    }
    if (!mFile.renameTo(mBackupFile)) {
      Log.w("BatteryStats","Failed to back up file before writing new stats");
      return;
    }
  }
  try {
    FileOutputStream stream=new FileOutputStream(mFile);
    Parcel out=Parcel.obtain();
    writeSummaryToParcel(out);
    stream.write(out.marshall());
    out.recycle();
    stream.flush();
    stream.close();
    mBackupFile.delete();
    mLastWriteTime=SystemClock.elapsedRealtime();
    return;
  }
 catch (  IOException e) {
    Log.w("BatteryStats","Error writing battery statistics",e);
  }
  if (mFile.exists()) {
    if (!mFile.delete()) {
      Log.w(TAG,"Failed to delete mangled file " + mFile);
    }
  }
}
