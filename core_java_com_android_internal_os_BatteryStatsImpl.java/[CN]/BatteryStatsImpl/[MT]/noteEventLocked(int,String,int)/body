{
  uid=mapUid(uid);
  if ((code & HistoryItem.EVENT_FLAG_START) != 0) {
    int idx=code & ~HistoryItem.EVENT_FLAG_START;
    HashMap<String,SparseBooleanArray> active=mActiveEvents[idx];
    if (active == null) {
      active=new HashMap<String,SparseBooleanArray>();
      mActiveEvents[idx]=active;
    }
    SparseBooleanArray uids=active.get(name);
    if (uids == null) {
      uids=new SparseBooleanArray();
      active.put(name,uids);
    }
    if (uids.get(uid)) {
      return;
    }
    uids.put(uid,true);
  }
 else   if ((code & HistoryItem.EVENT_FLAG_FINISH) != 0) {
    int idx=code & ~HistoryItem.EVENT_FLAG_FINISH;
    HashMap<String,SparseBooleanArray> active=mActiveEvents[idx];
    if (active == null) {
      return;
    }
    SparseBooleanArray uids=active.get(name);
    if (uids == null) {
      return;
    }
    idx=uids.indexOfKey(uid);
    if (idx < 0 || !uids.valueAt(idx)) {
      return;
    }
    uids.removeAt(idx);
    if (uids.size() <= 0) {
      active.remove(name);
    }
  }
  final long elapsedRealtime=SystemClock.elapsedRealtime();
  final long uptime=SystemClock.uptimeMillis();
  addHistoryEventLocked(elapsedRealtime,uptime,code,name,uid);
}
