{
synchronized (this) {
    if (mOnBattery != onBattery) {
      long uptime=SystemClock.uptimeMillis() * 1000;
      long mSecRealtime=SystemClock.elapsedRealtime();
      long realtime=mSecRealtime * 1000;
      if (onBattery) {
        mTrackBatteryUptimeStart=uptime;
        mTrackBatteryRealtimeStart=realtime;
        unplugTimers();
      }
 else {
        mTrackBatteryPastUptime+=uptime - mTrackBatteryUptimeStart;
        mTrackBatteryPastRealtime+=realtime - mTrackBatteryRealtimeStart;
      }
      mOnBattery=onBattery;
      if ((mLastWriteTime + (60 * 1000)) < mSecRealtime) {
        if (mFile != null) {
          writeLocked();
        }
      }
    }
  }
}
