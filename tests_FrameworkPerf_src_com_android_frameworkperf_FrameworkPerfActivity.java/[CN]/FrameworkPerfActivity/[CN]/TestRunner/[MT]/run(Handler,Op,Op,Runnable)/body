{
  mHandler=handler;
  mForegroundOp=foreground;
  mBackgroundOp=background;
  mDoneCallback=doneCallback;
  mBackgroundThread=new RunnerThread("background",new Runnable(){
    @Override public void run(){
      boolean running;
      int ops=0;
      do {
        running=mBackgroundOp.onRun();
        ops++;
      }
 while (evalRepeat(running,true) && running);
      mBackgroundEndTime=SystemClock.uptimeMillis();
      mBackgroundOps=ops * mBackgroundOp.getOpsPerRun();
      threadFinished(false);
    }
  }
,Process.THREAD_PRIORITY_BACKGROUND);
  mForegroundThread=new RunnerThread("background",new Runnable(){
    @Override public void run(){
      boolean running;
      int ops=0;
      do {
        running=mForegroundOp.onRun();
        ops++;
      }
 while (evalRepeat(true,running) && running);
      mForegroundEndTime=SystemClock.uptimeMillis();
      mForegroundOps=ops * mForegroundOp.getOpsPerRun();
      threadFinished(true);
    }
  }
,Process.THREAD_PRIORITY_FOREGROUND);
  mForegroundOp.onInit(FrameworkPerfActivity.this);
  mBackgroundOp.onInit(FrameworkPerfActivity.this);
synchronized (this) {
    mStartTime=SystemClock.uptimeMillis();
    mBackgroundRunning=true;
    mForegroundRunning=true;
  }
  mBackgroundThread.start();
  mForegroundThread.start();
}
