{
  if (localLOGV)   Log.i(TAG,orientation + ", " + tiltAngle+ ", "+ mRotation);
  final boolean allow180Rotation=mAllow180Rotation;
  int thresholdRanges[][]=allow180Rotation ? THRESHOLDS_WITH_180[mRotation] : THRESHOLDS[mRotation];
  int row=-1;
  for (int i=0; i < thresholdRanges.length; i++) {
    if (orientation >= thresholdRanges[i][0] && orientation < thresholdRanges[i][1]) {
      row=i;
      break;
    }
  }
  if (row == -1)   return;
  int rotation=allow180Rotation ? ROTATE_TO_WITH_180[mRotation][row] : ROTATE_TO[mRotation][row];
  if (tiltAngle > MAX_TRANSITION_TILT[rotation]) {
    return;
  }
  if (localLOGV)   Log.i(TAG,"orientation " + orientation + " gives new rotation = "+ rotation);
  mRotation=rotation;
  mOrientationListener.onOrientationChanged(INTERNAL_TO_SURFACE_ROTATION[mRotation]);
}
