{
  float[] values=event.values;
  int orientation=ORIENTATION_UNKNOWN;
  float X=values[_DATA_X];
  float Y=values[_DATA_Y];
  float Z=values[_DATA_Z];
  float OneEightyOverPi=57.29577957855f;
  float gravity=(float)Math.sqrt(X * X + Y * Y + Z * Z);
  float zyangle=Math.abs((float)Math.asin(Z / gravity) * OneEightyOverPi);
  if (zyangle < 40) {
    float angle=(float)Math.atan2(Y,-X) * OneEightyOverPi;
    orientation=90 - (int)Math.round(angle);
    while (orientation >= 360) {
      orientation-=360;
    }
    while (orientation < 0) {
      orientation+=360;
    }
  }
 else   if (zyangle >= 75) {
    orientation=ORIENTATION_FLAT;
  }
  if (orientation != mOrientation) {
    mOrientation=orientation;
    onOrientationChanged(orientation);
  }
}
