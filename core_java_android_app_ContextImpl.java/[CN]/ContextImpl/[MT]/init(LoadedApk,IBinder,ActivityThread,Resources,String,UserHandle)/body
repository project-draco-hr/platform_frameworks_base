{
  mPackageInfo=packageInfo;
  if (basePackageName != null) {
    mBasePackageName=mOpPackageName=basePackageName;
  }
 else {
    mBasePackageName=packageInfo.mPackageName;
    ApplicationInfo ainfo=packageInfo.getApplicationInfo();
    if (ainfo.uid == Process.SYSTEM_UID && ainfo.uid != Process.myUid()) {
      mOpPackageName=ActivityThread.currentPackageName();
    }
 else {
      mOpPackageName=mBasePackageName;
    }
  }
  mResources=mPackageInfo.getResources(mainThread);
  mResourcesManager=ResourcesManager.getInstance();
  CompatibilityInfo compatInfo=container == null ? null : container.getCompatibilityInfo();
  if (mResources != null && ((compatInfo != null && compatInfo.applicationScale != mResources.getCompatibilityInfo().applicationScale) || activityToken != null)) {
    if (DEBUG) {
      Log.d(TAG,"loaded context has different scaling. Using container's" + " compatiblity info:" + container.getDisplayMetrics());
    }
    if (compatInfo == null) {
      compatInfo=packageInfo.getCompatibilityInfo();
    }
    mDisplayAdjustments.setCompatibilityInfo(compatInfo);
    mDisplayAdjustments.setActivityToken(activityToken);
    mResources=mResourcesManager.getTopLevelResources(mPackageInfo.getResDir(),mPackageInfo.getOverlayDirs(),Display.DEFAULT_DISPLAY,null,compatInfo,activityToken);
  }
 else {
    mDisplayAdjustments.setCompatibilityInfo(packageInfo.getCompatibilityInfo());
    mDisplayAdjustments.setActivityToken(activityToken);
  }
  mMainThread=mainThread;
  mActivityToken=activityToken;
  mContentResolver=new ApplicationContentResolver(this,mainThread,user);
  mUser=user;
}
