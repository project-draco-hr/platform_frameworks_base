{
  SharedPreferencesImpl sp;
synchronized (ContextImpl.class) {
    if (sSharedPrefs == null) {
      sSharedPrefs=new ArrayMap<String,ArrayMap<String,SharedPreferencesImpl>>();
    }
    final String packageName=getPackageName();
    ArrayMap<String,SharedPreferencesImpl> packagePrefs=sSharedPrefs.get(packageName);
    if (packagePrefs == null) {
      packagePrefs=new ArrayMap<String,SharedPreferencesImpl>();
      sSharedPrefs.put(packageName,packagePrefs);
    }
    if (mPackageInfo.getApplicationInfo().targetSdkVersion < Build.VERSION_CODES.KITKAT) {
      if (name == null) {
        name="null";
      }
    }
    sp=packagePrefs.get(name);
    if (sp == null) {
      File prefsFile=getSharedPrefsFile(name);
      sp=new SharedPreferencesImpl(prefsFile,mode);
      packagePrefs.put(name,sp);
      return sp;
    }
  }
  if ((mode & Context.MODE_MULTI_PROCESS) != 0 || getApplicationInfo().targetSdkVersion < android.os.Build.VERSION_CODES.HONEYCOMB) {
    sp.startReloadIfChangedUnexpectedly();
  }
  return sp;
}
