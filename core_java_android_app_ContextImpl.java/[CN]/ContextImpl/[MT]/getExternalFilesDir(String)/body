{
synchronized (mSync) {
    if (mExternalFilesDir == null) {
      mExternalFilesDir=Environment.getExternalStorageAppFilesDirectory(getPackageName());
    }
    if (!mExternalFilesDir.exists()) {
      try {
        (new File(Environment.getExternalStorageAndroidDataDir(),".nomedia")).createNewFile();
      }
 catch (      IOException e) {
      }
      if (!mExternalFilesDir.mkdirs()) {
        Log.w(TAG,"Unable to create external files directory");
        return null;
      }
    }
    if (type == null) {
      return mExternalFilesDir;
    }
    File dir=new File(mExternalFilesDir,type);
    if (!dir.exists()) {
      if (!dir.mkdirs()) {
        Log.w(TAG,"Unable to create external media directory " + dir);
        return null;
      }
    }
    return dir;
  }
}
