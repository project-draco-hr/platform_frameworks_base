{
  SharedPreferencesImpl sp;
synchronized (ContextImpl.class) {
    if (sSharedPrefs == null) {
      sSharedPrefs=new ArrayMap<String,ArrayMap<File,SharedPreferencesImpl>>();
    }
    final String packageName=getPackageName();
    ArrayMap<File,SharedPreferencesImpl> packagePrefs=sSharedPrefs.get(packageName);
    if (packagePrefs == null) {
      packagePrefs=new ArrayMap<File,SharedPreferencesImpl>();
      sSharedPrefs.put(packageName,packagePrefs);
    }
    sp=packagePrefs.get(file);
    if (sp == null) {
      sp=new SharedPreferencesImpl(file,mode);
      packagePrefs.put(file,sp);
      return sp;
    }
  }
  if ((mode & Context.MODE_MULTI_PROCESS) != 0 || getApplicationInfo().targetSdkVersion < android.os.Build.VERSION_CODES.HONEYCOMB) {
    sp.startReloadIfChangedUnexpectedly();
  }
  return sp;
}
