{
  mOuterContext=this;
  if ((flags & (Context.CONTEXT_CREDENTIAL_PROTECTED_STORAGE | Context.CONTEXT_DEVICE_PROTECTED_STORAGE)) == 0) {
    final File dataDir=packageInfo.getDataDirFile();
    if (Objects.equals(dataDir,packageInfo.getCredentialProtectedDataDirFile())) {
      flags|=Context.CONTEXT_CREDENTIAL_PROTECTED_STORAGE;
    }
 else     if (Objects.equals(dataDir,packageInfo.getDeviceProtectedDataDirFile())) {
      flags|=Context.CONTEXT_DEVICE_PROTECTED_STORAGE;
    }
  }
  mMainThread=mainThread;
  mActivityToken=activityToken;
  mFlags=flags;
  if (user == null) {
    user=Process.myUserHandle();
  }
  mUser=user;
  mPackageInfo=packageInfo;
  mResourcesManager=ResourcesManager.getInstance();
  final int displayId=(createDisplayWithId != Display.INVALID_DISPLAY) ? createDisplayWithId : (display != null) ? display.getDisplayId() : Display.DEFAULT_DISPLAY;
  CompatibilityInfo compatInfo=null;
  if (container != null) {
    compatInfo=container.getDisplayAdjustments(displayId).getCompatibilityInfo();
  }
  if (compatInfo == null) {
    compatInfo=(displayId == Display.DEFAULT_DISPLAY) ? packageInfo.getCompatibilityInfo() : CompatibilityInfo.DEFAULT_COMPATIBILITY_INFO;
  }
  Resources resources=packageInfo.getResources(mainThread);
  if (resources != null) {
    if (displayId != Display.DEFAULT_DISPLAY || overrideConfiguration != null || (compatInfo != null && compatInfo.applicationScale != resources.getCompatibilityInfo().applicationScale)) {
      if (container != null) {
        resources=mResourcesManager.getResources(activityToken,packageInfo.getResDir(),packageInfo.getSplitResDirs(),packageInfo.getOverlayDirs(),packageInfo.getApplicationInfo().sharedLibraryFiles,displayId,overrideConfiguration,compatInfo,packageInfo.getClassLoader());
      }
 else {
        resources=mResourcesManager.createBaseActivityResources(activityToken,packageInfo.getResDir(),packageInfo.getSplitResDirs(),packageInfo.getOverlayDirs(),packageInfo.getApplicationInfo().sharedLibraryFiles,displayId,overrideConfiguration,compatInfo,packageInfo.getClassLoader());
      }
    }
  }
  mResources=resources;
  mDisplay=(createDisplayWithId == Display.INVALID_DISPLAY) ? display : mResourcesManager.getAdjustedDisplay(displayId,mResources.getDisplayAdjustments());
  if (container != null) {
    mBasePackageName=container.mBasePackageName;
    mOpPackageName=container.mOpPackageName;
  }
 else {
    mBasePackageName=packageInfo.mPackageName;
    ApplicationInfo ainfo=packageInfo.getApplicationInfo();
    if (ainfo.uid == Process.SYSTEM_UID && ainfo.uid != Process.myUid()) {
      mOpPackageName=ActivityThread.currentPackageName();
    }
 else {
      mOpPackageName=mBasePackageName;
    }
  }
  mContentResolver=new ApplicationContentResolver(this,mainThread,user);
}
