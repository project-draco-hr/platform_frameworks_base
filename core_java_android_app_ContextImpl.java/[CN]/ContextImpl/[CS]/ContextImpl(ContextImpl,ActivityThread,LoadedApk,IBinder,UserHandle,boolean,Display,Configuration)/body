{
  mOuterContext=this;
  mMainThread=mainThread;
  mActivityToken=activityToken;
  mRestricted=restricted;
  if (user == null) {
    user=Process.myUserHandle();
  }
  mUser=user;
  mPackageInfo=packageInfo;
  mResourcesManager=ResourcesManager.getInstance();
  mDisplay=display;
  final int displayId=getDisplayId();
  CompatibilityInfo compatInfo=null;
  if (container != null) {
    compatInfo=container.getDisplayAdjustments(displayId).getCompatibilityInfo();
  }
  if (compatInfo == null && displayId == Display.DEFAULT_DISPLAY) {
    compatInfo=packageInfo.getCompatibilityInfo();
  }
  mDisplayAdjustments.setCompatibilityInfo(compatInfo);
  mDisplayAdjustments.setActivityToken(activityToken);
  Resources resources=packageInfo.getResources(mainThread);
  if (resources != null) {
    if (displayId != Display.DEFAULT_DISPLAY || overrideConfiguration != null || (compatInfo != null && compatInfo.applicationScale != resources.getCompatibilityInfo().applicationScale)) {
      resources=mResourcesManager.getTopLevelResources(packageInfo.getResDir(),packageInfo.getSplitResDirs(),packageInfo.getOverlayDirs(),packageInfo.getApplicationInfo().sharedLibraryFiles,displayId,overrideConfiguration,compatInfo);
    }
  }
  mResources=resources;
  if (container != null) {
    mBasePackageName=container.mBasePackageName;
    mOpPackageName=container.mOpPackageName;
  }
 else {
    mBasePackageName=packageInfo.mPackageName;
    ApplicationInfo ainfo=packageInfo.getApplicationInfo();
    if (ainfo.uid == Process.SYSTEM_UID && ainfo.uid != Process.myUid()) {
      mOpPackageName=ActivityThread.currentPackageName();
    }
 else {
      mOpPackageName=mBasePackageName;
    }
  }
  mContentResolver=new ApplicationContentResolver(this,mainThread,user);
}
