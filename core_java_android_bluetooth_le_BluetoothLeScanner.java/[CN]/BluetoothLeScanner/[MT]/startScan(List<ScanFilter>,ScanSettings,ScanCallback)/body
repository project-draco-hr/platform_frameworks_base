{
  if (settings == null || callback == null) {
    throw new IllegalArgumentException("settings or callback is null");
  }
synchronized (mLeScanClients) {
    if (mLeScanClients.containsKey(callback)) {
      postCallbackError(callback,ScanCallback.SCAN_FAILED_ALREADY_STARTED);
      return;
    }
    BleScanCallbackWrapper wrapper=new BleScanCallbackWrapper(mBluetoothGatt,filters,settings,callback);
    try {
      UUID uuid=UUID.randomUUID();
      mBluetoothGatt.registerClient(new ParcelUuid(uuid),wrapper);
      if (wrapper.scanStarted()) {
        mLeScanClients.put(callback,wrapper);
      }
 else {
        postCallbackError(callback,ScanCallback.SCAN_FAILED_APPLICATION_REGISTRATION_FAILED);
        return;
      }
    }
 catch (    RemoteException e) {
      Log.e(TAG,"GATT service exception when starting scan",e);
      postCallbackError(callback,ScanCallback.SCAN_FAILED_GATT_SERVICE_FAILURE);
    }
  }
}
