{
  try {
    boolean startSystemServer=false;
    String socketName="zygote";
    String abiList=null;
    try {
      Trace.traceBegin(Trace.TRACE_TAG_DALVIK,"ZygoteInit");
      RuntimeInit.enableDdms();
      SamplingProfilerIntegration.start();
      for (int i=1; i < argv.length; i++) {
        if ("start-system-server".equals(argv[i])) {
          startSystemServer=true;
        }
 else         if (argv[i].startsWith(ABI_LIST_ARG)) {
          abiList=argv[i].substring(ABI_LIST_ARG.length());
        }
 else         if (argv[i].startsWith(SOCKET_NAME_ARG)) {
          socketName=argv[i].substring(SOCKET_NAME_ARG.length());
        }
 else {
          throw new RuntimeException("Unknown command line argument: " + argv[i]);
        }
      }
      if (abiList == null) {
        throw new RuntimeException("No ABI list supplied.");
      }
      registerZygoteSocket(socketName);
      try {
        Trace.traceBegin(Trace.TRACE_TAG_DALVIK,"ZygotePreload");
        EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_START,SystemClock.uptimeMillis());
        preload();
        EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_END,SystemClock.uptimeMillis());
      }
  finally {
        Trace.traceEnd(Trace.TRACE_TAG_DALVIK);
      }
      SamplingProfilerIntegration.writeZygoteSnapshot();
      try {
        Trace.traceBegin(Trace.TRACE_TAG_DALVIK,"PostZygoteInitGC");
        gcAndFinalize();
      }
  finally {
        Trace.traceEnd(Trace.TRACE_TAG_DALVIK);
      }
    }
  finally {
      Trace.traceEnd(Trace.TRACE_TAG_DALVIK);
    }
    Trace.setTracingEnabled(false);
    if (startSystemServer) {
      startSystemServer(abiList,socketName);
    }
    Log.i(TAG,"Accepting command socket connections");
    runSelectLoop(abiList);
    closeServerSocket();
  }
 catch (  MethodAndArgsCaller caller) {
    caller.run();
  }
catch (  RuntimeException ex) {
    Log.e(TAG,"Zygote died with exception",ex);
    closeServerSocket();
    throw ex;
  }
}
