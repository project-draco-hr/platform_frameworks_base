{
  checkToolbarInitialized();
  mContentRectOnScreen.set(mContentRect);
  final ViewParent parent=mOriginatingView.getParent();
  if (parent instanceof ViewGroup) {
    ((ViewGroup)parent).getChildVisibleRect(mOriginatingView,mContentRectOnScreen,null,true);
    mContentRectOnScreen.offset(mRootViewPositionOnScreen[0],mRootViewPositionOnScreen[1]);
  }
 else {
    mContentRectOnScreen.offset(mViewPositionOnScreen[0],mViewPositionOnScreen[1]);
  }
  if (isContentRectWithinBounds()) {
    mFloatingToolbarVisibilityHelper.setOutOfBounds(false);
    mContentRectOnScreen.set(Math.max(mContentRectOnScreen.left,mViewRectOnScreen.left),Math.max(mContentRectOnScreen.top,mViewRectOnScreen.top),Math.min(mContentRectOnScreen.right,mViewRectOnScreen.right),Math.min(mContentRectOnScreen.bottom,mViewRectOnScreen.bottom + mBottomAllowance));
    if (!mContentRectOnScreen.equals(mPreviousContentRectOnScreen)) {
      mOriginatingView.removeCallbacks(mMovingOff);
      mFloatingToolbarVisibilityHelper.setMoving(true);
      mOriginatingView.postDelayed(mMovingOff,MOVING_HIDE_DELAY);
      mFloatingToolbar.setContentRect(mContentRectOnScreen);
      mFloatingToolbar.updateLayout();
    }
  }
 else {
    mFloatingToolbarVisibilityHelper.setOutOfBounds(true);
    mContentRectOnScreen.setEmpty();
  }
  mFloatingToolbarVisibilityHelper.updateToolbarVisibility();
  mPreviousContentRectOnScreen.set(mContentRectOnScreen);
}
