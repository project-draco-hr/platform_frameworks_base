{
  validatePermission(android.Manifest.permission.MOUNT_UNMOUNT_FILESYSTEMS);
  if (!method.equals("ums")) {
    throw new IllegalArgumentException(String.format("Method %s not supported",method));
  }
  String vs=getVolumeState(path);
  if (enable && vs.equals(Environment.MEDIA_MOUNTED)) {
    mUmsEnabling=enable;
    int rc=doUnmountVolume(path,false);
    mUmsEnabling=false;
    if (rc != StorageResultCode.OperationSucceeded) {
      Log.e(TAG,String.format("Failed to unmount before enabling UMS (%d)",rc));
      return rc;
    }
  }
  try {
    mConnector.doCommand(String.format("volume %sshare %s %s",(enable ? "" : "un"),path,method));
  }
 catch (  NativeDaemonConnectorException e) {
    Log.e(TAG,"Failed to share/unshare",e);
    return StorageResultCode.OperationFailedInternalError;
  }
  if (!enable) {
    if (doMountVolume(path) != StorageResultCode.OperationSucceeded) {
      Log.e(TAG,String.format("Failed to remount %s after disabling share method %s",path,method));
    }
  }
  return StorageResultCode.OperationSucceeded;
}
