{
  if (password == null) {
    throw new IllegalArgumentException("password cannot be null");
  }
  mContext.enforceCallingOrSelfPermission(Manifest.permission.CRYPT_KEEPER,"no permission to access the crypt keeper");
  waitForReady();
  if (DEBUG_EVENTS) {
    Slog.i(TAG,"decrypting storage...");
  }
  try {
    ArrayList<String> rsp=mConnector.doCommand("cryptfs checkpw " + password);
    String[] tok=rsp.get(0).split(" ");
    if (tok == null || tok.length != 2) {
      return -1;
    }
    int code=Integer.parseInt(tok[1]);
    if (code == 0) {
      mHandler.postDelayed(new Runnable(){
        public void run(){
          mConnector.doCommand(String.format("cryptfs restart"));
        }
      }
,2000);
    }
    return code;
  }
 catch (  NativeDaemonConnectorException e) {
    return e.getCode();
  }
}
