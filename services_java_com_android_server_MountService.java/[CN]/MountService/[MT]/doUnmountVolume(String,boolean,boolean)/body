{
  if (!getVolumeState(path).equals(Environment.MEDIA_MOUNTED)) {
    return VoldResponseCode.OpFailedVolNotMounted;
  }
  Runtime.getRuntime().gc();
  mPms.updateExternalMediaStatus(false,false);
  try {
    final Command cmd=new Command("volume","unmount",path);
    if (removeEncryption) {
      cmd.appendArg("force_and_revert");
    }
 else     if (force) {
      cmd.appendArg("force");
    }
    mConnector.execute(cmd);
synchronized (mAsecMountSet) {
      mAsecMountSet.clear();
    }
    return StorageResultCode.OperationSucceeded;
  }
 catch (  NativeDaemonConnectorException e) {
    int code=e.getCode();
    if (code == VoldResponseCode.OpFailedVolNotMounted) {
      return StorageResultCode.OperationFailedStorageNotMounted;
    }
 else     if (code == VoldResponseCode.OpFailedStorageBusy) {
      return StorageResultCode.OperationFailedStorageBusy;
    }
 else {
      return StorageResultCode.OperationFailedInternalError;
    }
  }
}
