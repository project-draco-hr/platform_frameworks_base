{
  mContext=context;
  mEmulateExternalStorage=context.getResources().getBoolean(com.android.internal.R.bool.config_emulateExternalStorage);
  if (mEmulateExternalStorage) {
    Slog.d(TAG,"using emulated external storage");
    mLegacyState=Environment.MEDIA_MOUNTED;
  }
  mPms=(PackageManagerService)ServiceManager.getService("package");
  mContext.registerReceiver(mBroadcastReceiver,new IntentFilter(Intent.ACTION_BOOT_COMPLETED),null,null);
  mHandlerThread=new HandlerThread("MountService");
  mHandlerThread.start();
  mHandler=new MountServiceHandler(mHandlerThread.getLooper());
  mObbActionHandler=new ObbActionHandler(mHandlerThread.getLooper());
  if ("simulator".equals(SystemProperties.get("ro.product.device"))) {
    mReady=true;
    mUmsEnabling=true;
    return;
  }
  mConnector=new NativeDaemonConnector(this,"vold",PackageManagerService.MAX_CONTAINERS * 2,VOLD_TAG);
  mReady=false;
  Thread thread=new Thread(mConnector,VOLD_TAG);
  thread.start();
}
