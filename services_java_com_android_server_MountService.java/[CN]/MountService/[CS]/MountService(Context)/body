{
  mContext=context;
  readStorageList();
  if (mPrimaryVolume != null) {
    mExternalStoragePath=mPrimaryVolume.getPath();
    mEmulateExternalStorage=mPrimaryVolume.isEmulated();
    if (mEmulateExternalStorage) {
      Slog.d(TAG,"using emulated external storage");
      mVolumeStates.put(mExternalStoragePath,Environment.MEDIA_MOUNTED);
    }
  }
  mPms=(PackageManagerService)ServiceManager.getService("package");
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_BOOT_COMPLETED);
  if (mPrimaryVolume != null && mPrimaryVolume.allowMassStorage()) {
    filter.addAction(UsbManager.ACTION_USB_STATE);
  }
  mContext.registerReceiver(mBroadcastReceiver,filter,null,null);
  mHandlerThread=new HandlerThread("MountService");
  mHandlerThread.start();
  mHandler=new MountServiceHandler(mHandlerThread.getLooper());
  mObbActionHandler=new ObbActionHandler(mHandlerThread.getLooper());
  mConnector=new NativeDaemonConnector(this,"vold",MAX_CONTAINERS * 2,VOLD_TAG,25);
  Thread thread=new Thread(mConnector,VOLD_TAG);
  thread.start();
  if (WATCHDOG_ENABLE) {
    Watchdog.getInstance().addMonitor(this);
  }
}
