{
  mContext=context;
synchronized (mVolumesLock) {
    readStorageListLocked();
  }
  mPms=(PackageManagerService)ServiceManager.getService("package");
  HandlerThread hthread=new HandlerThread(TAG);
  hthread.start();
  mHandler=new MountServiceHandler(hthread.getLooper());
  final IntentFilter userFilter=new IntentFilter();
  userFilter.addAction(Intent.ACTION_USER_ADDED);
  userFilter.addAction(Intent.ACTION_USER_REMOVED);
  mContext.registerReceiver(mUserReceiver,userFilter,null,mHandler);
  final StorageVolume primary=getPrimaryPhysicalVolume();
  if (primary != null && primary.allowMassStorage()) {
    mContext.registerReceiver(mUsbReceiver,new IntentFilter(UsbManager.ACTION_USB_STATE),null,mHandler);
  }
  IntentFilter idleMaintenanceFilter=new IntentFilter();
  idleMaintenanceFilter.addAction(Intent.ACTION_IDLE_MAINTENANCE_START);
  mContext.registerReceiverAsUser(mIdleMaintenanceReceiver,UserHandle.ALL,idleMaintenanceFilter,null,mHandler);
  mObbActionHandler=new ObbActionHandler(IoThread.get().getLooper());
  mConnector=new NativeDaemonConnector(this,"vold",MAX_CONTAINERS * 2,VOLD_TAG,25);
  Thread thread=new Thread(mConnector,VOLD_TAG);
  thread.start();
  if (WATCHDOG_ENABLE) {
    Watchdog.getInstance().addMonitor(this);
  }
}
