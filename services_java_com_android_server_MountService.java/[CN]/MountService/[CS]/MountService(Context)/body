{
  mContext=context;
synchronized (mVolumesLock) {
    readStorageListLocked();
  }
  mPms=(PackageManagerService)ServiceManager.getService("package");
  mHandlerThread=new HandlerThread("MountService");
  mHandlerThread.start();
  mHandler=new MountServiceHandler(mHandlerThread.getLooper());
  mContext.registerReceiverAsUser(mBootReceiver,UserHandle.ALL,new IntentFilter(Intent.ACTION_BOOT_COMPLETED),null,mHandler);
  final IntentFilter userFilter=new IntentFilter();
  userFilter.addAction(Intent.ACTION_USER_ADDED);
  userFilter.addAction(Intent.ACTION_USER_REMOVED);
  mContext.registerReceiver(mUserReceiver,userFilter,null,mHandler);
  final StorageVolume primary=getPrimaryPhysicalVolume();
  if (primary != null && primary.allowMassStorage()) {
    mContext.registerReceiver(mUsbReceiver,new IntentFilter(UsbManager.ACTION_USB_STATE),null,mHandler);
  }
  mObbActionHandler=new ObbActionHandler(mHandlerThread.getLooper());
  mConnector=new NativeDaemonConnector(this,"vold",MAX_CONTAINERS * 2,VOLD_TAG,25);
  Thread thread=new Thread(mConnector,VOLD_TAG);
  thread.start();
  if (WATCHDOG_ENABLE) {
    Watchdog.getInstance().addMonitor(this);
  }
}
