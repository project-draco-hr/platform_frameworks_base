{
  ObbInfo obbInfo=mContainerService.getObbInfo(mObbState.filename);
  if (obbInfo == null) {
    throw new IOException("Couldn't read OBB file");
  }
  if (!isUidOwnerOfPackageOrSystem(obbInfo.packageName,mObbState.callerUid)) {
    throw new IllegalArgumentException("Caller package does not match OBB file");
  }
  if (mKey == null) {
    mKey="none";
  }
  int rc=StorageResultCode.OperationSucceeded;
  String cmd=String.format("obb mount %s %s %d",mObbState.filename,mKey,mObbState.callerUid);
  try {
    mConnector.doCommand(cmd);
  }
 catch (  NativeDaemonConnectorException e) {
    int code=e.getCode();
    if (code != VoldResponseCode.OpFailedStorageBusy) {
      rc=StorageResultCode.OperationFailedInternalError;
    }
  }
  if (rc == StorageResultCode.OperationSucceeded) {
    try {
      mObbState.token.onObbResult(mObbState.filename,Environment.MEDIA_MOUNTED);
    }
 catch (    RemoteException e) {
      Slog.w(TAG,"MountServiceListener went away while calling onObbStateChanged");
    }
  }
 else {
    Slog.e(TAG,"Couldn't mount OBB file: " + rc);
    removeObbState(mObbState);
    mObbState.token.onObbResult(mObbState.filename,Environment.MEDIA_BAD_REMOVAL);
  }
}
