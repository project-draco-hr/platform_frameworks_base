{
  waitForReady();
  warnOnNotMounted();
  final ObbInfo obbInfo=getObbInfo();
  final ObbState obbState;
synchronized (mObbMounts) {
    obbState=mObbPathToStateMap.get(obbInfo.filename);
  }
  if (obbState == null) {
    sendNewStatusOrIgnore(OnObbStateChangeListener.ERROR_NOT_MOUNTED);
    return;
  }
  if (obbState.callerUid != mObbState.callerUid) {
    Slog.w(TAG,"Permission denied attempting to unmount OBB " + obbInfo.filename + " (owned by "+ obbInfo.packageName+ ")");
    sendNewStatusOrIgnore(OnObbStateChangeListener.ERROR_PERMISSION_DENIED);
    return;
  }
  mObbState.filename=obbInfo.filename;
  int rc=StorageResultCode.OperationSucceeded;
  try {
    final Command cmd=new Command("obb","unmount",mObbState.filename);
    if (mForceUnmount) {
      cmd.appendArg("force");
    }
    mConnector.execute(cmd);
  }
 catch (  NativeDaemonConnectorException e) {
    int code=e.getCode();
    if (code == VoldResponseCode.OpFailedStorageBusy) {
      rc=StorageResultCode.OperationFailedStorageBusy;
    }
 else     if (code == VoldResponseCode.OpFailedStorageNotFound) {
      rc=StorageResultCode.OperationSucceeded;
    }
 else {
      rc=StorageResultCode.OperationFailedInternalError;
    }
  }
  if (rc == StorageResultCode.OperationSucceeded) {
synchronized (mObbMounts) {
      removeObbStateLocked(obbState);
    }
    sendNewStatusOrIgnore(OnObbStateChangeListener.UNMOUNTED);
  }
 else {
    Slog.w(TAG,"Could not mount OBB: " + mObbState.filename);
    sendNewStatusOrIgnore(OnObbStateChangeListener.ERROR_COULD_NOT_UNMOUNT);
  }
}
