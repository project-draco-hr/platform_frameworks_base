{
  final ObbInfo obbInfo=getObbInfo();
synchronized (mObbMounts) {
    if (!isObbMounted(obbInfo.filename)) {
      removeObbState(mObbState);
      sendNewStatusOrIgnore(mObbState.filename,Environment.MEDIA_UNMOUNTED);
      return;
    }
    if (!mObbState.filename.equals(obbInfo.filename)) {
      removeObbState(mObbState);
      mObbState=mObbPathToStateMap.get(obbInfo.filename);
    }
  }
  boolean unmounted=false;
synchronized (mObbState) {
    if (!mObbState.mounted) {
      sendNewStatusOrIgnore(obbInfo.filename,Environment.MEDIA_UNMOUNTED);
      return;
    }
    int rc=StorageResultCode.OperationSucceeded;
    String cmd=String.format("obb unmount %s%s",mObbState.filename,(mForceUnmount ? " force" : ""));
    try {
      mConnector.doCommand(cmd);
    }
 catch (    NativeDaemonConnectorException e) {
      int code=e.getCode();
      if (code == VoldResponseCode.OpFailedStorageBusy) {
        rc=StorageResultCode.OperationFailedStorageBusy;
      }
 else       if (code == VoldResponseCode.OpFailedStorageNotFound) {
        rc=StorageResultCode.OperationSucceeded;
      }
 else {
        rc=StorageResultCode.OperationFailedInternalError;
      }
    }
    if (rc == StorageResultCode.OperationSucceeded) {
      mObbState.mounted=false;
      unmounted=true;
    }
  }
  if (unmounted) {
    removeObbState(mObbState);
    sendNewStatusOrIgnore(mObbState.filename,Environment.MEDIA_UNMOUNTED);
  }
 else {
    sendNewStatusOrIgnore(mObbState.filename,Environment.MEDIA_MOUNTED);
  }
}
