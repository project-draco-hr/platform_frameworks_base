{
synchronized (mBuffer) {
    int length=packMessage(msg,offset,count,timestamp,mBuffer);
    try {
      mOutputStream.write(mBuffer,0,length);
    }
 catch (    IOException e) {
      IoUtils.closeQuietly(mOutputStream);
      onIOException();
      throw e;
    }
  }
}
