{
  while (true) {
    Console.log(Constants.DebugFlags.App.TaskDataLoader,"[TaskResourceLoader|run|" + Thread.currentThread().getId() + "]");
    if (mCancelled) {
      Console.log(Constants.DebugFlags.App.TaskDataLoader,"[TaskResourceLoader|cancel|" + Thread.currentThread().getId() + "]");
      mContext=null;
synchronized (mLoadThread) {
        try {
          Console.log(Constants.DebugFlags.App.TaskDataLoader,"[TaskResourceLoader|waitOnLoadThreadCancelled]");
          mLoadThread.wait();
        }
 catch (        InterruptedException ie) {
          ie.printStackTrace();
        }
      }
    }
 else {
      SystemServicesProxy ssp=mSystemServicesProxy;
      Pair<Task,Boolean> nextTaskData=mLoadQueue.nextTask();
      final Task t=nextTaskData.first;
      final boolean forceLoadTask=nextTaskData.second;
      if (t != null) {
        Drawable loadIcon=mApplicationIconCache.get(t.key);
        Bitmap loadThumbnail=mThumbnailCache.get(t.key);
        Console.log(Constants.DebugFlags.App.TaskDataLoader,"  [TaskResourceLoader|load]",t + " icon: " + loadIcon+ " thumbnail: "+ loadThumbnail+ " forceLoad: "+ forceLoadTask);
        if (loadIcon == null || forceLoadTask) {
          ActivityInfo info=ssp.getActivityInfo(t.key.baseIntent.getComponent());
          Drawable icon=ssp.getActivityIcon(info);
          if (!mCancelled) {
            if (icon != null) {
              Console.log(Constants.DebugFlags.App.TaskDataLoader,"    [TaskResourceLoader|loadIcon]",icon);
              loadIcon=icon;
              mApplicationIconCache.put(t.key,icon);
            }
          }
        }
        if (loadThumbnail == null || forceLoadTask) {
          Bitmap thumbnail=ssp.getTaskThumbnail(t.key.id);
          if (!mCancelled) {
            if (thumbnail != null) {
              Console.log(Constants.DebugFlags.App.TaskDataLoader,"    [TaskResourceLoader|loadThumbnail]",thumbnail);
              thumbnail.setHasAlpha(false);
              loadThumbnail=thumbnail;
              mThumbnailCache.put(t.key,thumbnail);
            }
 else {
              Console.logError(mContext,"Failed to load task top thumbnail for: " + t.key.baseIntent.getComponent().getPackageName());
            }
          }
        }
        if (!mCancelled) {
          final Drawable newIcon=loadIcon;
          final Bitmap newThumbnail=loadThumbnail;
          mMainThreadHandler.post(new Runnable(){
            @Override public void run(){
              t.notifyTaskDataLoaded(newThumbnail,newIcon,forceLoadTask);
            }
          }
);
        }
      }
      if (!mCancelled && mLoadQueue.isEmpty()) {
synchronized (mLoadQueue) {
          try {
            Console.log(Constants.DebugFlags.App.TaskDataLoader,"[TaskResourceLoader|waitOnLoadQueue]");
            mWaitingOnLoadQueue=true;
            mLoadQueue.wait();
            mWaitingOnLoadQueue=false;
          }
 catch (          InterruptedException ie) {
            ie.printStackTrace();
          }
        }
      }
    }
  }
}
