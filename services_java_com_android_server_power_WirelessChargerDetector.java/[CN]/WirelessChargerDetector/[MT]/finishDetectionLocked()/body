{
  if (mDetectionInProgress) {
    mSensorManager.unregisterListener(mListener);
    mHandler.removeCallbacks(mSensorTimeout);
    if (mMustUpdateRestPosition) {
      clearAtRestLocked();
      if (mTotalSamples < MIN_SAMPLES) {
        Slog.w(TAG,"Wireless charger detector is broken.  Only received " + mTotalSamples + " samples from the gravity sensor but we "+ "need at least "+ MIN_SAMPLES+ " and we expect to see "+ "about "+ SETTLE_TIME_MILLIS / SAMPLING_INTERVAL_MILLIS + " on average.");
      }
 else       if (mMovingSamples == 0) {
        mAtRest=true;
        mRestX=mLastSampleX;
        mRestY=mLastSampleY;
        mRestZ=mLastSampleZ;
      }
      mMustUpdateRestPosition=false;
    }
    if (DEBUG) {
      Slog.d(TAG,"New state: mAtRest=" + mAtRest + ", mRestX="+ mRestX+ ", mRestY="+ mRestY+ ", mRestZ="+ mRestZ+ ", mTotalSamples="+ mTotalSamples+ ", mMovingSamples="+ mMovingSamples);
    }
    mDetectionInProgress=false;
    mSuspendBlocker.release();
  }
}
