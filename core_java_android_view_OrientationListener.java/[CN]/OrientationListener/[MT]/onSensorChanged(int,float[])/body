{
  int orientation=ORIENTATION_UNKNOWN;
  float X=values[SensorManager.RAW_DATA_X];
  float Y=values[SensorManager.RAW_DATA_Y];
  float Z=values[SensorManager.RAW_DATA_Z];
  float magnitude=X * X + Y * Y;
  if (magnitude * 4 >= Z * Z) {
    float OneEightyOverPi=57.29577957855f;
    float angle=(float)Math.atan2(-Y,X) * OneEightyOverPi;
    orientation=90 - (int)Math.round(angle);
    while (orientation >= 360) {
      orientation-=360;
    }
    while (orientation < 0) {
      orientation+=360;
    }
  }
  if (orientation != mOrientation) {
    mOrientation=orientation;
    onOrientationChanged(orientation);
  }
}
