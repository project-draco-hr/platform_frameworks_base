{
  if (mFile.exists()) {
    if (!mFile.renameTo(mBackupFile)) {
      Log.e(TAG,"Couldn't rename file " + mFile + " to backup file "+ mBackupFile);
    }
  }
  try {
    FileOutputStream str=createFileOutputStream(mFile);
    if (str == null) {
      return false;
    }
    XmlUtils.writeMapXml(mMap,str);
    str.close();
    setFilePermissionsFromMode(mFile.getPath(),mMode,0);
    if (FileUtils.getFileStatus(mFile.getPath(),mFileStatus)) {
      mTimestamp=mFileStatus.mtime;
    }
    if (!mBackupFile.delete()) {
      Log.e(TAG,"Couldn't delete new backup file " + mBackupFile);
    }
    return true;
  }
 catch (  XmlPullParserException e) {
    Log.w(TAG,"writeFileLocked: Got exception:",e);
  }
catch (  IOException e) {
    Log.w(TAG,"writeFileLocked: Got exception:",e);
  }
  if (mFile.exists()) {
    if (!mFile.delete()) {
      Log.e(TAG,"Couldn't clean up partially-written file " + mFile);
    }
  }
  return false;
}
