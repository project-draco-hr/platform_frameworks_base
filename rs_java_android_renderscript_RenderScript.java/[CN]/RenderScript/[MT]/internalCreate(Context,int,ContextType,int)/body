{
  if (!sInitialized) {
    Log.e(LOG_TAG,"RenderScript.create() called when disabled; someone is likely to crash");
    return null;
  }
  if ((flags & ~(CREATE_FLAG_LOW_LATENCY | CREATE_FLAG_LOW_POWER | CREATE_FLAG_WAIT_FOR_ATTACH)) != 0) {
    throw new RSIllegalArgumentException("Invalid flags passed.");
  }
  RenderScript rs=new RenderScript(ctx);
  rs.mDev=rs.nDeviceCreate();
  rs.mContext=rs.nContextCreate(rs.mDev,flags,sdkVersion,ct.mID);
  rs.mContextType=ct;
  rs.mContextFlags=flags;
  rs.mContextSdkVersion=sdkVersion;
  if (rs.mContext == 0) {
    throw new RSDriverException("Failed to create RS context.");
  }
  final String CACHE_PATH="com.android.renderscript.cache";
  File f=new File(RenderScriptCacheDir.mCacheDir,CACHE_PATH);
  String mCachePath=f.getAbsolutePath();
  f.mkdirs();
  rs.nContextSetCacheDir(mCachePath);
  rs.mMessageThread=new MessageThread(rs);
  rs.mMessageThread.start();
  return rs;
}
