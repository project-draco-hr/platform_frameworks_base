{
  long completedFrameNumber=mFrameNumberTracker.getCompletedFrameNumber();
  Iterator<SimpleEntry<Long,Integer>> iter=mFrameNumberRequestPairs.iterator();
  while (iter.hasNext()) {
    final SimpleEntry<Long,Integer> frameNumberRequestPair=iter.next();
    if (frameNumberRequestPair.getKey() <= completedFrameNumber) {
      final int requestId=frameNumberRequestPair.getValue();
      final CaptureListenerHolder holder;
synchronized (mLock) {
        int index=CameraDevice.this.mCaptureListenerMap.indexOfKey(requestId);
        holder=(index >= 0) ? CameraDevice.this.mCaptureListenerMap.valueAt(index) : null;
        if (holder != null) {
          CameraDevice.this.mCaptureListenerMap.removeAt(index);
        }
      }
      iter.remove();
      if (holder != null) {
        Runnable resultDispatch=new Runnable(){
          @Override public void run(){
            if (!CameraDevice.this.isClosed()) {
              if (DEBUG) {
                Log.d(TAG,String.format("fire sequence complete for request %d",requestId));
              }
              holder.getListener().onCaptureSequenceCompleted(CameraDevice.this,requestId,frameNumberRequestPair.getKey().intValue());
            }
          }
        }
;
        holder.getHandler().post(resultDispatch);
      }
    }
  }
}
