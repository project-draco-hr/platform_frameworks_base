{
  if (lastFrameNumber == CaptureListener.NO_FRAMES_CAPTURED) {
    final CaptureListenerHolder holder;
    int index=mCaptureListenerMap.indexOfKey(requestId);
    holder=(index >= 0) ? mCaptureListenerMap.valueAt(index) : null;
    if (holder != null) {
      mCaptureListenerMap.removeAt(index);
      if (DEBUG) {
        Log.v(TAG,String.format("remove holder for requestId %d, " + "because lastFrame is %d.",requestId,lastFrameNumber));
      }
    }
    if (holder != null) {
      if (DEBUG) {
        Log.v(TAG,"immediately trigger onCaptureSequenceCompleted because" + " request did not reach HAL");
      }
      Runnable resultDispatch=new Runnable(){
        @Override public void run(){
          if (!CameraDevice.this.isClosed()) {
            if (DEBUG) {
              Log.d(TAG,String.format("early trigger sequence complete for request %d",requestId));
            }
            if (lastFrameNumber < Integer.MIN_VALUE || lastFrameNumber > Integer.MAX_VALUE) {
              throw new AssertionError(lastFrameNumber + " cannot be cast to int");
            }
            holder.getListener().onCaptureSequenceCompleted(CameraDevice.this,requestId,(int)lastFrameNumber);
          }
        }
      }
;
      holder.getHandler().post(resultDispatch);
    }
 else {
      Log.w(TAG,String.format("did not register listener to request %d",requestId));
    }
  }
 else {
    mFrameNumberRequestPairs.add(new SimpleEntry<Long,Integer>(lastFrameNumber,requestId));
  }
}
