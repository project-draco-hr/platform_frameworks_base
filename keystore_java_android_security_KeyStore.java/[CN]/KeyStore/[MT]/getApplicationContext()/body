{
  ActivityThread activityThread=ActivityThread.currentActivityThread();
  if (activityThread == null) {
    throw new IllegalStateException("Failed to obtain application Context: no ActivityThread");
  }
  Application application=activityThread.getApplication();
  if (application == null) {
    throw new IllegalStateException("Failed to obtain application Context: no Application");
  }
  return application;
}
