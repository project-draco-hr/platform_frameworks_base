{
  rs.validate();
  int height=b.getHeight();
  int width=b.getWidth();
  if (layout != CubemapLayout.VERTICAL_FACE_LIST) {
    throw new RSIllegalArgumentException("Only vertical face list supported");
  }
  if (height % 6 != 0) {
    throw new RSIllegalArgumentException("Cubemap height must be multiple of 6");
  }
  if (height / 6 != width) {
    throw new RSIllegalArgumentException("Only square cobe map faces supported");
  }
  boolean isPow2=(width & (width - 1)) == 0;
  if (!isPow2) {
    throw new RSIllegalArgumentException("Only power of 2 cube faces supported");
  }
  Element e=elementFromBitmap(rs,b);
  Type.Builder tb=new Type.Builder(rs,e);
  tb.add(Dimension.X,width);
  tb.add(Dimension.Y,width);
  tb.add(Dimension.FACE,1);
  if (genMips) {
    tb.add(Dimension.LOD,1);
  }
  Type t=tb.create();
  int id=rs.nAllocationCubeCreateFromBitmap(dstFmt.getID(),genMips,b);
  if (id == 0) {
    throw new RSRuntimeException("Load failed for bitmap " + b + " element "+ e);
  }
  return new Allocation(id,rs,t);
}
