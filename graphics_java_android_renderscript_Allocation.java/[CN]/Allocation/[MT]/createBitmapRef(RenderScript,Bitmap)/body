{
  rs.validate();
  Type t=typeFromBitmap(rs,b,false);
  int id=rs.nAllocationCreateBitmapRef(t.getID(),b);
  if (id == 0) {
    throw new RSRuntimeException("Load failed.");
  }
  Allocation a=new Allocation(id,rs,t);
  a.mBitmap=b;
  return a;
}
