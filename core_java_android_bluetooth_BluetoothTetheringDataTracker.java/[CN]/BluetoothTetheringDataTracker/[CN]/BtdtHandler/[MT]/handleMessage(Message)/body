{
switch (msg.what) {
case AsyncChannel.CMD_CHANNEL_HALF_CONNECTED:
    if (VDBG)     Log.d(TAG,"got CMD_CHANNEL_HALF_CONNECTED");
  if (msg.arg1 == AsyncChannel.STATUS_SUCCESSFUL) {
    AsyncChannel ac=(AsyncChannel)msg.obj;
    if (mBtdt.mAsyncChannel.compareAndSet(null,ac) == false) {
      Log.e(TAG,"Trying to set mAsyncChannel twice!");
    }
 else {
      ac.sendMessage(AsyncChannel.CMD_CHANNEL_FULL_CONNECTION);
    }
  }
break;
case AsyncChannel.CMD_CHANNEL_DISCONNECTED:
if (VDBG) Log.d(TAG,"got CMD_CHANNEL_DISCONNECTED");
mBtdt.stopReverseTether();
mBtdt.mAsyncChannel.set(null);
break;
case NetworkStateTracker.EVENT_NETWORK_CONNECTED:
LinkProperties linkProperties=(LinkProperties)(msg.obj);
if (VDBG) Log.d(TAG,"got EVENT_NETWORK_CONNECTED, " + linkProperties);
mBtdt.startReverseTether(linkProperties);
break;
case NetworkStateTracker.EVENT_NETWORK_DISCONNECTED:
linkProperties=(LinkProperties)(msg.obj);
if (VDBG) Log.d(TAG,"got EVENT_NETWORK_DISCONNECTED, " + linkProperties);
mBtdt.stopReverseTether();
break;
case EVENT_NETWORK_FAILED:
if (VDBG) Log.d(TAG,"got EVENT_NETWORK_FAILED");
mBtdt.teardown();
break;
}
}
