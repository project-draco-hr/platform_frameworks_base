{
  super.setUp();
  log("before we launch the test activity, we preserve all the configured networks.");
  mRunner=((ConnectivityManagerTestRunner)getInstrumentation());
  mWifiManager=(WifiManager)mRunner.getContext().getSystemService(Context.WIFI_SERVICE);
  enabledNetworks=getEnabledNetworks(mWifiManager.getConfiguredNetworks());
  mAct=getActivity();
  mWifiManager.asyncConnect(mAct,new WifiServiceHandler());
  networks=mAct.loadNetworkConfigurations();
  if (DEBUG) {
    printNetworkConfigurations();
  }
  assertTrue("enable Wifi failed",mAct.enableWifi());
  sleep(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT,"interrupted while waiting for WPA_SUPPLICANT to start");
  WifiInfo mConnection=mAct.mWifiManager.getConnectionInfo();
  assertNotNull(mConnection);
  assertTrue("wpa_supplicant is not started ",mAct.mWifiManager.pingSupplicant());
}
