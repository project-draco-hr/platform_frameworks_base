{
  boolean isStaticIP=false;
  if (hm.containsKey(config.SSID)) {
    DhcpInfo dhcpInfo=hm.get(config.SSID);
    if (dhcpInfo != null) {
      isStaticIP=true;
      Settings.System.putInt(cr,Settings.System.WIFI_USE_STATIC_IP,1);
      Settings.System.putString(cr,Settings.System.WIFI_STATIC_IP,intToIpString(dhcpInfo.ipAddress));
      Settings.System.putString(cr,Settings.System.WIFI_STATIC_GATEWAY,intToIpString(dhcpInfo.gateway));
      Settings.System.putString(cr,Settings.System.WIFI_STATIC_NETMASK,intToIpString(dhcpInfo.netmask));
      Settings.System.putString(cr,Settings.System.WIFI_STATIC_DNS1,intToIpString(dhcpInfo.dns1));
      Settings.System.putString(cr,Settings.System.WIFI_STATIC_DNS2,intToIpString(dhcpInfo.dns2));
    }
  }
  assertTrue("failed to connect to " + config.SSID,mAct.connectToWifiWithConfiguration(config));
  assertTrue(mAct.waitForWifiState(WifiManager.WIFI_STATE_ENABLED,ConnectivityManagerTestActivity.SHORT_TIMEOUT));
  assertTrue(mAct.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,2 * ConnectivityManagerTestActivity.LONG_TIMEOUT));
  assertNotNull("Wifi connection returns null",mAct.mWifiManager.getConnectionInfo());
  if (DEBUG) {
    log("config.SSID = " + config.SSID);
    log("mAct.mWifiManager.getConnectionInfo.getSSID()" + mAct.mWifiManager.getConnectionInfo().getSSID());
  }
  assertTrue(config.SSID.contains(mAct.mWifiManager.getConnectionInfo().getSSID()));
  if (isStaticIP) {
    Settings.System.putInt(cr,Settings.System.WIFI_USE_STATIC_IP,0);
    Settings.System.putString(cr,Settings.System.WIFI_STATIC_IP,"");
    Settings.System.putString(cr,Settings.System.WIFI_STATIC_GATEWAY,"");
    Settings.System.putString(cr,Settings.System.WIFI_STATIC_NETMASK,"");
    Settings.System.putString(cr,Settings.System.WIFI_STATIC_DNS1,"");
    Settings.System.putString(cr,Settings.System.WIFI_STATIC_DNS2,"");
  }
}
