{
  if (uid == android.os.Process.SYSTEM_UID) {
    uid=UserHandle.getUid(userId,UserHandle.getAppId(uid));
  }
  if (mAppOps.noteOp(AppOpsManager.OP_AUDIO_MASTER_VOLUME,uid,callingPackage) != AppOpsManager.MODE_ALLOWED) {
    return;
  }
  if (userId != UserHandle.getCallingUserId() && mContext.checkCallingOrSelfPermission(android.Manifest.permission.INTERACT_ACROSS_USERS_FULL) != PackageManager.PERMISSION_GRANTED) {
    return;
  }
  if (getCurrentUserId() == userId) {
    if (mute != AudioSystem.getMasterMute()) {
      setSystemAudioMute(mute);
      AudioSystem.setMasterMute(mute);
      sendMsg(mAudioHandler,MSG_PERSIST_MASTER_VOLUME_MUTE,SENDMSG_REPLACE,mute ? 1 : 0,userId,null,PERSIST_DELAY);
      sendMasterMuteUpdate(mute,flags);
      Intent intent=new Intent(AudioManager.MASTER_MUTE_CHANGED_ACTION);
      intent.putExtra(AudioManager.EXTRA_MASTER_VOLUME_MUTED,mute);
      sendBroadcastToAll(intent);
    }
  }
 else {
    sendMsg(mAudioHandler,MSG_PERSIST_MASTER_VOLUME_MUTE,SENDMSG_REPLACE,mute ? 1 : 0,userId,null,PERSIST_DELAY);
  }
}
