{
  final ContentResolver cr=mContentResolver;
  int ringerModeFromSettings=Settings.Global.getInt(cr,Settings.Global.MODE_RINGER,AudioManager.RINGER_MODE_NORMAL);
  int ringerMode=ringerModeFromSettings;
  if (!isValidRingerMode(ringerMode)) {
    ringerMode=AudioManager.RINGER_MODE_NORMAL;
  }
  if ((ringerMode == AudioManager.RINGER_MODE_VIBRATE) && !mHasVibrator) {
    ringerMode=AudioManager.RINGER_MODE_SILENT;
  }
  if (ringerMode != ringerModeFromSettings) {
    Settings.Global.putInt(cr,Settings.Global.MODE_RINGER,ringerMode);
  }
  if (mUseFixedVolume || isPlatformTelevision()) {
    ringerMode=AudioManager.RINGER_MODE_NORMAL;
  }
synchronized (mSettingsLock) {
    mRingerMode=ringerMode;
    if (mRingerModeExternal == -1) {
      mRingerModeExternal=mRingerMode;
    }
    mVibrateSetting=AudioSystem.getValueForVibrateSetting(0,AudioManager.VIBRATE_TYPE_NOTIFICATION,mHasVibrator ? AudioManager.VIBRATE_SETTING_ONLY_SILENT : AudioManager.VIBRATE_SETTING_OFF);
    mVibrateSetting=AudioSystem.getValueForVibrateSetting(mVibrateSetting,AudioManager.VIBRATE_TYPE_RINGER,mHasVibrator ? AudioManager.VIBRATE_SETTING_ONLY_SILENT : AudioManager.VIBRATE_SETTING_OFF);
    updateRingerModeAffectedStreams();
    readDockAudioSettings(cr);
  }
  mMuteAffectedStreams=System.getIntForUser(cr,System.MUTE_STREAMS_AFFECTED,AudioSystem.DEFAULT_MUTE_STREAMS_AFFECTED,UserHandle.USER_CURRENT);
  final int currentUser=getCurrentUserId();
  boolean masterMute=(System.getIntForUser(cr,System.VOLUME_MASTER_MUTE,0,UserHandle.USER_CURRENT) == 1) || mUserManagerInternal.getUserRestriction(currentUser,UserManager.DISALLOW_ADJUST_VOLUME);
  if (mUseFixedVolume) {
    masterMute=false;
    AudioSystem.setMasterVolume(1.0f);
  }
  if (DEBUG_VOL) {
    Log.d(TAG,String.format("Master mute %s, user=%d",masterMute,currentUser));
  }
  setSystemAudioMute(masterMute);
  AudioSystem.setMasterMute(masterMute);
  broadcastMasterMuteStatus(masterMute);
  boolean microphoneMute=(System.getIntForUser(cr,System.MICROPHONE_MUTE,0,UserHandle.USER_CURRENT) == 1) || mUserManagerInternal.getUserRestriction(currentUser,UserManager.DISALLOW_UNMUTE_MICROPHONE);
  if (DEBUG_VOL) {
    Log.d(TAG,String.format("Mic mute %s, user=%d",microphoneMute,currentUser));
  }
  AudioSystem.muteMicrophone(microphoneMute);
  updateMasterMono(cr);
  broadcastRingerMode(AudioManager.RINGER_MODE_CHANGED_ACTION,mRingerModeExternal);
  broadcastRingerMode(AudioManager.INTERNAL_RINGER_MODE_CHANGED_ACTION,mRingerMode);
  broadcastVibrateSetting(AudioManager.VIBRATE_TYPE_RINGER);
  broadcastVibrateSetting(AudioManager.VIBRATE_TYPE_NOTIFICATION);
  mVolumeController.loadSettings(cr);
}
