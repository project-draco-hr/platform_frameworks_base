{
  if (DEBUG_MODE) {
    Log.v(TAG,"setMode(mode=" + mode + ")");
  }
  if (!checkAudioSettingsPermission("setMode()")) {
    return;
  }
  if ((mode == AudioSystem.MODE_IN_CALL) && (mContext.checkCallingOrSelfPermission(android.Manifest.permission.MODIFY_PHONE_STATE) != PackageManager.PERMISSION_GRANTED)) {
    Log.w(TAG,"MODIFY_PHONE_STATE Permission Denial: setMode(MODE_IN_CALL) from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid());
    return;
  }
  if (mode < AudioSystem.MODE_CURRENT || mode >= AudioSystem.NUM_MODES) {
    return;
  }
  int newModeOwnerPid=0;
synchronized (mSetModeDeathHandlers) {
    if (mode == AudioSystem.MODE_CURRENT) {
      mode=mMode;
    }
    newModeOwnerPid=setModeInt(mode,cb,Binder.getCallingPid());
  }
  if (newModeOwnerPid != 0) {
    disconnectBluetoothSco(newModeOwnerPid);
  }
}
