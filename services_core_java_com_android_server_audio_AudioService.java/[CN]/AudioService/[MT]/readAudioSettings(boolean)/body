{
  readPersistedSettings();
  readUserRestrictions();
  int numStreamTypes=AudioSystem.getNumStreamTypes();
  for (int streamType=0; streamType < numStreamTypes; streamType++) {
    VolumeStreamState streamState=mStreamStates[streamType];
    if (userSwitch && mStreamVolumeAlias[streamType] == AudioSystem.STREAM_MUSIC) {
      continue;
    }
    streamState.readSettings();
synchronized (VolumeStreamState.class) {
      if (streamState.mIsMuted && ((!isStreamAffectedByMute(streamType) && !isStreamMutedByRingerMode(streamType)) || mUseFixedVolume)) {
        streamState.mIsMuted=false;
      }
    }
  }
  setRingerModeInt(getRingerModeInternal(),false);
  checkAllFixedVolumeDevices();
  checkAllAliasStreamVolumes();
  checkMuteAffectedStreams();
synchronized (mSafeMediaVolumeState) {
    mMusicActiveMs=MathUtils.constrain(Settings.Secure.getIntForUser(mContentResolver,Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS,0,UserHandle.USER_CURRENT),0,UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX);
    if (mSafeMediaVolumeState == SAFE_MEDIA_VOLUME_ACTIVE) {
      enforceSafeMediaVolume(TAG);
    }
  }
}
