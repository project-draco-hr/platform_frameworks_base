{
  intent.setAction(AudioManager.ACTION_HDMI_AUDIO_PLUG);
  intent.putExtra(AudioManager.EXTRA_AUDIO_PLUG_STATE,state);
  if (state == 1) {
    ArrayList<AudioPort> ports=new ArrayList<AudioPort>();
    int[] portGeneration=new int[1];
    int status=AudioSystem.listAudioPorts(ports,portGeneration);
    if (status == AudioManager.SUCCESS) {
      for (      AudioPort port : ports) {
        if (port instanceof AudioDevicePort) {
          final AudioDevicePort devicePort=(AudioDevicePort)port;
          if (devicePort.type() == AudioManager.DEVICE_OUT_HDMI || devicePort.type() == AudioManager.DEVICE_OUT_HDMI_ARC) {
            int[] formats=AudioFormat.filterPublicFormats(devicePort.formats());
            if (formats.length > 0) {
              ArrayList<Integer> encodingList=new ArrayList(1);
              for (              int format : formats) {
                if (format != AudioFormat.ENCODING_INVALID) {
                  encodingList.add(format);
                }
              }
              int[] encodingArray=new int[encodingList.size()];
              for (int i=0; i < encodingArray.length; i++) {
                encodingArray[i]=encodingList.get(i);
              }
              intent.putExtra(AudioManager.EXTRA_ENCODINGS,encodingArray);
            }
            int maxChannels=0;
            for (            int mask : devicePort.channelMasks()) {
              int channelCount=AudioFormat.channelCountFromOutChannelMask(mask);
              if (channelCount > maxChannels) {
                maxChannels=channelCount;
              }
            }
            intent.putExtra(AudioManager.EXTRA_MAX_CHANNEL_COUNT,maxChannels);
          }
        }
      }
    }
  }
}
