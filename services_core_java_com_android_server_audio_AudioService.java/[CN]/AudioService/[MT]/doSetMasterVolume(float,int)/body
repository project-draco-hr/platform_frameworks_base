{
  if (!AudioSystem.getMasterMute()) {
    int oldVolume=getMasterVolume();
    AudioSystem.setMasterVolume(volume);
    int newVolume=getMasterVolume();
    if (newVolume != oldVolume) {
      sendMsg(mAudioHandler,MSG_PERSIST_MASTER_VOLUME,SENDMSG_REPLACE,Math.round(volume * (float)1000.0),0,null,PERSIST_DELAY);
      setSystemAudioVolume(oldVolume,newVolume,getMasterMaxVolume(),flags);
    }
    sendMasterVolumeUpdate(flags,oldVolume,newVolume);
  }
}
