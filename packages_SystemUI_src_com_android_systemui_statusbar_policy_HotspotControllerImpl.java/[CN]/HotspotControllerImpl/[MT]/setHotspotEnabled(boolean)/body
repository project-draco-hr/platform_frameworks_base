{
  final ContentResolver cr=mContext.getContentResolver();
  if (enabled) {
    if (isProvisioningNeeded()) {
      String tetherEnable=mContext.getResources().getString(com.android.internal.R.string.config_wifi_tether_enable);
      Intent intent=new Intent();
      intent.putExtra(EXTRA_ADD_TETHER_TYPE,WIFI_TETHERING);
      intent.putExtra(EXTRA_SET_ALARM,true);
      intent.putExtra(EXTRA_RUN_PROVISION,true);
      intent.putExtra(EXTRA_ENABLE_WIFI_TETHER,true);
      intent.setComponent(ComponentName.unflattenFromString(tetherEnable));
      mContext.startServiceAsUser(intent,UserHandle.CURRENT);
    }
 else {
      int wifiState=mWifiManager.getWifiState();
      if ((wifiState == WifiManager.WIFI_STATE_ENABLING) || (wifiState == WifiManager.WIFI_STATE_ENABLED)) {
        mWifiManager.setWifiEnabled(false);
        Settings.Global.putInt(cr,Settings.Global.WIFI_SAVED_STATE,1);
      }
      mWifiManager.setWifiApEnabled(null,true);
    }
  }
 else {
    mWifiManager.setWifiApEnabled(null,false);
    if (Settings.Global.getInt(cr,Settings.Global.WIFI_SAVED_STATE,0) == 1) {
      mWifiManager.setWifiEnabled(true);
      Settings.Global.putInt(cr,Settings.Global.WIFI_SAVED_STATE,0);
    }
  }
}
