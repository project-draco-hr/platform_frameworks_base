{
  NfcAdapter.CreateNdefMessageCallback ndefCallback;
  NfcAdapter.CreateBeamUrisCallback urisCallback;
  NdefMessage message;
  Activity activity;
  Uri[] uris;
  int flags;
synchronized (NfcActivityManager.this) {
    NfcActivityState state=findResumedActivityState();
    if (state == null)     return null;
    ndefCallback=state.ndefMessageCallback;
    urisCallback=state.uriCallback;
    message=state.ndefMessage;
    uris=state.uris;
    flags=state.flags;
    activity=state.activity;
  }
  if (ndefCallback != null) {
    message=ndefCallback.createNdefMessage(mDefaultEvent);
  }
  if (urisCallback != null) {
    uris=urisCallback.createBeamUris(mDefaultEvent);
    if (uris != null) {
      for (      Uri uri : uris) {
        if (uri == null) {
          Log.e(TAG,"Uri not allowed to be null.");
          return null;
        }
        String scheme=uri.getScheme();
        if (scheme == null || (!scheme.equalsIgnoreCase("file") && !scheme.equalsIgnoreCase("content"))) {
          Log.e(TAG,"Uri needs to have " + "either scheme file or scheme content");
          return null;
        }
      }
    }
  }
  if (uris != null && uris.length > 0) {
    for (    Uri uri : uris) {
      activity.grantUriPermission("com.android.nfc",uri,Intent.FLAG_GRANT_READ_URI_PERMISSION);
    }
  }
  return new BeamShareData(message,uris,flags);
}
