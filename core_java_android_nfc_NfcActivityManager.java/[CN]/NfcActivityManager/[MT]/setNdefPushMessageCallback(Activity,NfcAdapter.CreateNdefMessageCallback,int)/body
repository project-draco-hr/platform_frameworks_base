{
  boolean isResumed;
synchronized (NfcActivityManager.this) {
    NfcActivityState state=getActivityState(activity);
    state.ndefMessageCallback=callback;
    state.flags=flags;
    isResumed=state.resumed;
  }
  if (isResumed) {
    requestNfcServiceCallback();
  }
 else {
    verifyNfcPermission();
  }
}
