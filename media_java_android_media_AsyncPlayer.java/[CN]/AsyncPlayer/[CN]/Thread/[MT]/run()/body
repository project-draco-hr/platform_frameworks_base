{
  while (true) {
    Command cmd=null;
synchronized (mLock) {
      if (mHead != null) {
        cmd=mHead;
        mHead=cmd.next;
        if (mTail == cmd) {
          mTail=null;
        }
      }
    }
switch (cmd.code) {
case PLAY:
      try {
        MediaPlayer player=new MediaPlayer();
        player.setDataSource(cmd.context,cmd.uri);
        player.setAudioStreamType(cmd.stream);
        player.setLooping(cmd.looping);
        player.prepare();
        if (mPlayer != null) {
          mPlayer.stop();
          mPlayer.release();
        }
        player.start();
        mPlayer=player;
      }
 catch (      IOException e) {
        Log.w(mTag,"error loading sound for " + cmd.uri,e);
      }
    break;
case STOP:
  if (mPlayer != null) {
    mPlayer.stop();
    mPlayer.release();
    mPlayer=null;
  }
 else {
    Log.w(mTag,"STOP command without a player");
  }
break;
}
synchronized (mLock) {
if (mHead == null) {
mThread=null;
releaseWakeLock();
return;
}
}
}
}
