{
  String processName=getProcessName(packageName);
  List<RunningAppProcessInfo> runningApps=mActivityManager.getRunningAppProcesses();
  List<RunningAppProcessInfo> relatedProcs=new ArrayList<>();
  for (  RunningAppProcessInfo app : runningApps) {
    if (app.processName.equalsIgnoreCase(processName)) {
      if (!ensureForegroundActivity(app)) {
        Log.w(TAG,"Found process but it's not top activity.");
        return false;
      }
      return true;
    }
    for (    String relatedPackage : app.pkgList) {
      if (relatedPackage.equalsIgnoreCase(packageName)) {
        relatedProcs.add(app);
      }
    }
  }
  if (!relatedProcs.isEmpty()) {
    for (    RunningAppProcessInfo app : relatedProcs) {
      if (ensureForegroundActivity(app)) {
        return true;
      }
    }
    Log.w(TAG,"Found related processes, but none has top activity.");
  }
  Log.w(TAG,"Failed to find process " + processName + " with package name "+ packageName);
  return false;
}
