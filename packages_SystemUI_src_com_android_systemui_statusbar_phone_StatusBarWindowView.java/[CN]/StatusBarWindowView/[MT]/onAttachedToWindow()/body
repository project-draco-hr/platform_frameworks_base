{
  super.onAttachedToWindow();
  final ViewRootImpl root=getViewRootImpl();
  if (root != null) {
    root.setDrawDuringWindowsAnimating(true);
  }
  if (mService.isScrimSrcModeEnabled()) {
    IBinder windowToken=getWindowToken();
    WindowManager.LayoutParams lp=(WindowManager.LayoutParams)getLayoutParams();
    lp.token=windowToken;
    setLayoutParams(lp);
    WindowManagerGlobal.getInstance().changeCanvasOpacity(windowToken,true);
    setWillNotDraw(false);
  }
 else {
    setWillNotDraw(!DEBUG);
  }
}
