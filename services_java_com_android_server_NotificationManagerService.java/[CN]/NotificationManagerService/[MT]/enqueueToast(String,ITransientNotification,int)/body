{
  Slog.i(TAG,"enqueueToast pkg=" + pkg + " callback="+ callback+ " duration="+ duration);
  if (pkg == null || callback == null) {
    Slog.e(TAG,"Not doing toast. pkg=" + pkg + " callback="+ callback);
    return;
  }
synchronized (mToastQueue) {
    int callingPid=Binder.getCallingPid();
    long callingId=Binder.clearCallingIdentity();
    try {
      ToastRecord record;
      int index=indexOfToastLocked(pkg,callback);
      if (index >= 0) {
        record=mToastQueue.get(index);
        record.update(duration);
      }
 else {
        record=new ToastRecord(callingPid,pkg,callback,duration);
        mToastQueue.add(record);
        index=mToastQueue.size() - 1;
        keepProcessAliveLocked(callingPid);
      }
      if (index == 0) {
        showNextToastLocked();
      }
    }
  finally {
      Binder.restoreCallingIdentity(callingId);
    }
  }
}
