{
  super();
  mContext=context;
  mLightsService=lights;
  mAm=ActivityManagerNative.getDefault();
  mSound=new NotificationPlayer(TAG);
  mSound.setUsesWakeLock(context);
  mToastQueue=new ArrayList<ToastRecord>();
  mHandler=new WorkerHandler();
  mStatusBar=statusBar;
  statusBar.setNotificationCallbacks(mNotificationCallbacks);
  mBatteryLight=lights.getLight(LightsService.LIGHT_ID_BATTERY);
  mNotificationLight=lights.getLight(LightsService.LIGHT_ID_NOTIFICATIONS);
  mAttentionLight=lights.getLight(LightsService.LIGHT_ID_ATTENTION);
  Resources resources=mContext.getResources();
  mDefaultNotificationColor=resources.getColor(com.android.internal.R.color.config_defaultNotificationColor);
  mDefaultNotificationLedOn=resources.getInteger(com.android.internal.R.integer.config_defaultNotificationLedOn);
  mDefaultNotificationLedOff=resources.getInteger(com.android.internal.R.integer.config_defaultNotificationLedOff);
  if (0 == Settings.Secure.getInt(mContext.getContentResolver(),Settings.Secure.DEVICE_PROVISIONED,0)) {
    mDisabledNotifications=StatusBarManager.DISABLE_NOTIFICATION_ALERTS;
  }
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_BATTERY_CHANGED);
  filter.addAction(UsbManager.ACTION_USB_STATE);
  filter.addAction(Intent.ACTION_SCREEN_ON);
  filter.addAction(Intent.ACTION_SCREEN_OFF);
  filter.addAction(TelephonyManager.ACTION_PHONE_STATE_CHANGED);
  mContext.registerReceiver(mIntentReceiver,filter);
  IntentFilter pkgFilter=new IntentFilter();
  pkgFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  pkgFilter.addAction(Intent.ACTION_PACKAGE_RESTARTED);
  pkgFilter.addAction(Intent.ACTION_QUERY_PACKAGE_RESTART);
  pkgFilter.addDataScheme("package");
  mContext.registerReceiver(mIntentReceiver,pkgFilter);
  IntentFilter sdFilter=new IntentFilter(Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE);
  mContext.registerReceiver(mIntentReceiver,sdFilter);
  SettingsObserver observer=new SettingsObserver(mHandler);
  observer.observe();
}
