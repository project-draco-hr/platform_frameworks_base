{
  BufferedImage shadow;
  Rect clipBounds=canvas.getClipBounds();
  if (clipBounds.isEmpty()) {
    return null;
  }
  float height=child.getZ() - parent.getZ();
  float largeShadowThreshold=TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,10f,getMetrics(child));
  boolean largeShadow=height > largeShadowThreshold;
  int shadowSize=largeShadow ? ShadowPainter.SHADOW_SIZE : ShadowPainter.SMALL_SHADOW_SIZE;
  shadow=new BufferedImage(clipBounds.width() + shadowSize,clipBounds.height(),BufferedImage.TYPE_INT_ARGB);
  Graphics2D graphics=shadow.createGraphics();
  Rect rect=outline.mRect;
  if (largeShadow) {
    ShadowPainter.drawRectangleShadow(graphics,rect.left + shadowSize,rect.top,rect.width(),rect.height());
  }
 else {
    ShadowPainter.drawSmallRectangleShadow(graphics,rect.left + shadowSize,rect.top,rect.width(),rect.height());
  }
  graphics.dispose();
  return new Shadow(shadow,shadowSize);
}
