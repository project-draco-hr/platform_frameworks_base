{
  mtpManager.setDocument(0,1,new MtpDocument(1,0,"",new Date(),0,0,false));
  final ParcelFileDescriptor descriptor=mPipeManager.writeDocument(getContext(),mtpManager,new Identifier(0,0,1));
  final ParcelFileDescriptor.AutoCloseOutputStream outputStream=new ParcelFileDescriptor.AutoCloseOutputStream(descriptor);
  outputStream.write(HELLO_BYTES,0,HELLO_BYTES.length);
  outputStream.close();
  mExecutor.awaitTermination(1000,TimeUnit.MILLISECONDS);
  try {
    final MtpDocument placeholderDocument=mtpManager.getDocument(0,1);
    fail();
  }
 catch (  IOException e) {
  }
  final MtpDocument targetDocument=mtpManager.getDocument(0,TestMtpManager.CREATED_DOCUMENT_HANDLE);
  assertTrue(targetDocument != null);
  final byte[] uploadedBytes=mtpManager.getImportFileBytes(0,TestMtpManager.CREATED_DOCUMENT_HANDLE);
  assertEquals(HELLO_BYTES.length,uploadedBytes.length);
  for (int i=0; i < HELLO_BYTES.length; i++) {
    assertEquals(HELLO_BYTES[i],uploadedBytes[i]);
  }
}
