{
  boolean closeCamera=false;
  if (mCameraParameters == null) {
    if (mCamera == null) {
      mCamera=Camera.open(mCameraId);
      closeCamera=true;
    }
    mCameraParameters=mCamera.getParameters();
    if (closeCamera) {
      mCamera.release();
      mCamera=null;
    }
  }
  int closestSize[]=findClosestSize(mWidth,mHeight,mCameraParameters);
  mWidth=closestSize[0];
  mHeight=closestSize[1];
  mCameraParameters.setPreviewSize(mWidth,mHeight);
  int closestRange[]=findClosestFpsRange(mFps,mCameraParameters);
  mCameraParameters.setPreviewFpsRange(closestRange[Camera.Parameters.PREVIEW_FPS_MIN_INDEX],closestRange[Camera.Parameters.PREVIEW_FPS_MAX_INDEX]);
  return mCameraParameters;
}
