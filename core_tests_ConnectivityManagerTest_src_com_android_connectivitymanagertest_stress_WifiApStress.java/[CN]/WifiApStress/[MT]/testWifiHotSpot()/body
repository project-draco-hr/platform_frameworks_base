{
  if (mWifiOnlyFlag) {
    Log.v(TAG,this.getName() + " is excluded for wi-fi only test");
    return;
  }
  WifiConfiguration config=new WifiConfiguration();
  config.SSID=NETWORK_ID;
  config.allowedKeyManagement.set(KeyMgmt.WPA_PSK);
  config.allowedAuthAlgorithms.set(AuthAlgorithm.OPEN);
  config.preSharedKey=PASSWD;
  if (mWifiManager.isWifiEnabled()) {
    disableWifi();
  }
  int i;
  for (i=0; i < iterations; i++) {
    Log.v(TAG,"iteration: " + i);
    mLastIteration=i;
    assertTrue(mWifiManager.setWifiApEnabled(config,true));
    assertTrue(waitForWifiAPState(WifiManager.WIFI_AP_STATE_ENABLED,2 * LONG_TIMEOUT));
    assertEquals(SUCCESS,waitForTetherStateChange(2 * SHORT_TIMEOUT));
    try {
      Thread.sleep(2 * SHORT_TIMEOUT);
    }
 catch (    Exception e) {
      fail("thread in sleep is interrupted");
    }
    assertTrue("no uplink data connection after Wi-Fi tethering",pingTest(null));
    assertTrue(mWifiManager.setWifiApEnabled(config,false));
    try {
      Thread.sleep(30 * 1000);
      Log.v(TAG,"wait for Wi-Fi tethering to be disabled.");
    }
 catch (    Exception e) {
      fail("thread in sleep is interrupted");
    }
    assertFalse("Wi-Fi AP disable failed",mWifiManager.isWifiApEnabled());
  }
  if (i == iterations) {
    mLastIteration=iterations;
  }
}
