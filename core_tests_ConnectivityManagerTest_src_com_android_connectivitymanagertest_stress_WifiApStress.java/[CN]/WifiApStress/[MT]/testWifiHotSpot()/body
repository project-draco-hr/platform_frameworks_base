{
  WifiConfiguration config=new WifiConfiguration();
  config.SSID=NETWORK_ID;
  config.allowedKeyManagement.set(KeyMgmt.WPA_PSK);
  config.allowedAuthAlgorithms.set(AuthAlgorithm.OPEN);
  config.preSharedKey=PASSWD;
  if (mAct.mWifiManager.isWifiEnabled()) {
    mAct.disableWifi();
  }
  int i;
  for (i=0; i < iterations; i++) {
    Log.v(TAG,"iteration: " + i);
    mLastIteration=i;
    assertTrue(mAct.mWifiManager.setWifiApEnabled(config,true));
    assertTrue(mAct.waitForWifiAPState(WifiManager.WIFI_AP_STATE_ENABLED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
    assertEquals(ConnectivityManagerTestActivity.SUCCESS,mAct.waitForTetherStateChange(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT));
    try {
      Thread.sleep(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT);
    }
 catch (    Exception e) {
      fail("thread in sleep is interrupted");
    }
    assertTrue(mAct.mWifiManager.setWifiApEnabled(config,false));
  }
  if (i == iterations) {
    mLastIteration=iterations;
  }
}
