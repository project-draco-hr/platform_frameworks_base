{
  WifiConfiguration config=new WifiConfiguration();
  config.SSID=NETWORK_ID;
  config.allowedKeyManagement.set(KeyMgmt.WPA_PSK);
  config.allowedAuthAlgorithms.set(AuthAlgorithm.OPEN);
  config.preSharedKey=PASSWD;
  if (mAct.mWifiManager.isWifiEnabled()) {
    mAct.disableWifi();
  }
  for (int i=0; i < max_num; i++) {
    Log.v(TAG,"iteration: " + i);
    assertTrue(mAct.mWifiManager.setWifiApEnabled(config,true));
    assertTrue(mAct.waitForWifiAPState(mAct.mWifiManager.WIFI_AP_STATE_ENABLED,mAct.LONG_TIMEOUT));
    assertEquals(mAct.SUCCESS,mAct.waitForTetherStateChange(2 * mAct.SHORT_TIMEOUT));
    try {
      Thread.sleep(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT);
    }
 catch (    Exception e) {
      fail("thread in sleep is interrupted");
    }
    assertTrue(mAct.mWifiManager.setWifiApEnabled(config,false));
  }
}
