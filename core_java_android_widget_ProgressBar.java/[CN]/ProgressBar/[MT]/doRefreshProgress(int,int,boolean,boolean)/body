{
  float scale=mMax > 0 ? (float)progress / (float)mMax : 0;
  final Drawable d=mCurrentDrawable.getCurrent();
  if (d != null) {
    Drawable progressDrawable=null;
    if (d instanceof LayerDrawable) {
      progressDrawable=((LayerDrawable)d).findDrawableByLayerId(id);
      if (progressDrawable != null && canResolveLayoutDirection()) {
        progressDrawable.setLayoutDirection(getLayoutDirection());
      }
    }
    final int level=(int)(scale * MAX_LEVEL);
    (progressDrawable != null ? progressDrawable : d).setLevel(level);
  }
 else {
    invalidate();
  }
  if (callBackToApp && id == R.id.progress) {
    onProgressRefresh(scale,fromUser);
  }
}
