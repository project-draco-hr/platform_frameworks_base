{
  mStackSupervisor.reportActivityVisibleLocked(this);
  if (DEBUG_SWITCH)   Log.v(TAG,"windowsVisibleLocked(): " + this);
  if (!nowVisible) {
    nowVisible=true;
    lastVisibleTime=SystemClock.uptimeMillis();
    if (!idle) {
      mStackSupervisor.processStoppingActivitiesLocked(false);
    }
 else {
      final int size=mStackSupervisor.mWaitingVisibleActivities.size();
      if (size > 0) {
        for (int i=0; i < size; i++) {
          ActivityRecord r=mStackSupervisor.mWaitingVisibleActivities.get(i);
          if (DEBUG_SWITCH)           Log.v(TAG,"Was waiting for visible: " + r);
        }
        mStackSupervisor.mWaitingVisibleActivities.clear();
        mStackSupervisor.scheduleIdleLocked();
      }
    }
    service.scheduleAppGcsLocked();
  }
}
