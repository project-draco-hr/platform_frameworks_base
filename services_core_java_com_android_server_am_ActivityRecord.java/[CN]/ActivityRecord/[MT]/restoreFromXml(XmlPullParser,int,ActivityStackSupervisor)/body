{
  Intent intent=null;
  PersistableBundle persistentState=null;
  int launchedFromUid=0;
  String launchedFromPackage=null;
  String resolvedType=null;
  boolean componentSpecified=false;
  int userId=0;
  long createTime=-1;
  final int outerDepth=in.getDepth();
  TaskDescription taskDescription=new TaskDescription();
  for (int attrNdx=in.getAttributeCount() - 1; attrNdx >= 0; --attrNdx) {
    final String attrName=in.getAttributeName(attrNdx);
    final String attrValue=in.getAttributeValue(attrNdx);
    if (TaskPersister.DEBUG)     Slog.d(TaskPersister.TAG,"ActivityRecord: attribute name=" + attrName + " value="+ attrValue);
    if (ATTR_ID.equals(attrName)) {
      createTime=Long.valueOf(attrValue);
    }
 else     if (ATTR_LAUNCHEDFROMUID.equals(attrName)) {
      launchedFromUid=Integer.valueOf(attrValue);
    }
 else     if (ATTR_LAUNCHEDFROMPACKAGE.equals(attrName)) {
      launchedFromPackage=attrValue;
    }
 else     if (ATTR_RESOLVEDTYPE.equals(attrName)) {
      resolvedType=attrValue;
    }
 else     if (ATTR_COMPONENTSPECIFIED.equals(attrName)) {
      componentSpecified=Boolean.valueOf(attrValue);
    }
 else     if (ATTR_USERID.equals(attrName)) {
      userId=Integer.valueOf(attrValue);
    }
 else     if (attrName.startsWith(TaskDescription.ATTR_TASKDESCRIPTION_PREFIX)) {
      taskDescription.restoreFromXml(attrName,attrValue);
    }
 else {
      Log.d(TAG,"Unknown ActivityRecord attribute=" + attrName);
    }
  }
  int event;
  while (((event=in.next()) != XmlPullParser.END_DOCUMENT) && (event != XmlPullParser.END_TAG || in.getDepth() < outerDepth)) {
    if (event == XmlPullParser.START_TAG) {
      final String name=in.getName();
      if (TaskPersister.DEBUG)       Slog.d(TaskPersister.TAG,"ActivityRecord: START_TAG name=" + name);
      if (TAG_INTENT.equals(name)) {
        intent=Intent.restoreFromXml(in);
        if (TaskPersister.DEBUG)         Slog.d(TaskPersister.TAG,"ActivityRecord: intent=" + intent);
      }
 else       if (TAG_PERSISTABLEBUNDLE.equals(name)) {
        persistentState=PersistableBundle.restoreFromXml(in);
        if (TaskPersister.DEBUG)         Slog.d(TaskPersister.TAG,"ActivityRecord: persistentState=" + persistentState);
      }
 else {
        Slog.w(TAG,"restoreActivity: unexpected name=" + name);
        XmlUtils.skipCurrentTag(in);
      }
    }
  }
  if (intent == null) {
    throw new XmlPullParserException("restoreActivity error intent=" + intent);
  }
  final ActivityManagerService service=stackSupervisor.mService;
  final ActivityInfo aInfo=stackSupervisor.resolveActivity(intent,resolvedType,0,null,userId);
  if (aInfo == null) {
    throw new XmlPullParserException("restoreActivity resolver error. Intent=" + intent + " resolvedType="+ resolvedType);
  }
  final ActivityRecord r=new ActivityRecord(service,null,launchedFromUid,launchedFromPackage,intent,resolvedType,aInfo,service.getConfiguration(),null,null,0,componentSpecified,stackSupervisor,null,null);
  r.persistentState=persistentState;
  r.taskDescription=taskDescription;
  r.createTime=createTime;
  return r;
}
