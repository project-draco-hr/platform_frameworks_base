{
  RenderedPage renderedPage=mPageContentCache.getRenderedPage(pageIndex);
  if (renderedPage != null && renderedPage.state == RenderedPage.STATE_RENDERED) {
    if (renderedPage.renderSpec.equals(renderSpec)) {
      if (DEBUG) {
        Log.i(LOG_TAG,"Cache hit for page: " + pageIndex);
      }
      if (callback != null) {
        callback.onPageContentAvailable(renderedPage.content);
      }
      return;
    }
 else {
      renderedPage.state=RenderedPage.STATE_SCRAP;
    }
  }
  RenderPageTask renderTask=mPageToRenderTaskMap.get(pageIndex);
  if (renderTask != null && !renderTask.isCancelled()) {
    if (renderTask.mRenderSpec.equals(renderSpec)) {
      if (renderTask.mCallback != null) {
        if (callback != null && renderTask.mCallback != callback) {
          throw new IllegalStateException("Page rendering not cancelled");
        }
      }
 else {
        renderTask.mCallback=callback;
      }
      return;
    }
 else {
      renderTask.cancel(true);
    }
  }
  renderTask=new RenderPageTask(pageIndex,renderSpec,callback);
  mPageToRenderTaskMap.put(pageIndex,renderTask);
  renderTask.executeOnExecutor(AsyncTask.SERIAL_EXECUTOR);
}
