{
  final boolean showUI=(flags & AudioManager.FLAG_SHOW_UI) != 0;
  final boolean fromKey=(flags & AudioManager.FLAG_FROM_KEY) != 0;
  final boolean showVibrateHint=(flags & AudioManager.FLAG_SHOW_VIBRATE_HINT) != 0;
  final boolean showSilentHint=(flags & AudioManager.FLAG_SHOW_SILENT_HINT) != 0;
  boolean changed=false;
  if (showUI) {
    changed|=updateActiveStreamW(stream);
  }
  changed|=updateStreamLevelW(stream,mAudio.getLastAudibleStreamVolume(stream));
  changed|=checkRoutedToBluetoothW(showUI ? AudioManager.STREAM_MUSIC : stream);
  if (changed) {
    mCallbacks.onStateChanged(mState);
  }
  if (showUI) {
    mCallbacks.onShowRequested(Events.SHOW_REASON_VOLUME_CHANGED);
  }
  if (showVibrateHint) {
    mCallbacks.onShowVibrateHint();
  }
  if (showSilentHint) {
    mCallbacks.onShowSilentHint();
  }
  if (changed && fromKey) {
    Events.writeEvent(Events.EVENT_KEY);
  }
}
