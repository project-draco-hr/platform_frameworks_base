{
  int count=mChildrenCount;
  int[] visibilities=null;
  if (skipChildren) {
    visibilities=new int[count];
    for (int i=0; i < count; i++) {
      View child=getChildAt(i);
      visibilities[i]=child.getVisibility();
      if (visibilities[i] == View.VISIBLE) {
        child.mViewFlags=(child.mViewFlags & ~View.VISIBILITY_MASK) | (View.INVISIBLE & View.VISIBILITY_MASK);
      }
    }
  }
  Bitmap b=super.createSnapshot(quality,backgroundColor,skipChildren);
  if (skipChildren) {
    for (int i=0; i < count; i++) {
      View child=getChildAt(i);
      child.mViewFlags=(child.mViewFlags & ~View.VISIBILITY_MASK) | (visibilities[i] & View.VISIBILITY_MASK);
    }
  }
  return b;
}
