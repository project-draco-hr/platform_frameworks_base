{
  final RectF rectF=mAttachInfo != null ? mAttachInfo.mTmpTransformRect1 : new RectF();
  final Matrix inverse=mAttachInfo != null ? mAttachInfo.mTmpMatrix : new Matrix();
  if (descendant == this) {
    return;
  }
  ViewParent theParent=descendant.mParent;
  while ((theParent != null) && (theParent instanceof View) && (theParent != this)) {
    if (offsetFromChildToParent) {
      rect.offset(-descendant.mScrollX,-descendant.mScrollY);
      if (!descendant.hasIdentityMatrix()) {
        rectF.set(rect);
        descendant.getMatrix().mapRect(rectF);
        rectF.roundOut(rect);
      }
      rect.offset(descendant.mLeft,descendant.mTop);
      if (clipToBounds) {
        View p=(View)theParent;
        boolean intersected=rect.intersect(0,0,p.mRight - p.mLeft,p.mBottom - p.mTop);
        if (!intersected) {
          rect.setEmpty();
        }
      }
    }
 else {
      if (clipToBounds) {
        View p=(View)theParent;
        boolean intersected=rect.intersect(0,0,p.mRight - p.mLeft,p.mBottom - p.mTop);
        if (!intersected) {
          rect.setEmpty();
        }
      }
      rect.offset(-descendant.mLeft,-descendant.mTop);
      if (!descendant.hasIdentityMatrix()) {
        descendant.getMatrix().invert(inverse);
        rectF.set(rect);
        inverse.mapRect(rectF);
        rectF.roundOut(rect);
      }
      rect.offset(descendant.mScrollX,descendant.mScrollY);
    }
    descendant=(View)theParent;
    theParent=descendant.mParent;
  }
  if (theParent == this) {
    if (offsetFromChildToParent) {
      rect.offset(-descendant.mScrollX,-descendant.mScrollY);
      if (!descendant.hasIdentityMatrix()) {
        rectF.set(rect);
        descendant.getMatrix().mapRect(rectF);
        rectF.roundOut(rect);
      }
      rect.offset(descendant.mLeft,descendant.mTop);
    }
 else {
      rect.offset(-descendant.mLeft,-descendant.mTop);
      if (!descendant.hasIdentityMatrix()) {
        descendant.getMatrix().invert(inverse);
        rectF.set(rect);
        inverse.mapRect(rectF);
        rectF.roundOut(rect);
      }
      rect.offset(descendant.mScrollX,descendant.mScrollY);
    }
  }
 else {
    throw new IllegalArgumentException("parameter must be a descendant of this view");
  }
}
