{
  boolean retval=false;
  final float tx=event.mX;
  final float ty=event.mY;
  ViewRoot root=(ViewRoot)(getRootView().getParent());
switch (event.mAction) {
case DragEvent.ACTION_DRAG_STARTED:
{
      root.setDragFocus(event,null);
      mChildAcceptsDrag=false;
      final int count=mChildrenCount;
      final View[] children=mChildren;
      for (int i=0; i < count; i++) {
        final boolean handled=children[i].dispatchDragEvent(event);
        children[i].mCanAcceptDrop=handled;
        if (handled) {
          mChildAcceptsDrag=true;
        }
      }
      if (mChildAcceptsDrag) {
        retval=true;
      }
    }
  break;
case DragEvent.ACTION_DRAG_ENDED:
{
  final int count=mChildrenCount;
  final View[] children=mChildren;
  for (int i=0; i < count; i++) {
    children[i].dispatchDragEvent(event);
  }
  if (mChildAcceptsDrag) {
    retval=true;
  }
}
break;
case DragEvent.ACTION_DRAG_LOCATION:
{
final View target=findFrontmostDroppableChildAt(event.mX,event.mY,mLocalPoint);
if (mCurrentDragView != target) {
root.setDragFocus(event,target);
mCurrentDragView=target;
}
if (target != null) {
event.mX=mLocalPoint.x;
event.mY=mLocalPoint.y;
retval=target.dispatchDragEvent(event);
event.mX=tx;
event.mY=ty;
}
}
break;
case DragEvent.ACTION_DROP:
{
if (View.DEBUG_DRAG) Slog.d(TAG,"Drop event: " + event);
View target=findFrontmostDroppableChildAt(event.mX,event.mY,mLocalPoint);
if (target != null) {
event.mX=mLocalPoint.x;
event.mY=mLocalPoint.y;
retval=target.dispatchDragEvent(event);
event.mX=tx;
event.mY=ty;
}
}
break;
}
if (!retval) {
retval=onDragEvent(event);
}
return retval;
}
