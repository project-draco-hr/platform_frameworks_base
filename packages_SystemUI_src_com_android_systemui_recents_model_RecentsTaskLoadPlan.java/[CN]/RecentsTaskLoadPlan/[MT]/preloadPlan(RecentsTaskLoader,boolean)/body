{
  if (DEBUG)   Log.d(TAG,"preloadPlan");
  RecentsConfiguration config=Recents.getConfiguration();
  SystemServicesProxy ssp=Recents.getSystemServices();
  Resources res=mContext.getResources();
  ArrayList<Task> freeformTasks=new ArrayList<>();
  ArrayList<Task> stackTasks=new ArrayList<>();
  if (mRawTasks == null) {
    preloadRawTasks(isTopTaskHome);
  }
  int taskCount=mRawTasks.size();
  for (int i=0; i < taskCount; i++) {
    ActivityManager.RecentTaskInfo t=mRawTasks.get(i);
    Task.TaskKey taskKey=new Task.TaskKey(t.persistentId,t.stackId,t.baseIntent,t.userId,t.firstActiveTime,t.lastActiveTime);
    String activityLabel=loader.getAndUpdateActivityLabel(taskKey,t.taskDescription,ssp);
    String contentDescription=loader.getAndUpdateContentDescription(taskKey,activityLabel,ssp,res);
    Drawable activityIcon=loader.getAndUpdateActivityIcon(taskKey,t.taskDescription,ssp,res,false);
    int activityColor=loader.getActivityPrimaryColor(t.taskDescription);
    Bitmap icon=t.taskDescription != null ? t.taskDescription.getInMemoryIcon() : null;
    String iconFilename=t.taskDescription != null ? t.taskDescription.getIconFilename() : null;
    Task task=new Task(taskKey,(t.id != INVALID_TASK_ID),t.affiliatedTaskId,t.affiliatedTaskColor,activityLabel,contentDescription,activityIcon,activityColor,(i == (taskCount - 1)),config.lockToAppEnabled,icon,iconFilename);
    task.thumbnail=loader.getAndUpdateThumbnail(taskKey,ssp,false);
    if (DEBUG)     Log.d(TAG,"\tthumbnail: " + taskKey + ", "+ task.thumbnail);
    stackTasks.add(task);
  }
  mStack=new TaskStack();
  mStack.setTasks(stackTasks);
  mStack.createAffiliatedGroupings(mContext);
}
