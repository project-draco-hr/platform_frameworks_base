{
  if (DEBUG)   Log.d(TAG,"executePlan, # tasks: " + opts.numVisibleTasks + ", # thumbnails: "+ opts.numVisibleTaskThumbnails+ ", running task id: "+ opts.runningTaskId);
  SystemServicesProxy ssp=Recents.getSystemServices();
  Resources res=mContext.getResources();
  ArrayList<Task> tasks=mStack.getTasks();
  int taskCount=tasks.size();
  for (int i=0; i < taskCount; i++) {
    ActivityManager.RecentTaskInfo t=mRawTasks.get(i);
    Task task=tasks.get(i);
    Task.TaskKey taskKey=task.key;
    boolean isRunningTask=(task.key.id == opts.runningTaskId);
    boolean isVisibleTask=i >= (taskCount - opts.numVisibleTasks);
    boolean isVisibleThumbnail=i >= (taskCount - opts.numVisibleTaskThumbnails);
    if (opts.onlyLoadPausedActivities && isRunningTask) {
      continue;
    }
    if (opts.loadIcons && (isRunningTask || isVisibleTask)) {
      if (task.activityIcon == null) {
        if (DEBUG)         Log.d(TAG,"\tLoading icon: " + taskKey);
        task.activityIcon=loader.getAndUpdateActivityIcon(taskKey,t.taskDescription,ssp,res,true);
      }
    }
    if (opts.loadThumbnails && (isRunningTask || isVisibleThumbnail)) {
      if (task.thumbnail == null || isRunningTask) {
        if (DEBUG)         Log.d(TAG,"\tLoading thumbnail: " + taskKey);
        if (mConfig.svelteLevel <= RecentsConfiguration.SVELTE_LIMIT_CACHE) {
          task.thumbnail=loader.getAndUpdateThumbnail(taskKey,ssp,true);
        }
 else         if (mConfig.svelteLevel == RecentsConfiguration.SVELTE_DISABLE_CACHE) {
          loadQueue.addTask(task);
        }
      }
    }
  }
}
