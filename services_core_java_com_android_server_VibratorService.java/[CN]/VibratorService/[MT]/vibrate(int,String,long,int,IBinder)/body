{
  if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.VIBRATE) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires VIBRATE permission");
  }
  verifyIncomingUid(uid);
  if (milliseconds <= 0 || (mCurrentVibration != null && mCurrentVibration.hasLongerTimeout(milliseconds))) {
    return;
  }
  if (DEBUG) {
    Slog.d(TAG,"Vibrating for " + milliseconds + " ms.");
  }
  Vibration vib=new Vibration(token,milliseconds,usageHint,uid,opPkg);
  final long ident=Binder.clearCallingIdentity();
  try {
synchronized (mVibrations) {
      removeVibrationLocked(token);
      doCancelVibrateLocked();
      addToPreviousVibrationsLocked(vib);
      startVibrationLocked(vib);
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
