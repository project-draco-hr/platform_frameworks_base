{
  activity.setCallback(new TestShellCallback(){
    public void finished(){
synchronized (LayoutTestsAutoTest.this) {
        mFinished=true;
        LayoutTestsAutoTest.this.notifyAll();
      }
    }
    public void timedOut(    String url){
    }
  }
);
  String resultFile=getResultFile(test);
  if (mRebaselineResults) {
    String expectedResultFile=getExpectedResultFile(test);
    File f=new File(expectedResultFile);
    if (f.exists()) {
      return;
    }
    resultFile=getAndroidExpectedResultFile(expectedResultFile);
  }
  mFinished=false;
  Intent intent=new Intent(Intent.ACTION_VIEW);
  intent.setClass(activity,TestShellActivity.class);
  intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
  intent.putExtra(TestShellActivity.TEST_URL,"file://" + test);
  intent.putExtra(TestShellActivity.RESULT_FILE,resultFile);
  intent.putExtra(TestShellActivity.TIMEOUT_IN_MILLIS,timeout);
  activity.startActivity(intent);
synchronized (this) {
    while (!mFinished) {
      try {
        this.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
  if (!mRebaselineResults) {
    String expectedResultFile=getExpectedResultFile(test);
    File f=new File(expectedResultFile);
    if (!f.exists()) {
      expectedResultFile=getAndroidExpectedResultFile(expectedResultFile);
    }
    processResult(test,resultFile,expectedResultFile);
  }
}
