{
  mAudioTrack=track;
  Looper looper;
  if (handler != null) {
    looper=handler.getLooper();
  }
 else {
    looper=mInitializationLooper;
  }
  if (looper != null) {
    mHandler=new Handler(looper){
      @Override public void handleMessage(      Message msg){
        if (mAudioTrack == null) {
          return;
        }
        OnPlaybackPositionUpdateListener listener=null;
synchronized (mPositionListenerLock) {
          listener=mAudioTrack.mPositionListener;
        }
switch (msg.what) {
case NATIVE_EVENT_MARKER:
          if (listener != null) {
            listener.onMarkerReached(mAudioTrack);
          }
        break;
case NATIVE_EVENT_NEW_POS:
      if (listener != null) {
        listener.onPeriodicNotification(mAudioTrack);
      }
    break;
default :
  loge("Unknown native event type: " + msg.what);
break;
}
}
}
;
}
 else {
mHandler=null;
}
}
