{
  if (mAttributes == null) {
    mAttributes=new AudioAttributes.Builder().setUsage(AudioAttributes.USAGE_MEDIA).build();
  }
  if (mFormat == null) {
    mFormat=new AudioFormat.Builder().setChannelMask(AudioFormat.CHANNEL_OUT_STEREO).setEncoding(AudioFormat.ENCODING_DEFAULT).build();
  }
  try {
    if (mMode == MODE_STREAM && mBufferSizeInBytes == 0) {
      mBufferSizeInBytes=mFormat.getChannelCount() * mFormat.getBytesPerSample(mFormat.getEncoding());
    }
    final AudioTrack track=new AudioTrack(mAttributes,mFormat,mBufferSizeInBytes,mMode,mSessionId);
    if (track.getState() == STATE_UNINITIALIZED) {
      throw new UnsupportedOperationException("Cannot create AudioTrack");
    }
    return track;
  }
 catch (  IllegalArgumentException e) {
    throw new UnsupportedOperationException(e.getMessage());
  }
}
