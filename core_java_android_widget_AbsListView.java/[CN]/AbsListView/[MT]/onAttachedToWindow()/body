{
  super.onAttachedToWindow();
  final ViewTreeObserver treeObserver=getViewTreeObserver();
  if (treeObserver != null) {
    treeObserver.addOnTouchModeChangeListener(this);
    if (mTextFilterEnabled && mPopup != null && !mGlobalLayoutListenerAddedFilter) {
      treeObserver.addOnGlobalLayoutListener(this);
    }
    if (mGestures != GESTURES_NONE && mGesturesPopup != null && !mGlobalLayoutListenerAddedGestures) {
      treeObserver.addOnGlobalLayoutListener(mGesturesLayoutListener);
    }
  }
}
