{
switch (direction) {
case ACCESSIBILITY_FOCUS_FORWARD:
{
      ViewRootImpl viewRootImpl=getViewRootImpl();
      if (viewRootImpl == null) {
        break;
      }
      View currentFocus=viewRootImpl.getAccessibilityFocusedHost();
      if (currentFocus == null) {
        break;
      }
      if (currentFocus == this) {
        final int firstVisiblePosition=getFirstVisiblePosition();
        if (firstVisiblePosition >= 0) {
          return getChildAt(0);
        }
        return null;
      }
      final int currentPosition=getPositionForView(currentFocus);
      if (currentPosition < 0 || currentPosition >= getCount()) {
        break;
      }
      View currentItem=getChildAt(currentPosition - getFirstVisiblePosition());
      if (currentItem instanceof ViewGroup) {
        ViewGroup currentItemGroup=(ViewGroup)currentItem;
        View nextFocus=FocusFinder.getInstance().findNextFocus(currentItemGroup,currentFocus,direction);
        if (nextFocus != null && nextFocus != currentItemGroup && nextFocus != currentFocus) {
          return nextFocus;
        }
      }
      final int nextPosition=currentPosition - getFirstVisiblePosition() + 1;
      if (nextPosition < getChildCount()) {
        return getChildAt(nextPosition);
      }
    }
  break;
case ACCESSIBILITY_FOCUS_BACKWARD:
{
  ViewRootImpl viewRootImpl=getViewRootImpl();
  if (viewRootImpl == null) {
    break;
  }
  View currentFocus=viewRootImpl.getAccessibilityFocusedHost();
  if (currentFocus == null) {
    break;
  }
  if (currentFocus == this) {
    return super.focusSearch(this,direction);
  }
  final int currentPosition=getPositionForView(currentFocus);
  if (currentPosition < 0 || currentPosition >= getCount()) {
    break;
  }
  View currentItem=getChildAt(currentPosition - getFirstVisiblePosition());
  if (currentItem instanceof ViewGroup) {
    ViewGroup currentItemGroup=(ViewGroup)currentItem;
    View nextFocus=FocusFinder.getInstance().findNextFocus(currentItemGroup,currentFocus,direction);
    if (nextFocus != null && nextFocus != currentItemGroup && nextFocus != currentFocus) {
      return nextFocus;
    }
  }
  final int nextPosition=currentPosition - getFirstVisiblePosition() - 1;
  if (nextPosition >= 0) {
    return getChildAt(nextPosition);
  }
 else {
    return this;
  }
}
}
return super.focusSearch(focused,direction);
}
