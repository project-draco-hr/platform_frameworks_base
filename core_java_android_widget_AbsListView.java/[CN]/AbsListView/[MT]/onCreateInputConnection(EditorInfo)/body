{
  if (isTextFilterEnabled()) {
    createTextFilter(false);
    if (mPublicInputConnection == null) {
      mDefInputConnection=new BaseInputConnection(this,false);
      mPublicInputConnection=new InputConnectionWrapper(mTextFilter.onCreateInputConnection(outAttrs),true){
        @Override public boolean reportFullscreenMode(        boolean enabled){
          return mDefInputConnection.reportFullscreenMode(enabled);
        }
        @Override public boolean performEditorAction(        int editorAction){
          if (editorAction == EditorInfo.IME_ACTION_DONE) {
            InputMethodManager imm=(InputMethodManager)getContext().getSystemService(Context.INPUT_METHOD_SERVICE);
            if (imm != null) {
              imm.hideSoftInputFromWindow(getWindowToken(),0);
            }
            return true;
          }
          return false;
        }
        @Override public boolean sendKeyEvent(        KeyEvent event){
          return mDefInputConnection.sendKeyEvent(event);
        }
      }
;
    }
    outAttrs.inputType=EditorInfo.TYPE_CLASS_TEXT | EditorInfo.TYPE_TEXT_VARIATION_FILTER;
    outAttrs.imeOptions=EditorInfo.IME_ACTION_DONE;
    return mPublicInputConnection;
  }
  return null;
}
