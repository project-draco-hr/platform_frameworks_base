{
  super.onDetachedFromWindow();
  final ViewTreeObserver treeObserver=getViewTreeObserver();
  if (treeObserver != null) {
    treeObserver.removeOnTouchModeChangeListener(this);
    if (mTextFilterEnabled && mPopup != null) {
      treeObserver.removeGlobalOnLayoutListener(this);
      mGlobalLayoutListenerAddedFilter=false;
    }
    if (mGesturesLayoutListener != null && mGesturesPopup != null) {
      mGlobalLayoutListenerAddedGestures=false;
      treeObserver.removeGlobalOnLayoutListener(mGesturesLayoutListener);
    }
  }
}
