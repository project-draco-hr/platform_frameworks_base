{
  if (mEnvelope.teleService == SmsEnvelope.TELESERVICE_MWI) {
    mBearerData=new BearerData();
    if (mEnvelope.bearerData != null) {
      mBearerData.numberOfMessages=0x000000FF & mEnvelope.bearerData[0];
    }
    if (Config.DEBUG) {
      Log.d(LOG_TAG,"parseSms: get MWI " + Integer.toString(mBearerData.numberOfMessages));
    }
    return;
  }
  mBearerData=BearerData.decode(mEnvelope.bearerData);
  if (Log.isLoggable(LOGGABLE_TAG,Log.VERBOSE)) {
    Log.d(LOG_TAG,"MT raw BearerData = '" + HexDump.toHexString(mEnvelope.bearerData) + "'");
    Log.d(LOG_TAG,"MT (decoded) BearerData = " + mBearerData);
  }
  messageRef=mBearerData.messageId;
  if (mBearerData.userData != null) {
    userData=mBearerData.userData.payload;
    userDataHeader=mBearerData.userData.userDataHeader;
    messageBody=mBearerData.userData.payloadStr;
  }
  if (originatingAddress != null) {
    originatingAddress.address=new String(originatingAddress.origBytes);
    if (Config.LOGV)     Log.v(LOG_TAG,"SMS originating address: " + originatingAddress.address);
  }
  if (mBearerData.msgCenterTimeStamp != null) {
    scTimeMillis=mBearerData.msgCenterTimeStamp.toMillis(true);
  }
  if (Config.LOGD)   Log.d(LOG_TAG,"SMS SC timestamp: " + scTimeMillis);
  if (mBearerData.messageType == BearerData.MESSAGE_TYPE_DELIVERY_ACK) {
    if (!mBearerData.messageStatusSet) {
      Log.d(LOG_TAG,"DELIVERY_ACK message without msgStatus (" + (userData == null ? "also missing" : "does have") + " userData).");
      status=0;
    }
 else {
      status=mBearerData.errorClass << 8;
      status|=mBearerData.messageStatus;
    }
  }
 else   if (mBearerData.messageType != BearerData.MESSAGE_TYPE_DELIVER) {
    throw new RuntimeException("Unsupported message type: " + mBearerData.messageType);
  }
  if (messageBody != null) {
    if (Config.LOGV)     Log.v(LOG_TAG,"SMS message body: '" + messageBody + "'");
    parseMessageBody();
  }
 else   if ((userData != null) && (Config.LOGV)) {
    Log.v(LOG_TAG,"SMS payload: '" + IccUtils.bytesToHexString(userData) + "'");
  }
}
