{
  if (mEnvelope.teleService == SmsEnvelope.TELESERVICE_MWI) {
    mBearerData=new BearerData();
    if (mEnvelope.bearerData != null) {
      mBearerData.numberOfMessages=0x000000FF & mEnvelope.bearerData[0];
    }
    if (Config.DEBUG) {
      Log.d(LOG_TAG,"parseSms: get MWI " + Integer.toString(mBearerData.numberOfMessages));
    }
    return;
  }
  mBearerData=BearerData.decode(mEnvelope.bearerData);
  if (DBG_SMS) {
    Log.d(LOG_TAG,"MT raw BearerData = '" + HexDump.toHexString(mEnvelope.bearerData) + "'");
    Log.d(LOG_TAG,"MT (decoded) BearerData = " + mBearerData);
  }
  messageRef=mBearerData.messageId;
  if (mBearerData.userData != null) {
    userData=mBearerData.userData.payload;
    userDataHeader=mBearerData.userData.userDataHeader;
    messageBody=mBearerData.userData.payloadStr;
  }
switch (mBearerData.messageType) {
case BearerData.MESSAGE_TYPE_USER_ACK:
case BearerData.MESSAGE_TYPE_READ_ACK:
case BearerData.MESSAGE_TYPE_DELIVER:
case BearerData.MESSAGE_TYPE_DELIVERY_ACK:
    break;
default :
  throw new RuntimeException("Unsupported message type: " + mBearerData.messageType);
}
if (originatingAddress != null) {
originatingAddress.address=new String(originatingAddress.origBytes);
if (Config.LOGV) Log.v(LOG_TAG,"SMS originating address: " + originatingAddress.address);
}
if (mBearerData.msgCenterTimeStamp != null) {
scTimeMillis=mBearerData.msgCenterTimeStamp.toMillis(true);
}
if (Config.LOGD) Log.d(LOG_TAG,"SMS SC timestamp: " + scTimeMillis);
if ((mBearerData.messageType == BearerData.MESSAGE_TYPE_DELIVERY_ACK) && (mBearerData.errorClass != BearerData.ERROR_UNDEFINED)) {
status=mBearerData.errorClass << 8;
status|=mBearerData.messageStatus;
}
if (messageBody != null) {
if (Config.LOGV) Log.v(LOG_TAG,"SMS message body: '" + messageBody + "'");
parseMessageBody();
}
 else if ((userData != null) && (Config.LOGV)) {
Log.v(LOG_TAG,"SMS payload: '" + IccUtils.bytesToHexString(userData) + "'");
}
}
