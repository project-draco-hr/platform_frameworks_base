{
  if (state.value) {
    mWasLastOn=SystemClock.uptimeMillis();
  }
  if (arg instanceof UserBoolean) {
    state.value=((UserBoolean)arg).value;
  }
  if (!state.value && mWasLastOn != 0) {
    if (SystemClock.uptimeMillis() > mWasLastOn + RECENTLY_ON_DURATION_MILLIS) {
      mWasLastOn=0;
    }
 else {
      mHandler.removeCallbacks(mRecentlyOnTimeout);
      mHandler.postAtTime(mRecentlyOnTimeout,mWasLastOn + RECENTLY_ON_DURATION_MILLIS);
    }
  }
  state.visible=mWasLastOn != 0 || mFlashlightController.isAvailable();
  state.label=mHost.getContext().getString(R.string.quick_settings_flashlight_label);
  final AnimationIcon icon=state.value ? mEnable : mDisable;
  icon.setAllowAnimation(arg instanceof UserBoolean && ((UserBoolean)arg).userInitiated);
  state.icon=icon;
  int onOrOffId=state.value ? R.string.accessibility_quick_settings_flashlight_on : R.string.accessibility_quick_settings_flashlight_off;
  state.contentDescription=mContext.getString(onOrOffId);
}
