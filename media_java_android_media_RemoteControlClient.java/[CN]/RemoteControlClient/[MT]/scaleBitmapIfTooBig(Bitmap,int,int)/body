{
  if (bitmap != null) {
    final int width=bitmap.getWidth();
    final int height=bitmap.getHeight();
    if (width > maxWidth || height > maxHeight) {
      float scale=Math.min((float)maxWidth / width,(float)maxHeight / height);
      int newWidth=Math.round(scale * width);
      int newHeight=Math.round(scale * height);
      Bitmap.Config newConfig=bitmap.getConfig();
      if (newConfig == null) {
        newConfig=Bitmap.Config.ARGB_8888;
      }
      Bitmap outBitmap=Bitmap.createBitmap(newWidth,newHeight,newConfig);
      Canvas canvas=new Canvas(outBitmap);
      Paint paint=new Paint();
      paint.setAntiAlias(true);
      paint.setFilterBitmap(true);
      canvas.drawBitmap(bitmap,null,new RectF(0,0,outBitmap.getWidth(),outBitmap.getHeight()),paint);
      bitmap=outBitmap;
    }
  }
  return bitmap;
}
