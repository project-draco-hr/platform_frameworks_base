{
  if (DEBUG) {
    Log.d(TAG,"onPositionDriftCheck()");
  }
synchronized (mCacheLock) {
    if ((mEventHandler == null) || (mPositionProvider == null) || !mNeedsPositionSync) {
      return;
    }
    if ((mPlaybackPositionMs < 0) || (mPlaybackSpeed == 0.0f)) {
      if (DEBUG) {
        Log.d(TAG," no valid position or 0 speed, no check needed");
      }
      return;
    }
    long estPos=mPlaybackPositionMs + (long)((SystemClock.elapsedRealtime() - mPlaybackStateChangeTimeMs) / mPlaybackSpeed);
    long actPos=mPositionProvider.onGetPlaybackPosition();
    if (actPos >= 0) {
      if (Math.abs(estPos - actPos) > POSITION_DRIFT_MAX_MS) {
        if (DEBUG) {
          Log.w(TAG," drift detected: actual=" + actPos + "  est="+ estPos);
        }
        setPlaybackState(mPlaybackState,actPos,mPlaybackSpeed);
      }
 else {
        if (DEBUG) {
          Log.d(TAG," no drift: actual=" + actPos + "  est="+ estPos);
        }
        mEventHandler.sendMessageDelayed(mEventHandler.obtainMessage(MSG_POSITION_DRIFT_CHECK),getCheckPeriodFromSpeed(mPlaybackSpeed));
      }
    }
 else {
      mEventHandler.removeMessages(MSG_POSITION_DRIFT_CHECK);
    }
  }
}
