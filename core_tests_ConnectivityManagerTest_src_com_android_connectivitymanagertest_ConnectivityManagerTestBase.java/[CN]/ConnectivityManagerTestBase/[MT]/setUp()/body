{
  mState=State.UNKNOWN;
  scanResultAvailable=false;
  mContext=getInstrumentation().getContext();
  mCM=(ConnectivityManager)mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
  mWifiManager=(WifiManager)mContext.getSystemService(Context.WIFI_SERVICE);
  if (mWifiManager.isWifiApEnabled()) {
    mWifiManager.setWifiApEnabled(null,false);
    log("Disable soft ap");
  }
  initializeNetworkStates();
  mConnectivityReceiver=new ConnectivityReceiver();
  mContext.registerReceiver(mConnectivityReceiver,new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION));
  mWifiReceiver=new WifiReceiver();
  IntentFilter mIntentFilter=new IntentFilter();
  mIntentFilter.addAction(WifiManager.SCAN_RESULTS_AVAILABLE_ACTION);
  mIntentFilter.addAction(WifiManager.NETWORK_STATE_CHANGED_ACTION);
  mIntentFilter.addAction(WifiManager.WIFI_STATE_CHANGED_ACTION);
  mIntentFilter.addAction(WifiManager.SUPPLICANT_CONNECTION_CHANGE_ACTION);
  mIntentFilter.addAction(WifiManager.WIFI_AP_STATE_CHANGED_ACTION);
  mIntentFilter.addAction(ConnectivityManager.ACTION_TETHER_STATE_CHANGED);
  mContext.registerReceiver(mWifiReceiver,mIntentFilter);
  log("Clear Wifi before we start the test.");
  removeConfiguredNetworksAndDisableWifi();
  mWifiRegexs=mCM.getTetherableWifiRegexs();
}
