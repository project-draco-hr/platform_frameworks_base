{
  long startTime=SystemClock.uptimeMillis();
  while (true) {
    int state=mWifiManager.getWifiApState();
    if (state == expectedState) {
      log("waitForWifiAPState success: state=" + state);
      return true;
    }
    if ((SystemClock.uptimeMillis() - startTime) > timeout) {
      log(String.format("waitForWifiAPState timeout: expected=%d, actual=%d",expectedState,state));
      return false;
    }
    log(String.format("waitForWifiAPState interim: expected=%d, actual=%d",expectedState,state));
    SystemClock.sleep(SHORT_TIMEOUT);
  }
}
