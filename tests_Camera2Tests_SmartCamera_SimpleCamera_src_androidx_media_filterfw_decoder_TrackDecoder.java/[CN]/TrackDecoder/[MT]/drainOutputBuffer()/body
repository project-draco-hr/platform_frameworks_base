{
  BufferInfo outputInfo=new BufferInfo();
  int outputBufferIndex=mMediaCodec.dequeueOutputBuffer(outputInfo,TIMEOUT_US);
  if ((outputInfo.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {
    mListener.onEndOfStream(this);
    return false;
  }
  if (mShouldEnqueueEndOfStream) {
    tryEnqueueEndOfStream();
  }
  if (outputBufferIndex >= 0) {
    return onDataAvailable(mMediaCodec,mCodecOutputBuffers,outputBufferIndex,outputInfo);
  }
 else   if (outputBufferIndex == MediaCodec.INFO_OUTPUT_BUFFERS_CHANGED) {
    mCodecOutputBuffers=mMediaCodec.getOutputBuffers();
    return true;
  }
 else   if (outputBufferIndex == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {
    mOutputFormat=mMediaCodec.getOutputFormat();
    Log.d(LOG_TAG,"Output format has changed to " + mOutputFormat);
    return true;
  }
  return false;
}
