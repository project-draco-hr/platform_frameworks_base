{
  assertRunOnServiceThread();
  if (connected) {
    HdmiMhlLocalDeviceStub newDevice=new HdmiMhlLocalDeviceStub(this,portId);
    HdmiMhlLocalDeviceStub oldDevice=mMhlController.addLocalDevice(newDevice);
    if (oldDevice != null) {
      oldDevice.onDeviceRemoved();
      Slog.i(TAG,"Old device of port " + portId + " is removed");
    }
  }
 else {
    HdmiMhlLocalDeviceStub device=mMhlController.removeLocalDevice(portId);
    if (device != null) {
      device.onDeviceRemoved();
      HdmiDeviceInfo deviceInfo=device.getInfo();
      if (deviceInfo != null) {
        invokeDeviceEventListeners(deviceInfo,DEVICE_EVENT_REMOVE_DEVICE);
        updateSafeMhlInput();
      }
    }
 else {
      Slog.w(TAG,"No device to remove:[portId=" + portId);
    }
  }
  announceHotplugEvent(portId,connected);
}
