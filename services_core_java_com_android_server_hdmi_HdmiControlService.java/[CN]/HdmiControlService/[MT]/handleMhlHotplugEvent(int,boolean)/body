{
  assertRunOnServiceThread();
  if (connected) {
    HdmiMhlLocalDeviceStub newDevice=new HdmiMhlLocalDeviceStub(this,portId);
    HdmiMhlLocalDeviceStub oldDevice=mMhlController.addLocalDevice(newDevice);
    if (oldDevice != null) {
      oldDevice.onDeviceRemoved();
      Slog.i(TAG,"Old device of port " + portId + " is removed");
    }
    invokeDeviceEventListeners(newDevice.getInfo(),DEVICE_EVENT_ADD_DEVICE);
    updateSafeMhlInput();
  }
 else {
    HdmiMhlLocalDeviceStub device=mMhlController.removeLocalDevice(portId);
    if (device != null) {
      device.onDeviceRemoved();
      invokeDeviceEventListeners(device.getInfo(),DEVICE_EVENT_REMOVE_DEVICE);
      updateSafeMhlInput();
    }
 else {
      Slog.w(TAG,"No device to remove:[portId=" + portId);
    }
  }
  announceHotplugEvent(portId,connected);
}
