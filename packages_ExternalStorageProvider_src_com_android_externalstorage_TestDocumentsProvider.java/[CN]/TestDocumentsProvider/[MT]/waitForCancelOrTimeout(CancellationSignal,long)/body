{
  if (signal != null) {
    final Thread blocked=Thread.currentThread();
    signal.setOnCancelListener(new OnCancelListener(){
      @Override public void onCancel(){
        blocked.interrupt();
      }
    }
);
    signal.throwIfCanceled();
  }
  try {
    Thread.sleep(timeoutMillis);
  }
 catch (  InterruptedException e) {
  }
  if (signal != null) {
    signal.throwIfCanceled();
  }
}
