{
  String oldContent=DeviceUtils.doShellReturnString(device,"cat /etc/preloaded-classes",1,TimeUnit.SECONDS);
  if (oldContent.trim().equals("")) {
    System.out.println("Preloaded-classes already empty.");
    return true;
  }
  doShell(device,"stop",100,TimeUnit.MILLISECONDS);
  doShell(device,"mount -o remount,rw /system",500,TimeUnit.MILLISECONDS);
  doShell(device,"rm /etc/preloaded-classes",100,TimeUnit.MILLISECONDS);
  doShell(device,"touch /etc/preloaded-classes",100,TimeUnit.MILLISECONDS);
  doShell(device,"rm /data/dalvik-cache/*/*boot.art",500,TimeUnit.MILLISECONDS);
  doShell(device,"setprop dev.bootcomplete \"0\"",500,TimeUnit.MILLISECONDS);
  doShell(device,"start",100,TimeUnit.MILLISECONDS);
  Date startDate=new Date();
  for (; ; ) {
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
    }
    String ret=doShellReturnString(device,"getprop dev.bootcomplete",500,TimeUnit.MILLISECONDS);
    if (ret.trim().equals("1")) {
      break;
    }
    System.out.println("Still not booted: " + ret);
    Date endDate=new Date();
    long seconds=TimeUnit.SECONDS.convert(endDate.getTime() - startDate.getTime(),TimeUnit.MILLISECONDS);
    if (seconds > preloadedWaitTimeInSeconds) {
      return false;
    }
  }
  return true;
}
