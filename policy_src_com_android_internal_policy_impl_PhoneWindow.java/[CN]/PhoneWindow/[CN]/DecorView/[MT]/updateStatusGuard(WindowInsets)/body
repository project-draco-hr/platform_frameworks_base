{
  boolean showStatusGuard=false;
  if (mActionModeView != null) {
    if (mActionModeView.getLayoutParams() instanceof MarginLayoutParams) {
      MarginLayoutParams mlp=(MarginLayoutParams)mActionModeView.getLayoutParams();
      boolean mlpChanged=false;
      if (mActionModeView.isShown()) {
        final boolean nonOverlay=(getLocalFeatures() & (1 << FEATURE_ACTION_MODE_OVERLAY)) == 0;
        if (mlp.topMargin != insets.getSystemWindowInsetTop()) {
          mlpChanged=true;
          mlp.topMargin=insets.getSystemWindowInsetTop();
          if (nonOverlay) {
            if (mStatusGuard == null) {
              mStatusGuard=new View(mContext);
              mStatusGuard.setBackgroundColor(mContext.getResources().getColor(R.color.input_method_navigation_guard));
              addView(mStatusGuard,indexOfChild(mStatusColorView),new LayoutParams(LayoutParams.MATCH_PARENT,mlp.topMargin,Gravity.START | Gravity.TOP));
            }
 else {
              LayoutParams lp=(LayoutParams)mStatusGuard.getLayoutParams();
              if (lp.height != mlp.topMargin) {
                lp.height=mlp.topMargin;
                mStatusGuard.setLayoutParams(lp);
              }
            }
          }
        }
        insets=insets.consumeSystemWindowInsets(false,nonOverlay,false,false);
        showStatusGuard=nonOverlay;
      }
 else {
        if (mlp.topMargin != 0) {
          mlpChanged=true;
          mlp.topMargin=0;
        }
      }
      if (mlpChanged) {
        mActionModeView.setLayoutParams(mlp);
      }
    }
  }
  if (mStatusGuard != null) {
    mStatusGuard.setVisibility(showStatusGuard ? View.VISIBLE : View.GONE);
  }
  return insets;
}
