{
  mFrameOffsets.set(insets);
  if (getAttributes().type == WindowManager.LayoutParams.TYPE_INPUT_METHOD) {
    if (mContentParent != null) {
      if (mContentParent.getLayoutParams() instanceof MarginLayoutParams) {
        MarginLayoutParams mlp=(MarginLayoutParams)mContentParent.getLayoutParams();
        mlp.bottomMargin=insets.bottom;
        mContentParent.setLayoutParams(mlp);
      }
    }
    if (mNavigationGuard == null) {
      mNavigationGuard=new View(mContext);
      mNavigationGuard.setBackgroundColor(mContext.getResources().getColor(R.color.input_method_navigation_guard));
      addView(mNavigationGuard,new LayoutParams(LayoutParams.MATCH_PARENT,insets.bottom,Gravity.START | Gravity.BOTTOM));
    }
 else {
      LayoutParams lp=(LayoutParams)mNavigationGuard.getLayoutParams();
      lp.height=insets.bottom;
      mNavigationGuard.setLayoutParams(lp);
    }
  }
  if (getForeground() != null) {
    drawableChanged();
  }
  return super.fitSystemWindows(insets);
}
