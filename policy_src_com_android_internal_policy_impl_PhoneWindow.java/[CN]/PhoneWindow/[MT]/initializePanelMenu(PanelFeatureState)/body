{
  Context context=getContext();
  if ((st.featureId == FEATURE_OPTIONS_PANEL || st.featureId == FEATURE_ACTION_BAR) && mActionBar != null) {
    TypedValue outValue=new TypedValue();
    Resources.Theme currentTheme=context.getTheme();
    currentTheme.resolveAttribute(com.android.internal.R.attr.actionBarWidgetTheme,outValue,true);
    final int targetThemeRes=outValue.resourceId;
    if (targetThemeRes != 0 && context.getThemeResId() != targetThemeRes) {
      context=new ContextThemeWrapper(context,targetThemeRes);
    }
  }
  final MenuBuilder menu=new MenuBuilder(context);
  menu.setCallback(this);
  st.setMenu(menu);
  return true;
}
