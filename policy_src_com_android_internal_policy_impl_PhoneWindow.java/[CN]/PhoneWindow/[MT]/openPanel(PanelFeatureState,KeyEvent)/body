{
  if (st.isOpen || isDestroyed()) {
    return;
  }
  if (st.featureId == FEATURE_OPTIONS_PANEL) {
    Context context=getContext();
    Configuration config=context.getResources().getConfiguration();
    boolean isXLarge=(config.screenLayout & Configuration.SCREENLAYOUT_SIZE_MASK) == Configuration.SCREENLAYOUT_SIZE_XLARGE;
    boolean isHoneycombApp=context.getApplicationInfo().targetSdkVersion >= android.os.Build.VERSION_CODES.HONEYCOMB;
    if (isXLarge && isHoneycombApp) {
      return;
    }
  }
  Callback cb=getCallback();
  if ((cb != null) && (!cb.onMenuOpened(st.featureId,st.menu))) {
    closePanel(st,true);
    return;
  }
  final WindowManager wm=getWindowManager();
  if (wm == null) {
    return;
  }
  if (!preparePanel(st,event)) {
    return;
  }
  int width=WRAP_CONTENT;
  if (st.decorView == null || st.refreshDecorView) {
    if (st.decorView == null) {
      if (!initializePanelDecor(st) || (st.decorView == null))       return;
    }
 else     if (st.refreshDecorView && (st.decorView.getChildCount() > 0)) {
      st.decorView.removeAllViews();
    }
    if (!initializePanelContent(st) || !st.hasPanelItems()) {
      return;
    }
    ViewGroup.LayoutParams lp=st.shownPanelView.getLayoutParams();
    if (lp == null) {
      lp=new ViewGroup.LayoutParams(WRAP_CONTENT,WRAP_CONTENT);
    }
    int backgroundResId;
    if (lp.width == ViewGroup.LayoutParams.MATCH_PARENT) {
      backgroundResId=st.fullBackground;
      width=MATCH_PARENT;
    }
 else {
      backgroundResId=st.background;
    }
    st.decorView.setWindowBackground(getContext().getResources().getDrawable(backgroundResId));
    st.decorView.addView(st.shownPanelView,lp);
    if (!st.shownPanelView.hasFocus()) {
      st.shownPanelView.requestFocus();
    }
  }
 else   if (!st.isInListMode()) {
    width=MATCH_PARENT;
  }
  st.isOpen=true;
  st.isHandled=false;
  WindowManager.LayoutParams lp=new WindowManager.LayoutParams(width,WRAP_CONTENT,st.x,st.y,WindowManager.LayoutParams.TYPE_APPLICATION_ATTACHED_DIALOG,WindowManager.LayoutParams.FLAG_DITHER | WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM | WindowManager.LayoutParams.FLAG_SPLIT_TOUCH,st.decorView.mDefaultOpacity);
  if (st.isCompact) {
    lp.gravity=getOptionsPanelGravity();
    sRotationWatcher.addWindow(this);
  }
 else {
    lp.gravity=st.gravity;
  }
  lp.windowAnimations=st.windowAnimations;
  wm.addView(st.decorView,lp);
}
