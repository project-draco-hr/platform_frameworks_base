{
  if (mActionBar != null) {
    final Callback cb=getCallback();
    if (!mActionBar.isOverflowMenuShowing() || !toggleMenuMode) {
      if (cb != null) {
        final PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
        if (cb.onPreparePanel(FEATURE_OPTIONS_PANEL,st.createdPanelView,st.menu)) {
          cb.onMenuOpened(FEATURE_ACTION_BAR,st.menu);
          mActionBar.openOverflowMenu();
        }
      }
    }
 else {
      mActionBar.hideOverflowMenu();
      if (cb != null) {
        final PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
        cb.onPanelClosed(FEATURE_ACTION_BAR,st.menu);
      }
    }
    return;
  }
  PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
  boolean newExpandedMode=toggleMenuMode ? !st.isInExpandedMode : st.isInExpandedMode;
  st.refreshDecorView=true;
  closePanel(st,false);
  st.isInExpandedMode=newExpandedMode;
  openPanel(st,null);
}
