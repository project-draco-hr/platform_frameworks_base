{
  mContext=context;
  mAudioManager=(AudioManager)context.getSystemService(Context.AUDIO_SERVICE);
  mAudioService=volumeService;
  LayoutInflater inflater=(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
  View view=mView=inflater.inflate(R.layout.volume_adjust,null);
  mView.setOnTouchListener(new View.OnTouchListener(){
    public boolean onTouch(    View v,    MotionEvent event){
      resetTimeout();
      return true;
    }
  }
);
  mSliderGroup=(ViewGroup)mView.findViewById(R.id.slider_group);
  mMoreButton=(ImageView)mView.findViewById(R.id.expand_button);
  mDivider=(ImageView)mView.findViewById(R.id.expand_button_divider);
  mDialog=new Dialog(context,R.style.Theme_Panel_Volume);
  mDialog.setTitle("Volume control");
  mDialog.setContentView(mView);
  mDialog.setOnDismissListener(new OnDismissListener(){
    public void onDismiss(    DialogInterface dialog){
      mActiveStreamType=-1;
      mAudioManager.forceVolumeControlStream(mActiveStreamType);
    }
  }
);
  Window window=mDialog.getWindow();
  window.setGravity(Gravity.TOP);
  WindowManager.LayoutParams lp=window.getAttributes();
  lp.token=null;
  lp.type=WindowManager.LayoutParams.TYPE_SYSTEM_ALERT;
  window.setAttributes(lp);
  window.addFlags(WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM);
  mToneGenerators=new ToneGenerator[AudioSystem.getNumStreamTypes()];
  mVibrator=new Vibrator();
  mShowCombinedVolumes=!context.getResources().getBoolean(R.bool.config_voice_capable);
  if (!mShowCombinedVolumes) {
    mMoreButton.setVisibility(View.GONE);
    mDivider.setVisibility(View.GONE);
  }
 else {
    mMoreButton.setOnClickListener(this);
  }
  listenToRingerMode();
}
