{
  Enumeration<NetworkInterface> ifces=NetworkInterface.getNetworkInterfaces();
  for (; ifces.hasMoreElements(); ) {
    NetworkInterface ni=ifces.nextElement();
    int gateway=NetworkUtils.getDefaultRoute(ni.getName());
    if (gateway == 0)     continue;
    Enumeration<InetAddress> addrs=ni.getInetAddresses();
    for (; addrs.hasMoreElements(); ) {
      return addrs.nextElement().getHostAddress();
    }
  }
  throw new IOException("Host IP is not available");
}
