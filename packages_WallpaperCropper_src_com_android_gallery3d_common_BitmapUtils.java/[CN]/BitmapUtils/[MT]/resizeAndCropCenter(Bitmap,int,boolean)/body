{
  int w=bitmap.getWidth();
  int h=bitmap.getHeight();
  if (w == size && h == size)   return bitmap;
  float scale=(float)size / Math.min(w,h);
  Bitmap target=Bitmap.createBitmap(size,size,getConfig(bitmap));
  int width=Math.round(scale * bitmap.getWidth());
  int height=Math.round(scale * bitmap.getHeight());
  Canvas canvas=new Canvas(target);
  canvas.translate((size - width) / 2f,(size - height) / 2f);
  canvas.scale(scale,scale);
  Paint paint=new Paint(Paint.FILTER_BITMAP_FLAG | Paint.DITHER_FLAG);
  canvas.drawBitmap(bitmap,0,0,paint);
  if (recycle)   bitmap.recycle();
  return target;
}
