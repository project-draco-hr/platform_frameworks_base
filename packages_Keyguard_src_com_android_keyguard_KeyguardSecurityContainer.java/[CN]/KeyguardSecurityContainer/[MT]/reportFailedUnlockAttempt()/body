{
  final KeyguardUpdateMonitor monitor=KeyguardUpdateMonitor.getInstance(mContext);
  final int failedAttempts=monitor.getFailedUnlockAttempts() + 1;
  if (DEBUG)   Log.d(TAG,"reportFailedPatternAttempt: #" + failedAttempts);
  SecurityMode mode=mSecurityModel.getSecurityMode();
  final boolean usingPattern=mode == KeyguardSecurityModel.SecurityMode.Pattern;
  final int currentUser=mLockPatternUtils.getCurrentUser();
  final DevicePolicyManager dpm=mLockPatternUtils.getDevicePolicyManager();
  final int failedAttemptsBeforeWipe=dpm.getMaximumFailedPasswordsForWipe(null,currentUser);
  final int remainingBeforeWipe=failedAttemptsBeforeWipe > 0 ? (failedAttemptsBeforeWipe - failedAttempts) : Integer.MAX_VALUE;
  boolean showTimeout=false;
  if (remainingBeforeWipe < LockPatternUtils.FAILED_ATTEMPTS_BEFORE_WIPE_GRACE) {
    final int expiringUser=dpm.getProfileWithMinimumFailedPasswordsForWipe(currentUser);
    int userType=USER_TYPE_PRIMARY;
    if (expiringUser == currentUser) {
      if (expiringUser != UserHandle.USER_OWNER) {
        userType=USER_TYPE_SECONDARY_USER;
      }
    }
 else     if (expiringUser != UserHandle.USER_NULL) {
      userType=USER_TYPE_WORK_PROFILE;
    }
    if (remainingBeforeWipe > 0) {
      showAlmostAtWipeDialog(failedAttempts,remainingBeforeWipe,userType);
    }
 else {
      Slog.i(TAG,"Too many unlock attempts; user " + expiringUser + " will be wiped!");
      showWipeDialog(failedAttempts,userType);
    }
  }
 else {
    showTimeout=(failedAttempts % LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT) == 0;
  }
  monitor.reportFailedUnlockAttempt();
  mLockPatternUtils.reportFailedPasswordAttempt(mLockPatternUtils.getCurrentUser());
  if (showTimeout) {
    showTimeoutDialog();
  }
}
