{
  final KeyguardUpdateMonitor monitor=KeyguardUpdateMonitor.getInstance(mContext);
  final int failedAttempts=monitor.getFailedUnlockAttempts(userId) + 1;
  if (DEBUG)   Log.d(TAG,"reportFailedPatternAttempt: #" + failedAttempts);
  final DevicePolicyManager dpm=mLockPatternUtils.getDevicePolicyManager();
  final int failedAttemptsBeforeWipe=dpm.getMaximumFailedPasswordsForWipe(null,userId);
  final int remainingBeforeWipe=failedAttemptsBeforeWipe > 0 ? (failedAttemptsBeforeWipe - failedAttempts) : Integer.MAX_VALUE;
  if (remainingBeforeWipe < LockPatternUtils.FAILED_ATTEMPTS_BEFORE_WIPE_GRACE) {
    final int expiringUser=dpm.getProfileWithMinimumFailedPasswordsForWipe(userId);
    int userType=USER_TYPE_PRIMARY;
    if (expiringUser == userId) {
      if (expiringUser != UserHandle.USER_SYSTEM) {
        userType=USER_TYPE_SECONDARY_USER;
      }
    }
 else     if (expiringUser != UserHandle.USER_NULL) {
      userType=USER_TYPE_WORK_PROFILE;
    }
    if (remainingBeforeWipe > 0) {
      showAlmostAtWipeDialog(failedAttempts,remainingBeforeWipe,userType);
    }
 else {
      Slog.i(TAG,"Too many unlock attempts; user " + expiringUser + " will be wiped!");
      showWipeDialog(failedAttempts,userType);
    }
  }
  monitor.reportFailedStrongAuthUnlockAttempt(userId);
  mLockPatternUtils.reportFailedPasswordAttempt(userId);
  if (timeoutMs > 0) {
    showTimeoutDialog(timeoutMs);
  }
}
