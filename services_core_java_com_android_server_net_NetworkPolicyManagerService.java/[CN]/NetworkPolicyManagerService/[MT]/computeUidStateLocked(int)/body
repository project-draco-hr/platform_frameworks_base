{
  final SparseIntArray pidState=mUidPidState.get(uid);
  int uidState=ActivityManager.PROCESS_STATE_CACHED_EMPTY;
  if (pidState != null) {
    final int size=pidState.size();
    for (int i=0; i < size; i++) {
      final int state=pidState.valueAt(i);
      if (state < uidState) {
        uidState=state;
      }
    }
  }
  final int oldUidState=mUidState.get(uid,ActivityManager.PROCESS_STATE_CACHED_EMPTY);
  if (oldUidState != uidState) {
    mUidState.put(uid,uidState);
    final boolean oldForeground=oldUidState <= mCurForegroundState;
    final boolean newForeground=uidState <= mCurForegroundState;
    if (oldForeground != newForeground) {
      updateRulesForUidLocked(uid);
    }
  }
}
