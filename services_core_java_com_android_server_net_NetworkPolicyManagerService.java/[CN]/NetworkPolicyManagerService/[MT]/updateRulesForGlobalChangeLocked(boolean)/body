{
  long start;
  if (LOGD)   start=System.currentTimeMillis();
  final PackageManager pm=mContext.getPackageManager();
  updateRulesForDeviceIdleLocked();
  updateRulesForAppIdleLocked();
  updateRulesForRestrictPowerLocked();
  final List<UserInfo> users=mUserManager.getUsers();
  final List<ApplicationInfo> apps=pm.getInstalledApplications(PackageManager.MATCH_UNINSTALLED_PACKAGES | PackageManager.MATCH_DISABLED_COMPONENTS | PackageManager.MATCH_DIRECT_BOOT_AWARE| PackageManager.MATCH_DIRECT_BOOT_UNAWARE);
  final int usersSize=users.size();
  final int appsSize=apps.size();
  for (int i=0; i < usersSize; i++) {
    final UserInfo user=users.get(i);
    for (int j=0; j < appsSize; j++) {
      final ApplicationInfo app=apps.get(j);
      final int uid=UserHandle.getUid(user.id,app.uid);
      updateRulesForUidLocked(uid);
    }
  }
  updateRulesForUidLocked(android.os.Process.MEDIA_UID);
  updateRulesForUidLocked(android.os.Process.DRM_UID);
  if (restrictedNetworksChanged) {
    normalizePoliciesLocked();
    updateNetworkRulesLocked();
  }
  if (LOGD) {
    final long delta=System.currentTimeMillis() - start;
    Slog.d(TAG,"updateRulesForGlobalChangeLocked(" + restrictedNetworksChanged + ") took "+ delta+ "ms");
  }
}
