{
  final PackageManager pm=mContext.getPackageManager();
  final UserManager um=(UserManager)mContext.getSystemService(Context.USER_SERVICE);
  mCurForegroundState=(!mRestrictBackground && mRestrictPower) ? ActivityManager.PROCESS_STATE_IMPORTANT_FOREGROUND : ActivityManager.PROCESS_STATE_TOP;
  final List<UserInfo> users=um.getUsers();
  final List<ApplicationInfo> apps=pm.getInstalledApplications(PackageManager.GET_UNINSTALLED_PACKAGES | PackageManager.GET_DISABLED_COMPONENTS);
  for (  UserInfo user : users) {
    for (    ApplicationInfo app : apps) {
      final int uid=UserHandle.getUid(user.id,app.uid);
      updateRulesForUidLocked(uid);
    }
  }
  updateRulesForUidLocked(android.os.Process.MEDIA_UID);
  updateRulesForUidLocked(android.os.Process.DRM_UID);
  if (restrictedNetworksChanged) {
    normalizePoliciesLocked();
    updateNetworkRulesLocked();
  }
}
