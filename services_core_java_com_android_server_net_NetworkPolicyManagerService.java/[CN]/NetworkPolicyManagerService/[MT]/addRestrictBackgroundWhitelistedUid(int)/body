{
  mContext.enforceCallingOrSelfPermission(MANAGE_NETWORK_POLICY,TAG);
  final boolean oldStatus;
synchronized (mRulesLock) {
    oldStatus=mRestrictBackgroundWhitelistUids.get(uid);
    if (oldStatus) {
      if (LOGD)       Slog.d(TAG,"uid " + uid + " is already whitelisted");
      return;
    }
    if (!isUidValidForWhitelistRules(uid)) {
      if (LOGD)       Slog.d(TAG,"no need to whitelist uid " + uid);
      return;
    }
    Slog.i(TAG,"adding uid " + uid + " to restrict background whitelist");
    mRestrictBackgroundWhitelistUids.append(uid,true);
    if (mDefaultRestrictBackgroundWhitelistUids.get(uid) && mRestrictBackgroundWhitelistRevokedUids.get(uid)) {
      if (LOGD)       Slog.d(TAG,"Removing uid " + uid + " from revoked restrict background whitelist");
      mRestrictBackgroundWhitelistRevokedUids.delete(uid);
    }
    updateRuleForRestrictBackgroundLocked(uid);
    writePolicyLocked();
  }
  if (mRestrictBackground && !oldStatus) {
    mHandler.obtainMessage(MSG_RESTRICT_BACKGROUND_WHITELIST_CHANGED,uid,0).sendToTarget();
  }
}
