{
  mContext.enforceCallingOrSelfPermission(MANAGE_NETWORK_POLICY,TAG);
  try {
    mContext.enforceCallingOrSelfPermission(READ_PRIVILEGED_PHONE_STATE,TAG);
  }
 catch (  SecurityException e) {
    mContext.enforceCallingOrSelfPermission(READ_PHONE_STATE,TAG);
    if (mAppOps.noteOp(AppOpsManager.OP_READ_PHONE_STATE,Binder.getCallingUid(),callingPackage) != AppOpsManager.MODE_ALLOWED) {
      return new NetworkPolicy[0];
    }
  }
synchronized (mRulesLock) {
    final int size=mNetworkPolicy.size();
    final NetworkPolicy[] policies=new NetworkPolicy[size];
    for (int i=0; i < size; i++) {
      policies[i]=mNetworkPolicy.valueAt(i);
    }
    return policies;
  }
}
