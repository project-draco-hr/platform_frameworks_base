{
  final boolean oldStatus=mRestrictBackgroundWhitelistUids.get(uid);
  if (!oldStatus) {
    if (LOGD)     Slog.d(TAG,"uid " + uid + " was not whitelisted before");
    return false;
  }
  Slog.i(TAG,"removing uid " + uid + " from restrict background whitelist");
  final boolean changed=mRestrictBackground && oldStatus;
  mRestrictBackgroundWhitelistUids.delete(uid);
  if (mDefaultRestrictBackgroundWhitelistUids.get(uid) && !mRestrictBackgroundWhitelistRevokedUids.get(uid)) {
    if (LOGD)     Slog.d(TAG,"Adding uid " + uid + " to revoked restrict background whitelist");
    mRestrictBackgroundWhitelistRevokedUids.append(uid,true);
  }
  if (updateNow) {
    if (changed && hasInternetPermissions(uid)) {
      setUidNetworkRules(uid,true);
    }
    writePolicyLocked();
  }
  return changed;
}
