{
  mDialog=new CustomDialog(mContext);
  mSpTexts=new SpTexts(mContext);
  mLayoutTransition=new LayoutTransition();
  mLayoutTransition.setDuration(new ValueAnimator().getDuration() / 2);
  mHovering=false;
  mShowing=false;
  final Window window=mDialog.getWindow();
  window.requestFeature(Window.FEATURE_NO_TITLE);
  window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));
  window.clearFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND);
  window.addFlags(WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN | WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL| WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED| WindowManager.LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH| WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED);
  mDialog.setCanceledOnTouchOutside(true);
  final Resources res=mContext.getResources();
  final WindowManager.LayoutParams lp=window.getAttributes();
  lp.type=mWindowType;
  lp.format=PixelFormat.TRANSLUCENT;
  lp.setTitle(VolumeDialog.class.getSimpleName());
  lp.gravity=Gravity.TOP | Gravity.CENTER_HORIZONTAL;
  lp.y=res.getDimensionPixelSize(R.dimen.volume_offset_top);
  lp.gravity=Gravity.TOP;
  lp.windowAnimations=-1;
  window.setAttributes(lp);
  window.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_NOTHING);
  mDialog.setContentView(R.layout.volume_dialog);
  mDialogView=(ViewGroup)mDialog.findViewById(R.id.volume_dialog);
  mDialogView.setOnHoverListener(new View.OnHoverListener(){
    @Override public boolean onHover(    View v,    MotionEvent event){
      int action=event.getActionMasked();
      mHovering=(action == MotionEvent.ACTION_HOVER_ENTER) || (action == MotionEvent.ACTION_HOVER_MOVE);
      rescheduleTimeoutH();
      return true;
    }
  }
);
  mDialogContentView=(ViewGroup)mDialog.findViewById(R.id.volume_dialog_content);
  mExpanded=false;
  mExpandButton=(ImageButton)mDialogView.findViewById(R.id.volume_expand_button);
  mExpandButton.setOnClickListener(mClickExpand);
  updateWindowWidthH();
  updateExpandButtonH();
  mDialogContentView.setLayoutTransition(mLayoutTransition);
  mMotion=new VolumeDialogMotion(mDialog,mDialogView,mDialogContentView,mExpandButton,new VolumeDialogMotion.Callback(){
    @Override public void onAnimatingChanged(    boolean animating){
      if (animating)       return;
      if (mPendingStateChanged) {
        mHandler.sendEmptyMessage(H.STATE_CHANGED);
        mPendingStateChanged=false;
      }
      if (mPendingRecheckAll) {
        mHandler.sendEmptyMessage(H.RECHECK_ALL);
        mPendingRecheckAll=false;
      }
    }
  }
);
  if (mRows.isEmpty()) {
    addRow(AudioManager.STREAM_RING,R.drawable.ic_volume_ringer,R.drawable.ic_volume_ringer_mute,true);
    addRow(AudioManager.STREAM_MUSIC,R.drawable.ic_volume_media,R.drawable.ic_volume_media_mute,true);
    addRow(AudioManager.STREAM_ALARM,R.drawable.ic_volume_alarm,R.drawable.ic_volume_alarm_mute,false);
    addRow(AudioManager.STREAM_VOICE_CALL,R.drawable.ic_volume_voice,R.drawable.ic_volume_voice,false);
    addRow(AudioManager.STREAM_BLUETOOTH_SCO,R.drawable.ic_volume_bt_sco,R.drawable.ic_volume_bt_sco,false);
    addRow(AudioManager.STREAM_SYSTEM,R.drawable.ic_volume_system,R.drawable.ic_volume_system_mute,false);
  }
 else {
    addExistingRows();
  }
  mExpandButtonAnimationDuration=res.getInteger(R.integer.volume_expand_animation_duration);
  mZenFooter=(ZenFooter)mDialog.findViewById(R.id.volume_zen_footer);
  mZenFooter.init(mZenModeController);
  mZenPanel=(TunerZenModePanel)mDialog.findViewById(R.id.tuner_zen_mode_panel);
  mZenPanel.init(mZenModeController);
  mZenPanel.setCallback(mZenPanelCallback);
}
