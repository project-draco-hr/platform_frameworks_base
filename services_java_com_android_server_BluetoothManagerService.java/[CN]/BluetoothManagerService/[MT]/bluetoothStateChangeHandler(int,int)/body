{
  if (prevState != newState) {
    if (newState == BluetoothAdapter.STATE_ON || newState == BluetoothAdapter.STATE_OFF) {
      boolean isUp=(newState == BluetoothAdapter.STATE_ON);
      sendBluetoothStateCallback(isUp);
      if (isUp) {
        Intent i=new Intent(IBluetoothGatt.class.getName());
        if (!mContext.bindServiceAsUser(i,mConnection,Context.BIND_AUTO_CREATE,UserHandle.CURRENT)) {
          Log.e(TAG,"Fail to bind to: " + IBluetoothGatt.class.getName());
        }
      }
 else {
        if (!isUp && canUnbindBluetoothService()) {
          sendBluetoothServiceDownCallback();
          unbindAndFinish();
        }
      }
    }
    Intent intent=new Intent(BluetoothAdapter.ACTION_STATE_CHANGED);
    intent.putExtra(BluetoothAdapter.EXTRA_PREVIOUS_STATE,prevState);
    intent.putExtra(BluetoothAdapter.EXTRA_STATE,newState);
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
    if (DBG)     Log.d(TAG,"Bluetooth State Change Intent: " + prevState + " -> "+ newState);
    mContext.sendBroadcastAsUser(intent,UserHandle.ALL,BLUETOOTH_PERM);
  }
}
