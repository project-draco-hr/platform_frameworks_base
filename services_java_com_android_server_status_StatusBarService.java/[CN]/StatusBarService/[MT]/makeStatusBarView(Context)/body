{
  Resources res=context.getResources();
  mRightIconSlots=res.getStringArray(com.android.internal.R.array.status_bar_icon_order);
  mRightIcons=new StatusBarIcon[mRightIconSlots.length];
  ExpandedView expanded=(ExpandedView)View.inflate(context,com.android.internal.R.layout.status_bar_expanded,null);
  expanded.mService=this;
  StatusBarView sb=(StatusBarView)View.inflate(context,com.android.internal.R.layout.status_bar,null);
  sb.mService=this;
  int pixelFormat=PixelFormat.TRANSLUCENT;
  Drawable bg=sb.getBackground();
  if (bg != null) {
    pixelFormat=bg.getOpacity();
  }
  mStatusBarView=sb;
  mStatusIcons=(LinearLayout)sb.findViewById(R.id.statusIcons);
  mNotificationIcons=(IconMerger)sb.findViewById(R.id.notificationIcons);
  mNotificationIcons.service=this;
  mIcons=(LinearLayout)sb.findViewById(R.id.icons);
  mTickerView=sb.findViewById(R.id.ticker);
  mDateView=(DateView)sb.findViewById(R.id.date);
  mExpandedDialog=new ExpandedDialog(context);
  mExpandedView=expanded;
  mOngoingTitle=expanded.findViewById(R.id.ongoingTitle);
  mOngoingItems=(LinearLayout)expanded.findViewById(R.id.ongoingItems);
  mLatestTitle=expanded.findViewById(R.id.latestTitle);
  mLatestItems=(LinearLayout)expanded.findViewById(R.id.latestItems);
  mNoNotificationsTitle=expanded.findViewById(R.id.noNotificationsTitle);
  mClearButton=expanded.findViewById(R.id.clear_all_button);
  mClearButton.setOnClickListener(mClearButtonListener);
  mSpnLabel=(TextView)expanded.findViewById(R.id.spnLabel);
  mPlmnLabel=(TextView)expanded.findViewById(R.id.plmnLabel);
  mScrollView=(ScrollView)expanded.findViewById(R.id.scroll);
  mNotificationLinearLayout=expanded.findViewById(R.id.notificationLinearLayout);
  mOngoingTitle.setVisibility(View.GONE);
  mLatestTitle.setVisibility(View.GONE);
  mTicker=new MyTicker(context,sb);
  TickerView tickerView=(TickerView)sb.findViewById(R.id.tickerText);
  tickerView.mTicker=mTicker;
  mTrackingView=(TrackingView)View.inflate(context,com.android.internal.R.layout.status_bar_tracking,null);
  mTrackingView.mService=this;
  mCloseView=(CloseDragHandle)mTrackingView.findViewById(R.id.close);
  mCloseView.mService=this;
  WindowManager.LayoutParams lp=new WindowManager.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,25,WindowManager.LayoutParams.TYPE_STATUS_BAR,WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_TOUCHABLE_WHEN_WAKING,pixelFormat);
  lp.gravity=Gravity.TOP | Gravity.FILL_HORIZONTAL;
  lp.setTitle("StatusBar");
  WindowManagerImpl.getDefault().addView(sb,lp);
  IconData moreData=IconData.makeIcon(null,context.getPackageName(),R.drawable.stat_notify_more,0,42);
  mMoreIcon=new StatusBarIcon(context,moreData,mNotificationIcons);
  mMoreIcon.view.setId(R.drawable.stat_notify_more);
  mNotificationIcons.moreIcon=mMoreIcon;
  mNotificationIcons.addView(mMoreIcon.view);
  setAreThereNotifications();
  mDateView.setVisibility(View.INVISIBLE);
  mPlmnLabel.setText(R.string.lockscreen_carrier_default);
  mPlmnLabel.setVisibility(View.VISIBLE);
  mSpnLabel.setText("");
  mSpnLabel.setVisibility(View.GONE);
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_CLOSE_SYSTEM_DIALOGS);
  filter.addAction(Telephony.Intents.SPN_STRINGS_UPDATED_ACTION);
  context.registerReceiver(mBroadcastReceiver,filter);
}
