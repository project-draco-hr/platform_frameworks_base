{
  if (SPEW) {
    Log.d(TAG,"updateExpandedViewPos before expandedPosition=" + expandedPosition + " mTrackingParams.y="+ mTrackingParams.y+ " mTrackingPosition="+ mTrackingPosition);
  }
  int h=mStatusBarView.getHeight();
  int disph=mDisplay.getHeight();
  if (!mExpandedVisible) {
    if (mTrackingView != null) {
      mTrackingPosition=mTrackingParams.y=-disph;
      WindowManagerImpl.getDefault().updateViewLayout(mTrackingView,mTrackingParams);
    }
    if (mExpandedParams != null) {
      mExpandedParams.y=-disph;
      mExpandedDialog.getWindow().setAttributes(mExpandedParams);
    }
    return;
  }
  int pos;
  if (expandedPosition == EXPANDED_FULL_OPEN) {
    pos=h;
  }
 else   if (expandedPosition == EXPANDED_LEAVE_ALONE) {
    pos=mTrackingPosition;
  }
 else {
    if (expandedPosition <= disph) {
      pos=expandedPosition;
    }
 else {
      pos=disph;
    }
    pos-=disph - h;
  }
  mTrackingPosition=mTrackingParams.y=pos;
  mTrackingParams.height=disph - h;
  WindowManagerImpl.getDefault().updateViewLayout(mTrackingView,mTrackingParams);
  mCloseView.getLocationInWindow(mCloseLocation);
  if (mExpandedParams != null) {
    mExpandedParams.y=pos + mTrackingView.getHeight() - (mTrackingParams.height - mCloseLocation[1]) - mExpandedView.getHeight();
    int max=h;
    if (mExpandedParams.y > max) {
      mExpandedParams.y=max;
    }
    int min=mTrackingPosition;
    if (mExpandedParams.y < min) {
      mExpandedParams.y=min;
    }
    panelSlightlyVisible((mTrackingPosition + mTrackingView.getHeight()) > h);
    mExpandedDialog.getWindow().setAttributes(mExpandedParams);
  }
  if (SPEW) {
    Log.d(TAG,"updateExpandedViewPos after  expandedPosition=" + expandedPosition + " mTrackingParams.y="+ mTrackingParams.y+ " mTrackingPosition="+ mTrackingPosition+ " mExpandedParams.y="+ mExpandedParams.y);
  }
}
