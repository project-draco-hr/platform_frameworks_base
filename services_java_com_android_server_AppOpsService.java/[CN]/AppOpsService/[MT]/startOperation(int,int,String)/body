{
  uid=handleIncomingUid(uid);
synchronized (this) {
    Op op=getOpLocked(code,uid,packageName,true);
    if (op == null) {
      if (DEBUG)       Log.d(TAG,"startOperation: no op for code " + code + " uid "+ uid+ " package "+ packageName);
      return AppOpsManager.MODE_IGNORED;
    }
    if (op.mode != AppOpsManager.MODE_ALLOWED) {
      if (DEBUG)       Log.d(TAG,"startOperation: reject #" + op.mode + " for code "+ code+ " uid "+ uid+ " package "+ packageName);
      op.rejectTime=System.currentTimeMillis();
      return op.mode;
    }
    if (DEBUG)     Log.d(TAG,"startOperation: allowing code " + code + " uid "+ uid+ " package "+ packageName);
    if (op.nesting == 0) {
      op.time=System.currentTimeMillis();
      op.duration=-1;
    }
    op.nesting++;
    return AppOpsManager.MODE_ALLOWED;
  }
}
