{
  uid=handleIncomingUid(uid);
synchronized (this) {
    Op op=getOpLocked(code,uid,packageName);
    if (op == null) {
      return AppOpsManager.MODE_IGNORED;
    }
    if (op.duration == -1) {
      Slog.w(TAG,"Noting op not finished: uid " + uid + " pkg "+ packageName+ " code "+ code+ " time="+ op.time+ " duration="+ op.duration);
    }
    op.time=System.currentTimeMillis();
    op.duration=duration;
  }
  return AppOpsManager.MODE_ALLOWED;
}
