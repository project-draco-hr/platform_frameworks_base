{
  DisplayManagerGlobal dm=DisplayManagerGlobal.getInstance();
  VirtualDisplay virtualDisplay;
  long ident=Binder.clearCallingIdentity();
  try {
    virtualDisplay=dm.createVirtualDisplay(mService.mContext,VIRTUAL_DISPLAY_BASE_NAME,width,height,density,surface,DisplayManager.VIRTUAL_DISPLAY_FLAG_PUBLIC);
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
  final Display display=virtualDisplay.getDisplay();
  final int displayId=display.getDisplayId();
  mWindowManager.handleDisplayAdded(displayId);
synchronized (mService) {
    ActivityDisplay activityDisplay=new ActivityDisplay(display);
    mActivityDisplays.put(displayId,activityDisplay);
    attachToDisplayLocked(activityDisplay);
    activityDisplay.mVirtualDisplay=virtualDisplay;
  }
}
