{
  if (mContainerState == CONTAINER_STATE_FINISHING) {
    return;
  }
  VirtualActivityDisplay virtualActivityDisplay=(VirtualActivityDisplay)mActivityDisplay;
  if (virtualActivityDisplay == null) {
    virtualActivityDisplay=new VirtualActivityDisplay(surface,width,height,density);
    mActivityDisplay=virtualActivityDisplay;
    mActivityDisplays.put(virtualActivityDisplay.mDisplayId,virtualActivityDisplay);
    attachToDisplayLocked(virtualActivityDisplay);
  }
  if (mSurface != null) {
    mSurface.release();
    mSurface=null;
  }
  if (surface != null) {
    mContainerState=CONTAINER_STATE_HAS_SURFACE;
    mSurface=surface;
    mStack.resumeTopActivityLocked(null);
  }
 else {
    mContainerState=CONTAINER_STATE_NO_SURFACE;
    if (mStack.mPausingActivity == null && mStack.mResumedActivity != null) {
      mStack.startPausingLocked(false,true);
    }
  }
  if (DEBUG_STACK)   Slog.d(TAG,"setSurface: " + this + " to display="+ virtualActivityDisplay);
  virtualActivityDisplay.setSurface(surface);
}
