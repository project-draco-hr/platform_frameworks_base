{
  ActivityStack stack=mFocusedStack;
  if (stack == null) {
    return null;
  }
  ActivityRecord resumedActivity=stack.mResumedActivity;
  if (resumedActivity == null || resumedActivity.app == null) {
    resumedActivity=stack.mPausingActivity;
    if (resumedActivity == null || resumedActivity.app == null) {
      resumedActivity=stack.topRunningActivityLocked();
    }
  }
  return resumedActivity;
}
