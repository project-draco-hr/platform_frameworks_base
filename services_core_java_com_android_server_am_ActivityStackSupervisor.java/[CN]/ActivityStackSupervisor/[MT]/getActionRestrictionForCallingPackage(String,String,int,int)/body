{
  if (action == null) {
    return ACTION_RESTRICTION_NONE;
  }
  String permission=ACTION_TO_RUNTIME_PERMISSION.get(action);
  if (permission == null) {
    return ACTION_RESTRICTION_NONE;
  }
  final PackageInfo packageInfo;
  try {
    packageInfo=mService.mContext.getPackageManager().getPackageInfo(callingPackage,PackageManager.GET_PERMISSIONS);
  }
 catch (  PackageManager.NameNotFoundException e) {
    Slog.i(TAG,"Cannot find package info for " + callingPackage);
    return ACTION_RESTRICTION_NONE;
  }
  if (!ArrayUtils.contains(packageInfo.requestedPermissions,permission)) {
    return ACTION_RESTRICTION_NONE;
  }
  if (mService.checkPermission(permission,callingPid,callingUid) == PackageManager.PERMISSION_DENIED) {
    return ACTION_RESTRICTION_PERMISSION;
  }
  final int opCode=AppOpsManager.permissionToOpCode(permission);
  if (opCode == AppOpsManager.OP_NONE) {
    return ACTION_RESTRICTION_NONE;
  }
  if (mService.mAppOpsService.noteOperation(opCode,callingUid,callingPackage) != AppOpsManager.MODE_ALLOWED) {
    return ACTION_RESTRICTION_APPOP;
  }
  return ACTION_RESTRICTION_NONE;
}
