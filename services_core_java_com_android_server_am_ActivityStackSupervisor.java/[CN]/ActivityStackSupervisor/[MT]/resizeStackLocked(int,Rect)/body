{
  final ActivityStack stack=getStack(stackId);
  if (stack == null) {
    Slog.w(TAG,"resizeStack: stackId " + stackId + " not found.");
    return;
  }
  ActivityRecord r=stack.topRunningActivityLocked(null);
  final boolean resizeTasks=r != null && r.task.mResizeable;
  final IntArray changedTaskIds=new IntArray(stack.numTasks());
  final List<Configuration> newTaskConfigs=new ArrayList<>(stack.numTasks());
  stack.mFullscreen=mWindowManager.resizeStack(stackId,bounds,resizeTasks,changedTaskIds,newTaskConfigs);
  for (int i=changedTaskIds.size() - 1; i >= 0; i--) {
    final TaskRecord task=anyTaskForIdLocked(changedTaskIds.get(i),false);
    if (task == null) {
      Slog.wtf(TAG,"Task in WindowManager, but not in ActivityManager???");
      continue;
    }
    task.updateOverrideConfiguration(newTaskConfigs.get(i),bounds);
  }
  if (stack.mStackId == DOCKED_STACK_ID) {
    if (stack.mFullscreen) {
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (i != DOCKED_STACK_ID) {
          resizeStackLocked(i,null);
        }
      }
      final ArrayList<TaskRecord> tasks=stack.getAllTasks();
      final int count=tasks.size();
      for (int i=0; i < count; i++) {
        moveTaskToStackLocked(tasks.get(i).taskId,FULLSCREEN_WORKSPACE_STACK_ID,ON_TOP,FORCE_FOCUS);
      }
      r=null;
    }
 else {
      final int leftChange=stack.mBounds.left - bounds.left;
      final int rightChange=stack.mBounds.right - bounds.right;
      final int topChange=stack.mBounds.top - bounds.top;
      final int bottomChange=stack.mBounds.bottom - bounds.bottom;
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (i != DOCKED_STACK_ID) {
          ActivityStack otherStack=getStack(i);
          if (otherStack != null) {
            tempRect.set(otherStack.mBounds);
            tempRect.left-=rightChange;
            tempRect.right-=leftChange;
            tempRect.top-=bottomChange;
            tempRect.bottom-=topChange;
            resizeStackLocked(i,tempRect);
          }
        }
      }
    }
  }
  stack.mBounds=stack.mFullscreen ? null : new Rect(bounds);
  if (r != null) {
    final boolean updated=stack.ensureActivityConfigurationLocked(r,0);
    ensureActivitiesVisibleLocked(r,0);
    if (!updated) {
      resumeTopActivitiesLocked(stack,null,null);
    }
  }
}
