{
  final ActivityStack stack=getStack(stackId);
  if (stack == null) {
    Slog.w(TAG,"resizeStack: stackId " + stackId + " not found.");
    return;
  }
  ActivityRecord r=stack.topRunningActivityLocked(null);
  final boolean resizeTasks=r != null && r.task.mResizeable;
  mTmpBounds.clear();
  mTmpConfigs.clear();
  if (resizeTasks) {
    ArrayList<TaskRecord> tasks=stack.getAllTasks();
    for (int i=tasks.size() - 1; i >= 0; i--) {
      TaskRecord task=tasks.get(i);
      task.updateOverrideConfiguration(bounds);
      mTmpConfigs.put(task.taskId,task.mOverrideConfig);
      mTmpBounds.put(task.taskId,task.mBounds);
    }
  }
  stack.mFullscreen=mWindowManager.resizeStack(stackId,bounds,resizeTasks,mTmpConfigs,mTmpBounds);
  if (stack.mStackId == DOCKED_STACK_ID) {
    if (stack.mFullscreen) {
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (i != DOCKED_STACK_ID) {
          resizeStackLocked(i,null);
        }
      }
      final ArrayList<TaskRecord> tasks=stack.getAllTasks();
      final int count=tasks.size();
      for (int i=0; i < count; i++) {
        moveTaskToStackLocked(tasks.get(i).taskId,FULLSCREEN_WORKSPACE_STACK_ID,ON_TOP,FORCE_FOCUS);
      }
      r=null;
    }
 else {
      final int leftChange=stack.mBounds.left - bounds.left;
      final int rightChange=stack.mBounds.right - bounds.right;
      final int topChange=stack.mBounds.top - bounds.top;
      final int bottomChange=stack.mBounds.bottom - bounds.bottom;
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (i != DOCKED_STACK_ID) {
          ActivityStack otherStack=getStack(i);
          if (otherStack != null) {
            tempRect.set(otherStack.mBounds);
            tempRect.left-=rightChange;
            tempRect.right-=leftChange;
            tempRect.top-=bottomChange;
            tempRect.bottom-=topChange;
            resizeStackLocked(i,tempRect);
          }
        }
      }
    }
  }
  stack.setBounds(bounds);
  if (r != null) {
    final boolean updated=stack.ensureActivityConfigurationLocked(r,0);
    ensureActivitiesVisibleLocked(r,0);
    if (!updated) {
      resumeTopActivitiesLocked(stack,null,null);
    }
  }
}
