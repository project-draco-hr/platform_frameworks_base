{
  final ActivityStack stack=getStack(fromStackId);
  if (stack == null) {
    return;
  }
  mWindowManager.deferSurfaceLayout();
  try {
    if (fromStackId == DOCKED_STACK_ID) {
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (StackId.isResizeableByDockedStack(i)) {
          ActivityStack otherStack=getStack(i);
          if (otherStack != null) {
            resizeStackLocked(i,null,null,null,PRESERVE_WINDOWS,true,DEFER_RESUME);
          }
        }
      }
      mAllowDockedStackResize=false;
    }
    final ArrayList<TaskRecord> tasks=stack.getAllTasks();
    final int size=tasks.size();
    if (onTop) {
      for (int i=0; i < size; i++) {
        moveTaskToStackLocked(tasks.get(i).taskId,FULLSCREEN_WORKSPACE_STACK_ID,onTop,onTop,"moveTasksToFullscreenStack",ANIMATE,DEFER_RESUME);
      }
      ensureActivitiesVisibleLocked(null,0,PRESERVE_WINDOWS);
      resumeFocusedStackTopActivityLocked();
    }
 else {
      for (int i=size - 1; i >= 0; i--) {
        positionTaskInStackLocked(tasks.get(i).taskId,FULLSCREEN_WORKSPACE_STACK_ID,0);
      }
    }
  }
  finally {
    mAllowDockedStackResize=true;
    mWindowManager.continueSurfaceLayout();
  }
}
