{
  final ActivityStack stack=r.task.stack;
  if (stack == null) {
    if (DEBUG_MEDIA_VISIBILITY)     Slog.d(TAG,"setMediaPlaying: r=" + r + " playing="+ playing+ " stack is null");
    return false;
  }
  final boolean isPlaying=stack.isMediaPlaying();
  if (DEBUG_MEDIA_VISIBILITY)   Slog.d(TAG,"setMediaPlayer: r=" + r + " playing="+ playing+ " isPlaying="+ isPlaying);
  final ActivityRecord top=topRunningActivityLocked();
  if (top == null || top == r || (playing == isPlaying)) {
    if (DEBUG_MEDIA_VISIBILITY)     Slog.d(TAG,"setMediaPlaying: quick return");
    stack.setMediaPlayer(playing ? r : null);
    return true;
  }
  if (top.fullscreen || top.state != ActivityState.RESUMED || top.app == null || top.app.thread == null) {
    if (DEBUG_MEDIA_VISIBILITY)     Slog.d(TAG,"setMediaPlaying: returning top.fullscreen=" + top.fullscreen + " top.state="+ top.state+ " top.app="+ top.app+ " top.app.thread="+ top.app.thread);
    return false;
  }
  stack.setMediaPlayer(playing ? r : null);
  try {
    top.app.thread.scheduleBackgroundMediaPlayingChanged(top.appToken,playing);
  }
 catch (  RemoteException e) {
  }
  return true;
}
