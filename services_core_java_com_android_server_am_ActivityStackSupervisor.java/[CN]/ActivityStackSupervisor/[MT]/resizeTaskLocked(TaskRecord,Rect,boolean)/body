{
  if (!task.mResizeable) {
    Slog.w(TAG,"resizeTask: task " + task + " not resizeable.");
    return;
  }
  if (task.mBounds != null && task.mBounds.equals(bounds) && !resizedByUser) {
    return;
  }
  if (!mWindowManager.isValidTaskId(task.taskId)) {
    task.updateOverrideConfiguration(bounds);
    if (task.stack != null && task.stack.mStackId != FREEFORM_WORKSPACE_STACK_ID) {
      restoreRecentTaskLocked(task,FREEFORM_WORKSPACE_STACK_ID);
    }
    return;
  }
  int stackId=task.stack.mStackId;
  if (bounds == null && stackId != FULLSCREEN_WORKSPACE_STACK_ID) {
    stackId=FULLSCREEN_WORKSPACE_STACK_ID;
  }
 else   if (bounds != null && stackId != FREEFORM_WORKSPACE_STACK_ID && stackId != DOCKED_STACK_ID) {
    stackId=FREEFORM_WORKSPACE_STACK_ID;
  }
  final boolean changedStacks=stackId != task.stack.mStackId;
  if (changedStacks) {
    moveTaskToStackUncheckedLocked(task,stackId,ON_TOP,!FORCE_FOCUS,"resizeTask");
  }
  final Configuration overrideConfig=task.updateOverrideConfiguration(bounds);
  boolean kept=true;
  if (overrideConfig != null) {
    ActivityRecord r=task.topRunningActivityLocked(null);
    if (r != null) {
      final ActivityStack stack=task.stack;
      final boolean preserveWindow=resizedByUser && !changedStacks;
      kept=stack.ensureActivityConfigurationLocked(r,0,preserveWindow);
      ensureActivitiesVisibleLocked(r,0);
      if (!kept) {
        resumeTopActivitiesLocked(stack,null,null);
        if (changedStacks && stackId == FULLSCREEN_WORKSPACE_STACK_ID) {
          mWindowManager.setReplacingWindow(r.appToken,true);
        }
      }
    }
  }
  mWindowManager.resizeTask(task.taskId,bounds,task.mOverrideConfig,kept);
}
