{
  final ActivityStack stack=getStack(stackId,!CREATE_IF_NEEDED,!ON_TOP);
  if (stack == null) {
    throw new IllegalArgumentException("moveTopStackActivityToPinnedStackLocked: Unknown stackId=" + stackId);
  }
  final ActivityRecord r=stack.topRunningActivityLocked();
  if (r == null) {
    Slog.w(TAG,"moveTopStackActivityToPinnedStackLocked: No top running activity" + " in stack=" + stack);
    return false;
  }
  if (!r.info.supportsPip) {
    Slog.w(TAG,"moveTopStackActivityToPinnedStackLocked: Picture-In-Picture not supported for " + " r=" + r);
    return false;
  }
  final TaskRecord task=r.task;
  if (task.mActivities.size() == 1) {
    moveTaskToStackLocked(task.taskId,PINNED_STACK_ID,ON_TOP,FORCE_FOCUS);
  }
 else {
    final ActivityStack pinnedStack=getStack(PINNED_STACK_ID,CREATE_IF_NEEDED,ON_TOP);
    pinnedStack.moveActivityToStack(r);
  }
  resizeStackLocked(PINNED_STACK_ID,bounds,PRESERVE_WINDOWS,true);
  ensureActivitiesVisibleLocked(null,0,!PRESERVE_WINDOWS);
  resumeTopActivitiesLocked();
  return true;
}
