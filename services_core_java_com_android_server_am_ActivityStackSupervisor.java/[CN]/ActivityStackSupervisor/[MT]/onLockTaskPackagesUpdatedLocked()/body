{
  boolean didSomething=false;
  for (int taskNdx=mLockTaskModeTasks.size() - 1; taskNdx >= 0; --taskNdx) {
    final TaskRecord lockedTask=mLockTaskModeTasks.get(taskNdx);
    if (lockedTask.mLockTaskMode != LOCK_TASK_LAUNCH_MODE_IF_WHITELISTED) {
      continue;
    }
    final boolean wasLaunchable=lockedTask.mLockTaskAuth == LOCK_TASK_AUTH_LAUNCHABLE;
    lockedTask.setLockTaskAuth();
    if (wasLaunchable && lockedTask.mLockTaskAuth != LOCK_TASK_AUTH_LAUNCHABLE) {
      removeLockedTaskLocked(lockedTask);
      lockedTask.performClearTaskLocked();
      didSomething=true;
    }
  }
  for (int displayNdx=mActivityDisplays.size() - 1; displayNdx >= 0; --displayNdx) {
    ArrayList<ActivityStack> stacks=mActivityDisplays.valueAt(displayNdx).mStacks;
    for (int stackNdx=stacks.size() - 1; stackNdx >= 0; --stackNdx) {
      final ActivityStack stack=stacks.get(stackNdx);
      stack.onLockTaskPackagesUpdatedLocked();
    }
  }
  if (didSomething) {
    resumeTopActivitiesLocked();
  }
}
