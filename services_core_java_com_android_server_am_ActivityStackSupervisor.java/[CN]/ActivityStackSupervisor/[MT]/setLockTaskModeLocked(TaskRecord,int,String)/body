{
  if (task == null) {
    final TaskRecord lockedTask=getLockedTaskLocked();
    if (lockedTask != null) {
      removeLockedTaskLocked(lockedTask);
      if (!mLockTaskModeTasks.isEmpty()) {
        lockedTask.performClearTaskLocked();
        resumeTopActivitiesLocked();
        return;
      }
    }
    return;
  }
  if (task.mLockTaskAuth == LOCK_TASK_AUTH_DONT_LOCK) {
    return;
  }
  if (isLockTaskModeViolation(task)) {
    Slog.e(TAG,"setLockTaskMode: Attempt to start an unauthorized lock task.");
    return;
  }
  if (mLockTaskModeTasks.isEmpty()) {
    final Message lockTaskMsg=Message.obtain();
    lockTaskMsg.obj=task.intent.getComponent().getPackageName();
    lockTaskMsg.arg1=task.userId;
    lockTaskMsg.what=LOCK_TASK_START_MSG;
    lockTaskMsg.arg2=lockTaskModeState;
    mHandler.sendMessage(lockTaskMsg);
  }
  mLockTaskModeTasks.remove(task);
  mLockTaskModeTasks.add(task);
  if (task.mLockTaskUid == -1) {
    task.mLockTaskUid=task.mCallingUid;
  }
  findTaskToMoveToFrontLocked(task,0,null,reason);
  resumeTopActivitiesLocked();
}
