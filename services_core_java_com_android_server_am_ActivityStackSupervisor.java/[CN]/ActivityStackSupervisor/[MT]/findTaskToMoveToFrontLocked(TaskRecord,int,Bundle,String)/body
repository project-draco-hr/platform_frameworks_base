{
  if ((flags & ActivityManager.MOVE_TASK_NO_USER_ACTION) == 0) {
    mUserLeaving=true;
  }
  if ((flags & ActivityManager.MOVE_TASK_WITH_HOME) != 0) {
    task.setTaskToReturnTo(HOME_ACTIVITY_TYPE);
  }
  if (task.stack == null) {
    Slog.e(TAG,"findTaskToMoveToFrontLocked: can't move task=" + task + " to front. Stack is null");
    return;
  }
  if (task.mResizeable && options != null) {
    ActivityOptions opts=new ActivityOptions(options);
    if (opts.hasBounds()) {
      Rect bounds=opts.getBounds();
      task.updateOverrideConfiguration(bounds);
      final int stackId=task.getLaunchStackId();
      if (stackId != task.stack.mStackId) {
        moveTaskToStackUncheckedLocked(task,stackId,ON_TOP,!FORCE_FOCUS,reason);
      }
      mWindowManager.resizeTask(task.taskId,bounds,task.mOverrideConfig,false,false);
    }
  }
  final ActivityRecord r=task.getTopActivity();
  task.stack.moveTaskToFrontLocked(task,false,options,r == null ? null : r.appTimeTracker,reason);
  if (DEBUG_STACK)   Slog.d(TAG_STACK,"findTaskToMoveToFront: moved to front of stack=" + task.stack);
}
