{
  final ActivityRecord r=task.getTopActivity();
  final boolean wasFocused=isFrontStack(task.stack) && (topRunningActivityLocked() == r);
  final boolean wasResumed=wasFocused && (task.stack.mResumedActivity == r);
  final boolean resizeable=task.mResizeable;
  task.mResizeable=false;
  final ActivityStack stack=getStack(stackId,CREATE_IF_NEEDED,toTop);
  task.mResizeable=resizeable;
  mWindowManager.moveTaskToStack(task.taskId,stack.mStackId,toTop);
  if (task.stack != null) {
    task.stack.removeTask(task,reason,MOVING);
  }
  stack.addTask(task,toTop,MOVING);
  stack.setFocusAndResumeStateIfNeeded(r,forceFocus || wasFocused,wasResumed,reason);
  return stack;
}
