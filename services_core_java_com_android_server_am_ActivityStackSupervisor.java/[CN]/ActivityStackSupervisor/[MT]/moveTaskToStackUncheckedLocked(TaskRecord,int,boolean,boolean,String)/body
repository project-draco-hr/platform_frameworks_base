{
  final ActivityRecord r=task.getTopActivity();
  final boolean wasFocused=isFrontStack(task.stack) && (topRunningActivityLocked() == r);
  final boolean wasResumed=wasFocused && (task.stack.mResumedActivity == r);
  final ActivityStack stack=getStack(stackId,CREATE_IF_NEEDED,toTop);
  mWindowManager.moveTaskToStack(task.taskId,stack.mStackId,toTop);
  if (task.stack != null) {
    task.stack.removeTask(task,reason,MOVING);
  }
  stack.addTask(task,toTop,MOVING);
  if (forceFocus || wasFocused) {
    if (wasResumed) {
      stack.mResumedActivity=r;
    }
    stack.moveToFront(reason);
  }
  return stack;
}
