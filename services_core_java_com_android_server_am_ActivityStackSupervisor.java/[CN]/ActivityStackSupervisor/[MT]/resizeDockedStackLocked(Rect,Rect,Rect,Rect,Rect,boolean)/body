{
  final ActivityStack stack=getStack(DOCKED_STACK_ID);
  if (stack == null) {
    Slog.w(TAG,"resizeDockedStackLocked: docked stack not found");
    return;
  }
  Trace.traceBegin(TRACE_TAG_ACTIVITY_MANAGER,"am.resizeDockedStack");
  mWindowManager.deferSurfaceLayout();
  try {
    ActivityRecord r=stack.topRunningActivityLocked();
    resizeStackUncheckedLocked(stack,dockedBounds,tempDockedTaskBounds,tempDockedTaskInsetBounds);
    if (stack.mFullscreen) {
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (StackId.isResizeableByDockedStack(i) && getStack(i) != null) {
          resizeStackLocked(i,null,null,null,preserveWindows,true);
        }
      }
      ArrayList<TaskRecord> tasks=stack.getAllTasks();
      final int count=tasks.size();
      for (int i=0; i < count; i++) {
        moveTaskToStackLocked(tasks.get(i).taskId,FULLSCREEN_WORKSPACE_STACK_ID,ON_TOP,FORCE_FOCUS,"resizeStack",false);
      }
      r=null;
    }
 else {
      if (dockedBounds != null) {
        mWindowManager.getStackDockedModeBounds(HOME_STACK_ID,tempRect,true);
      }
      for (int i=FIRST_STATIC_STACK_ID; i <= LAST_STATIC_STACK_ID; i++) {
        if (StackId.isResizeableByDockedStack(i)) {
          ActivityStack otherStack=getStack(i);
          if (otherStack != null) {
            resizeStackLocked(i,dockedBounds != null ? tempRect : null,tempOtherTaskBounds,tempOtherTaskInsetBounds,preserveWindows,true);
          }
        }
      }
    }
    ensureConfigurationAndResume(stack,r,preserveWindows);
  }
  finally {
    mWindowManager.continueSurfaceLayout();
    Trace.traceEnd(TRACE_TAG_ACTIVITY_MANAGER);
  }
  mResizeDockedStackTimeout.notifyResizing(dockedBounds,tempDockedTaskBounds != null || tempDockedTaskInsetBounds != null || tempOtherTaskBounds != null || tempOtherTaskInsetBounds != null);
}
