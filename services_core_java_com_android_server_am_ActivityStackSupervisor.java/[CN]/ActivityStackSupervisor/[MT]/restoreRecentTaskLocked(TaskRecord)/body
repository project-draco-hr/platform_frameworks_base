{
  ActivityStack stack=null;
  if (mLeanbackOnlyDevice) {
    stack=mHomeStack;
  }
 else {
    final ArrayList<ActivityStack> homeDisplayStacks=mHomeStack.mStacks;
    for (int stackNdx=homeDisplayStacks.size() - 1; stackNdx >= 0; --stackNdx) {
      final ActivityStack tmpStack=homeDisplayStacks.get(stackNdx);
      if (!tmpStack.isHomeStack()) {
        stack=tmpStack;
        break;
      }
    }
  }
  if (stack == null) {
    stack=getStack(createStackOnDisplay(getNextStackId(),Display.DEFAULT_DISPLAY));
    if (DEBUG_RECENTS)     Slog.v(TAG,"Created stack=" + stack + " for recents restoration.");
  }
  if (stack == null) {
    if (DEBUG_RECENTS)     Slog.v(TAG,"Unable to find/create stack to restore recent task=" + task);
    return false;
  }
  stack.addTask(task,false,false);
  if (DEBUG_RECENTS)   Slog.v(TAG,"Added restored task=" + task + " to stack="+ stack);
  final ArrayList<ActivityRecord> activities=task.mActivities;
  for (int activityNdx=activities.size() - 1; activityNdx >= 0; --activityNdx) {
    final ActivityRecord r=activities.get(activityNdx);
    mWindowManager.addAppToken(0,r.appToken,task.taskId,stack.mStackId,r.info.screenOrientation,r.fullscreen,(r.info.flags & ActivityInfo.FLAG_SHOW_ON_LOCK_SCREEN) != 0,r.userId,r.info.configChanges,task.voiceSession != null,r.mLaunchTaskBehind);
  }
  return true;
}
