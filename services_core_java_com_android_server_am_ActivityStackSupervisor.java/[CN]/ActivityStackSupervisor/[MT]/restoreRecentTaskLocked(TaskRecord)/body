{
  ActivityStack stack=mLeanbackOnlyDevice ? mHomeStack : getStack(FULLSCREEN_WORKSPACE_STACK_ID,true,false);
  if (stack == null) {
    if (DEBUG_RECENTS)     Slog.v(TAG_RECENTS,"Unable to find/create stack to restore recent task=" + task);
    return false;
  }
  stack.addTask(task,false,false);
  if (DEBUG_RECENTS)   Slog.v(TAG_RECENTS,"Added restored task=" + task + " to stack="+ stack);
  final ArrayList<ActivityRecord> activities=task.mActivities;
  for (int activityNdx=activities.size() - 1; activityNdx >= 0; --activityNdx) {
    final ActivityRecord r=activities.get(activityNdx);
    mWindowManager.addAppToken(0,r.appToken,task.taskId,stack.mStackId,r.info.screenOrientation,r.fullscreen,(r.info.flags & ActivityInfo.FLAG_SHOW_FOR_ALL_USERS) != 0,r.userId,r.info.configChanges,task.voiceSession != null,r.mLaunchTaskBehind);
  }
  return true;
}
