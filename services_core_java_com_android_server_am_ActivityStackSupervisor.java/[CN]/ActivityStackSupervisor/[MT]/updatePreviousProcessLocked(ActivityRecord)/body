{
  ProcessRecord fgApp=null;
  for (int displayNdx=mActivityDisplays.size() - 1; displayNdx >= 0; --displayNdx) {
    final ArrayList<ActivityStack> stacks=mActivityDisplays.valueAt(displayNdx).mStacks;
    for (int stackNdx=stacks.size() - 1; stackNdx >= 0; --stackNdx) {
      final ActivityStack stack=stacks.get(stackNdx);
      if (isFocusedStack(stack)) {
        if (stack.mResumedActivity != null) {
          fgApp=stack.mResumedActivity.app;
        }
 else         if (stack.mPausingActivity != null) {
          fgApp=stack.mPausingActivity.app;
        }
        break;
      }
    }
  }
  if (r.app != null && fgApp != null && r.app != fgApp && r.lastVisibleTime > mService.mPreviousProcessVisibleTime && r.app != mService.mHomeProcess) {
    mService.mPreviousProcess=r.app;
    mService.mPreviousProcessVisibleTime=r.lastVisibleTime;
  }
}
