{
  int id=mNextDeviceId++;
  MidiDeviceInfo deviceInfo=new MidiDeviceInfo(type,id,numInputPorts,numOutputPorts,properties,isPrivate);
  Device device=new Device(server,deviceInfo,serviceInfo,uid);
  if (server != null) {
    IBinder binder=server.asBinder();
    try {
      binder.linkToDeath(device,0);
    }
 catch (    RemoteException e) {
      return null;
    }
    mDevicesByServer.put(binder,device);
  }
  mDevicesByInfo.put(deviceInfo,device);
synchronized (mClients) {
    for (    Client c : mClients.values()) {
      c.deviceAdded(device);
    }
  }
  return deviceInfo;
}
