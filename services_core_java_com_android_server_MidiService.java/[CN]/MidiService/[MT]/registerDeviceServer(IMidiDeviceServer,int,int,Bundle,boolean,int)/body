{
  if (type != MidiDeviceInfo.TYPE_VIRTUAL && Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("only system can create non-virtual devices");
  }
  MidiDeviceInfo deviceInfo;
  Device device;
synchronized (mDevicesByServer) {
    int id=mNextDeviceId++;
    deviceInfo=new MidiDeviceInfo(type,id,numInputPorts,numOutputPorts,properties);
    IBinder binder=server.asBinder();
    device=new Device(server,deviceInfo);
    try {
      binder.linkToDeath(device,0);
    }
 catch (    RemoteException e) {
      return null;
    }
    mDevicesByInfo.put(deviceInfo,device);
    mDevicesByServer.put(server.asBinder(),device);
  }
synchronized (mClients) {
    for (    Client c : mClients.values()) {
      c.deviceAdded(device);
    }
  }
  return deviceInfo;
}
