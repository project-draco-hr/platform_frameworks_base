{
  int ownMaxHeight=mMaxViewHeight;
  int heightMode=MeasureSpec.getMode(heightMeasureSpec);
  boolean hasFixedHeight=heightMode == MeasureSpec.EXACTLY;
  if (hasFixedHeight) {
    ownMaxHeight=Math.min(MeasureSpec.getSize(heightMeasureSpec),ownMaxHeight);
  }
  int newHeightSpec=MeasureSpec.makeMeasureSpec(ownMaxHeight,MeasureSpec.AT_MOST);
  int maxChildHeight=0;
  int childCount=getChildCount();
  for (int i=0; i < childCount; i++) {
    View child=getChildAt(i);
    if (child.getVisibility() == GONE || isChildInvisible(child)) {
      continue;
    }
    int childHeightSpec=newHeightSpec;
    ViewGroup.LayoutParams layoutParams=child.getLayoutParams();
    if (layoutParams.height != ViewGroup.LayoutParams.MATCH_PARENT) {
      if (layoutParams.height >= 0) {
        childHeightSpec=layoutParams.height > ownMaxHeight ? MeasureSpec.makeMeasureSpec(ownMaxHeight,MeasureSpec.EXACTLY) : MeasureSpec.makeMeasureSpec(layoutParams.height,MeasureSpec.EXACTLY);
      }
      child.measure(getChildMeasureSpec(widthMeasureSpec,0,layoutParams.width),childHeightSpec);
      int childHeight=child.getMeasuredHeight();
      maxChildHeight=Math.max(maxChildHeight,childHeight);
    }
 else {
      mMatchParentViews.add(child);
    }
  }
  int ownHeight=hasFixedHeight ? ownMaxHeight : Math.min(ownMaxHeight,maxChildHeight);
  newHeightSpec=MeasureSpec.makeMeasureSpec(ownHeight,MeasureSpec.EXACTLY);
  for (  View child : mMatchParentViews) {
    child.measure(getChildMeasureSpec(widthMeasureSpec,0,child.getLayoutParams().width),newHeightSpec);
  }
  mMatchParentViews.clear();
  int width=MeasureSpec.getSize(widthMeasureSpec);
  if (canHaveBottomDecor()) {
    ownHeight+=mBottomDecorHeight;
  }
  setMeasuredDimension(width,ownHeight);
}
