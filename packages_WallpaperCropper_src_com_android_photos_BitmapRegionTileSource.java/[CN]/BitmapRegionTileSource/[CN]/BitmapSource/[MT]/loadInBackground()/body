{
  ExifInterface ei=new ExifInterface();
  if (readExif(ei)) {
    Integer ori=ei.getTagIntValue(ExifInterface.TAG_ORIENTATION);
    if (ori != null) {
      mRotation=ExifInterface.getRotationForOrientationValue(ori.shortValue());
    }
  }
  mDecoder=loadBitmapRegionDecoder();
  int width=mDecoder.getWidth();
  int height=mDecoder.getHeight();
  if (mPreviewSize != 0) {
    int previewSize=Math.min(mPreviewSize,MAX_PREVIEW_SIZE);
    BitmapFactory.Options opts=new BitmapFactory.Options();
    opts.inPreferredConfig=Bitmap.Config.ARGB_8888;
    opts.inPreferQualityOverSpeed=true;
    float scale=(float)previewSize / Math.max(width,height);
    opts.inSampleSize=BitmapUtils.computeSampleSizeLarger(scale);
    opts.inJustDecodeBounds=false;
    mPreview=loadPreviewBitmap(opts);
  }
}
