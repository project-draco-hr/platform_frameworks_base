{
  mContext=context;
  mAudioManager=(AudioManager)context.getSystemService(Context.AUDIO_SERVICE);
  mBluetoothService=bluetoothService;
  if (mBluetoothService == null) {
    throw new RuntimeException("Platform does not support Bluetooth");
  }
  if (!initNative()) {
    throw new RuntimeException("Could not init BluetoothA2dpService");
  }
  mAdapter=(BluetoothAdapter)context.getSystemService(Context.BLUETOOTH_SERVICE);
  mIntentFilter=new IntentFilter(BluetoothIntent.BLUETOOTH_STATE_CHANGED_ACTION);
  mIntentFilter.addAction(BluetoothIntent.BOND_STATE_CHANGED_ACTION);
  mIntentFilter.addAction(BluetoothIntent.REMOTE_DEVICE_CONNECTED_ACTION);
  mContext.registerReceiver(mReceiver,mIntentFilter);
  mAudioDevices=new HashMap<BluetoothDevice,Integer>();
  if (mBluetoothService.isEnabled())   onBluetoothEnable();
}
