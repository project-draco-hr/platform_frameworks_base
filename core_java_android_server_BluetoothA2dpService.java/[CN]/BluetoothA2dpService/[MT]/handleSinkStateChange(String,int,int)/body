{
  if (state != prevState) {
    if (state == BluetoothA2dp.STATE_DISCONNECTED || state == BluetoothA2dp.STATE_DISCONNECTING) {
      if (prevState == BluetoothA2dp.STATE_CONNECTED || prevState == BluetoothA2dp.STATE_PLAYING) {
        Intent intent=new Intent(AudioManager.ACTION_AUDIO_BECOMING_NOISY);
        mContext.sendBroadcast(intent);
      }
      mSinkCount--;
    }
 else     if (state == BluetoothA2dp.STATE_CONNECTED) {
      mSinkCount++;
    }
    mAudioDevices.put(address,state);
    Intent intent=new Intent(BluetoothA2dp.SINK_STATE_CHANGED_ACTION);
    intent.putExtra(BluetoothIntent.ADDRESS,address);
    intent.putExtra(BluetoothA2dp.SINK_PREVIOUS_STATE,prevState);
    intent.putExtra(BluetoothA2dp.SINK_STATE,state);
    mContext.sendBroadcast(intent,BLUETOOTH_PERM);
    if (DBG)     log("A2DP state : address: " + address + " State:"+ prevState+ "->"+ state);
  }
}
