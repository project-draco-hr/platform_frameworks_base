{
  if (state != prevState) {
    mAudioDevices.put(device,state);
    checkSinkSuspendState(state);
    mTargetA2dpState=-1;
    if (getPriority(device) > BluetoothA2dp.PRIORITY_OFF && state == BluetoothA2dp.STATE_CONNECTED) {
      setPriority(device,BluetoothA2dp.PRIORITY_AUTO_CONNECT);
      adjustOtherSinkPriorities(device);
    }
    int delay=mAudioManager.setBluetoothA2dpDeviceConnectionState(device,state);
    mWakeLock.acquire();
    mIntentBroadcastHandler.sendMessageDelayed(mIntentBroadcastHandler.obtainMessage(MSG_CONNECTION_STATE_CHANGED,prevState,state,device),delay);
  }
}
