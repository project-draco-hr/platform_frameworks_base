{
  mNetwork=network;
  mKeyManager=km;
  mTrustManager=new WFATrustManager(ks,homeSP,flowType);
  int port;
switch (url.getProtocol()) {
case UnsecureHTTP:
    mSocketFactory=new DefaultSocketFactory();
  port=url.getPort() > 0 ? url.getPort() : 80;
break;
case SecureHTTP:
SSLContext tlsContext=SSLContext.getInstance("TLSv1");
tlsContext.init(km != null ? new KeyManager[]{km} : null,new TrustManager[]{mTrustManager},null);
mSocketFactory=tlsContext.getSocketFactory();
port=url.getPort() > 0 ? url.getPort() : 443;
break;
default :
throw new IOException("Bad URL: " + url);
}
if (OSUManager.R2_MOCK && url.getHost().endsWith(".wi-fi.org")) {
mRemotes=new ArrayList<>(1);
mRemotes.add(new InetSocketAddress(InetAddress.getByName("10.123.107.107"),port));
}
 else {
InetAddress[] remotes=mNetwork.getAllByName(url.getHost());
android.util.Log.d(OSUManager.TAG,"'" + url.getHost() + "' resolves to "+ Arrays.toString(remotes));
if (remotes == null || remotes.length == 0) {
throw new IOException("Failed to look up host from " + url);
}
mRemotes=new ArrayList<>(remotes.length);
for (InetAddress remote : remotes) {
mRemotes.add(new InetSocketAddress(remote,port));
}
}
Collections.shuffle(mRemotes);
}
