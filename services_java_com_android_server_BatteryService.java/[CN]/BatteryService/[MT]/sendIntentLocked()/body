{
  final Intent intent=new Intent(Intent.ACTION_BATTERY_CHANGED);
  intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY | Intent.FLAG_RECEIVER_REPLACE_PENDING);
  int icon=getIconLocked(mBatteryProps.batteryLevel);
  intent.putExtra(BatteryManager.EXTRA_STATUS,mBatteryProps.batteryStatus);
  intent.putExtra(BatteryManager.EXTRA_HEALTH,mBatteryProps.batteryHealth);
  intent.putExtra(BatteryManager.EXTRA_PRESENT,mBatteryProps.batteryPresent);
  intent.putExtra(BatteryManager.EXTRA_LEVEL,mBatteryProps.batteryLevel);
  intent.putExtra(BatteryManager.EXTRA_SCALE,BATTERY_SCALE);
  intent.putExtra(BatteryManager.EXTRA_ICON_SMALL,icon);
  intent.putExtra(BatteryManager.EXTRA_PLUGGED,mPlugType);
  intent.putExtra(BatteryManager.EXTRA_VOLTAGE,mBatteryProps.batteryVoltage);
  intent.putExtra(BatteryManager.EXTRA_TEMPERATURE,mBatteryProps.batteryTemperature);
  intent.putExtra(BatteryManager.EXTRA_TECHNOLOGY,mBatteryProps.batteryTechnology);
  intent.putExtra(BatteryManager.EXTRA_INVALID_CHARGER,mInvalidCharger);
  if (DEBUG) {
    Slog.d(TAG,"Sending ACTION_BATTERY_CHANGED.  level:" + mBatteryProps.batteryLevel + ", scale:"+ BATTERY_SCALE+ ", status:"+ mBatteryProps.batteryStatus+ ", health:"+ mBatteryProps.batteryHealth+ ", present:"+ mBatteryProps.batteryPresent+ ", voltage: "+ mBatteryProps.batteryVoltage+ ", temperature: "+ mBatteryProps.batteryTemperature+ ", technology: "+ mBatteryProps.batteryTechnology+ ", AC powered:"+ mBatteryProps.chargerAcOnline+ ", USB powered:"+ mBatteryProps.chargerUsbOnline+ ", Wireless powered:"+ mBatteryProps.chargerWirelessOnline+ ", icon:"+ icon+ ", invalid charger:"+ mInvalidCharger);
  }
  mHandler.post(new Runnable(){
    @Override public void run(){
      ActivityManagerNative.broadcastStickyIntent(intent,null,UserHandle.USER_ALL);
    }
  }
);
}
