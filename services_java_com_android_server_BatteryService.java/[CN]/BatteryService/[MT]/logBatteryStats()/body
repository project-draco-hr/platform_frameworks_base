{
  IBinder batteryInfoService=ServiceManager.getService(BATTERY_STATS_SERVICE_NAME);
  if (batteryInfoService != null) {
    byte[] buffer=new byte[DUMP_MAX_LENGTH];
    File dumpFile=null;
    FileOutputStream dumpStream=null;
    try {
      dumpFile=new File(DUMPSYS_DATA_PATH + BATTERY_STATS_SERVICE_NAME + ".dump");
      dumpStream=new FileOutputStream(dumpFile);
      batteryInfoService.dump(dumpStream.getFD(),DUMPSYS_ARGS);
      dumpStream.getFD().sync();
      int length=(int)Math.min(dumpFile.length(),DUMP_MAX_LENGTH);
      FileInputStream fileInputStream=new FileInputStream(dumpFile);
      int nread=fileInputStream.read(buffer,0,length);
      if (nread > 0) {
        Checkin.logEvent(mContext.getContentResolver(),Checkin.Events.Tag.BATTERY_DISCHARGE_INFO,new String(buffer,0,nread));
        if (LOCAL_LOGV)         Log.v(TAG,"dumped " + nread + "b from "+ batteryInfoService+ "to log");
        if (LOCAL_LOGV)         Log.v(TAG,"actual dump:" + new String(buffer,0,nread));
      }
    }
 catch (    RemoteException e) {
      Log.e(TAG,"failed to dump service '" + BATTERY_STATS_SERVICE_NAME + "':"+ e);
    }
catch (    IOException e) {
      Log.e(TAG,"failed to write dumpsys file: " + e);
    }
 finally {
      if (dumpStream != null) {
        try {
          dumpStream.close();
        }
 catch (        IOException e) {
          Log.e(TAG,"failed to close dumpsys output stream");
        }
      }
      if (dumpFile != null && !dumpFile.delete()) {
        Log.e(TAG,"failed to delete temporary dumpsys file: " + dumpFile.getAbsolutePath());
      }
    }
  }
}
