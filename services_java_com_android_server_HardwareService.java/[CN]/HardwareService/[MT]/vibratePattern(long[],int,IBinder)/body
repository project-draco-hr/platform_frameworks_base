{
  if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.VIBRATE) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires VIBRATE permission");
  }
  long identity=Binder.clearCallingIdentity();
  try {
    if (false) {
      String s="";
      int N=pattern.length;
      for (int i=0; i < N; i++) {
        s+=" " + pattern[i];
      }
      Log.i(TAG,"vibrating with pattern: " + s);
    }
    if (pattern == null || pattern.length == 0 || isAll0(pattern) || repeat >= pattern.length || token == null) {
      return;
    }
synchronized (this) {
      Death death=new Death(token);
      try {
        token.linkToDeath(death,0);
      }
 catch (      RemoteException e) {
        return;
      }
      Thread oldThread=mThread;
      if (oldThread != null) {
synchronized (mThread) {
          mThread.mDone=true;
          mThread.notify();
        }
      }
      if (mDeath != null) {
        mToken.unlinkToDeath(mDeath,0);
      }
      mDeath=death;
      mToken=token;
      mThread=new VibrateThread(pattern,repeat);
      mThread.start();
    }
  }
  finally {
    Binder.restoreCallingIdentity(identity);
  }
}
