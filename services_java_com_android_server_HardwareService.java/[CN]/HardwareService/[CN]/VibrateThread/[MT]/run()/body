{
  Process.setThreadPriority(Process.THREAD_PRIORITY_URGENT_DISPLAY);
synchronized (this) {
    int index=0;
    long[] pattern=mVibration.mPattern;
    int len=pattern.length;
    int repeat=mVibration.mRepeat;
    long duration=0;
    while (!mDone) {
      if (index < len) {
        duration+=pattern[index++];
      }
      delay(duration);
      if (mDone) {
        break;
      }
      if (index < len) {
        duration=pattern[index++];
        if (duration > 0) {
          HardwareService.this.vibratorOn(duration);
        }
      }
 else {
        if (repeat < 0) {
          break;
        }
 else {
          index=repeat;
          duration=0;
        }
      }
    }
    mWakeLock.release();
  }
synchronized (mVibrations) {
    if (mThread == this) {
      mThread=null;
    }
    if (!mDone) {
      mVibrations.remove(mVibration);
      startNextVibrationLocked();
    }
  }
}
