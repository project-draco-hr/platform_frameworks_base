{
  BluetoothDevice btDevice=(BluetoothDevice)getContext().getSystemService(Context.BLUETOOTH_SERVICE);
  boolean shouldSupportBluetooth=SystemProperties.get("ro.kernel.qemu").equals("0");
  assertFalse(shouldSupportBluetooth && btDevice == null);
  if (!shouldSupportBluetooth) {
    Log.i(TAG,"Skipping test - this device does not have bluetooth.");
    return;
  }
  boolean bluetoothWasEnabled=btDevice.isEnabled();
  if (bluetoothWasEnabled) {
    Log.i(TAG,"Bluetooth already enabled");
  }
 else {
    Log.i(TAG,"Enabling Bluetooth...");
    btDevice.enable();
    Log.i(TAG,"Bluetooth enabled");
  }
  Assert.assertTrue(btDevice.isEnabled());
  String myAddress=btDevice.getAddress();
  Assert.assertTrue(myAddress != null);
  Log.i(TAG,"My Bluetooth Address is " + myAddress);
  Assert.assertFalse(myAddress.equals("00:00:00:00:00:00"));
  if (!bluetoothWasEnabled) {
    Log.i(TAG,"Disabling Bluetooth...");
    btDevice.disable();
    Log.i(TAG,"Bluetooth disabled");
  }
}
