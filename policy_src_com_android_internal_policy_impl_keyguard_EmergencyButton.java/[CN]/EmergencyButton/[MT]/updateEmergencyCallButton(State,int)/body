{
  boolean enabled=false;
  if (phoneState == TelephonyManager.CALL_STATE_OFFHOOK) {
    enabled=true;
  }
 else   if (mLockPatternUtils.isEmergencyCallCapable()) {
    boolean simLocked=KeyguardUpdateMonitor.getInstance(mContext).isSimLocked();
    if (simLocked) {
      enabled=mLockPatternUtils.isEmergencyCallEnabledWhileSimLocked();
    }
 else {
      enabled=mLockPatternUtils.isSecure();
    }
  }
  mLockPatternUtils.updateEmergencyCallButtonState(this,phoneState,enabled,KeyguardViewManager.USE_UPPER_CASE,false);
}
