{
  final int previousWifiState=mWifiState.get();
  try {
    if (wifiState == WIFI_STATE_ENABLED) {
      mBatteryStats.noteWifiOn(mLastEnableUid.get());
    }
 else     if (wifiState == WIFI_STATE_DISABLED) {
      mBatteryStats.noteWifiOff(mLastEnableUid.get());
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"Failed to note battery stats in wifi");
  }
  mWifiState.set(wifiState);
  if (DBG)   Log.d(TAG,"setWifiState: " + getWifiStateByName());
  if (!ActivityManagerNative.isSystemReady())   return;
  final Intent intent=new Intent(WifiManager.WIFI_STATE_CHANGED_ACTION);
  intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  intent.putExtra(WifiManager.EXTRA_WIFI_STATE,wifiState);
  intent.putExtra(WifiManager.EXTRA_PREVIOUS_WIFI_STATE,previousWifiState);
  mContext.sendStickyBroadcast(intent);
}
