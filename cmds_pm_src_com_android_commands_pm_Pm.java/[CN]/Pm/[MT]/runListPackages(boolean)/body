{
  int getFlags=0;
  boolean listDisabled=false, listEnabled=false;
  boolean listSystem=false, listThirdParty=false;
  try {
    String opt;
    while ((opt=nextOption()) != null) {
      if (opt.equals("-l")) {
      }
 else       if (opt.equals("-lf")) {
        showApplicationPackage=true;
      }
 else       if (opt.equals("-f")) {
        showApplicationPackage=true;
      }
 else       if (opt.equals("-d")) {
        listDisabled=true;
      }
 else       if (opt.equals("-e")) {
        listEnabled=true;
      }
 else       if (opt.equals("-s")) {
        listSystem=true;
      }
 else       if (opt.equals("-3")) {
        listThirdParty=true;
      }
 else       if (opt.equals("-u")) {
        getFlags|=PackageManager.GET_UNINSTALLED_PACKAGES;
      }
 else {
        System.err.println("Error: Unknown option: " + opt);
        showUsage();
        return;
      }
    }
  }
 catch (  RuntimeException ex) {
    System.err.println("Error: " + ex.toString());
    showUsage();
    return;
  }
  String filter=nextArg();
  try {
    List<PackageInfo> packages=mPm.getInstalledPackages(getFlags);
    int count=packages.size();
    for (int p=0; p < count; p++) {
      PackageInfo info=packages.get(p);
      if (filter != null && !info.packageName.contains(filter)) {
        continue;
      }
      final boolean isSystem=(info.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0;
      if ((!listDisabled || !info.applicationInfo.enabled) && (!listEnabled || info.applicationInfo.enabled) && (!listSystem || isSystem)&& (!listThirdParty || !isSystem)) {
        System.out.print("package:");
        if (showApplicationPackage) {
          System.out.print(info.applicationInfo.sourceDir);
          System.out.print("=");
        }
        System.out.println(info.packageName);
      }
    }
  }
 catch (  RemoteException e) {
    System.err.println(e.toString());
    System.err.println(PM_NOT_RUNNING_ERR);
  }
}
