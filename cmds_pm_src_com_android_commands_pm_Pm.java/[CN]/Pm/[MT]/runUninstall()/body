{
  int flags=0;
  int userId=UserHandle.USER_ALL;
  String opt;
  while ((opt=nextOption()) != null) {
    if (opt.equals("-k")) {
      flags|=PackageManager.DELETE_KEEP_DATA;
    }
 else     if (opt.equals("--user")) {
      String param=nextArg();
      if (isNumber(param)) {
        userId=Integer.parseInt(param);
      }
 else {
        showUsage();
        System.err.println("Error: Invalid user: " + param);
        return 1;
      }
    }
 else {
      System.err.println("Error: Unknown option: " + opt);
      return 1;
    }
  }
  String pkg=nextArg();
  if (pkg == null) {
    System.err.println("Error: no package specified");
    showUsage();
    return 1;
  }
  userId=translateUserId(userId,"runUninstall");
  if (userId == UserHandle.USER_ALL) {
    userId=UserHandle.USER_SYSTEM;
    flags|=PackageManager.DELETE_ALL_USERS;
  }
 else {
    PackageInfo info;
    try {
      info=mPm.getPackageInfo(pkg,0,userId);
    }
 catch (    RemoteException e) {
      System.err.println(e.toString());
      System.err.println(PM_NOT_RUNNING_ERR);
      return 1;
    }
    if (info == null) {
      System.err.println("Failure - not installed for " + userId);
      return 1;
    }
    final boolean isSystem=(info.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != 0;
    if (isSystem) {
      flags|=PackageManager.DELETE_SYSTEM_APP;
    }
  }
  final LocalIntentReceiver receiver=new LocalIntentReceiver();
  mInstaller.uninstall(pkg,null,flags,receiver.getIntentSender(),userId);
  final Intent result=receiver.getResult();
  final int status=result.getIntExtra(PackageInstaller.EXTRA_STATUS,PackageInstaller.STATUS_FAILURE);
  if (status == PackageInstaller.STATUS_SUCCESS) {
    System.out.println("Success");
    return 0;
  }
 else {
    Log.e(TAG,"Failure details: " + result.getExtras());
    System.err.println("Failure [" + result.getStringExtra(PackageInstaller.EXTRA_STATUS_MESSAGE) + "]");
    return 1;
  }
}
