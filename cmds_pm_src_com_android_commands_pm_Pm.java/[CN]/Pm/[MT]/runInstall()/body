{
  int installFlags=PackageManager.INSTALL_ALL_USERS;
  String installerPackageName=null;
  String opt;
  String originatingUriString=null;
  String referrer=null;
  String abi=null;
  while ((opt=nextOption()) != null) {
    if (opt.equals("-l")) {
      installFlags|=PackageManager.INSTALL_FORWARD_LOCK;
    }
 else     if (opt.equals("-r")) {
      installFlags|=PackageManager.INSTALL_REPLACE_EXISTING;
    }
 else     if (opt.equals("-i")) {
      installerPackageName=nextOptionData();
      if (installerPackageName == null) {
        System.err.println("Error: no value specified for -i");
        return;
      }
    }
 else     if (opt.equals("-t")) {
      installFlags|=PackageManager.INSTALL_ALLOW_TEST;
    }
 else     if (opt.equals("-s")) {
      installFlags|=PackageManager.INSTALL_EXTERNAL;
    }
 else     if (opt.equals("-f")) {
      installFlags|=PackageManager.INSTALL_INTERNAL;
    }
 else     if (opt.equals("-d")) {
      installFlags|=PackageManager.INSTALL_ALLOW_DOWNGRADE;
    }
 else     if (opt.equals("--originating-uri")) {
      originatingUriString=nextOptionData();
      if (originatingUriString == null) {
        System.err.println("Error: must supply argument for --originating-uri");
        return;
      }
    }
 else     if (opt.equals("--referrer")) {
      referrer=nextOptionData();
      if (referrer == null) {
        System.err.println("Error: must supply argument for --referrer");
        return;
      }
    }
 else     if (opt.equals("--abi")) {
      abi=nextOptionData();
      if (abi == null) {
        System.err.println("Error: must supply argument for --abi");
        return;
      }
    }
 else {
      System.err.println("Error: Unknown option: " + opt);
      return;
    }
  }
  if (abi != null) {
    final String[] supportedAbis=Build.SUPPORTED_ABIS;
    boolean matched=false;
    for (    String supportedAbi : supportedAbis) {
      if (supportedAbi.equals(abi)) {
        matched=true;
        break;
      }
    }
    if (!matched) {
      System.err.println("Error: abi " + abi + " not supported on this device.");
      return;
    }
  }
  final Uri verificationURI;
  final Uri originatingURI;
  final Uri referrerURI;
  if (originatingUriString != null) {
    originatingURI=Uri.parse(originatingUriString);
  }
 else {
    originatingURI=null;
  }
  if (referrer != null) {
    referrerURI=Uri.parse(referrer);
  }
 else {
    referrerURI=null;
  }
  final String apkFilePath=nextArg();
  System.err.println("\tpkg: " + apkFilePath);
  if (apkFilePath == null) {
    System.err.println("Error: no package specified");
    return;
  }
  final String verificationFilePath=nextArg();
  if (verificationFilePath != null) {
    System.err.println("\tver: " + verificationFilePath);
    verificationURI=Uri.fromFile(new File(verificationFilePath));
  }
 else {
    verificationURI=null;
  }
  PackageInstallObserver obs=new PackageInstallObserver();
  try {
    VerificationParams verificationParams=new VerificationParams(verificationURI,originatingURI,referrerURI,VerificationParams.NO_UID,null);
    mPm.installPackage(apkFilePath,obs,installFlags,installerPackageName,verificationParams,abi);
synchronized (obs) {
      while (!obs.finished) {
        try {
          obs.wait();
        }
 catch (        InterruptedException e) {
        }
      }
      if (obs.result == PackageManager.INSTALL_SUCCEEDED) {
        System.out.println("Success");
      }
 else {
        System.err.println("Failure [" + installFailureToString(obs) + "]");
      }
    }
  }
 catch (  RemoteException e) {
    System.err.println(e.toString());
    System.err.println(PM_NOT_RUNNING_ERR);
  }
}
