{
  final List<PackageInfo> packageInfos=new ArrayList<PackageInfo>();
  PackageInfo lastItem=null;
  ParceledListSlice<PackageInfo> slice;
  do {
    final String lastKey=lastItem != null ? lastItem.packageName : null;
    slice=pm.getInstalledPackages(flags,lastKey,userId);
    lastItem=slice.populateList(packageInfos,PackageInfo.CREATOR);
  }
 while (!slice.isLastSlice());
  return packageInfos;
}
