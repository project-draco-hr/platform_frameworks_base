{
  final SessionInfo info=mInstaller.getSessionInfo(sessionId);
  PackageInstaller.Session session=null;
  InputStream in=null;
  OutputStream out=null;
  try {
    session=new PackageInstaller.Session(mInstaller.openSession(sessionId));
    if (path == null) {
      in=new SizedInputStream(System.in,sizeBytes);
    }
 else {
      in=new FileInputStream(path);
    }
    out=session.openWrite("base.apk",0,sizeBytes);
    int total=0;
    byte[] buffer=new byte[65536];
    int c;
    while ((c=in.read(buffer)) != -1) {
      total+=c;
      out.write(buffer,0,c);
      if (info.sizeBytes > 0) {
        final float fraction=((float)c / (float)info.sizeBytes);
        session.addProgress(fraction);
      }
    }
    session.fsync(out);
  }
 catch (  IOException ignore) {
  }
 finally {
    IoUtils.closeQuietly(out);
    IoUtils.closeQuietly(in);
    IoUtils.closeQuietly(session);
  }
}
