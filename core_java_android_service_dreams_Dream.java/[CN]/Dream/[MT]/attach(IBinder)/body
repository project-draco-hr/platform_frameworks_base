{
  if (DEBUG)   Slog.v(TAG,"Dream attached on thread " + Thread.currentThread().getId());
  mWindow=PolicyManager.makeNewWindow(this);
  mWindow.setCallback(this);
  mWindow.requestFeature(Window.FEATURE_NO_TITLE);
  mWindow.setBackgroundDrawable(new ColorDrawable(0xFF000000));
  if (DEBUG)   Slog.v(TAG,"attaching window token: " + windowToken + " to window of type "+ WindowManager.LayoutParams.TYPE_DREAM);
  WindowManager.LayoutParams lp=mWindow.getAttributes();
  lp.type=WindowManager.LayoutParams.TYPE_DREAM;
  lp.token=windowToken;
  lp.windowAnimations=com.android.internal.R.style.Animation_Dream;
  lp.flags|=(WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED | WindowManager.LayoutParams.FLAG_DISMISS_KEYGUARD | WindowManager.LayoutParams.FLAG_ALLOW_LOCK_WHILE_SCREEN_ON);
  mWindow.setAttributes(lp);
  if (DEBUG)   Slog.v(TAG,"created and attached window: " + mWindow);
  mWindow.setWindowManager(null,windowToken,"dream",true);
  mWindowManager=mWindow.getWindowManager();
  mHandler.post(new Runnable(){
    @Override public void run(){
      if (DEBUG)       Slog.v(TAG,"Dream window added on thread " + Thread.currentThread().getId());
      getWindowManager().addView(mWindow.getDecorView(),mWindow.getAttributes());
      onStart();
    }
  }
);
}
