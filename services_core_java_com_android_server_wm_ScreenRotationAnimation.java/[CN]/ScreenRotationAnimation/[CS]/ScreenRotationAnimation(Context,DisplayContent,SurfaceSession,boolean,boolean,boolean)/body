{
  mContext=context;
  mDisplayContent=displayContent;
  displayContent.getLogicalDisplayRect(mOriginalDisplayRect);
  final Display display=displayContent.getDisplay();
  int originalRotation=display.getRotation();
  final int originalWidth;
  final int originalHeight;
  DisplayInfo displayInfo=displayContent.getDisplayInfo();
  if (forceDefaultOrientation) {
    mForceDefaultOrientation=true;
    originalWidth=displayContent.mBaseDisplayWidth;
    originalHeight=displayContent.mBaseDisplayHeight;
  }
 else {
    originalWidth=displayInfo.logicalWidth;
    originalHeight=displayInfo.logicalHeight;
  }
  if (originalRotation == Surface.ROTATION_90 || originalRotation == Surface.ROTATION_270) {
    mWidth=originalHeight;
    mHeight=originalWidth;
  }
 else {
    mWidth=originalWidth;
    mHeight=originalHeight;
  }
  mOriginalRotation=originalRotation;
  mOriginalWidth=originalWidth;
  mOriginalHeight=originalHeight;
  if (!inTransaction) {
    if (SHOW_LIGHT_TRANSACTIONS)     Slog.i(TAG_WM,">>> OPEN TRANSACTION ScreenRotationAnimation");
    SurfaceControl.openTransaction();
  }
  try {
    try {
      int flags=SurfaceControl.HIDDEN;
      if (isSecure) {
        flags|=SurfaceControl.SECURE;
      }
      if (DEBUG_SURFACE_TRACE) {
        mSurfaceControl=new SurfaceTrace(session,"ScreenshotSurface",mWidth,mHeight,PixelFormat.OPAQUE,flags);
        Slog.w(TAG,"ScreenRotationAnimation ctor: displayOffset=" + mOriginalDisplayRect.toShortString());
      }
 else {
        mSurfaceControl=new SurfaceControl(session,"ScreenshotSurface",mWidth,mHeight,PixelFormat.OPAQUE,flags);
      }
      Surface sur=new Surface();
      sur.copyFrom(mSurfaceControl);
      SurfaceControl.screenshot(SurfaceControl.getBuiltInDisplay(SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN),sur);
      mSurfaceControl.setLayerStack(display.getLayerStack());
      mSurfaceControl.setLayer(SCREEN_FREEZE_LAYER_SCREENSHOT);
      mSurfaceControl.setAlpha(0);
      mSurfaceControl.show();
      sur.destroy();
    }
 catch (    OutOfResourcesException e) {
      Slog.w(TAG,"Unable to allocate freeze surface",e);
    }
    if (SHOW_TRANSACTIONS || SHOW_SURFACE_ALLOC)     Slog.i(TAG_WM,"  FREEZE " + mSurfaceControl + ": CREATE");
    setRotationInTransaction(originalRotation);
  }
  finally {
    if (!inTransaction) {
      SurfaceControl.closeTransaction();
      if (SHOW_LIGHT_TRANSACTIONS)       Slog.i(TAG_WM,"<<< CLOSE TRANSACTION ScreenRotationAnimation");
    }
  }
}
