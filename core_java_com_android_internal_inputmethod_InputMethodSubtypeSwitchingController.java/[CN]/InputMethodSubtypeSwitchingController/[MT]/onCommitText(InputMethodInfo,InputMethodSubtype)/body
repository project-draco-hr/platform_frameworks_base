{
synchronized (mTypedSubtypeHistory) {
    if (subtype == null) {
      Slog.w(TAG,"Invalid InputMethodSubtype: " + imi.getId() + ", "+ subtype);
      return;
    }
    if (DEBUG) {
      Slog.d(TAG,"onCommitText: " + imi.getId() + ", "+ subtype);
    }
    if (REQUIRE_SWITCHING_SUPPORT) {
      if (!imi.supportsSwitchingToNextInputMethod()) {
        Slog.w(TAG,imi.getId() + " doesn't support switching to next input method.");
        return;
      }
    }
    if (mTypedSubtypeHistory.size() >= MAX_HISTORY_SIZE) {
      mTypedSubtypeHistory.poll();
    }
    mTypedSubtypeHistory.addFirst(new SubtypeParams(imi,subtype));
  }
}
