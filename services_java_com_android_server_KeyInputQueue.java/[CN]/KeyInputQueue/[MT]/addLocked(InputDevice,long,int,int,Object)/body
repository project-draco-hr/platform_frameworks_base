{
  boolean poke=mFirst.next == mLast;
  QueuedEvent ev=obtainLocked(device,when,flags,classType,event);
  QueuedEvent p=mLast.prev;
  while (p != mFirst && ev.when < p.when) {
    p=p.prev;
  }
  ev.next=p.next;
  ev.prev=p;
  p.next=ev;
  ev.next.prev=ev;
  ev.inQueue=true;
  if (poke) {
    mFirst.notify();
    mWakeLock.acquire();
  }
}
