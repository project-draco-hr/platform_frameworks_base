{
  boolean poke=mFirst.next == mLast;
  QueuedEvent ev=obtainLocked(device,whenNano,flags,classType,event);
  QueuedEvent p=mLast.prev;
  while (p != mFirst && ev.whenNano < p.whenNano) {
    p=p.prev;
  }
  ev.next=p.next;
  ev.prev=p;
  p.next=ev;
  ev.next.prev=ev;
  ev.inQueue=true;
  if (poke) {
    long time;
    if (MEASURE_LATENCY) {
      time=System.nanoTime();
    }
    mFirst.notify();
    mWakeLock.acquire();
    if (MEASURE_LATENCY) {
      lt.sample("1 addLocked-queued event ",System.nanoTime() - time);
    }
  }
}
