{
  if (isInsideDisplay(di)) {
    return false;
  }
  VirtualKey vk=findVirtualKey(di);
  if (vk != null) {
    final InputDevice.MotionState ms=di.mAbs;
    mPressedVirtualKey=vk;
    vk.lastKeycode=scancodeToKeycode(di.id,vk.scancode);
    ms.mLastNumPointers=ms.mNextNumPointers;
    di.mKeyDownTime=curTime;
    if (DEBUG_VIRTUAL_KEYS)     Log.v(TAG,"Generate key down for: " + vk.scancode + " (keycode="+ vk.lastKeycode+ ")");
    KeyEvent event=newKeyEvent(di,di.mKeyDownTime,curTime,true,vk.lastKeycode,0,vk.scancode,KeyEvent.FLAG_VIRTUAL_HARD_KEY);
    mHapticFeedbackCallback.virtualKeyFeedback(event);
    addLocked(di,curTimeNano,ev.flags,RawInputEvent.CLASS_KEYBOARD,event);
  }
  if (false) {
    final InputDevice.AbsoluteInfo absx=di.absX;
    final InputDevice.AbsoluteInfo absy=di.absY;
    final InputDevice.MotionState absm=di.mAbs;
    Log.v(TAG,"Rejecting (" + absm.mNextData[MotionEvent.SAMPLE_X] + ","+ absm.mNextData[MotionEvent.SAMPLE_Y]+ "): outside of ("+ absx.minValue+ ","+ absy.minValue+ ")-("+ absx.maxValue+ ","+ absx.maxValue+ ")");
  }
  return true;
}
