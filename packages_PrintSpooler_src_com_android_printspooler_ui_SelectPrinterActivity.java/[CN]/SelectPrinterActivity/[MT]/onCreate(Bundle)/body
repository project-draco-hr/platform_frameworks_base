{
  super.onCreate(savedInstanceState);
  getActionBar().setIcon(R.drawable.ic_print);
  setContentView(R.layout.select_printer_activity);
  mPrinterRegistry=new PrinterRegistry(this,null);
  mListView=(ListView)findViewById(android.R.id.list);
  final DestinationAdapter adapter=new DestinationAdapter();
  adapter.registerDataSetObserver(new DataSetObserver(){
    @Override public void onChanged(){
      if (!isFinishing() && adapter.getCount() <= 0) {
        updateEmptyView(adapter);
      }
    }
    @Override public void onInvalidated(){
      if (!isFinishing()) {
        updateEmptyView(adapter);
      }
    }
  }
);
  mListView.setAdapter(adapter);
  mListView.setOnItemClickListener(new AdapterView.OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      if (!((DestinationAdapter)mListView.getAdapter()).isActionable(position)) {
        return;
      }
      PrinterInfo printer=(PrinterInfo)mListView.getAdapter().getItem(position);
      onPrinterSelected(printer.getId());
    }
  }
);
  registerForContextMenu(mListView);
}
