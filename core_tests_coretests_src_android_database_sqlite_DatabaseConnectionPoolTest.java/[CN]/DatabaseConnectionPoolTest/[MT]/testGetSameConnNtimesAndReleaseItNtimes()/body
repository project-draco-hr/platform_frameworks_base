{
  mTestPool.setMaxPoolSize(MAX_CONN);
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  HashMap<String,SQLiteDatabase> dbObjs=new HashMap<String,SQLiteDatabase>();
  for (int i=0; i < MAX_CONN; i++) {
    SQLiteDatabase db=mTestPool.get(TEST_SQLS[i]);
    executeSqlOnDatabaseConn(db,TEST_SQLS[i]);
    assertFalse(dbObjs.values().contains(db));
    dbObjs.put(TEST_SQLS[i],db);
  }
  assertEquals(0,mTestPool.getFreePoolSize());
  assertEquals(MAX_CONN,mTestPool.getSize());
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  for (int i=0; i < MAX_CONN; i++) {
    assertEquals(1,mTestPool.getPool().get(i).getNumHolders());
  }
  String testSql=TEST_SQLS[MAX_CONN - 1];
  SQLiteDatabase db1=mTestPool.get(testSql);
  assertEquals(0,mTestPool.getFreePoolSize());
  assertEquals(MAX_CONN,mTestPool.getSize());
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  assertTrue(dbObjs.values().contains(db1));
  assertEquals(db1,dbObjs.get(testSql));
  assertFalse(mTestPool.isDatabaseObjFree(db1));
  DatabaseConnectionPool.PoolObj poolObj=mTestPool.getPool().get(db1.mConnectionNum - 1);
  int numHolders=poolObj.getNumHolders();
  assertEquals(2,numHolders);
  assertEquals(0,mTestPool.getFreePoolSize());
  assertEquals(MAX_CONN,mTestPool.getSize());
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  int N=100;
  for (int i=0; i < N; i++) {
    SQLiteDatabase db2=mTestPool.get(testSql);
    assertEquals(db1,db2);
    assertFalse(mTestPool.isDatabaseObjFree(db2));
    int prev=numHolders;
    numHolders=poolObj.getNumHolders();
    assertEquals(prev + 1,numHolders);
  }
  for (int i=0; i < N; i++) {
    mTestPool.release(db1);
    int prev=numHolders;
    numHolders=poolObj.getNumHolders();
    assertEquals(prev - 1,numHolders);
    assertFalse(mTestPool.isDatabaseObjFree(db1));
  }
  assertFalse(mTestPool.isDatabaseObjFree(db1));
  assertEquals(2,poolObj.getNumHolders());
  assertEquals(0,mTestPool.getFreePoolSize());
  assertEquals(MAX_CONN,mTestPool.getSize());
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  mTestPool.release(db1);
  mTestPool.release(db1);
  assertEquals(0,poolObj.getNumHolders());
  assertEquals(1,mTestPool.getFreePoolSize());
  assertEquals(MAX_CONN,mTestPool.getSize());
  assertEquals(MAX_CONN,mTestPool.getMaxPoolSize());
  assertTrue(mTestPool.isDatabaseObjFree(db1));
}
