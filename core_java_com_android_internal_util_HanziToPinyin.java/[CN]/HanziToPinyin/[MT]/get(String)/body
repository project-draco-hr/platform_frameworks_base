{
  ArrayList<Token> tokens=new ArrayList<Token>();
  if (!mHasChinaCollator || TextUtils.isEmpty(input)) {
    return tokens;
  }
  final int inputLength=input.length();
  final StringBuilder sb=new StringBuilder();
  int tokenType=Token.LATIN;
  for (int i=0; i < inputLength; i++) {
    final char character=input.charAt(i);
    if (character == ' ') {
      if (sb.length() > 0) {
        addToken(sb,tokens,tokenType);
      }
    }
 else     if (character < 256) {
      if (tokenType != Token.LATIN && sb.length() > 0) {
        addToken(sb,tokens,tokenType);
      }
      tokenType=Token.LATIN;
      sb.append(character);
    }
 else     if (character < FIRST_UNIHAN) {
      if (tokenType != Token.UNKNOWN && sb.length() > 0) {
        addToken(sb,tokens,tokenType);
      }
      tokenType=Token.UNKNOWN;
      sb.append(character);
    }
 else {
      Token t=getToken(character);
      if (t.type == Token.PINYIN) {
        if (sb.length() > 0) {
          addToken(sb,tokens,tokenType);
        }
        tokens.add(t);
        tokenType=Token.PINYIN;
      }
 else {
        if (tokenType != t.type && sb.length() > 0) {
          addToken(sb,tokens,tokenType);
        }
        tokenType=t.type;
        sb.append(character);
      }
    }
  }
  if (sb.length() > 0) {
    addToken(sb,tokens,tokenType);
  }
  return tokens;
}
