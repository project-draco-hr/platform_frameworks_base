{
  final String oldBaseStr=oldBase.getAbsolutePath();
  final String pathStr=file.getAbsolutePath();
  if (pathStr.contains("/.")) {
    throw new IOException("Invalid path (was relative) : " + pathStr);
  }
  if (pathStr.startsWith(oldBaseStr)) {
    final String relative=pathStr.substring(oldBaseStr.length());
    return new File(newBase,relative);
  }
  throw new IOException("File: " + pathStr + " outside base: "+ oldBaseStr);
}
