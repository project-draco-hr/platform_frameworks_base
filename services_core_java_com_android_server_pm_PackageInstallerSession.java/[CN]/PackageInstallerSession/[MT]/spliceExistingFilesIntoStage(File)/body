{
  final ApplicationInfo app=mPm.getApplicationInfo(mPackageName,0,userId);
  int n=0;
  final File[] oldFiles=new File(app.getCodePath()).listFiles();
  if (!ArrayUtils.isEmpty(oldFiles)) {
    for (    File oldFile : oldFiles) {
      if (!PackageParser.isApkFile(oldFile))       continue;
      final File newFile=new File(stageDir,oldFile.getName());
      try {
        Os.link(oldFile.getAbsolutePath(),newFile.getAbsolutePath());
        n++;
      }
 catch (      ErrnoException e) {
        throw new PackageManagerException(INSTALL_FAILED_INTERNAL_ERROR,"Failed to splice into stage",e);
      }
    }
  }
  if (LOGD)   Slog.d(TAG,"Spliced " + n + " existing APKs into stage");
}
