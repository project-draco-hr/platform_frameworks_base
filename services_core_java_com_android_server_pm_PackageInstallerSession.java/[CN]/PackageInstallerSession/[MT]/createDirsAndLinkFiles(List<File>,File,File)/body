{
  for (  File fromFile : fromFiles) {
    final File toFile=reparentPath(fromFile,fromDir,toDir);
    final StructStat stat;
    try {
      stat=Os.stat(fromFile.getAbsolutePath());
    }
 catch (    ErrnoException e) {
      throw new IOException("Failed to stat: " + fromFile.getAbsolutePath(),e);
    }
    if (OsConstants.S_ISDIR(stat.st_mode)) {
      if (LOGD)       Slog.d(TAG,"Creating directory " + toFile.getAbsolutePath());
      try {
        Os.mkdir(toFile.getAbsolutePath(),stat.st_mode);
      }
 catch (      ErrnoException e) {
        throw new IOException("Failed to create dir: " + toFile.getAbsolutePath(),e);
      }
      if (!SELinux.restorecon(toFile)) {
        throw new IOException("Failed to restorecon: " + toFile.getAbsolutePath());
      }
    }
 else {
      if (LOGD)       Slog.d(TAG,"Linking " + fromFile + " to "+ toFile);
      try {
        Os.link(fromFile.getAbsolutePath(),toFile.getAbsolutePath());
      }
 catch (      ErrnoException e) {
        throw new IOException("Failed to link " + fromFile + " to "+ toFile,e);
      }
    }
  }
  Slog.d(TAG,"Linked " + fromFiles.size() + " files into "+ toDir);
}
