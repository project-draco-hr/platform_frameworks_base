{
  for (  File file : toDir.listFiles()) {
    if (file.getName().endsWith(".tmp")) {
      file.delete();
    }
  }
  for (  File fromFile : fromFiles) {
    final File tmpFile=File.createTempFile("inherit",".tmp",toDir);
    if (LOGD)     Slog.d(TAG,"Copying " + fromFile + " to "+ tmpFile);
    if (!FileUtils.copyFile(fromFile,tmpFile)) {
      throw new IOException("Failed to copy " + fromFile + " to "+ tmpFile);
    }
    try {
      Os.chmod(tmpFile.getAbsolutePath(),0644);
    }
 catch (    ErrnoException e) {
      throw new IOException("Failed to chmod " + tmpFile);
    }
    final File toFile=new File(toDir,fromFile.getName());
    if (LOGD)     Slog.d(TAG,"Renaming " + tmpFile + " to "+ toFile);
    if (!tmpFile.renameTo(toFile)) {
      throw new IOException("Failed to rename " + tmpFile + " to "+ toFile);
    }
  }
  Slog.d(TAG,"Copied " + fromFiles.size() + " files into "+ toDir);
}
