{
  if (status != PackageManager.INSTALL_SUCCEEDED) {
    cleanUp();
    return false;
  }
 else {
    final File oldCodeFile=new File(getCodePath());
    final File oldResourceFile=new File(getResourcePath());
    final File oldLibraryFile=new File(getNativeLibraryPath());
    final String apkName=getNextCodePath(oldCodePath,pkgName,".apk");
    final File newCodeFile=new File(installDir,apkName + ".apk");
    if (!oldCodeFile.renameTo(newCodeFile)) {
      return false;
    }
    codeFileName=newCodeFile.getPath();
    final File newResFile=new File(getResourcePathFromCodePath());
    if (isFwdLocked() && !oldResourceFile.renameTo(newResFile)) {
      return false;
    }
    resourceFileName=newResFile.getPath();
    final File newLibraryFile=new File(getLibraryPathFromCodePath());
    if (newLibraryFile.exists()) {
      NativeLibraryHelper.removeNativeBinariesFromDirLI(newLibraryFile);
      newLibraryFile.delete();
    }
    if (!oldLibraryFile.renameTo(newLibraryFile)) {
      Slog.e(TAG,"Cannot rename native library directory " + oldLibraryFile.getPath() + " to "+ newLibraryFile.getPath());
      return false;
    }
    libraryPath=newLibraryFile.getPath();
    if (!setPermissions()) {
      return false;
    }
    if (!SELinux.restorecon(newCodeFile)) {
      return false;
    }
    return true;
  }
}
