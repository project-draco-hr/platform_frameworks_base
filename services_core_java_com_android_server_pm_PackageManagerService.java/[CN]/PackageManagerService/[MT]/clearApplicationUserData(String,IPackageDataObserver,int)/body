{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.CLEAR_APP_USER_DATA,null);
  enforceCrossUserPermission(Binder.getCallingUid(),userId,true,false,"clear application data");
  final DevicePolicyManagerInternal dpmi=LocalServices.getService(DevicePolicyManagerInternal.class);
  if (dpmi != null && dpmi.hasDeviceOwnerOrProfileOwner(packageName,userId)) {
    throw new SecurityException("Cannot clear data for a device owner or a profile owner");
  }
  mHandler.post(new Runnable(){
    public void run(){
      mHandler.removeCallbacks(this);
      final boolean succeeded;
synchronized (mInstallLock) {
        try (PackageFreezer freezer=freezePackage(packageName,"clearApplicationUserData")){
          succeeded=clearApplicationUserDataLIF(packageName,userId);
        }
       }
      clearExternalStorageDataSync(packageName,userId,true);
      if (succeeded) {
        DeviceStorageMonitorInternal dsm=LocalServices.getService(DeviceStorageMonitorInternal.class);
        if (dsm != null) {
          dsm.checkMemory();
        }
      }
      if (observer != null) {
        try {
          observer.onRemoveCompleted(packageName,succeeded);
        }
 catch (        RemoteException e) {
          Log.i(TAG,"Observer no longer exists.");
        }
      }
    }
  }
);
}
