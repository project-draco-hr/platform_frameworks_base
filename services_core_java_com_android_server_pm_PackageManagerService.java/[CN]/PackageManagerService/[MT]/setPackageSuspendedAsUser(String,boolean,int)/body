{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.MANAGE_USERS,null);
  enforceCrossUserPermission(Binder.getCallingUid(),userId,true,true,"setPackageSuspended for user " + userId);
  long callingId=Binder.clearCallingIdentity();
  try {
    boolean changed=false;
    boolean success=false;
synchronized (mPackages) {
      final PackageSetting pkgSetting=mSettings.mPackages.get(packageName);
      if (pkgSetting != null) {
        if (pkgSetting.getSuspended(userId) != suspended) {
          pkgSetting.setSuspended(suspended,userId);
          mSettings.writePackageRestrictionsLPr(userId);
          changed=true;
        }
        success=true;
      }
    }
    if (changed) {
      sendPackagesSuspendedForUser(new String[]{packageName},userId,suspended);
    }
    return success;
  }
  finally {
    Binder.restoreCallingIdentity(callingId);
  }
}
