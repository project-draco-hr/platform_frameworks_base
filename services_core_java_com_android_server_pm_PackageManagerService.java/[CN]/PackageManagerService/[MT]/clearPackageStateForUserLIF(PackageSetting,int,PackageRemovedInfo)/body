{
  final int[] userIds=(userId == UserHandle.USER_ALL) ? sUserManager.getUserIds() : new int[]{userId};
  for (  int nextUserId : userIds) {
    if (DEBUG_REMOVE) {
      Slog.d(TAG,"Updating package:" + ps.name + " install state for user:"+ nextUserId);
    }
    final int flags=StorageManager.FLAG_STORAGE_CE | StorageManager.FLAG_STORAGE_DE;
    try {
      mInstaller.destroyAppData(ps.volumeUuid,ps.name,nextUserId,flags);
    }
 catch (    InstallerException e) {
      Slog.w(TAG,"Couldn't remove cache files for package " + ps.name,e);
      return false;
    }
    removeKeystoreDataIfNeeded(nextUserId,ps.appId);
    schedulePackageCleaning(ps.name,nextUserId,false);
synchronized (mPackages) {
      if (clearPackagePreferredActivitiesLPw(ps.name,nextUserId)) {
        scheduleWritePackageRestrictionsLocked(nextUserId);
      }
      resetUserChangesToRuntimePermissionsAndFlagsLPw(ps,nextUserId);
    }
  }
  if (outInfo != null) {
    outInfo.removedPackage=ps.name;
    outInfo.removedAppId=ps.appId;
    outInfo.removedUsers=userIds;
  }
  return true;
}
