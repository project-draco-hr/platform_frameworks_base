{
  final List<File> files=new ArrayList<>();
  Collections.addAll(files,FileUtils.listFilesOrEmpty(Environment.getDataUserDeDirectory(volumeUuid)));
  Collections.addAll(files,FileUtils.listFilesOrEmpty(Environment.getDataUserCeDirectory(volumeUuid)));
  Collections.addAll(files,FileUtils.listFilesOrEmpty(Environment.getDataSystemDeDirectory()));
  Collections.addAll(files,FileUtils.listFilesOrEmpty(Environment.getDataSystemCeDirectory()));
  for (  File file : files) {
    if (!file.isDirectory())     continue;
    final int userId;
    final UserInfo info;
    try {
      userId=Integer.parseInt(file.getName());
      info=sUserManager.getUserInfo(userId);
    }
 catch (    NumberFormatException e) {
      Slog.w(TAG,"Invalid user directory " + file);
      continue;
    }
    boolean destroyUser=false;
    if (info == null) {
      logCriticalInfo(Log.WARN,"Destroying user directory " + file + " because no matching user was found");
      destroyUser=true;
    }
 else     if (!mOnlyCore) {
      try {
        UserManagerService.enforceSerialNumber(file,info.serialNumber);
      }
 catch (      IOException e) {
        logCriticalInfo(Log.WARN,"Destroying user directory " + file + " because we failed to enforce serial number: "+ e);
        destroyUser=true;
      }
    }
    if (destroyUser) {
synchronized (mInstallLock) {
        destroyUserDataLI(volumeUuid,userId,StorageManager.FLAG_STORAGE_DE | StorageManager.FLAG_STORAGE_CE);
      }
    }
  }
}
