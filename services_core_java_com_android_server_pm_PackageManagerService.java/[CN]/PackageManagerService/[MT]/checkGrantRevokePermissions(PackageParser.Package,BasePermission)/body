{
  int index=pkg.requestedPermissions.indexOf(bp.name);
  if (index == -1) {
    throw new SecurityException("Package " + pkg.packageName + " has not requested permission "+ bp.name);
  }
  boolean isNormal=((bp.protectionLevel & PermissionInfo.PROTECTION_MASK_BASE) == PermissionInfo.PROTECTION_NORMAL);
  boolean isDangerous=((bp.protectionLevel & PermissionInfo.PROTECTION_MASK_BASE) == PermissionInfo.PROTECTION_DANGEROUS);
  boolean isDevelopment=((bp.protectionLevel & PermissionInfo.PROTECTION_FLAG_DEVELOPMENT) != 0);
  if (!isNormal && !isDangerous && !isDevelopment) {
    throw new SecurityException("Permission " + bp.name + " is not a changeable permission type");
  }
  if (isNormal || isDangerous) {
    if (pkg.requestedPermissionsRequired.get(index)) {
      throw new SecurityException("Can't change " + bp.name + ". It is required by the application");
    }
  }
}
