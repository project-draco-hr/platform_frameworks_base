{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.SET_PREFERRED_APPLICATIONS,null);
synchronized (mPackages) {
    final long identity=Binder.clearCallingIdentity();
    try {
      clearPackagePreferredActivitiesLPw(null,userId);
      mSettings.applyDefaultPreferredAppsLPw(this,userId);
      applyFactoryDefaultBrowserLPw(userId);
      clearIntentFilterVerificationsLPw(userId);
      primeDomainVerificationsLPw(userId);
      resetUserChangesToRuntimePermissionsAndFlagsLPw(userId);
      scheduleWritePackageRestrictionsLocked(userId);
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
  }
}
