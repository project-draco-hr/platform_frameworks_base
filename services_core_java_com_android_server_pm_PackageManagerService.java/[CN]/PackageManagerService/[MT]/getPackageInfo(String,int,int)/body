{
  if (!sUserManager.exists(userId))   return null;
  flags=updateFlagsForPackage(flags,userId,packageName);
  enforceCrossUserPermission(Binder.getCallingUid(),userId,false,false,"get package info");
synchronized (mPackages) {
    final boolean matchFactoryOnly=(flags & MATCH_FACTORY_ONLY) != 0;
    PackageParser.Package p=null;
    if (matchFactoryOnly) {
      final PackageSetting ps=mSettings.getDisabledSystemPkgLPr(packageName);
      if (ps != null) {
        return generatePackageInfo(ps,flags,userId);
      }
    }
    if (p == null) {
      p=mPackages.get(packageName);
      if (matchFactoryOnly && !isSystemApp(p)) {
        return null;
      }
    }
    if (DEBUG_PACKAGE_INFO)     Log.v(TAG,"getPackageInfo " + packageName + ": "+ p);
    if (p != null) {
      return generatePackageInfo((PackageSetting)p.mExtras,flags,userId);
    }
    if (!matchFactoryOnly && (flags & MATCH_UNINSTALLED_PACKAGES) != 0) {
      final PackageSetting ps=mSettings.mPackages.get(packageName);
      return generatePackageInfo(ps,flags,userId);
    }
  }
  return null;
}
