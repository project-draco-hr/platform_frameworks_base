{
  final int userSetFlags=PackageManager.FLAG_PERMISSION_USER_SET | PackageManager.FLAG_PERMISSION_USER_FIXED | PackageManager.FLAG_PERMISSION_REVOKE_ON_UPGRADE;
  boolean needsWrite=false;
  for (  PermissionState state : permissionsState.getRuntimePermissionStates(userId)) {
    BasePermission bp=mSettings.mPermissions.get(state.getName());
    if (bp != null) {
      permissionsState.revokeRuntimePermission(bp,userId);
      permissionsState.updatePermissionFlags(bp,userId,userSetFlags,0);
      needsWrite=true;
    }
  }
  if (needsWrite) {
    mSettings.writeRuntimePermissionsForUserLPr(userId,true);
  }
}
