{
  final Intent verification=new Intent(Intent.ACTION_PACKAGE_NEEDS_VERIFICATION);
  final List<ResolveInfo> receivers=queryIntentReceivers(verification,PACKAGE_MIME_TYPE,PackageManager.GET_DISABLED_COMPONENTS,0);
  String requiredVerifier=null;
  final int N=receivers.size();
  for (int i=0; i < N; i++) {
    final ResolveInfo info=receivers.get(i);
    if (info.activityInfo == null) {
      continue;
    }
    final String packageName=info.activityInfo.packageName;
    final PackageSetting ps=mSettings.mPackages.get(packageName);
    if (ps == null) {
      continue;
    }
    final GrantedPermissions gp=ps.sharedUser != null ? ps.sharedUser : ps;
    if (!gp.grantedPermissions.contains(android.Manifest.permission.PACKAGE_VERIFICATION_AGENT)) {
      continue;
    }
    if (requiredVerifier != null) {
      throw new RuntimeException("There can be only one required verifier");
    }
    requiredVerifier=packageName;
  }
  return requiredVerifier;
}
