{
  if (StorageManager.isFileBasedEncryptionEnabled()) {
    final IMountService mount=IMountService.Stub.asInterface(ServiceManager.getService("mount"));
    if (mount == null) {
      Slog.w(TAG,"Early during boot, assuming not encrypted");
      return flags;
    }
    final long token=Binder.clearCallingIdentity();
    try {
      if (!mount.isUserKeyUnlocked(userId)) {
        flags|=PackageManager.MATCH_ENCRYPTION_AWARE_ONLY;
      }
    }
 catch (    RemoteException e) {
      throw e.rethrowAsRuntimeException();
    }
 finally {
      Binder.restoreCallingIdentity(token);
    }
  }
  return flags;
}
