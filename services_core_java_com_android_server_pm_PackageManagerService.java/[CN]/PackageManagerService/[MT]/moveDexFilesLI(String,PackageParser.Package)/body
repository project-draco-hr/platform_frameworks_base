{
  if ((newPackage.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
    final String[] instructionSets=getAppDexInstructionSets(newPackage.applicationInfo);
    String[] dexCodeInstructionSets=getDexCodeInstructionSets(instructionSets);
    for (    String dexCodeInstructionSet : dexCodeInstructionSets) {
      int retCode=mInstaller.movedex(oldCodePath,newPackage.baseCodePath,dexCodeInstructionSet);
      if (retCode != 0) {
        newPackage.mDexOptPerformed.clear();
        mInstaller.rmdex(oldCodePath,dexCodeInstructionSet);
        mInstaller.rmdex(newPackage.baseCodePath,dexCodeInstructionSet);
      }
    }
  }
  return PackageManager.INSTALL_SUCCEEDED;
}
