{
  if ((newPackage.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
    final String[] instructionSets=getAppDexInstructionSets(newPackage.applicationInfo);
    for (    String instructionSet : instructionSets) {
      int retCode=mInstaller.movedex(oldCodePath,newPackage.baseCodePath,instructionSet);
      if (retCode != 0) {
        newPackage.mDexOptPerformed.clear();
        mInstaller.rmdex(oldCodePath,instructionSet);
        mInstaller.rmdex(newPackage.baseCodePath,instructionSet);
      }
    }
  }
  return PackageManager.INSTALL_SUCCEEDED;
}
