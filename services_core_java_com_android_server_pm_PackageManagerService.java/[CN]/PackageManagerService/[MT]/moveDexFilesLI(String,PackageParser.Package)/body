{
  if ((newPackage.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
    final String instructionSet=getAppInstructionSet(newPackage.applicationInfo);
    int retCode=mInstaller.movedex(oldCodePath,newPackage.baseCodePath,instructionSet);
    if (retCode != 0) {
      newPackage.mDexOptNeeded=true;
      mInstaller.rmdex(oldCodePath,instructionSet);
      mInstaller.rmdex(newPackage.baseCodePath,instructionSet);
    }
  }
  return PackageManager.INSTALL_SUCCEEDED;
}
