{
  if (mLazyDexOpt || (!isFirstBoot() && mPackageUsage.isHistoricalPackageUsageAvailable())) {
    long dexOptLRUThresholdInMinutes;
    if (mLazyDexOpt) {
      dexOptLRUThresholdInMinutes=30;
    }
 else {
      dexOptLRUThresholdInMinutes=7 * 24 * 60;
    }
    long dexOptLRUThresholdInMills=dexOptLRUThresholdInMinutes * 60 * 1000;
    int total=pkgs.size();
    int skipped=0;
    long now=System.currentTimeMillis();
    for (Iterator<PackageParser.Package> i=pkgs.iterator(); i.hasNext(); ) {
      PackageParser.Package pkg=i.next();
      long then=pkg.mLastPackageUsageTimeInMills;
      if (then + dexOptLRUThresholdInMills < now) {
        if (DEBUG_DEXOPT) {
          Log.i(TAG,"Skipping dexopt of " + pkg.packageName + " last resumed: "+ ((then == 0) ? "never" : new Date(then)));
        }
        i.remove();
        skipped++;
      }
    }
    if (DEBUG_DEXOPT) {
      Log.i(TAG,"Skipped optimizing " + skipped + " of "+ total);
    }
  }
}
