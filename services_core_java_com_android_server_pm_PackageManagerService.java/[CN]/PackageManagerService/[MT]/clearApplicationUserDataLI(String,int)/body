{
  if (packageName == null) {
    Slog.w(TAG,"Attempt to delete null packageName.");
    return false;
  }
  PackageParser.Package pkg;
  boolean dataOnly=false;
  final int appId;
synchronized (mPackages) {
    pkg=mPackages.get(packageName);
    if (pkg == null) {
      dataOnly=true;
      PackageSetting ps=mSettings.mPackages.get(packageName);
      if ((ps == null) || (ps.pkg == null)) {
        Slog.w(TAG,"Package named '" + packageName + "' doesn't exist.");
        return false;
      }
      pkg=ps.pkg;
    }
    if (!dataOnly) {
      if (pkg == null) {
        Slog.w(TAG,"Package named '" + packageName + "' doesn't exist.");
        return false;
      }
      final ApplicationInfo applicationInfo=pkg.applicationInfo;
      if (applicationInfo == null) {
        Slog.w(TAG,"Package " + packageName + " has no applicationInfo.");
        return false;
      }
    }
    if (pkg != null && pkg.applicationInfo != null) {
      appId=pkg.applicationInfo.uid;
    }
 else {
      appId=-1;
    }
  }
  int retCode=mInstaller.clearUserData(packageName,userId);
  if (retCode < 0) {
    Slog.w(TAG,"Couldn't remove cache files for package: " + packageName);
    return false;
  }
  removeKeystoreDataIfNeeded(userId,appId);
  if (pkg != null && pkg.applicationInfo.primaryCpuAbi != null && !VMRuntime.is64BitAbi(pkg.applicationInfo.primaryCpuAbi)) {
    final String nativeLibPath=pkg.applicationInfo.nativeLibraryDir;
    if (mInstaller.linkNativeLibraryDirectory(pkg.packageName,nativeLibPath,userId) < 0) {
      Slog.w(TAG,"Failed linking native library dir");
      return false;
    }
  }
  return true;
}
