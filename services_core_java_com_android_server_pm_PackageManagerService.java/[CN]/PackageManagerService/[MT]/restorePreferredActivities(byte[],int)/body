{
  if (Binder.getCallingUid() != Process.SYSTEM_UID) {
    throw new SecurityException("Only the system may call restorePreferredActivities()");
  }
  try {
    final XmlPullParser parser=Xml.newPullParser();
    parser.setInput(new ByteArrayInputStream(backup),null);
    int type;
    while ((type=parser.next()) != XmlPullParser.START_TAG && type != XmlPullParser.END_DOCUMENT) {
    }
    if (type != XmlPullParser.START_TAG) {
      if (DEBUG_BACKUP) {
        Slog.e(TAG,"Didn't find start tag during restore");
      }
      return;
    }
    if (!TAG_PREFERRED_BACKUP.equals(parser.getName())) {
      if (DEBUG_BACKUP) {
        Slog.e(TAG,"Found unexpected tag " + parser.getName());
      }
      return;
    }
    while ((type=parser.next()) == XmlPullParser.TEXT) {
    }
synchronized (mPackages) {
      mSettings.readPreferredActivitiesLPw(parser,userId);
    }
  }
 catch (  Exception e) {
    if (DEBUG_BACKUP) {
      Slog.e(TAG,"Exception restoring preferred activities: " + e.getMessage());
    }
  }
}
