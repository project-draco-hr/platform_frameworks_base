{
  int callingUid=Binder.getCallingUid();
  if (callingUid != Process.SYSTEM_UID) {
    throw new SecurityException("addPersistentPreferredActivity can only be run by the system");
  }
  if (filter.countActions() == 0) {
    Slog.w(TAG,"Cannot set a preferred activity with no filter actions");
    return;
  }
synchronized (mPackages) {
    Slog.i(TAG,"Adding persistent preferred activity " + activity + " for user "+ userId+ " :");
    filter.dump(new LogPrinter(Log.INFO,TAG),"  ");
    mSettings.editPersistentPreferredActivitiesLPw(userId).addFilter(new PersistentPreferredActivity(filter,activity));
    mSettings.writePackageRestrictionsLPr(userId);
  }
}
