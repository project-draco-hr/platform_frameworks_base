{
  if (!mPackageUsage.isHistoricalPackageUsageAvailable()) {
    UsageStatsManager usm=(UsageStatsManager)mContext.getSystemService(Context.USAGE_STATS_SERVICE);
    if (usm == null) {
      throw new IllegalStateException("UsageStatsManager must be initialized");
    }
    long now=System.currentTimeMillis();
    Map<String,UsageStats> stats=usm.queryAndAggregateUsageStats(now - mDexOptLRUThresholdInMills,now);
    for (    Map.Entry<String,UsageStats> entry : stats.entrySet()) {
      String packageName=entry.getKey();
      PackageParser.Package pkg=mPackages.get(packageName);
      if (pkg == null) {
        continue;
      }
      UsageStats usage=entry.getValue();
      pkg.mLastPackageUsageTimeInMills=usage.getLastTimeUsed();
      mPackageUsage.mIsHistoricalPackageUsageAvailable=true;
    }
  }
}
