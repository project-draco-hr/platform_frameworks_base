{
  if (!UserManager.isSplitSystemUser()) {
    return;
  }
  AppsQueryHelper queryHelper=new AppsQueryHelper(this);
  Set<String> enableApps=new ArraySet<>();
  enableApps.addAll(queryHelper.queryApps(AppsQueryHelper.GET_NON_LAUNCHABLE_APPS | AppsQueryHelper.GET_APPS_WITH_INTERACT_ACROSS_USERS_PERM | AppsQueryHelper.GET_IMES,true,UserHandle.SYSTEM));
  ArraySet<String> wlApps=SystemConfig.getInstance().getSystemUserWhitelistedApps();
  enableApps.addAll(wlApps);
  ArraySet<String> blApps=SystemConfig.getInstance().getSystemUserBlacklistedApps();
  enableApps.removeAll(blApps);
  List<String> systemApps=queryHelper.queryApps(0,true,UserHandle.SYSTEM);
  final int systemAppsSize=systemApps.size();
synchronized (mPackages) {
    for (int i=0; i < systemAppsSize; i++) {
      String pName=systemApps.get(i);
      PackageSetting pkgSetting=mSettings.mPackages.get(pName);
      if (pkgSetting == null) {
        continue;
      }
      boolean installed=enableApps.contains(pName);
      pkgSetting.setInstalled(installed,UserHandle.USER_SYSTEM);
    }
  }
}
