{
  PackageParser.Package p;
  final String targetInstructionSet;
synchronized (mPackages) {
    p=mPackages.get(packageName);
    if (p == null) {
      return false;
    }
    mPackageUsage.write(false);
    targetInstructionSet=instructionSet != null ? instructionSet : getPrimaryInstructionSet(p.applicationInfo);
    if (p.mDexOptPerformed.contains(targetInstructionSet)) {
      return false;
    }
  }
  long callingId=Binder.clearCallingIdentity();
  try {
synchronized (mInstallLock) {
      final String[] instructionSets=new String[]{targetInstructionSet};
      int result=mPackageDexOptimizer.performDexOpt(p,instructionSets,true);
      return result == PackageDexOptimizer.DEX_OPT_PERFORMED;
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingId);
  }
}
