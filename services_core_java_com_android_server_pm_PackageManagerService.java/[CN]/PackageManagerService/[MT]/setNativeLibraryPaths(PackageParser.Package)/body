{
  final ApplicationInfo info=pkg.applicationInfo;
  final String codePath=pkg.codePath;
  final File codeFile=new File(codePath);
  final String apkRoot=calculateApkRoot(info.sourceDir);
  final boolean bundledApp=isSystemApp(info) && !isUpdatedSystemApp(info);
  final boolean asecApp=isForwardLocked(info) || isExternal(info);
  info.nativeLibraryRootDir=null;
  info.nativeLibraryRootRequiresIsa=false;
  info.nativeLibraryDir=null;
  info.secondaryNativeLibraryDir=null;
  if (bundledApp) {
    final boolean is64Bit=(info.primaryCpuAbi != null) && VMRuntime.is64BitAbi(info.primaryCpuAbi);
    final String apkName=deriveCodePathName(codePath);
    final String libDir=is64Bit ? LIB64_DIR_NAME : LIB_DIR_NAME;
    info.nativeLibraryRootDir=Environment.buildPath(new File(apkRoot),libDir,apkName).getAbsolutePath();
    info.nativeLibraryRootRequiresIsa=false;
    info.nativeLibraryDir=info.nativeLibraryRootDir;
    if (info.secondaryCpuAbi != null) {
      final String secondaryLibDir=is64Bit ? LIB_DIR_NAME : LIB64_DIR_NAME;
      info.secondaryNativeLibraryDir=Environment.buildPath(new File(apkRoot),secondaryLibDir,apkName).getAbsolutePath();
    }
  }
 else   if (isApkFile(codeFile)) {
    if (asecApp) {
      info.nativeLibraryRootDir=new File(codeFile.getParentFile(),LIB_DIR_NAME).getAbsolutePath();
    }
 else {
      final String apkName=deriveCodePathName(codePath);
      info.nativeLibraryRootDir=new File(mAppLib32InstallDir,apkName).getAbsolutePath();
    }
    info.nativeLibraryRootRequiresIsa=false;
    info.nativeLibraryDir=info.nativeLibraryRootDir;
  }
 else {
    info.nativeLibraryRootDir=new File(codeFile,LIB_DIR_NAME).getAbsolutePath();
    info.nativeLibraryRootRequiresIsa=true;
    if (info.primaryCpuAbi != null) {
      info.nativeLibraryDir=new File(info.nativeLibraryRootDir,VMRuntime.getInstructionSet(info.primaryCpuAbi)).getAbsolutePath();
    }
    if (info.secondaryCpuAbi != null) {
      info.secondaryNativeLibraryDir=new File(info.nativeLibraryRootDir,VMRuntime.getInstructionSet(info.secondaryCpuAbi)).getAbsolutePath();
    }
  }
}
