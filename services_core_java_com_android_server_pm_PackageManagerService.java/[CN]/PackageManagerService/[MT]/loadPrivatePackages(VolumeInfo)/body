{
  final ArrayList<ApplicationInfo> loaded=new ArrayList<>();
  final int parseFlags=mDefParseFlags | PackageParser.PARSE_EXTERNAL_STORAGE;
synchronized (mInstallLock) {
synchronized (mPackages) {
      final List<PackageSetting> packages=mSettings.getVolumePackagesLPr(vol.fsUuid);
      for (      PackageSetting ps : packages) {
        final PackageParser.Package pkg;
        try {
          pkg=scanPackageLI(ps.codePath,parseFlags,SCAN_INITIAL,0L,null);
          loaded.add(pkg.applicationInfo);
        }
 catch (        PackageManagerException e) {
          Slog.w(TAG,"Failed to scan " + ps.codePath + ": "+ e.getMessage());
        }
      }
      mSettings.writeLPr();
    }
  }
  if (DEBUG_INSTALL)   Slog.d(TAG,"Loaded packages " + loaded);
  sendResourcesChangedBroadcast(true,false,loaded,null);
}
