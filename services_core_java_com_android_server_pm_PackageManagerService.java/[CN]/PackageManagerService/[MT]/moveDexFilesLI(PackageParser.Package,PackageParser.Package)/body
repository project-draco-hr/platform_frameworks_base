{
  if ((newPackage.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
    final String instructionSet=getAppInstructionSet(newPackage.applicationInfo);
    boolean moveSuccess=false;
    if (oldPackage != null && (oldPackage.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
      if (mInstaller.movedex(oldPackage.codePath,newPackage.codePath,instructionSet) == 0) {
        moveSuccess=true;
      }
    }
    if (!moveSuccess) {
      if (oldPackage != null) {
        mInstaller.rmdex(oldPackage.codePath,instructionSet);
      }
      mInstaller.rmdex(newPackage.codePath,instructionSet);
      newPackage.mDexOptNeeded=true;
    }
  }
  return PackageManager.INSTALL_SUCCEEDED;
}
