{
  final PackageSetting ps;
synchronized (mPackages) {
    ps=mSettings.mPackages.get(pkg.packageName);
    mSettings.writeKernelMappingLPr(ps);
  }
  final UserManager um=mContext.getSystemService(UserManager.class);
  UserManagerInternal umInternal=getUserManagerInternal();
  for (  UserInfo user : um.getUsers()) {
    final int flags;
    if (umInternal.isUserUnlockingOrUnlocked(user.id)) {
      flags=StorageManager.FLAG_STORAGE_DE | StorageManager.FLAG_STORAGE_CE;
    }
 else     if (umInternal.isUserRunning(user.id)) {
      flags=StorageManager.FLAG_STORAGE_DE;
    }
 else {
      continue;
    }
    if (ps.getInstalled(user.id)) {
      prepareAppDataLIF(pkg,user.id,flags,true);
    }
  }
}
