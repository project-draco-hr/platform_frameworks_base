{
  enforceSystemOrRoot("Only the system can request package update");
  boolean causeUpgrade=isUpgrade();
  boolean causeFirstBoot=isFirstBoot() || mIsPreNUpgrade;
  boolean causePrunedCache=VMRuntime.didPruneDalvikCache();
  if (!causeUpgrade && !causeFirstBoot && !causePrunedCache) {
    return;
  }
  List<PackageParser.Package> pkgs;
synchronized (mPackages) {
    pkgs=PackageManagerServiceUtils.getPackagesForDexopt(mPackages.values(),this);
  }
  int curr=0;
  int total=pkgs.size();
  for (  PackageParser.Package pkg : pkgs) {
    curr++;
    if (!PackageDexOptimizer.canOptimizePackage(pkg)) {
      if (DEBUG_DEXOPT) {
        Log.i(TAG,"Skipping update of of non-optimizable app " + pkg.packageName);
      }
      continue;
    }
    if (DEBUG_DEXOPT) {
      Log.i(TAG,"Extracting app " + curr + " of "+ total+ ": "+ pkg.packageName);
    }
    if (!isFirstBoot()) {
      try {
        ActivityManagerNative.getDefault().showBootMessage(mContext.getResources().getString(R.string.android_upgrading_apk,curr,total),true);
      }
 catch (      RemoteException e) {
      }
    }
    performDexOpt(pkg.packageName,null,true,causeFirstBoot ? REASON_FIRST_BOOT : REASON_BOOT,false);
  }
}
