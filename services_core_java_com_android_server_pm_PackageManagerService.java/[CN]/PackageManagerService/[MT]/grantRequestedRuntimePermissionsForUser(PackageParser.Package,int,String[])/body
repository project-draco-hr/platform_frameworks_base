{
  SettingBase sb=(SettingBase)pkg.mExtras;
  if (sb == null) {
    return;
  }
  PermissionsState permissionsState=sb.getPermissionsState();
  final int immutableFlags=PackageManager.FLAG_PERMISSION_SYSTEM_FIXED | PackageManager.FLAG_PERMISSION_POLICY_FIXED;
  for (  String permission : pkg.requestedPermissions) {
    final BasePermission bp;
synchronized (mPackages) {
      bp=mSettings.mPermissions.get(permission);
    }
    if (bp != null && (bp.isRuntime() || bp.isDevelopment()) && (grantedPermissions == null || ArrayUtils.contains(grantedPermissions,permission))) {
      final int flags=permissionsState.getPermissionFlags(permission,userId);
      if ((flags & immutableFlags) == 0) {
        grantRuntimePermission(pkg.packageName,permission,userId);
      }
    }
  }
}
