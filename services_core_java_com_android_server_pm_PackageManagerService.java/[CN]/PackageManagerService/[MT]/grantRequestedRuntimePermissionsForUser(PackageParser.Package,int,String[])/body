{
  SettingBase sb=(SettingBase)pkg.mExtras;
  if (sb == null) {
    return;
  }
  PermissionsState permissionsState=sb.getPermissionsState();
  final int immutableFlags=PackageManager.FLAG_PERMISSION_SYSTEM_FIXED | PackageManager.FLAG_PERMISSION_POLICY_FIXED;
synchronized (mPackages) {
    for (    String permission : pkg.requestedPermissions) {
      BasePermission bp=mSettings.mPermissions.get(permission);
      if (bp != null && bp.isRuntime() && (grantedPermissions == null || ArrayUtils.contains(grantedPermissions,permission))) {
        final int flags=permissionsState.getPermissionFlags(permission,userId);
        if ((flags & immutableFlags) == 0) {
          grantRuntimePermission(pkg.packageName,permission,userId);
        }
      }
    }
  }
}
