{
  try {
    FileOutputStream fos=new FileOutputStream(stateFile.getFileDescriptor());
    @SuppressWarnings("resource") DataOutputStream out=new DataOutputStream(fos);
    out.writeInt(mCurrentBlobVersion);
    final int N=(state != null) ? state.size() : 0;
    out.writeInt(N);
    for (int i=0; i < N; i++) {
      final String key=state.keyAt(i);
      final long checksum=state.valueAt(i).longValue();
      if (DEBUG) {
        Log.i(TAG,"  writing key " + key + " checksum = "+ checksum);
      }
      out.writeUTF(key);
      out.writeLong(checksum);
    }
  }
 catch (  IOException e) {
    Log.e(TAG,"Unable to write updated state",e);
  }
}
