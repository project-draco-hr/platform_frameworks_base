{
  if (!mAllowScaling)   return 1f;
  final int layoutDirection=getLayoutDirection();
  final int absoluteGravity=Gravity.getAbsoluteGravity(mGravity,layoutDirection);
  float scaleX=1f;
  float scaleY=1f;
switch (absoluteGravity & Gravity.HORIZONTAL_GRAVITY_MASK) {
case Gravity.LEFT:
case Gravity.RIGHT:
    break;
case Gravity.CENTER_HORIZONTAL:
default :
  if (desiredWidth > actualWidth) {
    scaleX=(1f * actualWidth - mMaxTargetWidth) / (desiredWidth - mMaxTargetWidth);
  }
break;
}
switch (absoluteGravity & Gravity.VERTICAL_GRAVITY_MASK) {
case Gravity.TOP:
case Gravity.BOTTOM:
break;
case Gravity.CENTER_VERTICAL:
default :
if (desiredHeight > actualHeight) {
scaleY=(1f * actualHeight - mMaxTargetHeight) / (desiredHeight - mMaxTargetHeight);
}
break;
}
return Math.min(scaleX,scaleY);
}
