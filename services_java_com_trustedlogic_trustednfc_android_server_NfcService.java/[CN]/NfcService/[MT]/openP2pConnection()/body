{
  if (!mIsNfcEnabled) {
    return ErrorCodes.ERROR_NOT_INITIALIZED;
  }
  mContext.enforceCallingPermission(android.Manifest.permission.NFC_RAW,"NFC_RAW permission required to open NFC P2P connection");
  if (!mOpenPending) {
    NativeP2pDevice device;
    mOpenPending=true;
    device=mManager.doOpenP2pConnection(mTimeout);
    if (device != null) {
      mObjectMap.put(device.getHandle(),device);
      return device.getHandle();
    }
 else {
      mOpenPending=false;
      mManager.enableDiscovery(DISCOVERY_MODE_READER);
      return ErrorCodes.ERROR_IO;
    }
  }
 else {
    return ErrorCodes.ERROR_BUSY;
  }
}
