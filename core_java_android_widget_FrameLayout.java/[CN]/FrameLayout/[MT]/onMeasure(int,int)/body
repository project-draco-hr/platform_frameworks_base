{
  final int count=getChildCount();
  int maxHeight=0;
  int maxWidth=0;
  int childState=0;
  for (int i=0; i < count; i++) {
    final View child=getChildAt(i);
    if (mMeasureAllChildren || child.getVisibility() != GONE) {
      measureChildWithMargins(child,widthMeasureSpec,0,heightMeasureSpec,0);
      maxWidth=Math.max(maxWidth,child.getMeasuredWidth());
      maxHeight=Math.max(maxHeight,child.getMeasuredHeight());
      childState=combineMeasuredStates(childState,child.getMeasuredState());
    }
  }
  maxWidth+=mPaddingLeft + mPaddingRight + mForegroundPaddingLeft+ mForegroundPaddingRight;
  maxHeight+=mPaddingTop + mPaddingBottom + mForegroundPaddingTop+ mForegroundPaddingBottom;
  maxHeight=Math.max(maxHeight,getSuggestedMinimumHeight());
  maxWidth=Math.max(maxWidth,getSuggestedMinimumWidth());
  final Drawable drawable=getForeground();
  if (drawable != null) {
    maxHeight=Math.max(maxHeight,drawable.getMinimumHeight());
    maxWidth=Math.max(maxWidth,drawable.getMinimumWidth());
  }
  setMeasuredDimension(resolveSizeAndState(maxWidth,widthMeasureSpec,childState),resolveSizeAndState(maxHeight,heightMeasureSpec,childState << MEASURED_HEIGHT_STATE_SHIFT));
}
