{
  boolean didSomething=false;
  if (userId == UserHandle.USER_ALL || userId == UserHandle.USER_SYSTEM) {
    didSomething=collectPackageProvidersLocked(packageName,filterByClasses,doit,evenPersistent,mSingletonByClass,result);
  }
  if (!doit && didSomething) {
    return true;
  }
  if (userId == UserHandle.USER_ALL) {
    for (int i=0; i < mProvidersByClassPerUser.size(); i++) {
      if (collectPackageProvidersLocked(packageName,filterByClasses,doit,evenPersistent,mProvidersByClassPerUser.valueAt(i),result)) {
        if (!doit) {
          return true;
        }
        didSomething=true;
      }
    }
  }
 else {
    HashMap<ComponentName,ContentProviderRecord> items=getProvidersByClass(userId);
    if (items != null) {
      didSomething|=collectPackageProvidersLocked(packageName,filterByClasses,doit,evenPersistent,items,result);
    }
  }
  return didSomething;
}
