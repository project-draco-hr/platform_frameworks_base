{
  super.onCreate(savedInstanceState);
  String server=Settings.Global.getString(getContentResolver(),"captive_portal_server");
  if (server == null)   server=DEFAULT_SERVER;
  try {
    mURL=new URL("http",server,"/generate_204");
    final Uri dataUri=getIntent().getData();
    if (!dataUri.getScheme().equals("netid")) {
      throw new MalformedURLException();
    }
    mNetId=Integer.parseInt(dataUri.getSchemeSpecificPart());
    mResponseToken=dataUri.getFragment();
  }
 catch (  MalformedURLException|NumberFormatException e) {
    done(CAPTIVE_PORTAL_APP_RETURN_WANTED_AS_IS);
  }
  final ConnectivityManager cm=ConnectivityManager.from(this);
  final Network network=new Network(mNetId);
  cm.bindProcessToNetwork(network);
  setContentView(R.layout.activity_captive_portal_login);
  getActionBar().setDisplayShowHomeEnabled(false);
  final NetworkCapabilities networkCapabilities=cm.getNetworkCapabilities(network);
  if (networkCapabilities == null) {
    finish();
    return;
  }
  mNetworkCallback=new NetworkCallback(){
    @Override public void onLost(    Network lostNetwork){
      if (network.equals(lostNetwork))       done(CAPTIVE_PORTAL_APP_RETURN_UNWANTED);
    }
  }
;
  final NetworkRequest.Builder builder=new NetworkRequest.Builder();
  for (  int transportType : networkCapabilities.getTransportTypes()) {
    builder.addTransportType(transportType);
  }
  cm.registerNetworkCallback(builder.build(),mNetworkCallback);
  final WebView myWebView=(WebView)findViewById(R.id.webview);
  myWebView.clearCache(true);
  WebSettings webSettings=myWebView.getSettings();
  webSettings.setJavaScriptEnabled(true);
  myWebView.setWebViewClient(new MyWebViewClient());
  myWebView.setWebChromeClient(new MyWebChromeClient());
  myWebView.loadData("","text/html",null);
}
