{
  super.onCreate(savedInstanceState);
  mUsbManager=(UsbManager)getSystemService(Context.USB_SERVICE);
  setContentView(R.layout.source_activity);
  mLogTextView=(TextView)findViewById(R.id.logTextView);
  mLogTextView.setMovementMethod(ScrollingMovementMethod.getInstance());
  mLogger=new TextLogger();
  mPresenter=new Presenter();
  mLogger.log("Waiting for accessory display sink to be attached to USB...");
  IntentFilter filter=new IntentFilter();
  filter.addAction(UsbManager.ACTION_USB_ACCESSORY_ATTACHED);
  filter.addAction(UsbManager.ACTION_USB_ACCESSORY_DETACHED);
  filter.addAction(ACTION_USB_ACCESSORY_PERMISSION);
  mReceiver=new AccessoryReceiver();
  registerReceiver(mReceiver,filter);
  Intent intent=getIntent();
  if (intent.getAction().equals(UsbManager.ACTION_USB_ACCESSORY_ATTACHED)) {
    UsbAccessory accessory=(UsbAccessory)intent.getParcelableExtra(UsbManager.EXTRA_ACCESSORY);
    if (accessory != null) {
      onAccessoryAttached(accessory);
    }
  }
 else {
    UsbAccessory[] accessories=mUsbManager.getAccessoryList();
    if (accessories != null) {
      for (      UsbAccessory accessory : accessories) {
        onAccessoryAttached(accessory);
      }
    }
  }
}
