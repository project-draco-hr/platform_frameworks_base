{
  if (!mHasUsbAccessory)   return;
  if (mConfigured) {
    String[] strings=nativeGetAccessoryStrings();
    if (strings != null) {
      mCurrentAccessory=new UsbAccessory(strings);
      Slog.d(TAG,"entering USB accessory mode: " + mCurrentAccessory);
      if (mSystemReady) {
        mSettingsManager.accessoryAttached(mCurrentAccessory);
      }
 else {
        mDeferAccessoryAttached=true;
      }
    }
 else {
      Slog.e(TAG,"nativeGetAccessoryStrings failed");
    }
  }
 else   if (!mConnected) {
    Slog.d(TAG,"exited USB accessory mode");
    setEnabledFunctions(mDefaultFunctions);
    if (mCurrentAccessory != null) {
      if (mSystemReady) {
        mSettingsManager.accessoryDetached(mCurrentAccessory);
      }
      mCurrentAccessory=null;
    }
  }
}
