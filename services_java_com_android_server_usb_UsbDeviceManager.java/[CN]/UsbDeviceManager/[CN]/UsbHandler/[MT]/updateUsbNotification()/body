{
  if (mNotificationManager == null || !mUseUsbNotification)   return;
  if (mConnected) {
    Resources r=mContext.getResources();
    CharSequence title=null;
    int id=NOTIFICATION_NONE;
    if (containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_MTP)) {
      title=r.getText(com.android.internal.R.string.usb_mtp_notification_title);
      id=NOTIFICATION_MTP;
    }
 else     if (containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_PTP)) {
      title=r.getText(com.android.internal.R.string.usb_ptp_notification_title);
      id=NOTIFICATION_PTP;
    }
 else     if (containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_MASS_STORAGE)) {
      title=r.getText(com.android.internal.R.string.usb_cd_installer_notification_title);
      id=NOTIFICATION_INSTALLER;
    }
 else     if (containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_ACCESSORY)) {
      title=r.getText(com.android.internal.R.string.usb_accessory_notification_title);
      id=NOTIFICATION_ACCESSORY;
    }
 else {
      Slog.e(TAG,"No known USB function in updateUsbNotification");
    }
    if (id != mUsbNotificationId) {
      if (mUsbNotificationId != NOTIFICATION_NONE) {
        mNotificationManager.cancel(mUsbNotificationId);
        mUsbNotificationId=NOTIFICATION_NONE;
      }
    }
    if (mUsbNotificationId == NOTIFICATION_NONE) {
      CharSequence message=r.getText(com.android.internal.R.string.usb_notification_message);
      Notification notification=new Notification();
      notification.icon=com.android.internal.R.drawable.stat_sys_data_usb;
      notification.when=0;
      notification.flags=Notification.FLAG_ONGOING_EVENT;
      notification.tickerText=title;
      notification.defaults=0;
      notification.sound=null;
      notification.vibrate=null;
      Intent intent=new Intent(Settings.ACTION_APPLICATION_DEVELOPMENT_SETTINGS);
      intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED);
      intent.setComponent(new ComponentName("com.android.settings","com.android.settings.UsbSettings"));
      PendingIntent pi=PendingIntent.getActivity(mContext,0,intent,0);
      notification.setLatestEventInfo(mContext,title,message,pi);
      mNotificationManager.notify(id,notification);
      mUsbNotificationId=id;
    }
  }
 else   if (mUsbNotificationId != NOTIFICATION_NONE) {
    mNotificationManager.cancel(mUsbNotificationId);
    mUsbNotificationId=NOTIFICATION_NONE;
  }
}
