{
  String function;
switch (msg.what) {
case MSG_UPDATE_STATE:
    mConnected=(msg.arg1 == 1);
  mConfigured=(msg.arg2 == 1);
updateAdbNotification(mAdbEnabled && mConnected);
if (containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_ACCESSORY)) {
updateCurrentAccessory();
}
if (!mConnected) {
setCurrentFunctions(mDefaultFunctions);
}
if (mSystemReady) {
updateUsbState();
}
break;
case MSG_ENABLE_ADB:
setAdbEnabled(msg.arg1 == 1);
break;
case MSG_SET_PRIMARY_FUNCTION:
function=(String)msg.obj;
if (function == null) {
function=mDefaultFunctions;
}
setEnabledFunctions(function);
break;
case MSG_SET_DEFAULT_FUNCTION:
function=(String)msg.obj;
if (mAdbEnabled) {
function=addFunction(function,UsbManager.USB_FUNCTION_ADB);
}
SystemProperties.set("persist.sys.usb.config",function);
mDefaultFunctions=function;
break;
case MSG_SYSTEM_READY:
updateAdbNotification(mAdbEnabled && mConnected);
updateUsbState();
if (mCurrentAccessory != null && mDeferAccessoryAttached) {
mSettingsManager.accessoryAttached(mCurrentAccessory);
}
break;
}
}
