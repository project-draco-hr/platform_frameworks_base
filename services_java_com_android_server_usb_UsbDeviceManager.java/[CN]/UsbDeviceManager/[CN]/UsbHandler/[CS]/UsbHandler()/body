{
  try {
    mCurrentFunctions=FileUtils.readTextFile(new File(FUNCTIONS_PATH),0,null).trim();
    mDefaultFunctions=mCurrentFunctions;
    String state=FileUtils.readTextFile(new File(STATE_PATH),0,null).trim();
    updateState(state);
    mAdbEnabled=containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_ADB);
    String value=SystemProperties.get("persist.service.adb.enable","");
    if (value.length() > 0) {
      char enable=value.charAt(0);
      if (enable == '1') {
        setAdbEnabled(true);
      }
 else       if (enable == '0') {
        setAdbEnabled(false);
      }
      SystemProperties.set("persist.service.adb.enable","");
    }
    mContentResolver.registerContentObserver(Settings.Secure.getUriFor(Settings.Secure.ADB_ENABLED),false,new AdbSettingsObserver());
    mUEventObserver.startObserving(USB_STATE_MATCH);
    mUEventObserver.startObserving(ACCESSORY_START_MATCH);
  }
 catch (  Exception e) {
    Slog.e(TAG,"Error initializing UsbHandler",e);
  }
}
