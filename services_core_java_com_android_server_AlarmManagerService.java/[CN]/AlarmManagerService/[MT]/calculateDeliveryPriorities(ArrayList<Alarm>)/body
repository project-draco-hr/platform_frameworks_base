{
  final int N=alarms.size();
  for (int i=0; i < N; i++) {
    Alarm a=alarms.get(i);
    final int alarmPrio;
    if (a.operation != null && Intent.ACTION_TIME_TICK.equals(a.operation.getIntent().getAction())) {
      alarmPrio=PRIO_TICK;
    }
 else     if (a.wakeup) {
      alarmPrio=PRIO_WAKEUP;
    }
 else {
      alarmPrio=PRIO_NORMAL;
    }
    PriorityClass packagePrio=a.priorityClass;
    String alarmPackage=(a.operation != null) ? a.operation.getCreatorPackage() : a.packageName;
    if (packagePrio == null)     packagePrio=mPriorities.get(alarmPackage);
    if (packagePrio == null) {
      packagePrio=a.priorityClass=new PriorityClass();
      mPriorities.put(alarmPackage,packagePrio);
    }
    a.priorityClass=packagePrio;
    if (packagePrio.seq != mCurrentSeq) {
      packagePrio.priority=alarmPrio;
      packagePrio.seq=mCurrentSeq;
    }
 else {
      if (alarmPrio < packagePrio.priority) {
        packagePrio.priority=alarmPrio;
      }
    }
  }
}
