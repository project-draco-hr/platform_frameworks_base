{
  boolean didRemove=false;
  for (int i=mAlarmBatches.size() - 1; i >= 0; i--) {
    Batch b=mAlarmBatches.get(i);
    didRemove|=b.remove(operation,directReceiver);
    if (b.size() == 0) {
      mAlarmBatches.remove(i);
    }
  }
  for (int i=mPendingWhileIdleAlarms.size() - 1; i >= 0; i--) {
    if (mPendingWhileIdleAlarms.get(i).matches(operation,directReceiver)) {
      mPendingWhileIdleAlarms.remove(i);
    }
  }
  if (didRemove) {
    if (DEBUG_BATCH) {
      Slog.v(TAG,"remove(operation) changed bounds; rebatching");
    }
    boolean restorePending=false;
    if (mPendingIdleUntil != null && mPendingIdleUntil.matches(operation,directReceiver)) {
      mPendingIdleUntil=null;
      restorePending=true;
    }
    if (mNextWakeFromIdle != null && mNextWakeFromIdle.matches(operation,directReceiver)) {
      mNextWakeFromIdle=null;
    }
    rebatchAllAlarmsLocked(true);
    if (restorePending) {
      restorePendingWhileIdleAlarmsLocked();
    }
    updateNextAlarmClockLocked();
  }
}
