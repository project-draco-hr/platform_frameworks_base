{
  if (inflight != null) {
    updateStatsLocked(inflight);
  }
  mBroadcastRefCount--;
  if (mBroadcastRefCount == 0) {
    mWakeLock.release();
    if (mInFlight.size() > 0) {
      mLog.w("Finished all dispatches with " + mInFlight.size() + " remaining inflights");
      for (int i=0; i < mInFlight.size(); i++) {
        mLog.w("  Remaining #" + i + ": "+ mInFlight.get(i));
      }
      mInFlight.clear();
    }
  }
 else {
    if (mInFlight.size() > 0) {
      InFlight inFlight=mInFlight.get(0);
      setWakelockWorkSource(inFlight.mPendingIntent,inFlight.mWorkSource,inFlight.mAlarmType,inFlight.mTag,-1,false);
    }
 else {
      mLog.w("Alarm wakelock still held but sent queue empty");
      mWakeLock.setWorkSource(null);
    }
  }
}
