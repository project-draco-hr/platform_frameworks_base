{
  if (mVolumeType == MediaSession.PLAYBACK_TYPE_LOCAL) {
    mAudioManager.setStreamVolume(mAudioStream,value,flags);
  }
 else {
    if (mVolumeControlType != VolumeProvider.VOLUME_CONTROL_ABSOLUTE) {
      return;
    }
    value=Math.max(0,Math.min(value,mMaxVolume));
    mSessionCb.setVolumeTo(value);
    int volumeBefore=(mOptimisticVolume < 0 ? mCurrentVolume : mOptimisticVolume);
    mOptimisticVolume=Math.max(0,Math.min(value,mMaxVolume));
    mHandler.removeCallbacks(mClearOptimisticVolumeRunnable);
    mHandler.postDelayed(mClearOptimisticVolumeRunnable,OPTIMISTIC_VOLUME_TIMEOUT);
    if (volumeBefore != mOptimisticVolume) {
      pushVolumeUpdate();
    }
    if (DEBUG) {
      Log.d(TAG,"Set optimistic volume to " + mOptimisticVolume + " max is "+ mMaxVolume);
    }
  }
}
