{
  int index=mKeyToIndexMap.get(key,-1);
  if (index < 0) {
    index=findNextEmptyIndex();
    if (index >= 0) {
      try {
        mImpl.set(index,1);
        mKeyToIndexMap.append(key,index);
        if (DEBUG) {
          Slog.i(LOG_TAG,"Allocated index:" + index + " for key:"+ SettingsProvider.keyToString(key));
        }
      }
 catch (      IOException e) {
        Slog.e(LOG_TAG,"Cannot write to generation memory array",e);
      }
    }
 else {
      Slog.e(LOG_TAG,"Could not allocate generation index");
    }
  }
  return index;
}
