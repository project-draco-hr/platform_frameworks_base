{
  int scanTimeSum=0;
  int i;
  int averageScanTime=0;
  int ssidAppearInScanResultsCount=0;
  for (i=0; i < mScanIterations; i++) {
    log("testWifiScanning: iteration: " + i);
    writeOutput(String.format("scan iteration %d out of %d",i,mScanIterations));
    writeOutput(String.format("average scanning time is %d",averageScanTime));
    writeOutput(String.format("ssid appear %d out of %d scan iterations",ssidAppearInScanResultsCount,mScanIterations));
    long startTime=System.currentTimeMillis();
    mAct.scanResultAvailable=false;
    assertTrue("start scan failed",mAct.mWifiManager.startScanActive());
    while (true) {
      if ((System.currentTimeMillis() - startTime) > ConnectivityManagerTestActivity.WIFI_SCAN_TIMEOUT) {
        fail("Wifi scanning takes more than " + ConnectivityManagerTestActivity.WIFI_SCAN_TIMEOUT + " ms");
      }
synchronized (mAct) {
        try {
          mAct.wait(ConnectivityManagerTestActivity.WAIT_FOR_SCAN_RESULT);
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
        if (mAct.scanResultAvailable) {
          long scanTime=(System.currentTimeMillis() - startTime);
          scanTimeSum+=scanTime;
          averageScanTime=scanTimeSum / mScanIterations;
          log("average scanning time: " + averageScanTime);
          break;
        }
      }
    }
    if ((mAct.mWifiManager.getScanResults() == null) || (mAct.mWifiManager.getScanResults().size() <= 0)) {
      fail("Scan results are empty ");
    }
    List<ScanResult> netList=mAct.mWifiManager.getScanResults();
    if (netList != null) {
      log("size of scan result list: " + netList.size());
      for (int s=0; s < netList.size(); s++) {
        ScanResult sr=netList.get(s);
        log(String.format("scan result for %s is: %s",sr.SSID,sr.toString()));
        log(String.format("signal level for %s is %d ",sr.SSID,sr.level));
        if (sr.SSID.equals(mSsid)) {
          ssidAppearInScanResultsCount+=1;
          log("Number of times " + mSsid + " appear in the scan list: "+ ssidAppearInScanResultsCount);
          break;
        }
      }
    }
  }
  if (i == mScanIterations) {
    writeOutput(String.format("scan iteration %d out of %d",i,mScanIterations));
    writeOutput(String.format("average scanning time is %d",averageScanTime));
    writeOutput(String.format("ssid appear %d out of %d scan iterations",ssidAppearInScanResultsCount,mScanIterations));
  }
}
