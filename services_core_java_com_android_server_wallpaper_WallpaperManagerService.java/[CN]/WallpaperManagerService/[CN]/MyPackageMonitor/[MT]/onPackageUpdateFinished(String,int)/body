{
synchronized (mLock) {
    if (mCurrentUserId != getChangingUserId()) {
      return;
    }
    WallpaperData wallpaper=mWallpaperMap.get(mCurrentUserId);
    if (wallpaper != null) {
      if (wallpaper.wallpaperComponent != null && wallpaper.wallpaperComponent.getPackageName().equals(packageName)) {
        wallpaper.wallpaperUpdating=false;
        ComponentName comp=wallpaper.wallpaperComponent;
        clearWallpaperComponentLocked(wallpaper);
        if (!bindWallpaperComponentLocked(comp,false,false,wallpaper,null)) {
          Slog.w(TAG,"Wallpaper no longer available; reverting to default");
          clearWallpaperLocked(false,FLAG_SET_SYSTEM,wallpaper.userId,null);
        }
      }
    }
  }
}
