{
synchronized (mLock) {
    mService=null;
    mEngine=null;
    if (mWallpaper.connection == this) {
      Slog.w(TAG,"Wallpaper service gone: " + mWallpaper.wallpaperComponent);
      if (!mWallpaper.wallpaperUpdating && mWallpaper.userId == mCurrentUserId) {
        if (mWallpaper.lastDiedTime != 0 && mWallpaper.lastDiedTime + MIN_WALLPAPER_CRASH_TIME > SystemClock.uptimeMillis()) {
          Slog.w(TAG,"Reverting to built-in wallpaper!");
          clearWallpaperLocked(true,FLAG_SYSTEM,mWallpaper.userId,null);
        }
 else {
          mWallpaper.lastDiedTime=SystemClock.uptimeMillis();
        }
        final String flattened=name.flattenToString();
        EventLog.writeEvent(EventLogTags.WP_WALLPAPER_CRASHED,flattened.substring(0,Math.min(flattened.length(),MAX_WALLPAPER_COMPONENT_LOG_LENGTH)));
      }
    }
  }
}
