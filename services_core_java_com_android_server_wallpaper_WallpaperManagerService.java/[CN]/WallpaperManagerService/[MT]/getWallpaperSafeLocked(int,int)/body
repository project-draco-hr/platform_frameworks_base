{
  final SparseArray<WallpaperData> whichSet=(which == FLAG_LOCK) ? mLockWallpaperMap : mWallpaperMap;
  WallpaperData wallpaper=whichSet.get(userId);
  if (wallpaper == null) {
    loadSettingsLocked(userId,false);
    wallpaper=whichSet.get(userId);
    if (wallpaper == null) {
      if (which == FLAG_LOCK) {
        wallpaper=new WallpaperData(userId,WALLPAPER_LOCK_ORIG,WALLPAPER_LOCK_CROP);
        mLockWallpaperMap.put(userId,wallpaper);
        ensureSaneWallpaperData(wallpaper);
      }
 else {
        Slog.wtf(TAG,"Didn't find wallpaper in non-lock case!");
        wallpaper=new WallpaperData(userId,WALLPAPER,WALLPAPER_CROP);
        mWallpaperMap.put(userId,wallpaper);
        ensureSaneWallpaperData(wallpaper);
      }
    }
  }
  return wallpaper;
}
