{
synchronized (mLock) {
    int callingUid=Binder.getCallingUid();
    int wallpaperUserId=0;
    if (callingUid == android.os.Process.SYSTEM_UID) {
      wallpaperUserId=mCurrentUserId;
    }
 else {
      wallpaperUserId=UserHandle.getUserId(callingUid);
    }
    WallpaperData wallpaper=mWallpaperMap.get(wallpaperUserId);
    if (wallpaper == null) {
      return null;
    }
    try {
      if (outParams != null) {
        outParams.putInt("width",wallpaper.width);
        outParams.putInt("height",wallpaper.height);
      }
      wallpaper.callbacks.register(cb);
      File f=new File(getWallpaperDir(wallpaperUserId),WALLPAPER);
      if (!f.exists()) {
        return null;
      }
      return ParcelFileDescriptor.open(f,MODE_READ_ONLY);
    }
 catch (    FileNotFoundException e) {
      Slog.w(TAG,"Error getting wallpaper",e);
    }
    return null;
  }
}
