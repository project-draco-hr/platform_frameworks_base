{
  if (name == null)   name="";
  try {
    File dir=getWallpaperDir(wallpaper.userId);
    if (!dir.exists()) {
      dir.mkdir();
      FileUtils.setPermissions(dir.getPath(),FileUtils.S_IRWXU | FileUtils.S_IRWXG | FileUtils.S_IXOTH,-1,-1);
    }
    File file=new File(dir,WALLPAPER);
    ParcelFileDescriptor fd=ParcelFileDescriptor.open(file,MODE_CREATE | MODE_READ_WRITE | MODE_TRUNCATE);
    if (!SELinux.restorecon(file)) {
      return null;
    }
    wallpaper.name=name;
    return fd;
  }
 catch (  FileNotFoundException e) {
    Slog.w(TAG,"Error setting wallpaper",e);
  }
  return null;
}
