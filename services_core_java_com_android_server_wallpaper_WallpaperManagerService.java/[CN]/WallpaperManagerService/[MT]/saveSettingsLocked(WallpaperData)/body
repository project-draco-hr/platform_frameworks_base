{
  JournaledFile journal=makeJournaledFile(wallpaper.userId);
  FileOutputStream stream=null;
  try {
    stream=new FileOutputStream(journal.chooseForWrite(),false);
    XmlSerializer out=new FastXmlSerializer();
    out.setOutput(stream,"utf-8");
    out.startDocument(null,true);
    out.startTag(null,"wp");
    out.attribute(null,"width",Integer.toString(wallpaper.width));
    out.attribute(null,"height",Integer.toString(wallpaper.height));
    out.attribute(null,"name",wallpaper.name);
    if (wallpaper.wallpaperComponent != null && !wallpaper.wallpaperComponent.equals(mImageWallpaper)) {
      out.attribute(null,"component",wallpaper.wallpaperComponent.flattenToShortString());
    }
    out.endTag(null,"wp");
    out.endDocument();
    stream.close();
    journal.commit();
  }
 catch (  IOException e) {
    try {
      if (stream != null) {
        stream.close();
      }
    }
 catch (    IOException ex) {
    }
    journal.rollback();
  }
}
