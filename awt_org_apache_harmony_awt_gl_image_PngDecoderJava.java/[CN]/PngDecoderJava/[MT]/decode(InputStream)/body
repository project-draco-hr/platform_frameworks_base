{
  DataInputStream dataIn=new DataInputStream(in);
  readSignature(dataIn);
  PNGData chunks=readChunks(dataIn);
  long widthLong=chunks.getWidth();
  long heightLong=chunks.getHeight();
  if (widthLong > Integer.MAX_VALUE || heightLong > Integer.MAX_VALUE)   throw new IOException("That image is too wide or tall.");
  int width=(int)widthLong;
  int height=(int)heightLong;
  ColorModel cm=chunks.getColorModel();
  WritableRaster raster=chunks.getRaster();
  BufferedImage image=new BufferedImage(cm,raster,false,null);
  return image;
}
