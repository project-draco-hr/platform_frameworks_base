{
  final int magic=in.readInt();
  if (magic != FILE_MAGIC) {
    throw new ProtocolException("unexpected magic: " + magic);
  }
  final int version=in.readInt();
switch (version) {
case VERSION_UNIFIED_INIT:
{
      final int identSize=in.readInt();
      for (int i=0; i < identSize; i++) {
        final NetworkIdentitySet ident=new NetworkIdentitySet(in);
        final int size=in.readInt();
        for (int j=0; j < size; j++) {
          final int uid=in.readInt();
          final int set=in.readInt();
          final int tag=in.readInt();
          final Key key=new Key(ident,uid,set,tag);
          final NetworkStatsHistory history=new NetworkStatsHistory(in);
          recordHistory(key,history);
        }
      }
      break;
    }
default :
{
    throw new ProtocolException("unexpected version: " + version);
  }
}
}
