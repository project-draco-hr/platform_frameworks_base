{
  final ArrayMap<Key,NetworkStatsHistory> grouped=new ArrayMap<>();
  for (int i=0; i < mStats.size(); i++) {
    final Key key=mStats.keyAt(i);
    final NetworkStatsHistory value=mStats.valueAt(i);
    if (!templateMatches(groupTemplate,key.ident))     continue;
    final Key groupKey=new Key(null,key.uid,key.set,key.tag);
    NetworkStatsHistory groupHistory=grouped.get(groupKey);
    if (groupHistory == null) {
      groupHistory=new NetworkStatsHistory(value.getBucketDuration());
      grouped.put(groupKey,groupHistory);
    }
    groupHistory.recordHistory(value,start,end);
  }
  for (int i=0; i < grouped.size(); i++) {
    final Key key=grouped.keyAt(i);
    final NetworkStatsHistory value=grouped.valueAt(i);
    if (value.size() == 0)     continue;
    pw.print("c,");
    pw.print(groupPrefix);
    pw.print(',');
    pw.print(key.uid);
    pw.print(',');
    pw.print(NetworkStats.setToCheckinString(key.set));
    pw.print(',');
    pw.print(key.tag);
    pw.println();
    value.dumpCheckin(pw);
  }
}
