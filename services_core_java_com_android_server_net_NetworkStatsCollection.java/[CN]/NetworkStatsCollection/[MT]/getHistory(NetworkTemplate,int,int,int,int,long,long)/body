{
  final NetworkStatsHistory combined=new NetworkStatsHistory(mBucketDuration,estimateBuckets(),fields);
  for (int i=0; i < mStats.size(); i++) {
    final Key key=mStats.keyAt(i);
    final boolean setMatches=set == SET_ALL || key.set == set;
    if (key.uid == uid && setMatches && key.tag == tag && templateMatches(template,key.ident)) {
      final NetworkStatsHistory value=mStats.valueAt(i);
      combined.recordHistory(value,start,end);
    }
  }
  return combined;
}
