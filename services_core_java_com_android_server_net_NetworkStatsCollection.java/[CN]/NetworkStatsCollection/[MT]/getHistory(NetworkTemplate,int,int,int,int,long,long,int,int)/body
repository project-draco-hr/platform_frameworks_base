{
  if (!NetworkStatsAccess.isAccessibleToUser(uid,callerUid,accessLevel)) {
    throw new SecurityException("Network stats history of uid " + uid + " is forbidden for caller "+ callerUid);
  }
  final NetworkStatsHistory combined=new NetworkStatsHistory(mBucketDuration,start == end ? 1 : estimateBuckets(),fields);
  if (start == end)   return combined;
  for (int i=0; i < mStats.size(); i++) {
    final Key key=mStats.keyAt(i);
    if (key.uid == uid && NetworkStats.setMatches(set,key.set) && key.tag == tag && templateMatches(template,key.ident)) {
      final NetworkStatsHistory value=mStats.valueAt(i);
      combined.recordHistory(value,start,end);
    }
  }
  return combined;
}
