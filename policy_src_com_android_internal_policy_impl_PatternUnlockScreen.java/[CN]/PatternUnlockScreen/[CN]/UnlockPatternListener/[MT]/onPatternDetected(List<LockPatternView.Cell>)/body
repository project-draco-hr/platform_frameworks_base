{
  if (mLockPatternUtils.checkPattern(pattern)) {
    mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Correct);
    mStatusView.setInstructions("");
    mStatusView.updateStatusLines(true);
    mCallback.keyguardDone(true);
    mCallback.reportSuccessfulUnlockAttempt();
    KeyStore.getInstance().password(LockPatternUtils.patternToString(pattern));
  }
 else {
    boolean reportFailedAttempt=false;
    if (pattern.size() > MIN_PATTERN_BEFORE_POKE_WAKELOCK) {
      mCallback.pokeWakelock(UNLOCK_PATTERN_WAKE_INTERVAL_MS);
    }
    mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Wrong);
    if (pattern.size() >= LockPatternUtils.MIN_PATTERN_REGISTER_FAIL) {
      mTotalFailedPatternAttempts++;
      mFailedPatternAttemptsSinceLastTimeout++;
      reportFailedAttempt=true;
    }
    if (mFailedPatternAttemptsSinceLastTimeout >= LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT) {
      long deadline=mLockPatternUtils.setLockoutAttemptDeadline();
      handleAttemptLockout(deadline);
    }
 else {
      mStatusView.setInstructions(getContext().getString(R.string.lockscreen_pattern_wrong));
      mStatusView.updateStatusLines(true);
      mLockPatternView.postDelayed(mCancelPatternRunnable,PATTERN_CLEAR_TIMEOUT_MS);
    }
    if (reportFailedAttempt) {
      mCallback.reportFailedUnlockAttempt();
    }
  }
}
