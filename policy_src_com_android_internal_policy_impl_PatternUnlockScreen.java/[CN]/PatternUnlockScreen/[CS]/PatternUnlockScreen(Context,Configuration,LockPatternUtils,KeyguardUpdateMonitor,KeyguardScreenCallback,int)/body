{
  super(context);
  mLockPatternUtils=lockPatternUtils;
  mUpdateMonitor=updateMonitor;
  mCallback=callback;
  mTotalFailedPatternAttempts=totalFailedAttempts;
  mFailedPatternAttemptsSinceLastTimeout=totalFailedAttempts % LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT;
  if (DEBUG)   Log.d(TAG,"UnlockScreen() ctor: totalFailedAttempts=" + totalFailedAttempts + ", mFailedPat...="+ mFailedPatternAttemptsSinceLastTimeout);
  mCreationOrientation=configuration.orientation;
  LayoutInflater inflater=LayoutInflater.from(context);
  if (mCreationOrientation != Configuration.ORIENTATION_LANDSCAPE) {
    Log.d(TAG,"portrait mode");
    inflater.inflate(R.layout.keyguard_screen_unlock_portrait,this,true);
  }
 else {
    Log.d(TAG,"landscape mode");
    inflater.inflate(R.layout.keyguard_screen_unlock_landscape,this,true);
  }
  mStatusView=new StatusView(this,mUpdateMonitor,mLockPatternUtils);
  mLockPatternView=(LockPatternView)findViewById(R.id.lockPattern);
  mFooterNormal=(ViewGroup)findViewById(R.id.footerNormal);
  mFooterForgotPattern=(ViewGroup)findViewById(R.id.footerForgotPattern);
  final OnClickListener emergencyClick=new OnClickListener(){
    public void onClick(    View v){
      mCallback.takeEmergencyCallAction();
    }
  }
;
  mEmergencyAlone=(Button)findViewById(R.id.emergencyCallAlone);
  mEmergencyAlone.setFocusable(false);
  mEmergencyAlone.setOnClickListener(emergencyClick);
  mEmergencyTogether=(Button)findViewById(R.id.emergencyCallTogether);
  mEmergencyTogether.setFocusable(false);
  mEmergencyTogether.setOnClickListener(emergencyClick);
  refreshEmergencyButtonText();
  mForgotPatternButton=(Button)findViewById(R.id.forgotPattern);
  mForgotPatternButton.setText(R.string.lockscreen_forgot_pattern_button_text);
  mForgotPatternButton.setOnClickListener(new OnClickListener(){
    public void onClick(    View v){
      mCallback.forgotPattern(true);
    }
  }
);
  setDefaultTouchRecepient(mLockPatternView);
  mLockPatternView.setSaveEnabled(false);
  mLockPatternView.setFocusable(false);
  mLockPatternView.setOnPatternListener(new UnlockPatternListener());
  mLockPatternView.setInStealthMode(!mLockPatternUtils.isVisiblePatternEnabled());
  mLockPatternView.setTactileFeedbackEnabled(mLockPatternUtils.isTactileFeedbackEnabled());
  updateFooter(FooterMode.Normal);
  updateMonitor.registerInfoCallback(this);
  updateMonitor.registerSimStateCallback(this);
  setFocusableInTouchMode(true);
  mStatusView.setCarrierText(LockScreen.getCarrierString(mUpdateMonitor.getTelephonyPlmn(),mUpdateMonitor.getTelephonySpn()));
}
