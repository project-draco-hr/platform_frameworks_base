{
  for (int i=0; i < 100; i++) {
    if (mLooper.isIdle()) {
      return;
    }
    mLooper.dispatchAll();
  }
  throw new RuntimeException("Failed to clear message loop.");
}
