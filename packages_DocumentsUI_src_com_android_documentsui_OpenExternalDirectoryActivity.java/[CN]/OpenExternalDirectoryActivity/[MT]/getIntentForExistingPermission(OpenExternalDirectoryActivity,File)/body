{
  final String packageName=activity.getCallingPackage();
  final Uri grantedUri=getGrantedUriPermission(activity.getExternalStorageClient(),file);
  if (DEBUG)   Log.d(TAG,"checking if " + packageName + " already has permission for "+ grantedUri);
  final ActivityManager am=(ActivityManager)activity.getSystemService(Context.ACTIVITY_SERVICE);
  for (  UriPermission uriPermission : am.getGrantedUriPermissions(packageName).getList()) {
    final Uri uri=uriPermission.getUri();
    if (uri.equals(grantedUri)) {
      if (DEBUG)       Log.d(TAG,packageName + " already has permission: " + uriPermission);
      return createGrantedUriPermissionsIntent(uri);
    }
  }
  if (DEBUG)   Log.d(TAG,packageName + " does not have permission for " + grantedUri);
  return null;
}
