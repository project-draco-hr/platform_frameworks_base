{
  BugreportPrefs.setWarningState(mContext,BugreportPrefs.STATE_SHOW);
  createTextFile(PLAIN_TEXT_PATH,BUGREPORT_CONTENT);
  Intent intent=new Intent(INTENT_BUGREPORT_FINISHED);
  intent.putExtra(EXTRA_BUGREPORT,PLAIN_TEXT_PATH);
  mContext.sendBroadcast(intent);
  mUiBot.clickOnNotification(mContext.getString(R.string.bugreport_finished_title));
  mUiBot.getVisibleObject(mContext.getString(R.string.bugreport_confirm));
  UiObject showMessageAgain=mUiBot.getVisibleObject(mContext.getString(R.string.bugreport_confirm_repeat));
  mUiBot.click(showMessageAgain,"show-message-again");
  UiObject ok=mUiBot.getVisibleObject(mContext.getString(com.android.internal.R.string.ok));
  mUiBot.click(ok,"ok");
  mUiBot.chooseActivity(UI_NAME);
  Bundle extras=mListener.getExtras();
  assertActionSendMultiple(extras,BUGREPORT_CONTENT,null);
  int newState=BugreportPrefs.getWarningState(mContext,BugreportPrefs.STATE_UNKNOWN);
  assertEquals("Didn't change state",BugreportPrefs.STATE_HIDE,newState);
}
