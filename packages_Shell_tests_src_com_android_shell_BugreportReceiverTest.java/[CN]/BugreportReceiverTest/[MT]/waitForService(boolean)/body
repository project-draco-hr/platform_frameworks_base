{
  String service=BugreportProgressService.class.getName();
  boolean actualRunning;
  for (int i=1; i <= 5; i++) {
    actualRunning=isServiceRunning(service);
    Log.d(TAG,"Attempt " + i + " to check status of service '"+ service+ "': expected="+ expectRunning+ ", actual= "+ actualRunning);
    if (actualRunning == expectRunning) {
      return;
    }
    try {
      Thread.sleep(DateUtils.SECOND_IN_MILLIS);
    }
 catch (    InterruptedException e) {
      Log.w(TAG,"thread interrupted");
      Thread.currentThread().interrupt();
    }
  }
  if (!expectRunning) {
    Log.w(TAG,"Service didn't stop; try to kill it again");
    killService();
    return;
  }
  fail("Service status didn't change to " + expectRunning);
}
