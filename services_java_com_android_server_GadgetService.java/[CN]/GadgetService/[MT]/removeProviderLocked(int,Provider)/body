{
  int N=p.instances.size();
  for (int i=0; i < N; i++) {
    GadgetId id=p.instances.get(i);
    updateGadgetInstanceLocked(id,null);
    cancelBroadcasts(p);
    id.host.instances.remove(id);
    mGadgetIds.remove(id);
    id.provider=null;
    pruneHostLocked(id.host);
    id.host=null;
  }
  p.instances.clear();
  mInstalledProviders.remove(index);
  cancelBroadcasts(p);
}
