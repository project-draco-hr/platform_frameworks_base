{
  int callingUid=enforceCallingUid(packageName);
synchronized (mGadgetIds) {
    Host host=lookupOrAddHostLocked(callingUid,packageName,hostId);
    host.callbacks=callbacks;
    updatedViews.clear();
    ArrayList<GadgetId> instances=host.instances;
    int N=instances.size();
    int[] updatedIds=new int[N];
    for (int i=0; i < N; i++) {
      GadgetId id=instances.get(i);
      updatedIds[i]=id.gadgetId;
      updatedViews.add(id.views);
    }
    return updatedIds;
  }
}
