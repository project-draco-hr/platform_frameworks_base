{
  mContext.enforceCallingPermission(android.Manifest.permission.BIND_GADGET,"bindGagetId gadgetId=" + gadgetId + " provider="+ provider);
synchronized (mGadgetIds) {
    GadgetId id=lookupGadgetIdLocked(gadgetId);
    if (id == null) {
      throw new IllegalArgumentException("bad gadgetId");
    }
    if (id.provider != null) {
      throw new IllegalArgumentException("gadgetId " + gadgetId + " already bound to "+ id.provider.info.provider);
    }
    Provider p=lookupProviderLocked(provider);
    if (p == null) {
      throw new IllegalArgumentException("not a gadget provider: " + provider);
    }
    if (p.zombie) {
      throw new IllegalArgumentException("can't bind to a 3rd party provider in" + " safe mode: " + provider);
    }
    id.provider=p;
    p.instances.add(id);
    int instancesSize=p.instances.size();
    if (instancesSize == 1) {
      sendEnableIntentLocked(p);
    }
    sendUpdateIntentLocked(p,new int[]{gadgetId});
    registerForBroadcastsLocked(p,getGadgetIds(p));
    saveStateLocked();
  }
}
