{
  int callingUid=enforceCallingUid(packageName);
synchronized (mGadgetIds) {
    int gadgetId=mNextGadgetId++;
    Host host=lookupOrAddHostLocked(callingUid,packageName,hostId);
    GadgetId id=new GadgetId();
    id.gadgetId=gadgetId;
    id.host=host;
    host.instances.add(id);
    mGadgetIds.add(id);
    saveStateLocked();
    return gadgetId;
  }
}
