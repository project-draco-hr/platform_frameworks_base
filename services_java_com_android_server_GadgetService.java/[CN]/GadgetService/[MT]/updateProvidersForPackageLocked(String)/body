{
  HashSet<String> keep=new HashSet();
  Intent intent=new Intent(GadgetManager.GADGET_UPDATE_ACTION);
  List<ResolveInfo> broadcastReceivers=mPackageManager.queryBroadcastReceivers(intent,PackageManager.GET_META_DATA);
  int N=broadcastReceivers.size();
  for (int i=0; i < N; i++) {
    ResolveInfo ri=broadcastReceivers.get(i);
    ActivityInfo ai=ri.activityInfo;
    if (pkgName.equals(ai.packageName)) {
      Provider p=lookupProviderLocked(new ComponentName(ai.packageName,ai.name));
      if (p == null) {
        addProviderLocked(ri);
      }
      keep.add(ai.name);
    }
  }
  N=mInstalledProviders.size();
  for (int i=0; i < N; i++) {
    Provider p=mInstalledProviders.get(i);
    if (pkgName.equals(p.info.provider.getPackageName()) && !keep.contains(p.info.provider.getClassName())) {
      removeProviderLocked(i,p);
    }
  }
}
