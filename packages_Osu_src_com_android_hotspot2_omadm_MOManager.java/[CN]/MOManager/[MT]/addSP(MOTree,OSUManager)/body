{
  List<HomeSP> spList=buildSPs(instanceTree);
  if (spList.size() != 1) {
    throw new OMAException("Expected exactly one HomeSP, got " + spList.size());
  }
  HomeSP sp=spList.iterator().next();
  String fqdn=sp.getFQDN();
  if (mSPs.put(fqdn,sp) != null) {
    throw new OMAException("SP " + fqdn + " already exists");
  }
  OMAConstructed pps=(OMAConstructed)instanceTree.getRoot().getChild(TAG_PerProviderSubscription);
  try {
    addSP(pps,osuManager);
  }
 catch (  FileNotFoundException fnfe) {
    MOTree tree=new MOTree(instanceTree.getUrn(),instanceTree.getDtdRev(),instanceTree.getRoot());
    writeMO(tree,mPpsFile,osuManager);
  }
  return sp;
}
