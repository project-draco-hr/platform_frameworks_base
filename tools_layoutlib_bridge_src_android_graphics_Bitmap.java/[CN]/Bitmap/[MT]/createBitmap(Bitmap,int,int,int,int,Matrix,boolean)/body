{
  checkXYSign(x,y);
  checkWidthHeight(width,height);
  if (x + width > source.getWidth()) {
    throw new IllegalArgumentException("x + width must be <= bitmap.width()");
  }
  if (y + height > source.getHeight()) {
    throw new IllegalArgumentException("y + height must be <= bitmap.height()");
  }
  if (!source.isMutable() && x == 0 && y == 0 && width == source.getWidth() && height == source.getHeight() && (m == null || m.isIdentity())) {
    return source;
  }
  if (m == null || m.isIdentity()) {
    return new Bitmap(source.mImage.getSubimage(x,y,width,height));
  }
  int neww=width;
  int newh=height;
  Paint paint;
  Rect srcR=new Rect(x,y,x + width,y + height);
  RectF dstR=new RectF(0,0,width,height);
  boolean hasAlpha=source.hasAlpha() || !m.rectStaysRect();
  RectF deviceR=new RectF();
  m.mapRect(deviceR,dstR);
  neww=Math.round(deviceR.width());
  newh=Math.round(deviceR.height());
  BridgeCanvas canvas=new BridgeCanvas(neww,newh);
  canvas.translate(-deviceR.left,-deviceR.top);
  canvas.concat(m);
  paint=new Paint();
  paint.setFilterBitmap(filter);
  if (!m.rectStaysRect()) {
    paint.setAntiAlias(true);
  }
  canvas.drawBitmap(source,srcR,dstR,paint);
  return new Bitmap(canvas.getImage());
}
