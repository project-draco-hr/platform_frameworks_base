{
  final int N=mLayerState.mNum;
  final Rect bounds=getBounds();
  final ChildDrawable[] array=mLayerState.mChildren;
  final boolean maskOnly=mState.mMask != null && N == 1;
  int restoreToCount=drawRippleLayer(canvas,bounds,maskOnly);
  if (restoreToCount >= 0) {
    if (mState.mMask != null) {
      canvas.saveLayer(bounds.left,bounds.top,bounds.right,bounds.bottom,getMaskingPaint(DST_IN));
      mState.mMask.draw(canvas);
      canvas.restoreToCount(restoreToCount);
      restoreToCount=-1;
    }
    if (!maskOnly) {
      final PorterDuffXfermode xfermode=mState.getTintXfermodeInverse();
      final int count=canvas.saveLayer(bounds.left,bounds.top,bounds.right,bounds.bottom,getMaskingPaint(xfermode));
      if (restoreToCount < 0) {
        restoreToCount=count;
      }
    }
  }
  for (int i=0; i < N; i++) {
    if (array[i].mId != R.id.mask) {
      array[i].mDrawable.draw(canvas);
    }
  }
  if (restoreToCount >= 0) {
    canvas.restoreToCount(restoreToCount);
  }
}
