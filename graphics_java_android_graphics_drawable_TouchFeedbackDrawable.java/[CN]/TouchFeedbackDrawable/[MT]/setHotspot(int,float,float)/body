{
  if (mRipples == null) {
    mRipples=new SparseArray<Ripple>();
    mAnimatingRipples=new Ripple[MAX_RIPPLES];
  }
  if (mAnimatingRipplesCount >= MAX_RIPPLES) {
    Log.e(LOG_TAG,"Max ripple count exceeded",new RuntimeException());
    return;
  }
  final Ripple ripple=mRipples.get(id);
  if (ripple == null) {
    final Rect bounds=mHotspotBounds;
    if (mState.mPinned) {
      x=bounds.exactCenterX();
      y=bounds.exactCenterY();
    }
    final boolean pulse=(id != R.attr.state_focused);
    final Ripple newRipple=new Ripple(this,bounds,mDensity,pulse);
    newRipple.move(x,y);
    mAnimatingRipples[mAnimatingRipplesCount++]=newRipple;
    mRipples.put(id,newRipple);
  }
 else   if (mState.mPinned) {
    final Rect bounds=mHotspotBounds;
    x=bounds.exactCenterX();
    y=bounds.exactCenterY();
    ripple.move(x,y);
  }
 else {
    ripple.move(x,y);
  }
}
