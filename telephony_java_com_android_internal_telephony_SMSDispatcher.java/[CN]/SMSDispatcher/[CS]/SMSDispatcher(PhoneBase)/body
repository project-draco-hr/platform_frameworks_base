{
  mPhone=phone;
  mWapPush=new WapPushOverSms(phone,this);
  mContext=phone.getContext();
  mResolver=mContext.getContentResolver();
  mCm=phone.mCM;
  createWakelock();
  int check_period=Settings.Secure.getInt(mResolver,Settings.Secure.SMS_OUTGOING_CHECK_INTERVAL_MS,DEFAULT_SMS_CHECK_PERIOD);
  int max_count=Settings.Secure.getInt(mResolver,Settings.Secure.SMS_OUTGOING_CHECK_MAX_COUNT,DEFAULT_SMS_MAX_COUNT);
  mCounter=new SmsCounter(max_count,check_period);
  mCm.setOnNewSMS(this,EVENT_NEW_SMS,null);
  mCm.setOnSmsStatus(this,EVENT_NEW_SMS_STATUS_REPORT,null);
  mCm.setOnIccSmsFull(this,EVENT_ICC_FULL,null);
  mCm.registerForOn(this,EVENT_RADIO_ON,null);
  sConcatenatedRef=new Random().nextInt(256);
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_DEVICE_STORAGE_FULL);
  filter.addAction(Intent.ACTION_DEVICE_STORAGE_NOT_FULL);
  mContext.registerReceiver(mResultReceiver,filter);
  mSmsCapable=mContext.getResources().getBoolean(com.android.internal.R.bool.config_sms_capable);
}
