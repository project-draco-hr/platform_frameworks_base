{
  AsyncResult ar;
switch (msg.what) {
case EVENT_NEW_SMS:
    if (Config.LOGD) {
      Log.d(TAG,"New SMS Message Received");
    }
  SmsMessage sms;
ar=(AsyncResult)msg.obj;
if (ar.exception != null) {
Log.e(TAG,"Exception processing incoming SMS. Exception:" + ar.exception);
return;
}
sms=(SmsMessage)ar.result;
try {
if (mStorageAvailable) {
int result=dispatchMessage(sms.mWrappedSmsMessage);
if (result != Activity.RESULT_OK) {
boolean handled=(result == Intents.RESULT_SMS_HANDLED);
acknowledgeLastIncomingSms(handled,result,null);
}
}
 else {
acknowledgeLastIncomingSms(false,Intents.RESULT_SMS_OUT_OF_MEMORY,null);
}
}
 catch (RuntimeException ex) {
acknowledgeLastIncomingSms(false,Intents.RESULT_SMS_GENERIC_ERROR,null);
}
break;
case EVENT_SEND_SMS_COMPLETE:
handleSendComplete((AsyncResult)msg.obj);
break;
case EVENT_SEND_RETRY:
sendSms((SmsTracker)msg.obj);
break;
case EVENT_NEW_SMS_STATUS_REPORT:
handleStatusReport((AsyncResult)msg.obj);
break;
case EVENT_ICC_FULL:
handleIccFull();
break;
case EVENT_POST_ALERT:
handleReachSentLimit((SmsTracker)(msg.obj));
break;
case EVENT_ALERT_TIMEOUT:
((AlertDialog)(msg.obj)).dismiss();
msg.obj=null;
mSTracker=null;
break;
case EVENT_SEND_CONFIRMED_SMS:
if (mSTracker != null) {
if (isMultipartTracker(mSTracker)) {
sendMultipartSms(mSTracker);
}
 else {
sendSms(mSTracker);
}
mSTracker=null;
}
break;
}
}
