{
  if (mSpellCheckerSession == null)   return;
  Editable editable=(Editable)mTextView.getText();
  final int selectionStart=Selection.getSelectionStart(editable);
  final int selectionEnd=Selection.getSelectionEnd(editable);
  TextInfo[] textInfos=new TextInfo[mLength];
  int textInfosCount=0;
  for (int i=0; i < mLength; i++) {
    final SpellCheckSpan spellCheckSpan=mSpellCheckSpans[i];
    if (spellCheckSpan.isSpellCheckInProgress())     continue;
    final int start=editable.getSpanStart(spellCheckSpan);
    final int end=editable.getSpanEnd(spellCheckSpan);
    if (start >= 0 && end > start && (selectionEnd < start || selectionStart > end)) {
      final String word=(editable instanceof SpannableStringBuilder) ? ((SpannableStringBuilder)editable).substring(start,end) : editable.subSequence(start,end).toString();
      spellCheckSpan.setSpellCheckInProgress(true);
      textInfos[textInfosCount++]=new TextInfo(word,mCookie,mIds[i]);
      if (DBG) {
        Log.d(TAG,"create TextInfo: (" + i + "/"+ mLength+ ")"+ word+ ", cookie = "+ mCookie+ ", seq = "+ mIds[i]+ ", sel start = "+ selectionStart+ ", sel end = "+ selectionEnd+ ", start = "+ start+ ", end = "+ end);
      }
    }
  }
  if (textInfosCount > 0) {
    if (textInfosCount < textInfos.length) {
      TextInfo[] textInfosCopy=new TextInfo[textInfosCount];
      System.arraycopy(textInfos,0,textInfosCopy,0,textInfosCount);
      textInfos=textInfosCopy;
    }
    if (mIsSentenceSpellCheckSupported) {
      mSpellCheckerSession.getSentenceSuggestions(textInfos,SuggestionSpan.SUGGESTIONS_MAX_SIZE);
    }
 else {
      mSpellCheckerSession.getSuggestions(textInfos,SuggestionSpan.SUGGESTIONS_MAX_SIZE,false);
    }
  }
}
