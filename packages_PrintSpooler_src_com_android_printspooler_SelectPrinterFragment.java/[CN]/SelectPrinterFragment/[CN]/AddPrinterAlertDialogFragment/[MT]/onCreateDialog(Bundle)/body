{
  AlertDialog.Builder builder=new AlertDialog.Builder(getActivity()).setTitle(R.string.choose_print_service);
  final List<PrintServiceInfo> printServices=(List<PrintServiceInfo>)(List<?>)getArguments().getParcelableArrayList(FRAGMRNT_ARGUMENT_PRINT_SERVICE_INFOS);
  ArrayAdapter<String> adapter=new ArrayAdapter<String>(getActivity(),android.R.layout.simple_list_item_1);
  final int printServiceCount=printServices.size();
  for (int i=0; i < printServiceCount; i++) {
    PrintServiceInfo printService=printServices.get(i);
    adapter.add(printService.getResolveInfo().loadLabel(getActivity().getPackageManager()).toString());
  }
  builder.setAdapter(adapter,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      PrintServiceInfo printService=printServices.get(which);
      ComponentName componentName=new ComponentName(printService.getResolveInfo().serviceInfo.packageName,printService.getAddPrintersActivityName());
      Intent intent=new Intent(Intent.ACTION_MAIN);
      intent.setComponent(componentName);
      try {
        startActivity(intent);
      }
 catch (      ActivityNotFoundException anfe) {
        Log.w(LOG_TAG,"Couldn't start settings activity",anfe);
      }
    }
  }
);
  Uri marketUri=Uri.parse(DEFAULT_MARKET_QUERY_STRING);
  final Intent marketIntent=new Intent(Intent.ACTION_VIEW,marketUri);
  if (getActivity().getPackageManager().resolveActivity(marketIntent,0) != null) {
    builder.setPositiveButton(R.string.add_print_service_label,new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int whichButton){
        try {
          startActivity(marketIntent);
        }
 catch (        ActivityNotFoundException anfe) {
          Log.w(LOG_TAG,"Couldn't start add printer activity",anfe);
        }
      }
    }
);
  }
  return builder.create();
}
