{
  if (callingPackage == null) {
    return false;
  }
  AppOpsManager appOpsMgr=(AppOpsManager)context.getSystemService(Context.APP_OPS_SERVICE);
  int mode=AppOpsManager.MODE_DEFAULT;
  if (makeNote) {
    mode=appOpsMgr.noteOpNoThrow(appOpsOpCode,uid,callingPackage);
  }
 else {
    mode=appOpsMgr.checkOpNoThrow(appOpsOpCode,uid,callingPackage);
  }
switch (mode) {
case AppOpsManager.MODE_ALLOWED:
    return true;
case AppOpsManager.MODE_DEFAULT:
  if (!throwException) {
    return context.checkCallingOrSelfPermission(permissionName) == PackageManager.PERMISSION_GRANTED;
  }
default :
if (!throwException) {
  return false;
}
}
throw new SecurityException(callingPackage + " was not granted " + permissionName+ " permission");
}
