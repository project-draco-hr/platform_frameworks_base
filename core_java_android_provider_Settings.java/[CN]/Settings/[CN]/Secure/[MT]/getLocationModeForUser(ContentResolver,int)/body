{
synchronized (mLocationSettingsLock) {
    boolean gpsEnabled=Settings.Secure.isLocationProviderEnabledForUser(cr,LocationManager.GPS_PROVIDER,userId);
    boolean networkEnabled=Settings.Secure.isLocationProviderEnabledForUser(cr,LocationManager.NETWORK_PROVIDER,userId);
    if (gpsEnabled && networkEnabled) {
      return LOCATION_MODE_HIGH_ACCURACY;
    }
 else     if (gpsEnabled) {
      return LOCATION_MODE_SENSORS_ONLY;
    }
 else     if (networkEnabled) {
      return LOCATION_MODE_BATTERY_SAVING;
    }
 else {
      return LOCATION_MODE_OFF;
    }
  }
}
