{
synchronized (mLocationSettingsLock) {
    boolean gps=false;
    boolean network=false;
switch (mode) {
case LOCATION_MODE_PREVIOUS:
      return restoreLocationModeForUser(cr,userId);
case LOCATION_MODE_OFF:
    saveLocationModeForUser(cr,userId);
  break;
case LOCATION_MODE_SENSORS_ONLY:
gps=true;
break;
case LOCATION_MODE_BATTERY_SAVING:
network=true;
break;
case LOCATION_MODE_HIGH_ACCURACY:
gps=true;
network=true;
break;
default :
throw new IllegalArgumentException("Invalid location mode: " + mode);
}
boolean nlpSuccess=Settings.Secure.setLocationProviderEnabledForUser(cr,LocationManager.NETWORK_PROVIDER,network,userId);
boolean gpsSuccess=Settings.Secure.setLocationProviderEnabledForUser(cr,LocationManager.GPS_PROVIDER,gps,userId);
return gpsSuccess && nlpSuccess;
}
}
