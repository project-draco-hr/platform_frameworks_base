{
  mPaint=paint;
  mText=text;
  mStart=start;
  mLen=limit - start;
  mDir=dir;
  mDirections=directions;
  mHasTabs=hasTabs;
  mSpanned=null;
  mPreppedIndex=0;
  mPreppedLimit=0;
  boolean hasReplacement=false;
  if (text instanceof Spanned) {
    mSpanned=(Spanned)text;
    hasReplacement=mSpanned.getSpans(start,limit,ReplacementSpan.class).length > 0;
  }
  mCharsValid=hasReplacement || hasTabs || directions != Layout.DIRS_ALL_LEFT_TO_RIGHT;
  if (mCharsValid) {
    if (mChars == null || mChars.length < mLen) {
      mChars=new char[ArrayUtils.idealCharArraySize(mLen)];
    }
    TextUtils.getChars(text,start,limit,mChars,0);
  }
  mTabs=tabStops;
}
