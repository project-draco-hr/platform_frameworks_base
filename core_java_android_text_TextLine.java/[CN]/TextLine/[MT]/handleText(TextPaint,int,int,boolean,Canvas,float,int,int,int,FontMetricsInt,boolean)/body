{
  float ret=0;
  int runLen=limit - start;
  if (needWidth || (c != null && (wp.bgColor != 0 || runIsRtl))) {
    if (mCharsValid) {
      ret=wp.measureText(mChars,start,runLen);
    }
 else {
      ret=wp.measureText(mText,mStart + start,mStart + start + runLen);
    }
  }
  if (fmi != null) {
    wp.getFontMetricsInt(fmi);
  }
  if (c != null) {
    if (runIsRtl) {
      x-=ret;
    }
    if (wp.bgColor != 0) {
      int color=wp.getColor();
      Paint.Style s=wp.getStyle();
      wp.setColor(wp.bgColor);
      wp.setStyle(Paint.Style.FILL);
      c.drawRect(x,top,x + ret,bottom,wp);
      wp.setStyle(s);
      wp.setColor(color);
    }
    drawTextRun(c,wp,start,limit,runIsRtl,x,y + wp.baselineShift);
  }
  return runIsRtl ? -ret : ret;
}
