{
  boolean doesTestFail=false;
  for (int i=0; i < NUM_PLAYBACk_IN_EACH_LOOP; i++) {
    MediaRecorder mRecorder=new MediaRecorder();
    try {
      if (!videoOnly) {
        Log.v(TAG,"setAudioSource");
        mRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);
      }
      mRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA);
      mRecorder.setOutputFormat(outFormat);
      Log.v(TAG,"output format " + outFormat);
      mRecorder.setOutputFile(outFile);
      mRecorder.setVideoFrameRate(frameRate);
      mRecorder.setVideoSize(width,height);
      Log.v(TAG,"setEncoder");
      mRecorder.setVideoEncoder(videoFormat);
      if (!videoOnly) {
        mRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB);
      }
      mSurfaceHolder=MediaFrameworkTest.mSurfaceView.getHolder();
      mRecorder.setPreviewDisplay(mSurfaceHolder.getSurface());
      mRecorder.prepare();
      mRecorder.start();
      Thread.sleep(MEDIA_STRESS_WAIT_TIME);
      mRecorder.stop();
      mRecorder.release();
    }
 catch (    Exception e) {
      Log.v("record video failed ",e.toString());
      mRecorder.release();
      doesTestFail=true;
      break;
    }
  }
  return !doesTestFail;
}
