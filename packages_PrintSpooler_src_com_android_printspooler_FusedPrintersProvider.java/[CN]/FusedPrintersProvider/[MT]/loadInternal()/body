{
  if (mDiscoverySession == null) {
    PrintManager printManager=(PrintManager)getContext().getSystemService(Context.PRINT_SERVICE);
    mDiscoverySession=printManager.createPrinterDiscoverySession();
    mDiscoverySession.setOnPrintersChangeListener(new OnPrintersChangeListener(){
      @Override public void onPrintersChanged(){
        ArrayMap<PrinterId,PrinterInfo> printersMap=new ArrayMap<PrinterId,PrinterInfo>();
        List<PrinterInfo> printers=mDiscoverySession.getPrinters();
        final int printerCount=printers.size();
        for (int i=0; i < printerCount; i++) {
          PrinterInfo printer=printers.get(i);
          printersMap.put(printer.getId(),printer);
        }
        computeAndDeliverResult(printersMap);
      }
    }
);
    mPersistenceManager.readPrinterHistory();
  }
  if (mPersistenceManager.isReadHistoryCompleted() && !mDiscoverySession.isPrinterDiscoveryStarted()) {
    final int favoriteCount=mFavoritePrinters.size();
    List<PrinterId> printerIds=new ArrayList<PrinterId>(favoriteCount);
    for (int i=0; i < favoriteCount; i++) {
      printerIds.add(mFavoritePrinters.get(i).getId());
    }
    mDiscoverySession.startPrinterDisovery(printerIds);
  }
}
