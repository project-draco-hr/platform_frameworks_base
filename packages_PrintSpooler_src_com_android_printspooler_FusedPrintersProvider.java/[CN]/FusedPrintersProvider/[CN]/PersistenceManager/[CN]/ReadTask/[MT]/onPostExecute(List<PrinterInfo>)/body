{
  if (DEBUG) {
    Log.i(LOG_TAG,"read history completed " + FusedPrintersProvider.this.hashCode());
  }
  PrintManager printManager=(PrintManager)getContext().getSystemService(Context.PRINT_SERVICE);
  List<PrintServiceInfo> services=printManager.getInstalledPrintServices();
  Set<ComponentName> installedComponents=new ArraySet<ComponentName>();
  final int installedServiceCount=services.size();
  for (int i=0; i < installedServiceCount; i++) {
    ServiceInfo serviceInfo=services.get(i).getResolveInfo().serviceInfo;
    ComponentName componentName=new ComponentName(serviceInfo.packageName,serviceInfo.name);
    installedComponents.add(componentName);
  }
  final int printerCount=printers.size();
  for (int i=printerCount - 1; i >= 0; i--) {
    ComponentName printerServiceName=printers.get(i).getId().getServiceName();
    if (!installedComponents.contains(printerServiceName.getPackageName())) {
      printers.remove(i);
    }
  }
  mHistoricalPrinters=printers;
  mFavoritePrinters.clear();
  mFavoritePrinters.addAll(computeFavoritePrinters(mHistoricalPrinters));
  mReadHistoryInProgress=false;
  mReadHistoryCompleted=true;
  Map<PrinterId,PrinterInfo> discoveredPrinters=Collections.emptyMap();
  computeAndDeliverResult(discoveredPrinters);
  loadInternal();
  mReadTask=null;
}
