{
  long position=-1;
  if (mRenderer != null) {
    position=mRenderer.getSeekPosition();
  }
  int pbState;
  float rate=0;
  String errorMsg=null;
switch (newState) {
case Renderer.STATE_ENDED:
case Renderer.STATE_STOPPED:
    pbState=PlaybackState.STATE_STOPPED;
  break;
case Renderer.STATE_INIT:
case Renderer.STATE_PREPARING:
pbState=PlaybackState.STATE_BUFFERING;
break;
case Renderer.STATE_ERROR:
pbState=PlaybackState.STATE_ERROR;
break;
case Renderer.STATE_PAUSED:
pbState=PlaybackState.STATE_PAUSED;
break;
case Renderer.STATE_PLAYING:
pbState=PlaybackState.STATE_PLAYING;
rate=1;
break;
default :
pbState=PlaybackState.STATE_ERROR;
errorMsg="unknown state";
break;
}
PlaybackState.Builder bob=new PlaybackState.Builder(mPlaybackState);
bob.setState(pbState,position,rate,SystemClock.elapsedRealtime());
bob.setErrorMessage(errorMsg);
mPlaybackState=bob.build();
mSession.setPlaybackState(mPlaybackState);
if (mListener != null) {
mListener.onPlayStateChanged(mPlaybackState);
}
}
