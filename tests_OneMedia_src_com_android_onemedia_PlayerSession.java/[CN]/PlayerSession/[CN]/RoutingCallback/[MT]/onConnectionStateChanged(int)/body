{
  if (state == MediaRouter.CONNECTION_STATE_CONNECTING) {
    if (mRenderer != null) {
      mRenderer.onStop();
    }
    mRenderer=null;
    updateState(PlaybackState.STATE_CONNECTING);
    return;
  }
  MediaRouter.ConnectionInfo connection=mRouter.getConnection();
  if (connection != null) {
    MediaPlayerProtocol protocol=connection.getProtocolObject(MediaPlayerProtocol.class);
    if (protocol != null) {
      Log.d(TAG,"Connected to route using media player protocol");
      protocol.setCallback(new PlayerCallback(),null);
      mRenderer=new OneMRPRenderer(protocol);
      updateState(PlaybackState.STATE_NONE);
      return;
    }
  }
  mRenderer=new LocalRenderer(mContext,null);
  mRenderer.registerListener(mRenderListener);
  updateState(PlaybackState.STATE_NONE);
}
