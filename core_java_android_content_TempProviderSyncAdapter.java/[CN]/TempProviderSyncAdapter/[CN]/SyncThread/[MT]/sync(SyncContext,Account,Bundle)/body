{
  mIsCanceled=false;
  mProviderSyncStarted=false;
  mAdapterSyncStarted=false;
  String message=null;
  boolean syncForced=extras.getBoolean(ContentResolver.SYNC_EXTRAS_FORCE,false);
  try {
    mProvider.onSyncStart(syncContext,account);
    mProviderSyncStarted=true;
    onSyncStarting(syncContext,account,syncForced,mResult);
    if (mResult.hasError()) {
      message="SyncAdapter failed while trying to start sync";
      return;
    }
    mAdapterSyncStarted=true;
    if (mIsCanceled) {
      return;
    }
    final String syncTracingEnabledValue=SystemProperties.get(TAG + "Tracing");
    final boolean syncTracingEnabled=!TextUtils.isEmpty(syncTracingEnabledValue);
    try {
      if (syncTracingEnabled) {
        System.gc();
        System.gc();
        Debug.startMethodTracing("synctrace." + System.currentTimeMillis());
      }
      runSyncLoop(syncContext,account,extras);
    }
  finally {
      if (syncTracingEnabled)       Debug.stopMethodTracing();
    }
    onSyncEnding(syncContext,!mResult.hasError());
    mAdapterSyncStarted=false;
    mProvider.onSyncStop(syncContext,true);
    mProviderSyncStarted=false;
  }
  finally {
    if (mAdapterSyncStarted) {
      mAdapterSyncStarted=false;
      onSyncEnding(syncContext,false);
    }
    if (mProviderSyncStarted) {
      mProviderSyncStarted=false;
      mProvider.onSyncStop(syncContext,false);
    }
    if (!mIsCanceled) {
      if (message != null)       syncContext.setStatusText(message);
    }
  }
}
