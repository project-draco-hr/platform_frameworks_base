{
  if (dst == null) {
    dst=createCompatibleDestRaster(src);
  }
 else {
    if (src.getNumBands() != dst.getNumBands()) {
      throw new IllegalArgumentException(Messages.getString("awt.237"));
    }
    if (src.getWidth() != dst.getWidth()) {
      throw new IllegalArgumentException(Messages.getString("awt.28F"));
    }
    if (src.getHeight() != dst.getHeight()) {
      throw new IllegalArgumentException(Messages.getString("awt.290"));
    }
  }
  if (lut.getNumComponents() != 1 && lut.getNumComponents() != src.getNumBands()) {
    throw new IllegalArgumentException(Messages.getString("awt.238"));
  }
  if (slowFilter(src,dst,false) != 0) {
    throw new ImagingOpException(Messages.getString("awt.21F"));
  }
  return dst;
}
