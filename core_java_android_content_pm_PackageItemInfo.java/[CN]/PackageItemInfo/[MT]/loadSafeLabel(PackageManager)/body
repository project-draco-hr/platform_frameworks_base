{
  CharSequence label=loadLabel(pm);
  String labelStr=label.toString();
  final int labelLength=labelStr.length();
  int offset=0;
  while (offset < labelLength) {
    final int codePoint=labelStr.codePointAt(offset);
    final int type=Character.getType(codePoint);
    if (type == Character.LINE_SEPARATOR || type == Character.CONTROL || type == Character.PARAGRAPH_SEPARATOR) {
      labelStr=labelStr.substring(0,offset);
      break;
    }
    offset+=Character.charCount(codePoint);
  }
  if (labelStr.isEmpty()) {
    return labelStr;
  }
  TextPaint paint=new TextPaint();
  paint.setTextSize(42);
  return TextUtils.ellipsize(labelStr,paint,MAX_LABEL_SIZE_PX,TextUtils.TruncateAt.END);
}
