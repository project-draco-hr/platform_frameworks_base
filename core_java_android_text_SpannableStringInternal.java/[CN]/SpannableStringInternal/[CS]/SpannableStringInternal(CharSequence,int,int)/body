{
  if (start == 0 && end == source.length())   mText=source.toString();
 else   mText=source.toString().substring(start,end);
  int initial=ArrayUtils.idealIntArraySize(0);
  mSpans=new Object[initial];
  mSpanData=new int[initial * 3];
  if (source instanceof Spanned) {
    Spanned sp=(Spanned)source;
    Object[] spans=sp.getSpans(start,end,Object.class);
    for (int i=0; i < spans.length; i++) {
      int st=sp.getSpanStart(spans[i]);
      int en=sp.getSpanEnd(spans[i]);
      int fl=sp.getSpanFlags(spans[i]);
      if (st < start)       st=start;
      if (en > end)       en=end;
      setSpan(spans[i],st - start,en - start,fl);
    }
  }
}
