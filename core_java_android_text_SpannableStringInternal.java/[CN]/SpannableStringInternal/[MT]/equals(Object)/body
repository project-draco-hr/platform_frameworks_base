{
  if (o instanceof Spanned && toString().equals(o.toString())) {
    Spanned other=(Spanned)o;
    Object[] otherSpans=other.getSpans(0,other.length(),Object.class);
    if (mSpanCount == otherSpans.length) {
      for (int i=0; i < mSpanCount; ++i) {
        Object thisSpan=mSpans[i];
        Object otherSpan=otherSpans[i];
        if (thisSpan == this) {
          if (other != otherSpan || getSpanStart(thisSpan) != other.getSpanStart(otherSpan) || getSpanEnd(thisSpan) != other.getSpanEnd(otherSpan) || getSpanFlags(thisSpan) != other.getSpanFlags(otherSpan)) {
            return false;
          }
        }
 else         if (!thisSpan.equals(otherSpan) || getSpanStart(thisSpan) != other.getSpanStart(otherSpan) || getSpanEnd(thisSpan) != other.getSpanEnd(otherSpan) || getSpanFlags(thisSpan) != other.getSpanFlags(otherSpan)) {
          return false;
        }
      }
      return true;
    }
  }
  return false;
}
