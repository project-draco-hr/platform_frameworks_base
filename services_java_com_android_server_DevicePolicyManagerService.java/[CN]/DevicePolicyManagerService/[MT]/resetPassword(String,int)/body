{
  int quality;
synchronized (this) {
    getActiveAdminForCallerLocked(null,DeviceAdminInfo.USES_POLICY_RESET_PASSWORD);
    quality=getPasswordQuality(null);
    if (quality != DevicePolicyManager.PASSWORD_QUALITY_UNSPECIFIED) {
      int realQuality=LockPatternUtils.computePasswordQuality(password);
      if (realQuality < quality) {
        Slog.w(TAG,"resetPassword: password quality 0x" + Integer.toHexString(quality) + " does not meet required quality 0x"+ Integer.toHexString(quality));
        return false;
      }
      quality=realQuality;
    }
    int length=getPasswordMinimumLength(null);
    if (password.length() < length) {
      Slog.w(TAG,"resetPassword: password length " + password.length() + " does not meet required length "+ length);
      return false;
    }
  }
  int callingUid=Binder.getCallingUid();
  if (mPasswordOwner >= 0 && mPasswordOwner != callingUid) {
    Slog.w(TAG,"resetPassword: already set by another uid and not entered by user");
    return false;
  }
  long ident=Binder.clearCallingIdentity();
  try {
    LockPatternUtils utils=new LockPatternUtils(mContext);
    utils.saveLockPassword(password,quality);
synchronized (this) {
      int newOwner=(flags & DevicePolicyManager.RESET_PASSWORD_REQUIRE_ENTRY) != 0 ? callingUid : -1;
      if (mPasswordOwner != newOwner) {
        mPasswordOwner=newOwner;
        saveSettingsLocked();
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
  return true;
}
