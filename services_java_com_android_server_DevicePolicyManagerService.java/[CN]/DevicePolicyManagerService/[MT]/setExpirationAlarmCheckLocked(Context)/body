{
  final long expiration=getPasswordExpirationLocked(null);
  final long now=System.currentTimeMillis();
  final long timeToExpire=expiration - now;
  final long alarmTime;
  if (timeToExpire > 0L && timeToExpire < MS_PER_DAY) {
    alarmTime=now + timeToExpire;
  }
 else {
    alarmTime=now + MS_PER_DAY;
  }
  long token=Binder.clearCallingIdentity();
  try {
    AlarmManager am=(AlarmManager)context.getSystemService(Context.ALARM_SERVICE);
    PendingIntent pi=PendingIntent.getBroadcast(context,REQUEST_EXPIRE_PASSWORD,new Intent(ACTION_EXPIRED_PASSWORD_NOTIFICATION),PendingIntent.FLAG_ONE_SHOT | PendingIntent.FLAG_UPDATE_CURRENT);
    am.cancel(pi);
    am.set(AlarmManager.RTC,alarmTime,pi);
  }
  finally {
    Binder.restoreCallingIdentity(token);
  }
}
