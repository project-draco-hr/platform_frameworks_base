{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BIND_DEVICE_ADMIN,null);
  DeviceAdminInfo info=findAdmin(adminReceiver);
  if (info == null) {
    throw new IllegalArgumentException("Bad admin: " + adminReceiver);
  }
synchronized (this) {
    long ident=Binder.clearCallingIdentity();
    try {
      if (!refreshing && getActiveAdminUncheckedLocked(adminReceiver) != null) {
        throw new IllegalArgumentException("Admin is already added");
      }
      ActiveAdmin newAdmin=new ActiveAdmin(info);
      mAdminMap.put(adminReceiver,newAdmin);
      int replaceIndex=-1;
      if (refreshing) {
        final int N=mAdminList.size();
        for (int i=0; i < N; i++) {
          ActiveAdmin oldAdmin=mAdminList.get(i);
          if (oldAdmin.info.getComponent().equals(adminReceiver)) {
            replaceIndex=i;
            break;
          }
        }
      }
      if (replaceIndex == -1) {
        mAdminList.add(newAdmin);
      }
 else {
        mAdminList.set(replaceIndex,newAdmin);
      }
      saveSettingsLocked();
      sendAdminCommandLocked(newAdmin,DeviceAdminReceiver.ACTION_DEVICE_ADMIN_ENABLED);
    }
  finally {
      Binder.restoreCallingIdentity(ident);
    }
  }
}
