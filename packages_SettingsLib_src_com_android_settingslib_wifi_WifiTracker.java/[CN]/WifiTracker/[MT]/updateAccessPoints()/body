{
  ArrayList<AccessPoint> tmpSwp=mAccessPoints;
  mAccessPoints=mCachedAccessPoints;
  mCachedAccessPoints=tmpSwp;
  for (  AccessPoint accessPoint : mCachedAccessPoints) {
    accessPoint.clearConfig();
  }
  mAccessPoints.clear();
  Multimap<String,AccessPoint> apMap=new Multimap<String,AccessPoint>();
  final List<WifiConfiguration> configs=mWifiManager.getConfiguredNetworks();
  if (configs != null) {
    mSavedNetworksExist=configs.size() != 0;
    for (    WifiConfiguration config : configs) {
      if (config.selfAdded && config.numAssociation == 0) {
        continue;
      }
      AccessPoint accessPoint=getCachedOrCreate(config);
      if (mLastInfo != null && mLastNetworkInfo != null) {
        accessPoint.update(mLastInfo,mLastNetworkInfo);
      }
      if (mIncludeSaved) {
        mAccessPoints.add(accessPoint);
        apMap.put(accessPoint.getSsid(),accessPoint);
      }
 else {
        mCachedAccessPoints.add(accessPoint);
      }
    }
  }
  final List<ScanResult> results=mWifiManager.getScanResults();
  if (results != null) {
    for (    ScanResult result : results) {
      if (result.SSID == null || result.SSID.length() == 0 || result.capabilities.contains("[IBSS]")) {
        continue;
      }
      boolean found=false;
      for (      AccessPoint accessPoint : apMap.getAll(result.SSID)) {
        if (accessPoint.update(result)) {
          found=true;
          break;
        }
      }
      if (!found && mIncludeScans) {
        AccessPoint accessPoint=getCachedOrCreate(result);
        if (mLastInfo != null && mLastNetworkInfo != null) {
          accessPoint.update(mLastInfo,mLastNetworkInfo);
        }
        mAccessPoints.add(accessPoint);
        apMap.put(accessPoint.getSsid(),accessPoint);
      }
    }
  }
  Collections.sort(mAccessPoints);
  if (mListener != null) {
    mListener.onAccessPointsChanged();
  }
}
