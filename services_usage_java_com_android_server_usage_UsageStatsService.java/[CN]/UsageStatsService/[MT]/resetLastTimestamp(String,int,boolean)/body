{
synchronized (mLock) {
    final long timeNow=checkAndGetTimeLocked();
    final long lastTimestamp=timeNow - (idle ? mAppIdleDurationMillis : 0) - 5000;
    final UserUsageStatsService service=getUserDataAndInitializeIfNeededLocked(userId,timeNow);
    final long lastUsed=service.getLastPackageAccessTime(packageName);
    final boolean previouslyIdle=hasPassedIdleDuration(lastUsed);
    service.setLastTimestamp(packageName,lastTimestamp);
    if (previouslyIdle != idle) {
      mHandler.sendMessage(mHandler.obtainMessage(MSG_INFORM_LISTENERS,userId,idle ? 1 : 0,packageName));
    }
  }
}
