{
  final boolean deviceIdle=mPowerManager.isDeviceIdleMode();
  if (DEBUG)   Slog.i(TAG,"DeviceIdleMode changed to " + deviceIdle);
synchronized (mLock) {
    final long timeSinceLastParole=checkAndGetTimeLocked() - mLastAppIdleParoledTime;
    if (!deviceIdle && timeSinceLastParole >= mAppIdleParoleIntervalMillis) {
      if (DEBUG)       Slog.i(TAG,"Bringing idle apps out of inactive state due to deviceIdleMode=false");
      postNextParoleTimeout();
      setAppIdleParoled(true);
    }
 else     if (deviceIdle) {
      if (DEBUG)       Slog.i(TAG,"Device idle, back to prison");
      setAppIdleParoled(false);
    }
  }
}
