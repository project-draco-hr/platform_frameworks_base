{
  mAppOps=(AppOpsManager)getContext().getSystemService(Context.APP_OPS_SERVICE);
  mUserManager=(UserManager)getContext().getSystemService(Context.USER_SERVICE);
  mHandler=new H(BackgroundThread.get().getLooper());
  File systemDataDir=new File(Environment.getDataDirectory(),"system");
  mUsageStatsDir=new File(systemDataDir,"usagestats");
  mUsageStatsDir.mkdirs();
  if (!mUsageStatsDir.exists()) {
    throw new IllegalStateException("Usage stats directory does not exist: " + mUsageStatsDir.getAbsolutePath());
  }
  getContext().registerReceiver(new UserRemovedReceiver(),new IntentFilter(Intent.ACTION_USER_REMOVED));
synchronized (mLock) {
    cleanUpRemovedUsersLocked();
  }
  mRealTimeSnapshot=SystemClock.elapsedRealtime();
  mSystemTimeSnapshot=System.currentTimeMillis();
  mAppIdleDurationMillis=Settings.Secure.getLongForUser(getContext().getContentResolver(),Settings.Secure.APP_IDLE_DURATION,DEFAULT_APP_IDLE_THRESHOLD_MILLIS,UserHandle.USER_OWNER);
  publishLocalService(UsageStatsManagerInternal.class,new LocalService());
  publishBinderService(Context.USAGE_STATS_SERVICE,new BinderService());
}
