{
synchronized (mLock) {
    final long screenOnTime=getScreenOnTimeLocked();
    IndentingPrintWriter idpw=new IndentingPrintWriter(pw,"  ");
    ArraySet<String> argSet=new ArraySet<>();
    argSet.addAll(Arrays.asList(args));
    final int userCount=mUserState.size();
    for (int i=0; i < userCount; i++) {
      idpw.printPair("user",mUserState.keyAt(i));
      idpw.println();
      idpw.increaseIndent();
      if (argSet.contains("--checkin")) {
        mUserState.valueAt(i).checkin(idpw,screenOnTime);
      }
 else {
        mUserState.valueAt(i).dump(idpw,screenOnTime);
        idpw.println();
        if (args.length > 0 && "history".equals(args[0])) {
          mAppIdleHistory.dump(idpw,mUserState.keyAt(i));
        }
      }
      idpw.decreaseIndent();
    }
    pw.print("Screen On Timebase: ");
    pw.print(screenOnTime);
    pw.print(" (");
    TimeUtils.formatDuration(screenOnTime,pw);
    pw.println(")");
    pw.println();
    pw.println("Settings:");
    pw.print("  mAppIdleDurationMillis=");
    TimeUtils.formatDuration(mAppIdleDurationMillis,pw);
    pw.println();
    pw.print("  mAppIdleWallclockThresholdMillis=");
    TimeUtils.formatDuration(mAppIdleWallclockThresholdMillis,pw);
    pw.println();
    pw.print("  mCheckIdleIntervalMillis=");
    TimeUtils.formatDuration(mCheckIdleIntervalMillis,pw);
    pw.println();
    pw.print("  mAppIdleParoleIntervalMillis=");
    TimeUtils.formatDuration(mAppIdleParoleIntervalMillis,pw);
    pw.println();
    pw.print("  mAppIdleParoleDurationMillis=");
    TimeUtils.formatDuration(mAppIdleParoleDurationMillis,pw);
    pw.println();
    pw.println();
    pw.print("mAppIdleEnabled=");
    pw.print(mAppIdleEnabled);
    pw.print(" mAppIdleParoled=");
    pw.print(mAppIdleParoled);
    pw.print(" mScreenOn=");
    pw.println(mScreenOn);
    pw.print("mLastAppIdleParoledTime=");
    TimeUtils.formatDuration(mLastAppIdleParoledTime,pw);
    pw.println();
    pw.print("mScreenOnTime=");
    TimeUtils.formatDuration(mScreenOnTime,pw);
    pw.println();
    pw.print("mLastScreenOnEventRealtime=");
    TimeUtils.formatDuration(mLastScreenOnEventRealtime,pw);
    pw.println();
  }
}
