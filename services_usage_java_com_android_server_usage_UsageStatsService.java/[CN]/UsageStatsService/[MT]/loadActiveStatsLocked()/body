{
  final long timeNow=System.currentTimeMillis();
  Calendar tempCal=mDailyExpiryDate;
  for (int i=0; i < mCurrentStats.length; i++) {
    tempCal.setTimeInMillis(timeNow);
    UsageStatsUtils.truncateDateTo(i,tempCal);
    if (mCurrentStats[i] != null && mCurrentStats[i].mBeginTimeStamp == tempCal.getTimeInMillis()) {
      continue;
    }
    UsageStats[] stats=mDatabase.getUsageStats(i,timeNow,1);
    if (stats != null && stats.length > 0) {
      mCurrentStats[i]=stats[stats.length - 1];
    }
 else {
      mCurrentStats[i]=UsageStats.create(tempCal.getTimeInMillis(),timeNow);
    }
  }
  mStatsChanged=false;
  mDailyExpiryDate.setTimeInMillis(timeNow);
  mDailyExpiryDate.add(Calendar.DAY_OF_YEAR,1);
  UsageStatsUtils.truncateDateTo(UsageStatsManager.DAILY_BUCKET,mDailyExpiryDate);
  Slog.i(TAG,"Rollover scheduled for " + sDateFormat.format(mDailyExpiryDate.getTime()));
}
