{
  try {
    int handle=mService.openP2pConnection();
    if (ErrorCodes.isError(handle)) {
      if (handle == ErrorCodes.ERROR_IO) {
        throw new IOException();
      }
 else {
        throw convertErrorToNfcException(handle);
      }
    }
    if (mP2pTargetService.getMode(handle) == P2pDevice.MODE_P2P_TARGET) {
      return new P2pTarget(mP2pTargetService,handle);
    }
 else {
      return new P2pInitiator(mP2pInitiatorService,handle);
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"RemoteException in openTagConnection(): ",e);
    return null;
  }
}
