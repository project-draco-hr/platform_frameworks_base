{
  LayoutBinder lb=new MockLayoutBinder();
  mExprModel=lb.getModel();
  IdentifierExpr user=lb.addVariable("user","android.databinding.tool.expr.ExprModelTest.User");
  MathExpr parsed=parse(lb,"user.name + \" \" + (user.lastName ?? \"\")",MathExpr.class);
  mExprModel.seal();
  Iterable<Expr> toRead=getShouldRead();
  Iterable<Expr> readNow=getReadFirst(toRead);
  assertEquals(1,Iterables.size(readNow));
  assertSame(user,Iterables.getFirst(readNow,null));
  List<Expr> justRead=new ArrayList<Expr>();
  justRead.add(user);
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(2,Iterables.size(readNow));
  Iterables.addAll(justRead,readNow);
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(2,Iterables.size(readNow));
  Iterables.addAll(justRead,readNow);
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(0,Iterables.size(readNow));
  mExprModel.markBitsRead();
  toRead=getShouldRead();
  assertEquals(2,Iterables.size(toRead));
  justRead.clear();
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(1,Iterables.size(readNow));
  assertSame(parsed.getRight(),Iterables.getFirst(readNow,null));
  Iterables.addAll(justRead,readNow);
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(1,Iterables.size(readNow));
  assertSame(parsed,Iterables.getFirst(readNow,null));
  Iterables.addAll(justRead,readNow);
  readNow=filterOut(getReadFirst(toRead,justRead),justRead);
  assertEquals(0,Iterables.size(readNow));
  mExprModel.markBitsRead();
  assertEquals(0,Iterables.size(getShouldRead()));
}
