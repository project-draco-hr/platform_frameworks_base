{
  final boolean showing=getWidgetPosition(R.id.keyguard_transport_control) != -1;
  final boolean visible=state == TRANSPORT_VISIBLE;
  final boolean shouldBeVisible=state == TRANSPORT_INVISIBLE && isMusicPlaying(state);
  if (!showing && (visible || shouldBeVisible)) {
    int lastWidget=mAppWidgetContainer.getChildCount() - 1;
    int position=0;
    if (lastWidget >= 0) {
      position=mAppWidgetContainer.isCameraPage(lastWidget) ? lastWidget : lastWidget + 1;
    }
    if (DEBUGXPORT)     Log.v(TAG,"add transport at " + position);
    mAppWidgetContainer.addWidget(getOrCreateTransportControl(),position);
    return true;
  }
 else   if (showing && state == TRANSPORT_GONE) {
    if (DEBUGXPORT)     Log.v(TAG,"remove transport");
    mAppWidgetContainer.removeWidget(getOrCreateTransportControl());
    mTransportControl=null;
    KeyguardUpdateMonitor.getInstance(getContext()).dispatchSetBackground(null);
  }
  return false;
}
