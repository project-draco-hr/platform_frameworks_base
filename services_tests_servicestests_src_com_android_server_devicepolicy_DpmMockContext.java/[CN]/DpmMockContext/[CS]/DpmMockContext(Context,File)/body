{
  realTestContext=context;
  this.dataDir=dataDir;
  DpmTestUtils.clearDir(dataDir);
  binder=new MockBinder();
  environment=mock(EnvironmentForMock.class);
  systemProperties=mock(SystemPropertiesForMock.class);
  userManager=mock(UserManager.class);
  userManagerForMock=mock(UserManagerForMock.class);
  powerManager=mock(PowerManagerForMock.class);
  powerManagerInternal=mock(PowerManagerInternal.class);
  notificationManager=mock(NotificationManager.class);
  iwindowManager=mock(IWindowManager.class);
  iactivityManager=mock(IActivityManager.class);
  ipackageManager=mock(IPackageManager.class);
  ibackupManager=mock(IBackupManager.class);
  iaudioService=mock(IAudioService.class);
  lockPatternUtils=mock(LockPatternUtils.class);
  settings=mock(SettingsForMock.class);
  packageManager=spy(context.getPackageManager());
  spiedContext=mock(Context.class);
  systemUserDataDir=addUser(UserHandle.USER_SYSTEM,UserInfo.FLAG_PRIMARY);
  when(userManager.isUserRunning(MockUtils.checkUserHandle(UserHandle.USER_SYSTEM))).thenReturn(true);
}
