{
  final PackageSetting pkgSetting=mPackages.get(packageName);
  if (pkgSetting == null) {
    throw new IllegalArgumentException("Unknown package: " + packageName);
  }
  if (!allowedByPermission && (uid != pkgSetting.userId)) {
    throw new SecurityException("Permission Denial: attempt to change stopped state from pid=" + Binder.getCallingPid() + ", uid="+ uid+ ", package uid="+ pkgSetting.userId);
  }
  if (DEBUG_STOPPED) {
    if (stopped) {
      RuntimeException e=new RuntimeException("here");
      e.fillInStackTrace();
      Slog.i(TAG,"Stopping package " + packageName,e);
    }
  }
  if (pkgSetting.stopped != stopped) {
    pkgSetting.stopped=stopped;
    pkgSetting.pkg.mSetStopped=stopped;
    if (pkgSetting.notLaunched) {
      if (pkgSetting.installerPackageName != null) {
        PackageManagerService.sendPackageBroadcast(Intent.ACTION_PACKAGE_FIRST_LAUNCH,pkgSetting.name,null,pkgSetting.installerPackageName,null);
      }
      pkgSetting.notLaunched=false;
    }
    return true;
  }
  return false;
}
