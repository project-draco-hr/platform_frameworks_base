{
  if (line != 1) {
    return;
  }
  if (countWaiting < 0) {
    countWaiting=-1;
  }
 else   if (countWaiting > 0xff) {
    countWaiting=0xff;
  }
  countVoiceMessages=countWaiting;
  phone.setSystemProperty(PROPERTY_LINE1_VOICE_MAIL_WAITING,(countVoiceMessages != 0) ? "true" : "false");
  phone.notifyMessageWaitingIndicator();
  try {
    if (efMWIS != null) {
      efMWIS[0]=(byte)((efMWIS[0] & 0xfe) | (countVoiceMessages == 0 ? 0 : 1));
      if (countWaiting < 0) {
        efMWIS[1]=0;
      }
 else {
        efMWIS[1]=(byte)countWaiting;
      }
      phone.mSIMFileHandler.updateEFLinearFixed(EF_MWIS,1,efMWIS,null,obtainMessage(EVENT_UPDATE_DONE,EF_MWIS));
    }
    if (efCPHS_MWI != null) {
      efCPHS_MWI[0]=(byte)((efCPHS_MWI[0] & 0xf0) | (countVoiceMessages == 0 ? 0x5 : 0xa));
      phone.mSIMFileHandler.updateEFTransparent(EF_VOICE_MAIL_INDICATOR_CPHS,efCPHS_MWI,obtainMessage(EVENT_UPDATE_DONE,EF_VOICE_MAIL_INDICATOR_CPHS));
    }
  }
 catch (  ArrayIndexOutOfBoundsException ex) {
    Log.w(LOG_TAG,"Error saving voice mail state to SIM. Probably malformed SIM record",ex);
  }
}
