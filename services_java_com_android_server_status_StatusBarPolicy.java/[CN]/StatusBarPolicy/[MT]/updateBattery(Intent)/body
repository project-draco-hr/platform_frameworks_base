{
  mBatteryData.iconId=intent.getIntExtra("icon-small",0);
  mBatteryData.iconLevel=intent.getIntExtra("level",0);
  mService.updateIcon(mBatteryIcon,mBatteryData,null);
  boolean plugged=intent.getIntExtra("plugged",0) != 0;
  int level=intent.getIntExtra("level",-1);
  if (false) {
    Log.d(TAG,"updateBattery level=" + level + " plugged="+ plugged+ " mBatteryPlugged="+ mBatteryPlugged+ " mBatteryLevel="+ mBatteryLevel+ " mBatteryThreshold="+ mBatteryThreshold+ " mBatteryFirst="+ mBatteryFirst);
  }
  boolean oldPlugged=mBatteryPlugged;
  int oldThreshold=mBatteryThreshold;
  pickNextBatteryLevel(level);
  mBatteryPlugged=plugged;
  mBatteryLevel=level;
  if (mBatteryFirst) {
    mBatteryFirst=false;
  }
  if (!plugged && ((oldPlugged && level <= mBatteryThresholds[0]) || (mBatteryThreshold > oldThreshold))) {
    mContext.sendBroadcast(new Intent(Intent.ACTION_BATTERY_LOW));
    if (SHOW_LOW_BATTERY_WARNING) {
      if (false) {
        Log.d(TAG,"mPhoneState=" + mPhoneState + " mLowBatteryDialog="+ mLowBatteryDialog+ " mBatteryShowLowOnEndCall="+ mBatteryShowLowOnEndCall);
      }
      if (mPhoneState == TelephonyManager.CALL_STATE_IDLE) {
        showLowBatteryWarning();
      }
 else {
        mBatteryShowLowOnEndCall=true;
      }
    }
  }
}
