{
  int iconId;
  boolean visible=true;
  if (!isCdma()) {
    if (mSimState == IccCard.State.READY || mSimState == IccCard.State.UNKNOWN) {
      if (hasService() && mDataState == TelephonyManager.DATA_CONNECTED) {
switch (mDataActivity) {
case TelephonyManager.DATA_ACTIVITY_IN:
          iconId=mDataIconList[1];
        break;
case TelephonyManager.DATA_ACTIVITY_OUT:
      iconId=mDataIconList[2];
    break;
case TelephonyManager.DATA_ACTIVITY_INOUT:
  iconId=mDataIconList[3];
break;
default :
iconId=mDataIconList[0];
break;
}
mDataData.iconId=iconId;
mService.updateIcon(mDataIcon,mDataData,null);
}
 else {
visible=false;
}
}
 else {
mDataData.iconId=com.android.internal.R.drawable.stat_sys_no_sim;
mService.updateIcon(mDataIcon,mDataData,null);
}
}
 else {
if (hasService() && mDataState == TelephonyManager.DATA_CONNECTED) {
switch (mDataActivity) {
case TelephonyManager.DATA_ACTIVITY_IN:
iconId=mDataIconList[1];
break;
case TelephonyManager.DATA_ACTIVITY_OUT:
iconId=mDataIconList[2];
break;
case TelephonyManager.DATA_ACTIVITY_INOUT:
iconId=mDataIconList[3];
break;
case TelephonyManager.DATA_ACTIVITY_DORMANT:
iconId=mDataIconList[4];
break;
default :
iconId=mDataIconList[0];
break;
}
mDataData.iconId=iconId;
mService.updateIcon(mDataIcon,mDataData,null);
}
 else {
visible=false;
}
}
long ident=Binder.clearCallingIdentity();
try {
mBatteryStats.notePhoneDataConnectionState(mPhone.getNetworkType(),visible);
}
 catch (RemoteException e) {
}
 finally {
Binder.restoreCallingIdentity(ident);
}
if (mDataIconVisible != visible) {
mService.setIconVisibility(mDataIcon,visible);
mDataIconVisible=visible;
}
}
