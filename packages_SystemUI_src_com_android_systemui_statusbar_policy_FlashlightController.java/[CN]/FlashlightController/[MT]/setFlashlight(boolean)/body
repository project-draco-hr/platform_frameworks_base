{
  boolean pendingError=false;
synchronized (this) {
    if (mFlashlightEnabled != enabled) {
      mFlashlightEnabled=enabled;
      try {
        mCameraManager.setTorchMode(mCameraId,enabled);
      }
 catch (      CameraAccessException e) {
        Log.e(TAG,"Couldn't set torch mode",e);
        mFlashlightEnabled=false;
        pendingError=true;
      }
    }
  }
  dispatchModeChanged(mFlashlightEnabled);
  if (pendingError) {
    dispatchError();
  }
}
