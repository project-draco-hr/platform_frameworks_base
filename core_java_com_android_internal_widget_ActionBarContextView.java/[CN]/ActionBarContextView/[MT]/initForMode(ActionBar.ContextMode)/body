{
  final ActionBarImpl.ContextMode implMode=(ActionBarImpl.ContextMode)mode;
  if (mCloseButton == null) {
    mCloseButton=new ImageButton(getContext());
    mCloseButton.setImageDrawable(mCloseDrawable);
    mCloseButton.setBackgroundDrawable(null);
    mCloseButton.setOnClickListener(new OnClickListener(){
      public void onClick(      View v){
        mode.finish();
      }
    }
);
  }
  addView(mCloseButton);
  final Context context=getContext();
  final Menu menu=mode.getMenu();
  final int itemCount=menu.size();
  for (int i=0; i < itemCount; i++) {
    final MenuItem item=menu.getItem(i);
    final ImageButton button=new ImageButton(context,null,com.android.internal.R.attr.actionButtonStyle);
    button.setClickable(true);
    button.setFocusable(true);
    button.setImageDrawable(item.getIcon());
    button.setId(item.getItemId());
    button.setVisibility(item.isVisible() ? VISIBLE : GONE);
    button.setEnabled(item.isEnabled());
    button.setOnClickListener(new OnClickListener(){
      public void onClick(      View v){
        implMode.dispatchOnContextItemClicked(item);
      }
    }
);
    addView(button);
  }
  requestLayout();
}
