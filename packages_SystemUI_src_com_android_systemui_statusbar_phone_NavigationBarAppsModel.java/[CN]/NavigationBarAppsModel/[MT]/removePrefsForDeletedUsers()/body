{
  final List<UserInfo> users=mUserManager.getUsers();
  final int userCount=users.size();
  final Set<String> userSerials=new HashSet<String>();
  for (int i=0; i < userCount; ++i) {
    userSerials.add(Long.toString(users.get(i).serialNumber));
  }
  final Map<String,?> allPrefs=mPrefs.getAll();
  final SharedPreferences.Editor edit=mPrefs.edit();
  for (  Map.Entry<String,?> pref : allPrefs.entrySet()) {
    final String key=pref.getKey();
    if (key.equals(VERSION_PREF))     continue;
    final int userSeparatorPos=key.indexOf(USER_SEPARATOR);
    if (userSeparatorPos < 0) {
      edit.remove(key);
      continue;
    }
    final String prefUserSerial=key.substring(0,userSeparatorPos);
    if (!userSerials.contains(prefUserSerial)) {
      edit.remove(key);
      continue;
    }
  }
  edit.apply();
}
