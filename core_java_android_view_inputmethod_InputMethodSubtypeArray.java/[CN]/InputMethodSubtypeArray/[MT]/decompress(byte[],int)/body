{
  try (final ByteArrayInputStream inputStream=new ByteArrayInputStream(data);final GZIPInputStream unzipper=new GZIPInputStream(inputStream)){
    final byte[] result=new byte[expectedSize];
    int totalReadBytes=0;
    while (totalReadBytes < result.length) {
      final int restBytes=result.length - totalReadBytes;
      final int readBytes=unzipper.read(result,totalReadBytes,restBytes);
      if (readBytes < 0) {
        break;
      }
      totalReadBytes+=readBytes;
    }
    if (expectedSize != totalReadBytes) {
      return null;
    }
    return result;
  }
 catch (  Exception e) {
    Slog.e(TAG,"Failed to decompress the data.",e);
    return null;
  }
}
