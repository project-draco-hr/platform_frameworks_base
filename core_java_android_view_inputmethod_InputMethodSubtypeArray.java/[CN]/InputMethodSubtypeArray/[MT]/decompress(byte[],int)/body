{
  ByteArrayInputStream inputStream=null;
  GZIPInputStream unzipper=null;
  try {
    inputStream=new ByteArrayInputStream(data);
    unzipper=new GZIPInputStream(inputStream);
    final byte[] result=new byte[expectedSize];
    int totalReadBytes=0;
    while (totalReadBytes < result.length) {
      final int restBytes=result.length - totalReadBytes;
      final int readBytes=unzipper.read(result,totalReadBytes,restBytes);
      if (readBytes < 0) {
        break;
      }
      totalReadBytes+=readBytes;
    }
    if (expectedSize != totalReadBytes) {
      return null;
    }
    return result;
  }
 catch (  IOException e) {
    return null;
  }
 finally {
    try {
      if (unzipper != null) {
        unzipper.close();
      }
    }
 catch (    IOException e) {
      Slog.e(TAG,"Failed to close the stream.",e);
    }
    try {
      if (inputStream != null) {
        inputStream.close();
      }
    }
 catch (    IOException e) {
      Slog.e(TAG,"Failed to close the stream.",e);
    }
  }
}
