{
synchronized (this) {
    mScreenOn=false;
    if (DEBUG)     Log.d(TAG,"onScreenTurnedOff(" + why + ")");
    if (mExitSecureCallback != null) {
      if (DEBUG)       Log.d(TAG,"pending exit secure callback cancelled");
      mExitSecureCallback.onKeyguardExitResult(false);
      mExitSecureCallback=null;
      if (!mExternallyEnabled) {
        hideLocked();
      }
    }
 else     if (mShowing) {
      notifyScreenOffLocked();
      resetStateLocked();
    }
 else     if (why == WindowManagerPolicy.OFF_BECAUSE_OF_TIMEOUT) {
      long when=SystemClock.elapsedRealtime() + KEYGUARD_DELAY_MS;
      Intent intent=new Intent(DELAYED_KEYGUARD_ACTION);
      intent.putExtra("seq",mDelayedShowingSequence);
      PendingIntent sender=PendingIntent.getBroadcast(mContext,0,intent,PendingIntent.FLAG_CANCEL_CURRENT);
      mAlarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP,when,sender);
      if (DEBUG)       Log.d(TAG,"setting alarm to turn off keyguard, seq = " + mDelayedShowingSequence);
    }
 else {
      doKeyguard();
    }
  }
}
