{
  mContext=context;
  mRealPowerManager=powerManager;
  mPM=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mWakeLock=mPM.newWakeLock(PowerManager.FULL_WAKE_LOCK | PowerManager.ACQUIRE_CAUSES_WAKEUP,"keyguard");
  mWakeLock.setReferenceCounted(false);
  mWakeAndHandOff=mPM.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"keyguardWakeAndHandOff");
  mWakeAndHandOff.setReferenceCounted(false);
  IntentFilter filter=new IntentFilter();
  filter.addAction(DELAYED_KEYGUARD_ACTION);
  filter.addAction(TelephonyIntents.ACTION_SIM_STATE_CHANGED);
  filter.addAction(Intent.ACTION_CONFIGURATION_CHANGED);
  context.registerReceiver(mBroadCastReceiver,filter);
  mAlarmManager=(AlarmManager)context.getSystemService(Context.ALARM_SERVICE);
  mCallback=callback;
  mUpdateMonitor=new KeyguardUpdateMonitor(context);
  mUpdateMonitor.registerConfigurationChangeCallback(this);
  mUpdateMonitor.registerSimStateCallback(this);
  mKeyguardViewProperties=new LockPatternKeyguardViewProperties(new LockPatternUtils(mContext.getContentResolver()),mUpdateMonitor);
  mKeyguardViewManager=new KeyguardViewManager(context,WindowManagerImpl.getDefault(),this,mKeyguardViewProperties,mUpdateMonitor);
}
