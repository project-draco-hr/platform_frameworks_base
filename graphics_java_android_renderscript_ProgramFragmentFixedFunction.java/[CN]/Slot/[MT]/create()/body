{
  InternalBuilder sb=new InternalBuilder(mRS);
  mNumTextures=0;
  for (int i=0; i < MAX_TEXTURE; i++) {
    if (mSlots[i] != null) {
      mNumTextures++;
    }
  }
  buildShaderString();
  sb.setShader(mShader);
  Type constType=null;
  if (!mVaryingColorEnable) {
    Element.Builder b=new Element.Builder(mRS);
    b.add(Element.F32_4(mRS),"Color");
    Type.Builder typeBuilder=new Type.Builder(mRS,b.create());
    typeBuilder.setX(1);
    constType=typeBuilder.create();
    sb.addConstant(constType);
  }
  for (int i=0; i < mNumTextures; i++) {
    sb.addTexture(TextureType.TEXTURE_2D);
  }
  ProgramFragmentFixedFunction pf=sb.create();
  pf.mTextureCount=MAX_TEXTURE;
  if (!mVaryingColorEnable) {
    Allocation constantData=Allocation.createTyped(mRS,constType);
    float[] data=new float[4];
    data[0]=data[1]=data[2]=data[3]=1.0f;
    constantData.copyFrom(data);
    pf.bindConstants(constantData,0);
  }
  return pf;
}
