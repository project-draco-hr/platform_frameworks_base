{
synchronized (mLocks) {
    if (mSpew) {
      Log.d(TAG,"setKeyboardVisibility: " + visible);
    }
    if (mKeyboardVisible != visible) {
      mKeyboardVisible=visible;
      if ((mPowerState & SCREEN_ON_BIT) != 0) {
        if (mAutoBrightessEnabled && mUseSoftwareAutoBrightness) {
          if (mLightSensorValue >= 0) {
            int value=(int)mLightSensorValue;
            mLightSensorValue=-1;
            lightSensorChangedLocked(value);
          }
        }
        userActivity(SystemClock.uptimeMillis(),false,BUTTON_EVENT,true);
      }
    }
  }
}
