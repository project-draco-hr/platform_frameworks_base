{
  if (mProximitySensorActive) {
    why=WindowManagerPolicy.OFF_BECAUSE_OF_PROXIMITY_SENSOR;
  }
  if (!on) {
    mStillNeedSleepNotification=false;
  }
  int index=0;
  while (mBroadcastQueue[index] != -1) {
    index++;
  }
  mBroadcastQueue[index]=on ? 1 : 0;
  mBroadcastWhy[index]=why;
  if (index == 2) {
    if (!on && why == WindowManagerPolicy.OFF_BECAUSE_OF_USER) {
      mBroadcastWhy[0]=WindowManagerPolicy.OFF_BECAUSE_OF_USER;
    }
    mBroadcastQueue[0]=on ? 1 : 0;
    mBroadcastQueue[1]=-1;
    mBroadcastQueue[2]=-1;
    index=0;
  }
  if (index == 1 && !on) {
    mBroadcastQueue[0]=-1;
    mBroadcastQueue[1]=-1;
    index=-1;
    EventLog.writeEvent(LOG_POWER_SCREEN_BROADCAST_STOP,1,mBroadcastWakeLock.mCount);
    mBroadcastWakeLock.release();
  }
  if (index >= 0) {
    mBroadcastWakeLock.acquire();
    EventLog.writeEvent(LOG_POWER_SCREEN_BROADCAST_SEND,mBroadcastWakeLock.mCount);
    mHandler.post(mNotificationTask);
  }
}
