{
  String state=Environment.getExternalStorageState();
  IMountService mSvc;
  mSvc=IMountService.Stub.asInterface(ServiceManager.getService("mount"));
  if (mSvc == null) {
    Log.e(TAG,"MountService unavailable");
    return;
  }
  if (state.equals(Environment.MEDIA_SHARED)) {
    try {
      mSvc.setMassStorageEnabled(false);
    }
 catch (    Exception e) {
      Log.e(TAG,"ums disable failed",e);
    }
  }
 else   if (state.equals(Environment.MEDIA_CHECKING)) {
    while (state.equals(Environment.MEDIA_CHECKING)) {
      state=Environment.getExternalStorageState();
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException iex) {
        Log.e(TAG,"Interrupted while waiting for media",iex);
        break;
      }
    }
  }
  if (state.equals(Environment.MEDIA_MOUNTED)) {
    try {
      String m=Environment.getExternalStorageDirectory().toString();
      mSvc.unmountMedia(m);
    }
 catch (    Exception e) {
      Log.e(TAG,"external storage unmount failed",e);
    }
  }
}
