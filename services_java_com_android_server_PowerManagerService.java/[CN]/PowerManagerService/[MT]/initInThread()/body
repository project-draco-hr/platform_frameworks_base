{
  mHandler=new Handler();
  mBroadcastWakeLock=new UnsynchronizedWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"sleep_broadcast",true);
  mStayOnWhilePluggedInScreenDimLock=new UnsynchronizedWakeLock(PowerManager.SCREEN_DIM_WAKE_LOCK,"StayOnWhilePluggedIn Screen Dim",false);
  mStayOnWhilePluggedInPartialLock=new UnsynchronizedWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"StayOnWhilePluggedIn Partial",false);
  mPreventScreenOnPartialLock=new UnsynchronizedWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"PreventScreenOn Partial",false);
  mScreenOnIntent=new Intent(Intent.ACTION_SCREEN_ON);
  mScreenOnIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
  mScreenOffIntent=new Intent(Intent.ACTION_SCREEN_OFF);
  mScreenOffIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
  Resources resources=mContext.getResources();
  mUseSoftwareAutoBrightness=resources.getBoolean(com.android.internal.R.bool.config_automatic_brightness_available);
  mUseHardwareAutoBrightness=resources.getBoolean(com.android.internal.R.bool.config_hardware_automatic_brightness_available);
  if (mUseHardwareAutoBrightness) {
    mUseSoftwareAutoBrightness=false;
  }
  if (mUseSoftwareAutoBrightness) {
    mAutoBrightnessLevels=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessLevels);
    mLcdBacklightValues=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessLcdBacklightValues);
    mButtonBacklightValues=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessButtonBacklightValues);
    mKeyboardBacklightValues=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessKeyboardBacklightValues);
  }
  ContentResolver resolver=mContext.getContentResolver();
  Cursor settingsCursor=resolver.query(Settings.System.CONTENT_URI,null,"(" + Settings.System.NAME + "=?) or ("+ Settings.System.NAME+ "=?) or ("+ Settings.System.NAME+ "=?) or ("+ Settings.System.NAME+ "=?)",new String[]{STAY_ON_WHILE_PLUGGED_IN,SCREEN_OFF_TIMEOUT,DIM_SCREEN,SCREEN_BRIGHTNESS_MODE},null);
  mSettings=new ContentQueryMap(settingsCursor,Settings.System.NAME,true,mHandler);
  SettingsObserver settingsObserver=new SettingsObserver();
  mSettings.addObserver(settingsObserver);
  settingsObserver.update(mSettings,null);
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_BATTERY_CHANGED);
  mContext.registerReceiver(new BatteryReceiver(),filter);
  IntentFilter gservicesChangedFilter=new IntentFilter(Settings.Gservices.CHANGED_ACTION);
  mContext.registerReceiver(new GservicesChangedReceiver(),gservicesChangedFilter);
  updateGservicesValues();
  if (mUseSoftwareAutoBrightness) {
    setPowerState(SCREEN_BRIGHT);
  }
 else {
    setPowerState(ALL_BRIGHT);
  }
synchronized (mHandlerThread) {
    mInitComplete=true;
    mHandlerThread.notifyAll();
  }
}
