{
  if (mLastEventTime <= time) {
    mLastEventTime=time;
    mWakeLockState=SCREEN_OFF;
    int N=mLocks.size();
    int numCleared=0;
    for (int i=0; i < N; i++) {
      WakeLock wl=mLocks.get(i);
      if (isScreenLock(wl.flags)) {
        mLocks.get(i).activated=false;
        numCleared++;
      }
    }
    EventLog.writeEvent(EventLogTags.POWER_SLEEP_REQUESTED,numCleared);
    mStillNeedSleepNotification=true;
    mUserState=SCREEN_OFF;
    setPowerState(SCREEN_OFF,false,reason);
    cancelTimerLocked();
  }
}
