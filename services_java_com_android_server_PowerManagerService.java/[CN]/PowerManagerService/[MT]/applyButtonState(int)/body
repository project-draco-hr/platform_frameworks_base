{
  int brightness=-1;
  if ((state & BATTERY_LOW_BIT) != 0) {
    return state;
  }
  if (mButtonBrightnessOverride >= 0) {
    brightness=mButtonBrightnessOverride;
  }
 else   if (mLightSensorButtonBrightness >= 0 && mUseSoftwareAutoBrightness) {
    brightness=mLightSensorButtonBrightness;
  }
  if (brightness > 0) {
    return state | BUTTON_BRIGHT_BIT;
  }
 else   if (brightness == 0) {
    return state & ~BUTTON_BRIGHT_BIT;
  }
 else {
    return state;
  }
}
