{
  if (mDebugLightSensor) {
    Slog.d(TAG,"lightSensorChangedLocked " + value);
  }
  if ((mPowerState & SCREEN_ON_BIT) == 0) {
    if (mDebugLightSensor) {
      Slog.d(TAG,"dropping lightSensorChangedLocked because screen is off");
    }
    return;
  }
  if (mHighestLightSensorValue < value) {
    mHighestLightSensorValue=value;
  }
  if (mLightSensorValue != value) {
    mLightSensorValue=value;
    if ((mPowerState & BATTERY_LOW_BIT) == 0) {
      int lcdValue=getAutoBrightnessValue((mIsDocked ? value : mHighestLightSensorValue),mLcdBacklightValues);
      int buttonValue=getAutoBrightnessValue(value,mButtonBacklightValues);
      int keyboardValue;
      if (mKeyboardVisible) {
        keyboardValue=getAutoBrightnessValue(value,mKeyboardBacklightValues);
      }
 else {
        keyboardValue=0;
      }
      mLightSensorScreenBrightness=lcdValue;
      mLightSensorButtonBrightness=buttonValue;
      mLightSensorKeyboardBrightness=keyboardValue;
      if (mDebugLightSensor) {
        Slog.d(TAG,"lcdValue " + lcdValue);
        Slog.d(TAG,"buttonValue " + buttonValue);
        Slog.d(TAG,"keyboardValue " + keyboardValue);
      }
      if (mAutoBrightessEnabled && mScreenBrightnessOverride < 0) {
        mScreenBrightness.setTargetLocked(lcdValue,AUTOBRIGHTNESS_ANIM_STEPS,INITIAL_SCREEN_BRIGHTNESS,(int)mScreenBrightness.curValue);
      }
      if (mButtonBrightnessOverride < 0) {
        mButtonLight.setBrightness(buttonValue);
      }
      if (mButtonBrightnessOverride < 0 || !mKeyboardVisible) {
        mKeyboardLight.setBrightness(keyboardValue);
      }
    }
  }
}
