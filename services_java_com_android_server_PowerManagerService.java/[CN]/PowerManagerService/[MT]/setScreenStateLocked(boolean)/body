{
  int err=Power.setScreenState(on);
  if (err == 0) {
    mLastScreenOnTime=(on ? SystemClock.elapsedRealtime() : 0);
    if (mUseSoftwareAutoBrightness) {
      enableLightSensor(on);
      if (!on) {
        int brightnessMode=(mUseSoftwareAutoBrightness ? HardwareService.BRIGHTNESS_MODE_SENSOR : HardwareService.BRIGHTNESS_MODE_USER);
        mHardware.setLightBrightness_UNCHECKED(HardwareService.LIGHT_ID_BUTTONS,0,brightnessMode);
        mHardware.setLightBrightness_UNCHECKED(HardwareService.LIGHT_ID_KEYBOARD,0,brightnessMode);
        mLightSensorValue=-1;
      }
    }
  }
  return err;
}
