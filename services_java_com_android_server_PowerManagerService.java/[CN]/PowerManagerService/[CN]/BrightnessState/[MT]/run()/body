{
synchronized (mLocks) {
    final boolean turningOff=animating && targetValue == Power.BRIGHTNESS_OFF;
    if (mAnimateScreenLights || !turningOff) {
      long now=SystemClock.uptimeMillis();
      boolean more=mScreenBrightness.stepLocked();
      if (more) {
        mScreenOffHandler.postAtTime(this,now + (1000 / 60));
      }
    }
 else {
      if (!mHeadless) {
        nativeStartSurfaceFlingerAnimation(mScreenOffReason == WindowManagerPolicy.OFF_BECAUSE_OF_PROX_SENSOR ? 0 : mAnimationSetting);
      }
      mScreenBrightness.jumpToTargetLocked();
    }
  }
}
