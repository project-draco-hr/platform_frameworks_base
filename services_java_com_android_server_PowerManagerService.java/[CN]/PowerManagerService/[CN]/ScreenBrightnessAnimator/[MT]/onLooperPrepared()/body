{
  mScreenBrightnessHandler=new Handler(){
    public void handleMessage(    Message msg){
      int brightnessMode=(mAutoBrightessEnabled && !mInitialAnimation ? LightsService.BRIGHTNESS_MODE_SENSOR : LightsService.BRIGHTNESS_MODE_USER);
      if (msg.what == ANIMATE_LIGHTS) {
        final int mask=msg.arg1;
        int value=msg.arg2;
        long tStart=SystemClock.uptimeMillis();
        if ((mask & SCREEN_BRIGHT_BIT) != 0) {
          if (mDebugLightAnimation)           Slog.v(TAG,"Set brightness: " + value);
          mLcdLight.setBrightness(value,brightnessMode);
        }
        long elapsed=SystemClock.uptimeMillis() - tStart;
        if ((mask & BUTTON_BRIGHT_BIT) != 0) {
          mButtonLight.setBrightness(value);
        }
        if ((mask & KEYBOARD_BRIGHT_BIT) != 0) {
          mKeyboardLight.setBrightness(value);
        }
        if (elapsed > 100) {
          Slog.e(TAG,"Excessive delay setting brightness: " + elapsed + "ms, mask="+ mask);
        }
        int delay=elapsed < NOMINAL_FRAME_TIME_MS ? NOMINAL_FRAME_TIME_MS : 1;
synchronized (this) {
          currentValue=value;
        }
        animateInternal(mask,false,delay);
      }
 else       if (msg.what == ANIMATE_POWER_OFF) {
        int mode=msg.arg1;
        nativeStartSurfaceFlingerAnimation(mode);
      }
    }
  }
;
synchronized (this) {
    mInitComplete=true;
    notifyAll();
  }
}
