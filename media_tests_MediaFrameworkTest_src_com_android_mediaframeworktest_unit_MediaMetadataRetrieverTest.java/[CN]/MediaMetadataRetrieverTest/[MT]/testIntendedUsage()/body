{
  MediaMetadataRetriever retriever=new MediaMetadataRetriever();
  boolean hasFailed=false;
  retriever.setDataSource(MediaNames.TEST_PATH_1);
  assertTrue(retriever.getFrameAtTime(-1) != null);
  assertTrue(retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_NUM_TRACKS) != null);
  retriever.setMode(MediaMetadataRetriever.MODE_CAPTURE_FRAME_ONLY & MediaMetadataRetriever.MODE_GET_METADATA_ONLY);
  retriever.setDataSource(MediaNames.TEST_PATH_1);
  if (retriever.getFrameAtTime(-1) != null) {
    Log.e(TAG,"No frame expected, but is available");
    hasFailed=true;
  }
  if (retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_NUM_TRACKS) != null) {
    Log.e(TAG,"No num track metadata expected, but is available");
    hasFailed=true;
  }
  retriever.setMode(MediaMetadataRetriever.MODE_CAPTURE_FRAME_ONLY);
  retriever.setDataSource(MediaNames.TEST_PATH_1);
  assertTrue(retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_NUM_TRACKS) == null);
  retriever.setMode(MediaMetadataRetriever.MODE_GET_METADATA_ONLY);
  retriever.setDataSource(MediaNames.TEST_PATH_1);
  if (retriever.getFrameAtTime(-1) != null) {
    Log.e(TAG,"No frame expected, but is available");
    hasFailed=true;
  }
  retriever.setMode(MediaMetadataRetriever.MODE_CAPTURE_FRAME_ONLY | MediaMetadataRetriever.MODE_GET_METADATA_ONLY);
  retriever.setDataSource(MediaNames.TEST_PATH_1);
  assertTrue(retriever.getFrameAtTime(-1) != null);
  assertTrue(retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_NUM_TRACKS) != null);
  retriever.release();
  assertTrue(!hasFailed);
}
