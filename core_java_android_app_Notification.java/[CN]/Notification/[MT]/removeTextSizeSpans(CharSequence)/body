{
  if (charSequence instanceof Spanned) {
    Spanned ss=(Spanned)charSequence;
    Object[] spans=ss.getSpans(0,ss.length(),Object.class);
    SpannableStringBuilder builder=new SpannableStringBuilder(ss.toString());
    for (    Object span : spans) {
      Object resultSpan=span;
      if (resultSpan instanceof CharacterStyle) {
        resultSpan=((CharacterStyle)span).getUnderlying();
      }
      if (resultSpan instanceof TextAppearanceSpan) {
        TextAppearanceSpan originalSpan=(TextAppearanceSpan)resultSpan;
        resultSpan=new TextAppearanceSpan(originalSpan.getFamily(),originalSpan.getTextStyle(),-1,originalSpan.getTextColor(),originalSpan.getLinkTextColor());
      }
 else       if (resultSpan instanceof RelativeSizeSpan || resultSpan instanceof AbsoluteSizeSpan) {
        continue;
      }
 else {
        resultSpan=span;
      }
      builder.setSpan(resultSpan,ss.getSpanStart(span),ss.getSpanEnd(span),ss.getSpanFlags(span));
    }
    return builder;
  }
  return charSequence;
}
