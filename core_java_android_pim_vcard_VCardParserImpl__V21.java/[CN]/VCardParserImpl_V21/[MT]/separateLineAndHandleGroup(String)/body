{
  int state=STATE_GROUP_OR_PROPNAME;
  int nameIndex=0;
  final String[] propertyNameAndValue=new String[2];
  final int length=line.length();
  if (length > 0 && line.charAt(0) == '#') {
    throw new VCardInvalidCommentLineException();
  }
  for (int i=0; i < length; i++) {
    final char ch=line.charAt(i);
switch (state) {
case STATE_GROUP_OR_PROPNAME:
{
        if (ch == ':') {
          final String propertyName=line.substring(nameIndex,i);
          if (propertyName.equalsIgnoreCase("END")) {
            mPreviousLine=line;
            return null;
          }
          if (mInterpreter != null) {
            mInterpreter.propertyName(propertyName);
          }
          propertyNameAndValue[0]=propertyName;
          if (i < length - 1) {
            propertyNameAndValue[1]=line.substring(i + 1);
          }
 else {
            propertyNameAndValue[1]="";
          }
          return propertyNameAndValue;
        }
 else         if (ch == '.') {
          String groupName=line.substring(nameIndex,i);
          if (mInterpreter != null) {
            mInterpreter.propertyGroup(groupName);
          }
          nameIndex=i + 1;
        }
 else         if (ch == ';') {
          String propertyName=line.substring(nameIndex,i);
          if (propertyName.equalsIgnoreCase("END")) {
            mPreviousLine=line;
            return null;
          }
          if (mInterpreter != null) {
            mInterpreter.propertyName(propertyName);
          }
          propertyNameAndValue[0]=propertyName;
          nameIndex=i + 1;
          state=STATE_PARAMS;
        }
        break;
      }
case STATE_PARAMS:
{
      if (ch == '"') {
        state=STATE_PARAMS_IN_DQUOTE;
      }
 else       if (ch == ';') {
        handleParams(line.substring(nameIndex,i));
        nameIndex=i + 1;
      }
 else       if (ch == ':') {
        handleParams(line.substring(nameIndex,i));
        if (i < length - 1) {
          propertyNameAndValue[1]=line.substring(i + 1);
        }
 else {
          propertyNameAndValue[1]="";
        }
        return propertyNameAndValue;
      }
      break;
    }
case STATE_PARAMS_IN_DQUOTE:
{
    if (ch == '"') {
      state=STATE_PARAMS;
    }
    break;
  }
}
}
throw new VCardInvalidLineException("Invalid line: \"" + line + "\"");
}
