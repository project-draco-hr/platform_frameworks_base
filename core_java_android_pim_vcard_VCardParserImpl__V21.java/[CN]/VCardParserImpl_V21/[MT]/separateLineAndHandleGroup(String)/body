{
  final String[] propertyNameAndValue=new String[2];
  final int length=line.length();
  if (length > 0 && line.charAt(0) == '#') {
    throw new VCardInvalidCommentLineException();
  }
  int state=STATE_GROUP_OR_PROPERTY_NAME;
  int nameIndex=0;
  for (int i=0; i < length; i++) {
    final char ch=line.charAt(i);
switch (state) {
case STATE_GROUP_OR_PROPERTY_NAME:
{
        if (ch == ':') {
          final String propertyName=line.substring(nameIndex,i);
          if (propertyName.equalsIgnoreCase("END")) {
            mPreviousLine=line;
            return null;
          }
          mInterpreter.propertyName(propertyName);
          propertyNameAndValue[0]=propertyName;
          if (i < length - 1) {
            propertyNameAndValue[1]=line.substring(i + 1);
          }
 else {
            propertyNameAndValue[1]="";
          }
          return propertyNameAndValue;
        }
 else         if (ch == '.') {
          final String groupName=line.substring(nameIndex,i);
          if (groupName.length() == 0) {
            Log.w(LOG_TAG,"Empty group found. Ignoring.");
          }
 else {
            mInterpreter.propertyGroup(groupName);
          }
          nameIndex=i + 1;
        }
 else         if (ch == ';') {
          final String propertyName=line.substring(nameIndex,i);
          if (propertyName.equalsIgnoreCase("END")) {
            mPreviousLine=line;
            return null;
          }
          mInterpreter.propertyName(propertyName);
          propertyNameAndValue[0]=propertyName;
          nameIndex=i + 1;
          state=STATE_PARAMS;
        }
        break;
      }
case STATE_PARAMS:
{
      if (ch == '"') {
        if (VCardConstants.VERSION_V21.equalsIgnoreCase(getVersionString())) {
          Log.w(LOG_TAG,"Double-quoted params found in vCard 2.1. " + "Silently allow it");
        }
        state=STATE_PARAMS_IN_DQUOTE;
      }
 else       if (ch == ';') {
        handleParams(line.substring(nameIndex,i));
        nameIndex=i + 1;
      }
 else       if (ch == ':') {
        handleParams(line.substring(nameIndex,i));
        if (i < length - 1) {
          propertyNameAndValue[1]=line.substring(i + 1);
        }
 else {
          propertyNameAndValue[1]="";
        }
        return propertyNameAndValue;
      }
      break;
    }
case STATE_PARAMS_IN_DQUOTE:
{
    if (ch == '"') {
      if (VCardConstants.VERSION_V21.equalsIgnoreCase(getVersionString())) {
        Log.w(LOG_TAG,"Double-quoted params found in vCard 2.1. " + "Silently allow it");
      }
      state=STATE_PARAMS;
    }
    break;
  }
}
}
throw new VCardInvalidLineException("Invalid line: \"" + line + "\"");
}
