{
  if (animation == null) {
    return false;
  }
  transformation.clear();
  boolean hasMoreFrames=animation.getTransformation(currentTime,transformation);
  if (!hasMoreFrames) {
    if (deferThumbnailDestruction && !deferFinalFrameCleanup) {
      deferFinalFrameCleanup=true;
      hasMoreFrames=true;
    }
 else {
      if (false && WindowManagerService.DEBUG_ANIM)       Slog.v(TAG,"Stepped animation in " + mAppToken + ": more="+ hasMoreFrames+ ", xform="+ transformation);
      deferFinalFrameCleanup=false;
      animation=null;
      clearThumbnail();
      if (WindowManagerService.DEBUG_ANIM)       Slog.v(TAG,"Finished animation in " + mAppToken + " @ "+ currentTime);
    }
  }
  hasTransformation=hasMoreFrames;
  return hasMoreFrames;
}
