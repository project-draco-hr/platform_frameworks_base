{
  if (animation == null) {
    return false;
  }
  transformation.clear();
  if (mProlongAnimation == PROLONG_ANIMATION_AT_START) {
    animation.setStartTime(currentTime);
    currentTime+=1;
  }
  boolean hasMoreFrames=animation.getTransformation(currentTime,transformation);
  if (!hasMoreFrames) {
    if (deferThumbnailDestruction && !deferFinalFrameCleanup) {
      deferFinalFrameCleanup=true;
      hasMoreFrames=true;
    }
 else {
      if (false && DEBUG_ANIM)       Slog.v(TAG,"Stepped animation in " + mAppToken + ": more="+ hasMoreFrames+ ", xform="+ transformation+ ", mProlongAnimation="+ mProlongAnimation);
      deferFinalFrameCleanup=false;
      if (mProlongAnimation == PROLONG_ANIMATION_AT_END) {
        hasMoreFrames=true;
      }
 else {
        animation=null;
      }
      clearThumbnail();
      if (DEBUG_ANIM)       Slog.v(TAG,"Finished animation in " + mAppToken + " @ "+ currentTime);
    }
  }
  hasTransformation=hasMoreFrames;
  return hasMoreFrames;
}
