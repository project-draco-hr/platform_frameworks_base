{
  ZenModeConfig newConfig;
synchronized (mConfig) {
    if (mConfig == null)     return;
    if (!Global.isValidZenMode(zenMode))     return;
    if (DEBUG)     Log.d(TAG,"setManualZenMode " + Global.zenModeToString(zenMode) + " conditionId="+ conditionId+ " reason="+ reason+ " setRingerMode="+ setRingerMode);
    newConfig=mConfig.copy();
    if (zenMode == Global.ZEN_MODE_OFF) {
      newConfig.manualRule=null;
      for (      ZenRule automaticRule : newConfig.automaticRules.values()) {
        if (automaticRule.isAutomaticActive()) {
          automaticRule.snoozing=true;
        }
      }
    }
 else {
      final ZenRule newRule=new ZenRule();
      newRule.enabled=true;
      newRule.zenMode=zenMode;
      newRule.conditionId=conditionId;
      newConfig.manualRule=newRule;
    }
    setConfigLocked(newConfig,reason,setRingerMode);
  }
}
