{
  if (mConfig == null)   return false;
  if (DEBUG) {
    Log.d(TAG,"addOrUpdateAutomaticZenRule zenRule=" + automaticZenRule + " reason="+ reason);
  }
  final ZenModeConfig newConfig=mConfig.copy();
  String ruleId=findMatchingRuleId(newConfig,automaticZenRule.getName());
  ZenModeConfig.ZenRule rule=new ZenModeConfig.ZenRule();
  if (ruleId == null) {
    ruleId=newConfig.newRuleId();
    rule.id=ruleId;
    rule.creationTime=System.currentTimeMillis();
    rule.name=automaticZenRule.getName();
    rule.component=automaticZenRule.getOwner();
  }
 else {
    rule=newConfig.automaticRules.get(ruleId);
    if (!canManageAutomaticZenRule(rule)) {
      throw new SecurityException("Cannot update rules not owned by your condition provider");
    }
  }
  if (rule.enabled != automaticZenRule.isEnabled()) {
    rule.snoozing=false;
  }
  rule.condition=null;
  rule.conditionId=automaticZenRule.getConditionId();
  rule.enabled=automaticZenRule.isEnabled();
  rule.zenMode=NotificationManager.zenModeFromInterruptionFilter(automaticZenRule.getInterruptionFilter(),Global.ZEN_MODE_OFF);
  newConfig.automaticRules.put(ruleId,rule);
  return setConfig(newConfig,reason,true);
}
