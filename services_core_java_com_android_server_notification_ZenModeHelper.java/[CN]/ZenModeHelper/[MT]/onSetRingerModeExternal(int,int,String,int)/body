{
  int ringerModeInternalOut=ringerModeNew;
  final boolean isChange=ringerModeOld != ringerModeNew;
  final boolean isVibrate=ringerModeInternal == AudioManager.RINGER_MODE_VIBRATE;
  int newZen=-1;
switch (ringerModeNew) {
case AudioManager.RINGER_MODE_SILENT:
    if (isChange) {
      if (mZenMode == Global.ZEN_MODE_OFF) {
        newZen=Global.ZEN_MODE_IMPORTANT_INTERRUPTIONS;
      }
      ringerModeInternalOut=isVibrate ? AudioManager.RINGER_MODE_VIBRATE : AudioManager.RINGER_MODE_NORMAL;
    }
 else {
      ringerModeInternalOut=ringerModeInternal;
    }
  break;
case AudioManager.RINGER_MODE_VIBRATE:
case AudioManager.RINGER_MODE_NORMAL:
if (mZenMode != Global.ZEN_MODE_OFF) {
  newZen=Global.ZEN_MODE_OFF;
}
break;
}
if (newZen != -1) {
setZenMode(newZen,"ringerModeExternal",false);
}
ZenLog.traceSetRingerModeExternal(ringerModeOld,ringerModeNew,caller,ringerModeInternal,ringerModeInternalOut);
return ringerModeInternalOut;
}
