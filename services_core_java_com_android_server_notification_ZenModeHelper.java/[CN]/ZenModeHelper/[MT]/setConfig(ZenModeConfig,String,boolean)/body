{
  if (config == null || !config.isValid()) {
    Log.w(TAG,"Invalid config in setConfig; " + config);
    return false;
  }
  mConditions.evaluateConfig(config);
  if (config.equals(mConfig))   return true;
  if (DEBUG)   Log.d(TAG,"setConfig reason=" + reason,new Throwable());
  ZenLog.traceConfig(reason,config);
  final boolean policyChanged=!Objects.equals(getNotificationPolicy(mConfig),getNotificationPolicy(config));
  mConfig=config;
  dispatchOnConfigChanged();
  if (policyChanged) {
    dispatchOnPolicyChanged();
  }
  final String val=Integer.toString(mConfig.hashCode());
  Global.putString(mContext.getContentResolver(),Global.ZEN_MODE_CONFIG_ETAG,val);
  if (!evaluateZenMode(reason,setRingerMode)) {
    applyRestrictions();
  }
  return true;
}
