{
  final int oldMode=mZenMode;
  final int newMode=Global.getInt(mContext.getContentResolver(),Global.ZEN_MODE,Global.ZEN_MODE_OFF);
  if (oldMode != newMode) {
    ZenLog.traceUpdateZenMode(oldMode,newMode);
  }
  mZenMode=newMode;
  final boolean zen=mZenMode != Global.ZEN_MODE_OFF;
  final String[] exceptionPackages=null;
  final boolean muteCalls=zen && !mConfig.allowCalls;
  mAppOps.setRestriction(AppOpsManager.OP_VIBRATE,USAGE_NOTIFICATION_RINGTONE,muteCalls ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  mAppOps.setRestriction(AppOpsManager.OP_PLAY_AUDIO,USAGE_NOTIFICATION_RINGTONE,muteCalls ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  final boolean muteAlarms=mZenMode == Global.ZEN_MODE_NO_INTERRUPTIONS;
  mAppOps.setRestriction(AppOpsManager.OP_VIBRATE,USAGE_ALARM,muteAlarms ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  mAppOps.setRestriction(AppOpsManager.OP_PLAY_AUDIO,USAGE_ALARM,muteAlarms ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  onZenUpdated(oldMode,newMode);
  dispatchOnZenModeChanged();
}
