{
  final long identity=Binder.clearCallingIdentity();
  try {
    if (config == null || !config.isValid()) {
      Log.w(TAG,"Invalid config in setConfigLocked; " + config);
      return false;
    }
    if (config.user != mUser) {
      mConfigs.put(config.user,config);
      if (DEBUG)       Log.d(TAG,"setConfigLocked: store config for user " + config.user);
      return true;
    }
    mConditions.evaluateConfig(config,false);
    mConfigs.put(config.user,config);
    if (DEBUG)     Log.d(TAG,"setConfigLocked reason=" + reason,new Throwable());
    ZenLog.traceConfig(reason,mConfig,config);
    final boolean policyChanged=!Objects.equals(getNotificationPolicy(mConfig),getNotificationPolicy(config));
    if (!config.equals(mConfig)) {
      dispatchOnConfigChanged();
    }
    if (policyChanged) {
      dispatchOnPolicyChanged();
    }
    mConfig=config;
    mHandler.postApplyConfig(config,reason,setRingerMode);
    return true;
  }
  finally {
    Binder.restoreCallingIdentity(identity);
  }
}
