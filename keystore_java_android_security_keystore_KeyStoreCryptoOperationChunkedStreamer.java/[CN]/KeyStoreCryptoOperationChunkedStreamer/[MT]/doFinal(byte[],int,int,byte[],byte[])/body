{
  if (inputLength == 0) {
    input=EmptyArray.BYTE;
    inputOffset=0;
  }
  byte[] output=update(input,inputOffset,inputLength);
  output=ArrayUtils.concat(output,flush());
  OperationResult opResult=mKeyStoreStream.finish(signature,additionalEntropy);
  if (opResult == null) {
    throw new KeyStoreConnectException();
  }
 else   if (opResult.resultCode != KeyStore.NO_ERROR) {
    throw KeyStore.getKeyStoreException(opResult.resultCode);
  }
  mProducedOutputSizeBytes+=opResult.output.length;
  return ArrayUtils.concat(output,opResult.output);
}
