{
  super(context,attrs,defStyleAttr,defStyleRes);
  TypedArray attributesArray=context.obtainStyledAttributes(attrs,R.styleable.ActivityChooserView,defStyleAttr,defStyleRes);
  mInitialActivityCount=attributesArray.getInt(R.styleable.ActivityChooserView_initialActivityCount,ActivityChooserViewAdapter.MAX_ACTIVITY_COUNT_DEFAULT);
  Drawable expandActivityOverflowButtonDrawable=attributesArray.getDrawable(R.styleable.ActivityChooserView_expandActivityOverflowButtonDrawable);
  attributesArray.recycle();
  LayoutInflater inflater=LayoutInflater.from(mContext);
  inflater.inflate(R.layout.activity_chooser_view,this,true);
  mCallbacks=new Callbacks();
  mActivityChooserContent=(LinearLayout)findViewById(R.id.activity_chooser_view_content);
  mActivityChooserContentBackground=mActivityChooserContent.getBackground();
  mDefaultActivityButton=(FrameLayout)findViewById(R.id.default_activity_button);
  mDefaultActivityButton.setOnClickListener(mCallbacks);
  mDefaultActivityButton.setOnLongClickListener(mCallbacks);
  mDefaultActivityButtonImage=(ImageView)mDefaultActivityButton.findViewById(R.id.image);
  final FrameLayout expandButton=(FrameLayout)findViewById(R.id.expand_activities_button);
  expandButton.setOnClickListener(mCallbacks);
  expandButton.setAccessibilityDelegate(new AccessibilityDelegate(){
    @Override public void onInitializeAccessibilityNodeInfo(    View host,    AccessibilityNodeInfo info){
      super.onInitializeAccessibilityNodeInfo(host,info);
      info.setCanOpenPopup(true);
    }
  }
);
  expandButton.setOnTouchListener(new ForwardingListener(expandButton){
    @Override public ShowableListMenu getPopup(){
      return getListPopupWindow();
    }
    @Override protected boolean onForwardingStarted(){
      showPopup();
      return true;
    }
    @Override protected boolean onForwardingStopped(){
      dismissPopup();
      return true;
    }
  }
);
  mExpandActivityOverflowButton=expandButton;
  mExpandActivityOverflowButtonImage=(ImageView)expandButton.findViewById(R.id.image);
  mExpandActivityOverflowButtonImage.setImageDrawable(expandActivityOverflowButtonDrawable);
  mAdapter=new ActivityChooserViewAdapter();
  mAdapter.registerDataSetObserver(new DataSetObserver(){
    @Override public void onChanged(){
      super.onChanged();
      updateAppearance();
    }
  }
);
  Resources resources=context.getResources();
  mListPopupMaxWidth=Math.max(resources.getDisplayMetrics().widthPixels / 2,resources.getDimensionPixelSize(com.android.internal.R.dimen.config_prefDialogWidth));
}
