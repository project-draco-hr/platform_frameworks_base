{
  if (src == null) {
    throw new NullPointerException(Messages.getString("awt.259"));
  }
  if (src == dst) {
    throw new IllegalArgumentException(Messages.getString("awt.25A"));
  }
  ColorModel srcCM=src.getColorModel();
  BufferedImage finalDst=null;
  if (srcCM instanceof IndexColorModel) {
    src=((IndexColorModel)srcCM).convertToIntDiscrete(src.getRaster(),true);
    srcCM=src.getColorModel();
  }
  if (dst == null) {
    dst=createCompatibleDestImage(src,srcCM);
  }
 else {
    if (!srcCM.equals(dst.getColorModel())) {
      if (!((src.getType() == BufferedImage.TYPE_INT_RGB || src.getType() == BufferedImage.TYPE_INT_ARGB) && (dst.getType() == BufferedImage.TYPE_INT_RGB || dst.getType() == BufferedImage.TYPE_INT_ARGB))) {
        finalDst=dst;
        dst=createCompatibleDestImage(src,srcCM);
      }
    }
  }
  if (slowFilter(src.getRaster(),dst.getRaster()) != 0) {
    throw new ImagingOpException(Messages.getString("awt.21F"));
  }
  if (finalDst != null) {
    Graphics2D g=finalDst.createGraphics();
    g.setComposite(AlphaComposite.Src);
    g.drawImage(dst,0,0,null);
  }
 else {
    finalDst=dst;
  }
  return finalDst;
}
