{
  int widthMode=MeasureSpec.getMode(widthMeasureSpec);
  int widthSize=MeasureSpec.getSize(widthMeasureSpec);
  if (widthMode == MeasureSpec.UNSPECIFIED) {
    setNumColumns(AUTO_FIT);
  }
 else {
    int columnWidth=Math.max(1,getRequestedColumnWidth());
    int itemCount=getAdapter() == null ? 0 : getAdapter().getCount();
    int numColumns=Math.max(1,Math.min(itemCount,widthSize / columnWidth));
    setNumColumns(numColumns);
  }
  super.onMeasure(widthMeasureSpec,heightMeasureSpec);
}
