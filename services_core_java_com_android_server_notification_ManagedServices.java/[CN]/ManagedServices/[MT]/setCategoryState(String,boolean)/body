{
synchronized (mMutex) {
    final Boolean previous=mCategoryEnabled.put(category,enabled);
    if (!(previous == null || previous != enabled)) {
      return;
    }
    if (DEBUG) {
      Slog.d(TAG,((enabled) ? "Enabling " : "Disabling ") + "category " + category);
    }
    final int[] userIds=mUserProfiles.getCurrentProfileIds();
    for (    int userId : userIds) {
      final Set<ComponentName> componentNames=queryPackageForServices(null,userId,category);
      final ArraySet<ComponentName> userComponents=loadComponentNamesFromSetting(mConfig.secureSettingName,userId);
      if (userComponents == null) {
        componentNames.clear();
      }
 else {
        componentNames.retainAll(userComponents);
      }
      if (DEBUG) {
        Slog.d(TAG,"Components for category " + category + ": "+ componentNames);
      }
      for (      ComponentName c : componentNames) {
        if (enabled) {
          registerServiceLocked(c,userId);
        }
 else {
          unregisterServiceLocked(c,userId);
        }
      }
    }
  }
}
