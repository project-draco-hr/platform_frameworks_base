{
  mContext.callerPermissions.add(android.Manifest.permission.MANAGE_DEVICE_ADMINS);
  mContext.binder.callingUid=DpmMockContext.CALLER_UID;
  dpm.setActiveAdmin(admin1,false);
  assertTrue(dpm.isAdminActive(admin1));
  assertFalse(dpm.isRemovingAdmin(admin1,DpmMockContext.CALLER_USER_HANDLE));
  when(mContext.userManager.isUserUnlocked(eq(DpmMockContext.CALLER_USER_HANDLE))).thenReturn(false);
  try {
    dpm.removeActiveAdmin(admin1);
    fail("Didn't throw IllegalStateException");
  }
 catch (  IllegalStateException expected) {
    MoreAsserts.assertContainsRegex("User must be running and unlocked",expected.getMessage());
  }
  assertFalse(dpm.isRemovingAdmin(admin1,DpmMockContext.CALLER_USER_HANDLE));
  when(mContext.userManager.isUserUnlocked(eq(DpmMockContext.CALLER_USER_HANDLE))).thenReturn(true);
  dpm.removeActiveAdmin(admin1);
  assertTrue(dpm.isRemovingAdmin(admin1,DpmMockContext.CALLER_USER_HANDLE));
}
