{
  final long ident=mContext.binder.clearCallingIdentity();
  try {
    LocalServices.removeServiceForTest(DevicePolicyManagerInternal.class);
    dpms=new DevicePolicyManagerServiceTestable(mContext,dataDir);
    dpms.systemReady(SystemService.PHASE_LOCK_SETTINGS_READY);
    dpms.systemReady(SystemService.PHASE_BOOT_COMPLETED);
    dpm=new DevicePolicyManagerTestable(mContext,dpms);
  }
  finally {
    mContext.binder.restoreCallingIdentity(ident);
  }
}
