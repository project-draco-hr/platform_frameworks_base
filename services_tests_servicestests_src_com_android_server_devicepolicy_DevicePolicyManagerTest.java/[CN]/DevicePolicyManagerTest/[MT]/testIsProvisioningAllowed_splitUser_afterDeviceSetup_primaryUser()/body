{
  when(mContext.ipackageManager.hasSystemFeature(PackageManager.FEATURE_MANAGED_USERS,0)).thenReturn(true);
  when(mContext.userManagerForMock.isSplitSystemUser()).thenReturn(true);
  when(mContext.userManager.canAddMoreManagedProfiles(DpmMockContext.CALLER_USER_HANDLE,true)).thenReturn(true);
  setUserSetupCompleteForUser(true,DpmMockContext.CALLER_USER_HANDLE);
  mContext.binder.callingUid=DpmMockContext.CALLER_UID;
  assertProvisioningAllowed(DevicePolicyManager.ACTION_PROVISION_MANAGED_DEVICE,true);
  assertProvisioningAllowed(DevicePolicyManager.ACTION_PROVISION_MANAGED_PROFILE,true);
  assertProvisioningAllowed(DevicePolicyManager.ACTION_PROVISION_MANAGED_SHAREABLE_DEVICE,true);
  assertProvisioningAllowed(DevicePolicyManager.ACTION_PROVISION_MANAGED_USER,false);
}
