{
  Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
  int pollingCount=0;
  while (!Thread.interrupted()) {
    final int[] deviceIds=mManager.getOpenedDeviceIds();
    if (deviceIds.length == 0) {
      return;
    }
    boolean changed=false;
    for (    int deviceId : deviceIds) {
      try {
        final MtpRoot[] roots=mManager.getRoots(deviceId);
        mDatabase.startAddingRootDocuments(deviceId);
        try {
          if (mDatabase.putRootDocuments(deviceId,mResources,roots)) {
            changed=true;
          }
        }
  finally {
          if (mDatabase.stopAddingRootDocuments(deviceId)) {
            changed=true;
          }
        }
      }
 catch (      IOException|SQLiteException exception) {
        Log.e(MtpDocumentsProvider.TAG,exception.getMessage());
      }
    }
    if (changed) {
      notifyChange();
    }
    pollingCount++;
    try {
      Thread.sleep(pollingCount > SHORT_POLLING_TIMES ? LONG_POLLING_INTERVAL : SHORT_POLLING_INTERVAL);
    }
 catch (    InterruptedException exp) {
      continue;
    }
  }
}
