{
  Intent intent=new Intent(Intent.ACTION_WEB_SEARCH);
  PackageManager pm=context.getPackageManager();
  ResolveInfo ri=pm.resolveActivity(intent,PackageManager.MATCH_DEFAULT_ONLY);
  if (ri == null || ri.activityInfo.name.equals(ResolverActivity.class.getName())) {
    Log.d(LOG_TAG,"No preferred activity set for action web search.");
    String[] preferredActivities=context.getResources().getStringArray(com.android.internal.R.array.default_web_search_providers);
    for (    String componentName : preferredActivities) {
      ComponentName component=ComponentName.unflattenFromString(componentName);
      if (setPreferredActivity(context,component,Intent.ACTION_WEB_SEARCH)) {
        return component;
      }
    }
  }
 else {
    ComponentName cn=new ComponentName(ri.activityInfo.packageName,ri.activityInfo.name);
    if (cn.flattenToShortString().equals(GOOGLE_SEARCH_COMPONENT_NAME)) {
      ComponentName enhancedGoogleSearch=ComponentName.unflattenFromString(ENHANCED_GOOGLE_SEARCH_COMPONENT_NAME);
      if (setPreferredActivity(context,enhancedGoogleSearch,Intent.ACTION_WEB_SEARCH)) {
        return enhancedGoogleSearch;
      }
    }
  }
  if (ri == null)   return null;
  return new ComponentName(ri.activityInfo.packageName,ri.activityInfo.name);
}
