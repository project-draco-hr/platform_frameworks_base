{
  Uri.Builder uriBuilder=THREAD_ID_CONTENT_URI.buildUpon();
  for (  String recipient : recipients) {
    if (Mms.isEmailAddress(recipient)) {
      recipient=Mms.extractAddrSpec(recipient);
    }
    uriBuilder.appendQueryParameter("recipient",recipient);
  }
  Cursor cursor=SqliteWrapper.query(context,context.getContentResolver(),uriBuilder.build(),ID_PROJECTION,null,null,null);
  if (cursor != null) {
    try {
      if (cursor.moveToFirst()) {
        return cursor.getLong(0);
      }
    }
  finally {
      cursor.close();
    }
  }
  throw new IllegalArgumentException("Unable to find or allocate a thread ID.");
}
