{
  AppOpsManager aoManager=(AppOpsManager)mContext.getSystemService(Context.APP_OPS_SERVICE);
  List<AppOpsManager.PackageOps> appOps=aoManager.getPackagesForOps(LOCATION_OPS);
  ArrayList<Request> requests=new ArrayList<>(appOps.size());
  final long now=System.currentTimeMillis();
  final UserManager um=(UserManager)mContext.getSystemService(Context.USER_SERVICE);
  final List<UserHandle> profiles=um.getUserProfiles();
  final int appOpsN=appOps.size();
  for (int i=0; i < appOpsN; ++i) {
    AppOpsManager.PackageOps ops=appOps.get(i);
    String packageName=ops.getPackageName();
    int uid=ops.getUid();
    int userId=UserHandle.getUserId(uid);
    boolean isAndroidOs=(uid == Process.SYSTEM_UID) && ANDROID_SYSTEM_PACKAGE_NAME.equals(packageName);
    if (isAndroidOs || !profiles.contains(new UserHandle(userId))) {
      continue;
    }
    Request request=getRequestFromOps(now,ops);
    if (request != null) {
      requests.add(request);
    }
  }
  return requests;
}
