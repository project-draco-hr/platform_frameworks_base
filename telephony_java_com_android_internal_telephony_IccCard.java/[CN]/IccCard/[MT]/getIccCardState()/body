{
  if (mIccCardStatus == null) {
    Log.e(mLogTag,"[IccCard] IccCardStatus is null");
    return IccCard.State.ABSENT;
  }
  if (!mIccCardStatus.getCardState().isCardPresent()) {
    return IccCard.State.ABSENT;
  }
  RadioState currentRadioState=mPhone.mCM.getRadioState();
  if (currentRadioState == RadioState.RADIO_OFF || currentRadioState == RadioState.RADIO_UNAVAILABLE || currentRadioState == RadioState.SIM_NOT_READY || currentRadioState == RadioState.RUIM_NOT_READY || currentRadioState == RadioState.NV_NOT_READY || currentRadioState == RadioState.NV_READY) {
    return IccCard.State.NOT_READY;
  }
  if (currentRadioState == RadioState.SIM_LOCKED_OR_ABSENT || currentRadioState == RadioState.SIM_READY || currentRadioState == RadioState.RUIM_LOCKED_OR_ABSENT || currentRadioState == RadioState.RUIM_READY) {
    int index;
    if (currentRadioState == RadioState.RUIM_LOCKED_OR_ABSENT || currentRadioState == RadioState.RUIM_READY) {
      index=mIccCardStatus.getCdmaSubscriptionAppIndex();
    }
 else {
      index=mIccCardStatus.getGsmUmtsSubscriptionAppIndex();
    }
    IccCardApplication app;
    if (index >= 0 && index < IccCardStatus.CARD_MAX_APPS) {
      app=mIccCardStatus.getApplication(index);
    }
 else {
      Log.e(mLogTag,"[IccCard] Invalid Subscription Application index:" + index);
      return IccCard.State.ABSENT;
    }
    if (app == null) {
      Log.e(mLogTag,"[IccCard] Subscription Application in not present");
      return IccCard.State.ABSENT;
    }
    if (app.app_state.isPinRequired()) {
      return IccCard.State.PIN_REQUIRED;
    }
    if (app.app_state.isPukRequired()) {
      return IccCard.State.PUK_REQUIRED;
    }
    if (app.app_state.isSubscriptionPersoEnabled()) {
      return IccCard.State.NETWORK_LOCKED;
    }
    if (app.app_state.isAppReady()) {
      return IccCard.State.READY;
    }
    if (app.app_state.isAppNotReady()) {
      return IccCard.State.NOT_READY;
    }
    return IccCard.State.NOT_READY;
  }
  return IccCard.State.ABSENT;
}
