{
synchronized (this) {
    if (mClassLoader != null) {
      return mClassLoader;
    }
    if (mIncludeCode && !mPackageName.equals("android")) {
      String zip=mAppDir;
      String instrumentationAppDir=mActivityThread.mInstrumentationAppDir;
      String instrumentationAppPackage=mActivityThread.mInstrumentationAppPackage;
      String instrumentedAppDir=mActivityThread.mInstrumentedAppDir;
      String[] instrumentationLibs=null;
      if (mAppDir.equals(instrumentationAppDir) || mAppDir.equals(instrumentedAppDir)) {
        zip=instrumentationAppDir + ":" + instrumentedAppDir;
        if (!instrumentedAppDir.equals(instrumentationAppDir)) {
          instrumentationLibs=getLibrariesFor(instrumentationAppPackage);
        }
      }
      if ((mSharedLibraries != null) || (instrumentationLibs != null)) {
        zip=combineLibs(mSharedLibraries,instrumentationLibs) + ':' + zip;
      }
      if (localLOGV)       Log.v(TAG,"Class path: " + zip);
      mClassLoader=ApplicationLoaders.getDefault().getClassLoader(zip,mDataDir,mBaseClassLoader);
    }
 else {
      if (mBaseClassLoader == null) {
        mClassLoader=ClassLoader.getSystemClassLoader();
      }
 else {
        mClassLoader=mBaseClassLoader;
      }
    }
    return mClassLoader;
  }
}
