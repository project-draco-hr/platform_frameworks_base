{
  Bitmap thumbnail=null;
  try {
    int w=mThumbnailWidth;
    int h;
    if (w < 0) {
      Resources res=r.activity.getResources();
      mThumbnailHeight=h=res.getDimensionPixelSize(com.android.internal.R.dimen.thumbnail_height);
      mThumbnailWidth=w=res.getDimensionPixelSize(com.android.internal.R.dimen.thumbnail_width);
    }
 else {
      h=mThumbnailHeight;
    }
    thumbnail=Bitmap.createBitmap(w,h,Bitmap.Config.RGB_565);
    thumbnail.eraseColor(0);
    Canvas cv=new Canvas(thumbnail);
    if (!r.activity.onCreateThumbnail(thumbnail,cv)) {
      thumbnail=null;
    }
  }
 catch (  Exception e) {
    if (!mInstrumentation.onException(r.activity,e)) {
      throw new RuntimeException("Unable to create thumbnail of " + r.intent.getComponent().toShortString() + ": "+ e.toString(),e);
    }
    thumbnail=null;
  }
  return thumbnail;
}
