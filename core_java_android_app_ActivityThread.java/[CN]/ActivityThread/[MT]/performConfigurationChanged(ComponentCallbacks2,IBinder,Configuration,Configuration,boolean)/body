{
  Activity activity=(cb instanceof Activity) ? (Activity)cb : null;
  if (activity != null) {
    activity.mCalled=false;
  }
  boolean shouldChangeConfig=false;
  if ((activity == null) || (activity.mCurrentConfig == null)) {
    shouldChangeConfig=true;
  }
 else {
    int diff=activity.mCurrentConfig.diff(newConfig);
    if (diff != 0) {
      shouldChangeConfig=true;
    }
  }
  if (DEBUG_CONFIGURATION) {
    Slog.v(TAG,"Config callback " + cb + ": shouldChangeConfig="+ shouldChangeConfig);
  }
  if (shouldChangeConfig) {
    if (activityToken != null) {
      mResourcesManager.updateResourcesForActivity(activityToken,overrideConfig);
    }
    if (reportToActivity) {
      Configuration configToReport=newConfig;
      if (cb instanceof ContextThemeWrapper) {
        ContextThemeWrapper contextThemeWrapper=(ContextThemeWrapper)cb;
        final Configuration localOverrideConfig=contextThemeWrapper.getOverrideConfiguration();
        if (localOverrideConfig != null) {
          configToReport=new Configuration(newConfig);
          configToReport.updateFrom(localOverrideConfig);
        }
      }
      cb.onConfigurationChanged(configToReport);
    }
    if (activity != null) {
      if (reportToActivity && !activity.mCalled) {
        throw new SuperNotCalledException("Activity " + activity.getLocalClassName() + " did not call through to super.onConfigurationChanged()");
      }
      activity.mConfigChangeFlags=0;
      activity.mCurrentConfig=new Configuration(newConfig);
    }
  }
}
