{
  Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,"ActivityThreadMain");
  SamplingProfilerIntegration.start();
  CloseGuard.setEnabled(false);
  Environment.initForCurrentUser();
  EventLogger.setReporter(new EventLoggingReporter());
  final File configDir=Environment.getUserConfigDirectory(UserHandle.myUserId());
  TrustedCertificateStore.setDefaultUserDirectory(configDir);
  Process.setArgV0("<pre-initialized>");
  Looper.prepareMainLooper();
  ActivityThread thread=new ActivityThread();
  thread.attach(false);
  if (sMainThreadHandler == null) {
    sMainThreadHandler=thread.getHandler();
  }
  if (false) {
    Looper.myLooper().setMessageLogging(new LogPrinter(Log.DEBUG,"ActivityThread"));
  }
  Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
  Looper.loop();
  throw new RuntimeException("Main thread loop unexpectedly exited");
}
