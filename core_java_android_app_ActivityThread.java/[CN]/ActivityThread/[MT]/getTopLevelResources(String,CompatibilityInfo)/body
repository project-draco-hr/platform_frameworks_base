{
  ResourcesKey key=new ResourcesKey(resDir,compInfo.applicationScale);
  Resources r;
synchronized (mPackages) {
    if (false) {
      Slog.w(TAG,"getTopLevelResources: " + resDir + " / "+ compInfo.applicationScale);
    }
    WeakReference<Resources> wr=mActiveResources.get(key);
    r=wr != null ? wr.get() : null;
    if (r != null && r.getAssets().isUpToDate()) {
      if (false) {
        Slog.w(TAG,"Returning cached resources " + r + " "+ resDir+ ": appScale="+ r.getCompatibilityInfo().applicationScale);
      }
      return r;
    }
  }
  AssetManager assets=new AssetManager();
  if (assets.addAssetPath(resDir) == 0) {
    return null;
  }
  DisplayMetrics metrics=getDisplayMetricsLocked(compInfo,false);
  r=new Resources(assets,metrics,getConfiguration(),compInfo);
  if (false) {
    Slog.i(TAG,"Created app resources " + resDir + " "+ r+ ": "+ r.getConfiguration()+ " appScale="+ r.getCompatibilityInfo().applicationScale);
  }
synchronized (mPackages) {
    WeakReference<Resources> wr=mActiveResources.get(key);
    Resources existing=wr != null ? wr.get() : null;
    if (existing != null && existing.getAssets().isUpToDate()) {
      r.getAssets().close();
      return existing;
    }
    mActiveResources.put(key,new WeakReference<Resources>(r));
    return r;
  }
}
