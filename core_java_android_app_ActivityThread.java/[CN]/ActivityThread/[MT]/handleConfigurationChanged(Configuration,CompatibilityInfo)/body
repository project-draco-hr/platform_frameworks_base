{
  int configDiff=0;
synchronized (mResourcesManager) {
    if (mPendingConfiguration != null) {
      if (!mPendingConfiguration.isOtherSeqNewer(config)) {
        config=mPendingConfiguration;
        mCurDefaultDisplayDpi=config.densityDpi;
        updateDefaultDensity();
      }
      mPendingConfiguration=null;
    }
    if (config == null) {
      return;
    }
    if (DEBUG_CONFIGURATION)     Slog.v(TAG,"Handle configuration changed: " + config);
    mResourcesManager.applyConfigurationToResourcesLocked(config,compat);
    updateLocaleListFromAppContext(mInitialApplication.getApplicationContext(),mResourcesManager.getConfiguration().getLocales());
    if (mConfiguration == null) {
      mConfiguration=new Configuration();
    }
    if (!mConfiguration.isOtherSeqNewer(config) && compat == null) {
      return;
    }
    configDiff=mConfiguration.updateFrom(config);
    config=applyCompatConfiguration(mCurDefaultDisplayDpi);
    final Theme systemTheme=getSystemContext().getTheme();
    if ((systemTheme.getChangingConfigurations() & configDiff) != 0) {
      systemTheme.rebase();
    }
  }
  ArrayList<ComponentCallbacks2> callbacks=collectComponentCallbacks(false,config);
  freeTextLayoutCachesIfNeeded(configDiff);
  if (callbacks != null) {
    final int N=callbacks.size();
    for (int i=0; i < N; i++) {
      ComponentCallbacks2 cb=callbacks.get(i);
      if (cb instanceof Activity) {
        Activity a=(Activity)cb;
        performConfigurationChangedForActivity(mActivities.get(a.getActivityToken()),config,REPORT_TO_ACTIVITY);
      }
 else {
        performConfigurationChanged(cb,null,config,null,REPORT_TO_ACTIVITY);
      }
    }
  }
}
