{
synchronized (mPackages) {
    WeakReference<Resources> wr=mActiveResources.get(appDir);
    Resources r=wr != null ? wr.get() : null;
    if (r != null && r.getAssets().isUpToDate()) {
      return r;
    }
    AssetManager assets=new AssetManager();
    if (assets.addAssetPath(appDir) == 0) {
      return null;
    }
    DisplayMetrics metrics=getDisplayMetricsLocked(false);
    boolean usePreloaded=true;
    if (applicationScale != 1.0f) {
      usePreloaded=false;
      DisplayMetrics newMetrics=new DisplayMetrics();
      newMetrics.setTo(metrics);
      float newDensity=metrics.density / applicationScale;
      newMetrics.updateDensity(newDensity);
      metrics=newMetrics;
    }
    r=new Resources(assets,metrics,getConfiguration(),usePreloaded);
    mActiveResources.put(appDir,new WeakReference<Resources>(r));
    return r;
  }
}
