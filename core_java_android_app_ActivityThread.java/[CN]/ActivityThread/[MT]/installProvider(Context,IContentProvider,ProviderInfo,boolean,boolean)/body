{
  ContentProvider localProvider=null;
  if (provider == null) {
    if (noisy) {
      Slog.d(TAG,"Loading provider " + info.authority + ": "+ info.name);
    }
    Context c=null;
    ApplicationInfo ai=info.applicationInfo;
    if (context.getPackageName().equals(ai.packageName)) {
      c=context;
    }
 else     if (mInitialApplication != null && mInitialApplication.getPackageName().equals(ai.packageName)) {
      c=mInitialApplication;
    }
 else {
      try {
        c=context.createPackageContext(ai.packageName,Context.CONTEXT_INCLUDE_CODE);
      }
 catch (      PackageManager.NameNotFoundException e) {
      }
    }
    if (c == null) {
      Slog.w(TAG,"Unable to get context for package " + ai.packageName + " while loading content provider "+ info.name);
      return null;
    }
    try {
      final java.lang.ClassLoader cl=c.getClassLoader();
      localProvider=(ContentProvider)cl.loadClass(info.name).newInstance();
      provider=localProvider.getIContentProvider();
      if (provider == null) {
        Slog.e(TAG,"Failed to instantiate class " + info.name + " from sourceDir "+ info.applicationInfo.sourceDir);
        return null;
      }
      if (false)       Slog.v(TAG,"Instantiating local provider " + info.name);
      localProvider.attachInfo(c,info);
    }
 catch (    java.lang.Exception e) {
      if (!mInstrumentation.onException(null,e)) {
        throw new RuntimeException("Unable to get provider " + info.name + ": "+ e.toString(),e);
      }
      return null;
    }
  }
 else   if (localLOGV) {
    Slog.v(TAG,"Installing external provider " + info.authority + ": "+ info.name);
  }
synchronized (mProviderMap) {
    IBinder jBinder=provider.asBinder();
    String names[]=PATTERN_SEMICOLON.split(info.authority);
    for (int i=0; i < names.length; i++) {
      ProviderClientRecord pr=mProviderMap.get(names[i]);
      if (pr != null) {
        if (localLOGV) {
          Slog.v(TAG,"installProvider: lost the race, " + "using existing named provider");
        }
        provider=pr.mProvider;
      }
 else {
        pr=new ProviderClientRecord(names[i],provider,localProvider);
        if (localProvider == null) {
          try {
            jBinder.linkToDeath(pr,0);
          }
 catch (          RemoteException e) {
            return null;
          }
        }
        mProviderMap.put(names[i],pr);
      }
    }
    if (localProvider != null) {
      ProviderClientRecord pr=mLocalProviders.get(jBinder);
      if (pr != null) {
        if (localLOGV) {
          Slog.v(TAG,"installProvider: lost the race, " + "using existing local provider");
        }
        provider=pr.mProvider;
      }
 else {
        pr=new ProviderClientRecord(null,provider,localProvider);
        mLocalProviders.put(jBinder,pr);
      }
    }
    if (!noReleaseNeeded) {
      ProviderRefCount prc=mProviderRefCountMap.get(jBinder);
      if (prc != null) {
        if (localLOGV) {
          Slog.v(TAG,"installProvider: lost the race, incrementing ref count");
        }
        prc.count+=1;
        if (prc.count == 1) {
          if (localLOGV) {
            Slog.v(TAG,"installProvider: " + "snatched provider from the jaws of death");
          }
          mH.removeMessages(H.REMOVE_PROVIDER,provider);
        }
      }
 else {
        mProviderRefCountMap.put(jBinder,new ProviderRefCount(1));
      }
    }
  }
  return provider;
}
