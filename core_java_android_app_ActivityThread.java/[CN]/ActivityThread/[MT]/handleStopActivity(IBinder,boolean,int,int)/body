{
  ActivityClientRecord r=mActivities.get(token);
  if (!checkAndUpdateLifecycleSeq(seq,r,"stopActivity")) {
    return;
  }
  r.activity.mConfigChangeFlags|=configChanges;
  StopInfo info=new StopInfo();
  performStopActivityInner(r,info,show,true,"handleStopActivity");
  if (localLOGV)   Slog.v(TAG,"Finishing stop of " + r + ": show="+ show+ " win="+ r.window);
  updateVisibility(r,show);
  if (!r.isPreHoneycomb()) {
    QueuedWork.waitToFinish();
  }
  info.activity=r;
  info.state=r.state;
  info.persistentState=r.persistentState;
  mH.post(info);
  mSomeActivitiesChanged=true;
}
