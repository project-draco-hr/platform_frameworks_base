{
  if (inputLength > 0) {
    mConsumedInputSizeBytes+=inputLength;
    mInputBuffer.write(input,inputOffset,inputLength);
  }
  byte[] bufferedInput=mInputBuffer.toByteArray();
  mInputBuffer.reset();
  byte[] paddedInput;
  if (bufferedInput.length < mModulusSizeBytes) {
    paddedInput=new byte[mModulusSizeBytes];
    System.arraycopy(bufferedInput,0,paddedInput,paddedInput.length - bufferedInput.length,bufferedInput.length);
  }
 else {
    throw new KeyStoreException(KeymasterDefs.KM_ERROR_INVALID_ARGUMENT,"Message size (" + bufferedInput.length + " bytes) must be smaller than"+ " modulus ("+ mModulusSizeBytes+ " bytes)");
  }
  return mDelegate.doFinal(paddedInput,0,paddedInput.length,signature,additionalEntropy);
}
