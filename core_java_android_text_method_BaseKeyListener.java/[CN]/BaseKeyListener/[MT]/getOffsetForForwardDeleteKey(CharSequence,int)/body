{
  final int len=text.length();
  if (offset >= len - 1) {
    return len;
  }
  int codePoint=Character.codePointAt(text,offset);
  offset+=Character.charCount(codePoint);
  if (offset == len) {
    return len;
  }
  return adjustReplacementSpan(text,offset,false);
}
