{
  if (!(attrs instanceof BridgeXmlBlockParser)) {
    return null;
  }
  BridgeXmlBlockParser parser=((BridgeXmlBlockParser)attrs);
  Object viewKey=parser.getViewCookie();
  if (viewKey == null) {
    int currentDepth=parser.getDepth();
    BridgeXmlBlockParser previousParser=bc.getPreviousParser();
    if (previousParser != null) {
      int testDepth=isInMerge ? 2 : 1;
      if (currentDepth == testDepth) {
        viewKey=previousParser.getViewCookie();
        if (viewKey != null && isInMerge) {
          viewKey=new MergeCookie(viewKey);
        }
      }
    }
 else     if (resourceReference != null && currentDepth == 1) {
      viewKey=resourceReference;
    }
  }
  return viewKey;
}
