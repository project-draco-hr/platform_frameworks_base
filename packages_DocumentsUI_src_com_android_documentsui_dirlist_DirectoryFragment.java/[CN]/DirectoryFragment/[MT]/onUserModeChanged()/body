{
  final ContentResolver resolver=getActivity().getContentResolver();
  final State state=getDisplayState(this);
  final RootInfo root=getArguments().getParcelable(EXTRA_ROOT);
  final DocumentInfo doc=getArguments().getParcelable(EXTRA_DOC);
  if (root != null && doc != null) {
    final Uri stateUri=RecentsProvider.buildState(root.authority,root.rootId,doc.documentId);
    final ContentValues values=new ContentValues();
    values.put(StateColumns.MODE,state.userMode);
    new AsyncTask<Void,Void,Void>(){
      @Override protected Void doInBackground(      Void... params){
        resolver.insert(stateUri,values);
        return null;
      }
    }
.execute();
  }
  state.derivedMode=state.userMode;
  ((BaseActivity)getActivity()).onStateChanged();
  updateDisplayState();
}
