{
  super.onActivityCreated(savedInstanceState);
  final Context context=getActivity();
  final State state=getDisplayState();
  Bundle args=savedInstanceState == null ? getArguments() : savedInstanceState;
  mRoot=args.getParcelable(Shared.EXTRA_ROOT);
  mDocument=args.getParcelable(Shared.EXTRA_DOC);
  mStateKey=buildStateKey(mRoot,mDocument);
  mQuery=args.getString(Shared.EXTRA_QUERY);
  mType=args.getInt(Shared.EXTRA_TYPE);
  final Selection selection=args.getParcelable(Shared.EXTRA_SELECTION);
  mSelection=selection != null ? selection : new Selection();
  mSearchMode=args.getBoolean(Shared.EXTRA_SEARCH_MODE);
  mIconHelper=new IconHelper(context,MODE_GRID);
  mAdapter=new SectionBreakDocumentsAdapterWrapper(this,new ModelBackedDocumentsAdapter(this,mIconHelper));
  mRecView.setAdapter(mAdapter);
  mLayout=new GridLayoutManager(getContext(),mColumnCount);
  SpanSizeLookup lookup=mAdapter.createSpanSizeLookup();
  if (lookup != null) {
    mLayout.setSpanSizeLookup(lookup);
  }
  mRecView.setLayoutManager(mLayout);
  mGestureDetector=new ListeningGestureDetector(this.getContext(),mDragHelper,new GestureListener());
  mRecView.addOnItemTouchListener(mGestureDetector);
  mSelectionManager=new MultiSelectManager(mRecView,mAdapter,state.allowMultiple ? MultiSelectManager.MODE_MULTIPLE : MultiSelectManager.MODE_SINGLE,null);
  mSelectionManager.addCallback(new SelectionModeListener());
  mModel=new Model();
  mModel.addUpdateListener(mAdapter);
  mModel.addUpdateListener(mModelUpdateListener);
  mFocusManager=new FocusManager(context,mRecView,mModel);
  mTuner=FragmentTuner.pick(getContext(),state);
  mClipper=new DocumentClipper(context);
  final ActivityManager am=(ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);
  boolean svelte=am.isLowRamDevice() && (mType == TYPE_RECENT_OPEN);
  mIconHelper.setThumbnailsEnabled(!svelte);
  getLoaderManager().restartLoader(LOADER_ID,null,this);
}
