{
  final State state=getDisplayState();
  final LayoutInflater inflater=LayoutInflater.from(getContext());
  View item=null;
switch (state.derivedMode) {
case MODE_GRID:
    item=inflater.inflate(R.layout.item_doc_grid,parent,false);
  break;
case MODE_LIST:
item=inflater.inflate(R.layout.item_doc_list,parent,false);
break;
case MODE_UNKNOWN:
default :
throw new IllegalStateException("Unsupported layout mode.");
}
DocumentHolder holder=new DocumentHolder(item);
holder.addClickListener(mItemClickListener);
holder.addOnKeyListener(mSelectionManager);
return holder;
}
