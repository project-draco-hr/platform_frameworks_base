{
  if (event.getAction() != KeyEvent.ACTION_DOWN) {
    return false;
  }
  if (mFocusManager.handleKey(doc,keyCode,event)) {
    if (shouldExtendSelection(event)) {
      if (!mSelectionManager.isRangeSelectionActive()) {
        mSelectionManager.startRangeSelection(doc.getAdapterPosition());
      }
      mSelectionManager.snapRangeSelection(mFocusManager.getFocusPosition());
    }
 else {
      mSelectionManager.endRangeSelection();
    }
    return true;
  }
  if (keyCode == KeyEvent.KEYCODE_ENTER) {
    if (event.isShiftPressed()) {
      return onSelect(doc);
    }
 else {
      return onActivate(doc);
    }
  }
  return false;
}
