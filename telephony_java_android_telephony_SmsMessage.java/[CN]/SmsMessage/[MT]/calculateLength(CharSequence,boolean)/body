{
  int activePhone=TelephonyManager.getDefault().getPhoneType();
  int ret[]=new int[4];
  int septets=(PHONE_TYPE_CDMA == activePhone) ? com.android.internal.telephony.cdma.SmsMessage.calc7bitEncodedLength(msgBody,use7bitOnly) : com.android.internal.telephony.gsm.SmsMessage.calc7bitEncodedLength(msgBody,use7bitOnly);
  if (septets != -1) {
    ret[1]=septets;
    if (septets > MAX_USER_DATA_SEPTETS) {
      ret[0]=(septets / MAX_USER_DATA_SEPTETS_WITH_HEADER) + 1;
      ret[2]=MAX_USER_DATA_SEPTETS_WITH_HEADER - (septets % MAX_USER_DATA_SEPTETS_WITH_HEADER);
    }
 else {
      ret[0]=1;
      ret[2]=MAX_USER_DATA_SEPTETS - septets;
    }
    ret[3]=ENCODING_7BIT;
  }
 else {
    int octets=msgBody.length() * 2;
    ret[1]=msgBody.length();
    if (octets > MAX_USER_DATA_BYTES) {
      ret[0]=(octets / MAX_USER_DATA_BYTES_WITH_HEADER) + 1;
      ret[2]=(MAX_USER_DATA_BYTES_WITH_HEADER - (octets % MAX_USER_DATA_BYTES_WITH_HEADER)) / 2;
    }
 else {
      ret[0]=1;
      ret[2]=(MAX_USER_DATA_BYTES - octets) / 2;
    }
    ret[3]=ENCODING_16BIT;
  }
  return ret;
}
