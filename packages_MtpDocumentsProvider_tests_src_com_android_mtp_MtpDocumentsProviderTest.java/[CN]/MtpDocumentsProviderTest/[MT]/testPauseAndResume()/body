{
  setupProvider(MtpDatabaseConstants.FLAG_DATABASE_IN_FILE);
  mMtpManager.addValidDevice(0);
  mProvider.openDevice(0);
  setupRoots(0,new MtpRoot[]{new MtpRoot(0,0,"Device","Storage",0,0,"")});
{
    final Cursor cursor=mProvider.queryRoots(strings(DocumentsContract.Root.COLUMN_ROOT_ID));
    cursor.moveToNext();
    assertEquals(1,cursor.getInt(0));
  }
  mProvider.shutdown();
  setupProvider(MtpDatabaseConstants.FLAG_DATABASE_IN_FILE);
{
    final Cursor cursor=mProvider.queryRoots(strings(DocumentsContract.Root.COLUMN_ROOT_ID));
    assertEquals(1,cursor.getCount());
    cursor.moveToNext();
    assertEquals(1,cursor.getInt(0));
    assertEquals(1,mMtpManager.getOpenedDeviceIds().length);
  }
}
