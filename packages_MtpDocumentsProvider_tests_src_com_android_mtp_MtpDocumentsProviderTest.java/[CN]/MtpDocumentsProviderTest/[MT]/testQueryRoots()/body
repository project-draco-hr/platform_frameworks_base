{
  final ContentResolver resolver=new ContentResolver();
  final MtpDocumentsProvider provider=new MtpDocumentsProvider();
  final MtpManagerMock mtpManager=new MtpManagerMock(getContext());
  mtpManager.addValidDevice(0);
  mtpManager.addValidDevice(1);
  mtpManager.setRoots(0,new MtpRoot[]{new MtpRoot(1,"Storage A",1024,2048,"")});
  mtpManager.setRoots(1,new MtpRoot[]{new MtpRoot(1,"Storage B",2048,4096,"Identifier B")});
  provider.onCreateForTesting(mtpManager,resolver);
  assertEquals(0,provider.queryRoots(null).getCount());
{
    provider.openDevice(0);
    final Cursor cursor=provider.queryRoots(null);
    assertEquals(1,cursor.getCount());
    cursor.moveToNext();
    assertEquals("0:1",cursor.getString(0));
    assertEquals(Root.FLAG_SUPPORTS_IS_CHILD,cursor.getInt(1));
    assertTrue(cursor.isNull(2));
    assertEquals("Storage A",cursor.getString(3));
    assertEquals("0:1:0",cursor.getString(4));
    assertEquals(1024,cursor.getInt(5));
  }
{
    provider.openDevice(1);
    final Cursor cursor=provider.queryRoots(null);
    assertEquals(2,cursor.getCount());
    cursor.moveToNext();
    cursor.moveToNext();
    assertEquals("1:1",cursor.getString(0));
    assertEquals(Root.FLAG_SUPPORTS_IS_CHILD,cursor.getInt(1));
    assertTrue(cursor.isNull(2));
    assertEquals("Storage B",cursor.getString(3));
    assertEquals("1:1:0",cursor.getString(4));
    assertEquals(2048,cursor.getInt(5));
  }
{
    provider.closeAllDevices();
    final Cursor cursor=provider.queryRoots(null);
    assertEquals(0,cursor.getCount());
  }
}
