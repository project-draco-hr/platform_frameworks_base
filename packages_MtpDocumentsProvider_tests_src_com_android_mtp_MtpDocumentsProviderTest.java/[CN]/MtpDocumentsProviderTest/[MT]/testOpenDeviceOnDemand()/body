{
  setupProvider(MtpDatabaseConstants.FLAG_DATABASE_IN_MEMORY);
  mMtpManager.addValidDevice(new MtpDeviceRecord(0,"Device A",null,false,new MtpRoot[]{new MtpRoot(0,1,"Storage A",1024,2048,"")},OPERATIONS_SUPPORTED,null));
  mMtpManager.setObjectHandles(0,1,-1,new int[0]);
  mProvider.resumeRootScanner();
  mResolver.waitForNotification(ROOTS_URI,1);
  final String[] columns=new String[]{DocumentsContract.Root.COLUMN_TITLE,DocumentsContract.Root.COLUMN_DOCUMENT_ID};
  try (final Cursor cursor=mProvider.queryRoots(columns)){
    assertEquals(1,cursor.getCount());
    assertTrue(cursor.moveToNext());
    assertEquals("Device A",cursor.getString(0));
    assertEquals(1,cursor.getLong(1));
  }
 {
    final MtpDeviceRecord[] openedDevice=mProvider.getOpenedDeviceRecordsCache();
    assertEquals(0,openedDevice.length);
  }
  try (final Cursor cursor=mProvider.queryChildDocuments("1",null,null)){
  }
 {
    final MtpDeviceRecord[] openedDevice=mProvider.getOpenedDeviceRecordsCache();
    assertEquals(1,openedDevice.length);
    assertEquals(0,openedDevice[0].deviceId);
  }
}
