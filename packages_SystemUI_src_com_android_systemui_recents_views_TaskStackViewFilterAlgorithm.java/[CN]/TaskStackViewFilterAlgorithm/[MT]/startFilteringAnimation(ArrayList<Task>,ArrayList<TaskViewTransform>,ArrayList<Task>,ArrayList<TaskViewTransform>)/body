{
  final ArrayList<TaskView> childrenToRemove=new ArrayList<TaskView>();
  final HashMap<TaskView,TaskViewTransform> childViewTransforms=new HashMap<TaskView,TaskViewTransform>();
  int duration=getExitTransformsForFilterAnimation(curTasks,curTaskTransforms,tasks,taskTransforms,childViewTransforms,childrenToRemove);
  final boolean unifyNewViewAnimation=childrenToRemove.isEmpty();
  if (unifyNewViewAnimation) {
    int inDuration=getEnterTransformsForFilterAnimation(tasks,taskTransforms,childViewTransforms);
    duration=Math.max(duration,inDuration);
  }
  for (  final TaskView tv : childViewTransforms.keySet()) {
    TaskViewTransform t=childViewTransforms.get(tv);
    tv.animate().cancel();
    tv.animate().withEndAction(new Runnable(){
      @Override public void run(){
        childViewTransforms.remove(tv);
        if (childViewTransforms.isEmpty()) {
          for (          TaskView tv : childrenToRemove) {
            mViewPool.returnViewToPool(tv);
          }
          if (!unifyNewViewAnimation) {
            childViewTransforms.clear();
            int duration=getEnterTransformsForFilterAnimation(tasks,taskTransforms,childViewTransforms);
            for (            final TaskView tv : childViewTransforms.keySet()) {
              TaskViewTransform t=childViewTransforms.get(tv);
              tv.updateViewPropertiesToTaskTransform(t,duration);
            }
          }
        }
      }
    }
);
    tv.updateViewPropertiesToTaskTransform(t,duration);
  }
}
