{
  if (DEBUG_INPUT) {
    Slog.d(TAG,"dispatchMediaKeyWithWakeLock: " + event);
  }
  if (mHavePendingMediaKeyRepeatWithWakeLock) {
    if (DEBUG_INPUT) {
      Slog.d(TAG,"dispatchMediaKeyWithWakeLock: canceled repeat");
    }
    mHandler.removeMessages(MSG_DISPATCH_MEDIA_KEY_REPEAT_WITH_WAKE_LOCK);
    mHavePendingMediaKeyRepeatWithWakeLock=false;
    mBroadcastWakeLock.release();
  }
  dispatchMediaKeyWithWakeLockToAudioService(event);
  if (event.getAction() == KeyEvent.ACTION_DOWN && event.getRepeatCount() == 0) {
    mHavePendingMediaKeyRepeatWithWakeLock=true;
    Message msg=mHandler.obtainMessage(MSG_DISPATCH_MEDIA_KEY_REPEAT_WITH_WAKE_LOCK,event);
    msg.setAsynchronous(true);
    mHandler.sendMessageDelayed(msg,ViewConfiguration.getKeyRepeatTimeout());
  }
 else {
    mBroadcastWakeLock.release();
  }
}
