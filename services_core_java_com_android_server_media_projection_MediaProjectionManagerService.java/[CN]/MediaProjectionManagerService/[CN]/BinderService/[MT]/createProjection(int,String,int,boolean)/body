{
  if (mContext.checkCallingPermission(Manifest.permission.CREATE_MEDIA_PROJECTION) != PackageManager.PERMISSION_GRANTED) {
    throw new SecurityException("Requires CREATE_MEDIA_PROJECTION in order to grant " + "projection permission");
  }
  long callingToken=Binder.clearCallingIdentity();
  MediaProjection projection;
  try {
    projection=new MediaProjection(type,uid,packageName);
    if (isPermanentGrant) {
      mAppOps.setMode(AppOpsManager.OP_PROJECT_MEDIA,projection.uid,projection.packageName,AppOpsManager.MODE_ALLOWED);
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingToken);
  }
  return projection;
}
