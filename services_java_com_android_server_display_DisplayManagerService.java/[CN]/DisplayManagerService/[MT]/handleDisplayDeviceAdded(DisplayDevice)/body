{
synchronized (mLock) {
    if (mDisplayDevices.contains(device)) {
      Slog.w(TAG,"Attempted to add already added display device: " + device);
      return;
    }
    mDisplayDevices.add(device);
    LogicalDisplay display=new LogicalDisplay(device);
    display.updateFromPrimaryDisplayDevice();
    boolean isDefault=(display.mPrimaryDisplayDeviceInfo.flags & DisplayDeviceInfo.FLAG_DEFAULT_DISPLAY) != 0;
    if (isDefault && mLogicalDisplays.get(Display.DEFAULT_DISPLAY) != null) {
      Slog.w(TAG,"Attempted to add a second default device: " + device);
      isDefault=false;
    }
    int displayId=isDefault ? Display.DEFAULT_DISPLAY : mNextNonDefaultDisplayId++;
    mLogicalDisplays.put(displayId,display);
    sendDisplayEventLocked(displayId,DisplayManagerGlobal.EVENT_DISPLAY_ADDED);
    if (isDefault) {
      mLock.notifyAll();
    }
  }
}
