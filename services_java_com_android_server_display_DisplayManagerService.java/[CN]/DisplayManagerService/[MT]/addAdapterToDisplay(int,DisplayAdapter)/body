{
  if (adapter == null) {
    Slog.e(TAG,"addDeviceToDisplay: Attempt to add null adapter");
    return;
  }
synchronized (mLock) {
    if (!mDisplayAdapters.contains(adapter)) {
      Slog.e(TAG,"addDeviceToDisplay: Attempt to add an unregistered adapter");
      return;
    }
    DisplayInfo displayInfo=mDisplayInfos.get(displayId);
    if (displayInfo == null) {
      createDisplayInfoLocked(displayId,adapter);
    }
    Integer oldDisplayId=adapter.getDisplayId();
    if (oldDisplayId != Display.NO_DISPLAY) {
      if (oldDisplayId == displayId) {
        return;
      }
      removeAdapterLocked(adapter);
    }
    ArrayList<DisplayAdapter> list=mLogicalToPhysicals.get(displayId);
    if (list == null) {
      list=new ArrayList<DisplayAdapter>();
      mLogicalToPhysicals.put(displayId,list);
    }
    list.add(adapter);
    adapter.setDisplayId(displayId);
  }
}
