{
  DisplayDeviceInfo info=device.getDisplayDeviceInfoLocked();
  boolean isPrivate=(info.flags & DisplayDeviceInfo.FLAG_PRIVATE) != 0;
  LogicalDisplay display=findLogicalDisplayForDeviceLocked(device);
  if (!isPrivate) {
    if (display != null && !display.hasContentLocked()) {
      display=null;
    }
    if (display == null) {
      display=mLogicalDisplays.get(Display.DEFAULT_DISPLAY);
    }
  }
  if (display == null) {
    Slog.w(TAG,"Missing logical display to use for physical display device: " + device.getDisplayDeviceInfoLocked());
    return;
  }
  boolean isBlanked=(mAllDisplayBlankStateFromPowerManager == DISPLAY_BLANK_STATE_BLANKED) && (info.flags & DisplayDeviceInfo.FLAG_NEVER_BLANK) == 0;
  display.configureDisplayInTransactionLocked(device,isBlanked);
  if (!mDefaultViewport.valid && (info.flags & DisplayDeviceInfo.FLAG_DEFAULT_DISPLAY) != 0) {
    setViewportLocked(mDefaultViewport,display,device);
  }
  if (!mExternalTouchViewport.valid && info.touch == DisplayDeviceInfo.TOUCH_EXTERNAL) {
    setViewportLocked(mExternalTouchViewport,display,device);
  }
}
