{
  if (event == null) {
    throw new IllegalArgumentException("event cannot be null");
  }
  if (callback != null && handler == null) {
    throw new IllegalArgumentException("handler cannot be null");
  }
synchronized (mHandler) {
    if (mChannel == null) {
      return DISPATCH_NOT_HANDLED;
    }
    PendingEvent p=obtainPendingEventLocked(event,token,callback,handler);
    if (Looper.myLooper() == Looper.getMainLooper()) {
      return sendInputEventOnMainLooperLocked(p);
    }
    Message msg=mHandler.obtainMessage(InputEventHandler.MSG_SEND_INPUT_EVENT,p);
    msg.setAsynchronous(true);
    mHandler.sendMessage(msg);
    return DISPATCH_IN_PROGRESS;
  }
}
