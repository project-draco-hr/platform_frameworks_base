{
  super.onPrepareOptionsMenu(menu);
  final RootInfo root=getCurrentRoot();
  final MenuItem createDir=menu.findItem(R.id.menu_create_dir);
  final MenuItem pasteFromCb=menu.findItem(R.id.menu_paste_from_clipboard);
  final MenuItem settings=menu.findItem(R.id.menu_settings);
  final MenuItem newWindow=menu.findItem(R.id.menu_new_window);
  createDir.setVisible(true);
  createDir.setEnabled(canCreateDirectory());
  pasteFromCb.setEnabled(mClipper.hasItemsToPaste());
  settings.setVisible(root.hasSettings());
  newWindow.setVisible(Shared.shouldShowFancyFeatures(this));
  Menus.disableHiddenItems(menu,pasteFromCb);
  mSearchManager.updateMenu();
  return true;
}
