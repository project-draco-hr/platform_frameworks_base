{
  State state=buildDefaultState();
  final Intent intent=getIntent();
  state.action=State.ACTION_BROWSE_ALL;
  state.acceptMimes=new String[]{intent.getType()};
  state.allowMultiple=true;
  Preconditions.checkArgument(!intent.hasExtra(Intent.EXTRA_LOCAL_ONLY));
  Preconditions.checkArgument(!intent.hasExtra(DocumentsContract.EXTRA_SHOW_ADVANCED));
  state.showAdvanced=LocalPreferences.getDisplayAdvancedDevices(this);
  state.showSize=LocalPreferences.getDisplayFileSize(this);
  final DocumentStack stack=intent.getParcelableExtra(CopyService.EXTRA_STACK);
  if (stack != null)   state.stack=stack;
  return state;
}
