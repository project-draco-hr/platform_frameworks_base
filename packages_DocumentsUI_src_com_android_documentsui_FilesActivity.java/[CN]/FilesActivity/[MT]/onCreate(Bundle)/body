{
  super.onCreate(icicle);
  mToolbar=(Toolbar)findViewById(R.id.toolbar);
  mStackAdapter=new StackAdapter();
  mStackListener=new ItemSelectedListener();
  mToolbarStack=(Spinner)findViewById(R.id.stack);
  mToolbarStack.setOnItemSelectedListener(mStackListener);
  setActionBar(mToolbar);
  mClipper=new DocumentClipper(this);
  mDrawer=DrawerController.create(this);
  RootsFragment.show(getFragmentManager(),null);
  final Intent intent=getIntent();
  final Uri uri=intent.getData();
  if (mState.restored) {
    if (DEBUG)     Log.d(TAG,"Stack already resolved for uri: " + intent.getData());
    refreshCurrentRootAndDirectory(ANIM_NONE);
  }
 else   if (!mState.stack.isEmpty()) {
    if (DEBUG)     Log.d(TAG,"Launching with non-empty stack.");
    checkState(uri == null || LauncherActivity.isLaunchUri(uri));
    refreshCurrentRootAndDirectory(ANIM_NONE);
  }
 else   if (DocumentsContract.isRootUri(this,uri)) {
    if (DEBUG)     Log.d(TAG,"Launching with root URI.");
    new RestoreRootTask(uri).executeOnExecutor(ProviderExecutor.forAuthority(uri.getAuthority()));
  }
 else {
    if (DEBUG)     Log.d(TAG,"Launching into Home directory.");
    final Uri homeUri=DocumentsContract.buildHomeUri();
    new RestoreRootTask(homeUri).executeOnExecutor(ProviderExecutor.forAuthority(homeUri.getAuthority()));
  }
  final @DialogType int dialogType=intent.getIntExtra(FileOperationService.EXTRA_DIALOG_TYPE,DIALOG_TYPE_UNKNOWN);
  if (icicle == null && dialogType != DIALOG_TYPE_UNKNOWN) {
    final int opType=intent.getIntExtra(FileOperationService.EXTRA_OPERATION,FileOperationService.OPERATION_COPY);
    final ArrayList<DocumentInfo> srcList=intent.getParcelableArrayListExtra(FileOperationService.EXTRA_SRC_LIST);
    OperationDialogFragment.show(getFragmentManager(),dialogType,srcList,mState.stack,opType);
  }
}
