{
  super.onCreate(icicle);
  mToolbar=(Toolbar)findViewById(R.id.toolbar);
  mStackAdapter=new StackAdapter();
  mStackListener=new ItemSelectedListener();
  mToolbarStack=(Spinner)findViewById(R.id.stack);
  mToolbarStack.setOnItemSelectedListener(mStackListener);
  setActionBar(mToolbar);
  mClipper=new DocumentClipper(this);
  mDrawer=DrawerController.create(this);
  RootsFragment.show(getFragmentManager(),null);
  if (mState.restored) {
    if (DEBUG)     Log.d(TAG,"Restored instance for uri: " + getIntent().getData());
    onCurrentDirectoryChanged(ANIM_NONE);
  }
 else {
    Intent intent=getIntent();
    Uri uri=intent.getData();
    if (DEBUG)     Log.d(TAG,"Creating new instance for uri: " + uri);
    if (!mState.stack.isEmpty()) {
      if (DEBUG)       Log.d(TAG,"Launching with non-empty stack.");
      checkState(uri == null || LauncherActivity.isLaunchUri(uri));
      onCurrentDirectoryChanged(ANIM_NONE);
    }
 else     if (DocumentsContract.isRootUri(this,uri)) {
      if (DEBUG)       Log.d(TAG,"Launching with root URI.");
      new RestoreRootTask(uri).executeOnExecutor(ProviderExecutor.forAuthority(uri.getAuthority()));
    }
 else {
      if (DEBUG)       Log.d(TAG,"Launching into Home directory.");
      uri=DocumentsContract.buildHomeUri();
      new RestoreRootTask(uri).executeOnExecutor(ProviderExecutor.forAuthority(uri.getAuthority()));
    }
    final int failure=intent.getIntExtra(CopyService.EXTRA_FAILURE,0);
    final int transferMode=intent.getIntExtra(CopyService.EXTRA_TRANSFER_MODE,CopyService.TRANSFER_MODE_COPY);
    if (failure != 0) {
      final ArrayList<DocumentInfo> failedSrcList=intent.getParcelableArrayListExtra(CopyService.EXTRA_SRC_LIST);
      FailureDialogFragment.show(getFragmentManager(),failure,failedSrcList,mState.stack,transferMode);
    }
  }
}
