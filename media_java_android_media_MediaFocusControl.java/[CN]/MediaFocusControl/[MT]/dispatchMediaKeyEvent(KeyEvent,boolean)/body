{
  if (needWakeLock) {
    mMediaEventWakeLock.acquire();
  }
  Intent keyIntent=new Intent(Intent.ACTION_MEDIA_BUTTON,null);
  keyIntent.putExtra(Intent.EXTRA_KEY_EVENT,keyEvent);
synchronized (mMCStack) {
    if (!mMCStack.empty()) {
      try {
        mMCStack.peek().mMediaIntent.send(mContext,needWakeLock ? WAKELOCK_RELEASE_ON_FINISHED : 0,keyIntent,this,mEventHandler);
      }
 catch (      CanceledException e) {
        Log.e(TAG,"Error sending pending intent " + mMCStack.peek());
        e.printStackTrace();
      }
    }
 else {
      if (needWakeLock) {
        keyIntent.putExtra(EXTRA_WAKELOCK_ACQUIRED,WAKELOCK_RELEASE_ON_FINISHED);
      }
      final long ident=Binder.clearCallingIdentity();
      try {
        mContext.sendOrderedBroadcastAsUser(keyIntent,UserHandle.ALL,null,mKeyEventDone,mEventHandler,Activity.RESULT_OK,null,null);
      }
  finally {
        Binder.restoreCallingIdentity(ident);
      }
    }
  }
}
