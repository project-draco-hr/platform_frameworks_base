{
  if (DEBUG_RC)   Log.i(TAG,"Register remote control client rcClient=" + rcClient);
  int rccId=RemoteControlClient.RCSE_ID_UNREGISTERED;
synchronized (mPRStack) {
    try {
      for (int index=mPRStack.size() - 1; index >= 0; index--) {
        final PlayerRecord prse=mPRStack.elementAt(index);
        if (prse.hasMatchingMediaButtonIntent(mediaIntent)) {
          prse.resetControllerInfoForRcc(rcClient,callingPackageName,Binder.getCallingUid());
          if (rcClient == null) {
            break;
          }
          rccId=prse.getRccId();
          if (mRcDisplays.size() > 0) {
            plugRemoteControlDisplaysIntoClient_syncPrs(prse.getRcc());
          }
          break;
        }
      }
    }
 catch (    ArrayIndexOutOfBoundsException e) {
      Log.e(TAG,"Wrong index accessing RC stack, lock error? ",e);
    }
    if (isCurrentRcController(mediaIntent)) {
      checkUpdateRemoteControlDisplay_syncPrs(RC_INFO_ALL);
    }
  }
  return rccId;
}
