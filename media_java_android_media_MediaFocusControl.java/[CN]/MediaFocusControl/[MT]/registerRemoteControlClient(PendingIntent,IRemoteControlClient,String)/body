{
  if (DEBUG_RC)   Log.i(TAG,"Register remote control client rcClient=" + rcClient);
  int rccId=RemoteControlClient.RCSE_ID_UNREGISTERED;
synchronized (mAudioFocusLock) {
synchronized (mMCStack) {
      try {
        for (int index=mMCStack.size() - 1; index >= 0; index--) {
          final MediaController mcse=mMCStack.elementAt(index);
          if (mcse.mMediaIntent.equals(mediaIntent)) {
            if (mcse.mRcClientDeathHandler != null) {
              mcse.unlinkToRcClientDeath();
            }
            mcse.mRcClient=rcClient;
            mcse.mCallingPackageName=callingPackageName;
            mcse.mCallingUid=Binder.getCallingUid();
            if (rcClient == null) {
              mcse.resetPlaybackInfo();
              break;
            }
            rccId=mcse.mRccId;
            if (mRcDisplays.size() > 0) {
              plugRemoteControlDisplaysIntoClient_syncRcStack(mcse.mRcClient);
            }
            IBinder b=mcse.mRcClient.asBinder();
            RcClientDeathHandler rcdh=new RcClientDeathHandler(b,mcse.mMediaIntent);
            try {
              b.linkToDeath(rcdh,0);
            }
 catch (            RemoteException e) {
              Log.w(TAG,"registerRemoteControlClient() has a dead client " + b);
              mcse.mRcClient=null;
            }
            mcse.mRcClientDeathHandler=rcdh;
            break;
          }
        }
      }
 catch (      ArrayIndexOutOfBoundsException e) {
        Log.e(TAG,"Wrong index accessing RC stack, lock error? ",e);
      }
      if (isCurrentRcController(mediaIntent)) {
        checkUpdateRemoteControlDisplay_syncAfRcs(RC_INFO_ALL);
      }
    }
  }
  return rccId;
}
