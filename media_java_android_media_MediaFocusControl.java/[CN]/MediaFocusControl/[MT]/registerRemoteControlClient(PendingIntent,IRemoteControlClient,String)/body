{
  if (DEBUG_RC)   Log.i(TAG,"Register remote control client rcClient=" + rcClient);
  int rccId=RemoteControlClient.RCSE_ID_UNREGISTERED;
synchronized (mAudioFocusLock) {
synchronized (mMCStack) {
      try {
        for (int index=mMCStack.size() - 1; index >= 0; index--) {
          final MediaController mcse=mMCStack.elementAt(index);
          if (mcse.hasMatchingMediaButtonIntent(mediaIntent)) {
            mcse.resetControllerInfoForRcc(rcClient,callingPackageName,Binder.getCallingUid());
            if (rcClient == null) {
              break;
            }
            rccId=mcse.getRccId();
            if (mRcDisplays.size() > 0) {
              plugRemoteControlDisplaysIntoClient_syncRcStack(mcse.getRcc());
            }
            break;
          }
        }
      }
 catch (      ArrayIndexOutOfBoundsException e) {
        Log.e(TAG,"Wrong index accessing RC stack, lock error? ",e);
      }
      if (isCurrentRcController(mediaIntent)) {
        checkUpdateRemoteControlDisplay_syncAfRcs(RC_INFO_ALL);
      }
    }
  }
  return rccId;
}
