{
  mEventHandler=new MediaEventHandler(looper);
  mContext=cntxt;
  mContentResolver=mContext.getContentResolver();
  mVolumeController=volumeCtrl;
  mAudioService=as;
  PowerManager pm=(PowerManager)mContext.getSystemService(Context.POWER_SERVICE);
  mMediaEventWakeLock=pm.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"handleMediaEvent");
  mMainRemote=new RemotePlaybackState(-1,AudioService.getMaxStreamVolume(AudioManager.STREAM_MUSIC),AudioService.getMaxStreamVolume(AudioManager.STREAM_MUSIC));
  TelephonyManager tmgr=(TelephonyManager)mContext.getSystemService(Context.TELEPHONY_SERVICE);
  tmgr.listen(mPhoneStateListener,PhoneStateListener.LISTEN_CALL_STATE);
  IntentFilter pkgFilter=new IntentFilter();
  pkgFilter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  pkgFilter.addAction(Intent.ACTION_PACKAGE_ADDED);
  pkgFilter.addAction(Intent.ACTION_PACKAGE_CHANGED);
  pkgFilter.addAction(Intent.ACTION_PACKAGE_DATA_CLEARED);
  pkgFilter.addDataScheme("package");
  mContext.registerReceiver(mReceiver,pkgFilter);
  mAppOps=(AppOpsManager)mContext.getSystemService(Context.APP_OPS_SERVICE);
  mKeyguardManager=(KeyguardManager)mContext.getSystemService(Context.KEYGUARD_SERVICE);
  mHasRemotePlayback=false;
  mMainRemoteIsActive=false;
  postReevaluateRemote();
}
