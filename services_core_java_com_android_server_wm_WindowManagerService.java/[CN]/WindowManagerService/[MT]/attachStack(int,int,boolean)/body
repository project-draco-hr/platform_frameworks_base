{
  final long origId=Binder.clearCallingIdentity();
  try {
synchronized (mWindowMap) {
      final DisplayContent displayContent=mDisplayContents.get(displayId);
      if (displayContent != null) {
        TaskStack stack=mStackIdToStack.get(stackId);
        if (stack == null) {
          if (DEBUG_STACK)           Slog.d(TAG_WM,"attachStack: stackId=" + stackId);
          stack=new TaskStack(this,stackId);
          mStackIdToStack.put(stackId,stack);
          if (stackId == DOCKED_STACK_ID) {
            getDefaultDisplayContentLocked().mDividerControllerLocked.notifyDockedStackExistsChanged(true);
          }
        }
        stack.attachDisplayContent(displayContent);
        displayContent.attachStack(stack,onTop);
        moveStackWindowsLocked(displayContent);
        final WindowList windows=displayContent.getWindowList();
        for (int winNdx=windows.size() - 1; winNdx >= 0; --winNdx) {
          windows.get(winNdx).reportResized();
        }
        if (stack.getRawFullscreen()) {
          return null;
        }
        Rect bounds=new Rect();
        stack.getRawBounds(bounds);
        return bounds;
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
  return null;
}
