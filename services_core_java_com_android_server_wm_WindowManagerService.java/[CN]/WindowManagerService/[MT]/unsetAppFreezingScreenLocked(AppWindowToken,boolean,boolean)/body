{
  if (wtoken.mAppAnimator.freezingScreen) {
    if (DEBUG_ORIENTATION)     Slog.v(TAG,"Clear freezing of " + wtoken + " force="+ force);
    final int N=wtoken.allAppWindows.size();
    boolean unfrozeWindows=false;
    for (int i=0; i < N; i++) {
      WindowState w=wtoken.allAppWindows.get(i);
      if (w.mAppFreezing) {
        w.mAppFreezing=false;
        if (w.mHasSurface && !w.mOrientationChanging && mWindowsFreezingScreen != WINDOWS_FREEZING_SCREENS_TIMEOUT) {
          if (DEBUG_ORIENTATION)           Slog.v(TAG,"set mOrientationChanging of " + w);
          w.mOrientationChanging=true;
          mInnerFields.mOrientationChangeComplete=false;
        }
        w.mLastFreezeDuration=0;
        unfrozeWindows=true;
        final DisplayContent displayContent=w.getDisplayContent();
        if (displayContent != null) {
          displayContent.layoutNeeded=true;
        }
      }
    }
    if (force || unfrozeWindows) {
      if (DEBUG_ORIENTATION)       Slog.v(TAG,"No longer freezing: " + wtoken);
      wtoken.mAppAnimator.freezingScreen=false;
      wtoken.mAppAnimator.lastFreezeDuration=(int)(SystemClock.elapsedRealtime() - mDisplayFreezeTime);
      mAppsFreezingScreen--;
      mLastFinishedFreezeSource=wtoken;
    }
    if (unfreezeSurfaceNow) {
      if (unfrozeWindows) {
        performLayoutAndPlaceSurfacesLocked();
      }
      stopFreezingDisplayLocked();
    }
  }
}
