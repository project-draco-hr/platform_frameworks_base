{
  final WindowStateAnimator winAnimator=w.mWinAnimator;
  if (w.mHasSurface && w.mLayoutSeq == mLayoutSeq && !w.isGoneForLayoutLw()) {
    final Task task=w.getTask();
    if (task != null && task.mStack.getBoundsAnimating()) {
      return;
    }
    w.setInsetsChanged();
    boolean configChanged=w.isConfigChanged();
    if (DEBUG_CONFIGURATION && configChanged) {
      Slog.v(TAG_WM,"Win " + w + " config changed: "+ mCurConfiguration);
    }
    final boolean dragResizingChanged=w.isDragResizeChanged() && !w.isDragResizingChangeReported();
    if (localLOGV)     Slog.v(TAG_WM,"Resizing " + w + ": configChanged="+ configChanged+ " dragResizingChanged="+ dragResizingChanged+ " last="+ w.mLastFrame+ " frame="+ w.mFrame);
    w.mLastFrame.set(w.mFrame);
    if (w.mContentInsetsChanged || w.mVisibleInsetsChanged || winAnimator.mSurfaceResized|| w.mOutsetsChanged|| configChanged|| dragResizingChanged|| !w.isResizedWhileNotDragResizingReported()) {
      if (DEBUG_RESIZE || DEBUG_ORIENTATION) {
        Slog.v(TAG_WM,"Resize reasons for w=" + w + ": "+ " contentInsetsChanged="+ w.mContentInsetsChanged+ " "+ w.mContentInsets.toShortString()+ " visibleInsetsChanged="+ w.mVisibleInsetsChanged+ " "+ w.mVisibleInsets.toShortString()+ " stableInsetsChanged="+ w.mStableInsetsChanged+ " "+ w.mStableInsets.toShortString()+ " outsetsChanged="+ w.mOutsetsChanged+ " "+ w.mOutsets.toShortString()+ " surfaceResized="+ winAnimator.mSurfaceResized+ " configChanged="+ configChanged+ " dragResizingChanged="+ dragResizingChanged+ " resizedWhileNotDragResizingReported="+ w.isResizedWhileNotDragResizingReported());
      }
      if (w.mAppToken != null && w.mAppDied) {
        w.mAppToken.removeAllDeadWindows();
        return;
      }
      w.mLastOverscanInsets.set(w.mOverscanInsets);
      w.mLastContentInsets.set(w.mContentInsets);
      w.mLastVisibleInsets.set(w.mVisibleInsets);
      w.mLastStableInsets.set(w.mStableInsets);
      w.mLastOutsets.set(w.mOutsets);
      makeWindowFreezingScreenIfNeededLocked(w);
      if (w.mOrientationChanging || dragResizingChanged || w.isResizedWhileNotDragResizing()) {
        if (DEBUG_SURFACE_TRACE || DEBUG_ANIM || DEBUG_ORIENTATION|| DEBUG_RESIZE) {
          Slog.v(TAG_WM,"Orientation or resize start waiting for draw" + ", mDrawState=DRAW_PENDING in " + w + ", surfaceController "+ winAnimator.mSurfaceController);
        }
        winAnimator.mDrawState=DRAW_PENDING;
        if (w.mAppToken != null) {
          w.mAppToken.clearAllDrawn();
        }
      }
      if (!mResizingWindows.contains(w)) {
        if (DEBUG_RESIZE || DEBUG_ORIENTATION)         Slog.v(TAG_WM,"Resizing window " + w);
        mResizingWindows.add(w);
      }
    }
 else     if (w.mOrientationChanging) {
      if (w.isDrawnLw()) {
        if (DEBUG_ORIENTATION)         Slog.v(TAG_WM,"Orientation not waiting for draw in " + w + ", surfaceController "+ winAnimator.mSurfaceController);
        w.mOrientationChanging=false;
        w.mLastFreezeDuration=(int)(SystemClock.elapsedRealtime() - mDisplayFreezeTime);
      }
    }
  }
}
