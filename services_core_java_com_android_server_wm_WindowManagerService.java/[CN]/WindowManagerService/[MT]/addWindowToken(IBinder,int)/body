{
  if (!checkCallingPermission(android.Manifest.permission.MANAGE_APP_TOKENS,"addWindowToken()")) {
    throw new SecurityException("Requires MANAGE_APP_TOKENS permission");
  }
synchronized (mWindowMap) {
    WindowToken wtoken=mTokenMap.get(token);
    if (wtoken != null) {
      Slog.w(TAG,"Attempted to add existing input method token: " + token);
      return;
    }
    wtoken=new WindowToken(this,token,type,true);
    mTokenMap.put(token,wtoken);
    if (type == TYPE_WALLPAPER) {
      mWallpaperTokens.add(wtoken);
    }
  }
}
