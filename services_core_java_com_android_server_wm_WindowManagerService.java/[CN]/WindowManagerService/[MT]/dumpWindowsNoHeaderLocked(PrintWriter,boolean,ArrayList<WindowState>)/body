{
  final int numDisplays=mDisplayContents.size();
  for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
    final WindowList windowList=mDisplayContents.valueAt(displayNdx).getWindowList();
    for (int winNdx=windowList.size() - 1; winNdx >= 0; --winNdx) {
      final WindowState w=windowList.get(winNdx);
      if (windows == null || windows.contains(w)) {
        pw.print("  Window #");
        pw.print(winNdx);
        pw.print(' ');
        pw.print(w);
        pw.println(":");
        w.dump(pw,"    ",dumpAll || windows != null);
      }
    }
  }
  if (mInputMethodDialogs.size() > 0) {
    pw.println();
    pw.println("  Input method dialogs:");
    for (int i=mInputMethodDialogs.size() - 1; i >= 0; i--) {
      WindowState w=mInputMethodDialogs.get(i);
      if (windows == null || windows.contains(w)) {
        pw.print("  IM Dialog #");
        pw.print(i);
        pw.print(": ");
        pw.println(w);
      }
    }
  }
  if (mPendingRemove.size() > 0) {
    pw.println();
    pw.println("  Remove pending for:");
    for (int i=mPendingRemove.size() - 1; i >= 0; i--) {
      WindowState w=mPendingRemove.get(i);
      if (windows == null || windows.contains(w)) {
        pw.print("  Remove #");
        pw.print(i);
        pw.print(' ');
        pw.print(w);
        if (dumpAll) {
          pw.println(":");
          w.dump(pw,"    ",true);
        }
 else {
          pw.println();
        }
      }
    }
  }
  if (mForceRemoves != null && mForceRemoves.size() > 0) {
    pw.println();
    pw.println("  Windows force removing:");
    for (int i=mForceRemoves.size() - 1; i >= 0; i--) {
      WindowState w=mForceRemoves.get(i);
      pw.print("  Removing #");
      pw.print(i);
      pw.print(' ');
      pw.print(w);
      if (dumpAll) {
        pw.println(":");
        w.dump(pw,"    ",true);
      }
 else {
        pw.println();
      }
    }
  }
  if (mDestroySurface.size() > 0) {
    pw.println();
    pw.println("  Windows waiting to destroy their surface:");
    for (int i=mDestroySurface.size() - 1; i >= 0; i--) {
      WindowState w=mDestroySurface.get(i);
      if (windows == null || windows.contains(w)) {
        pw.print("  Destroy #");
        pw.print(i);
        pw.print(' ');
        pw.print(w);
        if (dumpAll) {
          pw.println(":");
          w.dump(pw,"    ",true);
        }
 else {
          pw.println();
        }
      }
    }
  }
  if (mLosingFocus.size() > 0) {
    pw.println();
    pw.println("  Windows losing focus:");
    for (int i=mLosingFocus.size() - 1; i >= 0; i--) {
      WindowState w=mLosingFocus.get(i);
      if (windows == null || windows.contains(w)) {
        pw.print("  Losing #");
        pw.print(i);
        pw.print(' ');
        pw.print(w);
        if (dumpAll) {
          pw.println(":");
          w.dump(pw,"    ",true);
        }
 else {
          pw.println();
        }
      }
    }
  }
  if (mResizingWindows.size() > 0) {
    pw.println();
    pw.println("  Windows waiting to resize:");
    for (int i=mResizingWindows.size() - 1; i >= 0; i--) {
      WindowState w=mResizingWindows.get(i);
      if (windows == null || windows.contains(w)) {
        pw.print("  Resizing #");
        pw.print(i);
        pw.print(' ');
        pw.print(w);
        if (dumpAll) {
          pw.println(":");
          w.dump(pw,"    ",true);
        }
 else {
          pw.println();
        }
      }
    }
  }
  if (mWaitingForDrawn.size() > 0) {
    pw.println();
    pw.println("  Clients waiting for these windows to be drawn:");
    for (int i=mWaitingForDrawn.size() - 1; i >= 0; i--) {
      WindowState win=mWaitingForDrawn.get(i);
      pw.print("  Waiting #");
      pw.print(i);
      pw.print(' ');
      pw.print(win);
    }
  }
  pw.println();
  pw.print("  mCurConfiguration=");
  pw.println(this.mCurConfiguration);
  pw.print("  mHasPermanentDpad=");
  pw.println(mHasPermanentDpad);
  pw.print("  mCurrentFocus=");
  pw.println(mCurrentFocus);
  if (mLastFocus != mCurrentFocus) {
    pw.print("  mLastFocus=");
    pw.println(mLastFocus);
  }
  pw.print("  mFocusedApp=");
  pw.println(mFocusedApp);
  if (mInputMethodTarget != null) {
    pw.print("  mInputMethodTarget=");
    pw.println(mInputMethodTarget);
  }
  pw.print("  mInTouchMode=");
  pw.print(mInTouchMode);
  pw.print(" mLayoutSeq=");
  pw.println(mLayoutSeq);
  pw.print("  mLastDisplayFreezeDuration=");
  TimeUtils.formatDuration(mLastDisplayFreezeDuration,pw);
  if (mLastFinishedFreezeSource != null) {
    pw.print(" due to ");
    pw.print(mLastFinishedFreezeSource);
  }
  pw.println();
  if (dumpAll) {
    pw.print("  mSystemDecorLayer=");
    pw.print(mSystemDecorLayer);
    pw.print(" mScreenRect=");
    pw.println(mScreenRect.toShortString());
    if (mLastStatusBarVisibility != 0) {
      pw.print("  mLastStatusBarVisibility=0x");
      pw.println(Integer.toHexString(mLastStatusBarVisibility));
    }
    if (mInputMethodWindow != null) {
      pw.print("  mInputMethodWindow=");
      pw.println(mInputMethodWindow);
    }
    mWindowPlacerLocked.dump(pw,"  ");
    mWallpaperControllerLocked.dump(pw,"  ");
    if (mInputMethodAnimLayerAdjustment != 0 || mWallpaperControllerLocked.getAnimLayerAdjustment() != 0) {
      pw.print("  mInputMethodAnimLayerAdjustment=");
      pw.print(mInputMethodAnimLayerAdjustment);
      pw.print("  mWallpaperAnimLayerAdjustment=");
      pw.println(mWallpaperControllerLocked.getAnimLayerAdjustment());
    }
    pw.print("  mSystemBooted=");
    pw.print(mSystemBooted);
    pw.print(" mDisplayEnabled=");
    pw.println(mDisplayEnabled);
    if (needsLayout()) {
      pw.print("  layoutNeeded on displays=");
      for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
        final DisplayContent displayContent=mDisplayContents.valueAt(displayNdx);
        if (displayContent.layoutNeeded) {
          pw.print(displayContent.getDisplayId());
        }
      }
      pw.println();
    }
    pw.print("  mTransactionSequence=");
    pw.println(mTransactionSequence);
    pw.print("  mDisplayFrozen=");
    pw.print(mDisplayFrozen);
    pw.print(" windows=");
    pw.print(mWindowsFreezingScreen);
    pw.print(" client=");
    pw.print(mClientFreezingScreen);
    pw.print(" apps=");
    pw.print(mAppsFreezingScreen);
    pw.print(" waitingForConfig=");
    pw.println(mWaitingForConfig);
    pw.print("  mRotation=");
    pw.print(mRotation);
    pw.print(" mAltOrientation=");
    pw.println(mAltOrientation);
    pw.print("  mLastWindowForcedOrientation=");
    pw.print(mLastWindowForcedOrientation);
    pw.print(" mForcedAppOrientation=");
    pw.println(mForcedAppOrientation);
    pw.print("  mDeferredRotationPauseCount=");
    pw.println(mDeferredRotationPauseCount);
    pw.print("  Animation settings: disabled=");
    pw.print(mAnimationsDisabled);
    pw.print(" window=");
    pw.print(mWindowAnimationScaleSetting);
    pw.print(" transition=");
    pw.print(mTransitionAnimationScaleSetting);
    pw.print(" animator=");
    pw.println(mAnimatorDurationScaleSetting);
    pw.print(" mSkipAppTransitionAnimation=");
    pw.println(mSkipAppTransitionAnimation);
    pw.println("  mLayoutToAnim:");
    mAppTransition.dump(pw,"    ");
  }
}
