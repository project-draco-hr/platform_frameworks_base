{
  final int taskId=task.taskId;
  final TaskStack stack=task.mStack;
  if (stack.isAnimating()) {
    if (DEBUG_STACK)     Slog.i(TAG,"removeTask: deferring removing taskId=" + taskId);
    task.mDeferRemoval=true;
    return;
  }
  if (DEBUG_STACK)   Slog.i(TAG,"removeTask: removing taskId=" + taskId);
  EventLog.writeEvent(EventLogTags.WM_TASK_REMOVED,taskId,"removeTask");
  task.mDeferRemoval=false;
  stack.removeTask(task);
  mTaskIdToTask.delete(task.taskId);
  final ArrayList<AppWindowToken> exitingApps=stack.mExitingAppTokens;
  for (int appNdx=exitingApps.size() - 1; appNdx >= 0; --appNdx) {
    final AppWindowToken wtoken=exitingApps.get(appNdx);
    if (wtoken.groupId == taskId) {
      wtoken.mDeferRemoval=false;
      exitingApps.remove(appNdx);
    }
  }
}
