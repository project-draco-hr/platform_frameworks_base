{
  int changes=0;
  mAppTransition.setIdle();
  for (int i=mNoAnimationNotifyOnTransitionFinished.size() - 1; i >= 0; i--) {
    final IBinder token=mNoAnimationNotifyOnTransitionFinished.get(i);
    mAppTransition.notifyAppTransitionFinishedLocked(token);
  }
  mNoAnimationNotifyOnTransitionFinished.clear();
  mWallpaperControllerLocked.hideDeferredWallpapersIfNeeded();
  ArrayList<TaskStack> stacks=getDefaultDisplayContentLocked().getStacks();
  for (int stackNdx=stacks.size() - 1; stackNdx >= 0; --stackNdx) {
    final ArrayList<Task> tasks=stacks.get(stackNdx).getTasks();
    for (int taskNdx=tasks.size() - 1; taskNdx >= 0; --taskNdx) {
      final AppTokenList tokens=tasks.get(taskNdx).mAppTokens;
      for (int tokenNdx=tokens.size() - 1; tokenNdx >= 0; --tokenNdx) {
        tokens.get(tokenNdx).sendingToBottom=false;
      }
    }
  }
  rebuildAppWindowListLocked();
  changes|=PhoneWindowManager.FINISH_LAYOUT_REDO_LAYOUT;
  if (DEBUG_WALLPAPER_LIGHT)   Slog.v(TAG,"Wallpaper layer changed: assigning layers + relayout");
  moveInputMethodWindowsIfNeededLocked(true);
  mWindowPlacerLocked.mWallpaperMayChange=true;
  mFocusMayChange=true;
  return changes;
}
