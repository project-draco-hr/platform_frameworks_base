{
  if (!checkCallingPermission(android.Manifest.permission.MANAGE_APP_TOKENS,"setAppTask()")) {
    throw new SecurityException("Requires MANAGE_APP_TOKENS permission");
  }
synchronized (mWindowMap) {
    final AppWindowToken atoken=findAppWindowToken(token);
    if (atoken == null) {
      Slog.w(TAG,"Attempted to set task id of non-existing app token: " + token);
      return null;
    }
    final Task oldTask=atoken.mTask;
    oldTask.removeAppToken(atoken);
    Task newTask=mTaskIdToTask.get(taskId);
    Configuration outConfig=null;
    if (newTask == null) {
      newTask=createTaskLocked(taskId,oldTask.mStack.mStackId,oldTask.mUserId,atoken,taskBounds);
      outConfig=newTask.mOverrideConfig;
    }
    newTask.addAppToken(Integer.MAX_VALUE,atoken);
    return outConfig;
  }
}
