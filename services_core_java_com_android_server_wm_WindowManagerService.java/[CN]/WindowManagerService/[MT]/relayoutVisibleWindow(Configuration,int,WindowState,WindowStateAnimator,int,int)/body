{
  result|=!win.isVisibleLw() ? WindowManagerGlobal.RELAYOUT_RES_FIRST_TIME : 0;
  if (win.mExiting) {
    winAnimator.cancelExitAnimationForNextAnimationLocked();
    win.mExiting=false;
  }
  if (win.mDestroying) {
    win.mDestroying=false;
    mDestroySurface.remove(win);
  }
  if (oldVisibility == View.GONE) {
    winAnimator.mEnterAnimationPending=true;
  }
  winAnimator.mEnteringAnimation=true;
  if ((result & WindowManagerGlobal.RELAYOUT_RES_FIRST_TIME) != 0) {
    win.prepareWindowToDisplayDuringRelayout(outConfig);
  }
  if ((attrChanges & LayoutParams.FORMAT_CHANGED) != 0) {
    if (!winAnimator.tryChangeFormatInPlaceLocked()) {
      winAnimator.destroySurfaceLocked();
      result|=RELAYOUT_RES_SURFACE_CHANGED | WindowManagerGlobal.RELAYOUT_RES_FIRST_TIME;
    }
  }
  if (win.isDragResizeChanged()) {
    win.setDragResizing();
    if (win.mHasSurface) {
      winAnimator.preserveSurfaceLocked();
      result|=WindowManagerGlobal.RELAYOUT_RES_FIRST_TIME;
    }
  }
  result|=win.isDragResizing() ? WindowManagerGlobal.RELAYOUT_RES_DRAG_RESIZING : 0;
  if (win.isAnimatingWithSavedSurface()) {
    result|=WindowManagerGlobal.RELAYOUT_RES_FIRST_TIME;
  }
  return result;
}
