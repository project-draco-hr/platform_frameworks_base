{
  if (WindowManagerService.DEBUG_TASK_POSITIONING) {
    Slog.d(TAG,"startPositioningLocked: win=" + win + ", resize="+ resize+ ", {"+ startX+ ", "+ startY+ "}");
  }
  if (win == null || win.getAppToken() == null || !win.inFreeformWorkspace()) {
    Slog.w(TAG,"startPositioningLocked: Bad window " + win);
    return false;
  }
  if (win.mInputChannel == null) {
    Slog.wtf(TAG,"startPositioningLocked: " + win + " has no input channel, "+ " probably being removed");
    return false;
  }
  final DisplayContent displayContent=win.getDisplayContent();
  if (displayContent == null) {
    Slog.w(TAG,"startPositioningLocked: Invalid display content " + win);
    return false;
  }
  Display display=displayContent.getDisplay();
  mTaskPositioner=new TaskPositioner(this);
  mTaskPositioner.register(display);
  mInputMonitor.updateInputWindowsLw(true);
  if (!mInputManager.transferTouchFocus(win.mInputChannel,mTaskPositioner.mServerChannel)) {
    Slog.e(TAG,"startPositioningLocked: Unable to transfer touch focus");
    mTaskPositioner.unregister();
    mTaskPositioner=null;
    mInputMonitor.updateInputWindowsLw(true);
    return false;
  }
  mTaskPositioner.startDragLocked(win,resize,startX,startY);
  return true;
}
