{
  if (DEBUG_TASK_POSITIONING)   Slog.d(TAG_WM,"startPositioningLocked: " + "win=" + win + ", resize="+ resize+ ", {"+ startX+ ", "+ startY+ "}");
  if (win == null || win.getAppToken() == null) {
    Slog.w(TAG_WM,"startPositioningLocked: Bad window " + win);
    return false;
  }
  if (win.mInputChannel == null) {
    Slog.wtf(TAG_WM,"startPositioningLocked: " + win + " has no input channel, "+ " probably being removed");
    return false;
  }
  final DisplayContent displayContent=win.getDisplayContent();
  if (displayContent == null) {
    Slog.w(TAG_WM,"startPositioningLocked: Invalid display content " + win);
    return false;
  }
  Display display=displayContent.getDisplay();
  mTaskPositioner=new TaskPositioner(this);
  mTaskPositioner.register(display);
  mInputMonitor.updateInputWindowsLw(true);
  WindowState transferFocusFromWin=win;
  if (mCurrentFocus != null && mCurrentFocus != win && mCurrentFocus.mAppToken == win.mAppToken) {
    transferFocusFromWin=mCurrentFocus;
  }
  if (!mInputManager.transferTouchFocus(transferFocusFromWin.mInputChannel,mTaskPositioner.mServerChannel)) {
    Slog.e(TAG_WM,"startPositioningLocked: Unable to transfer touch focus");
    mTaskPositioner.unregister();
    mTaskPositioner=null;
    mInputMonitor.updateInputWindowsLw(true);
    return false;
  }
  mTaskPositioner.startDragLocked(win,resize,startX,startY);
  return true;
}
