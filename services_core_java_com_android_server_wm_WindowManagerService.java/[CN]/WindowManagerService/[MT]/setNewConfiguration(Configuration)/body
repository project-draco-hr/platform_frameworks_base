{
  if (!checkCallingPermission(android.Manifest.permission.MANAGE_APP_TOKENS,"setNewConfiguration()")) {
    throw new SecurityException("Requires MANAGE_APP_TOKENS permission");
  }
synchronized (mWindowMap) {
    final boolean orientationChanged=mCurConfiguration.orientation != config.orientation;
    mCurConfiguration=new Configuration(config);
    if (mWaitingForConfig) {
      mWaitingForConfig=false;
      mLastFinishedFreezeSource="new-config";
    }
    mWindowPlacerLocked.performSurfacePlacement();
    if (orientationChanged) {
      for (int i=mDisplayContents.size() - 1; i >= 0; i--) {
        DisplayContent content=mDisplayContents.valueAt(i);
        Message.obtain(mH,H.UPDATE_DOCKED_STACK_DIVIDER,H.DOCK_DIVIDER_FORCE_UPDATE,H.UNUSED,content).sendToTarget();
      }
    }
  }
}
