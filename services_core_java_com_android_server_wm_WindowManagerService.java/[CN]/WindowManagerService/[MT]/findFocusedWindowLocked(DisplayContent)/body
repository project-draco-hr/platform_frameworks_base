{
  final WindowList windows=displayContent.getWindowList();
  for (int i=windows.size() - 1; i >= 0; i--) {
    final WindowState win=windows.get(i);
    if (localLOGV || DEBUG_FOCUS)     Slog.v(TAG_WM,"Looking for focus: " + i + " = "+ win+ ", flags="+ win.mAttrs.flags+ ", canReceive="+ win.canReceiveKeys());
    if (!win.canReceiveKeys()) {
      continue;
    }
    AppWindowToken wtoken=win.mAppToken;
    if (wtoken != null && (wtoken.removed || wtoken.sendingToBottom)) {
      if (DEBUG_FOCUS)       Slog.v(TAG_WM,"Skipping " + wtoken + " because "+ (wtoken.removed ? "removed" : "sendingToBottom"));
      continue;
    }
    if (wtoken != null && win.mAttrs.type != TYPE_APPLICATION_STARTING && mFocusedApp != null) {
      ArrayList<Task> tasks=displayContent.getTasks();
      for (int taskNdx=tasks.size() - 1; taskNdx >= 0; --taskNdx) {
        AppTokenList tokens=tasks.get(taskNdx).mAppTokens;
        int tokenNdx=tokens.size() - 1;
        for (; tokenNdx >= 0; --tokenNdx) {
          final AppWindowToken token=tokens.get(tokenNdx);
          if (wtoken == token) {
            break;
          }
          if (mFocusedApp == token && token.windowsAreFocusable()) {
            if (localLOGV || DEBUG_FOCUS_LIGHT)             Slog.v(TAG_WM,"findFocusedWindow: Reached focused app=" + mFocusedApp);
            return null;
          }
        }
        if (tokenNdx >= 0) {
          break;
        }
      }
    }
    if (DEBUG_FOCUS_LIGHT)     Slog.v(TAG_WM,"findFocusedWindow: Found new focus @ " + i + " = "+ win);
    return win;
  }
  if (DEBUG_FOCUS_LIGHT)   Slog.v(TAG_WM,"findFocusedWindow: No focusable windows.");
  return null;
}
