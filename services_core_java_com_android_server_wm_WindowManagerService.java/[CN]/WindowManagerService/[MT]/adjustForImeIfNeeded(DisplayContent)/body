{
  final WindowState imeWin=mInputMethodWindow;
  final boolean imeVisible=imeWin != null && imeWin.isVisibleLw() && imeWin.isDisplayedLw();
  final boolean dockVisible=isStackVisibleLocked(DOCKED_STACK_ID);
  final TaskStack imeTargetStack=getImeTargetStackLocked();
  if (imeVisible && dockVisible && imeTargetStack != null) {
    final boolean isFocusOnBottom=imeTargetStack.getDockSide() == DOCKED_BOTTOM;
    final ArrayList<TaskStack> stacks=displayContent.getStacks();
    for (int i=stacks.size() - 1; i >= 0; --i) {
      final TaskStack stack=stacks.get(i);
      final boolean isDockedOnBottom=stack.getDockSide() == DOCKED_BOTTOM;
      if (stack.isVisibleLocked() && (isFocusOnBottom || isDockedOnBottom)) {
        stack.setAdjustedForIme(imeWin);
      }
 else {
        stack.resetAdjustedForIme(false);
      }
    }
    displayContent.mDividerControllerLocked.setAdjustedForIme(isFocusOnBottom,true,true,imeWin);
  }
 else {
    final ArrayList<TaskStack> stacks=displayContent.getStacks();
    for (int i=stacks.size() - 1; i >= 0; --i) {
      final TaskStack stack=stacks.get(i);
      stack.resetAdjustedForIme(!dockVisible);
    }
    displayContent.mDividerControllerLocked.setAdjustedForIme(false,false,dockVisible,null);
  }
}
