{
  final WindowState imeWin=mInputMethodWindow;
  final TaskStack focusedStack=getFocusedStackLocked();
  final boolean dockVisible=isStackVisibleLocked(DOCKED_STACK_ID);
  if (imeWin != null && imeWin.isVisibleLw() && imeWin.isDisplayedLw() && dockVisible && focusedStack != null) {
    final boolean isFocusOnBottom=focusedStack.getDockSide() == DOCKED_BOTTOM;
    final ArrayList<TaskStack> stacks=displayContent.getStacks();
    for (int i=stacks.size() - 1; i >= 0; --i) {
      final TaskStack stack=stacks.get(i);
      final boolean isDockedOnBottom=stack.getDockSide() == DOCKED_BOTTOM;
      if (stack.isVisibleLocked() && (isFocusOnBottom || isDockedOnBottom)) {
        stack.setAdjustedForIme(imeWin);
      }
    }
    displayContent.mDividerControllerLocked.setAdjustedForIme(true,true,imeWin);
  }
 else {
    final ArrayList<TaskStack> stacks=displayContent.getStacks();
    for (int i=stacks.size() - 1; i >= 0; --i) {
      final TaskStack stack=stacks.get(i);
      stack.resetAdjustedForIme(!dockVisible);
    }
    displayContent.mDividerControllerLocked.setAdjustedForIme(false,dockVisible,imeWin);
  }
}
