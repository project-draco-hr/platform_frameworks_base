{
synchronized (mWindowMap) {
    mCurrentUserId=newUserId;
    mCurrentProfileIds=currentProfileIds;
    mAppTransition.setCurrentUser(newUserId);
    mPolicy.setCurrentUserLw(newUserId);
    final int numDisplays=mDisplayContents.size();
    for (int displayNdx=0; displayNdx < numDisplays; ++displayNdx) {
      final DisplayContent displayContent=mDisplayContents.valueAt(displayNdx);
      displayContent.switchUserStacks();
      rebuildAppWindowListLocked(displayContent);
    }
    mWindowPlacerLocked.performSurfacePlacement();
  }
}
