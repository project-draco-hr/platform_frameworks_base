{
synchronized (mWindowMap) {
    if (DEBUG_BOOT)     Slog.i(TAG_WM,"performEnableScreen: mDisplayEnabled=" + mDisplayEnabled + " mForceDisplayEnabled="+ mForceDisplayEnabled+ " mShowingBootMessages="+ mShowingBootMessages+ " mSystemBooted="+ mSystemBooted+ " mOnlyCore="+ mOnlyCore,new RuntimeException("here").fillInStackTrace());
    if (mDisplayEnabled) {
      return;
    }
    if (!mSystemBooted && !mShowingBootMessages) {
      return;
    }
    if (!mForceDisplayEnabled && checkWaitingForWindowsLocked()) {
      return;
    }
    if (!mBootAnimationStopped) {
      Trace.asyncTraceBegin(Trace.TRACE_TAG_WINDOW_MANAGER,"Stop bootanim",0);
      try {
        IBinder surfaceFlinger=ServiceManager.getService("SurfaceFlinger");
        if (surfaceFlinger != null) {
          Parcel data=Parcel.obtain();
          data.writeInterfaceToken("android.ui.ISurfaceComposer");
          surfaceFlinger.transact(IBinder.FIRST_CALL_TRANSACTION,data,null,0);
          data.recycle();
        }
      }
 catch (      RemoteException ex) {
        Slog.e(TAG_WM,"Boot completed: SurfaceFlinger is dead!");
      }
      mBootAnimationStopped=true;
    }
    if (!mForceDisplayEnabled && !checkBootAnimationCompleteLocked()) {
      if (DEBUG_BOOT)       Slog.i(TAG_WM,"performEnableScreen: Waiting for anim complete");
      return;
    }
    EventLog.writeEvent(EventLogTags.WM_BOOT_ANIMATION_DONE,SystemClock.uptimeMillis());
    Trace.asyncTraceEnd(Trace.TRACE_TAG_WINDOW_MANAGER,"Stop bootanim",0);
    mDisplayEnabled=true;
    if (DEBUG_SCREEN_ON || DEBUG_BOOT)     Slog.i(TAG_WM,"******************** ENABLING SCREEN!");
    mInputMonitor.setEventDispatchingLw(mEventDispatchingEnabled);
  }
  try {
    mActivityManager.bootAnimationComplete();
  }
 catch (  RemoteException e) {
  }
  mPolicy.enableScreenAfterBoot();
  updateRotationUnchecked(false,false);
}
