{
  final long origId=Binder.clearCallingIdentity();
  try {
synchronized (mWindowMap) {
      WindowState win=windowForClientLocked(session,client,false);
      if (DEBUG_ADD_REMOVE)       Slog.d(TAG,"finishDrawingWindow: " + win + " mDrawState="+ (win != null ? win.mWinAnimator.drawStateToString() : "null"));
      if (win != null && win.mWinAnimator.finishDrawingLocked()) {
        if ((win.mAttrs.flags & FLAG_SHOW_WALLPAPER) != 0) {
          getDefaultDisplayContentLocked().pendingLayoutChanges|=WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER;
        }
        if (win.mAppToken != null) {
          win.mAppToken.mAnimatingWithSavedSurface=false;
        }
        win.setDisplayLayoutNeeded();
        mWindowPlacerLocked.requestTraversal();
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
}
