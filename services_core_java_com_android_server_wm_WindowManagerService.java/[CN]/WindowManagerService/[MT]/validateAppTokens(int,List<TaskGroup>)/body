{
synchronized (mWindowMap) {
    int t=tasks.size() - 1;
    if (t < 0) {
      Slog.w(TAG_WM,"validateAppTokens: empty task list");
      return;
    }
    TaskGroup task=tasks.get(0);
    int taskId=task.taskId;
    Task targetTask=mTaskIdToTask.get(taskId);
    DisplayContent displayContent=targetTask.getDisplayContent();
    if (displayContent == null) {
      Slog.w(TAG_WM,"validateAppTokens: no Display for taskId=" + taskId);
      return;
    }
    final ArrayList<Task> localTasks=mStackIdToStack.get(stackId).getTasks();
    int taskNdx;
    for (taskNdx=localTasks.size() - 1; taskNdx >= 0 && t >= 0; --taskNdx, --t) {
      AppTokenList localTokens=localTasks.get(taskNdx).mAppTokens;
      task=tasks.get(t);
      List<IApplicationToken> tokens=task.tokens;
      DisplayContent lastDisplayContent=displayContent;
      displayContent=mTaskIdToTask.get(taskId).getDisplayContent();
      if (displayContent != lastDisplayContent) {
        Slog.w(TAG_WM,"validateAppTokens: displayContent changed in TaskGroup list!");
        return;
      }
      int tokenNdx;
      int v;
      for (tokenNdx=localTokens.size() - 1, v=task.tokens.size() - 1; tokenNdx >= 0 && v >= 0; ) {
        final AppWindowToken atoken=localTokens.get(tokenNdx);
        if (atoken.removed) {
          --tokenNdx;
          continue;
        }
        if (tokens.get(v) != atoken.token) {
          break;
        }
        --tokenNdx;
        v--;
      }
      if (tokenNdx >= 0 || v >= 0) {
        break;
      }
    }
    if (taskNdx >= 0 || t >= 0) {
      Slog.w(TAG_WM,"validateAppTokens: Mismatch! ActivityManager=" + tasks);
      Slog.w(TAG_WM,"validateAppTokens: Mismatch! WindowManager=" + localTasks);
      Slog.w(TAG_WM,"validateAppTokens: Mismatch! Callers=" + Debug.getCallers(4));
    }
  }
}
