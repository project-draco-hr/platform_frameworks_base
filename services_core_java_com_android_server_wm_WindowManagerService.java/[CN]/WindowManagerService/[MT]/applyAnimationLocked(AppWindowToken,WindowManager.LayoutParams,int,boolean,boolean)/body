{
  if (okToDisplay()) {
    DisplayInfo displayInfo=getDefaultDisplayInfoLocked();
    final int width=displayInfo.appWidth;
    final int height=displayInfo.appHeight;
    if (DEBUG_APP_TRANSITIONS || DEBUG_ANIM)     Slog.v(TAG,"applyAnimation: atoken=" + atoken);
    WindowState win=atoken.findMainWindow();
    Rect containingFrame=new Rect(0,0,width,height);
    Rect contentInsets=new Rect();
    Rect appFrame=new Rect(0,0,width,height);
    Rect surfaceInsets=null;
    final boolean fullscreen=win != null && win.isFullscreen(width,height);
    final boolean dialogWindow=win != null && !win.mContainingFrame.equals(win.mFrame);
    if (win != null) {
      containingFrame.set(win.mContainingFrame);
      surfaceInsets=win.getAttrs().surfaceInsets;
      if (fullscreen) {
        contentInsets.set(win.mContentInsets);
        appFrame.set(win.mFrame);
      }
    }
    final int containingWidth=containingFrame.width();
    final int containingHeight=containingFrame.height();
    if (atoken.mLaunchTaskBehind) {
      enter=false;
    }
    final boolean resizedWindow=!fullscreen && !dialogWindow;
    Animation a=mAppTransition.loadAnimation(lp,transit,enter,containingWidth,containingHeight,mCurConfiguration.orientation,containingFrame,contentInsets,surfaceInsets,appFrame,isVoiceInteraction,resizedWindow,atoken.mTask.mTaskId);
    if (a != null) {
      if (DEBUG_ANIM) {
        RuntimeException e=null;
        if (!HIDE_STACK_CRAWLS) {
          e=new RuntimeException();
          e.fillInStackTrace();
        }
        Slog.v(TAG,"Loaded animation " + a + " for "+ atoken,e);
      }
      atoken.mAppAnimator.setAnimation(a,containingWidth,containingHeight,mAppTransition.canSkipFirstFrame());
    }
  }
 else {
    atoken.mAppAnimator.clearAnimation();
  }
  return atoken.mAppAnimator.animation != null;
}
