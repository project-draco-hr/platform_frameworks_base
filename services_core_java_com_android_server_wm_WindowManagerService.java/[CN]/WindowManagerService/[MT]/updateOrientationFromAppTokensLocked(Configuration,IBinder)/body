{
  if (!mDisplayReady) {
    return null;
  }
  Configuration config=null;
  if (updateOrientationFromAppTokensLocked(false)) {
    if (freezeThisOneIfNeeded != null) {
      AppWindowToken atoken=findAppWindowToken(freezeThisOneIfNeeded);
      if (atoken != null) {
        startAppFreezingScreenLocked(atoken);
      }
    }
    config=computeNewConfigurationLocked();
  }
 else   if (currentConfig != null) {
    mTempConfiguration.setToDefaults();
    mTempConfiguration.updateFrom(currentConfig);
    computeScreenConfigurationLocked(mTempConfiguration);
    if (currentConfig.diff(mTempConfiguration) != 0) {
      mWaitingForConfig=true;
      final DisplayContent displayContent=getDefaultDisplayContentLocked();
      displayContent.layoutNeeded=true;
      int anim[]=new int[2];
      if (displayContent.isDimming()) {
        anim[0]=anim[1]=0;
      }
 else {
        mPolicy.selectRotationAnimationLw(anim);
      }
      startFreezingDisplayLocked(false,anim[0],anim[1]);
      config=new Configuration(mTempConfiguration);
    }
  }
  return config;
}
