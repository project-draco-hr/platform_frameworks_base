{
synchronized (mWindowMap) {
    mWaitingForDrawnCallback=callback;
    final WindowList windows=getDefaultWindowListLocked();
    for (int winNdx=windows.size() - 1; winNdx >= 0; --winNdx) {
      final WindowState win=windows.get(winNdx);
      if (win.isVisibleLw() && (win.mAppToken != null || mPolicy.isForceHiding(win.mAttrs))) {
        win.mWinAnimator.mDrawState=WindowStateAnimator.DRAW_PENDING;
        win.mLastContentInsets.set(-1,-1,-1,-1);
        mWaitingForDrawn.add(win);
      }
    }
    requestTraversalLocked();
  }
  mH.removeMessages(H.WAITING_FOR_DRAWN_TIMEOUT);
  if (mWaitingForDrawn.isEmpty()) {
    callback.run();
  }
 else {
    mH.sendEmptyMessageDelayed(H.WAITING_FOR_DRAWN_TIMEOUT,timeout);
    checkDrawnWindowsLocked();
  }
}
