{
  int iconId=R.drawable.stat_sys_data_bluetooth;
  String action=intent.getAction();
  if (action.equals(BluetoothAdapter.ACTION_STATE_CHANGED)) {
    int state=intent.getIntExtra(BluetoothAdapter.EXTRA_STATE,BluetoothAdapter.ERROR);
    mBluetoothEnabled=state == BluetoothAdapter.STATE_ON;
  }
 else   if (action.equals(BluetoothHeadset.ACTION_STATE_CHANGED)) {
    mBluetoothHeadsetState=intent.getIntExtra(BluetoothHeadset.EXTRA_STATE,BluetoothHeadset.STATE_ERROR);
  }
 else   if (action.equals(BluetoothA2dp.ACTION_SINK_STATE_CHANGED)) {
    BluetoothA2dp a2dp=new BluetoothA2dp(mContext);
    if (a2dp.getConnectedSinks().size() != 0) {
      mBluetoothA2dpConnected=true;
    }
 else {
      mBluetoothA2dpConnected=false;
    }
  }
 else   if (action.equals(BluetoothPbap.PBAP_STATE_CHANGED_ACTION)) {
    mBluetoothPbapState=intent.getIntExtra(BluetoothPbap.PBAP_STATE,BluetoothPbap.STATE_DISCONNECTED);
  }
 else {
    return;
  }
  if (mBluetoothHeadsetState == BluetoothHeadset.STATE_CONNECTED || mBluetoothA2dpConnected || mBluetoothPbapState == BluetoothPbap.STATE_CONNECTED) {
    iconId=R.drawable.stat_sys_data_bluetooth_connected;
  }
  mService.setIcon("bluetooth",iconId,0);
  mService.setIconVisibility("bluetooth",mBluetoothEnabled);
}
