{
  ServiceInfo si=mResolveInfo.serviceInfo;
  PackageManager pm=mContext.getPackageManager();
  try (XmlResourceParser parser=si.loadXmlMetaData(pm,TvInputService.SERVICE_META_DATA)){
    if (parser == null) {
      throw new IllegalStateException("No " + TvInputService.SERVICE_META_DATA + " meta-data found for "+ si.name);
    }
    Resources res=pm.getResourcesForApplication(si.applicationInfo);
    AttributeSet attrs=Xml.asAttributeSet(parser);
    int type;
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT && type != XmlPullParser.START_TAG) {
    }
    String nodeName=parser.getName();
    if (!XML_START_TAG_NAME.equals(nodeName)) {
      throw new IllegalStateException("Meta-data does not start with " + XML_START_TAG_NAME + " tag for "+ si.name);
    }
    TypedArray sa=res.obtainAttributes(attrs,com.android.internal.R.styleable.TvInputService);
    mSetupActivity=sa.getString(com.android.internal.R.styleable.TvInputService_setupActivity);
    if (inputType == TYPE_TUNER && TextUtils.isEmpty(mSetupActivity)) {
      throw new IllegalStateException("Setup activity not found for " + si.name);
    }
    mSettingsActivity=sa.getString(com.android.internal.R.styleable.TvInputService_settingsActivity);
    if (mCanRecord == null) {
      mCanRecord=sa.getBoolean(com.android.internal.R.styleable.TvInputService_canRecord,false);
    }
    if (mTunerCount == null && inputType == TYPE_TUNER) {
      mTunerCount=sa.getInt(com.android.internal.R.styleable.TvInputService_tunerCount,1);
    }
    sa.recycle();
  }
 catch (  IOException|XmlPullParserException e) {
    throw new IllegalStateException("Failed reading meta-data for " + si.packageName,e);
  }
catch (  NameNotFoundException e) {
    throw new IllegalStateException("No resources found for " + si.packageName,e);
  }
}
