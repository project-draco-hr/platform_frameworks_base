{
  ServiceInfo si=service.serviceInfo;
  PackageManager pm=context.getPackageManager();
  XmlResourceParser parser=null;
  try {
    parser=si.loadXmlMetaData(pm,TvInputService.SERVICE_META_DATA);
    if (parser == null) {
      throw new XmlPullParserException("No " + TvInputService.SERVICE_META_DATA + " meta-data for "+ si.name);
    }
    Resources res=pm.getResourcesForApplication(si.applicationInfo);
    AttributeSet attrs=Xml.asAttributeSet(parser);
    int type;
    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT && type != XmlPullParser.START_TAG) {
    }
    String nodeName=parser.getName();
    if (!XML_START_TAG_NAME.equals(nodeName)) {
      throw new XmlPullParserException("Meta-data does not start with tv-input-service tag in " + si.name);
    }
    TvInputInfo input=new TvInputInfo(context,service,id,null);
    TypedArray sa=res.obtainAttributes(attrs,com.android.internal.R.styleable.TvInputService);
    input.mSetupActivity=sa.getString(com.android.internal.R.styleable.TvInputService_setupActivity);
    if (DEBUG) {
      Log.d(TAG,"Setup activity loaded. [" + input.mSetupActivity + "] for "+ si.name);
    }
    input.mSettingsActivity=sa.getString(com.android.internal.R.styleable.TvInputService_settingsActivity);
    if (DEBUG) {
      Log.d(TAG,"Settings activity loaded. [" + input.mSettingsActivity + "] for "+ si.name);
    }
    if (pm.checkPermission(android.Manifest.permission.TV_INPUT_HARDWARE,si.packageName) == PackageManager.PERMISSION_GRANTED) {
      input.mType=sa.getInt(com.android.internal.R.styleable.TvInputService_tvInputType,TYPE_VIRTUAL);
      if (DEBUG) {
        Log.d(TAG,"Type loaded. [" + input.mType + "] for "+ si.name);
      }
    }
    sa.recycle();
    return input;
  }
 catch (  NameNotFoundException e) {
    throw new XmlPullParserException("Unable to create context for: " + si.packageName);
  }
 finally {
    if (parser != null) {
      parser.close();
    }
  }
}
