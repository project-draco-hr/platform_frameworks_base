{
  Slog.i(TAG,((mLowBatteryDialog == null) ? "showing" : "updating") + " low battery warning: level=" + mBatteryLevel+ " ["+ mBucket+ "]");
  final int textRes=mSaver ? R.string.battery_low_percent_format_saver_started : R.string.battery_low_percent_format;
  final CharSequence levelText=mContext.getString(textRes,mBatteryLevel);
  if (mLowBatteryDialog != null) {
    mLowBatteryDialog.setMessage(levelText);
  }
 else {
    AlertDialog.Builder b=new AlertDialog.Builder(mContext);
    b.setCancelable(true);
    b.setTitle(R.string.battery_low_title);
    b.setMessage(levelText);
    b.setPositiveButton(android.R.string.ok,null);
    final Intent intent=new Intent(Intent.ACTION_POWER_USAGE_SUMMARY);
    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS| Intent.FLAG_ACTIVITY_NO_HISTORY);
    if (intent.resolveActivity(mContext.getPackageManager()) != null) {
      b.setNegativeButton(R.string.battery_low_why,new DialogInterface.OnClickListener(){
        @Override public void onClick(        DialogInterface dialog,        int which){
          mPhoneStatusBar.startActivity(intent,true);
          dismissLowBatteryWarning();
        }
      }
);
    }
    AlertDialog d=b.create();
    d.setOnDismissListener(new DialogInterface.OnDismissListener(){
      @Override public void onDismiss(      DialogInterface dialog){
        mLowBatteryDialog=null;
      }
    }
);
    d.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ERROR);
    d.getWindow().getAttributes().privateFlags|=WindowManager.LayoutParams.PRIVATE_FLAG_SHOW_FOR_ALL_USERS;
    d.show();
    mLowBatteryDialog=d;
    if (playSound) {
      playLowBatterySound();
    }
  }
}
