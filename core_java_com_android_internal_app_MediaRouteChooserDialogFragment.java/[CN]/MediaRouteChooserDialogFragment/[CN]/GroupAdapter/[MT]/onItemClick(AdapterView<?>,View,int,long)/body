{
  if (getItemViewType(position) == VIEW_DONE) {
    onDoneGrouping();
    return;
  }
  final ListView lv=(ListView)parent;
  final RouteInfo route=mFlatRoutes.get(position - 1);
  final boolean checked=lv.isItemChecked(position);
  mIgnoreUpdates=true;
  RouteGroup oldGroup=route.getGroup();
  if (checked && oldGroup != mPrimary) {
    oldGroup.removeRoute(route);
    if (oldGroup.getRouteCount() == 0) {
      if (mRouter.getSelectedRoute(mRouteTypes) == oldGroup) {
        mRouter.selectRoute(mRouteTypes,mPrimary);
      }
      mRouter.removeRouteInt(oldGroup);
    }
    mPrimary.addRoute(route);
  }
 else   if (!checked) {
    if (mPrimary.getRouteCount() > 1) {
      mPrimary.removeRoute(route);
      mRouter.addRouteInt(route);
    }
 else {
      lv.setItemChecked(position,true);
    }
  }
  mIgnoreUpdates=false;
  update();
  initCheckedItems();
}
