{
  CacheResult ret=new CacheResult();
  ret.httpStatusCode=statusCode;
  String location=headers.getLocation();
  if (location != null)   ret.location=location;
  ret.expires=-1;
  String expires=headers.getExpires();
  if (expires != null) {
    try {
      ret.expires=HttpDateTime.parse(expires);
    }
 catch (    IllegalArgumentException ex) {
      if ("-1".equals(expires) || "0".equals(expires)) {
        ret.expires=0;
      }
 else {
        Log.e(LOGTAG,"illegal expires: " + expires);
      }
    }
  }
  String lastModified=headers.getLastModified();
  if (lastModified != null)   ret.lastModified=lastModified;
  String etag=headers.getEtag();
  if (etag != null)   ret.etag=etag;
  String cacheControl=headers.getCacheControl();
  if (cacheControl != null) {
    String[] controls=cacheControl.toLowerCase().split("[ ,;]");
    for (int i=0; i < controls.length; i++) {
      if (NO_STORE.equals(controls[i])) {
        return null;
      }
      if (NO_CACHE.equals(controls[i])) {
        ret.expires=0;
      }
 else       if (controls[i].startsWith(MAX_AGE)) {
        int separator=controls[i].indexOf('=');
        if (separator < 0) {
          separator=controls[i].indexOf(':');
        }
        if (separator > 0) {
          String s=controls[i].substring(separator + 1);
          try {
            long sec=Long.parseLong(s);
            if (sec >= 0) {
              ret.expires=System.currentTimeMillis() + 1000 * sec;
            }
          }
 catch (          NumberFormatException ex) {
            if ("1d".equals(s)) {
              ret.expires=System.currentTimeMillis() + 86400000;
            }
 else {
              Log.e(LOGTAG,"exception in parseHeaders for " + "max-age:" + controls[i].substring(separator + 1));
              ret.expires=0;
            }
          }
        }
      }
    }
  }
  if (NO_CACHE.equals(headers.getPragma())) {
    ret.expires=0;
  }
  if (ret.expires == -1) {
    if (ret.httpStatusCode == 301) {
      ret.expires=Long.MAX_VALUE;
    }
 else     if (ret.httpStatusCode == 302 || ret.httpStatusCode == 307) {
      ret.expires=0;
    }
 else     if (ret.lastModified == null) {
      if (!mimeType.startsWith("text/html")) {
        ret.expires=System.currentTimeMillis() + 86400000;
      }
 else {
        ret.expires=0;
      }
    }
 else {
      long lastmod=System.currentTimeMillis() + 86400000;
      try {
        lastmod=HttpDateTime.parse(ret.lastModified);
      }
 catch (      IllegalArgumentException ex) {
        Log.e(LOGTAG,"illegal lastModified: " + ret.lastModified);
      }
      long difference=System.currentTimeMillis() - lastmod;
      if (difference > 0) {
        ret.expires=System.currentTimeMillis() + difference / 5;
      }
 else {
        ret.expires=lastmod;
      }
    }
  }
  return ret;
}
