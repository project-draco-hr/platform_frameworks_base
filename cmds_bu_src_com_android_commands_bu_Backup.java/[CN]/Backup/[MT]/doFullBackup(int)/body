{
  ArrayList<String> packages=new ArrayList<String>();
  boolean saveApks=false;
  boolean saveShared=false;
  boolean doEverything=false;
  boolean allIncludesSystem=true;
  String arg;
  while ((arg=nextArg()) != null) {
    if (arg.startsWith("-")) {
      if ("-apk".equals(arg)) {
        saveApks=true;
      }
 else       if ("-noapk".equals(arg)) {
        saveApks=false;
      }
 else       if ("-shared".equals(arg)) {
        saveShared=true;
      }
 else       if ("-noshared".equals(arg)) {
        saveShared=false;
      }
 else       if ("-system".equals(arg)) {
        allIncludesSystem=true;
      }
 else       if ("-nosystem".equals(arg)) {
        allIncludesSystem=false;
      }
 else       if ("-all".equals(arg)) {
        doEverything=true;
      }
 else {
        Log.w(TAG,"Unknown backup flag " + arg);
        continue;
      }
    }
 else {
      packages.add(arg);
    }
  }
  if (doEverything && packages.size() > 0) {
    Log.w(TAG,"-all passed for backup along with specific package names");
  }
  if (!doEverything && !saveShared && packages.size() == 0) {
    Log.e(TAG,"no backup packages supplied and neither -shared nor -all given");
    return;
  }
  try {
    ParcelFileDescriptor fd=ParcelFileDescriptor.adoptFd(socketFd);
    String[] packArray=new String[packages.size()];
    mBackupManager.fullBackup(fd,saveApks,saveShared,doEverything,allIncludesSystem,packages.toArray(packArray));
  }
 catch (  RemoteException e) {
    Log.e(TAG,"Unable to invoke backup manager for backup");
  }
}
