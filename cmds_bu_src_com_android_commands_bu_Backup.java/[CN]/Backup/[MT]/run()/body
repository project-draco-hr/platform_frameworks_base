{
  IBackupManager bmgr=IBackupManager.Stub.asInterface(ServiceManager.getService("backup"));
  if (bmgr == null) {
    System.err.println("ERROR: could not contact backup manager");
    return;
  }
  ArrayList<String> packages=new ArrayList<String>();
  boolean saveApks=false;
  boolean saveShared=false;
  boolean doEverything=false;
  String arg;
  while ((arg=nextArg()) != null) {
    if (arg.startsWith("-")) {
      if ("-apk".equals(arg)) {
        saveApks=true;
      }
 else       if ("-noapk".equals(arg)) {
        saveApks=false;
      }
 else       if ("-shared".equals(arg)) {
        saveShared=true;
      }
 else       if ("-noshared".equals(arg)) {
        saveShared=false;
      }
 else       if ("-all".equals(arg)) {
        doEverything=true;
      }
 else {
        System.err.println("ERROR: unknown flag " + arg);
        return;
      }
    }
 else {
      packages.add(arg);
    }
  }
  if (doEverything && packages.size() > 0) {
    System.err.println("ERROR: -all used with specific package set");
    return;
  }
  if (!doEverything && packages.size() == 0) {
    System.err.println("ERROR: no packages supplied and -all not used");
    return;
  }
  try {
    ParcelFileDescriptor fd=ParcelFileDescriptor.dup(FileDescriptor.out);
    String[] packArray=new String[packages.size()];
    bmgr.fullBackup(fd,saveApks,saveShared,doEverything,packages.toArray(packArray));
  }
 catch (  IOException e) {
    System.err.println("ERROR: cannot dup System.out");
  }
catch (  RemoteException e) {
    System.err.println("ERROR: unable to invoke backup manager service");
  }
}
