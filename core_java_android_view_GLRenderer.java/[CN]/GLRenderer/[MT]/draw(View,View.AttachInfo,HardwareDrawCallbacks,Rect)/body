{
  if (canDraw()) {
    if (!hasDirtyRegions()) {
      dirty=null;
    }
    attachInfo.mIgnoreDirtyState=true;
    attachInfo.mDrawingTime=SystemClock.uptimeMillis();
    view.mPrivateFlags|=View.PFLAG_DRAWN;
    final int surfaceState=checkRenderContextUnsafe();
    if (surfaceState != SURFACE_STATE_ERROR) {
      HardwareCanvas canvas=mCanvas;
      if (mProfileEnabled) {
        mProfileLock.lock();
      }
      dirty=beginFrame(canvas,dirty,surfaceState);
      DisplayList displayList=buildDisplayList(view,canvas);
      if (checkRenderContextUnsafe() == SURFACE_STATE_ERROR) {
        return;
      }
      int saveCount=0;
      int status=DisplayList.STATUS_DONE;
      long start=getSystemTime();
      try {
        status=prepareFrame(dirty);
        saveCount=canvas.save();
        callbacks.onHardwarePreDraw(canvas);
        if (displayList != null) {
          status|=drawDisplayList(attachInfo,canvas,displayList,status);
        }
 else {
          view.draw(canvas);
        }
      }
 catch (      Exception e) {
        Log.e(LOG_TAG,"An error has occurred while drawing:",e);
      }
 finally {
        callbacks.onHardwarePostDraw(canvas);
        canvas.restoreToCount(saveCount);
        view.mRecreateDisplayList=false;
        mDrawDelta=getSystemTime() - start;
        if (mDrawDelta > 0) {
          mFrameCount++;
          debugDirtyRegions(dirty,canvas);
          drawProfileData(attachInfo);
        }
      }
      onPostDraw();
      swapBuffers(status);
      if (mProfileEnabled) {
        mProfileLock.unlock();
      }
      attachInfo.mIgnoreDirtyState=false;
    }
  }
}
