{
  SystemServicesProxy ssp=Recents.getSystemServices();
  mTaskIndexMap.clear();
  ArrayList<Task> tasks=stack.getTasks();
  if (tasks.isEmpty()) {
    mFrontMostTaskP=0;
    mMinScrollP=mMaxScrollP=0;
    mNumStackTasks=mNumFreeformTasks=0;
    return;
  }
  ArrayList<Task> freeformTasks=new ArrayList<>();
  ArrayList<Task> stackTasks=new ArrayList<>();
  for (int i=0; i < tasks.size(); i++) {
    Task task=tasks.get(i);
    if (task.isFreeformTask()) {
      freeformTasks.add(task);
    }
 else {
      stackTasks.add(task);
    }
  }
  mNumStackTasks=stackTasks.size();
  mNumFreeformTasks=freeformTasks.size();
  int taskCount=stackTasks.size();
  for (int i=0; i < taskCount; i++) {
    Task task=stackTasks.get(i);
    mTaskIndexMap.put(task.key,i);
  }
  if (getDefaultFocusScroll() > 0f) {
    mMinScrollP=0;
    mMaxScrollP=Math.max(mMinScrollP,mNumStackTasks - 1);
  }
 else {
    if (!ssp.hasFreeformWorkspaceSupport() && mNumStackTasks == 1) {
      mMinScrollP=mMaxScrollP=0;
    }
 else {
      float bottomOffsetPct=(float)(mStackBottomOffset + mTaskRect.height()) / mCurrentStackRect.height();
      float normX=mUnfocusedCurveInterpolator.getX(bottomOffsetPct);
      mMinScrollP=0;
      mMaxScrollP=Math.max(mMinScrollP,(mNumStackTasks - 1) - mUnfocusedRange.getAbsoluteX(normX));
    }
  }
  if (!freeformTasks.isEmpty()) {
    mFreeformLayoutAlgorithm.update(freeformTasks,this);
    mInitialScrollP=mMaxScrollP;
  }
 else {
    if (!ssp.hasFreeformWorkspaceSupport() && mNumStackTasks == 1) {
      mInitialScrollP=mMinScrollP;
    }
 else     if (getDefaultFocusScroll() > 0f) {
      RecentsActivityLaunchState launchState=Recents.getConfiguration().getLaunchState();
      if (launchState.launchedFromHome) {
        mInitialScrollP=Math.max(mMinScrollP,mNumStackTasks - 1);
      }
 else {
        mInitialScrollP=Math.max(mMinScrollP,mNumStackTasks - 2);
      }
    }
 else {
      float offsetPct=(float)(mTaskRect.height() / 2) / mCurrentStackRect.height();
      float normX=mUnfocusedCurveInterpolator.getX(offsetPct);
      mInitialScrollP=(mNumStackTasks - 1) - mUnfocusedRange.getAbsoluteX(normX);
    }
  }
  if (DEBUG) {
    Log.d(TAG,"mNumStackTasks: " + mNumStackTasks);
    Log.d(TAG,"mNumFreeformTasks: " + mNumFreeformTasks);
    Log.d(TAG,"mMinScrollP: " + mMinScrollP);
    Log.d(TAG,"mMaxScrollP: " + mMaxScrollP);
  }
}
