{
  SystemServicesProxy ssp=Recents.getSystemServices();
  mUnfocusedRange.offset(stackScroll);
  mFocusedRange.offset(stackScroll);
  boolean unfocusedVisible=mUnfocusedRange.isInRange(taskProgress);
  boolean focusedVisible=mFocusedRange.isInRange(taskProgress);
  if (!forceUpdate && !unfocusedVisible && !focusedVisible) {
    transformOut.reset();
    return;
  }
  float unfocusedRangeX=mUnfocusedRange.getNormalizedX(taskProgress);
  float focusedRangeX=mFocusedRange.getNormalizedX(taskProgress);
  int x=(mStackRect.width() - mTaskRect.width()) / 2;
  int y;
  float z;
  float dimAlpha;
  if (!ssp.hasFreeformWorkspaceSupport() && mNumStackTasks == 1 && !ignoreSingleTaskCase) {
    float tmpP=(mMinScrollP - stackScroll) / mNumStackTasks;
    int centerYOffset=(mStackRect.top - mTaskRect.top) + (mStackRect.height() - mTaskRect.height()) / 2;
    y=centerYOffset + getYForDeltaP(tmpP,0);
    z=mMaxTranslationZ;
    dimAlpha=0f;
  }
 else {
    int unfocusedY=(int)((1f - mUnfocusedCurveInterpolator.getInterpolation(unfocusedRangeX)) * mStackRect.height());
    int focusedY=(int)((1f - mFocusedCurveInterpolator.getInterpolation(focusedRangeX)) * mStackRect.height());
    float unfocusedDim=1f - UNFOCUSED_DIM_INTERPOLATOR.getInterpolation(unfocusedRangeX);
    float focusedDim=1f - FOCUSED_DIM_INTERPOLATOR.getInterpolation(focusedRangeX);
    y=(mStackRect.top - mTaskRect.top) + (int)Utilities.mapRange(mFocusState,unfocusedY,focusedY);
    z=Utilities.clamp01(unfocusedRangeX) * mMaxTranslationZ;
    dimAlpha=Utilities.mapRange(mFocusState,unfocusedDim,focusedDim);
  }
  transformOut.scale=1f;
  transformOut.alpha=1f;
  transformOut.translationZ=z;
  transformOut.dimAlpha=DIM_MAX_VALUE * dimAlpha;
  transformOut.rect.set(mTaskRect);
  transformOut.rect.offset(x,y);
  Utilities.scaleRectAboutCenter(transformOut.rect,transformOut.scale);
  transformOut.visible=(transformOut.rect.top < mStackRect.bottom) && (frontTransform == null || transformOut.rect.top != frontTransform.rect.top);
}
