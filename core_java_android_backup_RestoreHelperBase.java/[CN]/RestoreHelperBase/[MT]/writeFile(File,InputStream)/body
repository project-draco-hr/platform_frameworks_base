{
  boolean success=false;
  FileOutputStream out=null;
  try {
    File parent=f.getParentFile();
    parent.mkdirs();
    int sum=0;
    out=new FileOutputStream(f);
    byte[] buf=mBuf;
    int amt;
    while ((amt=in.read(buf)) > 0) {
      out.write(buf,0,amt);
      sum+=amt;
    }
    success=true;
    out=null;
  }
 catch (  IOException ex) {
    if (!mExceptionLogged) {
      Log.e(TAG,"Failed restoring file '" + f + "' for app '"+ mContext.getPackageName()+ '\'',ex);
      mExceptionLogged=true;
    }
  }
 finally {
    if (out != null) {
      try {
        out.close();
      }
 catch (      IOException ex) {
      }
    }
    if (!success) {
      f.delete();
    }
  }
}
