{
  checkPasswordReadPermission(userId);
  byte[] hash=mLockPatternUtils.passwordToHash(password,userId);
  byte[] storedHash=mStorage.readPasswordHash(userId);
  if (storedHash == null) {
    return true;
  }
  boolean matched=Arrays.equals(hash,storedHash);
  if (matched && !TextUtils.isEmpty(password)) {
    maybeUpdateKeystore(password,userId);
  }
  return matched;
}
