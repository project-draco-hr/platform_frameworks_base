{
  if (mUserManager.getUserInfo(userId).isManagedProfile()) {
    return;
  }
  final boolean isSecure=mStorage.hasPassword(userId) || mStorage.hasPattern(userId);
  final List<UserInfo> profiles=mUserManager.getProfiles(userId);
  final int size=profiles.size();
  for (int i=0; i < size; i++) {
    final UserInfo profile=profiles.get(i);
    if (profile.isManagedProfile()) {
      final int managedUserId=profile.id;
      if (mLockPatternUtils.isSeparateProfileChallengeEnabled(managedUserId)) {
        continue;
      }
      if (isSecure) {
        tieManagedProfileLockIfNecessary(managedUserId,null);
      }
 else {
        clearUserKeyProtection(managedUserId);
        getGateKeeperService().clearSecureUserId(managedUserId);
        mStorage.writePatternHash(null,managedUserId);
        setKeystorePassword(null,managedUserId);
        fixateNewestUserKeyAuth(managedUserId);
        mStorage.removeChildProfileLock(managedUserId);
        removeKeystoreProfileKey(managedUserId);
      }
    }
  }
}
