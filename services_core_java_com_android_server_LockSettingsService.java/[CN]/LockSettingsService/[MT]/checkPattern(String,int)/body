{
  checkPasswordReadPermission(userId);
  byte[] hash=LockPatternUtils.patternToHash(LockPatternUtils.stringToPattern(pattern));
  byte[] storedHash=mStorage.readPatternHash(userId);
  if (storedHash == null) {
    return true;
  }
  boolean matched=Arrays.equals(hash,storedHash);
  if (matched && !TextUtils.isEmpty(pattern)) {
    maybeUpdateKeystore(pattern,userId);
  }
  return matched;
}
