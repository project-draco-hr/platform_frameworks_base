{
  checkPasswordReadPermission(userId);
  try {
    RandomAccessFile raf=new RandomAccessFile(getLockPatternFilename(userId),"r");
    final byte[] stored=new byte[(int)raf.length()];
    int got=raf.read(stored,0,stored.length);
    raf.close();
    if (got <= 0) {
      return true;
    }
    final byte[] hash=LockPatternUtils.patternToHash(LockPatternUtils.stringToPattern(pattern));
    final boolean matched=Arrays.equals(stored,hash);
    if (matched && !TextUtils.isEmpty(pattern)) {
      maybeUpdateKeystore(pattern,userId);
    }
    return matched;
  }
 catch (  FileNotFoundException fnfe) {
    Slog.e(TAG,"Cannot read file " + fnfe);
  }
catch (  IOException ioe) {
    Slog.e(TAG,"Cannot read file " + ioe);
  }
  return true;
}
