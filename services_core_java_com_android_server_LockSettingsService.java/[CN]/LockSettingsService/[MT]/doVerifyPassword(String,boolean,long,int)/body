{
  checkPasswordReadPermission(userId);
  CredentialHash storedHash=mStorage.readPasswordHash(userId);
  return verifyCredential(userId,storedHash,password,hasChallenge,challenge,new CredentialUtil(){
    @Override public void setCredential(    String password,    String oldPassword,    int userId) throws RemoteException {
      setLockPassword(password,oldPassword,userId);
    }
    @Override public byte[] toHash(    String password,    int userId){
      return mLockPatternUtils.passwordToHash(password,userId);
    }
  }
);
}
