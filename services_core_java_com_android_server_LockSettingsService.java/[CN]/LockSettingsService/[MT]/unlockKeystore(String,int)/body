{
  final UserManager um=(UserManager)mContext.getSystemService(USER_SERVICE);
  final KeyStore ks=KeyStore.getInstance();
  if (um.getUserInfo(userHandle).isManagedProfile()) {
    if (mLockPatternUtils.isSeparateProfileChallengeEnabled(userHandle)) {
      ks.unlock(userHandle,password);
    }
 else {
      throw new RuntimeException("Can't unlock a profile explicitly if it " + "doesn't have a profile challenge.");
    }
  }
 else {
    final List<UserInfo> profiles=um.getProfiles(userHandle);
    for (    UserInfo pi : profiles) {
      if (pi.id == userHandle || (pi.isManagedProfile() && !mLockPatternUtils.isSeparateProfileChallengeEnabled(pi.id))) {
        ks.unlock(pi.id,password);
      }
    }
  }
}
