{
  mContext=context;
  mWindowManagerFuncs=windowManagerFuncs;
  mAudioManager=(AudioManager)mContext.getSystemService(Context.AUDIO_SERVICE);
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_CLOSE_SYSTEM_DIALOGS);
  filter.addAction(Intent.ACTION_SCREEN_OFF);
  filter.addAction(TelephonyIntents.ACTION_EMERGENCY_CALLBACK_MODE_CHANGED);
  context.registerReceiver(mBroadcastReceiver,filter);
  TelephonyManager telephonyManager=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  telephonyManager.listen(mPhoneStateListener,PhoneStateListener.LISTEN_SERVICE_STATE);
  ConnectivityManager cm=(ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);
  mHasTelephony=cm.isNetworkSupported(ConnectivityManager.TYPE_MOBILE);
  mContext.getContentResolver().registerContentObserver(Settings.Global.getUriFor(Settings.Global.AIRPLANE_MODE_ON),true,mAirplaneModeObserver);
  Vibrator vibrator=(Vibrator)mContext.getSystemService(Context.VIBRATOR_SERVICE);
  mHasVibrator=vibrator != null && vibrator.hasVibrator();
}
