{
  if (mPowerState.getScreenState() != state) {
    final boolean wasOn=(mPowerState.getScreenState() != Display.STATE_OFF);
    mPowerState.setScreenState(state);
    try {
      mBatteryStats.noteScreenState(state);
    }
 catch (    RemoteException ex) {
    }
  }
  final boolean isOff=(state == Display.STATE_OFF);
  if (isOff && !mReportedScreenOffToPolicy && !mScreenOffBecauseOfProximity) {
    mReportedScreenOffToPolicy=true;
    unblockScreenOn();
    mWindowManagerPolicy.screenTurnedOff();
  }
 else   if (!isOff && mReportedScreenOffToPolicy) {
    mReportedScreenOffToPolicy=false;
    if (mPowerState.getColorFadeLevel() == 0.0f) {
      blockScreenOn();
    }
 else {
      unblockScreenOn();
    }
    mWindowManagerPolicy.screenTurningOn(mPendingScreenOnUnblocker);
  }
  return mPendingScreenOnUnblocker == null;
}
