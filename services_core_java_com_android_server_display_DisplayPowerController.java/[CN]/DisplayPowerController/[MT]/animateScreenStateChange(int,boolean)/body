{
  if (mColorFadeOnAnimator.isStarted() || mColorFadeOffAnimator.isStarted()) {
    return;
  }
  if (mPowerRequest.blockScreenOn && mPowerState.getColorFadeLevel() == 0.0f && target != Display.STATE_OFF) {
    blockScreenOn();
    return;
  }
  if (target == Display.STATE_ON) {
    unblockScreenOn();
    setScreenState(Display.STATE_ON);
    if (USE_COLOR_FADE_ON_ANIMATION && mPowerRequest.isBrightOrDim()) {
      if (mPowerState.getColorFadeLevel() == 1.0f) {
        mPowerState.dismissColorFade();
      }
 else       if (mPowerState.prepareColorFade(mContext,mColorFadeFadesConfig ? ColorFade.MODE_FADE : ColorFade.MODE_WARM_UP)) {
        mColorFadeOnAnimator.start();
      }
 else {
        mColorFadeOnAnimator.end();
      }
    }
 else {
      mPowerState.setColorFadeLevel(1.0f);
      mPowerState.dismissColorFade();
    }
  }
 else   if (target == Display.STATE_DOZE) {
    if (mScreenBrightnessRampAnimator.isAnimating() && mPowerState.getScreenState() == Display.STATE_ON) {
      return;
    }
    unblockScreenOn();
    setScreenState(Display.STATE_DOZE);
    mPowerState.setColorFadeLevel(1.0f);
    mPowerState.dismissColorFade();
  }
 else   if (target == Display.STATE_DOZE_SUSPEND) {
    if (mScreenBrightnessRampAnimator.isAnimating() && mPowerState.getScreenState() != Display.STATE_DOZE_SUSPEND) {
      return;
    }
    unblockScreenOn();
    setScreenState(Display.STATE_DOZE_SUSPEND);
    mPowerState.setColorFadeLevel(1.0f);
    mPowerState.dismissColorFade();
  }
 else {
    unblockScreenOn();
    if (mPowerState.getColorFadeLevel() == 0.0f) {
      setScreenState(Display.STATE_OFF);
    }
 else     if (performScreenOffTransition && mPowerState.prepareColorFade(mContext,mColorFadeFadesConfig ? ColorFade.MODE_FADE : ColorFade.MODE_COOL_DOWN) && mPowerState.getScreenState() != Display.STATE_OFF) {
      mColorFadeOffAnimator.start();
    }
 else {
      mColorFadeOffAnimator.end();
    }
  }
}
