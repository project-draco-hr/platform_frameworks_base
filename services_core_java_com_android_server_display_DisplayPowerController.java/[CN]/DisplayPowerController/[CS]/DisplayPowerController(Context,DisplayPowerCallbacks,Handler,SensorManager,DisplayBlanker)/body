{
  mHandler=new DisplayControllerHandler(handler.getLooper());
  mCallbacks=callbacks;
  mBatteryStats=BatteryStatsService.getService();
  mLights=LocalServices.getService(LightsManager.class);
  mSensorManager=sensorManager;
  mBlanker=blanker;
  final Resources resources=context.getResources();
  mScreenBrightnessDozeConfig=clampAbsoluteBrightness(resources.getInteger(com.android.internal.R.integer.config_screenBrightnessDoze));
  mScreenBrightnessDimConfig=clampAbsoluteBrightness(resources.getInteger(com.android.internal.R.integer.config_screenBrightnessDim));
  int screenBrightnessRangeMinimum=clampAbsoluteBrightness(Math.min(resources.getInteger(com.android.internal.R.integer.config_screenBrightnessSettingMinimum),mScreenBrightnessDimConfig));
  mScreenBrightnessRangeMaximum=PowerManager.BRIGHTNESS_ON;
  mUseSoftwareAutoBrightnessConfig=resources.getBoolean(com.android.internal.R.bool.config_automatic_brightness_available);
  if (mUseSoftwareAutoBrightnessConfig) {
    int[] lux=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessLevels);
    int[] screenBrightness=resources.getIntArray(com.android.internal.R.array.config_autoBrightnessLcdBacklightValues);
    int lightSensorWarmUpTimeConfig=resources.getInteger(com.android.internal.R.integer.config_lightSensorWarmupTime);
    Spline screenAutoBrightnessSpline=createAutoBrightnessSpline(lux,screenBrightness);
    if (screenAutoBrightnessSpline == null) {
      Slog.e(TAG,"Error in config.xml.  config_autoBrightnessLcdBacklightValues " + "(size " + screenBrightness.length + ") "+ "must be monotic and have exactly one more entry than "+ "config_autoBrightnessLevels (size "+ lux.length+ ") "+ "which must be strictly increasing.  "+ "Auto-brightness will be disabled.");
      mUseSoftwareAutoBrightnessConfig=false;
    }
 else {
      if (screenBrightness[0] < screenBrightnessRangeMinimum) {
        screenBrightnessRangeMinimum=clampAbsoluteBrightness(screenBrightness[0]);
      }
      mAutomaticBrightnessController=new AutomaticBrightnessController(this,handler.getLooper(),sensorManager,screenAutoBrightnessSpline,lightSensorWarmUpTimeConfig,screenBrightnessRangeMinimum,mScreenBrightnessRangeMaximum);
    }
  }
  mScreenBrightnessRangeMinimum=screenBrightnessRangeMinimum;
  mElectronBeamFadesConfig=resources.getBoolean(com.android.internal.R.bool.config_animateScreenLights);
  if (!DEBUG_PRETEND_PROXIMITY_SENSOR_ABSENT) {
    mProximitySensor=mSensorManager.getDefaultSensor(Sensor.TYPE_PROXIMITY);
    if (mProximitySensor != null) {
      mProximityThreshold=Math.min(mProximitySensor.getMaximumRange(),TYPICAL_PROXIMITY_THRESHOLD);
    }
  }
}
