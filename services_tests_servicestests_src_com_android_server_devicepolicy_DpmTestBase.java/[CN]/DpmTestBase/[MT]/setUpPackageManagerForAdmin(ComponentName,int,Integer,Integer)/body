{
  final ApplicationInfo ai=DpmTestUtils.cloneParcelable(mRealTestContext.getPackageManager().getApplicationInfo(admin.getPackageName(),PackageManager.GET_DISABLED_UNTIL_USED_COMPONENTS));
  ai.enabledSetting=enabledSetting == null ? PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED : enabledSetting;
  if (appTargetSdk != null) {
    ai.targetSdkVersion=appTargetSdk;
  }
  ai.uid=packageUid;
  doReturn(ai).when(mMockContext.ipackageManager).getApplicationInfo(eq(admin.getPackageName()),eq(PackageManager.GET_DISABLED_UNTIL_USED_COMPONENTS),eq(UserHandle.getUserId(packageUid)));
  final Intent resolveIntent=new Intent();
  resolveIntent.setComponent(admin);
  final List<ResolveInfo> realResolveInfo=mRealTestContext.getPackageManager().queryBroadcastReceivers(resolveIntent,PackageManager.GET_META_DATA);
  assertNotNull(realResolveInfo);
  assertEquals(1,realResolveInfo.size());
  realResolveInfo.set(0,DpmTestUtils.cloneParcelable(realResolveInfo.get(0)));
  realResolveInfo.get(0).activityInfo.applicationInfo=ai;
  doReturn(realResolveInfo).when(mMockContext.packageManager).queryBroadcastReceiversAsUser(MockUtils.checkIntentComponent(admin),anyInt(),eq(UserHandle.getUserId(packageUid)));
  markPackageAsInstalled(admin.getPackageName(),ai,UserHandle.getUserId(packageUid));
}
