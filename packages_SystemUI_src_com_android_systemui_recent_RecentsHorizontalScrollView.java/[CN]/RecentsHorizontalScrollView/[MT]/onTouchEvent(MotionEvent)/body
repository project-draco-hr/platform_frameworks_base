{
  if (!mDragging) {
    return super.onTouchEvent(ev);
  }
  mVelocityTracker.addMovement(ev);
  final View animView=mCurrentView;
switch (ev.getAction()) {
case MotionEvent.ACTION_MOVE:
    if (animView != null) {
      final float delta=ev.getY() - mLastY;
      final View thumb=animView.findViewById(R.id.app_thumbnail);
      animView.setY(animView.getY() + delta);
      animView.setAlpha(getAlphaForOffset(animView,thumb.getHeight()));
      invalidateGlobalRegion(animView);
    }
  mLastY=ev.getY();
break;
case MotionEvent.ACTION_UP:
final ObjectAnimator anim;
if (animView != null) {
final VelocityTracker velocityTracker=mVelocityTracker;
velocityTracker.computeCurrentVelocity(1000,10000);
final float velocityX=velocityTracker.getXVelocity();
final float velocityY=velocityTracker.getYVelocity();
final float curY=animView.getY();
final float newY=(velocityY >= 0.0f ? 1 : -1) * animView.getHeight();
final float maxVelocity=Constants.ESCAPE_VELOCITY * mDensityScale;
if (Math.abs(velocityY) > Math.abs(velocityX) && Math.abs(velocityY) > maxVelocity && (velocityY >= 0.0f) == (animView.getY() >= 0)) {
long duration=(long)(Math.abs(newY - curY) * 1000.0f / Math.abs(velocityY));
duration=Math.min(duration,Constants.MAX_ESCAPE_ANIMATION_DURATION);
anim=animateClosed(animView,duration,"y",curY,newY);
}
 else {
long duration=Math.abs(velocityY) > 0.0f ? (long)(Math.abs(newY - curY) * 1000.0f / Math.abs(velocityY)) : Constants.SNAP_BACK_DURATION;
duration=Math.min(duration,Constants.SNAP_BACK_DURATION);
anim=ObjectAnimator.ofFloat(animView,"y",animView.getY(),0.0f);
anim.setInterpolator(new DecelerateInterpolator(4.0f));
anim.setDuration(duration);
}
final View thumb=animView.findViewById(R.id.app_thumbnail);
anim.addUpdateListener(new AnimatorUpdateListener(){
public void onAnimationUpdate(ValueAnimator animation){
  animView.setAlpha(getAlphaForOffset(animView,thumb.getHeight()));
  invalidateGlobalRegion(animView);
}
}
);
anim.start();
}
mVelocityTracker.recycle();
mVelocityTracker=null;
break;
}
return true;
}
