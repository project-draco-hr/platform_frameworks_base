{
  if (mRegisteredContext != null) {
    throw new IllegalStateException("Already registered");
  }
  mRegisteredContext=context;
  if (thread == null) {
synchronized (sLock) {
      if (sBackgroundThread == null) {
        sBackgroundThread=new HandlerThread("PackageMonitor",android.os.Process.THREAD_PRIORITY_BACKGROUND);
        sBackgroundThread.start();
        sBackgroundHandler=new Handler(sBackgroundThread.getLooper());
      }
      mRegisteredHandler=sBackgroundHandler;
    }
  }
 else {
    mRegisteredHandler=new Handler(thread);
  }
  context.registerReceiver(this,sPackageFilt,null,mRegisteredHandler);
  context.registerReceiver(this,sNonDataFilt,null,mRegisteredHandler);
  if (externalStorage) {
    context.registerReceiver(this,sExternalFilt,null,mRegisteredHandler);
  }
}
