{
synchronized (mLockObject) {
    Set<Long> deletableKeySets=getKnownKeySetsByPackageNameLocked(packageName);
    Set<Long> deletableKeys=new HashSet<Long>();
    Set<Long> knownKeys=null;
    for (    Long ks : deletableKeySets) {
      knownKeys=mKeySetMapping.get(ks);
      if (knownKeys != null) {
        deletableKeys.addAll(knownKeys);
      }
    }
    for (    String pkgName : mPackages.keySet()) {
      if (pkgName.equals(packageName)) {
        continue;
      }
      Set<Long> knownKeySets=getKnownKeySetsByPackageNameLocked(pkgName);
      deletableKeySets.removeAll(knownKeySets);
      knownKeys=new HashSet<Long>();
      for (      Long ks : knownKeySets) {
        knownKeys=mKeySetMapping.get(ks);
        if (knownKeys != null) {
          deletableKeys.removeAll(knownKeys);
        }
      }
    }
    for (    Long ks : deletableKeySets) {
      mKeySets.delete(ks);
      mKeySetMapping.delete(ks);
    }
    for (    Long keyId : deletableKeys) {
      mPublicKeys.delete(keyId);
    }
    for (    String pkgName : mPackages.keySet()) {
      PackageSetting p=mPackages.get(packageName);
      for (      Long ks : deletableKeySets) {
        p.keySetData.removeSigningKeySet(ks);
        p.keySetData.removeDefinedKeySet(ks);
      }
    }
  }
}
