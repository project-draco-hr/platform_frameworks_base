{
  Log.e(TAG,"Removing application " + packageName);
synchronized (mLockObject) {
    Set<Long> deletableKeySets=getKnownKeySetsByPackageName(packageName);
    Set<Long> deletableKeys=new HashSet<Long>();
    for (    Long ks : deletableKeySets) {
      deletableKeys.addAll(mKeySetMapping.get(ks));
    }
    for (    String pkgName : mPackages.keySet()) {
      if (pkgName.equals(packageName)) {
        continue;
      }
      Set<Long> knownKeySets=getKnownKeySetsByPackageName(pkgName);
      deletableKeySets.removeAll(knownKeySets);
      Set<Long> knownKeys=new HashSet<Long>();
      for (      Long ks : knownKeySets) {
        deletableKeys.removeAll(mKeySetMapping.get(ks));
      }
    }
    for (    Long ks : deletableKeySets) {
      mKeySets.delete(ks);
      mKeySetMapping.delete(ks);
    }
    for (    Long keyId : deletableKeys) {
      mPublicKeys.delete(keyId);
    }
  }
}
