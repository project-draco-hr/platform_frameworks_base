{
  int read=0;
  clearBuffer();
  try {
    log("Reading one line: started =" + readStarted + " avail="+ is.available());
    while ((!readStarted) || (is.available() > 0)) {
      int data=is.read();
      if (data == -1) {
        log("EOF returned");
        return -1;
      }
      buf[read]=(byte)data;
      System.out.print((char)data);
      readStarted=true;
      if (buf[read++] == (byte)'\n') {
        System.out.println();
        return read;
      }
    }
  }
 catch (  IOException e) {
    log("IOException from readOneLine");
    e.printStackTrace();
  }
  return read;
}
