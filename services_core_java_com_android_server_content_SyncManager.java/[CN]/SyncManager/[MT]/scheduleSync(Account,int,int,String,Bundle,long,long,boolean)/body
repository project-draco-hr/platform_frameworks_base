{
  final boolean isLoggable=Log.isLoggable(TAG,Log.VERBOSE);
  if (extras == null) {
    extras=new Bundle();
  }
  if (isLoggable) {
    Log.d(TAG,"one-time sync for: " + requestedAccount + " "+ extras.toString()+ " "+ requestedAuthority);
  }
  AccountAndUser[] accounts;
  if (requestedAccount != null && userId != UserHandle.USER_ALL) {
    accounts=new AccountAndUser[]{new AccountAndUser(requestedAccount,userId)};
  }
 else {
    accounts=mRunningAccounts;
    if (accounts.length == 0) {
      if (isLoggable) {
        Slog.v(TAG,"scheduleSync: no accounts configured, dropping");
      }
      return;
    }
  }
  final boolean uploadOnly=extras.getBoolean(ContentResolver.SYNC_EXTRAS_UPLOAD,false);
  final boolean manualSync=extras.getBoolean(ContentResolver.SYNC_EXTRAS_MANUAL,false);
  if (manualSync) {
    extras.putBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_BACKOFF,true);
    extras.putBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_SETTINGS,true);
  }
  final boolean ignoreSettings=extras.getBoolean(ContentResolver.SYNC_EXTRAS_IGNORE_SETTINGS,false);
  int source;
  if (uploadOnly) {
    source=SyncStorageEngine.SOURCE_LOCAL;
  }
 else   if (manualSync) {
    source=SyncStorageEngine.SOURCE_USER;
  }
 else   if (requestedAuthority == null) {
    source=SyncStorageEngine.SOURCE_POLL;
  }
 else {
    source=SyncStorageEngine.SOURCE_SERVER;
  }
  for (  AccountAndUser account : accounts) {
    if (userId >= UserHandle.USER_SYSTEM && account.userId >= UserHandle.USER_SYSTEM && userId != account.userId) {
      continue;
    }
    final HashSet<String> syncableAuthorities=new HashSet<String>();
    for (    RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapter : mSyncAdapters.getAllServices(account.userId)) {
      syncableAuthorities.add(syncAdapter.type.authority);
    }
    if (requestedAuthority != null) {
      final boolean hasSyncAdapter=syncableAuthorities.contains(requestedAuthority);
      syncableAuthorities.clear();
      if (hasSyncAdapter)       syncableAuthorities.add(requestedAuthority);
    }
    for (    String authority : syncableAuthorities) {
      int isSyncable=getIsSyncable(account.account,account.userId,authority);
      if (isSyncable == AuthorityInfo.NOT_SYNCABLE) {
        continue;
      }
      final RegisteredServicesCache.ServiceInfo<SyncAdapterType> syncAdapterInfo;
      syncAdapterInfo=mSyncAdapters.getServiceInfo(SyncAdapterType.newKey(authority,account.account.type),account.userId);
      if (syncAdapterInfo == null) {
        continue;
      }
      final int owningUid=syncAdapterInfo.uid;
      final String owningPackage=syncAdapterInfo.componentName.getPackageName();
      try {
        if (ActivityManagerNative.getDefault().getAppStartMode(owningUid,owningPackage) == ActivityManager.APP_START_MODE_DISABLED) {
          Slog.w(TAG,"Not scheduling job " + syncAdapterInfo.uid + ":"+ syncAdapterInfo.componentName+ " -- package not allowed to start");
          continue;
        }
      }
 catch (      RemoteException e) {
      }
      final boolean allowParallelSyncs=syncAdapterInfo.type.allowParallelSyncs();
      final boolean isAlwaysSyncable=syncAdapterInfo.type.isAlwaysSyncable();
      if (isSyncable < 0 && isAlwaysSyncable) {
        mSyncStorageEngine.setIsSyncable(account.account,account.userId,authority,AuthorityInfo.SYNCABLE);
        isSyncable=AuthorityInfo.SYNCABLE;
      }
      if (onlyThoseWithUnkownSyncableState && isSyncable >= 0) {
        continue;
      }
      if (!syncAdapterInfo.type.supportsUploading() && uploadOnly) {
        continue;
      }
      boolean syncAllowed=(isSyncable < 0) || ignoreSettings || (mSyncStorageEngine.getMasterSyncAutomatically(account.userId) && mSyncStorageEngine.getSyncAutomatically(account.account,account.userId,authority));
      if (!syncAllowed) {
        if (isLoggable) {
          Log.d(TAG,"scheduleSync: sync of " + account + ", "+ authority+ " is not allowed, dropping request");
        }
        continue;
      }
      SyncStorageEngine.EndPoint info=new SyncStorageEngine.EndPoint(account.account,authority,account.userId);
      long delayUntil=mSyncStorageEngine.getDelayUntilTime(info);
      if (isSyncable < 0) {
        Bundle newExtras=new Bundle();
        newExtras.putBoolean(ContentResolver.SYNC_EXTRAS_INITIALIZE,true);
        if (isLoggable) {
          Slog.v(TAG,"schedule initialisation Sync:" + ", delay until " + delayUntil + ", run by "+ 0+ ", flexMillis "+ 0+ ", source "+ source+ ", account "+ account+ ", authority "+ authority+ ", extras "+ newExtras);
        }
        postScheduleSyncMessage(new SyncOperation(account.account,account.userId,owningUid,owningPackage,reason,source,authority,newExtras,allowParallelSyncs));
      }
      if (!onlyThoseWithUnkownSyncableState) {
        if (isLoggable) {
          Slog.v(TAG,"scheduleSync:" + " delay until " + delayUntil + " run by "+ runtimeMillis+ " flexMillis "+ beforeRuntimeMillis+ ", source "+ source+ ", account "+ account+ ", authority "+ authority+ ", extras "+ extras);
        }
        postScheduleSyncMessage(new SyncOperation(account.account,account.userId,owningUid,owningPackage,reason,source,authority,extras,allowParallelSyncs));
      }
    }
  }
}
