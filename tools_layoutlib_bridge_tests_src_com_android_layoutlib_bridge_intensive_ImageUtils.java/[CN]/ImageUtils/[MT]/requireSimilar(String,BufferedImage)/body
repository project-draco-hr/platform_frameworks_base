{
  int maxDimension=Math.max(image.getWidth(),image.getHeight());
  double scale=THUMBNAIL_SIZE / (double)maxDimension;
  BufferedImage thumbnail=scale(image,scale,scale);
  InputStream is=ImageUtils.class.getResourceAsStream(relativePath);
  if (is == null) {
    String message="Unable to load golden thumbnail: " + relativePath + "\n";
    message=saveImageAndAppendMessage(thumbnail,message,relativePath);
    if (FAIL_ON_MISSING_THUMBNAIL) {
      fail(message);
    }
 else {
      System.out.println(message);
    }
  }
 else {
    try {
      BufferedImage goldenImage=ImageIO.read(is);
      assertImageSimilar(relativePath,goldenImage,thumbnail,MAX_PERCENT_DIFFERENCE);
    }
  finally {
      is.close();
    }
  }
}
