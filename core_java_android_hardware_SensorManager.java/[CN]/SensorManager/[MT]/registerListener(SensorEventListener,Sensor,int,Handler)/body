{
  if (listener == null || sensor == null) {
    return false;
  }
  boolean result;
  int delay=-1;
switch (rate) {
case SENSOR_DELAY_FASTEST:
    delay=0;
  break;
case SENSOR_DELAY_GAME:
delay=20;
break;
case SENSOR_DELAY_UI:
delay=60;
break;
case SENSOR_DELAY_NORMAL:
delay=200;
break;
default :
return false;
}
try {
synchronized (sListeners) {
ListenerDelegate l=null;
for (ListenerDelegate i : sListeners) {
if (i.getListener() == listener) {
l=i;
break;
}
}
String name=sensor.getName();
int handle=sensor.getHandle();
if (l == null) {
result=false;
l=new ListenerDelegate(listener,sensor,handler);
sListeners.add(l);
if (!sListeners.isEmpty()) {
result=sSensorThread.startLocked(mSensorService);
if (result) {
result=mSensorService.enableSensor(l,name,handle,delay);
if (!result) {
sListeners.remove(l);
}
}
}
}
 else {
result=mSensorService.enableSensor(l,name,handle,delay);
if (result) {
l.addSensor(sensor);
}
}
}
}
 catch (RemoteException e) {
Log.e(TAG,"RemoteException in registerListener: ",e);
result=false;
}
return result;
}
