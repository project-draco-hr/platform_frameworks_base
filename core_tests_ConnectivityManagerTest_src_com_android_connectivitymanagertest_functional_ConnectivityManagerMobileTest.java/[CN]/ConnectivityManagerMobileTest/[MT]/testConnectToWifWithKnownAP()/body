{
  assertNotNull("SSID is null",mSsid);
  assertTrue("failed to enable wifi",enableWifi());
  assertTrue("wifi not enabled",waitForWifiState(WifiManager.WIFI_STATE_ENABLED,LONG_TIMEOUT));
  assertTrue("failed to connect to " + mSsid,connectToWifi(mSsid,mPassword));
  assertTrue("wifi not connected",waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,WIFI_CONNECTION_TIMEOUT));
  assertTrue("failed to disable wifi",disableWifi());
  assertTrue("wifi state not disabled",waitForWifiState(WifiManager.WIFI_STATE_DISABLED,LONG_TIMEOUT));
  if (!mWifiOnlyFlag) {
    assertTrue("mobile not connected after wifi disable",waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,LONG_TIMEOUT));
  }
  SystemClock.sleep(LONG_TIMEOUT);
  assertTrue("failed to enable wifi after disable",enableWifi());
  assertTrue("wifi not enabled after toggle",waitForWifiState(WifiManager.WIFI_STATE_ENABLED,LONG_TIMEOUT));
  assertTrue("wifi not connected after toggle",waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,WIFI_CONNECTION_TIMEOUT));
  assertTrue("no network connectivity at end of test",checkNetworkConnectivity());
}
