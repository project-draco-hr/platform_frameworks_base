{
  assertNotNull("SSID is null",mTestAccessPoint);
  assertTrue("failed to connect to " + mTestAccessPoint,connectToWifi(mTestAccessPoint));
  assertTrue(waitForWifiState(WifiManager.WIFI_STATE_ENABLED,LONG_TIMEOUT));
  assertTrue(waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,WIFI_CONNECTION_TIMEOUT));
  sleep(SHORT_TIMEOUT);
  log("Disable Wifi");
  if (!disableWifi()) {
    log("disable Wifi failed");
    return;
  }
  assertTrue(waitForWifiState(WifiManager.WIFI_STATE_DISABLED,LONG_TIMEOUT));
  assertTrue(waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.DISCONNECTED,LONG_TIMEOUT));
  if (!mWifiOnlyFlag) {
    assertTrue(waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,LONG_TIMEOUT));
  }
  NetworkInfo networkInfo;
  if (!mWifiOnlyFlag) {
    networkInfo=mCM.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
    setStateTransitionCriteria(ConnectivityManager.TYPE_MOBILE,networkInfo.getState(),NetworkState.DO_NOTHING,State.DISCONNECTED);
  }
  networkInfo=mCM.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
  setStateTransitionCriteria(ConnectivityManager.TYPE_WIFI,networkInfo.getState(),NetworkState.TO_CONNECTION,State.CONNECTED);
  sleep(WIFI_STOP_START_INTERVAL);
  log("Enable Wifi again");
  enableWifi();
  assertTrue(waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,WIFI_CONNECTION_TIMEOUT));
  if (!mWifiOnlyFlag) {
    assertTrue(waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.DISCONNECTED,LONG_TIMEOUT));
  }
  if (!validateNetworkStates(ConnectivityManager.TYPE_WIFI)) {
    log("Wifi state transition validation failed.");
    log("reason: " + getTransitionFailureReason(ConnectivityManager.TYPE_WIFI));
    assertTrue(false);
  }
}
