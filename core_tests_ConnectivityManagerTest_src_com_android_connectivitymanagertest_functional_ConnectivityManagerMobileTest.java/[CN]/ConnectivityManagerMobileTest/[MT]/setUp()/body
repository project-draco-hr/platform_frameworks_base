{
  super.setUp();
  cmActivity=getActivity();
  ConnectivityManagerTestRunner mRunner=(ConnectivityManagerTestRunner)getInstrumentation();
  mTestAccessPoint=mRunner.mTestSsid;
  mWifiOnlyFlag=mRunner.mWifiOnlyFlag;
  PowerManager pm=(PowerManager)getInstrumentation().getContext().getSystemService(Context.POWER_SERVICE);
  wl=pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK,"CMWakeLock");
  wl.acquire();
  if (Settings.Global.getInt(getInstrumentation().getContext().getContentResolver(),Settings.Global.AIRPLANE_MODE_ON) == 1) {
    log("airplane is not disabled, disable it.");
    cmActivity.setAirplaneMode(getInstrumentation().getContext(),false);
  }
  if (!mWifiOnlyFlag) {
    if (!cmActivity.waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT)) {
      tearDown();
      fail("Device is not connected to Mobile, setUp failed");
    }
  }
}
