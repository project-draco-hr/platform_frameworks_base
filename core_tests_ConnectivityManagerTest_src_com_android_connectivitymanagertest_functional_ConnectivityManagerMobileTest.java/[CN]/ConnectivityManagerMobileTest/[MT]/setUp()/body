{
  super.setUp();
  cmActivity=getActivity();
  ConnectivityManagerTestRunner mRunner=(ConnectivityManagerTestRunner)getInstrumentation();
  TEST_ACCESS_POINT=mRunner.TEST_SSID;
  PowerManager pm=(PowerManager)getInstrumentation().getContext().getSystemService(Context.POWER_SERVICE);
  wl=pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK,"CMWakeLock");
  wl.acquire();
  if (Settings.System.getInt(getInstrumentation().getContext().getContentResolver(),Settings.System.AIRPLANE_MODE_ON) == 1) {
    Log.v(LOG_TAG,"airplane is not disabled, disable it.");
    cmActivity.setAirplaneMode(getInstrumentation().getContext(),false);
  }
  if (!UtilHelper.isWifiOnly()) {
    if (!cmActivity.waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT)) {
      tearDown();
      fail("Device is not connected to Mobile, setUp failed");
    }
  }
}
