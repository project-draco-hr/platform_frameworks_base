{
  if (mWifiOnlyFlag) {
    logv(getName() + " is excluded for wifi-only test");
    return;
  }
  assertTrue("failed to disable wifi",disableWifi());
  assertTrue("wifi state not disabled",waitForWifiState(WifiManager.WIFI_STATE_DISABLED,LONG_TIMEOUT));
  assertTrue("no mobile connection",waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,LONG_TIMEOUT));
  mCm.setAirplaneMode(true);
  assertTrue("still has active network connection",waitUntilNoActiveNetworkConnection(LONG_TIMEOUT));
  mCm.setAirplaneMode(false);
  assertTrue("no active network connection after airplane mode disable",waitForActiveNetworkConnection(LONG_TIMEOUT));
  assertTrue("no mobile connection",waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,LONG_TIMEOUT));
  assertTrue("no network connectivity at end of test",checkNetworkConnectivity());
}
