{
  assertNotNull("SSID is null",mTestAccessPoint);
  assertTrue("failed to connect to " + mTestAccessPoint,cmActivity.connectToWifi(mTestAccessPoint));
  assertTrue(cmActivity.waitForWifiState(WifiManager.WIFI_STATE_ENABLED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,ConnectivityManagerTestActivity.WIFI_CONNECTION_TIMEOUT));
  assertNotNull("Not associated with any AP",cmActivity.mWifiManager.getConnectionInfo().getBSSID());
  try {
    Thread.sleep(ConnectivityManagerTestActivity.SHORT_TIMEOUT);
  }
 catch (  Exception e) {
    log("exception: " + e.toString());
  }
  log("disconnect from the AP");
  if (!cmActivity.disconnectAP()) {
    log("failed to disconnect from " + mTestAccessPoint);
  }
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.DISCONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  if (!cmActivity.disableWifi()) {
    log("disable Wifi failed");
    return;
  }
  assertTrue(cmActivity.waitForWifiState(WifiManager.WIFI_STATE_DISABLED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
}
