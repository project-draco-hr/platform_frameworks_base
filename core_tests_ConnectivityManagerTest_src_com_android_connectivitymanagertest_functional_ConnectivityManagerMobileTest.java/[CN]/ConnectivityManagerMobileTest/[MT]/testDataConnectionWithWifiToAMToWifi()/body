{
  assertNotNull("SSID is null",TEST_ACCESS_POINT);
  assertTrue("failed to connect to " + TEST_ACCESS_POINT,cmActivity.connectToWifi(TEST_ACCESS_POINT));
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  try {
    Thread.sleep(ConnectivityManagerTestActivity.SHORT_TIMEOUT);
  }
 catch (  Exception e) {
    log("exception: " + e.toString());
  }
  cmActivity.setAirplaneMode(getInstrumentation().getContext(),true);
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.DISCONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  try {
    Thread.sleep(ConnectivityManagerTestActivity.SHORT_TIMEOUT);
  }
 catch (  Exception e) {
    log("exception: " + e.toString());
  }
  NetworkInfo networkInfo=cmActivity.mCM.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
  assertEquals(State.DISCONNECTED,networkInfo.getState());
  cmActivity.setStateTransitionCriteria(ConnectivityManager.TYPE_WIFI,networkInfo.getState(),NetworkState.TO_CONNECTION,State.CONNECTED);
  cmActivity.setAirplaneMode(getInstrumentation().getContext(),false);
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.CONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  if (!UtilHelper.isWifiOnly()) {
    assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.DISCONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  }
  if (!cmActivity.validateNetworkStates(ConnectivityManager.TYPE_WIFI)) {
    log("Wifi state transition validation failed.");
    log("reason: " + cmActivity.getTransitionFailureReason(ConnectivityManager.TYPE_WIFI));
    assertTrue(false);
  }
}
