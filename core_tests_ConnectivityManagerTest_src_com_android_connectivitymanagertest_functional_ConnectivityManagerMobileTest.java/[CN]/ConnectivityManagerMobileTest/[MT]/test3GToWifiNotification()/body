{
  if (mWifiOnlyFlag) {
    Log.v(LOG_TAG,this.getName() + " is excluded for wifi-only test");
    return;
  }
  cmActivity.enableWifi();
  sleep(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT);
  cmActivity.disableWifi();
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_WIFI,State.DISCONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  assertTrue(cmActivity.waitForNetworkState(ConnectivityManager.TYPE_MOBILE,State.CONNECTED,ConnectivityManagerTestActivity.LONG_TIMEOUT));
  sleep(10 * 1000);
  NetworkInfo networkInfo=cmActivity.mCM.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
  cmActivity.setStateTransitionCriteria(ConnectivityManager.TYPE_MOBILE,networkInfo.getState(),NetworkState.DO_NOTHING,State.CONNECTED);
  networkInfo=cmActivity.mCM.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
  cmActivity.setStateTransitionCriteria(ConnectivityManager.TYPE_WIFI,networkInfo.getState(),NetworkState.DO_NOTHING,State.DISCONNECTED);
  cmActivity.enableWifi();
  sleep(2 * ConnectivityManagerTestActivity.SHORT_TIMEOUT);
  if (!cmActivity.validateNetworkStates(ConnectivityManager.TYPE_WIFI)) {
    log("the state for WIFI is changed");
    log("reason: " + cmActivity.getTransitionFailureReason(ConnectivityManager.TYPE_WIFI));
    assertTrue("state validation fail",false);
  }
  if (!cmActivity.validateNetworkStates(ConnectivityManager.TYPE_MOBILE)) {
    log("the state for MOBILE is changed");
    log("reason: " + cmActivity.getTransitionFailureReason(ConnectivityManager.TYPE_MOBILE));
    assertTrue("state validation fail",false);
  }
  verifyCellularConnection();
}
