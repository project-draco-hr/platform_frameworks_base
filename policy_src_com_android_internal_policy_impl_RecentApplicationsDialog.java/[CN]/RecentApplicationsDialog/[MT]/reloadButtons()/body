{
  final Context context=getContext();
  final PackageManager pm=context.getPackageManager();
  final ActivityManager am=(ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);
  final List<ActivityManager.RecentTaskInfo> recentTasks=am.getRecentTasks(MAX_RECENT_TASKS,ActivityManager.RECENT_IGNORE_UNAVAILABLE);
  ActivityInfo homeInfo=new Intent(Intent.ACTION_MAIN).addCategory(Intent.CATEGORY_HOME).resolveActivityInfo(pm,0);
  IconUtilities iconUtilities=new IconUtilities(getContext());
  int index=0;
  int numTasks=recentTasks.size();
  for (int i=0; i < numTasks && (index < NUM_BUTTONS); ++i) {
    final ActivityManager.RecentTaskInfo info=recentTasks.get(i);
    if (DBG_FORCE_EMPTY_LIST && (i == 0))     continue;
    Intent intent=new Intent(info.baseIntent);
    if (info.origActivity != null) {
      intent.setComponent(info.origActivity);
    }
    if (homeInfo != null) {
      if (homeInfo.packageName.equals(intent.getComponent().getPackageName()) && homeInfo.name.equals(intent.getComponent().getClassName())) {
        continue;
      }
    }
    intent.setFlags((intent.getFlags() & ~Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) | Intent.FLAG_ACTIVITY_NEW_TASK);
    final ResolveInfo resolveInfo=pm.resolveActivity(intent,0);
    if (resolveInfo != null) {
      final ActivityInfo activityInfo=resolveInfo.activityInfo;
      final String title=activityInfo.loadLabel(pm).toString();
      Drawable icon=activityInfo.loadIcon(pm);
      if (title != null && title.length() > 0 && icon != null) {
        final TextView tv=mIcons[index];
        tv.setText(title);
        icon=iconUtilities.createIconDrawable(icon);
        tv.setCompoundDrawables(null,icon,null,null);
        RecentTag tag=new RecentTag();
        tag.info=info;
        tag.intent=intent;
        tv.setTag(tag);
        tv.setVisibility(View.VISIBLE);
        tv.setPressed(false);
        tv.clearFocus();
        ++index;
      }
    }
  }
  mNoAppsText.setVisibility((index == 0) ? View.VISIBLE : View.GONE);
  for (; index < NUM_BUTTONS; ++index) {
    mIcons[index].setVisibility(View.GONE);
  }
}
