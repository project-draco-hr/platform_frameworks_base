{
  ProcessState proc=pkgList.valueAt(index);
  if (mDead && proc.mCommonProcess != proc) {
    Log.wtf(TAG,"Pulling dead proc: name=" + mName + " pkg="+ mPackage+ " uid="+ mUid+ " common.name="+ mCommonProcess.mName);
    proc=mStats.getProcessStateLocked(proc.mPackage,proc.mUid,proc.mName);
  }
  if (proc.mMultiPackage) {
    PackageState pkg=mStats.mPackages.get(pkgList.keyAt(index),proc.mUid);
    if (pkg == null) {
      throw new IllegalStateException("No existing package " + pkgList.keyAt(index) + "/"+ proc.mUid+ " for multi-proc "+ proc.mName);
    }
    proc=pkg.mProcesses.get(proc.mName);
    if (proc == null) {
      throw new IllegalStateException("Didn't create per-package process " + proc.mName + " in pkg "+ pkg.mPackageName+ "/"+ pkg.mUid);
    }
    pkgList.setValueAt(index,proc);
  }
  return proc;
}
