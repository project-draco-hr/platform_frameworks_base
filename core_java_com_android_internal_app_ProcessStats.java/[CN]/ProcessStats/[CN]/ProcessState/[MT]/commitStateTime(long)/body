{
  if (mCurState != STATE_NOTHING) {
    long dur=now - mStartTime;
    if (dur > 0) {
      int idx=binarySearch(mDurationsTable,mDurationsTableSize,mCurState);
      int off;
      if (idx >= 0) {
        off=mDurationsTable[idx];
      }
 else {
        mStats.mAddLongTable=mDurationsTable;
        mStats.mAddLongTableSize=mDurationsTableSize;
        off=mStats.addLongData(~idx,mCurState,1);
        mDurationsTable=mStats.mAddLongTable;
        mDurationsTableSize=mStats.mAddLongTableSize;
      }
      long[] longs=mStats.mLongs.get((off >> OFFSET_ARRAY_SHIFT) & OFFSET_ARRAY_MASK);
      longs[(off >> OFFSET_INDEX_SHIFT) & OFFSET_INDEX_MASK]+=dur;
    }
  }
  mStartTime=now;
}
