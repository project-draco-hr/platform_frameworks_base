{
  if (!mAnimationScheduled) {
    mAnimationScheduled=true;
    if (USE_VSYNC) {
      if (DEBUG) {
        Log.d(TAG,"Scheduling vsync for animation.");
      }
      if (isRunningOnLooperThreadLocked()) {
        scheduleVsyncLocked();
      }
 else {
        Message msg=mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);
        msg.setAsynchronous(true);
        mHandler.sendMessageAtFrontOfQueue(msg);
      }
    }
 else {
      final long nextAnimationTime=Math.max(mLastAnimationTime + sFrameDelay,now);
      if (DEBUG) {
        Log.d(TAG,"Scheduling animation in " + (nextAnimationTime - now) + " ms.");
      }
      Message msg=mHandler.obtainMessage(MSG_DO_ANIMATION);
      msg.setAsynchronous(true);
      mHandler.sendMessageAtTime(msg,nextAnimationTime);
    }
  }
}
