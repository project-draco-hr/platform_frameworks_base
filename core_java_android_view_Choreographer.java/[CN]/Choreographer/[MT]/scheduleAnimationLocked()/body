{
  if (!mAnimationScheduled) {
    mAnimationScheduled=true;
    if (USE_VSYNC) {
      if (DEBUG) {
        Log.d(TAG,"Scheduling vsync for animation.");
      }
      if (!mFrameDisplayEventReceiverNeeded) {
        mFrameDisplayEventReceiverNeeded=true;
        if (mFrameDisplayEventReceiver != null) {
          mHandler.removeMessages(MSG_DO_DISPOSE_RECEIVER);
        }
      }
      if (isRunningOnLooperThreadLocked()) {
        doScheduleVsyncLocked();
      }
 else {
        mHandler.sendMessageAtFrontOfQueue(mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC));
      }
    }
 else {
      final long now=SystemClock.uptimeMillis();
      final long nextAnimationTime=Math.max(mLastAnimationTime + sFrameDelay,now);
      if (DEBUG) {
        Log.d(TAG,"Scheduling animation in " + (nextAnimationTime - now) + " ms.");
      }
      mHandler.sendEmptyMessageAtTime(MSG_DO_ANIMATION,nextAnimationTime);
    }
  }
}
