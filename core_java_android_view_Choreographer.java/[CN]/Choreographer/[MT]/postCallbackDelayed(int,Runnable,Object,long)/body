{
  if (action == null) {
    throw new IllegalArgumentException("action must not be null");
  }
  if (callbackType < 0 || callbackType > CALLBACK_LAST) {
    throw new IllegalArgumentException("callbackType is invalid");
  }
  if (DEBUG) {
    Log.d(TAG,"PostCallback: type=" + callbackType + ", action="+ action+ ", token="+ token+ ", delayMillis="+ delayMillis);
  }
synchronized (mLock) {
    if (USE_PIPELINING && callbackType == CALLBACK_INPUT) {
      Message msg=Message.obtain(mHandler,action);
      msg.setAsynchronous(true);
      mHandler.sendMessage(msg);
      return;
    }
    final long now=SystemClock.uptimeMillis();
    final long dueTime=now + delayMillis;
    mCallbackQueues[callbackType].addCallbackLocked(dueTime,action,token);
    if (dueTime <= now) {
      if (USE_PIPELINING && callbackType == CALLBACK_TRAVERSAL) {
        if (!mDrewLastFrame) {
          if (DEBUG) {
            Log.d(TAG,"Scheduling traversal immediately.");
          }
          if (!mTraversalScheduled) {
            mTraversalScheduled=true;
            Message msg=mHandler.obtainMessage(MSG_DO_TRAVERSAL);
            msg.setAsynchronous(true);
            mHandler.sendMessageAtTime(msg,dueTime);
          }
          return;
        }
        if (DEBUG) {
          Log.d(TAG,"Scheduling traversal on next frame.");
        }
      }
      scheduleFrameLocked(now);
    }
 else {
      Message msg=mHandler.obtainMessage(MSG_DO_SCHEDULE_CALLBACK,action);
      msg.arg1=callbackType;
      msg.setAsynchronous(true);
      mHandler.sendMessageAtTime(msg,dueTime);
    }
  }
}
