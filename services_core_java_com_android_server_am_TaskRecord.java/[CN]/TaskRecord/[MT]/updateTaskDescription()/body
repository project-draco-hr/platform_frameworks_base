{
  int activityNdx;
  final int numActivities=mActivities.size();
  final boolean relinquish=numActivities == 0 ? false : (mActivities.get(0).info.flags & ActivityInfo.FLAG_RELINQUISH_TASK_IDENTITY) != 0;
  for (activityNdx=Math.min(numActivities,1); activityNdx < numActivities; ++activityNdx) {
    final ActivityRecord r=mActivities.get(activityNdx);
    if (relinquish && (r.info.flags & ActivityInfo.FLAG_RELINQUISH_TASK_IDENTITY) == 0) {
      ++activityNdx;
      break;
    }
    if (r.intent != null && (r.intent.getFlags() & Intent.FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET) != 0) {
      break;
    }
  }
  if (activityNdx > 0) {
    String label=null;
    String iconFilename=null;
    int colorPrimary=0;
    int colorBackground=0;
    for (--activityNdx; activityNdx >= 0; --activityNdx) {
      final ActivityRecord r=mActivities.get(activityNdx);
      if (r.taskDescription != null) {
        if (label == null) {
          label=r.taskDescription.getLabel();
        }
        if (iconFilename == null) {
          iconFilename=r.taskDescription.getIconFilename();
        }
        if (colorPrimary == 0) {
          colorPrimary=r.taskDescription.getPrimaryColor();
        }
        if (colorBackground == 0) {
          colorBackground=r.taskDescription.getBackgroundColor();
        }
      }
    }
    lastTaskDescription=new TaskDescription(label,null,iconFilename,colorPrimary,colorBackground);
    if (taskId == mAffiliatedTaskId) {
      mAffiliatedTaskColor=lastTaskDescription.getPrimaryColor();
    }
  }
}
