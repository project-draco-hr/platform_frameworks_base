{
  if (!mActivities.remove(r) && r.fullscreen) {
    numFullscreen++;
  }
  if (mActivities.isEmpty()) {
    taskType=r.mActivityType;
    isPersistable=r.isPersistable();
    mCallingUid=r.launchedFromUid;
    mCallingPackage=r.launchedFromPackage;
    maxRecents=Math.min(Math.max(r.info.maxRecents,1),100);
  }
 else {
    r.mActivityType=taskType;
  }
  mActivities.add(index,r);
  updateEffectiveIntent();
  if (r.isPersistable()) {
    mService.notifyTaskPersisterLocked(this,false);
  }
}
