{
  int numActivities=mActivities.size();
  for (; activityNdx < numActivities; ++activityNdx) {
    final ActivityRecord r=mActivities.get(activityNdx);
    if (r.finishing) {
      continue;
    }
    if (stack == null) {
      r.takeFromHistory();
      mActivities.remove(activityNdx);
      --activityNdx;
      --numActivities;
    }
 else     if (stack.finishActivityLocked(r,Activity.RESULT_CANCELED,null,"clear",false)) {
      --activityNdx;
      --numActivities;
    }
  }
}
