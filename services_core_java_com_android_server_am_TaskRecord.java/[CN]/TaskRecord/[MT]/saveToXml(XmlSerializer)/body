{
  Slog.i(TAG,"Saving task=" + this);
  out.attribute(null,ATTR_TASKID,String.valueOf(taskId));
  if (realActivity != null) {
    out.attribute(null,ATTR_REALACTIVITY,realActivity.flattenToShortString());
  }
  if (origActivity != null) {
    out.attribute(null,ATTR_ORIGACTIVITY,origActivity.flattenToShortString());
  }
  if (affinity != null) {
    out.attribute(null,ATTR_AFFINITY,affinity);
  }
  out.attribute(null,ATTR_ROOTHASRESET,String.valueOf(rootWasReset));
  out.attribute(null,ATTR_ASKEDCOMPATMODE,String.valueOf(askedCompatMode));
  out.attribute(null,ATTR_USERID,String.valueOf(userId));
  out.attribute(null,ATTR_TASKTYPE,String.valueOf(taskType));
  out.attribute(null,ATTR_LASTACTIVETIME,String.valueOf(lastActiveTime));
  out.attribute(null,ATTR_LASTTIMEMOVED,String.valueOf(mLastTimeMoved));
  out.attribute(null,ATTR_NEVERRELINQUISH,String.valueOf(mNeverRelinquishIdentity));
  if (lastDescription != null) {
    out.attribute(null,ATTR_LASTDESCRIPTION,lastDescription.toString());
  }
  if (affinityIntent != null) {
    out.startTag(null,TAG_AFFINITYINTENT);
    affinityIntent.saveToXml(out);
    out.endTag(null,TAG_AFFINITYINTENT);
  }
  out.startTag(null,TAG_INTENT);
  intent.saveToXml(out);
  out.endTag(null,TAG_INTENT);
  final ArrayList<ActivityRecord> activities=mActivities;
  final int numActivities=activities.size();
  for (int activityNdx=0; activityNdx < numActivities; ++activityNdx) {
    final ActivityRecord r=activities.get(activityNdx);
    if (r.info.persistableMode == ActivityInfo.PERSIST_ROOT_ONLY || !r.isPersistable() || ((r.intent.getFlags() & Intent.FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET) != 0) && activityNdx > 0) {
      break;
    }
    out.startTag(null,TAG_ACTIVITY);
    r.saveToXml(out);
    out.endTag(null,TAG_ACTIVITY);
  }
  final Bitmap thumbnail=getTaskTopThumbnailLocked();
  if (thumbnail != null) {
    TaskPersister.saveImage(thumbnail,String.valueOf(taskId) + TASK_THUMBNAIL_SUFFIX);
  }
}
