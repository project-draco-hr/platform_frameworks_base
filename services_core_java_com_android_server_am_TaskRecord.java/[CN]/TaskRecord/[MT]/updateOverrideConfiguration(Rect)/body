{
  if (stack.mStackId == FREEFORM_WORKSPACE_STACK_ID) {
    fitWithinBounds(bounds,stack.mBounds);
  }
  if (Objects.equals(mBounds,bounds)) {
    return null;
  }
  Configuration oldConfig=mOverrideConfig;
  mFullscreen=bounds == null;
  if (mFullscreen) {
    if (mBounds != null && stack.mStackId != DOCKED_STACK_ID) {
      mLastNonFullscreenBounds=mBounds;
    }
    mBounds=null;
    mOverrideConfig=Configuration.EMPTY;
  }
 else {
    mBounds=new Rect(bounds);
    if (stack.mStackId != DOCKED_STACK_ID) {
      mLastNonFullscreenBounds=mBounds;
    }
    final Configuration serviceConfig=mService.mConfiguration;
    mOverrideConfig=new Configuration(serviceConfig);
    final float density=serviceConfig.densityDpi * DisplayMetrics.DENSITY_DEFAULT_SCALE;
    mOverrideConfig.screenWidthDp=Math.min((int)(mBounds.width() / density),serviceConfig.screenWidthDp);
    mOverrideConfig.screenHeightDp=Math.min((int)(mBounds.height() / density),serviceConfig.screenHeightDp);
    mOverrideConfig.smallestScreenWidthDp=Math.min(mOverrideConfig.screenWidthDp,mOverrideConfig.screenHeightDp);
    mOverrideConfig.orientation=(mOverrideConfig.screenWidthDp <= mOverrideConfig.screenHeightDp) ? Configuration.ORIENTATION_PORTRAIT : Configuration.ORIENTATION_LANDSCAPE;
  }
  return !mOverrideConfig.equals(oldConfig) ? mOverrideConfig : null;
}
