{
  if (Objects.equals(mBounds,bounds)) {
    return null;
  }
  final Configuration oldConfig=mOverrideConfig;
  final boolean oldFullscreen=mFullscreen;
  mFullscreen=bounds == null;
  if (mFullscreen) {
    if (mBounds != null && StackId.persistTaskBounds(stack.mStackId)) {
      mLastNonFullscreenBounds=mBounds;
    }
    mBounds=null;
    mOverrideConfig=Configuration.EMPTY;
  }
 else {
    if (mBounds == null) {
      mBounds=new Rect(bounds);
    }
 else {
      mBounds.set(bounds);
    }
    if (stack == null || StackId.persistTaskBounds(stack.mStackId)) {
      mLastNonFullscreenBounds=mBounds;
    }
    final Configuration serviceConfig=mService.mConfiguration;
    mOverrideConfig=new Configuration(Configuration.EMPTY);
    final float density=serviceConfig.densityDpi * DisplayMetrics.DENSITY_DEFAULT_SCALE;
    mOverrideConfig.screenWidthDp=Math.min((int)(mBounds.width() / density),serviceConfig.screenWidthDp);
    mOverrideConfig.screenHeightDp=Math.min((int)(mBounds.height() / density),serviceConfig.screenHeightDp);
    mOverrideConfig.smallestScreenWidthDp=Math.min(mOverrideConfig.screenWidthDp,mOverrideConfig.screenHeightDp);
    mOverrideConfig.orientation=(mOverrideConfig.screenWidthDp <= mOverrideConfig.screenHeightDp) ? Configuration.ORIENTATION_PORTRAIT : Configuration.ORIENTATION_LANDSCAPE;
    final int sl=Configuration.resetScreenLayout(serviceConfig.screenLayout);
    mOverrideConfig.screenLayout=Configuration.reduceScreenLayout(sl,mOverrideConfig.screenWidthDp,mOverrideConfig.screenHeightDp);
  }
  if (mFullscreen != oldFullscreen) {
    reportMultiWindowModeChange();
  }
  return !mOverrideConfig.equals(oldConfig) ? mOverrideConfig : null;
}
