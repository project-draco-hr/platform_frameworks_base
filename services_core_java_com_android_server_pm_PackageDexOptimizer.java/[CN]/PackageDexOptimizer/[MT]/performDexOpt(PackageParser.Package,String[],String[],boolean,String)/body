{
synchronized (mInstallLock) {
    final boolean useLock=mSystemReady;
    if (useLock) {
      mDexoptWakeLock.setWorkSource(new WorkSource(pkg.applicationInfo.uid));
      mDexoptWakeLock.acquire();
    }
    try {
      return performDexOptLI(pkg,sharedLibraries,instructionSets,checkProfiles,targetCompilationFilter);
    }
  finally {
      if (useLock) {
        mDexoptWakeLock.release();
      }
    }
  }
}
