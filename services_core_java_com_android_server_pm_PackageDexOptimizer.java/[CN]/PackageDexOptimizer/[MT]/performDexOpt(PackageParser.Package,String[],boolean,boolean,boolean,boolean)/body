{
  ArraySet<String> done;
  if (inclDependencies && (pkg.usesLibraries != null || pkg.usesOptionalLibraries != null)) {
    done=new ArraySet<String>();
    done.add(pkg.packageName);
  }
 else {
    done=null;
  }
synchronized (mPackageManagerService.mInstallLock) {
    final boolean useLock=mSystemReady;
    if (useLock) {
      mDexoptWakeLock.setWorkSource(new WorkSource(pkg.applicationInfo.uid));
      mDexoptWakeLock.acquire();
    }
    try {
      return performDexOptLI(pkg,instructionSets,forceDex,defer,bootComplete,done);
    }
  finally {
      if (useLock) {
        mDexoptWakeLock.release();
      }
    }
  }
}
