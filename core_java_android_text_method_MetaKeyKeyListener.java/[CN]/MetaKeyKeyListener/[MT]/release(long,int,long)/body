{
  if ((state & (((long)what) << USED_SHIFT)) != 0)   state=state & ~mask;
 else   if ((state & (((long)what) << PRESSED_SHIFT)) != 0)   state=state | what | (((long)what) << RELEASED_SHIFT);
  return state;
}
