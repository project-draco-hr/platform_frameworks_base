{
  mContext=context;
  mPackageManager=context.getPackageManager();
  mActivityManager=ActivityManagerNative.getDefault();
  mEnabled=(Settings.Secure.getInt(mContext.getContentResolver(),BACKUP_ENABLED_SETTING,1) != 0);
  mBaseStateDir=new File(Environment.getDataDirectory(),"backup");
  mDataDir=Environment.getDownloadCacheDirectory();
  mJournalDir=new File(mBaseStateDir,"pending");
  mJournalDir.mkdirs();
  makeJournalLocked();
synchronized (mBackupParticipants) {
    addPackageParticipantsLocked(null);
  }
  mLocalTransport=new LocalTransport(context);
  ComponentName localName=new ComponentName(context,LocalTransport.class);
  registerTransport(localName.flattenToShortString(),mLocalTransport);
  mGoogleTransport=null;
  mCurrentTransport=Settings.Secure.getString(mContext.getContentResolver(),BACKUP_TRANSPORT_SETTING);
  if (mCurrentTransport == null) {
    mCurrentTransport="com.google.android.backup/.BackupTransportService";
    Settings.Secure.putString(mContext.getContentResolver(),BACKUP_TRANSPORT_SETTING,mCurrentTransport);
  }
  if (DEBUG)   Log.v(TAG,"Starting with transport " + mCurrentTransport);
  Intent intent=new Intent().setComponent(new ComponentName("com.google.android.backup","com.google.android.backup.BackupTransportService"));
  context.bindService(intent,mGoogleConnection,Context.BIND_AUTO_CREATE);
  parseLeftoverJournals();
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_PACKAGE_ADDED);
  filter.addAction(Intent.ACTION_PACKAGE_REMOVED);
  filter.addDataScheme("package");
  mContext.registerReceiver(mBroadcastReceiver,filter);
}
