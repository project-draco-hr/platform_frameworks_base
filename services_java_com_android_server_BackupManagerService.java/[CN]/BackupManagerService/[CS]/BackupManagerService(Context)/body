{
  mContext=context;
  mPackageManager=context.getPackageManager();
  mPackageManagerBinder=AppGlobals.getPackageManager();
  mActivityManager=ActivityManagerNative.getDefault();
  mAlarmManager=(AlarmManager)context.getSystemService(Context.ALARM_SERVICE);
  mPowerManager=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mBackupManagerBinder=asInterface(asBinder());
  mHandlerThread=new HandlerThread("backup",Process.THREAD_PRIORITY_BACKGROUND);
  mHandlerThread.start();
  mBackupHandler=new BackupHandler(mHandlerThread.getLooper());
  boolean areEnabled=Settings.Secure.getInt(context.getContentResolver(),Settings.Secure.BACKUP_ENABLED,0) != 0;
  mProvisioned=Settings.Secure.getInt(context.getContentResolver(),Settings.Secure.BACKUP_PROVISIONED,0) != 0;
  mAutoRestore=Settings.Secure.getInt(context.getContentResolver(),Settings.Secure.BACKUP_AUTO_RESTORE,1) != 0;
  mBaseStateDir=new File(Environment.getDataDirectory(),"backup");
  mBaseStateDir.mkdirs();
  mDataDir=Environment.getDownloadCacheDirectory();
  mRunBackupReceiver=new RunBackupReceiver();
  IntentFilter filter=new IntentFilter();
  filter.addAction(RUN_BACKUP_ACTION);
  context.registerReceiver(mRunBackupReceiver,filter,android.Manifest.permission.BACKUP,null);
  mRunInitReceiver=new RunInitializeReceiver();
  filter=new IntentFilter();
  filter.addAction(RUN_INITIALIZE_ACTION);
  context.registerReceiver(mRunInitReceiver,filter,android.Manifest.permission.BACKUP,null);
  Intent backupIntent=new Intent(RUN_BACKUP_ACTION);
  backupIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
  mRunBackupIntent=PendingIntent.getBroadcast(context,MSG_RUN_BACKUP,backupIntent,0);
  Intent initIntent=new Intent(RUN_INITIALIZE_ACTION);
  backupIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
  mRunInitIntent=PendingIntent.getBroadcast(context,MSG_RUN_INITIALIZE,initIntent,0);
  mJournalDir=new File(mBaseStateDir,"pending");
  mJournalDir.mkdirs();
  mJournal=null;
  initPackageTracking();
synchronized (mBackupParticipants) {
    addPackageParticipantsLocked(null);
  }
  mLocalTransport=new LocalTransport(context);
  ComponentName localName=new ComponentName(context,LocalTransport.class);
  registerTransport(localName.flattenToShortString(),mLocalTransport);
  mGoogleTransport=null;
  mCurrentTransport=Settings.Secure.getString(context.getContentResolver(),Settings.Secure.BACKUP_TRANSPORT);
  if ("".equals(mCurrentTransport)) {
    mCurrentTransport=null;
  }
  if (DEBUG)   Slog.v(TAG,"Starting with transport " + mCurrentTransport);
  ComponentName transportComponent=new ComponentName("com.google.android.backup","com.google.android.backup.BackupTransportService");
  try {
    ApplicationInfo info=mPackageManager.getApplicationInfo(transportComponent.getPackageName(),0);
    if ((info.flags & ApplicationInfo.FLAG_SYSTEM) != 0) {
      if (DEBUG)       Slog.v(TAG,"Binding to Google transport");
      Intent intent=new Intent().setComponent(transportComponent);
      context.bindService(intent,mGoogleConnection,Context.BIND_AUTO_CREATE);
    }
 else {
      Slog.w(TAG,"Possible Google transport spoof: ignoring " + info);
    }
  }
 catch (  PackageManager.NameNotFoundException nnf) {
    if (DEBUG)     Slog.v(TAG,"Google transport not present");
  }
  parseLeftoverJournals();
  mWakelock=mPowerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK,"*backup*");
  setBackupEnabled(areEnabled);
}
