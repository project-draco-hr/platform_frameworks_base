{
  boolean okay=true;
  if (DEBUG)   Slog.d(TAG,"Installing from backup: " + info.packageName);
  File apkFile=new File(mDataDir,info.packageName);
  try {
    FileOutputStream apkStream=new FileOutputStream(apkFile);
    byte[] buffer=new byte[32 * 1024];
    long size=info.size;
    while (size > 0) {
      long toRead=(buffer.length < size) ? buffer.length : size;
      int didRead=instream.read(buffer,0,(int)toRead);
      apkStream.write(buffer,0,didRead);
      size-=didRead;
    }
    apkStream.close();
    apkFile.setReadable(true,false);
    Uri packageUri=Uri.fromFile(apkFile);
    mInstallObserver.reset();
    mPackageManager.installPackage(packageUri,mInstallObserver,PackageManager.INSTALL_REPLACE_EXISTING,installerPackage);
    mInstallObserver.waitForCompletion();
    if (mInstallObserver.getResult() != PackageManager.INSTALL_SUCCEEDED) {
      if (mPackagePolicies.get(info.packageName) != RestorePolicy.ACCEPT) {
        okay=false;
      }
    }
  }
 catch (  IOException e) {
    Slog.e(TAG,"Unable to transcribe restored apk for install");
    okay=false;
  }
 finally {
    apkFile.delete();
  }
  return okay;
}
