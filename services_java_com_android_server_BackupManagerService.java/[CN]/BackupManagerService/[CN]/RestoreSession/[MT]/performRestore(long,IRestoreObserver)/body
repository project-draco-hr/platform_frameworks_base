{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BACKUP,"performRestore");
  if (DEBUG)   Log.d(TAG,"performRestore token=" + Long.toHexString(token) + " observer="+ observer);
  if (mRestoreTransport == null || mRestoreSets == null) {
    Log.e(TAG,"Ignoring performRestore() with no restore set");
    return -1;
  }
synchronized (mQueueLock) {
    if (mBackupOrRestoreInProgress) {
      Log.e(TAG,"Backup pass in progress, restore aborted");
      return -1;
    }
    for (int i=0; i < mRestoreSets.length; i++) {
      if (token == mRestoreSets[i].token) {
        long oldId=Binder.clearCallingIdentity();
        mBackupOrRestoreInProgress=true;
        mWakelock.acquire();
        Message msg=mBackupHandler.obtainMessage(MSG_RUN_RESTORE);
        msg.obj=new RestoreParams(mRestoreTransport,observer,token);
        mBackupHandler.sendMessage(msg);
        Binder.restoreCallingIdentity(oldId);
        return 0;
      }
    }
  }
  Log.w(TAG,"Restore token " + Long.toHexString(token) + " not found");
  return -1;
}
