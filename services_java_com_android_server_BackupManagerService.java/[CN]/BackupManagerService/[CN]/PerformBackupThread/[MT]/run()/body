{
  if (DEBUG)   Log.v(TAG,"Beginning backup of " + mQueue.size() + " targets");
  boolean doPackageManager;
synchronized (BackupManagerService.this) {
    doPackageManager=mDoPackageManager;
    mDoPackageManager=false;
  }
  if (doPackageManager) {
    if (DEBUG)     Log.i(TAG,"Running PM backup pass as well");
    PackageManagerBackupAgent pmAgent=new PackageManagerBackupAgent(mPackageManager,allAgentPackages());
    BackupRequest pmRequest=new BackupRequest(new ApplicationInfo(),false);
    pmRequest.appInfo.packageName=PACKAGE_MANAGER_SENTINEL;
    processOneBackup(pmRequest,IBackupAgent.Stub.asInterface(pmAgent.onBind()),mTransport);
  }
  doQueuedBackups(mTransport);
  try {
    if (!mTransport.finishBackup()) {
      Log.e(TAG,"Backup failure in finishBackup()");
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"Error in finishBackup()",e);
  }
  if (!mJournal.delete()) {
    Log.e(TAG,"Unable to remove backup journal file " + mJournal.getAbsolutePath());
  }
}
