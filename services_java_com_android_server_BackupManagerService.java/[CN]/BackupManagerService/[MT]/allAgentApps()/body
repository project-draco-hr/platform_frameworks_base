{
  List<ApplicationInfo> allApps=mPackageManager.getInstalledApplications(0);
  int N=allApps.size();
  if (N > 0) {
    for (int a=N - 1; a >= 0; a--) {
      ApplicationInfo app=allApps.get(a);
      if (((app.flags & ApplicationInfo.FLAG_ALLOW_BACKUP) == 0) || app.backupAgentName == null) {
        allApps.remove(a);
      }
    }
  }
  return allApps;
}
