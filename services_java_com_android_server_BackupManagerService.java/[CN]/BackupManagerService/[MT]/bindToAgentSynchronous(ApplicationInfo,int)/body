{
  IBackupAgent agent=null;
synchronized (mAgentConnectLock) {
    mConnecting=true;
    mConnectedAgent=null;
    try {
      if (mActivityManager.bindBackupAgent(app,mode)) {
        Slog.d(TAG,"awaiting agent for " + app);
        long timeoutMark=System.currentTimeMillis() + TIMEOUT_INTERVAL;
        while (mConnecting && mConnectedAgent == null && (System.currentTimeMillis() < timeoutMark)) {
          try {
            mAgentConnectLock.wait(5000);
          }
 catch (          InterruptedException e) {
            return null;
          }
        }
        if (mConnecting == true) {
          Slog.w(TAG,"Timeout waiting for agent " + app);
          return null;
        }
        agent=mConnectedAgent;
      }
    }
 catch (    RemoteException e) {
    }
  }
  return agent;
}
