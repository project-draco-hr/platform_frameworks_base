{
  final boolean isEncrypted;
  try {
    isEncrypted=(mMountService.getEncryptionState() != MountService.ENCRYPTION_STATE_NONE);
    if (isEncrypted) {
      if (DEBUG) {
        Slog.i(TAG,"Device encrypted; verifying against device data pw");
      }
      final int result=mMountService.verifyEncryptionPassword(candidatePw);
      if (result == 0) {
        if (MORE_DEBUG)         Slog.d(TAG,"Pw verifies");
        return true;
      }
 else       if (result != -2) {
        if (MORE_DEBUG)         Slog.d(TAG,"Pw mismatch");
        return false;
      }
 else {
        Slog.e(TAG,"verified encryption state mismatch against query; no match allowed");
        return false;
      }
    }
  }
 catch (  Exception e) {
    return false;
  }
  if (mPasswordHash == null) {
    if (candidatePw == null || "".equals(candidatePw)) {
      return true;
    }
  }
 else {
    if (candidatePw != null && candidatePw.length() > 0) {
      String currentPwHash=buildPasswordHash(algorithm,candidatePw,mPasswordSalt,rounds);
      if (mPasswordHash.equalsIgnoreCase(currentPwHash)) {
        return true;
      }
    }
  }
  return false;
}
