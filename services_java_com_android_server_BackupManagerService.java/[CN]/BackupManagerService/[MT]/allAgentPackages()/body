{
  int flags=PackageManager.GET_SIGNATURES;
  List<PackageInfo> packages=mPackageManager.getInstalledPackages(flags);
  int N=packages.size();
  for (int a=N - 1; a >= 0; a--) {
    ApplicationInfo app=packages.get(a).applicationInfo;
    if (((app.flags & ApplicationInfo.FLAG_ALLOW_BACKUP) == 0) || app.backupAgentName == null) {
      packages.remove(a);
    }
  }
  return packages;
}
