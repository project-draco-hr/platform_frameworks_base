{
  mContext.enforceCallingPermission(android.Manifest.permission.BACKUP,"fullBackup");
  Slog.i(TAG,"Beginning full restore...");
  long oldId=Binder.clearCallingIdentity();
  try {
    FullRestoreParams params=new FullRestoreParams(fd);
    final int token=generateToken();
synchronized (mFullConfirmations) {
      mFullConfirmations.put(token,params);
    }
    if (DEBUG)     Slog.d(TAG,"Starting restore confirmation UI, token=" + token);
    if (!startConfirmationUi(token,FullBackup.FULL_RESTORE_INTENT_ACTION)) {
      Slog.e(TAG,"Unable to launch full restore confirmation");
      mFullConfirmations.delete(token);
      return;
    }
    mPowerManager.userActivity(SystemClock.uptimeMillis(),false);
    startConfirmationTimeout(token,params);
    if (DEBUG)     Slog.d(TAG,"Waiting for full restore completion...");
    waitForCompletion(params);
  }
  finally {
    try {
      fd.close();
    }
 catch (    IOException e) {
      Slog.w(TAG,"Error trying to close fd after full restore: " + e);
    }
    Binder.restoreCallingIdentity(oldId);
    Slog.i(TAG,"Full restore completed");
  }
}
