{
  if (DEBUG)   Slog.v(TAG,"beginRestoreSession: pkg=" + packageName + " transport="+ transport);
  boolean needPermission=true;
  if (transport == null) {
    transport=mCurrentTransport;
    if (packageName != null) {
      PackageInfo app=null;
      try {
        app=mPackageManager.getPackageInfo(packageName,0);
      }
 catch (      NameNotFoundException nnf) {
        Slog.w(TAG,"Asked to restore nonexistent pkg " + packageName);
        throw new IllegalArgumentException("Package " + packageName + " not found");
      }
      if (app.applicationInfo.uid == Binder.getCallingUid()) {
        needPermission=false;
      }
    }
  }
  if (needPermission) {
    mContext.enforceCallingOrSelfPermission(android.Manifest.permission.BACKUP,"beginRestoreSession");
  }
 else {
    if (DEBUG)     Slog.d(TAG,"restoring self on current transport; no permission needed");
  }
synchronized (this) {
    if (mActiveRestoreSession != null) {
      Slog.d(TAG,"Restore session requested but one already active");
      return null;
    }
    mActiveRestoreSession=new ActiveRestoreSession(packageName,transport);
  }
  return mActiveRestoreSession;
}
