{
  Dialog d=null;
synchronized (mService) {
    HashMap<String,Object> data=(HashMap<String,Object>)msg.obj;
    ProcessRecord proc=(ProcessRecord)data.get("app");
    if (proc != null && proc.anrDialog != null) {
      Slog.e(TAG,"App already has anr dialog: " + proc);
      MetricsLogger.action(mContext,MetricsProto.MetricsEvent.ACTION_APP_ANR,AppNotRespondingDialog.ALREADY_SHOWING);
      return;
    }
    Intent intent=new Intent("android.intent.action.ANR");
    if (!mService.mProcessesReady) {
      intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY | Intent.FLAG_RECEIVER_FOREGROUND);
    }
    mService.broadcastIntentLocked(null,null,intent,null,null,0,null,null,null,AppOpsManager.OP_NONE,null,false,false,MY_PID,Process.SYSTEM_UID,0);
    if (mService.canShowErrorDialogs()) {
      d=new AppNotRespondingDialog(mService,mContext,proc,(ActivityRecord)data.get("activity"),msg.arg1 != 0);
      proc.anrDialog=d;
    }
 else {
      MetricsLogger.action(mContext,MetricsProto.MetricsEvent.ACTION_APP_ANR,AppNotRespondingDialog.CANT_SHOW);
      mService.killAppAtUsersRequest(proc,null);
    }
  }
  if (d != null) {
    d.show();
  }
}
