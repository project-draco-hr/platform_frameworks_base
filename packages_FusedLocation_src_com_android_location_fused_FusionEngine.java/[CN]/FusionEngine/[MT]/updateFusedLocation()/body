{
  mNetworkWeight=weighAccuracy(mNetworkLocation) * weighAge(mNetworkLocation);
  mGpsWeight=weighAccuracy(mGpsLocation) * weighAge(mGpsLocation);
  double totalWeight=mNetworkWeight + mGpsWeight;
  mNetworkWeight/=totalWeight;
  mGpsWeight/=totalWeight;
  Location fused=new Location(LocationManager.FUSED_PROVIDER);
  fused.setLatitude(weigh(mGpsLocation.getLatitude(),mNetworkLocation.getLatitude()));
  fused.setLongitude(weigh(mGpsLocation.getLongitude(),mNetworkLocation.getLongitude(),-180.0,180.0));
  fused.setAccuracy((float)weigh(mGpsLocation.getAccuracy(),mNetworkLocation.getAccuracy()));
  fused.setTime(System.currentTimeMillis());
  fused.setElapsedRealtimeNano(SystemClock.elapsedRealtimeNano());
  if (mGpsLocation.hasAltitude() && !mNetworkLocation.hasAltitude() && mGpsWeight > WEIGHT_THRESHOLD) {
    fused.setAltitude(mGpsLocation.getAltitude());
  }
 else   if (!mGpsLocation.hasAltitude() && mNetworkLocation.hasAltitude() && mNetworkWeight > WEIGHT_THRESHOLD) {
    fused.setAltitude(mNetworkLocation.getAltitude());
  }
 else   if (mGpsLocation.hasAltitude() && mNetworkLocation.hasAltitude()) {
    fused.setAltitude(weigh(mGpsLocation.getAltitude(),mNetworkLocation.getAltitude()));
  }
  if (mGpsLocation.hasSpeed() && !mNetworkLocation.hasSpeed() && mGpsWeight > WEIGHT_THRESHOLD) {
    fused.setSpeed(mGpsLocation.getSpeed());
  }
 else   if (!mGpsLocation.hasSpeed() && mNetworkLocation.hasSpeed() && mNetworkWeight > WEIGHT_THRESHOLD) {
    fused.setSpeed(mNetworkLocation.getSpeed());
  }
 else   if (mGpsLocation.hasSpeed() && mNetworkLocation.hasSpeed()) {
    fused.setSpeed((float)weigh(mGpsLocation.getSpeed(),mNetworkLocation.getSpeed()));
  }
  if (mGpsLocation.hasBearing() && !mNetworkLocation.hasBearing() && mGpsWeight > WEIGHT_THRESHOLD) {
    fused.setBearing(mGpsLocation.getBearing());
  }
 else   if (!mGpsLocation.hasBearing() && mNetworkLocation.hasBearing() && mNetworkWeight > WEIGHT_THRESHOLD) {
    fused.setBearing(mNetworkLocation.getBearing());
  }
 else   if (mGpsLocation.hasBearing() && mNetworkLocation.hasBearing()) {
    fused.setBearing((float)weigh(mGpsLocation.getBearing(),mNetworkLocation.getBearing(),0.0,360.0));
  }
  if (mNetworkLocation != null) {
    fused.setExtraLocation(Location.EXTRA_NO_GPS_LOCATION,mNetworkLocation);
  }
  mFusedLocation=fused;
  mCallback.reportLocation(mFusedLocation);
}
