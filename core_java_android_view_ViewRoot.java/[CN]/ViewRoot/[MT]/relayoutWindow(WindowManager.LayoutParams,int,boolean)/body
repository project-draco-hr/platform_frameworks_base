{
  boolean restore=false;
  float appScale=mCompatibilityInfo.mApplicationScale;
  boolean scalingRequired=mCompatibilityInfo.mScalingRequired;
  if (params != null && !mCompatibilityInfo.mExpandable) {
    restore=true;
    params.backup();
    adjustWindowAttributesForCompatibleMode(params);
  }
  if (params != null && scalingRequired) {
    if (!restore)     params.backup();
    restore=true;
    params.scale(appScale);
  }
  int relayoutResult=sWindowSession.relayout(mWindow,params,(int)(mView.mMeasuredWidth * appScale),(int)(mView.mMeasuredHeight * appScale),viewVisibility,insetsPending,mWinFrame,mPendingContentInsets,mPendingVisibleInsets,mSurface);
  if (restore) {
    params.restore();
  }
  if (scalingRequired) {
    float invertedScale=mCompatibilityInfo.mApplicationInvertedScale;
    mPendingContentInsets.scale(invertedScale);
    mPendingVisibleInsets.scale(invertedScale);
    mWinFrame.scale(invertedScale);
  }
  return relayoutResult;
}
