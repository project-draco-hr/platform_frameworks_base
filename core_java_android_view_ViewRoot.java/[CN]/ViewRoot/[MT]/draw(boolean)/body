{
  Surface surface=mSurface;
  if (surface == null || !surface.isValid()) {
    return;
  }
  scrollToRectOrFocus(null,false);
  if (mAttachInfo.mViewScrollChanged) {
    mAttachInfo.mViewScrollChanged=false;
    mAttachInfo.mTreeObserver.dispatchOnScrollChanged();
  }
  int yoff;
  final boolean scrolling=mScroller != null && mScroller.computeScrollOffset();
  if (scrolling) {
    yoff=mScroller.getCurrY();
  }
 else {
    yoff=mScrollY;
  }
  if (mCurScrollY != yoff) {
    mCurScrollY=yoff;
    fullRedrawNeeded=true;
  }
  Rect dirty=mDirty;
  if (mUseGL) {
    if (!dirty.isEmpty()) {
      Canvas canvas=mGlCanvas;
      if (mGL != null && canvas != null) {
        mGL.glDisable(GL_SCISSOR_TEST);
        mGL.glClearColor(0,0,0,0);
        mGL.glClear(GL_COLOR_BUFFER_BIT);
        mGL.glEnable(GL_SCISSOR_TEST);
        mAttachInfo.mDrawingTime=SystemClock.uptimeMillis();
        mView.mPrivateFlags|=View.DRAWN;
        float scale=mAppScale;
        int saveCount=canvas.save(Canvas.MATRIX_SAVE_FLAG);
        try {
          canvas.translate(0,-yoff);
          if (scale != 1.0f) {
            canvas.scale(scale,scale);
          }
          mView.draw(canvas);
          if (Config.DEBUG && ViewDebug.consistencyCheckEnabled) {
            mView.dispatchConsistencyCheck(ViewDebug.CONSISTENCY_DRAWING);
          }
        }
  finally {
          canvas.restoreToCount(saveCount);
        }
        mEgl.eglSwapBuffers(mEglDisplay,mEglSurface);
        checkEglErrors();
        if (Config.DEBUG && ViewDebug.showFps) {
          int now=(int)SystemClock.elapsedRealtime();
          if (sDrawTime != 0) {
            nativeShowFPS(canvas,now - sDrawTime);
          }
          sDrawTime=now;
        }
      }
    }
    if (scrolling) {
      mFullRedrawNeeded=true;
      scheduleTraversals();
    }
    return;
  }
  if (fullRedrawNeeded)   dirty.union(0,0,(int)(mWidth * mAppScale),(int)(mHeight * mAppScale));
  if (DEBUG_ORIENTATION || DEBUG_DRAW) {
    Log.v("ViewRoot","Draw " + mView + "/"+ mWindowAttributes.getTitle()+ ": dirty={"+ dirty.left+ ","+ dirty.top+ ","+ dirty.right+ ","+ dirty.bottom+ "} surface="+ surface+ " surface.isValid()="+ surface.isValid());
  }
  Canvas canvas;
  try {
    canvas=surface.lockCanvas(dirty);
    canvas.setDensityScale(mDensity);
  }
 catch (  Surface.OutOfResourcesException e) {
    Log.e("ViewRoot","OutOfResourcesException locking surface",e);
    return;
  }
  try {
    if (!dirty.isEmpty() || mIsAnimating) {
      long startTime=0L;
      if (DEBUG_ORIENTATION || DEBUG_DRAW) {
        Log.v("ViewRoot","Surface " + surface + " drawing to bitmap w="+ canvas.getWidth()+ ", h="+ canvas.getHeight());
      }
      if (Config.DEBUG && ViewDebug.profileDrawing) {
        startTime=SystemClock.elapsedRealtime();
      }
      if (!canvas.isOpaque()) {
        canvas.drawColor(0x00000000,PorterDuff.Mode.CLEAR);
      }
 else       if (yoff != 0) {
        canvas.drawColor(0,PorterDuff.Mode.CLEAR);
      }
      dirty.setEmpty();
      mIsAnimating=false;
      mAttachInfo.mDrawingTime=SystemClock.uptimeMillis();
      mView.mPrivateFlags|=View.DRAWN;
      float scale=mAppScale;
      Context cxt=mView.getContext();
      if (DEBUG_DRAW) {
        Log.i(TAG,"Drawing: package:" + cxt.getPackageName() + ", appScale="+ mAppScale);
      }
      int saveCount=canvas.save(Canvas.MATRIX_SAVE_FLAG);
      try {
        canvas.translate(0,-yoff);
        if (scale != 1.0f) {
          canvas.scale(scale,scale);
        }
        mView.draw(canvas);
        if (Config.DEBUG && ViewDebug.consistencyCheckEnabled) {
          mView.dispatchConsistencyCheck(ViewDebug.CONSISTENCY_DRAWING);
        }
      }
  finally {
        canvas.restoreToCount(saveCount);
      }
      if (Config.DEBUG && ViewDebug.showFps) {
        int now=(int)SystemClock.elapsedRealtime();
        if (sDrawTime != 0) {
          nativeShowFPS(canvas,now - sDrawTime);
        }
        sDrawTime=now;
      }
      if (Config.DEBUG && ViewDebug.profileDrawing) {
        EventLog.writeEvent(60000,SystemClock.elapsedRealtime() - startTime);
      }
    }
  }
  finally {
    surface.unlockCanvasAndPost(canvas);
  }
  if (LOCAL_LOGV) {
    Log.v("ViewRoot","Surface " + surface + " unlockCanvasAndPost");
  }
  if (scrolling) {
    mFullRedrawNeeded=true;
    scheduleTraversals();
  }
}
