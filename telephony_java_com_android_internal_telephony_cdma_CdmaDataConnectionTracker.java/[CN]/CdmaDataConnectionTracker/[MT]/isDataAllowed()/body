{
  final boolean internalDataEnabled;
synchronized (mDataEnabledLock) {
    internalDataEnabled=mInternalDataEnabled;
  }
  int psState=mCdmaPhone.mSST.getCurrentDataConnectionState();
  boolean roaming=(mPhone.getServiceState().getRoaming() && !getDataOnRoamingEnabled());
  boolean desiredPowerState=mCdmaPhone.mSST.getDesiredPowerState();
  boolean subscriptionFromNv=(mCdmaSSM.getCdmaSubscriptionSource() == CdmaSubscriptionSourceManager.SUBSCRIPTION_FROM_NV);
  IccRecords r=mIccRecords.get();
  boolean allowed=(psState == ServiceState.STATE_IN_SERVICE || mAutoAttachOnCreation) && (subscriptionFromNv || (r != null && r.getRecordsLoaded())) && (mCdmaPhone.mSST.isConcurrentVoiceAndDataAllowed() || mPhone.getState() == Phone.State.IDLE)&& !roaming&& internalDataEnabled&& desiredPowerState&& !mPendingRestartRadio&& ((mPhone.getLteOnCdmaMode() == Phone.LTE_ON_CDMA_TRUE) || !mCdmaPhone.needsOtaServiceProvisioning());
  if (!allowed && DBG) {
    String reason="";
    if (!((psState == ServiceState.STATE_IN_SERVICE) || mAutoAttachOnCreation)) {
      reason+=" - psState= " + psState;
    }
    if (!subscriptionFromNv && !(r != null && r.getRecordsLoaded())) {
      reason+=" - RUIM not loaded";
    }
    if (!(mCdmaPhone.mSST.isConcurrentVoiceAndDataAllowed() || mPhone.getState() == Phone.State.IDLE)) {
      reason+=" - concurrentVoiceAndData not allowed and state= " + mPhone.getState();
    }
    if (roaming)     reason+=" - Roaming";
    if (!internalDataEnabled)     reason+=" - mInternalDataEnabled= false";
    if (!desiredPowerState)     reason+=" - desiredPowerState= false";
    if (mPendingRestartRadio)     reason+=" - mPendingRestartRadio= true";
    if (mCdmaPhone.needsOtaServiceProvisioning())     reason+=" - needs Provisioning";
    log("Data not allowed due to" + reason);
  }
  return allowed;
}
