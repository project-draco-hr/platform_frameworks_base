{
  final long idleTimeMs=mStats.getWifiControllerActivity(BatteryStats.CONTROLLER_IDLE_TIME,mStatsType);
  final long txTimeMs=mStats.getWifiControllerActivity(BatteryStats.CONTROLLER_TX_TIME,mStatsType);
  final long rxTimeMs=mStats.getWifiControllerActivity(BatteryStats.CONTROLLER_RX_TIME,mStatsType);
  final long energy=mStats.getWifiControllerActivity(BatteryStats.CONTROLLER_ENERGY,mStatsType);
  final long totalTimeRunning=idleTimeMs + txTimeMs + rxTimeMs;
  double powerDrain=0;
  if (energy == 0 && totalTimeRunning > 0) {
    powerDrain=((totalTimeRunning - mAppWifiRunning) * mPowerProfile.getAveragePower(PowerProfile.POWER_WIFI_ON)) / (60 * 60 * 1000);
  }
  if (DEBUG && powerDrain != 0) {
    Log.d(TAG,"Wifi active: time=" + (txTimeMs + rxTimeMs) + " power="+ makemAh(powerDrain));
  }
  final double power=mWifiPower + powerDrain;
  if (power > 0) {
    BatterySipper bs=addEntry(BatterySipper.DrainType.WIFI,totalTimeRunning,power);
    aggregateSippers(bs,mWifiSippers,"WIFI");
  }
}
