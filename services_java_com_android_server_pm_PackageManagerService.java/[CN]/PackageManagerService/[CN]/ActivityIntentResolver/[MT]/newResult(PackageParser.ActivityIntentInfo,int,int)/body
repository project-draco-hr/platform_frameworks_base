{
  if (!sUserManager.exists(userId))   return null;
  if (!mSettings.isEnabledLPr(info.activity.info,mFlags,userId)) {
    return null;
  }
  final PackageParser.Activity activity=info.activity;
  if (mSafeMode && (activity.info.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) == 0) {
    return null;
  }
  PackageSetting ps=(PackageSetting)activity.owner.mExtras;
  if (ps == null) {
    return null;
  }
  ActivityInfo ai=PackageParser.generateActivityInfo(activity,mFlags,ps.readUserState(userId),userId);
  if (ai == null) {
    return null;
  }
  final ResolveInfo res=new ResolveInfo();
  res.activityInfo=ai;
  if ((mFlags & PackageManager.GET_RESOLVED_FILTER) != 0) {
    res.filter=info;
  }
  res.priority=info.getPriority();
  res.preferredOrder=activity.owner.mPreferredOrder;
  res.match=match;
  res.isDefault=info.hasDefault;
  res.labelRes=info.labelRes;
  res.nonLocalizedLabel=info.nonLocalizedLabel;
  res.icon=info.icon;
  res.system=isSystemApp(res.activityInfo.applicationInfo);
  return res;
}
