{
  final boolean bundledApk=isSystemApp(pkg) && !isUpdatedSystemApp(pkg);
  final String apkName=getApkName(pkgSetting.codePathString);
  final File libDir;
  if (bundledApk) {
    String apkRoot=calculateApkRoot(pkgSetting.codePath);
    File lib64=new File(apkRoot,LIB64_DIR_NAME);
    File packLib64=new File(lib64,apkName);
    libDir=(packLib64.exists()) ? lib64 : new File(apkRoot,LIB_DIR_NAME);
  }
 else {
    libDir=mAppLibInstallDir;
  }
  final String nativeLibraryPath=(new File(libDir,apkName)).getPath();
  pkg.applicationInfo.nativeLibraryDir=nativeLibraryPath;
  pkgSetting.nativeLibraryPathString=nativeLibraryPath;
}
