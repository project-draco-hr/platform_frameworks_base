{
  final ArrayList<PackageInfo> finalList=new ArrayList<PackageInfo>();
synchronized (mPackages) {
    if ((flags & PackageManager.GET_UNINSTALLED_PACKAGES) != 0) {
      final Iterator<PackageSetting> i=mSettings.mPackages.values().iterator();
      while (i.hasNext()) {
        final PackageSetting ps=i.next();
        final PackageInfo psPkg=generatePackageInfoFromSettingsLPw(ps.name,flags);
        if (psPkg != null) {
          finalList.add(psPkg);
        }
      }
    }
 else {
      final Iterator<PackageParser.Package> i=mPackages.values().iterator();
      while (i.hasNext()) {
        final PackageParser.Package p=i.next();
        if (p.applicationInfo != null) {
          final PackageInfo pi=generatePackageInfo(p,flags);
          if (pi != null) {
            finalList.add(pi);
          }
        }
      }
    }
  }
  return finalList;
}
