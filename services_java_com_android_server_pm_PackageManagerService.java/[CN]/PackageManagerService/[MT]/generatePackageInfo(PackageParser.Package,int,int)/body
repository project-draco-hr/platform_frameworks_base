{
  if (!sUserManager.exists(userId))   return null;
  PackageInfo pi;
  final PackageSetting ps=(PackageSetting)p.mExtras;
  if (ps == null) {
    return null;
  }
  final GrantedPermissions gp=ps.sharedUser != null ? ps.sharedUser : ps;
  final PackageUserState state=ps.readUserState(userId);
  pi=PackageParser.generatePackageInfo(p,gp.gids,flags,ps.firstInstallTime,ps.lastUpdateTime,gp.grantedPermissions,state,userId);
  if (pi != null) {
    pi.applicationInfo.enabledSetting=state.enabled;
    pi.applicationInfo.enabled=pi.applicationInfo.enabledSetting == COMPONENT_ENABLED_STATE_DEFAULT || pi.applicationInfo.enabledSetting == COMPONENT_ENABLED_STATE_ENABLED;
  }
  return pi;
}
