{
  Slog.i(TAG,"Cleaning up incompletely installed app: " + ps.name);
  if (mInstaller != null) {
    int retCode=mInstaller.remove(ps.name,0);
    if (retCode < 0) {
      Slog.w(TAG,"Couldn't remove app data directory for package: " + ps.name + ", retcode="+ retCode);
    }
 else {
      mUserManager.removePackageForAllUsers(ps.name);
    }
  }
 else {
    PackageParser.Package pkg=mPackages.get(ps.name);
    File dataDir=new File(pkg.applicationInfo.dataDir);
    dataDir.delete();
  }
  if (ps.codePath != null) {
    if (!ps.codePath.delete()) {
      Slog.w(TAG,"Unable to remove old code file: " + ps.codePath);
    }
  }
  if (ps.resourcePath != null) {
    if (!ps.resourcePath.delete() && !ps.resourcePath.equals(ps.codePath)) {
      Slog.w(TAG,"Unable to remove old code file: " + ps.resourcePath);
    }
  }
  mSettings.removePackageLPw(ps.name);
}
