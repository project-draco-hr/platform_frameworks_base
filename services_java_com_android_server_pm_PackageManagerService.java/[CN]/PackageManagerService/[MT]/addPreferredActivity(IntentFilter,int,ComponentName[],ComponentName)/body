{
synchronized (mPackages) {
    if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.SET_PREFERRED_APPLICATIONS) != PackageManager.PERMISSION_GRANTED) {
      if (getUidTargetSdkVersionLockedLPr(Binder.getCallingUid()) < Build.VERSION_CODES.FROYO) {
        Slog.w(TAG,"Ignoring addPreferredActivity() from uid " + Binder.getCallingUid());
        return;
      }
      mContext.enforceCallingOrSelfPermission(android.Manifest.permission.SET_PREFERRED_APPLICATIONS,null);
    }
    Slog.i(TAG,"Adding preferred activity " + activity + ":");
    filter.dump(new LogPrinter(Log.INFO,TAG),"  ");
    mSettings.mPreferredActivities.addFilter(new PreferredActivity(filter,match,set,activity));
    scheduleWriteSettingsLocked();
  }
}
