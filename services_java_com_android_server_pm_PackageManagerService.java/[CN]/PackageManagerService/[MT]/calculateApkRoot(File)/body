{
  final File codeRoot;
  if (FileUtils.contains(Environment.getRootDirectory(),codePath)) {
    codeRoot=Environment.getRootDirectory();
  }
 else   if (FileUtils.contains(Environment.getOemDirectory(),codePath)) {
    codeRoot=Environment.getRootDirectory();
  }
 else   if (FileUtils.contains(Environment.getVendorDirectory(),codePath)) {
    codeRoot=Environment.getVendorDirectory();
  }
 else {
    try {
      File f=codePath.getCanonicalFile();
      File parent=f.getParentFile();
      File tmp;
      while ((tmp=parent.getParentFile()) != null) {
        f=parent;
        parent=tmp;
      }
      codeRoot=f;
      Slog.w(TAG,"Unrecognized code path " + codePath + " - using "+ codeRoot);
    }
 catch (    IOException e) {
      Slog.w(TAG,"Can't canonicalize code path " + codePath);
      return Environment.getRootDirectory().getPath();
    }
  }
  return codeRoot.getPath();
}
