{
  final FileOutputStream fstr=new FileOutputStream(publicZipFile);
  final ZipOutputStream publicZipOutStream=new ZipOutputStream(fstr);
  try {
    final ZipFile privateZip=new ZipFile(newPackage.mPath);
    try {
      final Enumeration<? extends ZipEntry> privateZipEntries=privateZip.entries();
      while (privateZipEntries.hasMoreElements()) {
        final ZipEntry zipEntry=privateZipEntries.nextElement();
        final String zipEntryName=zipEntry.getName();
        if ("AndroidManifest.xml".equals(zipEntryName) || "resources.arsc".equals(zipEntryName) || zipEntryName.startsWith("res/")) {
          copyZipEntry(zipEntry,privateZip,publicZipOutStream);
        }
      }
    }
  finally {
      try {
        privateZip.close();
      }
 catch (      IOException e) {
      }
    }
    publicZipOutStream.finish();
    publicZipOutStream.flush();
    FileUtils.sync(fstr);
    publicZipOutStream.close();
    FileUtils.setPermissions(publicZipFile.getAbsolutePath(),FileUtils.S_IRUSR | FileUtils.S_IWUSR | FileUtils.S_IRGRP| FileUtils.S_IROTH,-1,-1);
  }
  finally {
    IoUtils.closeQuietly(publicZipOutStream);
  }
}
