{
  ArrayList<PreferredActivity> removed=null;
  Iterator<PreferredActivity> it=mSettings.mPreferredActivities.filterIterator();
  while (it.hasNext()) {
    PreferredActivity pa=it.next();
    if (userId != UserHandle.USER_ALL && pa.mUserId != userId) {
      continue;
    }
    if (pa.mPref.mComponent.getPackageName().equals(packageName)) {
      if (removed == null) {
        removed=new ArrayList<PreferredActivity>();
      }
      removed.add(pa);
    }
  }
  if (removed != null) {
    for (int i=0; i < removed.size(); i++) {
      PreferredActivity pa=removed.get(i);
      mSettings.mPreferredActivities.removeFilter(pa);
    }
    return true;
  }
  return false;
}
