{
  int num=0;
  final int userId=UserHandle.getCallingUserId();
synchronized (mPackages) {
    PreferredIntentResolver pir=mSettings.mPreferredActivities.get(userId);
    if (pir != null) {
      final Iterator<PreferredActivity> it=pir.filterIterator();
      while (it.hasNext()) {
        final PreferredActivity pa=it.next();
        if (packageName == null || (pa.mPref.mComponent.getPackageName().equals(packageName) && pa.mPref.mAlways)) {
          if (outFilters != null) {
            outFilters.add(new IntentFilter(pa));
          }
          if (outActivities != null) {
            outActivities.add(pa.mPref.mComponent);
          }
        }
      }
    }
  }
  return num;
}
