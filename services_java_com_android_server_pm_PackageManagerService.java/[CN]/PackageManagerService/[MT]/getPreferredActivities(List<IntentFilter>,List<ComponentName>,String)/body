{
  int num=0;
  final int userId=UserHandle.getCallingUserId();
synchronized (mPackages) {
    final Iterator<PreferredActivity> it=mSettings.mPreferredActivities.filterIterator();
    while (it.hasNext()) {
      final PreferredActivity pa=it.next();
      if (pa.mUserId != userId) {
        continue;
      }
      if (packageName == null || pa.mPref.mComponent.getPackageName().equals(packageName)) {
        if (outFilters != null) {
          outFilters.add(new IntentFilter(pa));
        }
        if (outActivities != null) {
          outActivities.add(pa.mPref.mComponent);
        }
      }
    }
  }
  return num;
}
