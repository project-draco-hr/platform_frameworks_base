{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.GRANT_REVOKE_PERMISSIONS,null);
synchronized (mPackages) {
    final PackageParser.Package pkg=mPackages.get(packageName);
    if (pkg == null) {
      throw new IllegalArgumentException("Unknown package: " + packageName);
    }
    final BasePermission bp=mSettings.mPermissions.get(permissionName);
    if (bp == null) {
      throw new IllegalArgumentException("Unknown permission: " + packageName);
    }
    if (!pkg.requestedPermissions.contains(permissionName)) {
      throw new SecurityException("Package " + packageName + " has not requested permission "+ permissionName);
    }
    if ((bp.protectionLevel & PermissionInfo.PROTECTION_FLAG_DEVELOPMENT) == 0) {
      throw new SecurityException("Permission " + permissionName + " is not a development permission");
    }
    final PackageSetting ps=(PackageSetting)pkg.mExtras;
    if (ps == null) {
      return;
    }
    final GrantedPermissions gp=ps.sharedUser != null ? ps.sharedUser : ps;
    if (gp.grantedPermissions.add(permissionName)) {
      if (ps.haveGids) {
        gp.gids=appendInts(gp.gids,bp.gids);
      }
      mSettings.writeLPr();
    }
  }
}
