{
  mContext.enforceCallingOrSelfPermission(android.Manifest.permission.GRANT_REVOKE_PERMISSIONS,null);
synchronized (mPackages) {
    final PackageParser.Package pkg=mPackages.get(packageName);
    if (pkg == null) {
      throw new IllegalArgumentException("Unknown package: " + packageName);
    }
    final BasePermission bp=mSettings.mPermissions.get(permissionName);
    if (bp == null) {
      throw new IllegalArgumentException("Unknown permission: " + permissionName);
    }
    checkGrantRevokePermissions(pkg,bp);
    final PackageSetting ps=(PackageSetting)pkg.mExtras;
    if (ps == null) {
      return;
    }
    final GrantedPermissions gp=(ps.sharedUser != null) ? ps.sharedUser : ps;
    if (gp.grantedPermissions.add(permissionName)) {
      if (ps.haveGids) {
        gp.gids=appendInts(gp.gids,bp.gids);
      }
      mSettings.writeLPr();
    }
  }
}
