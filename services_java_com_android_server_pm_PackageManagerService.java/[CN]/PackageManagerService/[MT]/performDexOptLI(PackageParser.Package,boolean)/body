{
  boolean performed=false;
  if ((pkg.applicationInfo.flags & ApplicationInfo.FLAG_HAS_CODE) != 0) {
    String path=pkg.mScanPath;
    int ret=0;
    try {
      if (forceDex || dalvik.system.DexFile.isDexOptNeeded(path)) {
        ret=mInstaller.dexopt(path,pkg.applicationInfo.uid,!isForwardLocked(pkg));
        pkg.mDidDexOpt=true;
        performed=true;
      }
    }
 catch (    FileNotFoundException e) {
      Slog.w(TAG,"Apk not found for dexopt: " + path);
      ret=-1;
    }
catch (    IOException e) {
      Slog.w(TAG,"IOException reading apk: " + path,e);
      ret=-1;
    }
catch (    dalvik.system.StaleDexCacheError e) {
      Slog.w(TAG,"StaleDexCacheError when reading apk: " + path,e);
      ret=-1;
    }
catch (    Exception e) {
      Slog.w(TAG,"Exception when doing dexopt : ",e);
      ret=-1;
    }
    if (ret < 0) {
      return DEX_OPT_FAILED;
    }
  }
  return performed ? DEX_OPT_PERFORMED : DEX_OPT_SKIPPED;
}
