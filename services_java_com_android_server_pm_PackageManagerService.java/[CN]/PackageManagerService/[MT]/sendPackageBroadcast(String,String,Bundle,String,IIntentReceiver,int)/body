{
  IActivityManager am=ActivityManagerNative.getDefault();
  if (am != null) {
    try {
      int[] userIds=userId == UserHandle.USER_ALL ? sUserManager.getUserIds() : new int[]{userId};
      for (      int id : userIds) {
        final Intent intent=new Intent(action,pkg != null ? Uri.fromParts("package",pkg,null) : null);
        if (extras != null) {
          intent.putExtras(extras);
        }
        if (targetPkg != null) {
          intent.setPackage(targetPkg);
        }
        int uid=intent.getIntExtra(Intent.EXTRA_UID,-1);
        if (uid > 0 && id > 0) {
          uid=UserHandle.getUid(id,UserHandle.getAppId(uid));
          intent.putExtra(Intent.EXTRA_UID,uid);
        }
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
        am.broadcastIntent(null,intent,null,finishedReceiver,0,null,null,null,finishedReceiver != null,false,id);
      }
    }
 catch (    RemoteException ex) {
    }
  }
}
