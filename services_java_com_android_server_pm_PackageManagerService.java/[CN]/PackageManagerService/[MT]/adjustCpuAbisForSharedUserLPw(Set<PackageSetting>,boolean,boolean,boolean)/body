{
  String requiredInstructionSet=null;
  PackageSetting requirer=null;
  for (  PackageSetting ps : packagesForUser) {
    if (ps.requiredCpuAbiString != null) {
      final String instructionSet=VMRuntime.getInstructionSet(ps.requiredCpuAbiString);
      if (requiredInstructionSet != null) {
        if (!instructionSet.equals(requiredInstructionSet)) {
          String errorMessage="Instruction set mismatch, " + requirer.pkg.packageName + " requires "+ requiredInstructionSet+ " whereas "+ ps.pkg.packageName+ " requires "+ instructionSet;
          Slog.e(TAG,errorMessage);
          reportSettingsProblem(Log.WARN,errorMessage);
          return;
        }
      }
 else {
        requiredInstructionSet=instructionSet;
        requirer=ps;
      }
    }
  }
  if (requiredInstructionSet != null) {
    for (    PackageSetting ps : packagesForUser) {
      if (ps.requiredCpuAbiString == null) {
        ps.requiredCpuAbiString=requirer.requiredCpuAbiString;
        if (ps.pkg != null) {
          ps.pkg.applicationInfo.requiredCpuAbi=requirer.requiredCpuAbiString;
          Slog.i(TAG,"Adjusting ABI for : " + ps.name + " to "+ ps.requiredCpuAbiString);
          if (doDexOpt) {
            performDexOptLI(ps.pkg,forceDexOpt,deferDexOpt,true);
            mInstaller.rmdex(ps.codePathString,getPreferredInstructionSet());
          }
        }
      }
    }
  }
}
