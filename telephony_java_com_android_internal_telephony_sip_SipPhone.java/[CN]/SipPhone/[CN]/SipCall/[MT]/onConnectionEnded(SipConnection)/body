{
  if (state != State.DISCONNECTED) {
    boolean allConnectionsDisconnected=true;
    if (DEBUG)     Log.d(LOG_TAG,"---check connections: " + connections.size());
    for (    Connection c : connections) {
      if (DEBUG)       Log.d(LOG_TAG,"   state=" + c.getState() + ": "+ c);
      if (c.getState() != State.DISCONNECTED) {
        allConnectionsDisconnected=false;
        break;
      }
    }
    if (allConnectionsDisconnected)     setState(State.DISCONNECTED);
  }
  notifyDisconnectP(conn);
}
