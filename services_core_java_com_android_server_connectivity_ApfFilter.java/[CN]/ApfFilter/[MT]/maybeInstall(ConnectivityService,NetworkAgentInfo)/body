{
  if (nai.networkMisc == null)   return;
  if (nai.networkMisc.apfVersionSupported == 0)   return;
  if (nai.networkMisc.maximumApfProgramSize < 200) {
    Log.e(TAG,"Uselessly small APF size limit: " + nai.networkMisc.maximumApfProgramSize);
    return;
  }
  if (nai.networkMisc.apfPacketFormat != ARPHRD_ETHER)   return;
  if (!new ApfGenerator().setApfVersion(nai.networkMisc.apfVersionSupported)) {
    Log.e(TAG,"Unsupported APF version: " + nai.networkMisc.apfVersionSupported);
    return;
  }
  nai.apfFilter=new ApfFilter(connectivityService,nai);
}
