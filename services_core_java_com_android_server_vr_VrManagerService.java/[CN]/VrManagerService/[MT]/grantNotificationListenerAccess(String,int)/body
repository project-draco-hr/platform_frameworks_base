{
  PackageManager pm=mContext.getPackageManager();
  ArraySet<ComponentName> possibleServices=EnabledComponentsObserver.loadComponentNames(pm,userId,NotificationListenerService.SERVICE_INTERFACE,android.Manifest.permission.BIND_NOTIFICATION_LISTENER_SERVICE);
  ContentResolver resolver=mContext.getContentResolver();
  ArraySet<String> current=getNotificationListeners(resolver,userId);
  for (  ComponentName c : possibleServices) {
    String flatName=c.flattenToString();
    if (Objects.equals(c.getPackageName(),pkg) && !current.contains(flatName)) {
      current.add(flatName);
    }
  }
  if (current.size() > 0) {
    String flatSettings=formatSettings(current);
    Settings.Secure.putStringForUser(resolver,Settings.Secure.ENABLED_NOTIFICATION_LISTENERS,flatSettings,userId);
  }
}
