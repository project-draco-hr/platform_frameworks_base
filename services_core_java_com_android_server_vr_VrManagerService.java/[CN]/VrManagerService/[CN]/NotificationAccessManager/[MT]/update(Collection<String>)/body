{
  int currentUserId=ActivityManager.getCurrentUser();
  UserHandle currentUserHandle=new UserHandle(currentUserId);
  ArraySet<String> allowed=mAllowedPackages.get(currentUserId);
  if (allowed == null) {
    allowed=new ArraySet<>();
  }
  for (  String pkg : allowed) {
    if (!packageNames.contains(pkg)) {
      revokeNotificationListenerAccess(pkg);
      revokeNotificationPolicyAccess(pkg);
      revokeCoarseLocationAccess(pkg,currentUserHandle);
    }
  }
  for (  String pkg : packageNames) {
    if (!allowed.contains(pkg)) {
      grantNotificationPolicyAccess(pkg);
      grantNotificationListenerAccess(pkg,currentUserHandle);
      grantCoarseLocationAccess(pkg,currentUserHandle);
    }
  }
  allowed.clear();
  allowed.addAll(packageNames);
  mAllowedPackages.put(currentUserId,allowed);
}
