{
  int failureCode=StateListener.ERROR_CAMERA_DEVICE;
  boolean failureIsError=true;
switch (failure.getReason()) {
case CameraAccessException.CAMERA_IN_USE:
    failureCode=StateListener.ERROR_CAMERA_IN_USE;
  break;
case CameraAccessException.MAX_CAMERAS_IN_USE:
failureCode=StateListener.ERROR_MAX_CAMERAS_IN_USE;
break;
case CameraAccessException.CAMERA_DISABLED:
failureCode=StateListener.ERROR_CAMERA_DISABLED;
break;
case CameraAccessException.CAMERA_DISCONNECTED:
failureIsError=false;
break;
case CameraAccessException.CAMERA_ERROR:
failureCode=StateListener.ERROR_CAMERA_DEVICE;
break;
default :
Log.wtf(TAG,"Unknown failure in opening camera device: " + failure.getReason());
break;
}
final int code=failureCode;
final boolean isError=failureIsError;
try (ScopedLock scopedLock=mCloseLock.acquireLock()){
if (scopedLock == null) return;
mInError=true;
mDeviceHandler.post(new Runnable(){
@Override public void run(){
if (isError) {
mDeviceListener.onError(CameraDeviceImpl.this,code);
}
 else {
mDeviceListener.onDisconnected(CameraDeviceImpl.this);
}
}
}
);
}
 }
