{
synchronized (mLock) {
    if (DEBUG) {
      Log.d(TAG,"createCaptureSession");
    }
    checkIfCameraClosedOrInError();
    boolean configureSuccess=true;
    CameraAccessException pendingException=null;
    try {
      configureOutputs(outputs);
    }
 catch (    CameraAccessException e) {
      configureSuccess=false;
      pendingException=e;
      if (DEBUG) {
        Log.v(TAG,"createCaptureSession - failed with exception ",e);
      }
    }
    CameraCaptureSessionImpl newSession=new CameraCaptureSessionImpl(outputs,listener,handler,this,mDeviceHandler,configureSuccess);
    if (mCurrentSession != null) {
      mCurrentSession.replaceSessionClose(newSession);
    }
    mCurrentSession=newSession;
    if (pendingException != null) {
      throw pendingException;
    }
    mSessionStateListener=mCurrentSession.getDeviceStateListener();
  }
}
