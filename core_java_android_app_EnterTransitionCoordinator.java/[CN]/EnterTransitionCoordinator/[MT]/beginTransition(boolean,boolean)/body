{
  Transition sharedElementTransition=null;
  if (startSharedElementTransition && !mSharedElementNames.isEmpty()) {
    sharedElementTransition=configureTransition(getSharedElementTransition(),false);
  }
  Transition viewsTransition=null;
  if (startEnterTransition && !mTransitioningViews.isEmpty()) {
    viewsTransition=configureTransition(getViewsTransition(),true);
    if (viewsTransition != null) {
      stripOffscreenViews();
    }
  }
  Transition transition=mergeTransitions(sharedElementTransition,viewsTransition);
  if (startSharedElementTransition) {
    if (transition == null) {
      sharedElementTransitionStarted();
    }
 else {
      transition.addListener(new ContinueTransitionListener(){
        @Override public void onTransitionStart(        Transition transition){
          super.onTransitionStart(transition);
          transition.removeListener(this);
          sharedElementTransitionStarted();
        }
      }
);
    }
  }
  if (transition != null) {
    if (sharedElementTransition == null) {
      transition.addListener(new ContinueTransitionListener());
    }
    TransitionManager.beginDelayedTransition(getDecor(),transition);
    if (startSharedElementTransition && !mSharedElementNames.isEmpty()) {
      mSharedElements.get(0).invalidate();
    }
 else     if (startEnterTransition && !mTransitioningViews.isEmpty()) {
      mTransitioningViews.get(0).invalidate();
    }
  }
 else {
    transitionStarted();
  }
  return transition;
}
