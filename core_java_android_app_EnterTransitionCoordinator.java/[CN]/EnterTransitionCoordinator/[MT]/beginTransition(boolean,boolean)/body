{
  Transition sharedElementTransition=null;
  if (startSharedElementTransition && !mSharedElementNames.isEmpty()) {
    sharedElementTransition=configureTransition(getSharedElementTransition());
  }
  Transition viewsTransition=null;
  if (startEnterTransition && !mTransitioningViews.isEmpty()) {
    viewsTransition=configureTransition(getViewsTransition());
    viewsTransition=addTargets(viewsTransition,mTransitioningViews);
  }
  Transition transition=mergeTransitions(sharedElementTransition,viewsTransition);
  if (startSharedElementTransition) {
    if (transition == null) {
      sharedElementTransitionStarted();
    }
 else {
      transition.addListener(new Transition.TransitionListenerAdapter(){
        @Override public void onTransitionStart(        Transition transition){
          transition.removeListener(this);
          sharedElementTransitionStarted();
        }
      }
);
    }
  }
  if (transition != null) {
    TransitionManager.beginDelayedTransition(getDecor(),transition);
    if (startSharedElementTransition && !mSharedElementNames.isEmpty()) {
      mSharedElements.get(0).invalidate();
    }
 else     if (startEnterTransition && !mTransitioningViews.isEmpty()) {
      mTransitioningViews.get(0).invalidate();
    }
  }
  return transition;
}
