{
  ViewGroup decor=getDecor();
  if (!decor.isLayoutRequested()) {
    Bundle state=captureSharedElementState();
    mResultReceiver.send(MSG_SHARED_ELEMENT_DESTINATION,state);
  }
 else {
    getDecor().getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener(){
      @Override public boolean onPreDraw(){
        getDecor().getViewTreeObserver().removeOnPreDrawListener(this);
        return true;
      }
    }
);
  }
}
