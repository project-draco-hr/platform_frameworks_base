{
  if (!mIsReadyForTransition || mSharedElementsBundle == null) {
    return;
  }
  final Bundle sharedElementState=mSharedElementsBundle;
  mSharedElementsBundle=null;
  final View decorView=getDecor();
  decorView.getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener(){
    @Override public boolean onPreDraw(){
      decorView.getViewTreeObserver().removeOnPreDrawListener(this);
      startTransition(new Runnable(){
        @Override public void run(){
          startSharedElementTransition(sharedElementState);
        }
      }
);
      return false;
    }
  }
);
  decorView.invalidate();
}
