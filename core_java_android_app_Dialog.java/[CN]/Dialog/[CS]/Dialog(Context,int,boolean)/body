{
  if (theme == 0) {
    TypedValue outValue=new TypedValue();
    context.getTheme().resolveAttribute(com.android.internal.R.attr.dialogTheme,outValue,true);
    theme=outValue.resourceId;
  }
  mContext=createContextWrapper ? new ContextThemeWrapper(context,theme) : context;
  mWindowManager=(WindowManager)context.getSystemService(Context.WINDOW_SERVICE);
  Window w=PolicyManager.makeNewWindow(mContext);
  mWindow=w;
  w.setCallback(this);
  w.setWindowManager(mWindowManager,null,null);
  w.setGravity(Gravity.CENTER);
  mUiThread=Thread.currentThread();
  mListenersHandler=new ListenersHandler(this);
}
