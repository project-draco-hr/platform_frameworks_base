{
  final ActivityStack prevStack=r.task.stack;
  if (prevStack.mStackId == mStackId) {
    return;
  }
  final boolean wasFocused=mStackSupervisor.isFocusedStack(prevStack) && (mStackSupervisor.topRunningActivityLocked() == r);
  final boolean wasResumed=wasFocused && (prevStack.mResumedActivity == r);
  final TaskRecord task=createTaskRecord(mStackSupervisor.getNextTaskIdForUserLocked(r.userId),r.info,r.intent,null,null,true);
  r.setTask(task,null);
  task.addActivityToTop(r);
  setAppTask(r,task);
  mStackSupervisor.scheduleReportPictureInPictureModeChangedIfNeeded(task,prevStack);
  moveToFrontAndResumeStateIfNeeded(r,wasFocused,wasResumed,"moveActivityToStack");
  if (wasResumed) {
    prevStack.mResumedActivity=null;
  }
}
