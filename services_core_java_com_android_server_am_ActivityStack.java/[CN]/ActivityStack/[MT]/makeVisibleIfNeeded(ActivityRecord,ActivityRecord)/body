{
  if (r.state == ActivityState.RESUMED || r == starting) {
    if (DEBUG_VISIBILITY)     Slog.d(TAG_VISIBILITY,"Not making visible, r=" + r + " state="+ r.state+ " starting="+ starting);
    return;
  }
  if (DEBUG_VISIBILITY)   Slog.v(TAG_VISIBILITY,"Making visible and scheduling visibility: " + r);
  try {
    if (mTranslucentActivityWaiting != null) {
      r.updateOptionsLocked(r.returningOptions);
      mUndrawnActivitiesBelowTopTranslucent.add(r);
    }
    setVisible(r,true);
    r.sleeping=false;
    r.app.pendingUiClean=true;
    r.app.thread.scheduleWindowVisibility(r.appToken,true);
    mStackSupervisor.mStoppingActivities.remove(r);
    mStackSupervisor.mGoingToSleepActivities.remove(r);
  }
 catch (  Exception e) {
    Slog.w(TAG,"Exception thrown making visibile: " + r.intent.getComponent(),e);
  }
  handleAlreadyVisible(r);
}
