{
  ActivityRecord r=topRunningActivityLocked();
  if (r != null && r.app == app) {
    Slog.w(TAG,"  Force finishing activity " + r.intent.getComponent().flattenToShortString());
    int taskNdx=mTaskHistory.indexOf(r.task);
    int activityNdx=r.task.mActivities.indexOf(r);
    finishActivityLocked(r,Activity.RESULT_CANCELED,null,reason,false);
    --activityNdx;
    if (activityNdx < 0) {
      do {
        --taskNdx;
        if (taskNdx < 0) {
          break;
        }
        activityNdx=mTaskHistory.get(taskNdx).mActivities.size() - 1;
      }
 while (activityNdx < 0);
    }
    if (activityNdx >= 0) {
      r=mTaskHistory.get(taskNdx).mActivities.get(activityNdx);
      if (r.state == ActivityState.RESUMED || r.state == ActivityState.PAUSING || r.state == ActivityState.PAUSED) {
        if (!r.isHomeActivity() || mService.mHomeProcess != r.app) {
          Slog.w(TAG,"  Force finishing activity " + r.intent.getComponent().flattenToShortString());
          finishActivityLocked(r,Activity.RESULT_CANCELED,null,reason,false);
        }
      }
    }
  }
}
