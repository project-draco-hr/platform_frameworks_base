{
  if (mCurrentUser == userId) {
    return;
  }
  mCurrentUser=userId;
  int index=mTaskHistory.size();
  for (int i=0; i < index; ) {
    final TaskRecord task=mTaskHistory.get(i);
    if (mStackSupervisor.isCurrentProfileLocked(task.userId) || task.topRunningActivityLocked() != null) {
      if (DEBUG_TASKS)       Slog.d(TAG_TASKS,"switchUserLocked: stack=" + getStackId() + " moving "+ task+ " to top");
      mTaskHistory.remove(i);
      mTaskHistory.add(task);
      --index;
    }
 else {
      ++i;
    }
  }
  if (VALIDATE_TOKENS) {
    validateAppTokensLocked();
  }
}
