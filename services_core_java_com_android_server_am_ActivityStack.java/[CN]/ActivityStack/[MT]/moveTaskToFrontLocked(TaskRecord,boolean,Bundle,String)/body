{
  if (DEBUG_SWITCH)   Slog.v(TAG_SWITCH,"moveTaskToFront: " + tr);
  final int numTasks=mTaskHistory.size();
  final int index=mTaskHistory.indexOf(tr);
  if (numTasks == 0 || index < 0) {
    if (noAnimation) {
      ActivityOptions.abort(options);
    }
 else {
      updateTransitLocked(AppTransition.TRANSIT_TASK_TO_FRONT,options);
    }
    return;
  }
  insertTaskAtTop(tr);
  ActivityRecord r=topRunningActivityLocked(null);
  mService.setFocusedActivityLocked(r,reason);
  if (DEBUG_TRANSITION)   Slog.v(TAG_TRANSITION,"Prepare to front transition: task=" + tr);
  if (noAnimation) {
    mWindowManager.prepareAppTransition(AppTransition.TRANSIT_NONE,false);
    if (r != null) {
      mNoAnimActivities.add(r);
    }
    ActivityOptions.abort(options);
  }
 else {
    updateTransitLocked(AppTransition.TRANSIT_TASK_TO_FRONT,options);
  }
  mStackSupervisor.resumeTopActivitiesLocked();
  EventLog.writeEvent(EventLogTags.AM_TASK_TO_FRONT,tr.userId,tr.taskId);
  if (VALIDATE_TOKENS) {
    validateAppTokensLocked();
  }
}
