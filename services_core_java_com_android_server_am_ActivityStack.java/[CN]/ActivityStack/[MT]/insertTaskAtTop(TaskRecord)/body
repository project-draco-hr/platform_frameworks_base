{
  if (isOnHomeDisplay()) {
    ActivityStack lastStack=mStackSupervisor.getLastStack();
    final boolean fromHome=lastStack.isHomeStack();
    if (!isHomeStack() && (fromHome || topTask() != task)) {
      task.setTaskToReturnTo(fromHome ? lastStack.topTask().taskType : APPLICATION_ACTIVITY_TYPE);
    }
  }
 else {
    task.setTaskToReturnTo(APPLICATION_ACTIVITY_TYPE);
  }
  mTaskHistory.remove(task);
  int stackNdx=mTaskHistory.size();
  if (!isCurrentProfileLocked(task.userId)) {
    while (--stackNdx >= 0) {
      if (!isCurrentProfileLocked(mTaskHistory.get(stackNdx).userId)) {
        break;
      }
    }
    ++stackNdx;
  }
  mTaskHistory.add(stackNdx,task);
  updateTaskMovement(task,true);
}
