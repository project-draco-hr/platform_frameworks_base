{
  if (mResumedActivity == r) {
    mResumedActivity=null;
  }
  if (mPausingActivity == r) {
    mPausingActivity=null;
  }
  mService.resetFocusedActivityIfNeededLocked(r);
  r.deferRelaunchUntilPaused=false;
  r.frozenBeforeDestroy=false;
  if (setState) {
    if (DEBUG_STATES)     Slog.v(TAG_STATES,"Moving to DESTROYED: " + r + " (cleaning up)");
    r.state=ActivityState.DESTROYED;
    if (DEBUG_APP)     Slog.v(TAG_APP,"Clearing app during cleanUp for activity " + r);
    r.app=null;
  }
  mStackSupervisor.mFinishingActivities.remove(r);
  mStackSupervisor.mWaitingVisibleActivities.remove(r);
  if (r.finishing && r.pendingResults != null) {
    for (    WeakReference<PendingIntentRecord> apr : r.pendingResults) {
      PendingIntentRecord rec=apr.get();
      if (rec != null) {
        mService.cancelIntentSenderLocked(rec,false);
      }
    }
    r.pendingResults=null;
  }
  if (cleanServices) {
    cleanUpActivityServicesLocked(r);
  }
  removeTimeoutsForActivityLocked(r);
  if (getVisibleBehindActivity() == r) {
    mStackSupervisor.requestVisibleBehindLocked(r,false);
  }
}
