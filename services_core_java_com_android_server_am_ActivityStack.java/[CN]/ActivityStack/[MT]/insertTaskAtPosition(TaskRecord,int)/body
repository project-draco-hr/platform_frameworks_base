{
  if (position >= mTaskHistory.size()) {
    insertTaskAtTop(task,null);
    return;
  }
  int maxPosition=mTaskHistory.size();
  if (!mStackSupervisor.isCurrentProfileLocked(task.userId) && task.topRunningActivityLocked() == null) {
    while (maxPosition > 0) {
      final TaskRecord tmpTask=mTaskHistory.get(maxPosition - 1);
      if (!mStackSupervisor.isCurrentProfileLocked(tmpTask.userId) || tmpTask.topRunningActivityLocked() == null) {
        break;
      }
      maxPosition--;
    }
  }
  position=Math.min(position,maxPosition);
  mTaskHistory.remove(task);
  mTaskHistory.add(position,task);
  updateTaskMovement(task,true);
}
