{
  if (who.noDisplay) {
    return null;
  }
  TaskRecord tr=who.task;
  if (mService.getMostRecentTask() != tr && tr.intent != null && (tr.intent.getFlags() & Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS) != 0) {
    return null;
  }
  Resources res=mService.mContext.getResources();
  int w=mThumbnailWidth;
  int h=mThumbnailHeight;
  if (w < 0) {
    mThumbnailWidth=w=res.getDimensionPixelSize(com.android.internal.R.dimen.thumbnail_width);
    mThumbnailHeight=h=res.getDimensionPixelSize(com.android.internal.R.dimen.thumbnail_height);
  }
  if (w > 0) {
    if (who != mLastScreenshotActivity || mLastScreenshotBitmap == null || mLastScreenshotActivity.state == ActivityState.RESUMED || mLastScreenshotBitmap.getWidth() != w || mLastScreenshotBitmap.getHeight() != h) {
      mLastScreenshotActivity=who;
      mLastScreenshotBitmap=mWindowManager.screenshotApplications(who.appToken,Display.DEFAULT_DISPLAY,w,h,SCREENSHOT_FORCE_565);
    }
    if (mLastScreenshotBitmap != null) {
      return mLastScreenshotBitmap.copy(mLastScreenshotBitmap.getConfig(),true);
    }
  }
  return null;
}
