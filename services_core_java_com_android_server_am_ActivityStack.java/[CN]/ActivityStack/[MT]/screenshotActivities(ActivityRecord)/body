{
  if (DEBUG_SCREENSHOTS)   Slog.d(TAG,"screenshotActivities: " + who);
  if (who.noDisplay) {
    if (DEBUG_SCREENSHOTS)     Slog.d(TAG,"\tNo display");
    return null;
  }
  if (isHomeStack()) {
    invalidateLastScreenshot();
    if (DEBUG_SCREENSHOTS)     Slog.d(TAG,"\tIs Home stack? " + isHomeStack());
    return null;
  }
  int w=mService.mThumbnailWidth;
  int h=mService.mThumbnailHeight;
  if (w > 0) {
    if (who != mLastScreenshotActivity || mLastScreenshotBitmap == null || mLastScreenshotActivity.state == ActivityState.RESUMED || mLastScreenshotBitmap.getWidth() != w || mLastScreenshotBitmap.getHeight() != h) {
      if (DEBUG_SCREENSHOTS)       Slog.d(TAG,"\tUpdating screenshot");
      mLastScreenshotActivity=who;
      mLastScreenshotBitmap=mWindowManager.screenshotApplications(who.appToken,Display.DEFAULT_DISPLAY,w,h,SCREENSHOT_FORCE_565);
    }
    if (mLastScreenshotBitmap != null) {
      if (DEBUG_SCREENSHOTS)       Slog.d(TAG,"\tReusing last screenshot");
      return mLastScreenshotBitmap.copy(mLastScreenshotBitmap.getConfig(),true);
    }
  }
  Slog.e(TAG,"Invalid thumbnail dimensions: " + w + "x"+ h);
  return null;
}
