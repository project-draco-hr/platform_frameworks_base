{
  if (!mStackSupervisor.isFocusedStack(this) || mService.mFocusedActivity != r) {
    return;
  }
  final ActivityRecord next=topRunningActivityLocked();
  final String myReason=reason + " adjustFocus";
  if (next != r) {
    if (next != null && StackId.keepFocusInStackIfPossible(mStackId) && isFocusable()) {
      mService.setFocusedActivityLocked(next,myReason);
      return;
    }
 else {
      final TaskRecord task=r.task;
      if (r.frontOfTask && task == topTask() && task.isOverHomeStack()) {
        final int taskToReturnTo=task.getTaskToReturnTo();
        if (!mFullscreen && adjustFocusToNextFocusableStackLocked(taskToReturnTo,myReason)) {
          return;
        }
        if (mStackSupervisor.moveHomeStackTaskToTop(taskToReturnTo,myReason)) {
          return;
        }
      }
    }
  }
  mService.setFocusedActivityLocked(mStackSupervisor.topRunningActivityLocked(),myReason);
}
