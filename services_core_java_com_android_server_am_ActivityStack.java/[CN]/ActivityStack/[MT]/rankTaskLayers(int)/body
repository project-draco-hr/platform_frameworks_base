{
  int layer=0;
  for (int taskNdx=mTaskHistory.size() - 1; taskNdx >= 0; --taskNdx) {
    final TaskRecord task=mTaskHistory.get(taskNdx);
    ActivityRecord r=task.topRunningActivityLocked();
    if (r == null || r.finishing || !r.visible) {
      task.mLayerRank=-1;
    }
 else {
      task.mLayerRank=baseLayer + layer++;
    }
  }
  return layer;
}
