{
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  ConditionVariable cv=waitForConnectivityBroadcasts(1);
  mWiFiNetworkAgent.connect(false);
  cv.block();
  verifyActiveNetwork(TRANSPORT_WIFI);
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_CELLULAR);
  mCellNetworkAgent.connect(false);
  try {
    Thread.sleep(1000);
  }
 catch (  Exception e) {
  }
  verifyActiveNetwork(TRANSPORT_WIFI);
  mCellNetworkAgent.disconnect();
  try {
    Thread.sleep(1000);
  }
 catch (  Exception e) {
  }
  verifyActiveNetwork(TRANSPORT_WIFI);
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_CELLULAR);
  cv=waitForConnectivityBroadcasts(2);
  mCellNetworkAgent.connect(true);
  cv.block();
  verifyActiveNetwork(TRANSPORT_CELLULAR);
  cv=waitForConnectivityBroadcasts(2);
  mCellNetworkAgent.disconnect();
  cv.block();
  verifyActiveNetwork(TRANSPORT_WIFI);
  cv=waitForConnectivityBroadcasts(1);
  mWiFiNetworkAgent.disconnect();
  cv.block();
  verifyNoNetwork();
}
