{
  NetworkRequest wifiRequest=new NetworkRequest.Builder().addTransportType(TRANSPORT_WIFI).build();
  assertNull(mCm.getBoundNetworkForProcess());
  TestNetworkPinner.pin(mServiceContext,wifiRequest);
  assertNull(mCm.getBoundNetworkForProcess());
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_CELLULAR);
  mCellNetworkAgent.connect(true);
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  mWiFiNetworkAgent.connect(false);
  assertTrue(TestNetworkPinner.awaitPin(100));
  assertPinnedToWifiWithCellDefault();
  mWiFiNetworkAgent.disconnect();
  assertTrue(TestNetworkPinner.awaitUnpin(100));
  assertNotPinnedToWifi();
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  mWiFiNetworkAgent.connect(false);
  assertFalse(TestNetworkPinner.awaitPin(100));
  assertNotPinnedToWifi();
  TestNetworkPinner.pin(mServiceContext,wifiRequest);
  assertTrue(TestNetworkPinner.awaitPin(100));
  assertPinnedToWifiWithCellDefault();
  TestNetworkPinner.unpin();
  assertNotPinnedToWifi();
  ConditionVariable cv=waitForConnectivityBroadcasts(3);
  mCellNetworkAgent.disconnect();
  mWiFiNetworkAgent.disconnect();
  waitFor(cv);
  TestNetworkPinner.pin(mServiceContext,wifiRequest);
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  mWiFiNetworkAgent.connect(false);
  assertTrue(TestNetworkPinner.awaitPin(100));
  assertPinnedToWifiWithWifiDefault();
  cv=waitForConnectivityBroadcasts(1);
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  mCellNetworkAgent.connect(true);
  waitFor(cv);
  assertPinnedToWifiWithCellDefault();
}
