{
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  ConditionVariable cv=mWiFiNetworkAgent.getDisconnectedCV();
  mWiFiNetworkAgent.connectWithoutInternet();
  waitFor(cv);
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  cv=mCellNetworkAgent.getDisconnectedCV();
  mCellNetworkAgent.connectWithoutInternet();
  waitFor(cv);
  mWiFiNetworkAgent=new MockNetworkAgent(TRANSPORT_WIFI);
  cv=waitForConnectivityBroadcasts(1);
  mWiFiNetworkAgent.connect(true);
  waitFor(cv);
  verifyActiveNetwork(TRANSPORT_WIFI);
  mCellNetworkAgent=new MockNetworkAgent(TRANSPORT_CELLULAR);
  cv=mCellNetworkAgent.getDisconnectedCV();
  mCellNetworkAgent.connect(false);
  waitFor(cv);
  verifyActiveNetwork(TRANSPORT_WIFI);
  cv=mWiFiNetworkAgent.getDisconnectedCV();
  mWiFiNetworkAgent.disconnect();
  waitFor(cv);
}
