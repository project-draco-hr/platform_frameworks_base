{
  Future<?> nextConnBroadcast;
  mMobile.info.setDetailedState(DetailedState.CONNECTED,null,null);
  mMobile.link.setInterfaceName(MOBILE_IFACE);
  mMobile.link.addRoute(MOBILE_ROUTE_V4);
  mMobile.link.addRoute(MOBILE_ROUTE_V6);
  mMobile.doReturnDefaults();
  nextConnBroadcast=mServiceContext.nextBroadcastIntent(CONNECTIVITY_ACTION_IMMEDIATE);
  mTrackerHandler.obtainMessage(EVENT_STATE_CHANGED,mMobile.info).sendToTarget();
  nextConnBroadcast.get();
  reset(mNetManager);
  mWifi.info.setDetailedState(DetailedState.CONNECTED,null,null);
  mWifi.link.setInterfaceName(WIFI_IFACE);
  mWifi.link.addRoute(WIFI_ROUTE_V4);
  mWifi.link.addRoute(WIFI_ROUTE_V6);
  mWifi.doReturnDefaults();
  doReturn(true).when(mMobile.tracker).teardown();
  nextConnBroadcast=mServiceContext.nextBroadcastIntent(CONNECTIVITY_ACTION_IMMEDIATE);
  mTrackerHandler.obtainMessage(EVENT_STATE_CHANGED,mWifi.info).sendToTarget();
  nextConnBroadcast.get();
  int wifiNetId=mWifi.tracker.getNetwork().netId;
  verify(mNetManager).addRoute(eq(wifiNetId),eq(WIFI_ROUTE_V4));
  verify(mNetManager).addRoute(eq(wifiNetId),eq(WIFI_ROUTE_V6));
  verify(mMobile.tracker).teardown();
  int mobileNetId=mMobile.tracker.getNetwork().netId;
  reset(mNetManager,mMobile.tracker);
  mMobile.info.setDetailedState(DetailedState.DISCONNECTED,null,null);
  mMobile.link.clear();
  mMobile.doReturnDefaults();
  nextConnBroadcast=mServiceContext.nextBroadcastIntent(CONNECTIVITY_ACTION_IMMEDIATE);
  mTrackerHandler.obtainMessage(EVENT_STATE_CHANGED,mMobile.info).sendToTarget();
  nextConnBroadcast.get();
  verify(mNetManager).removeRoute(eq(mobileNetId),eq(MOBILE_ROUTE_V4));
  verify(mNetManager).removeRoute(eq(mobileNetId),eq(MOBILE_ROUTE_V6));
}
