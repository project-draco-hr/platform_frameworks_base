{
  int callingUid=enforceCallingUid(packageName);
synchronized (mAppWidgetIds) {
    int appWidgetId=mNextAppWidgetId++;
    Host host=lookupOrAddHostLocked(callingUid,packageName,hostId);
    AppWidgetId id=new AppWidgetId();
    id.appWidgetId=appWidgetId;
    id.host=host;
    host.instances.add(id);
    mAppWidgetIds.add(id);
    saveStateLocked();
    return appWidgetId;
  }
}
