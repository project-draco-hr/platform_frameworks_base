{
  mContext=context;
  updateWifiIcons();
  mPhone=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  mPhone.listen(mPhoneStateListener,PhoneStateListener.LISTEN_SERVICE_STATE | PhoneStateListener.LISTEN_SIGNAL_STRENGTHS | PhoneStateListener.LISTEN_CALL_STATE| PhoneStateListener.LISTEN_DATA_CONNECTION_STATE| PhoneStateListener.LISTEN_DATA_ACTIVITY);
  mHspaDataDistinguishable=mContext.getResources().getBoolean(R.bool.config_hspa_data_distinguishable);
  mNetworkNameSeparator=mContext.getString(R.string.status_bar_network_name_separator);
  mNetworkNameDefault=mContext.getString(com.android.internal.R.string.lockscreen_carrier_default);
  mNetworkName=mNetworkNameDefault;
  mWifiManager=(WifiManager)context.getSystemService(Context.WIFI_SERVICE);
  HandlerThread handlerThread=new HandlerThread("WifiServiceThread");
  handlerThread.start();
  Handler handler=new WifiHandler(handlerThread.getLooper());
  mWifiChannel=new AsyncChannel();
  Messenger wifiMessenger=mWifiManager.getMessenger();
  if (wifiMessenger != null) {
    mWifiChannel.connect(mContext,handler,wifiMessenger);
  }
  IntentFilter filter=new IntentFilter();
  filter.addAction(WifiManager.RSSI_CHANGED_ACTION);
  filter.addAction(WifiManager.WIFI_STATE_CHANGED_ACTION);
  filter.addAction(WifiManager.NETWORK_STATE_CHANGED_ACTION);
  filter.addAction(TelephonyIntents.ACTION_SIM_STATE_CHANGED);
  filter.addAction(Telephony.Intents.SPN_STRINGS_UPDATED_ACTION);
  filter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);
  filter.addAction(ConnectivityManager.INET_CONDITION_ACTION);
  filter.addAction(Intent.ACTION_CONFIGURATION_CHANGED);
  context.registerReceiver(this,filter);
  mBatteryStats=BatteryStatsService.getService();
}
