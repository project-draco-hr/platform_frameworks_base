{
  int maxKeyguardNotifications=getMaxKeyguardNotifications();
  mOverflowIconsView.removeAllViews();
  int n=mNotificationData.size();
  int visibleNotifications=0;
  for (int i=n - 1; i >= 0; i--) {
    NotificationData.Entry entry=mNotificationData.get(i);
    if (mOnKeyguard) {
      entry.row.setSystemExpanded(false);
    }
 else {
      if (!entry.row.isUserLocked()) {
        boolean top=(i == n - 1);
        entry.row.setSystemExpanded(top || entry.row.isUserExpanded());
      }
    }
    entry.row.setDimmed(mOnKeyguard);
    entry.row.setLocked(mOnKeyguard);
    boolean showOnKeyguard=shouldShowOnKeyguard(entry.notification);
    if (mOnKeyguard && (visibleNotifications >= maxKeyguardNotifications || !showOnKeyguard)) {
      entry.row.setVisibility(View.GONE);
      if (showOnKeyguard) {
        mOverflowIconsView.addNotification(entry);
      }
    }
 else {
      entry.row.setVisibility(View.VISIBLE);
      visibleNotifications++;
    }
  }
  if (mOnKeyguard && mOverflowIconsView.getChildCount() > 0) {
    mKeyguardIconOverflowContainer.setVisibility(View.VISIBLE);
  }
 else {
    mKeyguardIconOverflowContainer.setVisibility(View.GONE);
  }
}
