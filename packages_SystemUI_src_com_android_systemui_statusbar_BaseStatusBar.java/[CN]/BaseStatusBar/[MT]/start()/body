{
  mWindowManager=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
  mWindowManagerService=WindowManagerGlobal.getWindowManagerService();
  mDisplay=mWindowManager.getDefaultDisplay();
  mProvisioningObserver.onChange(false);
  mContext.getContentResolver().registerContentObserver(Settings.Global.getUriFor(Settings.Global.DEVICE_PROVISIONED),true,mProvisioningObserver);
  mBarService=IStatusBarService.Stub.asInterface(ServiceManager.getService(Context.STATUS_BAR_SERVICE));
  StatusBarIconList iconList=new StatusBarIconList();
  ArrayList<IBinder> notificationKeys=new ArrayList<IBinder>();
  ArrayList<StatusBarNotification> notifications=new ArrayList<StatusBarNotification>();
  mCommandQueue=new CommandQueue(this,iconList);
  int[] switches=new int[7];
  ArrayList<IBinder> binders=new ArrayList<IBinder>();
  try {
    mBarService.registerStatusBar(mCommandQueue,iconList,notificationKeys,notifications,switches,binders);
  }
 catch (  RemoteException ex) {
  }
  createAndAddWindows();
  disable(switches[0]);
  setSystemUiVisibility(switches[1],0xffffffff);
  topAppWindowChanged(switches[2] != 0);
  setImeWindowStatus(binders.get(0),switches[3],switches[4]);
  setHardKeyboardStatus(switches[5] != 0,switches[6] != 0);
  int N=iconList.size();
  int viewIndex=0;
  for (int i=0; i < N; i++) {
    StatusBarIcon icon=iconList.getIcon(i);
    if (icon != null) {
      addIcon(iconList.getSlot(i),i,viewIndex,icon);
      viewIndex++;
    }
  }
  N=notificationKeys.size();
  if (N == notifications.size()) {
    for (int i=0; i < N; i++) {
      addNotification(notificationKeys.get(i),notifications.get(i));
    }
  }
 else {
    Log.wtf(TAG,"Notification list length mismatch: keys=" + N + " notifications="+ notifications.size());
  }
  if (DEBUG) {
    Slog.d(TAG,String.format("init: icons=%d disabled=0x%08x lights=0x%08x menu=0x%08x imeButton=0x%08x",iconList.size(),switches[0],switches[1],switches[2],switches[3]));
  }
  mCurrentUserId=ActivityManager.getCurrentUser();
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_USER_SWITCHED);
  mContext.registerReceiver(new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      String action=intent.getAction();
      if (Intent.ACTION_USER_SWITCHED.equals(action)) {
        mCurrentUserId=intent.getIntExtra(Intent.EXTRA_USER_HANDLE,-1);
        if (true)         Slog.v(TAG,"userId " + mCurrentUserId + " is in the house");
        userSwitched(mCurrentUserId);
      }
    }
  }
,filter);
}
