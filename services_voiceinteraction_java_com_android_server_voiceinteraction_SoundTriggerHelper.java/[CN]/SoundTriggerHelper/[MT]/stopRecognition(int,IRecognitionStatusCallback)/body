{
  if (listener == null) {
    return STATUS_ERROR;
  }
synchronized (mLock) {
    if (DBG) {
      Slog.d(TAG,"stopRecognition for keyphraseId=" + keyphraseId + ", listener="+ listener.asBinder());
      Slog.d(TAG,"current listener=" + (mActiveListener == null ? "null" : mActiveListener.asBinder()));
    }
    if (moduleProperties == null || mModule == null) {
      Slog.w(TAG,"Attempting stopRecognition without the capability");
      return STATUS_ERROR;
    }
    if (mActiveListener == null) {
      Slog.w(TAG,"Attempting stopRecognition without a successful startRecognition");
      return STATUS_ERROR;
    }
    if (mActiveListener.asBinder() != listener.asBinder()) {
      Slog.w(TAG,"Attempting stopRecognition for another recognition");
      return STATUS_ERROR;
    }
    mRequested=false;
    int status=updateRecognitionLocked(false);
    if (status != SoundTrigger.STATUS_OK) {
      return status;
    }
    status=mModule.unloadSoundModel(mCurrentSoundModelHandle);
    if (status != SoundTrigger.STATUS_OK) {
      Slog.w(TAG,"unloadSoundModel call failed with " + status);
    }
    internalClearStateLocked();
    return status;
  }
}
