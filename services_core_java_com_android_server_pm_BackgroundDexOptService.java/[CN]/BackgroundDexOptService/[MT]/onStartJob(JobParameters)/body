{
  Log.i(TAG,"onStartJob");
  final PackageManagerService pm=(PackageManagerService)ServiceManager.getService("package");
  if (pm.isStorageLow()) {
    Log.i(TAG,"Low storage, skipping this run");
    return false;
  }
  final ArraySet<String> pkgs=pm.getOptimizablePackages();
  if (pkgs == null || pkgs.isEmpty()) {
    Log.i(TAG,"No packages to optimize");
    return false;
  }
  final JobParameters jobParams=params;
  mIdleTime.set(true);
  new Thread("BackgroundDexOptService_DexOpter"){
    @Override public void run(){
      for (      String pkg : pkgs) {
        if (!mIdleTime.get()) {
          return;
        }
        if (sFailedPackageNames.contains(pkg)) {
          continue;
        }
        if (!pm.performDexOpt(pkg,null,true,REASON_BACKGROUND_DEXOPT,false)) {
          sFailedPackageNames.add(pkg);
        }
      }
      jobFinished(jobParams,false);
    }
  }
.start();
  return true;
}
