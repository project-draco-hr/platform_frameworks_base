{
  Log.i(TAG,"onIdleStart");
  final PackageManagerService pm=(PackageManagerService)ServiceManager.getService("package");
  if (pm.isStorageLow()) {
    schedule(BackgroundDexOptService.this,RETRY_LATENCY);
    return false;
  }
  final ArraySet<String> pkgs=pm.getPackagesThatNeedDexOpt();
  if (pkgs == null) {
    return false;
  }
  final JobParameters jobParams=params;
  mIdleTime.set(true);
  new Thread("BackgroundDexOptService_DexOpter"){
    @Override public void run(){
      for (      String pkg : pkgs) {
        if (!mIdleTime.get()) {
          schedule(BackgroundDexOptService.this,0);
          return;
        }
        if (sFailedPackageNames.contains(pkg)) {
          continue;
        }
        if (!pm.performDexOpt(pkg,null,true)) {
          sFailedPackageNames.add(pkg);
        }
      }
      jobFinished(jobParams,false);
    }
  }
.start();
  return true;
}
