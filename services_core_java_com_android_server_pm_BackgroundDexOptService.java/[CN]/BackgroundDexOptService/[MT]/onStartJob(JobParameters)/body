{
  if (DEBUG_DEXOPT) {
    Log.i(TAG,"onStartJob");
  }
  PackageManagerService pm=(PackageManagerService)ServiceManager.getService("package");
  if (pm.isStorageLow()) {
    if (DEBUG_DEXOPT) {
      Log.i(TAG,"Low storage, skipping this run");
    }
    return false;
  }
  final ArraySet<String> pkgs=pm.getOptimizablePackages();
  if (pkgs == null || pkgs.isEmpty()) {
    if (DEBUG_DEXOPT) {
      Log.i(TAG,"No packages to optimize");
    }
    return false;
  }
  if (params.getJobId() == JOB_POST_BOOT_UPDATE) {
    return runPostBootUpdate(params,pm,pkgs);
  }
 else {
    return runIdleOptimization(params,pm,pkgs);
  }
}
