{
  if (header != null) {
    int posMax=256;
    int posLen=0;
    int[] pos=new int[posMax];
    int headerLen=header.length();
    if (headerLen > 0) {
      boolean quoted=false;
      for (int i=0; i < headerLen && posLen < posMax; ++i) {
        if (header.charAt(i) == '\"') {
          quoted=!quoted;
        }
 else {
          if (!quoted) {
            if (header.regionMatches(true,i,HttpAuthHeader.BASIC_TOKEN,0,HttpAuthHeader.BASIC_TOKEN.length())) {
              pos[posLen++]=i;
              continue;
            }
            if (header.regionMatches(true,i,HttpAuthHeader.DIGEST_TOKEN,0,HttpAuthHeader.DIGEST_TOKEN.length())) {
              pos[posLen++]=i;
              continue;
            }
          }
        }
      }
    }
    if (posLen > 0) {
      for (int i=0; i < posLen; i++) {
        if (header.regionMatches(true,pos[i],HttpAuthHeader.DIGEST_TOKEN,0,HttpAuthHeader.DIGEST_TOKEN.length())) {
          String sub=header.substring(pos[i],(i + 1 < posLen ? pos[i + 1] : headerLen));
          HttpAuthHeader rval=new HttpAuthHeader(sub);
          if (rval.isSupportedScheme()) {
            return rval;
          }
        }
      }
      for (int i=0; i < posLen; i++) {
        if (header.regionMatches(true,pos[i],HttpAuthHeader.BASIC_TOKEN,0,HttpAuthHeader.BASIC_TOKEN.length())) {
          String sub=header.substring(pos[i],(i + 1 < posLen ? pos[i + 1] : headerLen));
          HttpAuthHeader rval=new HttpAuthHeader(sub);
          if (rval.isSupportedScheme()) {
            return rval;
          }
        }
      }
    }
  }
  return null;
}
