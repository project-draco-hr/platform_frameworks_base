{
  final int TOTAL_DOWNLOADS=15;
  HashSet<Long> downloadIds=new HashSet<Long>(TOTAL_DOWNLOADS);
  MultipleDownloadsCompletedReceiver receiver=registerNewMultipleDownloadsReceiver();
  removeAllCurrentDownloads();
  try {
    for (int i=0; i < TOTAL_DOWNLOADS; ++i) {
      long dlRequest=-1;
      String filename=FILE_CONCURRENT_DOWNLOAD_FILE_PREFIX + i + FILE_CONCURRENT_DOWNLOAD_FILE_EXTENSION;
      Uri remoteUri=getExternalFileUri(filename);
      Request request=new Request(remoteUri);
      request.setTitle(filename);
      dlRequest=mDownloadManager.enqueue(request);
      assertTrue(dlRequest != -1);
      downloadIds.add(dlRequest);
    }
    waitForDownloadsOrTimeout(DEFAULT_WAIT_POLL_TIME,15 * 60 * 2000);
    assertEquals(TOTAL_DOWNLOADS,receiver.numDownloadsCompleted());
  }
  finally {
    removeAllCurrentDownloads();
  }
}
