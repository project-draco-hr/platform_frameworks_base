{
  if (mListening == listening)   return;
  mListening=listening;
  if (listening) {
    mHandler.removeCallbacks(mUnbind);
    if (!mBound) {
      mContext.bindServiceAsUser(new Intent().setComponent(mComponent),mServiceConnection,Service.BIND_AUTO_CREATE,new UserHandle(ActivityManager.getCurrentUser()));
      mBound=true;
    }
  }
 else {
    if (mService != null) {
      mService.onStopListening();
    }
    if (mIsTokenGranted && !mIsShowingDialog) {
      try {
        if (DEBUG)         Log.d(TAG,"Removing token");
        mWindowManager.removeWindowToken(mToken);
      }
 catch (      RemoteException e) {
      }
      mIsTokenGranted=false;
    }
    mIsShowingDialog=false;
    mHandler.postDelayed(mUnbind,UNBIND_DELAY);
  }
}
