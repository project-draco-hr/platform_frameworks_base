{
  expectRulesChanged(UID_A,RULE_ALLOW_ALL);
  replay();
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,true);
  mService.setUidPolicy(UID_A,POLICY_REJECT_PAID_BACKGROUND);
  verifyAndReset();
  expect(mPowerManager.isScreenOn()).andReturn(false).atLeastOnce();
  expectRulesChanged(UID_A,RULE_REJECT_PAID);
  replay();
  mServiceContext.sendBroadcast(new Intent(Intent.ACTION_SCREEN_OFF));
  verifyAndReset();
  expect(mPowerManager.isScreenOn()).andReturn(true).atLeastOnce();
  expectRulesChanged(UID_A,RULE_ALLOW_ALL);
  replay();
  mServiceContext.sendBroadcast(new Intent(Intent.ACTION_SCREEN_ON));
  verifyAndReset();
}
