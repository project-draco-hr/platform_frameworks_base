{
  Future<Void> future;
  expectSetUidMeteredNetworkBlacklist(UID_A,true);
  expectSetUidForeground(UID_A,false);
  future=expectRulesChanged(UID_A,RULE_REJECT_METERED);
  replay();
  mService.setUidPolicy(APP_ID_A,POLICY_REJECT_METERED_BACKGROUND);
  future.get();
  verifyAndReset();
  expectSetUidMeteredNetworkBlacklist(UID_A,false);
  expectSetUidForeground(UID_A,false);
  future=expectRulesChanged(UID_A,RULE_ALLOW_ALL);
  replay();
  final Intent intent=new Intent(ACTION_UID_REMOVED);
  intent.putExtra(EXTRA_UID,UID_A);
  mServiceContext.sendBroadcast(intent);
  future.get();
  verifyAndReset();
}
