{
  IdleFuture idle;
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_3,UID_B,false);
  idle.get();
  assertFalse(mService.isUidForeground(UID_A));
  assertFalse(mService.isUidForeground(UID_B));
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,true);
  idle.get();
  assertTrue(mService.isUidForeground(UID_A));
  assertFalse(mService.isUidForeground(UID_B));
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_3,UID_B,true);
  idle.get();
  assertFalse(mService.isUidForeground(UID_A));
  assertTrue(mService.isUidForeground(UID_B));
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,true);
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,true);
  idle.get();
  assertTrue(mService.isUidForeground(UID_A));
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,false);
  idle.get();
  assertTrue(mService.isUidForeground(UID_A));
  idle=expectIdle();
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  idle.get();
  assertFalse(mService.isUidForeground(UID_A));
}
