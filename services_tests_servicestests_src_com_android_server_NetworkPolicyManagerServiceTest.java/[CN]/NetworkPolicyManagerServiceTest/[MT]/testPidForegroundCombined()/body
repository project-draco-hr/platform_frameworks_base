{
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_3,UID_B,false);
  waitUntilIdle();
  assertFalse(mService.isUidForeground(UID_A));
  assertFalse(mService.isUidForeground(UID_B));
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,true);
  waitUntilIdle();
  assertTrue(mService.isUidForeground(UID_A));
  assertFalse(mService.isUidForeground(UID_B));
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  mProcessObserver.onForegroundActivitiesChanged(PID_3,UID_B,true);
  waitUntilIdle();
  assertFalse(mService.isUidForeground(UID_A));
  assertTrue(mService.isUidForeground(UID_B));
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,true);
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,true);
  waitUntilIdle();
  assertTrue(mService.isUidForeground(UID_A));
  mProcessObserver.onForegroundActivitiesChanged(PID_1,UID_A,false);
  waitUntilIdle();
  assertTrue(mService.isUidForeground(UID_A));
  mProcessObserver.onForegroundActivitiesChanged(PID_2,UID_A,false);
  waitUntilIdle();
  assertFalse(mService.isUidForeground(UID_A));
}
