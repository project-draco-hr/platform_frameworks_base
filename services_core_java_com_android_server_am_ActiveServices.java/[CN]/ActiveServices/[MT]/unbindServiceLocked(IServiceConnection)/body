{
  IBinder binder=connection.asBinder();
  if (DEBUG_SERVICE)   Slog.v(TAG,"unbindService: conn=" + binder);
  ArrayList<ConnectionRecord> clist=mServiceConnections.get(binder);
  if (clist == null) {
    Slog.w(TAG,"Unbind failed: could not find connection for " + connection.asBinder());
    return false;
  }
  final long origId=Binder.clearCallingIdentity();
  try {
    while (clist.size() > 0) {
      ConnectionRecord r=clist.get(0);
      removeConnectionLocked(r,null,null);
      if (r.binding.service.app != null) {
        mAm.updateOomAdjLocked(r.binding.service.app);
      }
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
  return true;
}
