{
  final long origId=Binder.clearCallingIdentity();
  try {
    if (r != null) {
      Intent.FilterComparison filter=new Intent.FilterComparison(intent);
      IntentBindRecord b=r.bindings.get(filter);
      if (DEBUG_SERVICE)       Slog.v(TAG,"unbindFinished in " + r + " at "+ b+ ": apps="+ (b != null ? b.apps.size() : 0));
      boolean inDestroying=mDestroyingServices.contains(r);
      if (b != null) {
        if (b.apps.size() > 0 && !inDestroying) {
          boolean inFg=false;
          for (int i=b.apps.size() - 1; i >= 0; i--) {
            ProcessRecord client=b.apps.valueAt(i).client;
            if (client != null && client.setSchedGroup != Process.THREAD_GROUP_BG_NONINTERACTIVE) {
              inFg=true;
              break;
            }
          }
          requestServiceBindingLocked(r,b,inFg,true);
        }
 else {
          b.doRebind=true;
        }
      }
      serviceDoneExecutingLocked(r,inDestroying,false);
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
}
