{
  final long origId=Binder.clearCallingIdentity();
  try {
    if (DEBUG_SERVICE)     Slog.v(TAG_SERVICE,"PUBLISHING " + r + " "+ intent+ ": "+ service);
    if (r != null) {
      Intent.FilterComparison filter=new Intent.FilterComparison(intent);
      IntentBindRecord b=r.bindings.get(filter);
      if (b != null && !b.received) {
        b.binder=service;
        b.requested=true;
        b.received=true;
        for (int conni=r.connections.size() - 1; conni >= 0; conni--) {
          ArrayList<ConnectionRecord> clist=r.connections.valueAt(conni);
          for (int i=0; i < clist.size(); i++) {
            ConnectionRecord c=clist.get(i);
            if (!filter.equals(c.binding.intent.intent)) {
              if (DEBUG_SERVICE)               Slog.v(TAG_SERVICE,"Not publishing to: " + c);
              if (DEBUG_SERVICE)               Slog.v(TAG_SERVICE,"Bound intent: " + c.binding.intent.intent);
              if (DEBUG_SERVICE)               Slog.v(TAG_SERVICE,"Published intent: " + intent);
              continue;
            }
            if (DEBUG_SERVICE)             Slog.v(TAG_SERVICE,"Publishing to: " + c);
            try {
              c.conn.connected(r.name,service);
            }
 catch (            Exception e) {
              Slog.w(TAG,"Failure sending service " + r.name + " to connection "+ c.conn.asBinder()+ " (in "+ c.binding.client.processName+ ")",e);
            }
          }
        }
      }
      serviceDoneExecutingLocked(r,mDestroyingServices.contains(r),false);
    }
  }
  finally {
    Binder.restoreCallingIdentity(origId);
  }
}
