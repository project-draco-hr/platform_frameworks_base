{
  ServiceMap services=mServiceMap.get(UserHandle.getUserId(uid));
  ArrayList<ServiceRecord> stopping=null;
  if (services != null) {
    for (int i=services.mServicesByName.size() - 1; i >= 0; i--) {
      ServiceRecord service=services.mServicesByName.valueAt(i);
      if (service.appInfo.uid == uid && service.startRequested) {
        if (mAm.mAppOpsService.noteOperation(AppOpsManager.OP_RUN_IN_BACKGROUND,uid,service.packageName) != AppOpsManager.MODE_ALLOWED) {
          if (stopping == null) {
            stopping=new ArrayList<>();
            stopping.add(service);
          }
        }
      }
    }
    if (stopping != null) {
      for (int i=stopping.size() - 1; i >= 0; i--) {
        ServiceRecord service=stopping.get(i);
        service.delayed=false;
        services.ensureNotStartingBackground(service);
        stopServiceLocked(service);
      }
    }
  }
}
