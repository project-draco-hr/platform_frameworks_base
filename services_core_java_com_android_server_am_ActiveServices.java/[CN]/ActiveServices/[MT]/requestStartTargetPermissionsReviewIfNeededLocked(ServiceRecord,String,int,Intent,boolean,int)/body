{
  if (mAm.getPackageManagerInternalLocked().isPermissionsReviewRequired(r.packageName,r.userId)) {
    if (!callerFg) {
      Slog.w(TAG,"u" + r.userId + " Starting a service in package"+ r.packageName+ " requires a permissions review");
      return false;
    }
    IIntentSender target=mAm.getIntentSenderLocked(ActivityManager.INTENT_SENDER_SERVICE,callingPackage,callingUid,userId,null,null,0,new Intent[]{service},new String[]{service.resolveType(mAm.mContext.getContentResolver())},PendingIntent.FLAG_CANCEL_CURRENT | PendingIntent.FLAG_ONE_SHOT | PendingIntent.FLAG_IMMUTABLE,null);
    final Intent intent=new Intent(Intent.ACTION_REVIEW_PERMISSIONS);
    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS);
    intent.putExtra(Intent.EXTRA_PACKAGE_NAME,r.packageName);
    intent.putExtra(Intent.EXTRA_INTENT,new IntentSender(target));
    if (DEBUG_PERMISSIONS_REVIEW) {
      Slog.i(TAG,"u" + r.userId + " Launching permission review for package "+ r.packageName);
    }
    mAm.mHandler.post(new Runnable(){
      @Override public void run(){
        mAm.mContext.startActivityAsUser(intent,new UserHandle(userId));
      }
    }
);
    return false;
  }
  return true;
}
