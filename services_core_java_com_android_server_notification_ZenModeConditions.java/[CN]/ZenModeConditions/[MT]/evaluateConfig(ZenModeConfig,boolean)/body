{
  if (config == null)   return;
  if (config.manualRule != null && config.manualRule.condition != null && !config.manualRule.isTrueOrUnknown()) {
    if (DEBUG)     Log.d(TAG,"evaluateConfig: clearing manual rule");
    config.manualRule=null;
  }
  final ArraySet<Uri> current=new ArraySet<>();
  evaluateRule(config.manualRule,current,processSubscriptions);
  for (  ZenRule automaticRule : config.automaticRules.values()) {
    evaluateRule(automaticRule,current,processSubscriptions);
    updateSnoozing(automaticRule);
  }
synchronized (mSubscriptions) {
    final int N=mSubscriptions.size();
    for (int i=N - 1; i >= 0; i--) {
      final Uri id=mSubscriptions.keyAt(i);
      final ComponentName component=mSubscriptions.valueAt(i);
      if (processSubscriptions) {
        if (!current.contains(id)) {
          mConditionProviders.unsubscribeIfNecessary(component,id);
          mSubscriptions.removeAt(i);
        }
      }
    }
  }
  mFirstEvaluation=false;
}
