{
  if (DBG)   log("***trySetupData due to " + (reason == null ? "(unspecified)" : reason));
  Log.d(LOG_TAG,"[DSAC DEB] " + "trySetupData with mIsPsRestricted=" + mIsPsRestricted);
  if (phone.getSimulatedRadioControl() != null) {
    setState(State.CONNECTED);
    phone.notifyDataConnection(reason);
    Log.i(LOG_TAG,"(fix?) We're on the simulator; assuming data is connected");
    return true;
  }
  int gprsState=phone.mSST.getCurrentGprsState();
  boolean roaming=phone.getServiceState().getRoaming();
  if ((state == State.IDLE || state == State.SCANNING) && (gprsState == ServiceState.STATE_IN_SERVICE || noAutoAttach) && phone.mSIMRecords.getRecordsLoaded()&& phone.getState() == Phone.State.IDLE && isDataAllowed() && !mIsPsRestricted) {
    if (state == State.IDLE) {
      waitingApns=buildWaitingApns();
      if (waitingApns.isEmpty()) {
        if (DBG)         log("No APN found");
        notifyNoData(PdpConnection.PdpFailCause.BAD_APN);
        return false;
      }
 else {
        log("Create from allApns : " + apnListToString(allApns));
      }
    }
    if (DBG) {
      log("Setup watingApns : " + apnListToString(waitingApns));
    }
    return setupData(reason);
  }
 else {
    if (DBG)     log("trySetupData: Not ready for data: " + " dataState=" + state + " gprsState="+ gprsState+ " sim="+ phone.mSIMRecords.getRecordsLoaded()+ " UMTS="+ phone.mSST.isConcurrentVoiceAndData()+ " phoneState="+ phone.getState()+ " dataEnabled="+ getAnyDataEnabled()+ " roaming="+ roaming+ " dataOnRoamingEnable="+ getDataOnRoamingEnabled()+ " ps restricted="+ mIsPsRestricted);
    return false;
  }
}
