{
  final boolean canShowTask=showForAllUsers || mService.isCurrentProfileLocked(task.mUserId);
  mTasks.remove(task);
  int stackSize=mTasks.size();
  int minPosition=0;
  int maxPosition=stackSize;
  if (canShowTask) {
    minPosition=computeMinPosition(minPosition,stackSize);
  }
 else {
    maxPosition=computeMaxPosition(maxPosition);
  }
  position=Math.min(Math.max(position,minPosition),maxPosition);
  if (DEBUG_TASK_MOVEMENT)   Slog.d(TAG_WM,"positionTask: task=" + task + " position="+ position);
  mTasks.add(position,task);
  task.mStack=this;
  task.updateDisplayInfo(mDisplayContent);
  boolean toTop=position == mTasks.size() - 1;
  if (toTop) {
    mDisplayContent.moveStack(this,true);
  }
  EventLog.writeEvent(EventLogTags.WM_TASK_MOVED,task.mTaskId,toTop ? 1 : 0,position);
}
