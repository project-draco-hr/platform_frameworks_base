{
  EventLog.writeEvent(EventLogTags.WM_STACK_REMOVED,mStackId);
  boolean doAnotherLayoutPass=false;
  for (int taskNdx=mTasks.size() - 1; taskNdx >= 0; --taskNdx) {
    final AppTokenList appWindowTokens=mTasks.get(taskNdx).mAppTokens;
    for (int appNdx=appWindowTokens.size() - 1; appNdx >= 0; --appNdx) {
      final WindowList appWindows=appWindowTokens.get(appNdx).allAppWindows;
      for (int winNdx=appWindows.size() - 1; winNdx >= 0; --winNdx) {
        mService.removeWindowInnerLocked(null,appWindows.get(winNdx));
        doAnotherLayoutPass=true;
      }
    }
  }
  if (doAnotherLayoutPass) {
    mService.requestTraversalLocked();
  }
  mAnimationBackgroundSurface.destroySurface();
  mAnimationBackgroundSurface=null;
  mDimLayer.destroySurface();
  mDimLayer=null;
  mDisplayContent=null;
}
