{
  int stackNdx;
  if (!toTop) {
    stackNdx=0;
  }
 else {
    stackNdx=mTasks.size();
    if (!showWhenLocked && !mService.isCurrentProfileLocked(task.mUserId)) {
      while (--stackNdx >= 0) {
        final Task tmpTask=mTasks.get(stackNdx);
        if (!tmpTask.showWhenLocked() || !mService.isCurrentProfileLocked(tmpTask.mUserId)) {
          break;
        }
      }
      ++stackNdx;
    }
  }
  if (DEBUG_TASK_MOVEMENT)   Slog.d(TAG,"addTask: task=" + task + " toTop="+ toTop+ " pos="+ stackNdx);
  mTasks.add(stackNdx,task);
  task.mStack=this;
  if (toTop) {
    mDisplayContent.moveStack(this,true);
  }
  EventLog.writeEvent(EventLogTags.WM_TASK_MOVED,task.mTaskId,toTop ? 1 : 0,stackNdx);
}
