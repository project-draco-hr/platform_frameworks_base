{
  if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.DUMP) != PackageManager.PERMISSION_GRANTED) {
    pw.println("Permission Denial: can't dump Battery service from from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid());
    return;
  }
synchronized (mLock) {
    if (args == null || args.length == 0 || "-a".equals(args[0])) {
      pw.println("Current Battery Service state:");
      if (mUpdatesStopped) {
        pw.println("  (UPDATES STOPPED -- use 'reset' to restart)");
      }
      pw.println("  AC powered: " + mBatteryProps.chargerAcOnline);
      pw.println("  USB powered: " + mBatteryProps.chargerUsbOnline);
      pw.println("  Wireless powered: " + mBatteryProps.chargerWirelessOnline);
      pw.println("  status: " + mBatteryProps.batteryStatus);
      pw.println("  health: " + mBatteryProps.batteryHealth);
      pw.println("  present: " + mBatteryProps.batteryPresent);
      pw.println("  level: " + mBatteryProps.batteryLevel);
      pw.println("  scale: " + BATTERY_SCALE);
      pw.println("  voltage: " + mBatteryProps.batteryVoltage);
      pw.println("  temperature: " + mBatteryProps.batteryTemperature);
      pw.println("  technology: " + mBatteryProps.batteryTechnology);
    }
 else     if (args.length == 3 && "set".equals(args[0])) {
      String key=args[1];
      String value=args[2];
      try {
        if (!mUpdatesStopped) {
          mLastBatteryProps.set(mBatteryProps);
        }
        boolean update=true;
        if ("ac".equals(key)) {
          mBatteryProps.chargerAcOnline=Integer.parseInt(value) != 0;
        }
 else         if ("usb".equals(key)) {
          mBatteryProps.chargerUsbOnline=Integer.parseInt(value) != 0;
        }
 else         if ("wireless".equals(key)) {
          mBatteryProps.chargerWirelessOnline=Integer.parseInt(value) != 0;
        }
 else         if ("status".equals(key)) {
          mBatteryProps.batteryStatus=Integer.parseInt(value);
        }
 else         if ("level".equals(key)) {
          mBatteryProps.batteryLevel=Integer.parseInt(value);
        }
 else         if ("invalid".equals(key)) {
          mInvalidCharger=Integer.parseInt(value);
        }
 else {
          pw.println("Unknown set option: " + key);
          update=false;
        }
        if (update) {
          long ident=Binder.clearCallingIdentity();
          try {
            mUpdatesStopped=true;
            processValuesLocked();
          }
  finally {
            Binder.restoreCallingIdentity(ident);
          }
        }
      }
 catch (      NumberFormatException ex) {
        pw.println("Bad value: " + value);
      }
    }
 else     if (args.length == 1 && "reset".equals(args[0])) {
      long ident=Binder.clearCallingIdentity();
      try {
        if (mUpdatesStopped) {
          mBatteryProps.set(mLastBatteryProps);
          processValuesLocked();
        }
      }
  finally {
        Binder.restoreCallingIdentity(ident);
      }
    }
 else {
      pw.println("Dump current battery state, or:");
      pw.println("  set [ac|usb|wireless|status|level|invalid] <value>");
      pw.println("  reset");
    }
  }
}
