{
  for (; ; ) {
    final int state;
    final boolean stateChanged;
    final int backlight;
    final boolean backlightChanged;
synchronized (mLock) {
      state=mPendingState;
      stateChanged=(state != mActualState);
      backlight=mPendingBacklight;
      backlightChanged=(backlight != mActualBacklight);
      if (!stateChanged && !backlightChanged) {
        mChangeInProgress=false;
        postScreenUpdateThreadSafe();
        try {
          mLock.wait();
        }
 catch (        InterruptedException ex) {
        }
        continue;
      }
      mActualState=state;
      mActualBacklight=backlight;
    }
    if (DEBUG) {
      Slog.d(TAG,"Updating screen state: state=" + Display.stateToString(state) + ", backlight="+ backlight);
    }
    boolean suspending=Display.isSuspendedState(state);
    if (stateChanged && !suspending) {
      requestDisplayState(state);
    }
    if (backlightChanged) {
      setBrightness(backlight);
    }
    if (stateChanged && suspending) {
      requestDisplayState(state);
    }
  }
}
