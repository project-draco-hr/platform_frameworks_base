{
  Credential credential=homeSP.getCredential();
  Log.d(TAG,"Credential method " + credential.getEAPMethod().getEAPMethodID());
switch (credential.getEAPMethod().getEAPMethodID()) {
case EAP_TTLS:
    String user;
  byte[] password;
UpdateInfo subscriptionUpdate;
if (flowType == OSUManager.FLOW_POLICY) {
subscriptionUpdate=homeSP.getPolicy() != null ? homeSP.getPolicy().getPolicyUpdate() : null;
}
 else {
subscriptionUpdate=homeSP.getSubscriptionUpdate();
}
if (subscriptionUpdate != null && subscriptionUpdate.getUsername() != null) {
user=subscriptionUpdate.getUsername();
password=subscriptionUpdate.getPassword() != null ? subscriptionUpdate.getPassword().getBytes(StandardCharsets.UTF_8) : new byte[0];
}
 else {
user=credential.getUserName();
password=credential.getPassword().getBytes(StandardCharsets.UTF_8);
}
return new HTTPHandler(StandardCharsets.UTF_8,OSUSocketFactory.getSocketFactory(mKeyStore,homeSP,flowType,network,mURL,km,true),user,password);
case EAP_TLS:
return new HTTPHandler(StandardCharsets.UTF_8,OSUSocketFactory.getSocketFactory(mKeyStore,homeSP,flowType,network,mURL,km,true));
default :
throw new IOException("Cannot remediate account with " + credential.getEAPMethod().getEAPMethodID());
}
}
