{
  checkByteOrderLittleEndian(apkContents);
  if (centralDirOffset < APK_SIG_BLOCK_MIN_SIZE) {
    throw new SignatureNotFoundException("APK too small for APK Signing Block. ZIP Central Directory offset: " + centralDirOffset);
  }
  if ((apkContents.getLong(centralDirOffset - 16) != APK_SIG_BLOCK_MAGIC_LO) || (apkContents.getLong(centralDirOffset - 8) != APK_SIG_BLOCK_MAGIC_HI)) {
    throw new SignatureNotFoundException("No APK Signing Block before ZIP Central Directory");
  }
  long apkSigBlockSizeLong=apkContents.getLong(centralDirOffset - 24);
  if ((apkSigBlockSizeLong < 24) || (apkSigBlockSizeLong > Integer.MAX_VALUE - 8)) {
    throw new SignatureNotFoundException("APK Signing Block size out of range: " + apkSigBlockSizeLong);
  }
  int apkSigBlockSizeFromFooter=(int)apkSigBlockSizeLong;
  int totalSize=apkSigBlockSizeFromFooter + 8;
  int apkSigBlockOffset=centralDirOffset - totalSize;
  if (apkSigBlockOffset < 0) {
    throw new SignatureNotFoundException("APK Signing Block offset out of range: " + apkSigBlockOffset);
  }
  long apkSigBlockSizeFromHeader=apkContents.getLong(apkSigBlockOffset);
  if (apkSigBlockSizeFromHeader != apkSigBlockSizeFromFooter) {
    throw new SignatureNotFoundException("APK Signing Block sizes in header and footer do not match: " + apkSigBlockSizeFromHeader + " vs "+ apkSigBlockSizeFromFooter);
  }
  return apkSigBlockOffset;
}
