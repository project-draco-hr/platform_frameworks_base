{
  if (!TextUtils.isEmpty(mCopiesEditText.getText())) {
    mSummaryCopies.setText(mCopiesEditText.getText());
  }
  final int selectedMediaIndex=mMediaSizeSpinner.getSelectedItemPosition();
  if (selectedMediaIndex >= 0) {
    SpinnerItem<MediaSize> mediaItem=mMediaSizeSpinnerAdapter.getItem(selectedMediaIndex);
    mSummaryPaperSize.setText(mediaItem.label);
  }
  if (mState == STATE_PRINT_CONFIRMED || mState == STATE_PRINT_CANCELED || mState == STATE_UPDATE_FAILED || mState == STATE_CREATE_FILE_FAILED || mState == STATE_PRINTER_UNAVAILABLE) {
    if (mState != STATE_PRINTER_UNAVAILABLE) {
      mDestinationSpinner.setEnabled(false);
    }
    mCopiesEditText.setEnabled(false);
    mMediaSizeSpinner.setEnabled(false);
    mColorModeSpinner.setEnabled(false);
    mOrientationSpinner.setEnabled(false);
    mRangeOptionsSpinner.setEnabled(false);
    mPageRangeEditText.setEnabled(false);
    mPrintButton.setEnabled(false);
    mMoreOptionsButton.setEnabled(false);
    return;
  }
  PrinterInfo currentPrinter=getCurrentPrinter();
  if (currentPrinter == null || !canPrint(currentPrinter)) {
    mCopiesEditText.setEnabled(false);
    mMediaSizeSpinner.setEnabled(false);
    mColorModeSpinner.setEnabled(false);
    mOrientationSpinner.setEnabled(false);
    mRangeOptionsSpinner.setEnabled(false);
    mPageRangeEditText.setEnabled(false);
    mPrintButton.setEnabled(false);
    mMoreOptionsButton.setEnabled(false);
    return;
  }
  PrinterCapabilitiesInfo capabilities=currentPrinter.getCapabilities();
  PrintAttributes defaultAttributes=capabilities.getDefaults();
  mMediaSizeSpinner.setEnabled(true);
  List<MediaSize> mediaSizes=new ArrayList<>(capabilities.getMediaSizes());
  Collections.sort(mediaSizes,mMediaSizeComparator);
  PrintAttributes attributes=mPrintJob.getAttributes();
  boolean mediaSizesChanged=false;
  final int mediaSizeCount=mediaSizes.size();
  if (mediaSizeCount != mMediaSizeSpinnerAdapter.getCount()) {
    mediaSizesChanged=true;
  }
 else {
    for (int i=0; i < mediaSizeCount; i++) {
      if (!mediaSizes.get(i).equals(mMediaSizeSpinnerAdapter.getItem(i).value)) {
        mediaSizesChanged=true;
        break;
      }
    }
  }
  if (mediaSizesChanged) {
    int oldMediaSizeNewIndex=AdapterView.INVALID_POSITION;
    MediaSize oldMediaSize=attributes.getMediaSize();
    mMediaSizeSpinnerAdapter.clear();
    for (int i=0; i < mediaSizeCount; i++) {
      MediaSize mediaSize=mediaSizes.get(i);
      if (oldMediaSize != null && mediaSize.asPortrait().equals(oldMediaSize.asPortrait())) {
        oldMediaSizeNewIndex=i;
      }
      mMediaSizeSpinnerAdapter.add(new SpinnerItem<>(mediaSize,mediaSize.getLabel(getPackageManager())));
    }
    if (oldMediaSizeNewIndex != AdapterView.INVALID_POSITION) {
      if (mMediaSizeSpinner.getSelectedItemPosition() != oldMediaSizeNewIndex) {
        mMediaSizeSpinner.setSelection(oldMediaSizeNewIndex);
      }
    }
 else {
      final int mediaSizeIndex=Math.max(mediaSizes.indexOf(defaultAttributes.getMediaSize()),0);
      if (mMediaSizeSpinner.getSelectedItemPosition() != mediaSizeIndex) {
        mMediaSizeSpinner.setSelection(mediaSizeIndex);
      }
      if (oldMediaSize != null) {
        if (oldMediaSize.isPortrait()) {
          attributes.setMediaSize(mMediaSizeSpinnerAdapter.getItem(mediaSizeIndex).value.asPortrait());
        }
 else {
          attributes.setMediaSize(mMediaSizeSpinnerAdapter.getItem(mediaSizeIndex).value.asLandscape());
        }
      }
    }
  }
  mColorModeSpinner.setEnabled(true);
  final int colorModes=capabilities.getColorModes();
  boolean colorModesChanged=false;
  if (Integer.bitCount(colorModes) != mColorModeSpinnerAdapter.getCount()) {
    colorModesChanged=true;
  }
 else {
    int remainingColorModes=colorModes;
    int adapterIndex=0;
    while (remainingColorModes != 0) {
      final int colorBitOffset=Integer.numberOfTrailingZeros(remainingColorModes);
      final int colorMode=1 << colorBitOffset;
      remainingColorModes&=~colorMode;
      if (colorMode != mColorModeSpinnerAdapter.getItem(adapterIndex).value) {
        colorModesChanged=true;
        break;
      }
      adapterIndex++;
    }
  }
  if (colorModesChanged) {
    int oldColorModeNewIndex=AdapterView.INVALID_POSITION;
    final int oldColorMode=attributes.getColorMode();
    mColorModeSpinnerAdapter.clear();
    String[] colorModeLabels=getResources().getStringArray(R.array.color_mode_labels);
    int remainingColorModes=colorModes;
    while (remainingColorModes != 0) {
      final int colorBitOffset=Integer.numberOfTrailingZeros(remainingColorModes);
      final int colorMode=1 << colorBitOffset;
      if (colorMode == oldColorMode) {
        oldColorModeNewIndex=colorBitOffset;
      }
      remainingColorModes&=~colorMode;
      mColorModeSpinnerAdapter.add(new SpinnerItem<>(colorMode,colorModeLabels[colorBitOffset]));
    }
    if (oldColorModeNewIndex != AdapterView.INVALID_POSITION) {
      if (mColorModeSpinner.getSelectedItemPosition() != oldColorModeNewIndex) {
        mColorModeSpinner.setSelection(oldColorModeNewIndex);
      }
    }
 else {
      final int selectedColorMode=colorModes & defaultAttributes.getColorMode();
      final int itemCount=mColorModeSpinnerAdapter.getCount();
      for (int i=0; i < itemCount; i++) {
        SpinnerItem<Integer> item=mColorModeSpinnerAdapter.getItem(i);
        if (selectedColorMode == item.value) {
          if (mColorModeSpinner.getSelectedItemPosition() != i) {
            mColorModeSpinner.setSelection(i);
          }
          attributes.setColorMode(selectedColorMode);
        }
      }
    }
  }
  mOrientationSpinner.setEnabled(true);
  MediaSize mediaSize=attributes.getMediaSize();
  if (mediaSize != null) {
    if (mediaSize.isPortrait() && mOrientationSpinner.getSelectedItemPosition() != 0) {
      mOrientationSpinner.setSelection(0);
    }
 else     if (!mediaSize.isPortrait() && mOrientationSpinner.getSelectedItemPosition() != 1) {
      mOrientationSpinner.setSelection(1);
    }
  }
  PrintDocumentInfo info=mPrintedDocument.getDocumentInfo().info;
  if (info != null && info.getPageCount() > 0) {
    if (info.getPageCount() == 1) {
      mRangeOptionsSpinner.setEnabled(false);
    }
 else {
      mRangeOptionsSpinner.setEnabled(true);
      if (mRangeOptionsSpinner.getSelectedItemPosition() > 0) {
        if (!mPageRangeEditText.isEnabled()) {
          mPageRangeEditText.setEnabled(true);
          mPageRangeEditText.setVisibility(View.VISIBLE);
          mPageRangeTitle.setVisibility(View.VISIBLE);
          mPageRangeEditText.requestFocus();
          InputMethodManager imm=(InputMethodManager)getSystemService(Context.INPUT_METHOD_SERVICE);
          imm.showSoftInput(mPageRangeEditText,0);
        }
      }
 else {
        mPageRangeEditText.setEnabled(false);
        mPageRangeEditText.setVisibility(View.INVISIBLE);
        mPageRangeTitle.setVisibility(View.INVISIBLE);
      }
    }
    String title=(info.getPageCount() != PrintDocumentInfo.PAGE_COUNT_UNKNOWN) ? getString(R.string.label_pages,String.valueOf(info.getPageCount())) : getString(R.string.page_count_unknown);
    mPageRangeOptionsTitle.setText(title);
  }
 else {
    if (mRangeOptionsSpinner.getSelectedItemPosition() != 0) {
      mRangeOptionsSpinner.setSelection(0);
    }
    mRangeOptionsSpinner.setEnabled(false);
    mPageRangeOptionsTitle.setText(getString(R.string.page_count_unknown));
    mPageRangeEditText.setEnabled(false);
    mPageRangeEditText.setVisibility(View.INVISIBLE);
    mPageRangeTitle.setVisibility(View.INVISIBLE);
  }
  ComponentName serviceName=currentPrinter.getId().getServiceName();
  if (!TextUtils.isEmpty(PrintOptionUtils.getAdvancedOptionsActivityName(this,serviceName))) {
    mAdvancedPrintOptionsContainer.setVisibility(View.VISIBLE);
    mMoreOptionsButton.setEnabled(true);
  }
 else {
    mAdvancedPrintOptionsContainer.setVisibility(View.GONE);
    mMoreOptionsButton.setEnabled(false);
  }
  if (mDestinationSpinnerAdapter.getPdfPrinter() != currentPrinter) {
    mPrintButton.setImageResource(com.android.internal.R.drawable.ic_print);
  }
 else {
    mPrintButton.setImageResource(com.android.internal.R.drawable.ic_menu_save);
  }
  if ((mRangeOptionsSpinner.getSelectedItemPosition() == 1 && (TextUtils.isEmpty(mPageRangeEditText.getText()) || hasErrors())) || (mRangeOptionsSpinner.getSelectedItemPosition() == 0 && (mPrintedDocument.getDocumentInfo() == null || hasErrors()))) {
    mPrintButton.setEnabled(false);
  }
 else {
    mPrintButton.setEnabled(true);
  }
  if (mDestinationSpinnerAdapter.getPdfPrinter() != currentPrinter) {
    mCopiesEditText.setEnabled(true);
  }
 else {
    mCopiesEditText.setEnabled(false);
  }
  if (mCopiesEditText.getError() == null && TextUtils.isEmpty(mCopiesEditText.getText())) {
    mCopiesEditText.setText(String.valueOf(MIN_COPIES));
    mCopiesEditText.requestFocus();
  }
}
