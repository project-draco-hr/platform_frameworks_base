{
  if (DEBUG) {
    Log.i(LOG_TAG,"onUpdateCompleted()");
  }
  setState(mProgressMessageController.cancel());
  ensurePreviewUiShown();
  PrintDocumentInfo info=document.info;
  if (info != null) {
    final int pageCount=PageRangeUtils.getNormalizedPageCount(document.writtenPages,getAdjustedPageCount(info));
    PrintDocumentInfo adjustedInfo=new PrintDocumentInfo.Builder(info.getName()).setContentType(info.getContentType()).setPageCount(pageCount).build();
    mPrintJob.setDocumentInfo(adjustedInfo);
    mPrintJob.setPages(document.printedPages);
  }
switch (mState) {
case STATE_PRINT_CONFIRMED:
{
      requestCreatePdfFileOrFinish();
    }
  break;
case STATE_CREATE_FILE_FAILED:
case STATE_PRINT_COMPLETED:
case STATE_PRINT_CANCELED:
{
  updateOptionsUi();
  doFinish();
}
break;
default :
{
updatePrintPreviewController(document.changed);
setState(STATE_CONFIGURING);
updateOptionsUi();
}
break;
}
}
