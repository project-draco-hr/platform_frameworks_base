{
  setState(STATE_PRINT_CONFIRMED);
  updateOptionsUi();
  addCurrentPrinterToHistory();
  PageRange[] selectedPages=computeSelectedPages();
  if (!Arrays.equals(mSelectedPages,selectedPages)) {
    mSelectedPages=selectedPages;
    updatePrintPreviewController(false);
  }
  updateSelectedPagesFromPreview();
  mPrintPreviewController.closeOptions();
  if (canUpdateDocument()) {
    updateDocument(false);
  }
  if (!mPrintedDocument.isUpdating()) {
    requestCreatePdfFileOrFinish();
  }
}
