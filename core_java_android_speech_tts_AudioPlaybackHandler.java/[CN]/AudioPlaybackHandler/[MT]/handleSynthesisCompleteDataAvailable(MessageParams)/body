{
  final SynthesisMessageParams params=(SynthesisMessageParams)msg;
  if (DBG)   Log.d(TAG,"completeAudioAvailable(" + params + ")");
  int channelConfig=AudioPlaybackHandler.getChannelConfig(params.mChannelCount);
  int bytesPerFrame=AudioPlaybackHandler.getBytesPerFrame(params.mAudioFormat);
  SynthesisMessageParams.ListEntry entry=params.getNextBuffer();
  if (entry == null) {
    Log.w(TAG,"completeDataAvailable : No buffers available to play.");
    return;
  }
  final AudioTrack audioTrack=new AudioTrack(params.mStreamType,params.mSampleRateInHz,channelConfig,params.mAudioFormat,entry.mLength,AudioTrack.MODE_STATIC);
  params.mAudioTrack=audioTrack;
  try {
    audioTrack.write(entry.mBytes,entry.mOffset,entry.mLength);
    setupVolume(audioTrack,params.mVolume,params.mPan);
    audioTrack.play();
    blockUntilDone(audioTrack,bytesPerFrame,entry.mLength);
    if (DBG)     Log.d(TAG,"Wrote data to audio track successfully : " + entry.mLength);
  }
 catch (  IllegalStateException ex) {
    Log.e(TAG,"Playback error",ex);
  }
 finally {
    handleSynthesisDone(msg);
  }
}
