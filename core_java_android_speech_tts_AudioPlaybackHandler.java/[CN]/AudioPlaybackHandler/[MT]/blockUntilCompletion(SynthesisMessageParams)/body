{
  final AudioTrack audioTrack=params.mAudioTrack;
  final int lengthInFrames=params.mBytesWritten / params.mBytesPerFrame;
  int currentPosition=0;
  while ((currentPosition=audioTrack.getPlaybackHeadPosition()) < lengthInFrames) {
    if (audioTrack.getPlayState() != AudioTrack.PLAYSTATE_PLAYING) {
      break;
    }
    final long estimatedTimeMs=((lengthInFrames - currentPosition) * 1000) / audioTrack.getSampleRate();
    final long sleepTimeMs=Math.max(estimatedTimeMs,MIN_SLEEP_TIME_MS);
    if (DBG)     Log.d(TAG,"About to sleep for : " + sleepTimeMs + " ms,"+ " Playback position : "+ currentPosition+ ", Length in frames : "+ lengthInFrames);
    try {
      Thread.sleep(sleepTimeMs);
    }
 catch (    InterruptedException ie) {
      break;
    }
  }
}
