{
  super.onCreate(savedInstanceState);
  if (Log.isLoggable(TAG,Log.VERBOSE)) {
    Log.v(TAG,"ChooseTypeAndAccountActivity.onCreate(savedInstanceState=" + savedInstanceState + ")");
  }
  setContentView(R.layout.choose_type_and_account);
  if (savedInstanceState != null) {
    mPendingRequest=savedInstanceState.getInt(KEY_INSTANCE_STATE_PENDING_REQUEST);
    mSavedAccounts=savedInstanceState.getParcelableArray(KEY_INSTANCE_STATE_EXISTING_ACCOUNTS);
    mExistingAccounts=null;
  }
 else {
    mPendingRequest=REQUEST_NULL;
    mSavedAccounts=null;
    mExistingAccounts=null;
  }
  final AccountManager accountManager=AccountManager.get(this);
  final Intent intent=getIntent();
  final String descriptionOverride=intent.getStringExtra(EXTRA_DESCRIPTION_TEXT_OVERRIDE);
  if (!TextUtils.isEmpty(descriptionOverride)) {
    ((TextView)findViewById(R.id.description)).setText(descriptionOverride);
  }
  final Account selectedAccount=(Account)intent.getParcelableExtra(EXTRA_SELECTED_ACCOUNT);
  final HashMap<String,AuthenticatorDescription> typeToAuthDescription=new HashMap<String,AuthenticatorDescription>();
  for (  AuthenticatorDescription desc : accountManager.getAuthenticatorTypes()) {
    typeToAuthDescription.put(desc.type,desc);
  }
  Set<Account> setOfAllowableAccounts=null;
  final ArrayList<Parcelable> validAccounts=intent.getParcelableArrayListExtra(EXTRA_ALLOWABLE_ACCOUNTS_ARRAYLIST);
  if (validAccounts != null) {
    setOfAllowableAccounts=new HashSet<Account>(validAccounts.size());
    for (    Parcelable parcelable : validAccounts) {
      setOfAllowableAccounts.add((Account)parcelable);
    }
  }
  Set<String> setOfAllowableAccountTypes=null;
  final String[] validAccountTypes=intent.getStringArrayExtra(EXTRA_ALLOWABLE_ACCOUNT_TYPES_STRING_ARRAY);
  if (validAccountTypes != null) {
    setOfAllowableAccountTypes=new HashSet<String>(validAccountTypes.length);
    for (    String type : validAccountTypes) {
      setOfAllowableAccountTypes.add(type);
    }
  }
  final Account[] accounts=accountManager.getAccounts();
  mAccountInfos=new ArrayList<AccountInfo>(accounts.length);
  for (  Account account : accounts) {
    if (setOfAllowableAccounts != null && !setOfAllowableAccounts.contains(account)) {
      continue;
    }
    if (setOfAllowableAccountTypes != null && !setOfAllowableAccountTypes.contains(account.type)) {
      continue;
    }
    mAccountInfos.add(new AccountInfo(account,getDrawableForType(typeToAuthDescription,account.type),account.equals(selectedAccount)));
  }
  ListView list=(ListView)findViewById(android.R.id.list);
  list.setAdapter(new AccountArrayAdapter(this,android.R.layout.simple_list_item_1,mAccountInfos));
  list.setChoiceMode(ListView.CHOICE_MODE_SINGLE);
  list.setOnItemClickListener(new AdapterView.OnItemClickListener(){
    public void onItemClick(    AdapterView<?> parent,    View v,    int position,    long id){
      onListItemClick((ListView)parent,v,position,id);
    }
  }
);
  Button addAccountButton=(Button)findViewById(R.id.addAccount);
  addAccountButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    final View v){
      startChooseAccountTypeActivity();
    }
  }
);
  if (mPendingRequest == REQUEST_NULL) {
    if (mAccountInfos.isEmpty()) {
      startChooseAccountTypeActivity();
      return;
    }
    if (!intent.getBooleanExtra(EXTRA_ALWAYS_PROMPT_FOR_ACCOUNT,false) && mAccountInfos.size() == 1) {
      Account account=mAccountInfos.get(0).account;
      setResultAndFinish(account.name,account.type);
      return;
    }
  }
}
