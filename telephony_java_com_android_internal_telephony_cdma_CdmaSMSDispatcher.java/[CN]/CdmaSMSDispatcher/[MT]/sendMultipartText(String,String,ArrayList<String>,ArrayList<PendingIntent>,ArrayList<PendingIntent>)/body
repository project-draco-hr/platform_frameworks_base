{
  int refNumber=getNextConcatenatedRef() & 0x00FF;
  for (int i=0, msgCount=parts.size(); i < msgCount; i++) {
    SmsHeader.ConcatRef concatRef=new SmsHeader.ConcatRef();
    concatRef.refNumber=refNumber;
    concatRef.seqNumber=i + 1;
    concatRef.msgCount=msgCount;
    concatRef.isEightBits=true;
    SmsHeader smsHeader=new SmsHeader();
    smsHeader.concatRef=concatRef;
    PendingIntent sentIntent=null;
    if (sentIntents != null && sentIntents.size() > i) {
      sentIntent=sentIntents.get(i);
    }
    PendingIntent deliveryIntent=null;
    if (deliveryIntents != null && deliveryIntents.size() > i) {
      deliveryIntent=deliveryIntents.get(i);
    }
    UserData uData=new UserData();
    uData.payloadStr=parts.get(i);
    uData.userDataHeader=smsHeader;
    SmsMessage.SubmitPdu submitPdu=SmsMessage.getSubmitPdu(destAddr,uData,(deliveryIntent != null) && (i == (msgCount - 1)));
    sendSubmitPdu(submitPdu,sentIntent,deliveryIntent);
  }
}
