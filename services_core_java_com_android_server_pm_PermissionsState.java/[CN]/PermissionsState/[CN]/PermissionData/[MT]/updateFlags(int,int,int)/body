{
  if (isInstallPermission()) {
    userId=UserHandle.USER_ALL;
  }
  if (!isCompatibleUserId(userId)) {
    return false;
  }
  final int newFlags=flagValues & flagMask;
  PermissionState userState=mUserStates.get(userId);
  if (userState != null) {
    final int oldFlags=userState.mFlags;
    userState.mFlags=(userState.mFlags & ~flagMask) | newFlags;
    if (userState.isDefault()) {
      mUserStates.remove(userId);
    }
    return userState.mFlags != oldFlags;
  }
 else   if (newFlags != 0) {
    userState=new PermissionState(mPerm.name);
    userState.mFlags=newFlags;
    mUserStates.put(userId,userState);
    return true;
  }
  return false;
}
