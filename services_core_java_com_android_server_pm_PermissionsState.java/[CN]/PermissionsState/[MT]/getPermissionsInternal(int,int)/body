{
  enforceValidUserId(userId);
  if (mPermissions == null) {
    return Collections.emptySet();
  }
  if (userId == UserHandle.USER_ALL) {
    flags=FLAG_INSTALL_PERMISSIONS;
  }
  Set<String> permissions=new ArraySet<>();
  final int permissionCount=mPermissions.size();
  for (int i=0; i < permissionCount; i++) {
    String permission=mPermissions.keyAt(i);
    if ((flags & FLAG_INSTALL_PERMISSIONS) != 0) {
      if (hasInstallPermission(permission)) {
        permissions.add(permission);
      }
    }
    if ((flags & FLAG_RUNTIME_PERMISSIONS) != 0) {
      if (hasRuntimePermission(permission,userId)) {
        permissions.add(permission);
      }
    }
  }
  return permissions;
}
