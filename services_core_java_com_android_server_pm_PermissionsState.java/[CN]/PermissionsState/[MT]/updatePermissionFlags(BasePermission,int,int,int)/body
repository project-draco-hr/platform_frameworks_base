{
  enforceValidUserId(userId);
  final boolean mayChangeFlags=flagValues != 0 || flagMask != 0;
  if (mPermissions == null) {
    if (!mayChangeFlags) {
      return false;
    }
    ensurePermissionData(permission);
  }
  PermissionData permissionData=mPermissions.get(permission.name);
  if (permissionData == null) {
    if (!mayChangeFlags) {
      return false;
    }
    permissionData=ensurePermissionData(permission);
  }
  return permissionData.updateFlags(userId,flagMask,flagValues);
}
