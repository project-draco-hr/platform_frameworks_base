{
  mAnimationPosition=position;
  mAnimatedVelocity=velocity;
  if (mExpanded) {
    if (always || (velocity > MAXIMUM_MAJOR_VELOCITY || (position > mTopOffset + (mVertical ? mHandleHeight : mHandleWidth) && velocity > -MAXIMUM_MAJOR_VELOCITY))) {
      mAnimatedAcceleration=MAXIMUM_ACCELERATION;
      if (velocity < 0) {
        mAnimatedVelocity=0;
      }
    }
 else {
      mAnimatedAcceleration=-MAXIMUM_ACCELERATION;
      if (velocity > 0) {
        mAnimatedVelocity=0;
      }
    }
  }
 else {
    if (!always && (velocity > MAXIMUM_MAJOR_VELOCITY || (position > (mVertical ? getHeight() : getWidth()) / 2 && velocity > -MAXIMUM_MAJOR_VELOCITY))) {
      mAnimatedAcceleration=MAXIMUM_ACCELERATION;
      if (velocity < 0) {
        mAnimatedVelocity=0;
      }
    }
 else {
      mAnimatedAcceleration=-MAXIMUM_ACCELERATION;
      if (velocity > 0) {
        mAnimatedVelocity=0;
      }
    }
  }
  long now=SystemClock.uptimeMillis();
  mAnimationLastTime=now;
  mCurrentAnimationTime=now + ANIMATION_FRAME_DURATION;
  mAnimating=true;
  mHandler.removeMessages(MSG_ANIMATE);
  mHandler.sendMessageAtTime(mHandler.obtainMessage(MSG_ANIMATE),mCurrentAnimationTime);
  stopTracking();
}
