{
  if (mName.length() > 4 && "res:".equals(mName.substring(0,4))) {
    String resName=mName.substring(4);
    String pkg=null;
    int colon=resName.indexOf(':');
    if (colon > 0) {
      pkg=resName.substring(0,colon);
    }
    String ident=null;
    int slash=resName.lastIndexOf('/');
    if (slash > 0) {
      ident=resName.substring(slash + 1);
    }
    String type=null;
    if (colon > 0 && slash > 0 && (slash - colon) > 1) {
      type=resName.substring(colon + 1,slash);
    }
    if (pkg != null && ident != null && type != null) {
      int resId=-1;
      InputStream res=null;
      FileOutputStream fos=null;
      try {
        Context c=mContext.createPackageContext(pkg,Context.CONTEXT_RESTRICTED);
        Resources r=c.getResources();
        resId=r.getIdentifier(resName,null,null);
        if (resId == 0) {
          Log.e(TAG,"couldn't resolve identifier pkg=" + pkg + " type="+ type+ " ident="+ ident);
          return false;
        }
        res=r.openRawResource(resId);
        fos=new FileOutputStream(WALLPAPER_FILE);
        byte[] buffer=new byte[32768];
        int amt;
        while ((amt=res.read(buffer)) > 0) {
          fos.write(buffer,0,amt);
        }
        Log.d(TAG,"Restored wallpaper: " + resName);
        return true;
      }
 catch (      NameNotFoundException e) {
        Log.e(TAG,"Package name " + pkg + " not found");
      }
catch (      Resources.NotFoundException e) {
        Log.e(TAG,"Resource not found: " + resId);
      }
catch (      IOException e) {
        Log.e(TAG,"IOException while restoring wallpaper ",e);
      }
 finally {
        if (res != null) {
          try {
            res.close();
          }
 catch (          IOException ex) {
          }
        }
        if (fos != null) {
          try {
            fos.close();
          }
 catch (          IOException ex) {
          }
        }
      }
    }
  }
  return false;
}
