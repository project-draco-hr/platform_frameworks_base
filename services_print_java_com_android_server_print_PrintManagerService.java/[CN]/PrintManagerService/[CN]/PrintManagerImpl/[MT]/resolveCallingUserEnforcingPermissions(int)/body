{
  final int callingUid=Binder.getCallingUid();
  if (callingUid == 0 || callingUid == Process.SYSTEM_UID || callingUid == Process.SHELL_UID) {
    return userId;
  }
  final int callingUserId=UserHandle.getUserId(callingUid);
  if (callingUserId == userId) {
    return userId;
  }
  if (mContext.checkCallingPermission(Manifest.permission.INTERACT_ACROSS_USERS_FULL) != PackageManager.PERMISSION_GRANTED && mContext.checkCallingPermission(Manifest.permission.INTERACT_ACROSS_USERS) != PackageManager.PERMISSION_GRANTED) {
    if (userId == UserHandle.USER_CURRENT_OR_SELF) {
      return callingUserId;
    }
    throw new SecurityException("Call from user " + callingUserId + " as user "+ userId+ " without permission INTERACT_ACROSS_USERS or "+ "INTERACT_ACROSS_USERS_FULL not allowed.");
  }
  if (userId == UserHandle.USER_CURRENT || userId == UserHandle.USER_CURRENT_OR_SELF) {
    return mCurrentUserId;
  }
  return userId;
}
