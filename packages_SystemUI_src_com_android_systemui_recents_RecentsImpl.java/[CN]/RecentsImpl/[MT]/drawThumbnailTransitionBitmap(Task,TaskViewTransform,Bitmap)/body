{
  SystemServicesProxy ssp=Recents.getSystemServices();
  if (toTransform != null && toTask.key != null) {
synchronized (mHeaderBarLock) {
      boolean disabledInSafeMode=!toTask.isSystemApp && ssp.isInSafeMode();
      mHeaderBar.onTaskViewSizeChanged((int)toTransform.rect.width(),(int)toTransform.rect.height());
      if (RecentsDebugFlags.Static.EnableTransitionThumbnailDebugMode) {
        thumbnail.eraseColor(0xFFff0000);
      }
 else {
        thumbnail.eraseColor(0);
        Canvas c=new Canvas(thumbnail);
        Drawable icon=mHeaderBar.getIconView().getDrawable();
        if (icon != null) {
          icon.setCallback(null);
        }
        mHeaderBar.bindToTask(toTask,false,disabledInSafeMode);
        mHeaderBar.onTaskDataLoaded();
        mHeaderBar.setDimAlpha(toTransform.dimAlpha);
        mHeaderBar.draw(c);
        c.setBitmap(null);
      }
    }
    return thumbnail.createAshmemBitmap();
  }
  return null;
}
