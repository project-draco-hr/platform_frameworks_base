{
  SystemServicesProxy ssp=Recents.getSystemServices();
  Rect systemInsets=new Rect();
  ssp.getStableInsets(systemInsets);
  Rect windowRect=ssp.getWindowRect();
  if (ssp.hasDockedTask()) {
    windowRect.bottom-=systemInsets.bottom;
    systemInsets.bottom=0;
  }
  calculateWindowStableInsets(systemInsets,windowRect);
  windowRect.offsetTo(0,0);
  TaskStackLayoutAlgorithm stackLayout=mDummyStackView.getStackAlgorithm();
  stackLayout.setSystemInsets(systemInsets);
  if (stack != null) {
    stackLayout.getTaskStackBounds(windowRect,systemInsets.top,systemInsets.right,mTaskStackBounds);
    stackLayout.reset();
    stackLayout.initialize(windowRect,mTaskStackBounds,TaskStackLayoutAlgorithm.StackState.getStackStateForStack(stack));
    mDummyStackView.setTasks(stack,false);
    Rect taskViewBounds=stackLayout.getUntransformedTaskViewBounds();
    int taskViewWidth=taskViewBounds.width();
synchronized (mHeaderBarLock) {
      if (mHeaderBar.getMeasuredWidth() != taskViewWidth || mHeaderBar.getMeasuredHeight() != mTaskBarHeight) {
        mHeaderBar.measure(View.MeasureSpec.makeMeasureSpec(taskViewWidth,View.MeasureSpec.EXACTLY),View.MeasureSpec.makeMeasureSpec(mTaskBarHeight,View.MeasureSpec.EXACTLY));
      }
      mHeaderBar.layout(0,0,taskViewWidth,mTaskBarHeight);
    }
    if (mThumbTransitionBitmapCache == null || (mThumbTransitionBitmapCache.getWidth() != taskViewWidth) || (mThumbTransitionBitmapCache.getHeight() != mTaskBarHeight)) {
      mThumbTransitionBitmapCache=Bitmap.createBitmap(taskViewWidth,mTaskBarHeight,Bitmap.Config.ARGB_8888);
    }
  }
}
