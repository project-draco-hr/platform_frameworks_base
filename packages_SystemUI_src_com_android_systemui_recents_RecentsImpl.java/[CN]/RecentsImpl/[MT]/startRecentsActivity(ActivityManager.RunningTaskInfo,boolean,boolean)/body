{
  RecentsTaskLoader loader=Recents.getTaskLoader();
  if (mLaunchedWhileDocking || mTriggeredFromAltTab || sInstanceLoadPlan == null) {
    sInstanceLoadPlan=loader.createLoadPlan(mContext);
  }
  if (mLaunchedWhileDocking || mTriggeredFromAltTab || !sInstanceLoadPlan.hasTasks()) {
    loader.preloadTasks(sInstanceLoadPlan,topTask.id,isTopTaskHome);
  }
  TaskStack stack=sInstanceLoadPlan.getTaskStack();
  updateHeaderBarLayout(false,stack);
  mDummyStackView.updateLayoutForStack(stack);
  TaskStackLayoutAlgorithm.VisibilityReport stackVr=mDummyStackView.computeStackVisibilityReport();
  if (!animate) {
    ActivityOptions opts=ActivityOptions.makeCustomAnimation(mContext,-1,-1);
    startRecentsActivity(topTask,opts,false,false,false,stackVr);
    return;
  }
  boolean hasRecentTasks=stack.getTaskCount() > 0;
  boolean useThumbnailTransition=(topTask != null) && !isTopTaskHome && hasRecentTasks;
  if (useThumbnailTransition) {
    ActivityOptions opts=getThumbnailTransitionActivityOptions(topTask,mDummyStackView);
    if (opts != null) {
      startRecentsActivity(topTask,opts,false,false,true,stackVr);
    }
 else {
      useThumbnailTransition=false;
    }
  }
  if (!useThumbnailTransition) {
    if (hasRecentTasks) {
      SystemServicesProxy ssp=Recents.getSystemServices();
      String homeActivityPackage=ssp.getHomeActivityPackageName();
      String searchWidgetPackage=null;
      if (RecentsDebugFlags.Static.EnableSearchBar) {
        searchWidgetPackage=Prefs.getString(mContext,Prefs.Key.OVERVIEW_SEARCH_APP_WIDGET_PACKAGE,null);
      }
 else {
        AppWidgetProviderInfo searchWidgetInfo=ssp.resolveSearchAppWidget();
        if (searchWidgetInfo != null) {
          searchWidgetPackage=searchWidgetInfo.provider.getPackageName();
        }
      }
      boolean fromSearchHome=(homeActivityPackage != null) && homeActivityPackage.equals(searchWidgetPackage);
      ActivityOptions opts=getHomeTransitionActivityOptions(fromSearchHome);
      startRecentsActivity(topTask,opts,true,fromSearchHome,false,stackVr);
    }
 else {
      ActivityOptions opts=getUnknownTransitionActivityOptions();
      startRecentsActivity(topTask,opts,true,false,false,stackVr);
    }
  }
  mLastToggleTime=SystemClock.elapsedRealtime();
}
