{
  HashMap<String,TileGroup> pkgMap=new HashMap<>();
  PackageManager pm=mContext.getPackageManager();
  List<ResolveInfo> services=pm.queryIntentServices(new Intent(TILE_ACTION),0);
  for (  ResolveInfo info : services) {
    String packageName=info.serviceInfo.packageName;
    ComponentName componentName=new ComponentName(packageName,info.serviceInfo.name);
    String spec=CustomTile.PREFIX + componentName.flattenToShortString() + ")";
    if (mCurrentTiles.contains(spec)) {
      continue;
    }
    try {
      TileGroup group=pkgMap.get(packageName);
      if (group == null) {
        group=new TileGroup(packageName,mContext);
        pkgMap.put(packageName,group);
      }
      Drawable icon=info.serviceInfo.loadIcon(pm);
      CharSequence label=info.serviceInfo.loadLabel(pm);
      group.addTile(spec,icon,label != null ? label.toString() : "null");
    }
 catch (    NameNotFoundException e) {
      Log.w(TAG,"Couldn't find resolved package... " + packageName,e);
    }
  }
  return pkgMap.values();
}
