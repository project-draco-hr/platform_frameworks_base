{
  createTableAndClearCache();
  mDatabase.execSQL("INSERT into " + TEST_TABLE + " values(10, 999);");
  String sql="select * from " + TEST_TABLE;
  Cursor c=mDatabase.rawQuery(sql,null);
  assertEquals(1,c.getCount());
  mDatabase.execSQL("BEGIN transaction");
  try {
    mDatabase.execSQL("INSERT into " + TEST_TABLE + " values(100, 9909);");
    assertEquals(2,DatabaseUtils.longForQuery(mDatabase,"select count(*) from " + TEST_TABLE,null));
    c.requery();
    assertEquals(2,c.getCount());
  }
  finally {
    mDatabase.execSQL("commit;");
  }
  c.close();
  createTableAndClearCache();
  mDatabase.execSQL("INSERT into " + TEST_TABLE + " values(10, 999);");
  final Cursor c1=mDatabase.rawQuery("select count(*) from " + TEST_TABLE,null);
  assertEquals(1,c1.getCount());
  mDatabase.execSQL("BEGIN transaction");
  try {
    mDatabase.execSQL("INSERT into " + TEST_TABLE + " values(100, 9909);");
    assertEquals(2,DatabaseUtils.longForQuery(mDatabase,"select count(*) from " + TEST_TABLE,null));
    Thread t=new Thread(){
      @Override public void run(){
        c1.requery();
        assertEquals(1,c1.getCount());
      }
    }
;
    t.start();
    t.join();
  }
  finally {
    mDatabase.execSQL("commit");
  }
  c1.close();
}
