{
  if (mFile.exists()) {
    if (!mcr.changesMade) {
      mcr.setDiskWriteResult(true);
      return;
    }
    if (!mBackupFile.exists()) {
      if (!mFile.renameTo(mBackupFile)) {
        Log.e(TAG,"Couldn't rename file " + mFile + " to backup file "+ mBackupFile);
        mcr.setDiskWriteResult(false);
        return;
      }
    }
 else {
      mFile.delete();
    }
  }
  try {
    FileOutputStream str=createFileOutputStream(mFile);
    if (str == null) {
      mcr.setDiskWriteResult(false);
      return;
    }
    XmlUtils.writeMapXml(mcr.mapToWriteToDisk,str);
    FileUtils.sync(str);
    str.close();
    ContextImpl.setFilePermissionsFromMode(mFile.getPath(),mMode,0);
    try {
      final StructStat stat=Libcore.os.stat(mFile.getPath());
synchronized (this) {
        mStatTimestamp=stat.st_mtime;
        mStatSize=stat.st_size;
      }
    }
 catch (    ErrnoException e) {
    }
    mBackupFile.delete();
    mcr.setDiskWriteResult(true);
    return;
  }
 catch (  XmlPullParserException e) {
    Log.w(TAG,"writeToFile: Got exception:",e);
  }
catch (  IOException e) {
    Log.w(TAG,"writeToFile: Got exception:",e);
  }
  if (mFile.exists()) {
    if (!mFile.delete()) {
      Log.e(TAG,"Couldn't clean up partially-written file " + mFile);
    }
  }
  mcr.setDiskWriteResult(false);
}
