{
  int adX1=dX1 < 0 ? -dX1 : dX1;
  int adX2=dX2 < 0 ? -dX2 : dX2;
  if (adX1 <= adX2) {
    return ((dX1 << 1) * cX + (dX1 > 0 ? dX2 : -dX2)) / (dX2 << 1);
  }
  int k;
  if (top) {
    k=-dX1 + (dX2 < 0 ? 0 : dX1 > 0 ? (dX2 << 1) : -(dX2 << 1));
  }
 else {
    k=dX1 + (dX2 > 0 ? 0 : dX1 > 0 ? (dX2 << 1) : -(dX2 << 1));
  }
  k+=dX1 > 0 == dX2 > 0 ? -1 : 1;
  return ((dX1 << 1) * cX + k) / (dX2 << 1);
}
