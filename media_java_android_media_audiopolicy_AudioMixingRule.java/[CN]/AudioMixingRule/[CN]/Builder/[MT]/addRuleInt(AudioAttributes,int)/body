{
  if (attrToMatch == null) {
    throw new IllegalArgumentException("Illegal null AudioAttributes argument");
  }
  if (!isValidIntRule(rule)) {
    throw new IllegalArgumentException("Illegal rule value " + rule);
  }
 else {
    if (mTargetMixType == AudioMix.MIX_TYPE_INVALID) {
      if (isPlayerRule(rule)) {
        mTargetMixType=AudioMix.MIX_TYPE_PLAYERS;
      }
 else {
        mTargetMixType=AudioMix.MIX_TYPE_RECORDERS;
      }
    }
 else     if (((mTargetMixType == AudioMix.MIX_TYPE_PLAYERS) && !isPlayerRule(rule)) || ((mTargetMixType == AudioMix.MIX_TYPE_RECORDERS) && isPlayerRule(rule))) {
      throw new IllegalArgumentException("Incompatible rule for mix");
    }
  }
synchronized (mCriteria) {
    Iterator<AttributeMatchCriterion> crIterator=mCriteria.iterator();
    while (crIterator.hasNext()) {
      final AttributeMatchCriterion criterion=crIterator.next();
      if ((rule == RULE_MATCH_ATTRIBUTE_USAGE) || (rule == RULE_EXCLUDE_ATTRIBUTE_USAGE)) {
        if (criterion.mAttr.getUsage() == attrToMatch.getUsage()) {
          if (criterion.mRule == rule) {
            return this;
          }
 else {
            throw new IllegalArgumentException("Contradictory rule exists for " + attrToMatch);
          }
        }
      }
 else       if ((rule == RULE_MATCH_ATTRIBUTE_CAPTURE_PRESET) || (rule == RULE_EXCLUDE_ATTRIBUTE_CAPTURE_PRESET)) {
        if (criterion.mAttr.getCapturePreset() == attrToMatch.getCapturePreset()) {
          if (criterion.mRule == rule) {
            return this;
          }
 else {
            throw new IllegalArgumentException("Contradictory rule exists for " + attrToMatch);
          }
        }
      }
    }
    mCriteria.add(new AttributeMatchCriterion(attrToMatch,rule));
  }
  return this;
}
