{
  if (mSimFdnEnabledState != SimFdnState.REQUIRE_PIN2) {
    Log.i(LOG_TAG,"[SimCmd] supplySimPin2: wrong state, state=" + mSimFdnEnabledState);
    CommandException ex=new CommandException(CommandException.Error.PASSWORD_INCORRECT);
    AsyncResult.forMessage(result,null,ex);
    result.sendToTarget();
    return;
  }
  if (pin2 != null && pin2.equals(mPin2Code)) {
    Log.i(LOG_TAG,"[SimCmd] supplySimPin2: success!");
    mPin2UnlockAttempts=0;
    mSimFdnEnabledState=SimFdnState.NONE;
    if (result != null) {
      AsyncResult.forMessage(result,null,null);
      result.sendToTarget();
    }
    return;
  }
  if (result != null) {
    mPin2UnlockAttempts++;
    Log.i(LOG_TAG,"[SimCmd] supplySimPin2: failed! attempt=" + mPin2UnlockAttempts);
    if (mPin2UnlockAttempts >= 3) {
      Log.i(LOG_TAG,"[SimCmd] supplySimPin2: set state to REQUIRE_PUK2");
      mSimFdnEnabledState=SimFdnState.REQUIRE_PUK2;
    }
    CommandException ex=new CommandException(CommandException.Error.PASSWORD_INCORRECT);
    AsyncResult.forMessage(result,null,ex);
    result.sendToTarget();
  }
}
