{
  if (mSimLockedState != SimLockState.REQUIRE_PIN) {
    Log.i(LOG_TAG,"[SimCmd] supplySimPin: wrong state, state=" + mSimLockedState);
    CommandException ex=new CommandException(CommandException.Error.PASSWORD_INCORRECT);
    AsyncResult.forMessage(result,null,ex);
    result.sendToTarget();
    return;
  }
  if (pin != null && pin.equals(mPinCode)) {
    Log.i(LOG_TAG,"[SimCmd] supplySimPin: success!");
    setRadioState(RadioState.SIM_READY);
    mPinUnlockAttempts=0;
    mSimLockedState=SimLockState.NONE;
    if (result != null) {
      AsyncResult.forMessage(result,null,null);
      result.sendToTarget();
    }
    return;
  }
  if (result != null) {
    mPinUnlockAttempts++;
    Log.i(LOG_TAG,"[SimCmd] supplySimPin: failed! attempt=" + mPinUnlockAttempts);
    if (mPinUnlockAttempts >= 3) {
      Log.i(LOG_TAG,"[SimCmd] supplySimPin: set state to REQUIRE_PUK");
      mSimLockedState=SimLockState.REQUIRE_PUK;
    }
    CommandException ex=new CommandException(CommandException.Error.PASSWORD_INCORRECT);
    AsyncResult.forMessage(result,null,ex);
    result.sendToTarget();
  }
}
