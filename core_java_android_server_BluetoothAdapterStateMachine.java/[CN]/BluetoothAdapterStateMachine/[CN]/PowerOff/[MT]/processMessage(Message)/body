{
  if (DBG)   log("PowerOff process message: " + message.what);
  boolean retValue=HANDLED;
switch (message.what) {
case USER_TURN_ON:
    transitionTo(mWarmUp);
  broadcastState(BluetoothAdapter.STATE_TURNING_ON);
if (prepareBluetooth()) {
  if ((Boolean)message.obj) {
    mPersistSwitchOn=true;
  }
  deferMessage(obtainMessage(TURN_ON_CONTINUE));
}
 else {
  Log.e(TAG,"failed to prepare bluetooth, abort turning on");
  transitionTo(mPowerOff);
  broadcastState(BluetoothAdapter.STATE_OFF);
}
break;
case TURN_HOT:
if (prepareBluetooth()) {
transitionTo(mWarmUp);
}
break;
case AIRPLANE_MODE_OFF:
if (getBluetoothPersistedSetting()) {
transitionTo(mWarmUp);
broadcastState(BluetoothAdapter.STATE_TURNING_ON);
if (prepareBluetooth()) {
deferMessage(obtainMessage(TURN_ON_CONTINUE));
transitionTo(mWarmUp);
}
 else {
Log.e(TAG,"failed to prepare bluetooth, abort turning on");
transitionTo(mPowerOff);
broadcastState(BluetoothAdapter.STATE_OFF);
}
}
break;
case AIRPLANE_MODE_ON:
case USER_TURN_OFF:
break;
default :
return NOT_HANDLED;
}
return retValue;
}
