{
  FrameBuffer2D imageFrame=getConnectedInputPort("image").pullFrame().asFrameImage2D();
  OutputPort outPort=getConnectedOutputPort("histogram");
  mValueBins=mHueBins;
  int[] outDims=new int[]{mHueBins,mSaturationBins + 1};
  FrameBuffer2D histogramFrame=outPort.fetchAvailableFrame(outDims).asFrameBuffer2D();
  ByteBuffer imageBuffer=imageFrame.lockBytes(Frame.MODE_READ);
  ByteBuffer histogramBuffer=histogramFrame.lockBytes(Frame.MODE_READ);
  histogramBuffer.order(ByteOrder.nativeOrder());
  FloatBuffer floatHistogram=histogramBuffer.asFloatBuffer();
  extractChromaHistogram(imageBuffer,floatHistogram,mHueBins,mSaturationBins,mValueBins,mSaturationThreshold,mValueThreshold);
  imageFrame.unlock();
  histogramFrame.unlock();
  outPort.pushFrame(histogramFrame);
}
