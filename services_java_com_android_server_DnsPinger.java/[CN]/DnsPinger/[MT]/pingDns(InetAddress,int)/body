{
  DatagramSocket socket=null;
  try {
    socket=new DatagramSocket();
    socket.setSoTimeout(timeout);
    try {
      socket.setNetworkInterface(NetworkInterface.getByName(getCurrentLinkProperties().getInterfaceName()));
    }
 catch (    Exception e) {
      Slog.d(TAG,"pingDns::Error binding to socket",e);
    }
    byte[] buf=constructQuery();
    DatagramPacket packet=new DatagramPacket(buf,buf.length,dnsAddress,DNS_PORT);
    long start=SystemClock.elapsedRealtime();
    socket.send(packet);
    DatagramPacket replyPacket=new DatagramPacket(buf,buf.length);
    socket.receive(replyPacket);
    return SystemClock.elapsedRealtime() - start;
  }
 catch (  SocketTimeoutException e) {
    return -1;
  }
catch (  Exception e) {
    if (V) {
      Slog.v(TAG,"DnsPinger.pingDns got socket exception: ",e);
    }
    return -2;
  }
 finally {
    if (socket != null) {
      socket.close();
    }
  }
}
