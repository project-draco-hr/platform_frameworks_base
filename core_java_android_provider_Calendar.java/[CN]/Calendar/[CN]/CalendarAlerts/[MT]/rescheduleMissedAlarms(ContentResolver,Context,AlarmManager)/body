{
  long now=System.currentTimeMillis();
  long ancient=now - 24 * DateUtils.HOUR_IN_MILLIS;
  String selection=CalendarAlerts.STATE + "=" + CalendarAlerts.SCHEDULED+ " AND "+ CalendarAlerts.ALARM_TIME+ "<"+ now+ " AND "+ CalendarAlerts.ALARM_TIME+ ">"+ ancient+ " AND "+ CalendarAlerts.END+ ">="+ now;
  String[] projection=new String[]{_ID,BEGIN,END,ALARM_TIME};
  Cursor cursor=CalendarAlerts.query(cr,projection,selection,null);
  if (cursor == null) {
    return;
  }
  if (Log.isLoggable(TAG,Log.DEBUG)) {
    Log.d(TAG,"missed alarms found: " + cursor.getCount());
  }
  try {
    while (cursor.moveToNext()) {
      long id=cursor.getLong(0);
      long begin=cursor.getLong(1);
      long end=cursor.getLong(2);
      long alarmTime=cursor.getLong(3);
      Uri uri=ContentUris.withAppendedId(CONTENT_URI,id);
      Intent intent=new Intent(android.provider.Calendar.EVENT_REMINDER_ACTION);
      intent.setData(uri);
      intent.putExtra(android.provider.Calendar.EVENT_BEGIN_TIME,begin);
      intent.putExtra(android.provider.Calendar.EVENT_END_TIME,end);
      PendingIntent sender=PendingIntent.getBroadcast(context,0,intent,PendingIntent.FLAG_CANCEL_CURRENT);
      Log.w(TAG,"rescheduling missed alarm, id: " + id + " begin: "+ begin+ " end: "+ end+ " alarmTime: "+ alarmTime);
      manager.set(AlarmManager.RTC_WAKEUP,alarmTime,sender);
    }
  }
  finally {
    cursor.close();
  }
}
