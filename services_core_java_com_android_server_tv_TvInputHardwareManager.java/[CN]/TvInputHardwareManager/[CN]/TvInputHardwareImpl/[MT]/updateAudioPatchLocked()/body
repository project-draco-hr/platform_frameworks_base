{
  AudioPortConfig sourceConfig=mAudioSource.activeConfig();
  AudioPortConfig sinkConfig=mAudioSink.activeConfig();
  AudioPatch[] audioPatchArray=new AudioPatch[]{mAudioPatch};
  if (sinkConfig == null || (mDesiredSamplingRate != 0 && sinkConfig.samplingRate() != mDesiredSamplingRate) || (mDesiredChannelMask != AudioFormat.CHANNEL_OUT_DEFAULT && sinkConfig.channelMask() != mDesiredChannelMask) || (mDesiredFormat != AudioFormat.ENCODING_DEFAULT && sinkConfig.format() != mDesiredFormat)) {
    sinkConfig=mAudioSource.buildConfig(mDesiredSamplingRate,mDesiredChannelMask,mDesiredFormat,null);
  }
  if (sourceConfig == null) {
    sourceConfig=mAudioSource.buildConfig(sinkConfig.samplingRate(),sinkConfig.channelMask(),sinkConfig.format(),null);
  }
  mAudioManager.createAudioPatch(audioPatchArray,new AudioPortConfig[]{sourceConfig},new AudioPortConfig[]{sinkConfig});
  mAudioPatch=audioPatchArray[0];
}
