{
synchronized (mImplLock) {
    if (mReleased) {
      throw new IllegalStateException("Device already released.");
    }
    if (mInfo.getType() == TvInputHal.TYPE_HDMI) {
      if (surface != null) {
        mActiveHdmiSources.add(mInfo.getDeviceId());
      }
 else {
        mActiveHdmiSources.remove(mInfo.getDeviceId());
        if (mActiveHdmiSources.size() == 0) {
        }
      }
    }
    if (mAudioSource != null && mAudioSink != null) {
      if (surface != null) {
        AudioPortConfig sourceConfig=mAudioSource.activeConfig();
        AudioPortConfig sinkConfig=mAudioSink.activeConfig();
        AudioPatch[] audioPatchArray=new AudioPatch[]{mAudioPatch};
        mAudioManager.createAudioPatch(audioPatchArray,new AudioPortConfig[]{sourceConfig},new AudioPortConfig[]{sinkConfig});
        mAudioPatch=audioPatchArray[0];
      }
 else {
        mAudioManager.releaseAudioPatch(mAudioPatch);
        mAudioPatch=null;
      }
    }
    return mHal.setSurface(mInfo.getDeviceId(),surface,config) == TvInputHal.SUCCESS;
  }
}
