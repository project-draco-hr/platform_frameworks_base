{
synchronized (mLock) {
    String oldInputId=mHardwareInputIdMap.get(deviceId);
    if (oldInputId != null) {
      Slog.w(TAG,"Trying to override previous registration: old = " + mInputMap.get(oldInputId) + ":"+ deviceId+ ", new = "+ info+ ":"+ deviceId);
    }
    mHardwareInputIdMap.put(deviceId,info.getId());
    mInputMap.put(info.getId(),info);
    for (int i=0; i < mHdmiStateMap.size(); ++i) {
      TvInputHardwareInfo hardwareInfo=findHardwareInfoForHdmiPortLocked(mHdmiStateMap.keyAt(i));
      if (hardwareInfo == null) {
        continue;
      }
      String inputId=mHardwareInputIdMap.get(hardwareInfo.getDeviceId());
      if (inputId != null && inputId.equals(info.getId())) {
        mHandler.obtainMessage(ListenerHandler.STATE_CHANGED,convertConnectedToState(mHdmiStateMap.valueAt(i)),0,inputId).sendToTarget();
        return;
      }
    }
    Connection connection=mConnections.get(deviceId);
    if (connection != null) {
      mHandler.obtainMessage(ListenerHandler.STATE_CHANGED,convertConnectedToState(connection.getConfigsLocked().length > 0),0,info.getId()).sendToTarget();
      return;
    }
  }
}
