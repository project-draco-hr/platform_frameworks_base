{
  mContext=context;
  mDisplay=display;
  display.getRealMetrics(mDisplayMetrics);
  Bitmap screenshot=Surface.screenshot(0,0);
  if (screenshot == null) {
    return;
  }
  mSnapshotRotation=0;
  mWidth=screenshot.getWidth();
  mHeight=screenshot.getHeight();
  mOriginalRotation=display.getRotation();
  mOriginalWidth=mDisplayMetrics.widthPixels;
  mOriginalHeight=mDisplayMetrics.heightPixels;
  if (!inTransaction) {
    if (WindowManagerService.SHOW_TRANSACTIONS)     Slog.i(WindowManagerService.TAG,">>> OPEN TRANSACTION ScreenRotationAnimation");
    Surface.openTransaction();
  }
  try {
    try {
      mSurface=new Surface(session,0,"FreezeSurface",-1,mWidth,mHeight,PixelFormat.OPAQUE,0);
      mSurface.setLayer(FREEZE_LAYER + 1);
    }
 catch (    Surface.OutOfResourcesException e) {
      Slog.w(TAG,"Unable to allocate freeze surface",e);
    }
    setRotation(display.getRotation());
    if (mSurface != null) {
      Rect dirty=new Rect(0,0,mWidth,mHeight);
      Canvas c=null;
      try {
        c=mSurface.lockCanvas(dirty);
      }
 catch (      IllegalArgumentException e) {
        Slog.w(TAG,"Unable to lock surface",e);
      }
catch (      Surface.OutOfResourcesException e) {
        Slog.w(TAG,"Unable to lock surface",e);
      }
      if (c == null) {
        Slog.w(TAG,"Null surface canvas");
        mSurface.destroy();
        mSurface=null;
        return;
      }
      Paint paint=new Paint(0);
      paint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC));
      c.drawBitmap(screenshot,0,0,paint);
      mSurface.unlockCanvasAndPost(c);
    }
  }
  finally {
    if (!inTransaction) {
      Surface.closeTransaction();
      if (WindowManagerService.SHOW_TRANSACTIONS)       Slog.i(WindowManagerService.TAG,"<<< CLOSE TRANSACTION ScreenRotationAnimation");
    }
    screenshot.recycle();
  }
}
