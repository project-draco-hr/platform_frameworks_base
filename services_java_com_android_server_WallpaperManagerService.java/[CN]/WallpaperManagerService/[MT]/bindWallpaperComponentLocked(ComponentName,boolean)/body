{
  if (mWallpaperConnection != null) {
    if (mWallpaperComponent == null) {
      if (componentName == null) {
        return;
      }
    }
 else     if (mWallpaperComponent.equals(componentName)) {
      return;
    }
  }
  try {
    ComponentName realComponentName=componentName;
    if (realComponentName == null) {
      String defaultComponent=mContext.getString(com.android.internal.R.string.default_wallpaper_component);
      if (defaultComponent != null && !isBitmap) {
        realComponentName=ComponentName.unflattenFromString(defaultComponent);
      }
      if (realComponentName == null) {
        realComponentName=new ComponentName("android",ImageWallpaper.class.getName());
      }
    }
    ServiceInfo si=mContext.getPackageManager().getServiceInfo(realComponentName,PackageManager.GET_META_DATA | PackageManager.GET_PERMISSIONS);
    if (!android.Manifest.permission.BIND_WALLPAPER.equals(si.permission)) {
      throw new SecurityException("Selected service does not require " + android.Manifest.permission.BIND_WALLPAPER + ": "+ realComponentName);
    }
    WallpaperInfo wi=null;
    Intent intent=new Intent(WallpaperService.SERVICE_INTERFACE);
    if (componentName != null) {
      List<ResolveInfo> ris=mContext.getPackageManager().queryIntentServices(intent,PackageManager.GET_META_DATA);
      for (int i=0; i < ris.size(); i++) {
        ServiceInfo rsi=ris.get(i).serviceInfo;
        if (rsi.name.equals(si.name) && rsi.packageName.equals(si.packageName)) {
          try {
            wi=new WallpaperInfo(mContext,ris.get(i));
          }
 catch (          XmlPullParserException e) {
            throw new IllegalArgumentException(e);
          }
catch (          IOException e) {
            throw new IllegalArgumentException(e);
          }
          break;
        }
      }
      if (wi == null) {
        throw new SecurityException("Selected service is not a wallpaper: " + realComponentName);
      }
    }
    WallpaperConnection newConn=new WallpaperConnection(wi);
    intent.setComponent(realComponentName);
    intent.putExtra(Intent.EXTRA_CLIENT_LABEL,com.android.internal.R.string.wallpaper_binding_label);
    intent.putExtra(Intent.EXTRA_CLIENT_INTENT,PendingIntent.getActivity(mContext,0,Intent.createChooser(new Intent(Intent.ACTION_SET_WALLPAPER),mContext.getText(com.android.internal.R.string.chooser_wallpaper)),0));
    if (!mContext.bindService(intent,newConn,Context.BIND_AUTO_CREATE)) {
      throw new IllegalArgumentException("Unable to bind service: " + componentName);
    }
    clearWallpaperComponentLocked();
    mWallpaperComponent=componentName;
    mWallpaperConnection=newConn;
    mLastDiedTime=SystemClock.uptimeMillis();
    try {
      if (DEBUG)       Log.v(TAG,"Adding window token: " + newConn.mToken);
      mIWindowManager.addWindowToken(newConn.mToken,WindowManager.LayoutParams.TYPE_WALLPAPER);
    }
 catch (    RemoteException e) {
    }
  }
 catch (  PackageManager.NameNotFoundException e) {
    throw new IllegalArgumentException("Unknown component " + componentName);
  }
}
