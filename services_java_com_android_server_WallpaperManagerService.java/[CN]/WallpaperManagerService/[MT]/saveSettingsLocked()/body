{
  JournaledFile journal=makeJournaledFile();
  FileOutputStream stream=null;
  try {
    stream=new FileOutputStream(journal.chooseForWrite(),false);
    XmlSerializer out=new FastXmlSerializer();
    out.setOutput(stream,"utf-8");
    out.startDocument(null,true);
    out.startTag(null,"wp");
    out.attribute(null,"width",Integer.toString(mWidth));
    out.attribute(null,"height",Integer.toString(mHeight));
    out.attribute(null,"name",mName);
    if (mWallpaperComponent != null) {
      out.attribute(null,"component",mWallpaperComponent.flattenToShortString());
    }
    out.endTag(null,"wp");
    out.endDocument();
    stream.close();
    journal.commit();
  }
 catch (  IOException e) {
    try {
      if (stream != null) {
        stream.close();
      }
    }
 catch (    IOException ex) {
    }
    journal.rollback();
  }
}
