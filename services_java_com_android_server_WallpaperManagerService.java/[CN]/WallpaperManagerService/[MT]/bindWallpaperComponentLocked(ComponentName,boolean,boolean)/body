{
  if (DEBUG)   Slog.v(TAG,"bindWallpaperComponentLocked: componentName=" + componentName);
  if (!force) {
    if (mWallpaperConnection != null) {
      if (mWallpaperComponent == null) {
        if (componentName == null) {
          if (DEBUG)           Slog.v(TAG,"bindWallpaperComponentLocked: still using default");
          return true;
        }
      }
 else       if (mWallpaperComponent.equals(componentName)) {
        if (DEBUG)         Slog.v(TAG,"same wallpaper");
        return true;
      }
    }
  }
  try {
    if (componentName == null) {
      String defaultComponent=mContext.getString(com.android.internal.R.string.default_wallpaper_component);
      if (defaultComponent != null) {
        componentName=ComponentName.unflattenFromString(defaultComponent);
        if (DEBUG)         Slog.v(TAG,"Use default component wallpaper:" + componentName);
      }
      if (componentName == null) {
        componentName=mImageWallpaperComponent;
        if (DEBUG)         Slog.v(TAG,"Using image wallpaper");
      }
    }
    ServiceInfo si=mContext.getPackageManager().getServiceInfo(componentName,PackageManager.GET_META_DATA | PackageManager.GET_PERMISSIONS);
    if (!android.Manifest.permission.BIND_WALLPAPER.equals(si.permission)) {
      String msg="Selected service does not require " + android.Manifest.permission.BIND_WALLPAPER + ": "+ componentName;
      if (fromUser) {
        throw new SecurityException(msg);
      }
      Slog.w(TAG,msg);
      return false;
    }
    WallpaperInfo wi=null;
    Intent intent=new Intent(WallpaperService.SERVICE_INTERFACE);
    if (componentName != null && !componentName.equals(mImageWallpaperComponent)) {
      List<ResolveInfo> ris=mContext.getPackageManager().queryIntentServices(intent,PackageManager.GET_META_DATA);
      for (int i=0; i < ris.size(); i++) {
        ServiceInfo rsi=ris.get(i).serviceInfo;
        if (rsi.name.equals(si.name) && rsi.packageName.equals(si.packageName)) {
          try {
            wi=new WallpaperInfo(mContext,ris.get(i));
          }
 catch (          XmlPullParserException e) {
            if (fromUser) {
              throw new IllegalArgumentException(e);
            }
            Slog.w(TAG,e);
            return false;
          }
catch (          IOException e) {
            if (fromUser) {
              throw new IllegalArgumentException(e);
            }
            Slog.w(TAG,e);
            return false;
          }
          break;
        }
      }
      if (wi == null) {
        String msg="Selected service is not a wallpaper: " + componentName;
        if (fromUser) {
          throw new SecurityException(msg);
        }
        Slog.w(TAG,msg);
        return false;
      }
    }
    if (DEBUG)     Slog.v(TAG,"Binding to:" + componentName);
    WallpaperConnection newConn=new WallpaperConnection(wi);
    intent.setComponent(componentName);
    intent.putExtra(Intent.EXTRA_CLIENT_LABEL,com.android.internal.R.string.wallpaper_binding_label);
    intent.putExtra(Intent.EXTRA_CLIENT_INTENT,PendingIntent.getActivity(mContext,0,Intent.createChooser(new Intent(Intent.ACTION_SET_WALLPAPER),mContext.getText(com.android.internal.R.string.chooser_wallpaper)),0));
    if (!mContext.bindService(intent,newConn,Context.BIND_AUTO_CREATE)) {
      String msg="Unable to bind service: " + componentName;
      if (fromUser) {
        throw new IllegalArgumentException(msg);
      }
      Slog.w(TAG,msg);
      return false;
    }
    clearWallpaperComponentLocked();
    mWallpaperComponent=componentName;
    mWallpaperConnection=newConn;
    mLastDiedTime=SystemClock.uptimeMillis();
    try {
      if (DEBUG)       Slog.v(TAG,"Adding window token: " + newConn.mToken);
      mIWindowManager.addWindowToken(newConn.mToken,WindowManager.LayoutParams.TYPE_WALLPAPER);
    }
 catch (    RemoteException e) {
    }
  }
 catch (  PackageManager.NameNotFoundException e) {
    String msg="Unknown component " + componentName;
    if (fromUser) {
      throw new IllegalArgumentException(msg);
    }
    Slog.w(TAG,msg);
    return false;
  }
  return true;
}
