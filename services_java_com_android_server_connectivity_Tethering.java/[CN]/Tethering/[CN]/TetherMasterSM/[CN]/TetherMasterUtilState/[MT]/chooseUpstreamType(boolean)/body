{
  String iface=findActiveUpstreamIface();
  IBinder b=ServiceManager.getService(Context.CONNECTIVITY_SERVICE);
  IConnectivityManager cm=IConnectivityManager.Stub.asInterface(b);
  mMobileReserved=false;
  if (DEBUG) {
    Log.d(TAG,"chooseUpstreamType(" + tryCell + "),  dunRequired ="+ mDunRequired+ ", iface="+ iface);
  }
  if (iface != null) {
    try {
      if (mDunRequired) {
        NetworkInfo info=cm.getNetworkInfo(ConnectivityManager.TYPE_MOBILE_DUN);
        if (info.isConnected()) {
          if (DEBUG)           Log.d(TAG,"setting dun ifacename =" + iface);
          turnOnMobileConnection();
        }
 else {
          info=cm.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
          if (info.isConnected()) {
            iface=null;
          }
        }
      }
 else {
        if (DEBUG)         Log.d(TAG,"checking if hipri brought us this connection");
        NetworkInfo info=cm.getNetworkInfo(ConnectivityManager.TYPE_MOBILE_HIPRI);
        if (info.isConnected()) {
          if (DEBUG)           Log.d(TAG,"yes - hipri in use");
          turnOnMobileConnection();
        }
      }
    }
 catch (    RemoteException e) {
      Log.e(TAG,"RemoteException calling ConnectivityManager",e);
      iface=null;
    }
  }
  if (iface == null) {
    boolean success=false;
    if (tryCell == TRY_TO_SETUP_MOBILE_CONNECTION) {
      success=turnOnMobileConnection();
    }
    if (!success) {
      sendMessageDelayed(CMD_RETRY_UPSTREAM,UPSTREAM_SETTLE_TIME_MS);
    }
  }
  notifyTetheredOfNewUpstreamIface(iface);
}
