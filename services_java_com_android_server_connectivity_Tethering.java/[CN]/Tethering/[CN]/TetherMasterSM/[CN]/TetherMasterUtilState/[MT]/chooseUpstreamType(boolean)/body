{
  int upType=ConnectivityManager.TYPE_NONE;
  String iface=null;
  updateConfiguration();
synchronized (mPublicSync) {
    if (VDBG) {
      Log.d(TAG,"chooseUpstreamType has upstream iface types:");
      for (      Integer netType : mUpstreamIfaceTypes) {
        Log.d(TAG," " + netType);
      }
    }
    for (    Integer netType : mUpstreamIfaceTypes) {
      NetworkInfo info=null;
      try {
        info=mConnService.getNetworkInfo(netType.intValue());
      }
 catch (      RemoteException e) {
      }
      if ((info != null) && info.isConnected()) {
        upType=netType.intValue();
        break;
      }
    }
  }
  if (VDBG) {
    Log.d(TAG,"chooseUpstreamType(" + tryCell + "), preferredApn ="+ mPreferredUpstreamMobileApn+ ", got type="+ upType);
  }
  if (upType == ConnectivityManager.TYPE_MOBILE_DUN || upType == ConnectivityManager.TYPE_MOBILE_HIPRI) {
    turnOnUpstreamMobileConnection(upType);
  }
  if (upType == ConnectivityManager.TYPE_NONE) {
    boolean tryAgainLater=true;
    if ((tryCell == TRY_TO_SETUP_MOBILE_CONNECTION) && (turnOnUpstreamMobileConnection(mPreferredUpstreamMobileApn) == true)) {
      tryAgainLater=false;
    }
    if (tryAgainLater) {
      sendMessageDelayed(CMD_RETRY_UPSTREAM,UPSTREAM_SETTLE_TIME_MS);
    }
  }
 else {
    LinkProperties linkProperties=null;
    try {
      linkProperties=mConnService.getLinkProperties(upType);
    }
 catch (    RemoteException e) {
    }
    if (linkProperties != null)     iface=linkProperties.getInterfaceName();
  }
  notifyTetheredOfNewUpstreamIface(iface);
}
