{
  IBinder b=ServiceManager.getService(Context.CONNECTIVITY_SERVICE);
  IConnectivityManager cm=IConnectivityManager.Stub.asInterface(b);
  try {
    if (!cm.isTetheringSupported())     return;
  }
 catch (  RemoteException e) {
    return;
  }
  ArrayList<String> availableList=new ArrayList<String>();
  ArrayList<String> activeList=new ArrayList<String>();
  ArrayList<String> erroredList=new ArrayList<String>();
  boolean wifiTethered=false;
  boolean usbTethered=false;
  boolean bluetoothTethered=false;
synchronized (mIfaces) {
    Set ifaces=mIfaces.keySet();
    for (    Object iface : ifaces) {
      TetherInterfaceSM sm=mIfaces.get(iface);
      if (sm != null) {
        if (sm.isErrored()) {
          erroredList.add((String)iface);
        }
 else         if (sm.isAvailable()) {
          availableList.add((String)iface);
        }
 else         if (sm.isTethered()) {
          if (isUsb((String)iface)) {
            usbTethered=true;
          }
 else           if (isWifi((String)iface)) {
            wifiTethered=true;
          }
 else           if (isBluetooth((String)iface)) {
            bluetoothTethered=true;
          }
          activeList.add((String)iface);
        }
      }
    }
  }
  Intent broadcast=new Intent(ConnectivityManager.ACTION_TETHER_STATE_CHANGED);
  broadcast.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
  broadcast.putStringArrayListExtra(ConnectivityManager.EXTRA_AVAILABLE_TETHER,availableList);
  broadcast.putStringArrayListExtra(ConnectivityManager.EXTRA_ACTIVE_TETHER,activeList);
  broadcast.putStringArrayListExtra(ConnectivityManager.EXTRA_ERRORED_TETHER,erroredList);
  mContext.sendStickyBroadcast(broadcast);
  if (DEBUG) {
    Log.d(TAG,"sendTetherStateChangedBroadcast " + availableList.size() + ", "+ activeList.size()+ ", "+ erroredList.size());
  }
  if (usbTethered) {
    if (wifiTethered || bluetoothTethered) {
      showTetheredNotification(com.android.internal.R.drawable.stat_sys_tether_general);
    }
 else {
      showTetheredNotification(com.android.internal.R.drawable.stat_sys_tether_usb);
    }
  }
 else   if (wifiTethered) {
    if (bluetoothTethered) {
      showTetheredNotification(com.android.internal.R.drawable.stat_sys_tether_general);
    }
 else {
      showTetheredNotification(com.android.internal.R.drawable.stat_sys_tether_wifi);
    }
  }
 else   if (bluetoothTethered) {
    showTetheredNotification(com.android.internal.R.drawable.stat_sys_tether_bluetooth);
  }
 else {
    clearTetheredNotification();
  }
}
