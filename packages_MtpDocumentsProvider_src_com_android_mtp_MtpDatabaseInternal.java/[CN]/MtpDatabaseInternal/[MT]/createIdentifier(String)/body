{
  final Identifier oldIdentifier=Identifier.createFromDocumentId(documentId);
  final String selection;
  final String[] args;
  if (oldIdentifier.mObjectHandle == CursorHelper.DUMMY_HANDLE_FOR_ROOT) {
    selection=COLUMN_DEVICE_ID + "= ? AND " + COLUMN_ROW_STATE+ " IN (?, ?) AND "+ COLUMN_STORAGE_ID+ "= ? AND "+ COLUMN_PARENT_DOCUMENT_ID+ " IS NULL";
    args=strings(oldIdentifier.mDeviceId,ROW_STATE_VALID,ROW_STATE_INVALIDATED,oldIdentifier.mStorageId);
  }
 else {
    selection=COLUMN_DEVICE_ID + "= ? AND " + COLUMN_ROW_STATE+ " IN (?, ?) AND "+ COLUMN_STORAGE_ID+ "= ? AND "+ COLUMN_OBJECT_HANDLE+ " = ?";
    args=strings(oldIdentifier.mDeviceId,ROW_STATE_VALID,ROW_STATE_INVALIDATED,oldIdentifier.mStorageId,oldIdentifier.mObjectHandle);
  }
  final Cursor cursor=mDatabase.query(TABLE_DOCUMENTS,strings(Document.COLUMN_DOCUMENT_ID),selection,args,null,null,null,"1");
  try {
    if (cursor.getCount() == 0) {
      return oldIdentifier;
    }
 else {
      cursor.moveToNext();
      return new Identifier(oldIdentifier.mDeviceId,oldIdentifier.mStorageId,oldIdentifier.mObjectHandle,cursor.getString(0));
    }
  }
  finally {
    cursor.close();
  }
}
