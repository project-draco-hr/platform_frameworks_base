{
  final LayoutParams lp=(LayoutParams)child.getLayoutParams();
  final ActionMenuItemView itemView=child instanceof ActionMenuItemView ? (ActionMenuItemView)child : null;
  final int childHeightSize=MeasureSpec.getSize(parentHeightMeasureSpec) - parentHeightPadding;
  final int childHeightMode=MeasureSpec.getMode(parentHeightMeasureSpec);
  final int childHeightSpec=MeasureSpec.makeMeasureSpec(childHeightSize,childHeightMode);
  int cellsUsed=cellsRemaining > 0 ? 1 : 0;
  final boolean multiCell=!lp.isOverflowButton && (itemView == null || itemView.hasText());
  lp.multiCell=multiCell;
  if (multiCell && cellsRemaining > 0) {
    final int childWidthSpec=MeasureSpec.makeMeasureSpec(cellSize * cellsRemaining,MeasureSpec.AT_MOST);
    child.measure(childWidthSpec,childHeightSpec);
    final int measuredWidth=child.getMeasuredWidth();
    cellsUsed=measuredWidth / cellSize;
    if (measuredWidth % cellSize != 0)     cellsUsed++;
  }
  lp.cellsUsed=cellsUsed;
  final int targetWidth=cellsUsed * cellSize;
  child.measure(MeasureSpec.makeMeasureSpec(targetWidth,MeasureSpec.EXACTLY),childHeightSpec);
  return cellsUsed;
}
