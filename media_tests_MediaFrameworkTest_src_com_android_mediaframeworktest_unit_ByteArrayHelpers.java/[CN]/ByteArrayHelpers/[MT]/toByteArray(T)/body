{
  @SuppressWarnings("unchecked") Class<T> klass=(Class<T>)array.getClass();
  if (!klass.isArray()) {
    throw new IllegalArgumentException("array class must be an array");
  }
  Class<?> componentClass=klass.getComponentType();
  if (!componentClass.isPrimitive()) {
    throw new IllegalArgumentException("array's component must be a primitive");
  }
  int sizeInBits;
  if (klass == int.class) {
    sizeInBits=Integer.SIZE;
  }
 else   if (klass == float.class) {
    sizeInBits=Float.SIZE;
  }
 else   if (klass == double.class) {
    sizeInBits=Double.SIZE;
  }
 else   if (klass == short.class) {
    sizeInBits=Short.SIZE;
  }
 else   if (klass == char.class) {
    sizeInBits=Character.SIZE;
  }
 else   if (klass == long.class) {
    sizeInBits=Long.SIZE;
  }
 else   if (klass == byte.class) {
    sizeInBits=Byte.SIZE;
  }
 else {
    throw new AssertionError();
  }
  return toByteArray(array,sizeInBits);
}
