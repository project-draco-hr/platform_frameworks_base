{
  final ResolveInfo ri=target.getResolveInfo();
  final Intent intent=target != null ? target.getResolvedIntent() : null;
  if (intent != null && (mAlwaysUseOption || mAdapter.hasFilteredItem()) && mAdapter.mOrigResolveList != null) {
    IntentFilter filter=new IntentFilter();
    Intent filterIntent;
    if (intent.getSelector() != null) {
      filterIntent=intent.getSelector();
    }
 else {
      filterIntent=intent;
    }
    String action=filterIntent.getAction();
    if (action != null) {
      filter.addAction(action);
    }
    Set<String> categories=filterIntent.getCategories();
    if (categories != null) {
      for (      String cat : categories) {
        filter.addCategory(cat);
      }
    }
    filter.addCategory(Intent.CATEGORY_DEFAULT);
    int cat=ri.match & IntentFilter.MATCH_CATEGORY_MASK;
    Uri data=filterIntent.getData();
    if (cat == IntentFilter.MATCH_CATEGORY_TYPE) {
      String mimeType=filterIntent.resolveType(this);
      if (mimeType != null) {
        try {
          filter.addDataType(mimeType);
        }
 catch (        IntentFilter.MalformedMimeTypeException e) {
          Log.w("ResolverActivity",e);
          filter=null;
        }
      }
    }
    if (data != null && data.getScheme() != null) {
      if (cat != IntentFilter.MATCH_CATEGORY_TYPE || (!"file".equals(data.getScheme()) && !"content".equals(data.getScheme()))) {
        filter.addDataScheme(data.getScheme());
        Iterator<PatternMatcher> pIt=ri.filter.schemeSpecificPartsIterator();
        if (pIt != null) {
          String ssp=data.getSchemeSpecificPart();
          while (ssp != null && pIt.hasNext()) {
            PatternMatcher p=pIt.next();
            if (p.match(ssp)) {
              filter.addDataSchemeSpecificPart(p.getPath(),p.getType());
              break;
            }
          }
        }
        Iterator<IntentFilter.AuthorityEntry> aIt=ri.filter.authoritiesIterator();
        if (aIt != null) {
          while (aIt.hasNext()) {
            IntentFilter.AuthorityEntry a=aIt.next();
            if (a.match(data) >= 0) {
              int port=a.getPort();
              filter.addDataAuthority(a.getHost(),port >= 0 ? Integer.toString(port) : null);
              break;
            }
          }
        }
        pIt=ri.filter.pathsIterator();
        if (pIt != null) {
          String path=data.getPath();
          while (path != null && pIt.hasNext()) {
            PatternMatcher p=pIt.next();
            if (p.match(path)) {
              filter.addDataPath(p.getPath(),p.getType());
              break;
            }
          }
        }
      }
    }
    if (filter != null) {
      final int N=mAdapter.mOrigResolveList.size();
      ComponentName[] set=new ComponentName[N];
      int bestMatch=0;
      for (int i=0; i < N; i++) {
        ResolveInfo r=mAdapter.mOrigResolveList.get(i).getResolveInfoAt(0);
        set[i]=new ComponentName(r.activityInfo.packageName,r.activityInfo.name);
        if (r.match > bestMatch)         bestMatch=r.match;
      }
      if (alwaysCheck) {
        final int userId=getUserId();
        final PackageManager pm=getPackageManager();
        pm.addPreferredActivity(filter,bestMatch,set,intent.getComponent());
        if (ri.handleAllWebDataURI) {
          final String packageName=pm.getDefaultBrowserPackageNameAsUser(userId);
          if (TextUtils.isEmpty(packageName)) {
            pm.setDefaultBrowserPackageNameAsUser(ri.activityInfo.packageName,userId);
          }
        }
 else {
          ComponentName cn=intent.getComponent();
          String packageName=cn.getPackageName();
          String dataScheme=(data != null) ? data.getScheme() : null;
          boolean isHttpOrHttps=(dataScheme != null) && (dataScheme.equals(IntentFilter.SCHEME_HTTP) || dataScheme.equals(IntentFilter.SCHEME_HTTPS));
          boolean isViewAction=(action != null) && action.equals(Intent.ACTION_VIEW);
          boolean hasCategoryBrowsable=(categories != null) && categories.contains(Intent.CATEGORY_BROWSABLE);
          if (isHttpOrHttps && isViewAction && hasCategoryBrowsable) {
            pm.updateIntentVerificationStatusAsUser(packageName,PackageManager.INTENT_FILTER_DOMAIN_VERIFICATION_STATUS_ALWAYS,userId);
          }
        }
      }
 else {
        try {
          AppGlobals.getPackageManager().setLastChosenActivity(intent,intent.resolveType(getContentResolver()),PackageManager.MATCH_DEFAULT_ONLY,filter,bestMatch,intent.getComponent());
        }
 catch (        RemoteException re) {
          Log.d(TAG,"Error calling setLastChosenActivity\n" + re);
        }
      }
    }
  }
  if (target != null) {
    safelyStartActivity(target);
  }
  return true;
}
