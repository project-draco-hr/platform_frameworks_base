{
  if (args.length != 1) {
    System.err.println("Usage: WritePreloadedClassFile [compiled log file]");
    System.exit(0);
  }
  Root root=Root.fromFile(args[0]);
  for (  LoadedClass loadedClass : root.loadedClasses.values()) {
    loadedClass.preloaded=false;
  }
  Writer out=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(PRELOADED_CLASS_FILE),Charset.forName("US-ASCII")));
  out.write("# Classes which are preloaded by " + "com.android.internal.os.ZygoteInit.\n");
  out.write("# Automatically generated by /tools/preload.\n");
  out.write("# percent=" + Proc.PERCENTAGE_TO_PRELOAD + ", weight="+ ClassRank.SEQUENCE_WEIGHT+ ", bucket_size="+ ClassRank.BUCKET_SIZE+ "\n");
  Set<LoadedClass> highestRanked=new TreeSet<LoadedClass>();
  for (  Proc proc : root.processes.values()) {
    List<LoadedClass> highestForProc=proc.highestRankedClasses();
    System.out.println(proc.name + ": " + highestForProc.size());
    for (    LoadedClass loadedClass : highestForProc) {
      loadedClass.preloaded=true;
    }
    highestRanked.addAll(highestForProc);
  }
  for (  LoadedClass loadedClass : highestRanked) {
    out.write(loadedClass.name);
    out.write('\n');
  }
  out.close();
  System.out.println(highestRanked.size() + " classes will be preloaded.");
  root.toFile(args[0]);
}
