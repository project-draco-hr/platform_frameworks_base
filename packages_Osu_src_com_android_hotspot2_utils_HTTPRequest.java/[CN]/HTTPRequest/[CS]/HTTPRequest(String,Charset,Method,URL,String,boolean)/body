{
  mBody=payload != null ? payload.getBytes(charset) : null;
  mHeaderFields=new LinkedHashMap<>();
  mHeaderFields.put(AgentHeader,AgentName);
  if (url.getPort() != HTTPS_PORT) {
    mHeaderFields.put(HostHeader,url.getHost() + ':' + url.getPort());
  }
 else {
    mHeaderFields.put(HostHeader,url.getHost());
  }
  mHeaderFields.put(AcceptHeader,"*/*");
  if (payload != null) {
    if (base64) {
      mHeaderFields.put(ContentTypeHeader,contentType);
      mHeaderFields.put(ContentEncodingHeader,"base64");
    }
 else {
      mHeaderFields.put(ContentTypeHeader,contentType + "; charset=" + charset.displayName().toLowerCase());
    }
    mHeaderFields.put(ContentLengthHeader,Integer.toString(mBody.length));
  }
  mMethodLine=method.name() + ' ' + url.getPath()+ ' '+ HTTPVersion+ CRLF;
}
