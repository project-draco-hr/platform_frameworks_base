{
  if (params.length != 1)   return null;
  Context context=params[0].context;
  Bitmap image=params[0].image;
  try {
    long currentTime=System.currentTimeMillis();
    String date=new SimpleDateFormat("MM-dd-yy-kk-mm-ss").format(new Date(currentTime));
    String imageDir=Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).getAbsolutePath();
    String imageFilePath=String.format(SCREENSHOT_FILE_PATH_TEMPLATE,imageDir,SCREENSHOTS_DIR_NAME,date,currentTime % 1000);
    ContentValues values=new ContentValues();
    values.put(MediaStore.Images.ImageColumns.DATA,imageFilePath);
    values.put(MediaStore.Images.ImageColumns.TITLE,"Screenshot");
    values.put(MediaStore.Images.ImageColumns.DISPLAY_NAME,"Screenshot");
    values.put(MediaStore.Images.ImageColumns.DATE_TAKEN,currentTime);
    values.put(MediaStore.Images.ImageColumns.DATE_ADDED,currentTime);
    values.put(MediaStore.Images.ImageColumns.DATE_MODIFIED,currentTime);
    values.put(MediaStore.Images.ImageColumns.MIME_TYPE,"image/png");
    Uri uri=context.getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI,values);
    OutputStream out=context.getContentResolver().openOutputStream(uri);
    image.compress(Bitmap.CompressFormat.PNG,100,out);
    out.flush();
    out.close();
    params[0].result=0;
  }
 catch (  IOException e) {
    params[0].result=1;
  }
  return params[0];
}
