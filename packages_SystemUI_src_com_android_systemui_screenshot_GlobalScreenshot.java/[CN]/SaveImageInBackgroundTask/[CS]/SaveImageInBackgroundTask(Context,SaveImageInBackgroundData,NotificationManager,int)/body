{
  Resources r=context.getResources();
  mImageTime=System.currentTimeMillis();
  String imageDate=new SimpleDateFormat("yyyy-MM-dd-HH-mm-ss").format(new Date(mImageTime));
  String imageDir=Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).getAbsolutePath();
  mImageFileName=String.format(SCREENSHOT_FILE_NAME_TEMPLATE,imageDate);
  mImageFilePath=String.format(SCREENSHOT_FILE_PATH_TEMPLATE,imageDir,SCREENSHOTS_DIR_NAME,mImageFileName);
  int imageWidth=data.image.getWidth();
  int imageHeight=data.image.getHeight();
  int iconWidth=data.iconSize;
  int iconHeight=data.iconSize;
  if (imageWidth > imageHeight) {
    iconWidth=(int)(((float)iconHeight / imageHeight) * imageWidth);
  }
 else {
    iconHeight=(int)(((float)iconWidth / imageWidth) * imageHeight);
  }
  Bitmap rawIcon=Bitmap.createScaledBitmap(data.image,iconWidth,iconHeight,true);
  Bitmap croppedIcon=Bitmap.createBitmap(rawIcon,(iconWidth - data.iconSize) / 2,(iconHeight - data.iconSize) / 2,data.iconSize,data.iconSize);
  mTickerAddSpace=!mTickerAddSpace;
  mNotificationId=nId;
  mNotificationManager=nManager;
  mNotificationBuilder=new Notification.Builder(context).setTicker(r.getString(R.string.screenshot_saving_ticker) + (mTickerAddSpace ? " " : "")).setContentTitle(r.getString(R.string.screenshot_saving_title)).setContentText(r.getString(R.string.screenshot_saving_text)).setSmallIcon(R.drawable.stat_notify_image).setWhen(System.currentTimeMillis());
  Notification n=mNotificationBuilder.getNotification();
  n.flags|=Notification.FLAG_NO_CLEAR;
  mNotificationManager.notify(nId,n);
  mNotificationBuilder.setLargeIcon(croppedIcon);
}
