{
  super.onCreate(arguments);
  String[] apkPaths={getTargetContext().getPackageCodePath(),getContext().getPackageCodePath()};
  ClassPathPackageInfoSource.setApkPaths(apkPaths);
  boolean useUnitTestSuite=false;
  boolean useFunctionalTestSuite=false;
  String testClassName=null;
  Test test=null;
  if (arguments != null) {
    testClassName=arguments.getString(ARGUMENT_TEST_CLASS);
    mDebug=getBooleanArgument(arguments,"debug");
    mJustCount=getBooleanArgument(arguments,"count");
    mBundleOutput=getBooleanArgument(arguments,"bundle");
    mDatabaseOutput=getBooleanArgument(arguments,"database");
    useUnitTestSuite=getBooleanArgument(arguments,ARGUMENT_UNIT_CLASS);
    useFunctionalTestSuite=getBooleanArgument(arguments,ARGUMENT_FUNC_CLASS);
    mPackageOfTests=arguments.getString(ARGUMENT_TEST_PACKAGE);
  }
  if (testClassName == null) {
    if (mPackageOfTests != null) {
      test=createPackageTestSuite(getTargetContext(),useUnitTestSuite,useFunctionalTestSuite,mPackageOfTests);
    }
 else {
      test=getTestSuite();
    }
    if (test == null) {
      test=createDefaultTestSuite(getTargetContext(),useUnitTestSuite,useFunctionalTestSuite);
    }
    mTestCount=test.countTestCases();
  }
  mTestRunner=getAndroidTestRunner();
  mTestRunner.setContext(getTargetContext());
  mTestRunner.setInstrumentaiton(this);
  mTestRunner.addTestListener(new TestPrinter("TestRunner",false));
  if (mDatabaseOutput) {
    mTestRunner.addTestListener(new TestRecorder());
  }
  if (testClassName != null) {
    int methodSeparatorIndex=testClassName.indexOf('#');
    String testMethodName=null;
    if (methodSeparatorIndex > 0) {
      testMethodName=testClassName.substring(methodSeparatorIndex + 1);
      testClassName=testClassName.substring(0,methodSeparatorIndex);
    }
    mTestRunner.setTestClassName(testClassName,testMethodName);
    mTestCount=mTestRunner.getTestCases().size();
  }
 else {
    mTestRunner.setTest(test);
  }
  if (!mBundleOutput) {
    mTestRunner.addTestListener(new WatcherResultPrinter(mTestCount));
  }
  start();
}
