{
  if (DBG)   log(getName() + message.toString());
switch (message.what) {
case CMD_REEVALUATE:
    if (message.arg1 != mReevaluateToken)     return HANDLED;
  if (!mDefaultRequest.networkCapabilities.satisfiedByNetworkCapabilities(mNetworkAgentInfo.networkCapabilities)) {
    transitionTo(mValidatedState);
    return HANDLED;
  }
int httpResponseCode=isCaptivePortal();
if (httpResponseCode == 204) {
transitionTo(mValidatedState);
}
 else if (httpResponseCode >= 200 && httpResponseCode <= 399) {
transitionTo(mCaptivePortalState);
}
 else if (++mRetries > MAX_RETRIES) {
transitionTo(mOfflineState);
}
 else if (mReevaluateDelayMs >= 0) {
Message msg=obtainMessage(CMD_REEVALUATE,++mReevaluateToken,0);
sendMessageDelayed(msg,mReevaluateDelayMs);
}
return HANDLED;
case CMD_FORCE_REEVALUATION:
return HANDLED;
default :
return NOT_HANDLED;
}
}
