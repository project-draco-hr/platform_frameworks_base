{
  if (DBG)   log(getName() + message.toString());
switch (message.what) {
case CMD_REEVALUATE:
    if (message.arg1 != mReevaluateToken)     return HANDLED;
  if (mNetworkAgentInfo.isVPN()) {
    transitionTo(mValidatedState);
    return HANDLED;
  }
if (!mNetworkAgentInfo.networkCapabilities.hasCapability(NetworkCapabilities.NET_CAPABILITY_INTERNET)) {
  transitionTo(mValidatedState);
  return HANDLED;
}
Thread thread=new EvaluateInternetConnectivity(mReevaluateToken);
thread.run();
return HANDLED;
case EVENT_REEVALUATION_COMPLETE:
if (message.arg1 != mReevaluateToken) return HANDLED;
int httpResponseCode=message.arg2;
if (httpResponseCode == 204) {
transitionTo(mValidatedState);
}
 else if (httpResponseCode >= 200 && httpResponseCode <= 399) {
transitionTo(mUserPromptedState);
}
 else if (++mRetries > MAX_RETRIES) {
transitionTo(mOfflineState);
}
 else if (mReevaluateDelayMs >= 0) {
Message msg=obtainMessage(CMD_REEVALUATE,++mReevaluateToken,0);
sendMessageDelayed(msg,mReevaluateDelayMs);
}
return HANDLED;
default :
return NOT_HANDLED;
}
}
