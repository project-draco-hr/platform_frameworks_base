{
  if (DBG)   log(getName() + message.toString());
switch (message.what) {
case CMD_NETWORK_LINGER:
    if (DBG)     log("Lingering");
  transitionTo(mLingeringState);
return HANDLED;
case CMD_NETWORK_CONNECTED:
if (DBG) log("Connected");
transitionTo(mEvaluatingState);
return HANDLED;
case CMD_NETWORK_DISCONNECTED:
if (DBG) log("Disconnected - quitting");
if (mCaptivePortalLoggedInBroadcastReceiver != null) {
mContext.unregisterReceiver(mCaptivePortalLoggedInBroadcastReceiver);
mCaptivePortalLoggedInBroadcastReceiver=null;
}
quit();
return HANDLED;
case CMD_FORCE_REEVALUATION:
if (DBG) log("Forcing reevaluation");
mUidResponsibleForReeval=message.arg1;
transitionTo(mEvaluatingState);
return HANDLED;
case CMD_CAPTIVE_PORTAL_APP_FINISHED:
mCaptivePortalLoggedInResponseToken=String.valueOf(new Random().nextLong());
switch (message.arg1) {
case CAPTIVE_PORTAL_APP_RETURN_APPEASED:
case CAPTIVE_PORTAL_APP_RETURN_WANTED_AS_IS:
transitionTo(mValidatedState);
break;
case CAPTIVE_PORTAL_APP_RETURN_UNWANTED:
mUserDoesNotWant=true;
transitionTo(mOfflineState);
break;
}
return HANDLED;
default :
return HANDLED;
}
}
