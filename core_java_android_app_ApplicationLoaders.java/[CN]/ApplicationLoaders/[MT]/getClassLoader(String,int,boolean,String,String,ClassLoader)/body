{
  ClassLoader baseParent=ClassLoader.getSystemClassLoader().getParent();
synchronized (mLoaders) {
    if (parent == null) {
      parent=baseParent;
    }
    if (parent == baseParent) {
      ClassLoader loader=mLoaders.get(zip);
      if (loader != null) {
        return loader;
      }
      Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,zip);
      PathClassLoader pathClassloader=new PathClassLoader(zip,librarySearchPath,parent);
      String errorMessage=createClassloaderNamespace(pathClassloader,targetSdkVersion,librarySearchPath,libraryPermittedPath,isBundled);
      Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
      if (errorMessage != null) {
        throw new UnsatisfiedLinkError("Unable to create namespace for the classloader " + pathClassloader + ": "+ errorMessage);
      }
      mLoaders.put(zip,pathClassloader);
      return pathClassloader;
    }
    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,zip);
    PathClassLoader pathClassloader=new PathClassLoader(zip,parent);
    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
    return pathClassloader;
  }
}
