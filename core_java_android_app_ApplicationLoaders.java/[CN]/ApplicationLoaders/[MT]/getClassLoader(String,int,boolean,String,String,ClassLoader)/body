{
  ClassLoader baseParent=ClassLoader.getSystemClassLoader().getParent();
synchronized (mLoaders) {
    if (parent == null) {
      parent=baseParent;
    }
    if (parent == baseParent) {
      ClassLoader loader=mLoaders.get(zip);
      if (loader != null) {
        return loader;
      }
      Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,zip);
      PathClassLoader pathClassloader=PathClassLoaderFactory.createClassLoader(zip,librarySearchPath,libraryPermittedPath,parent,targetSdkVersion,isBundled);
      Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
      mLoaders.put(zip,pathClassloader);
      return pathClassloader;
    }
    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,zip);
    PathClassLoader pathClassloader=new PathClassLoader(zip,parent);
    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
    return pathClassloader;
  }
}
