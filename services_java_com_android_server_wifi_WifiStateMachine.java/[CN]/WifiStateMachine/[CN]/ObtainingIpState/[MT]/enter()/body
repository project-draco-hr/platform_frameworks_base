{
  if (!mWifiConfigStore.isUsingStaticIp(mLastNetworkId)) {
    startDhcp();
  }
 else {
    stopDhcp();
    DhcpResults dhcpResults=new DhcpResults(mWifiConfigStore.getLinkProperties(mLastNetworkId));
    InterfaceConfiguration ifcg=new InterfaceConfiguration();
    Iterator<LinkAddress> addrs=dhcpResults.linkProperties.getLinkAddresses().iterator();
    if (!addrs.hasNext()) {
      loge("Static IP lacks address");
      sendMessage(CMD_STATIC_IP_FAILURE);
    }
 else {
      ifcg.setLinkAddress(addrs.next());
      ifcg.setInterfaceUp();
      try {
        mNwService.setInterfaceConfig(mInterfaceName,ifcg);
        if (DBG)         log("Static IP configuration succeeded");
        sendMessage(CMD_STATIC_IP_SUCCESS,dhcpResults);
      }
 catch (      RemoteException re) {
        loge("Static IP configuration failed: " + re);
        sendMessage(CMD_STATIC_IP_FAILURE);
      }
catch (      IllegalStateException e) {
        loge("Static IP configuration failed: " + e);
        sendMessage(CMD_STATIC_IP_FAILURE);
      }
    }
  }
}
