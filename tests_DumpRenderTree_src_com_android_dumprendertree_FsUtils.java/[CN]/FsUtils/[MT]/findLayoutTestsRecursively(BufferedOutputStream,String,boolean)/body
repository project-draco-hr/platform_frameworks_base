{
  Log.v(LOGTAG,"Searching tests under " + dir);
  File d=new File(dir);
  if (!d.isDirectory()) {
    throw new AssertionError("A directory expected, but got " + dir);
  }
  ignoreResultsInDir|=FileFilter.ignoreResult(dir);
  String[] files=d.list();
  for (int i=0; i < files.length; i++) {
    String s=dir + "/" + files[i];
    File f=new File(s);
    if (f.isDirectory()) {
      if (!FileFilter.isNonTestDir(s)) {
        Log.v(LOGTAG,"Recursing on " + s);
        findLayoutTestsRecursively(bos,s,ignoreResultsInDir);
      }
      continue;
    }
    if (FileFilter.ignoreTest(s)) {
      Log.v(LOGTAG,"Ignoring: " + s);
      continue;
    }
    if ((s.toLowerCase().endsWith(".html") || s.toLowerCase().endsWith(".xml")) && !s.endsWith("TEMPLATE.html")) {
      Log.v(LOGTAG,"Recording " + s);
      bos.write(s.getBytes());
      if (ignoreResultsInDir || FileFilter.ignoreResult(s)) {
        bos.write((" IGNORE_RESULT").getBytes());
      }
      bos.write('\n');
    }
  }
}
