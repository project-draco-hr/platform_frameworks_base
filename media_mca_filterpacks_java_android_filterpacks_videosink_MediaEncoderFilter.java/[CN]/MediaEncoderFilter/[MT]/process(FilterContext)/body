{
  GLEnvironment glEnv=context.getGLEnvironment();
  Frame input=pullInput("videoframe");
  if (!mRecordingActive && mRecording) {
    startRecording(context);
  }
  if (mRecordingActive && !mRecording) {
    stopRecording(context);
  }
  if (!mRecordingActive)   return;
  if (mCaptureTimeLapse) {
    if (skipFrameAndModifyTimestamp(input.getTimestamp())) {
      return;
    }
  }
 else {
    mTimestampNs=input.getTimestamp();
  }
  glEnv.activateSurfaceWithId(mSurfaceId);
  mProgram.process(input,mScreen);
  glEnv.setSurfaceTimestamp(mTimestampNs);
  glEnv.swapBuffers();
  mNumFramesEncoded++;
}
