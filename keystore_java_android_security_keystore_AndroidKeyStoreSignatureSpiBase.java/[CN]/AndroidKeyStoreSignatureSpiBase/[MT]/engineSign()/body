{
  if (mCachedException != null) {
    throw new SignatureException(mCachedException);
  }
  byte[] signature;
  try {
    ensureKeystoreOperationInitialized();
    signature=mMessageStreamer.doFinal(EmptyArray.BYTE,0,0);
  }
 catch (  InvalidKeyException|KeyStoreException e) {
    throw new SignatureException(e);
  }
  resetWhilePreservingInitState();
  return signature;
}
