{
  if (mCachedException != null) {
    throw new SignatureException(mCachedException);
  }
  byte[] signature;
  try {
    ensureKeystoreOperationInitialized();
    byte[] additionalEntropy=KeyStoreCryptoOperationUtils.getRandomBytesToMixIntoKeystoreRng(appRandom,getAdditionalEntropyAmountForSign());
    signature=mMessageStreamer.doFinal(EmptyArray.BYTE,0,0,null,additionalEntropy);
  }
 catch (  InvalidKeyException|KeyStoreException e) {
    throw new SignatureException(e);
  }
  resetWhilePreservingInitState();
  return signature;
}
