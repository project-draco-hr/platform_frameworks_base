{
  if (mCachedException != null) {
    throw new SignatureException(mCachedException);
  }
  boolean result;
  try {
    ensureKeystoreOperationInitialized();
    mMessageStreamer.flush();
    OperationResult opResult=mKeyStore.finish(mOperationToken,null,signature);
    if (opResult == null) {
      throw new KeyStoreConnectException();
    }
switch (opResult.resultCode) {
case KeyStore.NO_ERROR:
      result=true;
    break;
case KeymasterDefs.KM_ERROR_VERIFICATION_FAILED:
  result=false;
break;
default :
throw new SignatureException(KeyStore.getKeyStoreException(opResult.resultCode));
}
}
 catch (InvalidKeyException|KeyStoreException e) {
throw new SignatureException(e);
}
resetWhilePreservingInitState();
return result;
}
