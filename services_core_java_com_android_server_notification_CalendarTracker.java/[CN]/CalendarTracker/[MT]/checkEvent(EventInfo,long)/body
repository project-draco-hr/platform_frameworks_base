{
  final Uri.Builder uriBuilder=Instances.CONTENT_URI.buildUpon();
  ContentUris.appendId(uriBuilder,time);
  ContentUris.appendId(uriBuilder,time + EVENT_CHECK_LOOKAHEAD);
  final Uri uri=uriBuilder.build();
  final Cursor cursor=mUserContext.getContentResolver().query(uri,INSTANCE_PROJECTION,null,null,INSTANCE_ORDER_BY);
  final CheckEventResult result=new CheckEventResult();
  result.recheckAt=time + EVENT_CHECK_LOOKAHEAD;
  try {
    final ArraySet<Long> primaryCalendars=getPrimaryCalendars();
    while (cursor != null && cursor.moveToNext()) {
      final long begin=cursor.getLong(0);
      final long end=cursor.getLong(1);
      final String title=cursor.getString(2);
      final boolean calendarVisible=cursor.getInt(3) == 1;
      final int eventId=cursor.getInt(4);
      final String name=cursor.getString(5);
      final String owner=cursor.getString(6);
      final long calendarId=cursor.getLong(7);
      final int availability=cursor.getInt(8);
      final boolean calendarPrimary=primaryCalendars.contains(calendarId);
      if (DEBUG)       Log.d(TAG,String.format("%s %s-%s v=%s a=%s eid=%s n=%s o=%s cid=%s p=%s",title,new Date(begin),new Date(end),calendarVisible,availabilityToString(availability),eventId,name,owner,calendarId,calendarPrimary));
      final boolean meetsTime=time >= begin && time < end;
      final boolean meetsCalendar=calendarVisible && calendarPrimary && (filter.calendar == null || Objects.equals(filter.calendar,owner) || Objects.equals(filter.calendar,name));
      final boolean meetsAvailability=availability != Instances.AVAILABILITY_FREE;
      if (meetsCalendar && meetsAvailability) {
        if (DEBUG)         Log.d(TAG,"  MEETS CALENDAR & AVAILABILITY");
        final boolean meetsAttendee=meetsAttendee(filter,eventId,owner);
        if (meetsAttendee) {
          if (DEBUG)           Log.d(TAG,"    MEETS ATTENDEE");
          if (meetsTime) {
            if (DEBUG)             Log.d(TAG,"      MEETS TIME");
            result.inEvent=true;
          }
          if (begin > time && begin < result.recheckAt) {
            result.recheckAt=begin;
          }
 else           if (end > time && end < result.recheckAt) {
            result.recheckAt=end;
          }
        }
      }
    }
  }
  finally {
    if (cursor != null) {
      cursor.close();
    }
  }
  return result;
}
