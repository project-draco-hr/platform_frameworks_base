{
  final int childCount=mAppWidgetContainer.getChildCount();
  boolean widgetPageExists=false;
  for (int i=0; i < childCount; i++) {
    if (mAppWidgetContainer.isWidgetPage(i)) {
      widgetPageExists=true;
      break;
    }
  }
  if (!widgetPageExists) {
    final int insertPageIndex=getInsertPageIndex();
    final boolean userAddedWidgetsEnabled=!widgetsDisabledByDpm();
    boolean addedDefaultAppWidget=false;
    if (!mSafeModeEnabled) {
      if (userAddedWidgetsEnabled) {
        int appWidgetId=allocateIdForDefaultAppWidget();
        if (appWidgetId != AppWidgetManager.INVALID_APPWIDGET_ID) {
          addedDefaultAppWidget=addWidget(appWidgetId,insertPageIndex,true);
        }
      }
 else {
        int appWidgetId=mLockPatternUtils.getFallbackAppWidgetId();
        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
          appWidgetId=allocateIdForDefaultAppWidget();
          if (appWidgetId != AppWidgetManager.INVALID_APPWIDGET_ID) {
            mLockPatternUtils.writeFallbackAppWidgetId(appWidgetId);
          }
        }
        if (appWidgetId != AppWidgetManager.INVALID_APPWIDGET_ID) {
          addedDefaultAppWidget=addWidget(appWidgetId,insertPageIndex,false);
          if (!addedDefaultAppWidget) {
            mAppWidgetHost.deleteAppWidgetId(appWidgetId);
            mLockPatternUtils.writeFallbackAppWidgetId(AppWidgetManager.INVALID_APPWIDGET_ID);
          }
        }
      }
    }
    if (!addedDefaultAppWidget) {
      addDefaultStatusWidget(insertPageIndex);
    }
    if (!mSafeModeEnabled && userAddedWidgetsEnabled) {
      mAppWidgetContainer.onAddView(mAppWidgetContainer.getChildAt(insertPageIndex),insertPageIndex);
    }
  }
}
