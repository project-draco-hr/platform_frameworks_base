{
  final KeyguardUpdateMonitor monitor=KeyguardUpdateMonitor.getInstance(mContext);
  final int failedAttempts=monitor.getFailedUnlockAttempts() + 1;
  if (DEBUG)   Log.d(TAG,"reportFailedPatternAttempt: #" + failedAttempts);
  SecurityMode mode=mSecurityModel.getSecurityMode();
  final boolean usingPattern=mode == KeyguardSecurityModel.SecurityMode.Pattern;
  final int failedAttemptsBeforeWipe=mLockPatternUtils.getDevicePolicyManager().getMaximumFailedPasswordsForWipe(null);
  final int failedAttemptWarning=LockPatternUtils.FAILED_ATTEMPTS_BEFORE_RESET - LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT;
  final int remainingBeforeWipe=failedAttemptsBeforeWipe > 0 ? (failedAttemptsBeforeWipe - failedAttempts) : Integer.MAX_VALUE;
  if (remainingBeforeWipe < LockPatternUtils.FAILED_ATTEMPTS_BEFORE_WIPE_GRACE) {
    if (remainingBeforeWipe > 0) {
      showAlmostAtWipeDialog(failedAttempts,remainingBeforeWipe);
    }
 else {
      Slog.i(TAG,"Too many unlock attempts; device will be wiped!");
      showWipeDialog(failedAttempts);
    }
  }
 else {
    boolean showTimeout=(failedAttempts % LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT) == 0;
    if (usingPattern && mEnableFallback) {
      if (failedAttempts == failedAttemptWarning) {
        showAlmostAtAccountLoginDialog();
        showTimeout=false;
      }
 else       if (failedAttempts >= LockPatternUtils.FAILED_ATTEMPTS_BEFORE_RESET) {
        mLockPatternUtils.setPermanentlyLocked(true);
        showSecurityScreen(SecurityMode.Account);
        showTimeout=false;
      }
    }
    if (showTimeout) {
      showTimeoutDialog();
    }
  }
  monitor.reportFailedUnlockAttempt();
  mLockPatternUtils.reportFailedPasswordAttempt();
}
