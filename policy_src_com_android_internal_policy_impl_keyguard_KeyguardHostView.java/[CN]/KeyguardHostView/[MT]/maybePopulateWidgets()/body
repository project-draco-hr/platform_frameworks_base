{
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  if (dpm != null) {
    final int currentUser=mLockPatternUtils.getCurrentUser();
    final int disabledFeatures=dpm.getKeyguardDisabledFeatures(null,currentUser);
    if ((disabledFeatures & DevicePolicyManager.KEYGUARD_DISABLE_WIDGETS_ALL) != 0) {
      Log.v(TAG,"Keyguard widgets disabled because of device policy admin");
      return;
    }
  }
  View addWidget=mAppWidgetContainer.findViewById(R.id.keyguard_add_widget);
  int addPageIndex=mAppWidgetContainer.indexOfChild(addWidget);
  if (addPageIndex < 0) {
    addPageIndex=0;
  }
  final int[] widgets=mLockPatternUtils.getUserDefinedWidgets();
  for (int i=widgets.length - 1; i >= 0; i--) {
    if (widgets[i] != -1) {
      addWidget(widgets[i],addPageIndex + 1);
    }
  }
}
