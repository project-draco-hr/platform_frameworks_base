{
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  if (dpm != null && dpm.getKeyguardWidgetsDisabled(null,mLockPatternUtils.getCurrentUser()) != DevicePolicyManager.KEYGUARD_DISABLE_WIDGETS_NONE) {
    Log.v(TAG,"Keyguard widgets disabled because of device policy admin");
    return;
  }
  inflateAndAddUserSelectorWidgetIfNecessary();
  int statusWidgetId=mLockPatternUtils.getStatusWidget();
  if (statusWidgetId != -1) {
    addWidget(statusWidgetId);
    View newStatusWidget=mAppWidgetContainer.getChildAt(mAppWidgetContainer.getChildCount() - 1);
    int oldStatusWidgetPosition=getWidgetPosition(R.id.keyguard_status_view);
    mAppWidgetContainer.removeViewAt(oldStatusWidgetPosition);
    mAppWidgetContainer.removeView(newStatusWidget);
    newStatusWidget.setId(R.id.keyguard_status_view);
    mAppWidgetContainer.addView(newStatusWidget,oldStatusWidgetPosition);
  }
  final int[] widgets=mLockPatternUtils.getUserDefinedWidgets();
  for (int i=0; i < widgets.length; i++) {
    if (widgets[i] != -1) {
      addWidget(widgets[i]);
    }
  }
}
