{
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  if (dpm != null) {
    final int currentUser=mLockPatternUtils.getCurrentUser();
    final int disabledFeatures=dpm.getKeyguardDisabledFeatures(null,currentUser);
    if ((disabledFeatures & DevicePolicyManager.KEYGUARD_DISABLE_WIDGETS_ALL) != 0) {
      Log.v(TAG,"Keyguard widgets disabled because of device policy admin");
      return;
    }
  }
  int statusWidgetId=mLockPatternUtils.getStatusWidget();
  if (statusWidgetId != -1) {
    addWidget(statusWidgetId);
    View newStatusWidget=mAppWidgetContainer.getChildAt(mAppWidgetContainer.getChildCount() - 1);
    int oldStatusWidgetPosition=getWidgetPosition(R.id.keyguard_status_view);
    mAppWidgetContainer.removeViewAt(oldStatusWidgetPosition);
    mAppWidgetContainer.removeView(newStatusWidget);
    newStatusWidget.setId(R.id.keyguard_status_view);
    mAppWidgetContainer.addView(newStatusWidget,oldStatusWidgetPosition);
  }
  final int[] widgets=mLockPatternUtils.getUserDefinedWidgets();
  System.out.println("Num widgets: " + widgets.length);
  for (int i=0; i < widgets.length; i++) {
    System.out.println("   widget: " + widgets[i]);
    if (widgets[i] != -1) {
      addWidget(widgets[i]);
    }
  }
}
