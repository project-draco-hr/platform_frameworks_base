{
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  if (dpm != null) {
    final int currentUser=mLockPatternUtils.getCurrentUser();
    final int disabledFeatures=dpm.getKeyguardDisabledFeatures(null,currentUser);
    if ((disabledFeatures & DevicePolicyManager.KEYGUARD_DISABLE_WIDGETS_ALL) != 0) {
      Log.v(TAG,"Keyguard widgets disabled because of device policy admin");
      return;
    }
  }
  inflateAndAddUserSelectorWidgetIfNecessary();
  final int[] widgets=mLockPatternUtils.getUserDefinedWidgets();
  for (int i=0; i < widgets.length; i++) {
    if (widgets[i] != -1) {
      addWidget(widgets[i]);
    }
  }
}
