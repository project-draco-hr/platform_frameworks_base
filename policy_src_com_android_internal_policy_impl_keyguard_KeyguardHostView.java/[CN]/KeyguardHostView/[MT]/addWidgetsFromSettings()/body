{
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  if (dpm != null) {
    final int currentUser=mLockPatternUtils.getCurrentUser();
    final int disabledFeatures=dpm.getKeyguardDisabledFeatures(null,currentUser);
    if ((disabledFeatures & DevicePolicyManager.KEYGUARD_DISABLE_WIDGETS_ALL) != 0) {
      Log.v(TAG,"Keyguard widgets disabled because of device policy admin");
      return;
    }
  }
  int addPageIndex=getAddPageIndex();
  final int[] widgets=mLockPatternUtils.getAppWidgets();
  if (widgets == null) {
    Log.d(TAG,"Problem reading widgets");
  }
 else {
    for (int i=widgets.length - 1; i >= 0; i--) {
      if (widgets[i] == LockPatternUtils.ID_DEFAULT_STATUS_WIDGET) {
        addDefaultStatusWidget(addPageIndex + 1);
      }
 else {
        addWidget(widgets[i],addPageIndex + 1);
      }
    }
  }
  checkAppWidgetConsistency();
}
