{
  BatteryTracker tracker=mDemoMode ? mDemoTracker : mTracker;
  final int level=tracker.level;
  float drawFrac=(float)level / 100f;
  final int pt=getPaddingTop();
  final int pl=getPaddingLeft();
  final int pr=getPaddingRight();
  final int pb=getPaddingBottom();
  int height=mHeight - pt - pb;
  int width=mWidth - pl - pr;
  mButtonHeight=(int)(height * 0.12f);
  mFrame.set(0,0,width,height);
  mFrame.offset(pl,pt);
  mButtonFrame.set(mFrame.left + width * 0.25f,mFrame.top,mFrame.right - width * 0.25f,mFrame.top + mButtonHeight + 5);
  mButtonFrame.top+=SUBPIXEL;
  mButtonFrame.left+=SUBPIXEL;
  mButtonFrame.right-=SUBPIXEL;
  mFrame.top+=mButtonHeight;
  mFrame.left+=SUBPIXEL;
  mFrame.top+=SUBPIXEL;
  mFrame.right-=SUBPIXEL;
  mFrame.bottom-=SUBPIXEL;
  c.drawRect(mFrame,mFramePaint);
  final int color=tracker.plugged ? mChargeColor : getColorForLevel(level);
  mBatteryPaint.setColor(color);
  if (level >= FULL) {
    drawFrac=1f;
  }
 else   if (level <= EMPTY) {
    drawFrac=0f;
  }
  c.drawRect(mButtonFrame,drawFrac == 1f ? mBatteryPaint : mFramePaint);
  mClipFrame.set(mFrame);
  mClipFrame.top+=(mFrame.height() * (1f - drawFrac));
  c.save(Canvas.CLIP_SAVE_FLAG);
  c.clipRect(mClipFrame);
  c.drawRect(mFrame,mBatteryPaint);
  c.restore();
  if (tracker.plugged) {
    final int bl=(int)(mFrame.left + mFrame.width() / 4.5f);
    final int bt=(int)(mFrame.top + mFrame.height() / 6f);
    final int br=(int)(mFrame.right - mFrame.width() / 7f);
    final int bb=(int)(mFrame.bottom - mFrame.height() / 10f);
    if (mBoltFrame.left != bl || mBoltFrame.top != bt || mBoltFrame.right != br || mBoltFrame.bottom != bb) {
      mBoltFrame.set(bl,bt,br,bb);
      mBoltPath.reset();
      mBoltPath.moveTo(mBoltFrame.left + mBoltPoints[0] * mBoltFrame.width(),mBoltFrame.top + mBoltPoints[1] * mBoltFrame.height());
      for (int i=2; i < mBoltPoints.length; i+=2) {
        mBoltPath.lineTo(mBoltFrame.left + mBoltPoints[i] * mBoltFrame.width(),mBoltFrame.top + mBoltPoints[i + 1] * mBoltFrame.height());
      }
      mBoltPath.lineTo(mBoltFrame.left + mBoltPoints[0] * mBoltFrame.width(),mBoltFrame.top + mBoltPoints[1] * mBoltFrame.height());
    }
    c.drawPath(mBoltPath,mBoltPaint);
  }
 else   if (level <= EMPTY) {
    final float x=mWidth * 0.5f;
    final float y=(mHeight + mWarningTextHeight) * 0.48f;
    c.drawText(mWarningString,x,y,mWarningTextPaint);
  }
 else   if (mShowPercent && !(tracker.level == 100 && !SHOW_100_PERCENT)) {
    mTextPaint.setTextSize(height * (SINGLE_DIGIT_PERCENT ? 0.75f : (tracker.level == 100 ? 0.38f : 0.5f)));
    mTextHeight=-mTextPaint.getFontMetrics().ascent;
    final String str=String.valueOf(SINGLE_DIGIT_PERCENT ? (level / 10) : level);
    final float x=mWidth * 0.5f;
    final float y=(mHeight + mTextHeight) * 0.47f;
    c.drawText(str,x,y,mTextPaint);
  }
}
