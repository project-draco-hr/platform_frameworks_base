{
  final ShortcutPackage packageShortcuts=s.getPackageShortcutsLocked(packageName,packageUserId);
  final PackageWithUser pu=PackageWithUser.of(packageUserId,packageName);
  final int idSize=ids.size();
  if (idSize == 0) {
    mPinnedShortcuts.remove(pu);
  }
 else {
    final ArraySet<String> prevSet=mPinnedShortcuts.get(pu);
    final ArraySet<String> newSet=new ArraySet<>();
    for (int i=0; i < idSize; i++) {
      final String id=ids.get(i);
      final ShortcutInfo si=packageShortcuts.findShortcutById(id);
      if (si == null) {
        continue;
      }
      if (si.isDynamic() || (prevSet != null && prevSet.contains(id))) {
        newSet.add(id);
      }
    }
    mPinnedShortcuts.put(pu,newSet);
  }
  packageShortcuts.refreshPinnedFlags(s);
}
