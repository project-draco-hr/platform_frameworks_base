{
  final String profileName="whatever";
  final VpnState state=VpnState.DISCONNECTING;
  final ConditionVariable cv=new ConditionVariable();
  cv.close();
  BroadcastReceiver r=new BroadcastReceiver(){
    public void onReceive(    Context c,    Intent i){
      assertEquals(profileName,i.getStringExtra(VpnManager.BROADCAST_PROFILE_NAME));
      assertEquals(state,i.getSerializableExtra(VpnManager.BROADCAST_CONNECTION_STATE));
      cv.open();
    }
  }
;
  VpnManager m=new VpnManager(getContext());
  m.registerConnectivityReceiver(r);
  m.broadcastConnectivity(profileName,state);
  assertTrue(cv.block(5000));
}
