{
  if (mFpWakeMode == FP_WAKE_TO_BOUNCER || mFpWakeMode == FP_WAKE_DIRECT_UNLOCK || mFpWakeMode == FP_ONLY_WAKE) {
    if (DEBUG_FP_WAKELOCK) {
      Log.i(TAG,"fp wakelock: Authenticated, waking up...");
    }
    mPowerManager.wakeUp(SystemClock.uptimeMillis());
  }
  releaseFingerprintWakeLock();
  try {
    final int userId;
    try {
      userId=ActivityManagerNative.getDefault().getCurrentUser().id;
    }
 catch (    RemoteException e) {
      Log.e(TAG,"Failed to get current user id: ",e);
      return;
    }
    if (isFingerprintDisabled(userId)) {
      Log.d(TAG,"Fingerprint disabled by DPM for userId: " + userId);
      return;
    }
    onFingerprintAuthenticated(userId,mFpWakeMode == FP_WAKE_DIRECT_UNLOCK);
  }
  finally {
    setFingerprintRunningDetectionRunning(false);
  }
}
