{
  mContext=context;
  mDeviceProvisioned=isDeviceProvisionedInSettingsDb();
  if (!mDeviceProvisioned) {
    watchForDeviceProvisioning();
  }
  mSimState=IccCardConstants.State.NOT_READY;
  mBatteryStatus=new BatteryStatus(BATTERY_STATUS_UNKNOWN,100,0,0);
  mTelephonyPlmn=getDefaultPlmn();
  final IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_TIME_TICK);
  filter.addAction(Intent.ACTION_TIME_CHANGED);
  filter.addAction(Intent.ACTION_BATTERY_CHANGED);
  filter.addAction(Intent.ACTION_TIMEZONE_CHANGED);
  filter.addAction(TelephonyIntents.ACTION_SIM_STATE_CHANGED);
  filter.addAction(TelephonyManager.ACTION_PHONE_STATE_CHANGED);
  filter.addAction(TelephonyIntents.SPN_STRINGS_UPDATED_ACTION);
  filter.addAction(AudioManager.RINGER_MODE_CHANGED_ACTION);
  filter.addAction(DevicePolicyManager.ACTION_DEVICE_POLICY_MANAGER_STATE_CHANGED);
  filter.addAction(Intent.ACTION_USER_REMOVED);
  context.registerReceiver(mBroadcastReceiver,filter);
  final IntentFilter nfcUnlockIntentFilter=new IntentFilter();
  nfcUnlockIntentFilter.addAction(NfcUnlock.ACTION_NFC_UNLOCK);
  context.registerReceiver(mNfcUnlockReceiver,nfcUnlockIntentFilter,NfcUnlock.NFC_UNLOCK_PERMISSION,null);
  final IntentFilter bootCompleteFilter=new IntentFilter();
  bootCompleteFilter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
  bootCompleteFilter.addAction(Intent.ACTION_BOOT_COMPLETED);
  context.registerReceiver(mBroadcastReceiver,bootCompleteFilter);
  final IntentFilter userInfoFilter=new IntentFilter(Intent.ACTION_USER_INFO_CHANGED);
  context.registerReceiverAsUser(mBroadcastAllReceiver,UserHandle.ALL,userInfoFilter,null,null);
  try {
    ActivityManagerNative.getDefault().registerUserSwitchObserver(new IUserSwitchObserver.Stub(){
      @Override public void onUserSwitching(      int newUserId,      IRemoteCallback reply){
        mHandler.sendMessage(mHandler.obtainMessage(MSG_USER_SWITCHING,newUserId,0,reply));
        mSwitchingUser=true;
      }
      @Override public void onUserSwitchComplete(      int newUserId) throws RemoteException {
        mHandler.sendMessage(mHandler.obtainMessage(MSG_USER_SWITCH_COMPLETE,newUserId));
        mSwitchingUser=false;
      }
    }
);
  }
 catch (  RemoteException e) {
    e.printStackTrace();
  }
  TrustManager trustManager=(TrustManager)context.getSystemService(Context.TRUST_SERVICE);
  trustManager.registerTrustListener(this);
}
