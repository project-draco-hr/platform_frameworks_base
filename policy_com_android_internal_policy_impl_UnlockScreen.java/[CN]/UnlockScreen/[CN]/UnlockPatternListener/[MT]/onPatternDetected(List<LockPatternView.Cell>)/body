{
  if (mLockPatternUtils.checkPattern(pattern)) {
    mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Correct);
    mUnlockIcon.setVisibility(View.GONE);
    mUnlockHeader.setText(R.string.lockscreen_pattern_correct);
    mCallback.keyguardDone(true);
  }
 else {
    mCallback.pokeWakelock(UNLOCK_PATTERN_WAKE_INTERVAL_MS);
    mLockPatternView.setDisplayMode(LockPatternView.DisplayMode.Wrong);
    if (pattern.size() >= LockPatternUtils.MIN_PATTERN_REGISTER_FAIL) {
      mTotalFailedPatternAttempts++;
      mFailedPatternAttemptsSinceLastTimeout++;
      mCallback.reportFailedPatternAttempt();
    }
    if (mFailedPatternAttemptsSinceLastTimeout >= LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT) {
      long deadline=SystemClock.elapsedRealtime() + LockPatternUtils.FAILED_ATTEMPT_TIMEOUT_MS;
      mLockPatternUtils.setLockoutAttemptDeadline(deadline);
      handleAttemptLockout(deadline);
      return;
    }
    mUnlockIcon.setVisibility(View.VISIBLE);
    mUnlockHeader.setText(R.string.lockscreen_pattern_wrong);
    mLockPatternView.postDelayed(mCancelPatternRunnable,PATTERN_CLEAR_TIMEOUT_MS);
  }
}
