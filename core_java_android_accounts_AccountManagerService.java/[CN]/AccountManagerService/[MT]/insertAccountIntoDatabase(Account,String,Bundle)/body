{
  SQLiteDatabase db=mOpenHelper.getWritableDatabase();
  db.beginTransaction();
  try {
    if (account == null) {
      return false;
    }
    boolean noBroadcast=false;
    if (account.type.equals(GOOGLE_ACCOUNT_TYPE)) {
      noBroadcast=extras.getBoolean(NO_BROADCAST_FLAG,false);
      extras.remove(NO_BROADCAST_FLAG);
    }
    long numMatches=DatabaseUtils.longForQuery(db,"select count(*) from " + TABLE_ACCOUNTS + " WHERE "+ ACCOUNTS_NAME+ "=? AND "+ ACCOUNTS_TYPE+ "=?",new String[]{account.name,account.type});
    if (numMatches > 0) {
      return false;
    }
    ContentValues values=new ContentValues();
    values.put(ACCOUNTS_NAME,account.name);
    values.put(ACCOUNTS_TYPE,account.type);
    values.put(ACCOUNTS_PASSWORD,password);
    long accountId=db.insert(TABLE_ACCOUNTS,ACCOUNTS_NAME,values);
    if (accountId < 0) {
      return false;
    }
    if (extras != null) {
      for (      String key : extras.keySet()) {
        final String value=extras.getString(key);
        if (insertExtra(db,accountId,key,value) < 0) {
          return false;
        }
      }
    }
    db.setTransactionSuccessful();
    if (!noBroadcast) {
      sendAccountsChangedBroadcast();
    }
    return true;
  }
  finally {
    db.endTransaction();
  }
}
