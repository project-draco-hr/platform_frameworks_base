{
  checkReadAccountsPermission();
  long identityToken=clearCallingIdentity();
  try {
    SQLiteDatabase db=mOpenHelper.getReadableDatabase();
    final String selection=accountType == null ? null : (ACCOUNTS_TYPE + "=?");
    final String[] selectionArgs=accountType == null ? null : new String[]{accountType};
    Cursor cursor=db.query(TABLE_ACCOUNTS,ACCOUNT_NAME_TYPE_PROJECTION,selection,selectionArgs,null,null,null);
    try {
      int i=0;
      Account[] accounts=new Account[cursor.getCount()];
      while (cursor.moveToNext()) {
        accounts[i]=new Account(cursor.getString(1),cursor.getString(2));
        i++;
      }
      return accounts;
    }
  finally {
      cursor.close();
    }
  }
  finally {
    restoreCallingIdentity(identityToken);
  }
}
