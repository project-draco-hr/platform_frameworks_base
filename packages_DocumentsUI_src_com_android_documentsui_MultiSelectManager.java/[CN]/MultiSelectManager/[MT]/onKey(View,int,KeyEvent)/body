{
  if (event.getAction() != KeyEvent.ACTION_DOWN) {
    return false;
  }
  int target=RecyclerView.NO_POSITION;
  if (keyCode == KeyEvent.KEYCODE_MOVE_HOME) {
    target=0;
  }
 else   if (keyCode == KeyEvent.KEYCODE_MOVE_END) {
    target=mAdapter.getItemCount() - 1;
  }
 else {
    int searchDir=-1;
switch (keyCode) {
case KeyEvent.KEYCODE_DPAD_UP:
      searchDir=View.FOCUS_UP;
    break;
case KeyEvent.KEYCODE_DPAD_DOWN:
  searchDir=View.FOCUS_DOWN;
break;
case KeyEvent.KEYCODE_DPAD_LEFT:
searchDir=View.FOCUS_LEFT;
break;
case KeyEvent.KEYCODE_DPAD_RIGHT:
searchDir=View.FOCUS_RIGHT;
break;
}
if (searchDir != -1) {
View targetView=view.focusSearch(searchDir);
target=mEnvironment.getAdapterPositionForChildView(targetView);
}
}
if (target == RecyclerView.NO_POSITION) {
return false;
}
mEnvironment.focusItem(target);
if (event.isShiftPressed()) {
if (mSelection.isEmpty()) {
toggleSelection(mEnvironment.getAdapterPositionForChildView(view));
}
 else {
target-=Integer.signum(target - mRanger.mBegin);
mRanger.snapSelection(target);
}
}
 else if (!event.isShiftPressed() && !mSelection.isEmpty()) {
clearSelection();
}
return true;
}
