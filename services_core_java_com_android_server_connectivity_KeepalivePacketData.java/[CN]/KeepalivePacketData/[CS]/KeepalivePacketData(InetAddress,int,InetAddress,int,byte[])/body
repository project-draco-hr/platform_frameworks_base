{
  this.srcAddress=srcAddress;
  this.dstAddress=dstAddress;
  this.srcPort=srcPort;
  this.dstPort=dstPort;
  this.data=data;
  if (srcAddress == null || dstAddress == null || !srcAddress.getClass().getName().equals(dstAddress.getClass().getName())) {
    throw new InvalidPacketException(ERROR_INVALID_IP_ADDRESS);
  }
  if (this.dstAddress instanceof Inet4Address) {
    this.protocol=OsConstants.ETH_P_IP;
  }
 else   if (this.dstAddress instanceof Inet6Address) {
    this.protocol=OsConstants.ETH_P_IPV6;
  }
 else {
    throw new InvalidPacketException(ERROR_INVALID_IP_ADDRESS);
  }
  if (!IpUtils.isValidUdpOrTcpPort(srcPort) || !IpUtils.isValidUdpOrTcpPort(dstPort)) {
    throw new InvalidPacketException(ERROR_INVALID_PORT);
  }
}
