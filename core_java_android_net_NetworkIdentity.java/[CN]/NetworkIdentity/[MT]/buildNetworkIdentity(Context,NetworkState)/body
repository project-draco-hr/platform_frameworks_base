{
  final int type=state.networkInfo.getType();
  final int subType=state.networkInfo.getSubtype();
  final String subscriberId;
  final boolean roaming;
  if (isNetworkTypeMobile(type)) {
    final TelephonyManager telephony=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
    roaming=telephony.isNetworkRoaming();
    if (state.subscriberId != null) {
      subscriberId=state.subscriberId;
    }
 else {
      subscriberId=telephony.getSubscriberId();
    }
  }
 else {
    subscriberId=null;
    roaming=false;
  }
  return new NetworkIdentity(type,subType,subscriberId,roaming);
}
