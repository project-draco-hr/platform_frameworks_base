{
  final int type=state.networkInfo.getType();
  final int subType=state.networkInfo.getSubtype();
  final String subscriberId;
  if (isNetworkTypeMobile(type)) {
    if (state.subscriberId != null) {
      subscriberId=state.subscriberId;
    }
 else {
      final TelephonyManager telephony=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
      subscriberId=telephony.getSubscriberId();
    }
  }
 else {
    subscriberId=null;
  }
  return new NetworkIdentity(type,subType,subscriberId);
}
