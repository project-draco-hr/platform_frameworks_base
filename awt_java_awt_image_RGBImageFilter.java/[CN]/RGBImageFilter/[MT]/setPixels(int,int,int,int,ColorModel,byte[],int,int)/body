{
  if (model == null || model == origmodel) {
    consumer.setPixels(x,y,w,h,newmodel,pixels,off,scansize);
  }
 else {
    int rgbPixels[]=new int[w];
    for (int sy=y, pixelsOff=off; sy < y + h; sy++, pixelsOff+=scansize) {
      for (int sx=x, idx=0; sx < x + w; sx++, idx++) {
        rgbPixels[idx]=model.getRGB(pixels[pixelsOff + idx] & 0xff);
      }
      filterRGBPixels(x,sy,w,1,rgbPixels,0,w);
    }
  }
}
