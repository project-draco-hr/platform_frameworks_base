{
  String action=intent.getAction();
  if (action.equals(ALARM_INTENT)) {
synchronized (mLocationListeners) {
      log("PowerStateBroadcastReceiver: Alarm received");
      mLocationHandler.removeMessages(MESSAGE_ACQUIRE_WAKE_LOCK);
      acquireWakeLockLocked();
    }
  }
 else   if (action.equals(Intent.ACTION_SCREEN_OFF)) {
    log("PowerStateBroadcastReceiver: Screen off");
synchronized (mLocationListeners) {
      updateWakelockStatusLocked(false);
    }
  }
 else   if (action.equals(Intent.ACTION_SCREEN_ON)) {
    log("PowerStateBroadcastReceiver: Screen on");
synchronized (mLocationListeners) {
      updateWakelockStatusLocked(true);
    }
  }
 else   if (action.equals(Intent.ACTION_BATTERY_CHANGED)) {
    log("PowerStateBroadcastReceiver: Battery changed");
synchronized (mLocationListeners) {
      int scale=intent.getIntExtra(BATTERY_EXTRA_SCALE,100);
      int level=intent.getIntExtra(BATTERY_EXTRA_LEVEL,0);
      boolean plugged=intent.getIntExtra(BATTERY_EXTRA_PLUGGED,0) != 0;
      if (mCollector != null) {
        mCollector.updateBatteryState(scale,level,plugged);
      }
    }
  }
 else   if (action.equals(Intent.ACTION_PACKAGE_REMOVED) || action.equals(Intent.ACTION_PACKAGE_RESTARTED)) {
synchronized (mLocationListeners) {
      int uid=intent.getIntExtra(Intent.EXTRA_UID,-1);
      if (uid >= 0) {
        ArrayList<Receiver> removedRecs=null;
        for (        ArrayList<UpdateRecord> i : mRecordsByProvider.values()) {
          for (int j=i.size() - 1; j >= 0; j--) {
            UpdateRecord ur=i.get(j);
            if (ur.mReceiver.isPendingIntent() && ur.mUid == uid) {
              if (removedRecs == null) {
                removedRecs=new ArrayList<Receiver>();
              }
              if (!removedRecs.contains(ur.mReceiver)) {
                removedRecs.add(ur.mReceiver);
              }
            }
          }
        }
        ArrayList<ProximityAlert> removedAlerts=null;
        for (        ProximityAlert i : mProximityAlerts.values()) {
          if (i.mUid == uid) {
            if (removedAlerts == null) {
              removedAlerts=new ArrayList<ProximityAlert>();
            }
            if (!removedAlerts.contains(i)) {
              removedAlerts.add(i);
            }
          }
        }
        if (removedRecs != null) {
          for (int i=removedRecs.size() - 1; i >= 0; i--) {
            removeUpdatesLocked(removedRecs.get(i));
          }
        }
        if (removedAlerts != null) {
          for (int i=removedAlerts.size() - 1; i >= 0; i--) {
            removeProximityAlertLocked(removedAlerts.get(i).mIntent);
          }
        }
      }
    }
  }
}
