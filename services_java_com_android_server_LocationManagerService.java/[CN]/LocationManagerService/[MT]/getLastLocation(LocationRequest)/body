{
  if (D)   Log.d(TAG,"getLastLocation: " + request);
  if (request == null)   request=DEFAULT_LOCATION_REQUEST;
  String perm=checkPermissionAndRequest(request);
synchronized (mLock) {
    String name=request.getProvider();
    if (name == null)     name=LocationManager.FUSED_PROVIDER;
    LocationProviderInterface provider=mProvidersByName.get(name);
    if (provider == null)     return null;
    if (!isAllowedBySettingsLocked(name))     return null;
    Location location=mLastLocation.get(name);
    if (ACCESS_FINE_LOCATION.equals(perm)) {
      return location;
    }
 else {
      return mLocationFudger.getOrCreate(location);
    }
  }
}
