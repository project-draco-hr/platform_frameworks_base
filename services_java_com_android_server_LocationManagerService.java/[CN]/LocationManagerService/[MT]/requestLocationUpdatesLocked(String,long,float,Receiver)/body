{
  if (LOCAL_LOGV) {
    Log.v(TAG,"_requestLocationUpdates: listener = " + receiver);
  }
  LocationProviderProxy proxy=mProvidersByName.get(provider);
  if (proxy == null) {
    throw new IllegalArgumentException("provider=" + provider);
  }
  checkPermissionsSafe(provider);
  final int callingUid=Binder.getCallingUid();
  boolean newUid=!providerHasListener(provider,callingUid,null);
  long identity=Binder.clearCallingIdentity();
  try {
    UpdateRecord r=new UpdateRecord(provider,minTime,minDistance,receiver,callingUid);
    UpdateRecord oldRecord=receiver.mUpdateRecords.put(provider,r);
    if (oldRecord != null) {
      oldRecord.disposeLocked();
    }
    if (newUid) {
      proxy.addListener(callingUid);
    }
    boolean isProviderEnabled=isAllowedBySettingsLocked(provider);
    if (isProviderEnabled) {
      long minTimeForProvider=getMinTimeLocked(provider);
      proxy.setMinTime(minTimeForProvider);
      proxy.enableLocationTracking(true);
      updateWakelockStatusLocked();
    }
 else {
      receiver.callProviderEnabledLocked(provider,false);
    }
  }
  finally {
    Binder.restoreCallingIdentity(identity);
  }
}
