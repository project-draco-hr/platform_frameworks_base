{
  if (LocationManager.GPS_PROVIDER.equals(provider) || LocationManager.PASSIVE_PROVIDER.equals(provider)) {
    if (mContext.checkCallingOrSelfPermission(ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
      throw new SecurityException("Provider " + provider + " requires ACCESS_FINE_LOCATION permission");
    }
    return ACCESS_FINE_LOCATION;
  }
  if (mContext.checkCallingOrSelfPermission(ACCESS_COARSE_LOCATION) == PackageManager.PERMISSION_GRANTED) {
    return ACCESS_FINE_LOCATION.equals(lastPermission) ? lastPermission : ACCESS_COARSE_LOCATION;
  }
  if (mContext.checkCallingOrSelfPermission(ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {
    return ACCESS_FINE_LOCATION;
  }
  throw new SecurityException("Provider " + provider + " requires ACCESS_FINE_LOCATION or ACCESS_COARSE_LOCATION permission");
}
