{
  checkPermissionsSafe(provider);
  LocationProviderProxy p=mProvidersByName.get(provider);
  if (p == null) {
    throw new IllegalArgumentException("provider=" + provider);
  }
  if (!isAllowedBySettingsLocked(provider)) {
    return null;
  }
  Location location=mLastKnownLocation.get(provider);
  if (location == null) {
    location=readLastKnownLocationLocked(provider);
    if (location != null) {
      mLastKnownLocation.put(provider,location);
    }
  }
  return location;
}
