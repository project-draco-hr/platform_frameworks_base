{
  WifiManager.WifiLock wifiLock=getWifiWakelockLocked();
  if (wifiLock != null) {
    if (mWifiWakeLockAcquired) {
      wifiLock.release();
      mWifiWakeLockAcquired=false;
    }
  }
  if (!mScreenOn) {
    stopGpsLocked();
  }
  if (mCellWakeLockAcquired) {
    mTelephonyManager.disableLocationUpdates();
    mCellWakeLockAcquired=false;
  }
  if (mNetworkLocationProvider != null) {
    mNetworkLocationProvider.updateCellLockStatus(mCellWakeLockAcquired);
  }
  mWakeLockAcquireTime=0;
  if (mWakeLock.isHeld()) {
    log("Released wakelock");
    mWakeLock.release();
  }
 else {
    log("Can't release wakelock again!");
  }
}
