{
  if (LOCAL_LOGV) {
    Log.v(TAG,"addProximityAlert: latitude = " + latitude + ", longitude = "+ longitude+ ", expiration = "+ expiration+ ", intent = "+ intent);
  }
  if (!isAllowedProviderSafe(LocationManager.GPS_PROVIDER) || !isAllowedProviderSafe(LocationManager.NETWORK_PROVIDER)) {
    throw new SecurityException("Requires ACCESS_FINE_LOCATION permission");
  }
  if (expiration != -1) {
    expiration+=System.currentTimeMillis();
  }
  ProximityAlert alert=new ProximityAlert(Binder.getCallingUid(),latitude,longitude,radius,expiration,intent);
  mProximityAlerts.put(intent,alert);
  if (mProximityReceiver == null) {
    mProximityListener=new ProximityListener();
    mProximityReceiver=new Receiver(mProximityListener);
    LocationProvider provider=LocationProviderImpl.getProvider(LocationManager.GPS_PROVIDER);
    if (provider != null) {
      requestLocationUpdatesLocked(provider.getName(),1000L,1.0f,mProximityReceiver);
    }
    provider=LocationProviderImpl.getProvider(LocationManager.NETWORK_PROVIDER);
    if (provider != null) {
      requestLocationUpdatesLocked(provider.getName(),1000L,1.0f,mProximityReceiver);
    }
  }
}
