{
  int listeners=0;
  LocationProviderInterface p=mProvidersByName.get(provider);
  if (p == null)   return;
  ArrayList<Receiver> deadReceivers=null;
  ArrayList<UpdateRecord> records=mRecordsByProvider.get(provider);
  if (records != null) {
    final int N=records.size();
    for (int i=0; i < N; i++) {
      UpdateRecord record=records.get(i);
      if (UserHandle.getUserId(record.mReceiver.mUid) == userId) {
        if (!record.mReceiver.callProviderEnabledLocked(provider,enabled)) {
          if (deadReceivers == null) {
            deadReceivers=new ArrayList<Receiver>();
          }
          deadReceivers.add(record.mReceiver);
        }
        listeners++;
      }
    }
  }
  if (deadReceivers != null) {
    for (int i=deadReceivers.size() - 1; i >= 0; i--) {
      removeUpdatesLocked(deadReceivers.get(i));
    }
  }
  if (enabled) {
    p.enable();
    if (listeners > 0) {
      applyRequirementsLocked(provider);
    }
  }
 else {
    p.disable();
  }
}
