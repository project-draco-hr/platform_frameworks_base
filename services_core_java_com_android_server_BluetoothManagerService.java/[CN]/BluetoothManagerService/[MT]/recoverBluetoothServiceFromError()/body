{
  Log.e(TAG,"recoverBluetoothServiceFromError");
  try {
    mBluetoothLock.readLock().lock();
    if (mBluetooth != null) {
      mBluetooth.unregisterCallback(mBluetoothCallback);
    }
  }
 catch (  RemoteException re) {
    Log.e(TAG,"Unable to unregister",re);
  }
 finally {
    mBluetoothLock.readLock().unlock();
  }
  SystemClock.sleep(500);
  handleDisable();
  waitForOnOff(false,true);
  sendBluetoothServiceDownCallback();
  mBluetoothLock.writeLock().lock();
  if (mBluetooth != null) {
    mBluetooth=null;
    mContext.unbindService(mConnection);
  }
  mBluetoothGatt=null;
  mBluetoothLock.writeLock().unlock();
  mHandler.removeMessages(MESSAGE_BLUETOOTH_STATE_CHANGE);
  mState=BluetoothAdapter.STATE_OFF;
  mEnable=false;
  if (mErrorRecoveryRetryCounter++ < MAX_ERROR_RESTART_RETRIES) {
    Message restartMsg=mHandler.obtainMessage(MESSAGE_RESTART_BLUETOOTH_SERVICE);
    mHandler.sendMessageDelayed(restartMsg,ERROR_RESTART_TIME_MS);
  }
 else {
  }
}
