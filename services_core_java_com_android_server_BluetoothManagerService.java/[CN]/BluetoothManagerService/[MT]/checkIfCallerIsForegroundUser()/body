{
  int foregroundUser;
  int callingUser=UserHandle.getCallingUserId();
  int callingUid=Binder.getCallingUid();
  long callingIdentity=Binder.clearCallingIdentity();
  int callingAppId=UserHandle.getAppId(callingUid);
  boolean valid=false;
  try {
    foregroundUser=ActivityManager.getCurrentUser();
    valid=(callingUser == foregroundUser) || callingAppId == Process.NFC_UID;
    if (DBG) {
      Log.d(TAG,"checkIfCallerIsForegroundUser: valid=" + valid + " callingUser="+ callingUser+ " foregroundUser="+ foregroundUser);
    }
  }
  finally {
    Binder.restoreCallingIdentity(callingIdentity);
  }
  return valid;
}
