{
  String expirationDate=parser.getAttributeValue(null,"expiration");
  long expirationTimestampMilis=Long.MAX_VALUE;
  if (expirationDate != null) {
    try {
      SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd");
      sdf.setLenient(false);
      Date date=sdf.parse(expirationDate);
      if (date == null) {
        throw new ParserException(parser,"Invalid expiration date in pin-set");
      }
      expirationTimestampMilis=date.getTime();
    }
 catch (    ParseException e) {
      throw new ParserException(parser,"Invalid expiration date in pin-set",e);
    }
  }
  int outerDepth=parser.getDepth();
  Set<Pin> pins=new ArraySet<>();
  while (XmlUtils.nextElementWithin(parser,outerDepth)) {
    String tagName=parser.getName();
    if (tagName.equals("pin")) {
      pins.add(parsePin(parser));
    }
 else {
      XmlUtils.skipCurrentTag(parser);
    }
  }
  return new PinSet(pins,expirationTimestampMilis);
}
