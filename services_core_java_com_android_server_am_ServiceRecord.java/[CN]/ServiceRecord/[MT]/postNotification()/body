{
  final int appUid=appInfo.uid;
  final int appPid=app.pid;
  if (foregroundId != 0 && foregroundNoti != null) {
    final String localPackageName=packageName;
    final int localForegroundId=foregroundId;
    final Notification _foregroundNoti=foregroundNoti;
    ams.mHandler.post(new Runnable(){
      public void run(){
        NotificationManagerInternal nm=LocalServices.getService(NotificationManagerInternal.class);
        if (nm == null) {
          return;
        }
        Notification localForegroundNoti=_foregroundNoti;
        try {
          if (localForegroundNoti.getSmallIcon() == null) {
            Slog.v(TAG,"Attempted to start a foreground service (" + name + ") with a broken notification (no icon: "+ localForegroundNoti+ ")");
            CharSequence appName=appInfo.loadLabel(ams.mContext.getPackageManager());
            if (appName == null) {
              appName=appInfo.packageName;
            }
            Context ctx=null;
            try {
              ctx=ams.mContext.createPackageContextAsUser(appInfo.packageName,0,new UserHandle(userId));
              Notification.Builder notiBuilder=new Notification.Builder(ctx);
              notiBuilder.setSmallIcon(appInfo.icon);
              notiBuilder.setFlag(Notification.FLAG_FOREGROUND_SERVICE,true);
              notiBuilder.setPriority(Notification.PRIORITY_MIN);
              Intent runningIntent=new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
              runningIntent.setData(Uri.fromParts("package",appInfo.packageName,null));
              PendingIntent pi=PendingIntent.getActivity(ams.mContext,0,runningIntent,PendingIntent.FLAG_UPDATE_CURRENT);
              notiBuilder.setColor(ams.mContext.getColor(com.android.internal.R.color.system_notification_accent_color));
              notiBuilder.setContentTitle(ams.mContext.getString(com.android.internal.R.string.app_running_notification_title,appName));
              notiBuilder.setContentText(ams.mContext.getString(com.android.internal.R.string.app_running_notification_text,appName));
              notiBuilder.setContentIntent(pi);
              localForegroundNoti=notiBuilder.build();
            }
 catch (            PackageManager.NameNotFoundException e) {
            }
          }
          if (localForegroundNoti.getSmallIcon() == null) {
            throw new RuntimeException("invalid service notification: " + foregroundNoti);
          }
          int[] outId=new int[1];
          nm.enqueueNotification(localPackageName,localPackageName,appUid,appPid,null,localForegroundId,localForegroundNoti,outId,userId);
          foregroundNoti=localForegroundNoti;
        }
 catch (        RuntimeException e) {
          Slog.w(TAG,"Error showing notification for service",e);
          ams.setServiceForeground(name,ServiceRecord.this,0,null,0);
          ams.crashApplication(appUid,appPid,localPackageName,"Bad notification for startForeground: " + e);
        }
      }
    }
);
  }
}
