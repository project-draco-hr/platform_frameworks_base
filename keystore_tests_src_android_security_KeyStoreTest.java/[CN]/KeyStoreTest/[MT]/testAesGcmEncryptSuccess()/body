{
  String name="test";
  KeymasterArguments args=new KeymasterArguments();
  args.addEnum(KeymasterDefs.KM_TAG_PURPOSE,KeymasterDefs.KM_PURPOSE_ENCRYPT);
  args.addEnum(KeymasterDefs.KM_TAG_PURPOSE,KeymasterDefs.KM_PURPOSE_DECRYPT);
  args.addEnum(KeymasterDefs.KM_TAG_ALGORITHM,KeymasterDefs.KM_ALGORITHM_AES);
  args.addEnum(KeymasterDefs.KM_TAG_PADDING,KeymasterDefs.KM_PAD_NONE);
  args.addUnsignedInt(KeymasterDefs.KM_TAG_KEY_SIZE,256);
  args.addEnum(KeymasterDefs.KM_TAG_BLOCK_MODE,KeymasterDefs.KM_MODE_GCM);
  args.addBoolean(KeymasterDefs.KM_TAG_NO_AUTH_REQUIRED);
  KeyCharacteristics outCharacteristics=new KeyCharacteristics();
  int rc=mKeyStore.generateKey(name,args,null,0,outCharacteristics);
  assertEquals("Generate should succeed",KeyStore.NO_ERROR,rc);
  args=new KeymasterArguments();
  args.addEnum(KeymasterDefs.KM_TAG_ALGORITHM,KeymasterDefs.KM_ALGORITHM_AES);
  args.addEnum(KeymasterDefs.KM_TAG_BLOCK_MODE,KeymasterDefs.KM_MODE_GCM);
  args.addEnum(KeymasterDefs.KM_TAG_PADDING,KeymasterDefs.KM_PAD_NONE);
  args.addUnsignedInt(KeymasterDefs.KM_TAG_MAC_LENGTH,128);
  OperationResult result=mKeyStore.begin(name,KeymasterDefs.KM_PURPOSE_ENCRYPT,true,args,null);
  IBinder token=result.token;
  assertEquals("Begin should succeed",KeyStore.NO_ERROR,result.resultCode);
  result=mKeyStore.update(token,null,new byte[]{0x01,0x02,0x03,0x04});
  assertEquals("Update should succeed",KeyStore.NO_ERROR,result.resultCode);
  assertEquals("Finish should succeed",KeyStore.NO_ERROR,mKeyStore.finish(token,null,null).resultCode);
}
