{
  ArrayList<AudioDevicePort> ports=new ArrayList<AudioDevicePort>();
  int status=AudioManager.listAudioDevicePorts(ports);
  if (status != AudioManager.SUCCESS) {
    return new AudioDeviceInfo[0];
  }
  int numRecs=0;
  for (  AudioDevicePort port : ports) {
    if (checkFlags(port,flags)) {
      numRecs++;
    }
  }
  AudioDeviceInfo[] deviceList=new AudioDeviceInfo[numRecs];
  int slot=0;
  for (  AudioDevicePort port : ports) {
    if (checkFlags(port,flags)) {
      deviceList[slot++]=new AudioDeviceInfo(port);
    }
  }
  return deviceList;
}
