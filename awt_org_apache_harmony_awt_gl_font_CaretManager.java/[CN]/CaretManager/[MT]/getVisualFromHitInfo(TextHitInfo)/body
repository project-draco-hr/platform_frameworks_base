{
  final int idx=hitInfo.getCharIndex();
  if (idx >= 0 && idx < breaker.getCharCount()) {
    int visual=breaker.getVisualFromLogical(idx);
    if (hitInfo.isLeadingEdge() ^ ((breaker.getLevel(idx) & 0x1) == 0x0)) {
      visual++;
    }
    return visual;
  }
 else   if (idx < 0) {
    return breaker.isLTR() ? 0 : breaker.getCharCount();
  }
 else {
    return breaker.isLTR() ? breaker.getCharCount() : 0;
  }
}
