{
  checkHit(hitInfo);
  int idx=hitInfo.getCharIndex();
  int resIdx;
  boolean resIsLeading;
  if (idx >= 0 && idx < breaker.getCharCount()) {
    int visual=breaker.getVisualFromLogical(idx);
    if (((breaker.getLevel(idx) & 0x1) == 0x0) ^ hitInfo.isLeadingEdge()) {
      visual++;
      if (visual == breaker.getCharCount()) {
        if (breaker.isLTR()) {
          resIdx=breaker.getCharCount();
          resIsLeading=true;
        }
 else {
          resIdx=-1;
          resIsLeading=false;
        }
      }
 else {
        resIdx=breaker.getLogicalFromVisual(visual);
        if ((breaker.getLevel(resIdx) & 0x1) == 0x0) {
          resIsLeading=true;
        }
 else {
          resIsLeading=false;
        }
      }
    }
 else {
      visual--;
      if (visual == -1) {
        if (breaker.isLTR()) {
          resIdx=-1;
          resIsLeading=false;
        }
 else {
          resIdx=breaker.getCharCount();
          resIsLeading=true;
        }
      }
 else {
        resIdx=breaker.getLogicalFromVisual(visual);
        if ((breaker.getLevel(resIdx) & 0x1) == 0x0) {
          resIsLeading=false;
        }
 else {
          resIsLeading=true;
        }
      }
    }
  }
 else   if (idx < 0) {
    if (breaker.isLTR()) {
      resIdx=breaker.getLogicalFromVisual(0);
      resIsLeading=(breaker.getLevel(resIdx) & 0x1) == 0x0;
    }
 else {
      resIdx=breaker.getLogicalFromVisual(breaker.getCharCount() - 1);
      resIsLeading=(breaker.getLevel(resIdx) & 0x1) != 0x0;
    }
  }
 else {
    if (breaker.isLTR()) {
      resIdx=breaker.getLogicalFromVisual(breaker.getCharCount() - 1);
      resIsLeading=(breaker.getLevel(resIdx) & 0x1) != 0x0;
    }
 else {
      resIdx=breaker.getLogicalFromVisual(0);
      resIsLeading=(breaker.getLevel(resIdx) & 0x1) == 0x0;
    }
  }
  return resIsLeading ? TextHitInfo.leading(resIdx) : TextHitInfo.trailing(resIdx);
}
