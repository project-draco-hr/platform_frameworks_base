{
  if (docId == null) {
    docId=getDocIdForFile(file);
  }
 else {
    file=getFileForDocId(docId);
  }
  int flags=0;
  if (file.isDirectory() && file.canWrite()) {
    flags|=Document.FLAG_DIR_SUPPORTS_CREATE;
  }
  if (file.canWrite()) {
    flags|=Document.FLAG_SUPPORTS_WRITE;
    flags|=Document.FLAG_SUPPORTS_DELETE;
  }
  final String displayName=file.getName();
  final String mimeType=getTypeForFile(file);
  if (mimeType.startsWith("image/")) {
    flags|=Document.FLAG_SUPPORTS_THUMBNAIL;
  }
  final RowBuilder row=result.newRow();
  row.add(Document.COLUMN_DOCUMENT_ID,docId);
  row.add(Document.COLUMN_DISPLAY_NAME,displayName);
  row.add(Document.COLUMN_SIZE,file.length());
  row.add(Document.COLUMN_MIME_TYPE,mimeType);
  row.add(Document.COLUMN_LAST_MODIFIED,file.lastModified());
  row.add(Document.COLUMN_FLAGS,flags);
}
