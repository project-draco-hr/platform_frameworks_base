{
  if (docId == null) {
    docId=getDocIdForFile(file);
  }
 else {
    file=getFileForDocId(docId);
  }
  int flags=0;
  if (file.canWrite()) {
    if (file.isDirectory()) {
      flags|=Document.FLAG_DIR_SUPPORTS_CREATE;
      flags|=Document.FLAG_SUPPORTS_DELETE;
      flags|=Document.FLAG_SUPPORTS_RENAME;
      flags|=Document.FLAG_SUPPORTS_MOVE;
    }
 else {
      flags|=Document.FLAG_SUPPORTS_WRITE;
      flags|=Document.FLAG_SUPPORTS_DELETE;
      flags|=Document.FLAG_SUPPORTS_RENAME;
      flags|=Document.FLAG_SUPPORTS_MOVE;
    }
  }
  final String mimeType=getTypeForFile(file);
  if (mArchiveHelper.isSupportedArchiveType(mimeType)) {
    flags|=Document.FLAG_ARCHIVE;
  }
  final String displayName=file.getName();
  if (mimeType.startsWith("image/")) {
    flags|=Document.FLAG_SUPPORTS_THUMBNAIL;
  }
  final RowBuilder row=result.newRow();
  row.add(Document.COLUMN_DOCUMENT_ID,docId);
  row.add(Document.COLUMN_DISPLAY_NAME,displayName);
  row.add(Document.COLUMN_SIZE,file.length());
  row.add(Document.COLUMN_MIME_TYPE,mimeType);
  row.add(Document.COLUMN_FLAGS,flags);
  row.add(DocumentArchiveHelper.COLUMN_LOCAL_FILE_PATH,file.getPath());
  long lastModified=file.lastModified();
  if (lastModified > 31536000000L) {
    row.add(Document.COLUMN_LAST_MODIFIED,lastModified);
  }
}
