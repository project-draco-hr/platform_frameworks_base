{
  if (mExtras != null && mExtras.isParcelled())   return;
  if (getClipData() != null)   return;
  final String action=getAction();
  if (ACTION_SEND.equals(action)) {
    final Uri stream=getParcelableExtra(EXTRA_STREAM);
    if (stream != null) {
      final ClipData clipData=new ClipData(null,new String[]{getType()},new ClipData.Item(stream));
      setClipData(clipData);
      addFlags(FLAG_GRANT_READ_URI_PERMISSION);
    }
  }
 else   if (ACTION_SEND_MULTIPLE.equals(action)) {
    final ArrayList<Uri> streams=getParcelableArrayListExtra(EXTRA_STREAM);
    if (streams != null && streams.size() > 0) {
      final Uri firstStream=streams.get(0);
      final ClipData clipData=new ClipData(null,new String[]{getType()},new ClipData.Item(firstStream));
      final int size=streams.size();
      for (int i=1; i < size; i++) {
        clipData.addItem(new ClipData.Item(streams.get(i)));
      }
      setClipData(clipData);
      addFlags(FLAG_GRANT_READ_URI_PERMISSION);
    }
  }
}
