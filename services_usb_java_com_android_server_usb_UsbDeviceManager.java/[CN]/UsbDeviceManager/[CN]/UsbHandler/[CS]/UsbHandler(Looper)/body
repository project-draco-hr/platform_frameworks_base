{
  super(looper);
  try {
    mDefaultFunctions=SystemProperties.get("persist.sys.usb.config","adb");
    String config=SystemProperties.get("sys.usb.config","none");
    if (!config.equals(mDefaultFunctions)) {
      Slog.w(TAG,"resetting config to persistent property: " + mDefaultFunctions);
      SystemProperties.set("sys.usb.config",mDefaultFunctions);
    }
    mAdbEnabled=containsFunction(SystemProperties.get(UsbManager.ADB_PERSISTENT_PROPERTY,"adb"),UsbManager.USB_FUNCTION_ADB);
    mCurrentFunctions=getDefaultFunctions();
    String state=FileUtils.readTextFile(new File(STATE_PATH),0,null).trim();
    updateState(state);
    mContentResolver.registerContentObserver(Settings.Global.getUriFor(Settings.Global.ADB_ENABLED),false,new AdbSettingsObserver());
    mUEventObserver.startObserving(USB_STATE_MATCH);
    mUEventObserver.startObserving(ACCESSORY_START_MATCH);
    IntentFilter filter=new IntentFilter(Intent.ACTION_BOOT_COMPLETED);
    filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
    mContext.registerReceiver(mBootCompletedReceiver,filter);
    mContext.registerReceiver(mUserSwitchedReceiver,new IntentFilter(Intent.ACTION_USER_SWITCHED));
  }
 catch (  Exception e) {
    Slog.e(TAG,"Error initializing UsbHandler",e);
  }
}
