{
  super(looper);
  try {
    mAdbEnabled=containsFunction(SystemProperties.get(UsbManager.ADB_PERSISTENT_PROPERTY,"adb"),UsbManager.USB_FUNCTION_ADB);
    mCurrentFunctions=mAdbEnabled ? "adb" : UsbManager.USB_FUNCTION_MTP;
    String state=FileUtils.readTextFile(new File(STATE_PATH),0,null).trim();
    updateState(state);
    mContentResolver.registerContentObserver(Settings.Global.getUriFor(Settings.Global.ADB_ENABLED),false,new AdbSettingsObserver());
    mUEventObserver.startObserving(USB_STATE_MATCH);
    mUEventObserver.startObserving(ACCESSORY_START_MATCH);
    IntentFilter filter=new IntentFilter(Intent.ACTION_BOOT_COMPLETED);
    filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY);
    mContext.registerReceiver(mBootCompletedReceiver,filter);
    mContext.registerReceiver(mUserSwitchedReceiver,new IntentFilter(Intent.ACTION_USER_SWITCHED));
  }
 catch (  Exception e) {
    Slog.e(TAG,"Error initializing UsbHandler",e);
  }
}
