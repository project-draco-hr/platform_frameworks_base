{
  if (DEBUG)   Slog.d(TAG,"setEnabledFunctions " + functions);
  if (functions == null) {
    functions=getDefaultFunctions();
  }
  if (mAdbEnabled) {
    functions=addFunction(functions,UsbManager.USB_FUNCTION_ADB);
  }
 else {
    functions=removeFunction(functions,UsbManager.USB_FUNCTION_ADB);
  }
  if (!mCurrentFunctions.equals(functions)) {
    if (!setUsbConfig("none")) {
      Slog.e(TAG,"Failed to disable USB");
      setUsbConfig(mCurrentFunctions);
      return;
    }
    if (setUsbConfig(functions)) {
      mCurrentFunctions=functions;
    }
 else {
      Slog.e(TAG,"Failed to switch USB config to " + functions);
      setUsbConfig(mCurrentFunctions);
    }
  }
}
