{
  boolean enabled=containsFunction(mCurrentFunctions,UsbManager.USB_FUNCTION_AUDIO_SOURCE);
  if (enabled != mAudioSourceEnabled) {
    Intent intent=new Intent(Intent.ACTION_USB_AUDIO_ACCESSORY_PLUG);
    intent.addFlags(Intent.FLAG_RECEIVER_REPLACE_PENDING);
    intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    intent.putExtra("state",(enabled ? 1 : 0));
    if (enabled) {
      Scanner scanner=null;
      try {
        scanner=new Scanner(new File(AUDIO_SOURCE_PCM_PATH));
        int card=scanner.nextInt();
        int device=scanner.nextInt();
        intent.putExtra("card",card);
        intent.putExtra("device",device);
      }
 catch (      FileNotFoundException e) {
        Slog.e(TAG,"could not open audio source PCM file",e);
      }
 finally {
        if (scanner != null) {
          scanner.close();
        }
      }
    }
    mContext.sendStickyBroadcastAsUser(intent,UserHandle.ALL);
    mAudioSourceEnabled=enabled;
  }
}
