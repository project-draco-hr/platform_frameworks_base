{
  SetupResult result;
  String[] response=((String[])ar.result);
  ConnectionParams cp=(ConnectionParams)ar.userObj;
  if (ar.exception != null) {
    if (DBG)     log("DataConnection Init failed " + ar.exception);
    if (ar.exception instanceof CommandException && ((CommandException)(ar.exception)).getCommandError() == CommandException.Error.RADIO_NOT_AVAILABLE) {
      result=SetupResult.ERR_BadCommand;
      result.mFailCause=FailCause.RADIO_NOT_AVAILABLE;
    }
 else {
      result=SetupResult.ERR_Other;
    }
  }
 else   if (cp.tag != mTag) {
    if (DBG) {
      log("BUG: onSetupConnectionCompleted is stale cp.tag=" + cp.tag + ", mtag="+ mTag);
    }
    result=SetupResult.ERR_Stale;
  }
 else {
    mNetworkProperties.clear();
    if (response.length >= 2) {
      cid=Integer.parseInt(response[0]);
      String interfaceName=response[1];
      result=SetupResult.SUCCESS;
      try {
        String prefix="net." + interfaceName + ".";
        mNetworkProperties.setInterface(NetworkInterface.getByName(interfaceName));
        String gatewayAddress=SystemProperties.get(prefix + "gw");
        mNetworkProperties.setGateway(InetAddress.getByName(gatewayAddress));
        if (response.length > 2) {
          String ipAddress=response[2];
          mNetworkProperties.addAddress(InetAddress.getByName(ipAddress));
          String dnsServers[]=new String[2];
          dnsServers[0]=SystemProperties.get(prefix + "dns1");
          dnsServers[1]=SystemProperties.get(prefix + "dns2");
          if (isDnsOk(dnsServers)) {
            mNetworkProperties.addDns(InetAddress.getByName(dnsServers[0]));
            mNetworkProperties.addDns(InetAddress.getByName(dnsServers[1]));
          }
 else {
            result=SetupResult.ERR_BadDns;
          }
        }
      }
 catch (      UnknownHostException e1) {
        log("onSetupCompleted: UnknowHostException " + e1);
        e1.printStackTrace();
        result=SetupResult.ERR_Other;
      }
catch (      SocketException e2) {
        log("onSetupCompleted: SocketException " + e2);
        e2.printStackTrace();
        result=SetupResult.ERR_Other;
      }
    }
 else {
      log("onSetupCompleted: error; expected number of responses >= 2 was " + response.length);
      result=SetupResult.ERR_Other;
    }
    if (result != SetupResult.SUCCESS) {
      log("onSetupCompleted with an error clearing NetworkProperties");
      mNetworkProperties.clear();
    }
  }
  if (DBG) {
    log("DataConnection setup result='" + result + "' on cid="+ cid);
    if (result == SetupResult.SUCCESS) {
      log("NetworkProperties: " + mNetworkProperties.toString());
    }
  }
  return result;
}
