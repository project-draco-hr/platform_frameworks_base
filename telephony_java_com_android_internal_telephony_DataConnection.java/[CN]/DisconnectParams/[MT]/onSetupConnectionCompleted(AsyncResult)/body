{
  SetupResult result;
  String[] response=((String[])ar.result);
  ConnectionParams cp=(ConnectionParams)ar.userObj;
  if (ar.exception != null) {
    if (DBG)     log("DataConnection Init failed " + ar.exception);
    if (ar.exception instanceof CommandException && ((CommandException)(ar.exception)).getCommandError() == CommandException.Error.RADIO_NOT_AVAILABLE) {
      result=SetupResult.ERR_BadCommand;
      result.mFailCause=FailCause.RADIO_NOT_AVAILABLE;
    }
 else {
      result=SetupResult.ERR_Other;
    }
  }
 else   if (cp.tag != mTag) {
    if (DBG) {
      log("BUG: onSetupConnectionCompleted is stale cp.tag=" + cp.tag + ", mtag="+ mTag);
    }
    result=SetupResult.ERR_Stale;
  }
 else {
    if (response.length >= 2) {
      cid=Integer.parseInt(response[0]);
      interfaceName=response[1];
      String prefix="net." + interfaceName + ".";
      gatewayAddress=SystemProperties.get(prefix + "gw");
      dnsServers[0]=SystemProperties.get(prefix + "dns1");
      dnsServers[1]=SystemProperties.get(prefix + "dns2");
      if (response.length > 2) {
        ipAddress=response[2];
        if (isDnsOk(dnsServers)) {
          result=SetupResult.SUCCESS;
        }
 else {
          result=SetupResult.ERR_BadDns;
        }
      }
 else {
        result=SetupResult.SUCCESS;
      }
    }
 else {
      result=SetupResult.ERR_Other;
    }
  }
  if (DBG) {
    log("DataConnection setup result='" + result + "' on cid="+ cid);
    if (result == SetupResult.SUCCESS) {
      log("interface=" + interfaceName + " ipAddress="+ ipAddress+ " gateway="+ gatewayAddress+ " DNS1="+ dnsServers[0]+ " DNS2="+ dnsServers[1]);
    }
  }
  return result;
}
