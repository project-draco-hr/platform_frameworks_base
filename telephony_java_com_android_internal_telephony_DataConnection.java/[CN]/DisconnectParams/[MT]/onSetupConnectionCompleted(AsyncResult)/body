{
  SetupResult result;
  String[] response=((String[])ar.result);
  ConnectionParams cp=(ConnectionParams)ar.userObj;
  if (ar.exception != null) {
    if (DBG)     log("DataConnection Init failed " + ar.exception);
    if (ar.exception instanceof CommandException && ((CommandException)(ar.exception)).getCommandError() == CommandException.Error.RADIO_NOT_AVAILABLE) {
      result=SetupResult.ERR_BadCommand;
      result.mFailCause=FailCause.RADIO_NOT_AVAILABLE;
    }
 else {
      result=SetupResult.ERR_Other;
    }
  }
 else   if (cp.tag != mTag) {
    if (DBG) {
      log("BUG: onSetupConnectionCompleted is stale cp.tag=" + cp.tag + ", mtag="+ mTag);
    }
    result=SetupResult.ERR_Stale;
  }
 else {
    LinkProperties linkProperties=new LinkProperties();
    if (response.length >= 2) {
      cid=Integer.parseInt(response[0]);
      String interfaceName=response[1];
      result=SetupResult.SUCCESS;
      try {
        String prefix="net." + interfaceName + ".";
        NetworkInterface networkInterface=NetworkInterface.getByName(interfaceName);
        linkProperties.setInterfaceName(interfaceName);
        String gatewayAddress=SystemProperties.get(prefix + "gw");
        linkProperties.setGateway(InetAddress.getByName(gatewayAddress));
        for (        InterfaceAddress addr : networkInterface.getInterfaceAddresses()) {
          linkProperties.addLinkAddress(new LinkAddress(addr));
        }
        String dnsServers[]=new String[2];
        dnsServers[0]=SystemProperties.get(prefix + "dns1");
        dnsServers[1]=SystemProperties.get(prefix + "dns2");
        if (isDnsOk(dnsServers)) {
          linkProperties.addDns(InetAddress.getByName(dnsServers[0]));
          linkProperties.addDns(InetAddress.getByName(dnsServers[1]));
        }
 else {
          result=SetupResult.ERR_BadDns;
        }
      }
 catch (      UnknownHostException e1) {
        log("onSetupCompleted: UnknowHostException " + e1);
        e1.printStackTrace();
        result=SetupResult.ERR_Other;
      }
catch (      SocketException e2) {
        log("onSetupCompleted: SocketException " + e2);
        e2.printStackTrace();
        result=SetupResult.ERR_Other;
      }
    }
 else {
      log("onSetupCompleted: error; expected number of responses >= 2 was " + response.length);
      result=SetupResult.ERR_Other;
    }
    if (result != SetupResult.SUCCESS) {
      log("onSetupCompleted with an error clearing LinkProperties");
      linkProperties.clear();
    }
    mLinkProperties=linkProperties;
  }
  if (DBG) {
    log("DataConnection setup result='" + result + "' on cid="+ cid);
    if (result == SetupResult.SUCCESS) {
      log("LinkProperties: " + mLinkProperties.toString());
    }
  }
  return result;
}
