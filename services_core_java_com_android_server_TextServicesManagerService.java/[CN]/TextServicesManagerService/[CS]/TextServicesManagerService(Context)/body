{
  mSystemReady=false;
  mContext=context;
  mUserManager=mContext.getSystemService(UserManager.class);
  final IntentFilter broadcastFilter=new IntentFilter();
  broadcastFilter.addAction(Intent.ACTION_USER_ADDED);
  broadcastFilter.addAction(Intent.ACTION_USER_REMOVED);
  mContext.registerReceiver(new TextServicesBroadcastReceiver(),broadcastFilter);
  int userId=UserHandle.USER_SYSTEM;
  try {
    userId=ActivityManagerNative.getDefault().getCurrentUser().id;
  }
 catch (  RemoteException e) {
    Slog.w(TAG,"Couldn't get current user ID; guessing it's 0",e);
  }
  mMonitor=new TextServicesMonitor();
  mMonitor.register(context,null,true);
  final boolean useCopyOnWriteSettings=!mSystemReady || !mUserManager.isUserUnlockingOrUnlocked(userId);
  mSettings=new TextServicesSettings(context.getContentResolver(),userId,useCopyOnWriteSettings);
  resetInternalState(userId);
}
