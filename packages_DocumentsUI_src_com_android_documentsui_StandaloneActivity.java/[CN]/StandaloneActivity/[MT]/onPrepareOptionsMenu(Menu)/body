{
  boolean shown=super.onPrepareOptionsMenu(menu);
  final RootInfo root=getCurrentRoot();
  final DocumentInfo cwd=getCurrentDirectory();
  final MenuItem createDir=menu.findItem(R.id.menu_create_dir);
  final MenuItem advanced=menu.findItem(R.id.menu_advanced);
  final MenuItem fileSize=menu.findItem(R.id.menu_file_size);
  final MenuItem settings=menu.findItem(R.id.menu_settings);
  createDir.setVisible(cwd != null && cwd.isCreateSupported() && !mSearchManager.isSearching() && !root.isDownloads());
  fileSize.setVisible(cwd != null);
  advanced.setVisible(cwd != null);
  settings.setVisible((root.flags & Root.FLAG_HAS_SETTINGS) != 0);
  return shown;
}
