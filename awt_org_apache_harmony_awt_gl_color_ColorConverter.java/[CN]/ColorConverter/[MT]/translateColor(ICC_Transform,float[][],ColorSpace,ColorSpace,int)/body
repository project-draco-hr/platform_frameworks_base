{
  if (srcCS != null) {
    scaler.loadScalingData(srcCS);
  }
  int nSrcChannels=t.getNumInputChannels();
  short srcShortData[]=new short[nPixels * nSrcChannels];
  for (int i=0, srcDataPos=0; i < nPixels; i++) {
    scaler.scale(buffer[i],srcShortData,srcDataPos);
    srcDataPos+=nSrcChannels;
  }
  short dstShortData[]=this.translateColor(t,srcShortData,null);
  int nDstChannels=t.getNumOutputChannels();
  int bufferSize=buffer[0].length;
  if (bufferSize < nDstChannels + 1) {
    for (int i=0; i < nPixels; i++) {
      buffer[i]=new float[nDstChannels + 1];
    }
  }
  if (dstCS != null) {
    scaler.loadScalingData(dstCS);
  }
  for (int i=0, dstDataPos=0; i < nPixels; i++) {
    scaler.unscale(buffer[i],dstShortData,dstDataPos);
    dstDataPos+=nDstChannels;
  }
  return buffer;
}
