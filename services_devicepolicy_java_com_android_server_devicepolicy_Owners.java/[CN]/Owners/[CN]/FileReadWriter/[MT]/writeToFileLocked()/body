{
  if (!shouldWrite()) {
    if (DEBUG) {
      Log.d(TAG,"No need to write to " + mFile);
    }
    if (mFile.exists()) {
      if (DEBUG) {
        Log.d(TAG,"Deleting existing " + mFile);
      }
      if (!mFile.delete()) {
        Slog.e(TAG,"Failed to remove " + mFile.getPath());
      }
    }
    return;
  }
  if (DEBUG) {
    Log.d(TAG,"Writing to " + mFile);
  }
  final AtomicFile f=new AtomicFile(mFile);
  FileOutputStream outputStream=null;
  try {
    outputStream=f.startWrite();
    final XmlSerializer out=new FastXmlSerializer();
    out.setOutput(outputStream,StandardCharsets.UTF_8.name());
    out.startDocument(null,true);
    out.startTag(null,TAG_ROOT);
    writeInner(out);
    out.endTag(null,TAG_ROOT);
    out.endDocument();
    out.flush();
    f.finishWrite(outputStream);
    outputStream=null;
  }
 catch (  IOException e) {
    Slog.e(TAG,"Exception when writing",e);
    if (outputStream != null) {
      f.failWrite(outputStream);
    }
  }
}
