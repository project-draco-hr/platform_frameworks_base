{
  boolean isFirstRun=true;
  while (!sharedElements.isEmpty()) {
    final int numSharedElements=sharedElements.size();
    for (int i=numSharedElements - 1; i >= 0; i--) {
      final View view=sharedElements.valueAt(i);
      final String name=sharedElements.keyAt(i);
      if (isFirstRun && (view == null || !view.isAttachedToWindow() || name == null)) {
        sharedElements.removeAt(i);
      }
 else       if (!isNested(view,sharedElements)) {
        mSharedElementNames.add(name);
        mSharedElements.add(view);
        sharedElements.removeAt(i);
      }
    }
    isFirstRun=false;
  }
}
