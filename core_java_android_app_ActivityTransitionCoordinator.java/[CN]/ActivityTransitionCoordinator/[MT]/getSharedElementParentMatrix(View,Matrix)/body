{
  final boolean isNestedInOtherSharedElement=!mRootSharedElements.contains(view);
  final boolean useParentMatrix;
  if (isNestedInOtherSharedElement) {
    useParentMatrix=true;
  }
 else {
    final int index=mSharedElementParentMatrices == null ? -1 : mSharedElements.indexOf(view);
    if (index < 0) {
      useParentMatrix=true;
    }
 else {
      Matrix parentMatrix=mSharedElementParentMatrices.get(index);
      matrix.set(parentMatrix);
      useParentMatrix=false;
    }
  }
  if (useParentMatrix) {
    matrix.reset();
    ViewParent viewParent=view.getParent();
    if (viewParent instanceof ViewGroup) {
      ViewGroup parent=(ViewGroup)viewParent;
      parent.transformMatrixToLocal(matrix);
    }
  }
}
