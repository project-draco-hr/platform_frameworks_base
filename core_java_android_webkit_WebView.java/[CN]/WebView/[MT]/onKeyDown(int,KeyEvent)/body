{
  if (DebugFlags.WEB_VIEW) {
    Log.v(LOGTAG,"keyDown at " + System.currentTimeMillis() + ", "+ event);
  }
  if (mNativeClass == 0) {
    return false;
  }
  if (AUTO_REDRAW_HACK && (keyCode == KeyEvent.KEYCODE_CALL)) {
    mAutoRedraw=!mAutoRedraw;
    if (mAutoRedraw) {
      invalidate();
    }
    return true;
  }
  if (event.isSystem() || mCallbackProxy.uiOverrideKeyEvent(event) || (mTouchMode >= FIRST_SCROLL_ZOOM && mTouchMode <= LAST_SCROLL_ZOOM)) {
    return false;
  }
  if (mShiftIsPressed == false && nativeCursorWantsKeyEvents() == false && (keyCode == KeyEvent.KEYCODE_SHIFT_LEFT || keyCode == KeyEvent.KEYCODE_SHIFT_RIGHT)) {
    mExtendSelection=false;
    mShiftIsPressed=true;
    if (nativeHasCursorNode()) {
      Rect rect=nativeCursorNodeBounds();
      mSelectX=contentToView(rect.left);
      mSelectY=contentToView(rect.top);
    }
 else {
      mSelectX=mScrollX + (int)mLastTouchX;
      mSelectY=mScrollY + (int)mLastTouchY;
    }
    nativeHideCursor();
  }
  if (keyCode >= KeyEvent.KEYCODE_DPAD_UP && keyCode <= KeyEvent.KEYCODE_DPAD_RIGHT) {
    switchOutDrawHistory();
    if (navHandledKey(keyCode,1,false,event.getEventTime())) {
      playSoundEffect(keyCodeToSoundsEffect(keyCode));
      return true;
    }
    return false;
  }
  if (keyCode == KeyEvent.KEYCODE_DPAD_CENTER) {
    switchOutDrawHistory();
    if (event.getRepeatCount() == 0) {
      mGotCenterDown=true;
      mPrivateHandler.sendMessageDelayed(mPrivateHandler.obtainMessage(LONG_PRESS_CENTER),LONG_PRESS_TIMEOUT);
      nativeRecordButtons(hasFocus() && hasWindowFocus(),true,true);
      return true;
    }
    return false;
  }
  if (keyCode != KeyEvent.KEYCODE_SHIFT_LEFT && keyCode != KeyEvent.KEYCODE_SHIFT_RIGHT) {
    mExtendSelection=mShiftIsPressed=false;
    if (mTouchMode == TOUCH_SELECT_MODE) {
      mTouchMode=TOUCH_INIT_MODE;
    }
  }
  if (getSettings().getNavDump()) {
switch (keyCode) {
case KeyEvent.KEYCODE_4:
      nativeDumpDisplayTree(getUrl());
    break;
case KeyEvent.KEYCODE_5:
case KeyEvent.KEYCODE_6:
  mWebViewCore.sendMessage(EventHub.DUMP_DOMTREE,(keyCode == KeyEvent.KEYCODE_5) ? 1 : 0,0);
break;
case KeyEvent.KEYCODE_7:
case KeyEvent.KEYCODE_8:
mWebViewCore.sendMessage(EventHub.DUMP_RENDERTREE,(keyCode == KeyEvent.KEYCODE_7) ? 1 : 0,0);
break;
case KeyEvent.KEYCODE_9:
nativeInstrumentReport();
return true;
}
}
if (nativeCursorWantsKeyEvents() && !nativeCursorMatchesFocus()) {
mWebViewCore.sendMessage(EventHub.CLICK);
}
if (nativeCursorWantsKeyEvents() || true) {
mWebViewCore.sendMessage(EventHub.SET_ACTIVE,1);
mWebViewCore.sendMessage(EventHub.KEY_DOWN,event);
return true;
}
return false;
}
