{
  int viewWidth=getViewWidth();
  int viewHeight=getViewHeightWithTitle();
  float scale=Math.min((float)viewWidth / docWidth,(float)viewHeight / docHeight);
  if (scale < mMinZoomScale) {
    scale=mMinZoomScale;
  }
 else   if (scale > mMaxZoomScale) {
    scale=mMaxZoomScale;
  }
  if (Math.abs(scale - mActualScale) < MINIMUM_SCALE_INCREMENT) {
    pinScrollTo(contentToViewX(docX + docWidth / 2) - viewWidth / 2,contentToViewY(docY + docHeight / 2) - viewHeight / 2,true,0);
  }
 else {
    float oldScreenX=docX * mActualScale - mScrollX;
    float rectViewX=docX * scale;
    float rectViewWidth=docWidth * scale;
    float newMaxWidth=mContentWidth * scale;
    float newScreenX=(viewWidth - rectViewWidth) / 2;
    if (newScreenX > rectViewX) {
      newScreenX=rectViewX;
    }
 else     if (newScreenX > (newMaxWidth - rectViewX - rectViewWidth)) {
      newScreenX=viewWidth - (newMaxWidth - rectViewX);
    }
    mZoomCenterX=(oldScreenX * scale - newScreenX * mActualScale) / (scale - mActualScale);
    float oldScreenY=docY * mActualScale + getTitleHeight() - mScrollY;
    float rectViewY=docY * scale + getTitleHeight();
    float rectViewHeight=docHeight * scale;
    float newMaxHeight=mContentHeight * scale + getTitleHeight();
    float newScreenY=(viewHeight - rectViewHeight) / 2;
    if (newScreenY > rectViewY) {
      newScreenY=rectViewY;
    }
 else     if (newScreenY > (newMaxHeight - rectViewY - rectViewHeight)) {
      newScreenY=viewHeight - (newMaxHeight - rectViewY);
    }
    mZoomCenterY=(oldScreenY * scale - newScreenY * mActualScale) / (scale - mActualScale);
    zoomWithPreview(scale,false);
  }
}
