{
  int action=ev.getAction();
  if ((action & 0xff) == MotionEvent.ACTION_POINTER_DOWN) {
    cancelTouch();
    mInZoomOverview=false;
    if (inEditingMode() && nativeFocusCandidateIsPassword()) {
      mWebTextView.setInPassword(false);
    }
    mPreviewZoomOnly=true;
    float x0=ev.getX(0);
    float y0=ev.getY(0);
    float x1=ev.getX(1);
    float y1=ev.getY(1);
    mLastTouchTime=ev.getEventTime();
    mPinchDistance=Math.sqrt((x0 - x1) * (x0 - x1) + (y0 - y1) * (y0 - y1));
    mZoomCenterX=mZoomCenterY=0;
  }
 else   if ((action & 0xff) == MotionEvent.ACTION_POINTER_UP) {
    mPreviewZoomOnly=false;
    boolean reflowNow=!getSettings().getPluginsEnabled();
    if (reflowNow && (mZoomCenterX != 0) && (mZoomCenterY != 0)) {
      mAnchorX=viewToContentX((int)mZoomCenterX + mScrollX);
      mAnchorY=viewToContentY((int)mZoomCenterY + mScrollY);
    }
    setNewZoomScale(mActualScale,reflowNow,true);
    invalidate();
    if (inEditingMode()) {
      adjustTextView(true);
    }
    mTouchMode=TOUCH_PINCH_DRAG;
    int id=(((action & MotionEvent.ACTION_POINTER_ID_MASK) >> MotionEvent.ACTION_POINTER_ID_SHIFT) == 0) ? 1 : 0;
    startTouch(ev.getX(id),ev.getY(id),ev.getEventTime());
  }
 else   if (action == MotionEvent.ACTION_MOVE) {
    float x0=ev.getX(0);
    float y0=ev.getY(0);
    float x1=ev.getX(1);
    float y1=ev.getY(1);
    double distance=Math.sqrt((x0 - x1) * (x0 - x1) + (y0 - y1) * (y0 - y1));
    float scale=(float)(Math.round(distance / mPinchDistance * mActualScale * 100) / 100.0);
    long time=ev.getEventTime();
    if (Math.abs(scale - mActualScale) >= 0.01f && ((time - mLastTouchTime) < 300 || Math.abs(distance - mPinchDistance) > (10 * mDefaultScale))) {
      if (scale > mActualScale) {
        scale=Math.min(scale,mActualScale * 1.25f);
      }
 else {
        scale=Math.max(scale,mActualScale * 0.8f);
      }
      mZoomCenterX=(x0 + x1) / 2;
      mZoomCenterY=(y0 + y1) / 2;
      setNewZoomScale(scale,false,false);
      invalidate();
      mPinchDistance=distance;
      mLastTouchTime=time;
    }
  }
 else {
    Log.w(LOGTAG,action + " should not happen during doMultiTouch");
    return false;
  }
  return true;
}
