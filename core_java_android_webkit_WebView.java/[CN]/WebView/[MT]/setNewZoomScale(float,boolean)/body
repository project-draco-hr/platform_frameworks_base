{
  if (scale < mMinZoomScale) {
    scale=mMinZoomScale;
  }
 else   if (scale > mMaxZoomScale) {
    scale=mMaxZoomScale;
  }
  if (scale != mActualScale || force) {
    if (mDrawHistory) {
      if (scale != mActualScale) {
        mCallbackProxy.onScaleChanged(mActualScale,scale);
      }
      mActualScale=scale;
      mInvActualScale=1 / scale;
      sendViewSizeZoom();
    }
 else {
      int oldX=mScrollX;
      int oldY=mScrollY;
      float ratio=scale * mInvActualScale;
      float sx=ratio * oldX + (ratio - 1) * getViewWidth() * 0.5f;
      float sy=ratio * oldY + (ratio - 1) * getViewHeight() * 0.5f;
      if (scale != mActualScale) {
        mCallbackProxy.onScaleChanged(mActualScale,scale);
      }
      mActualScale=scale;
      mInvActualScale=1 / scale;
      mScrollX=pinLocX(Math.round(sx));
      mScrollY=pinLocY(Math.round(sy));
      sendViewSizeZoom();
      sendOurVisibleRect();
    }
  }
}
