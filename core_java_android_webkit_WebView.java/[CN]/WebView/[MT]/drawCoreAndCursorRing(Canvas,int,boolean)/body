{
  if (mDrawHistory) {
    canvas.scale(mActualScale,mActualScale);
    canvas.drawPicture(mHistoryPicture);
    return;
  }
  boolean animateZoom=mZoomScale != 0;
  boolean animateScroll=(!mScroller.isFinished() || mVelocityTracker != null) && (mTouchMode != TOUCH_DRAG_MODE || mHeldMotionless != MOTIONLESS_TRUE);
  if (mTouchMode == TOUCH_DRAG_MODE) {
    if (mHeldMotionless == MOTIONLESS_PENDING) {
      mPrivateHandler.removeMessages(DRAG_HELD_MOTIONLESS);
      mPrivateHandler.removeMessages(AWAKEN_SCROLL_BARS);
      mHeldMotionless=MOTIONLESS_FALSE;
    }
    if (mHeldMotionless == MOTIONLESS_FALSE) {
      mPrivateHandler.sendMessageDelayed(mPrivateHandler.obtainMessage(DRAG_HELD_MOTIONLESS),MOTIONLESS_TIME);
      mHeldMotionless=MOTIONLESS_PENDING;
    }
  }
  if (animateZoom) {
    float zoomScale;
    int interval=(int)(SystemClock.uptimeMillis() - mZoomStart);
    if (interval < ZOOM_ANIMATION_LENGTH) {
      float ratio=(float)interval / ZOOM_ANIMATION_LENGTH;
      zoomScale=1.0f / (mInvInitialZoomScale + (mInvFinalZoomScale - mInvInitialZoomScale) * ratio);
      invalidate();
    }
 else {
      zoomScale=mZoomScale;
      mZoomScale=0;
      invalidate();
      if (mNeedToAdjustWebTextView) {
        mNeedToAdjustWebTextView=false;
        if (didUpdateTextViewBounds(false)) {
          mWebTextView.setTextSize(TypedValue.COMPLEX_UNIT_PX,contentToViewDimension(nativeFocusCandidateTextSize()));
          if (nativeFocusCandidateIsPassword()) {
            mWebTextView.setInPassword(true);
          }
        }
 else {
          mWebTextView.remove();
        }
      }
    }
    float scale=zoomScale * mInvInitialZoomScale;
    int tx=Math.round(scale * (mInitialScrollX + mZoomCenterX) - mZoomCenterX);
    tx=-pinLoc(tx,getViewWidth(),Math.round(mContentWidth * zoomScale)) + mScrollX;
    int titleHeight=getTitleHeight();
    int ty=Math.round(scale * (mInitialScrollY + mZoomCenterY - titleHeight) - (mZoomCenterY - titleHeight));
    ty=-(ty <= titleHeight ? Math.max(ty,0) : pinLoc(ty - titleHeight,getViewHeight(),Math.round(mContentHeight * zoomScale)) + titleHeight) + mScrollY;
    canvas.translate(tx,ty);
    canvas.scale(zoomScale,zoomScale);
    if (inEditingMode() && !mNeedToAdjustWebTextView && mZoomScale != 0) {
      mNeedToAdjustWebTextView=true;
      if (nativeFocusCandidateIsPassword()) {
        mWebTextView.setInPassword(false);
      }
    }
  }
 else {
    canvas.scale(mActualScale,mActualScale);
  }
  mWebViewCore.drawContentPicture(canvas,color,animateZoom,animateScroll);
  if (mNativeClass == 0)   return;
  if (mShiftIsPressed && !animateZoom) {
    if (mTouchSelection) {
      nativeDrawSelectionRegion(canvas);
    }
 else {
      nativeDrawSelection(canvas,mInvActualScale,getTitleHeight(),mSelectX,mSelectY,mExtendSelection);
    }
  }
 else   if (drawCursorRing) {
    if (mTouchMode == TOUCH_SHORTPRESS_START_MODE) {
      mTouchMode=TOUCH_SHORTPRESS_MODE;
      HitTestResult hitTest=getHitTestResult();
      if (hitTest != null && hitTest.mType != HitTestResult.UNKNOWN_TYPE) {
        mPrivateHandler.sendMessageDelayed(mPrivateHandler.obtainMessage(SWITCH_TO_LONGPRESS),LONG_PRESS_TIMEOUT);
      }
    }
    nativeDrawCursorRing(canvas);
  }
  if (mFindIsUp && !animateScroll) {
    nativeDrawMatches(canvas);
  }
  if (mFocusSizeChanged) {
    mFocusSizeChanged=false;
    didUpdateTextViewBounds(true);
  }
}
