{
  if (scale < mMinZoomScale) {
    scale=mMinZoomScale;
    if (scale < mDefaultScale)     mInZoomOverview=true;
  }
 else   if (scale > mMaxZoomScale) {
    scale=mMaxZoomScale;
  }
  if (updateTextWrapScale) {
    mTextWrapScale=scale;
    mLastHeightSent=0;
  }
  if (scale != mActualScale || force) {
    if (mDrawHistory) {
      if (scale != mActualScale && !mPreviewZoomOnly) {
        mCallbackProxy.onScaleChanged(mActualScale,scale);
      }
      mActualScale=scale;
      mInvActualScale=1 / scale;
      sendViewSizeZoom();
    }
 else {
      int oldX=mScrollX;
      int oldY=mScrollY;
      float ratio=scale * mInvActualScale;
      float sx=ratio * oldX + (ratio - 1) * mZoomCenterX;
      float sy=ratio * oldY + (ratio - 1) * (mZoomCenterY - getTitleHeight());
      if (scale != mActualScale && !mPreviewZoomOnly) {
        mCallbackProxy.onScaleChanged(mActualScale,scale);
      }
      mActualScale=scale;
      mInvActualScale=1 / scale;
      mViewManager.scaleAll();
      mScrollX=pinLocX(Math.round(sx));
      mScrollY=pinLocY(Math.round(sy));
      if (oldX != mScrollX || oldY != mScrollY) {
        onScrollChanged(mScrollX,mScrollY,oldX,oldY);
      }
      sendViewSizeZoom();
    }
  }
}
