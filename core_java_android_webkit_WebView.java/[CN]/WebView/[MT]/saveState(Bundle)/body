{
  WebBackForwardList list=copyBackForwardList();
  final int currentIndex=list.getCurrentIndex();
  final int size=list.getSize();
  if (currentIndex < 0 || currentIndex >= size || size == 0) {
    return null;
  }
  outState.putInt("index",currentIndex);
  ArrayList<byte[]> history=new ArrayList<byte[]>(size);
  for (int i=0; i < size; i++) {
    WebHistoryItem item=list.getItemAtIndex(i);
    byte[] data=item.getFlattenedData();
    if (data == null) {
      return null;
    }
    history.add(data);
    if (i == currentIndex) {
      Picture p=capturePicture();
      String path=mContext.getDir("thumbnails",0).getPath() + File.separatorChar + hashCode()+ "_pic.save";
      File f=new File(path);
      try {
        final FileOutputStream out=new FileOutputStream(f);
        p.writeToStream(out);
        out.close();
      }
 catch (      FileNotFoundException e) {
        e.printStackTrace();
      }
catch (      IOException e) {
        e.printStackTrace();
      }
catch (      RuntimeException e) {
        e.printStackTrace();
      }
      if (f.length() > 0) {
        outState.putString("picture",path);
        outState.putInt("scrollX",mScrollX);
        outState.putInt("scrollY",mScrollY);
        outState.putFloat("scale",mActualScale);
      }
    }
  }
  outState.putSerializable("history",history);
  if (mCertificate != null) {
    outState.putBundle("certificate",SslCertificate.saveState(mCertificate));
  }
  return list;
}
