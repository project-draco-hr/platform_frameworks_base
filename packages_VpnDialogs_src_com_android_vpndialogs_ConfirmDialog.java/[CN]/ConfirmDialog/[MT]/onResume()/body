{
  super.onResume();
  try {
    mPackage=getCallingPackage();
    mService=IConnectivityManager.Stub.asInterface(ServiceManager.getService(Context.CONNECTIVITY_SERVICE));
    if (mService.prepareVpn(mPackage,null,UserHandle.myUserId())) {
      setResult(RESULT_OK);
      finish();
      return;
    }
    View view=View.inflate(this,R.layout.confirm,null);
    ((TextView)view.findViewById(R.id.warning)).setText(Html.fromHtml(getString(R.string.warning,VpnConfig.getVpnLabel(this,mPackage)),this,null));
    mAlertParams.mTitle=getText(R.string.prompt);
    mAlertParams.mPositiveButtonText=getText(android.R.string.ok);
    mAlertParams.mPositiveButtonListener=this;
    mAlertParams.mNegativeButtonText=getText(android.R.string.cancel);
    mAlertParams.mView=view;
    setupAlert();
    getWindow().setCloseOnTouchOutside(false);
    mButton=mAlert.getButton(DialogInterface.BUTTON_POSITIVE);
    mButton.setFilterTouchesWhenObscured(true);
  }
 catch (  Exception e) {
    Log.e(TAG,"onResume",e);
    finish();
  }
}
