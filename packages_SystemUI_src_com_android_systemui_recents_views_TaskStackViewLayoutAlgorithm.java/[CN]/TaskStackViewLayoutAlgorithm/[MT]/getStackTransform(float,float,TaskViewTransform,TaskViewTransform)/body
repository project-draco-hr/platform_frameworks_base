{
  float stackOverscroll=(stackScroll - mMaxStackScrollP) / mFreeformWorkspacePOffset;
  int overscrollYOffset=0;
  if (mNumFreeformTasks > 0) {
    overscrollYOffset=(int)(Math.max(0,stackOverscroll) * mFreeformRect.height());
  }
  if ((mNumFreeformTasks > 0) && (stackScroll > mMaxStackScrollP) && (taskProgress > mFrontMostTaskP)) {
    int taskIndex=Math.round(taskProgress - (mFrontMostTaskP + 1));
    int x=taskIndex % mFreeformCellXCount;
    int y=taskIndex / mFreeformCellXCount;
    int frontTaskBottom=mStackRect.height() - mTaskBottomOffset;
    float scale=(float)mFreeformCellWidth / mTaskRect.width();
    int scaleXOffset=(int)(((1f - scale) * mTaskRect.width()) / 2);
    int scaleYOffset=(int)(((1f - scale) * mTaskRect.height()) / 2);
    transformOut.scale=scale;
    transformOut.translationX=x * mFreeformCellWidth - scaleXOffset;
    transformOut.translationY=frontTaskBottom - overscrollYOffset + (y * mFreeformCellHeight) - scaleYOffset;
    transformOut.visible=true;
    return transformOut;
  }
 else   if (mNumStackTasks == 1) {
    float pTaskRelative=mMinScrollP - stackScroll;
    float scale=SINGLE_TASK_SCALE;
    int topOffset=(mStackRect.height() - mTaskBottomOffset - mTaskRect.height()) / 2;
    transformOut.scale=scale;
    transformOut.translationY=(int)(topOffset + (pTaskRelative * mStackRect.height())) - overscrollYOffset;
    transformOut.translationZ=mMaxTranslationZ;
    transformOut.rect.set(mTaskRect);
    transformOut.rect.offset(0,transformOut.translationY);
    Utilities.scaleRectAboutCenter(transformOut.rect,transformOut.scale);
    transformOut.visible=true;
    transformOut.p=pTaskRelative;
    return transformOut;
  }
 else {
    float pTaskRelative=taskProgress - stackScroll;
    if (mNumFreeformTasks > 0) {
      pTaskRelative=Math.min(mMaxStackScrollP,pTaskRelative);
    }
    float pBounded=Math.max(0,Math.min(pTaskRelative,1f));
    if (pTaskRelative > 1f) {
      transformOut.reset();
      transformOut.rect.set(mTaskRect);
      return transformOut;
    }
    if (pTaskRelative < 0f) {
      if (prevTransform != null && Float.compare(prevTransform.p,0f) <= 0) {
        transformOut.reset();
        transformOut.rect.set(mTaskRect);
        return transformOut;
      }
    }
    float scale=sCurve.pToScale(pBounded);
    int scaleYOffset=(int)(((1f - scale) * mTaskRect.height()) / 2);
    transformOut.scale=scale;
    transformOut.translationY=sCurve.pToX(pBounded,mStackRect) - mStackRect.top - scaleYOffset- overscrollYOffset;
    transformOut.translationZ=Math.max(mMinTranslationZ,mMinTranslationZ + (pBounded * (mMaxTranslationZ - mMinTranslationZ)));
    transformOut.rect.set(mTaskRect);
    transformOut.rect.offset(0,transformOut.translationY);
    Utilities.scaleRectAboutCenter(transformOut.rect,transformOut.scale);
    transformOut.visible=true;
    transformOut.p=pTaskRelative;
    return transformOut;
  }
}
