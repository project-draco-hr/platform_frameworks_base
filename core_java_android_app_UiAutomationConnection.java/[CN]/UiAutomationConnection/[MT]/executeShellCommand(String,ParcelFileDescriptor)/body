{
synchronized (mLock) {
    throwIfCalledByNotTrustedUidLocked();
    throwIfShutdownLocked();
    throwIfNotConnectedLocked();
  }
  InputStream in=null;
  OutputStream out=null;
  try {
    java.lang.Process process=Runtime.getRuntime().exec(command);
    in=process.getInputStream();
    out=new FileOutputStream(sink.getFileDescriptor());
    final byte[] buffer=new byte[8192];
    while (true) {
      final int readByteCount=in.read(buffer);
      if (readByteCount < 0) {
        break;
      }
      out.write(buffer,0,readByteCount);
    }
  }
 catch (  IOException ioe) {
    throw new RuntimeException("Error running shell command",ioe);
  }
 finally {
    IoUtils.closeQuietly(in);
    IoUtils.closeQuietly(out);
    IoUtils.closeQuietly(sink);
  }
}
