{
  int status;
  status=mCameraUser.flush(null);
  assertEquals(CameraBinderTestUtils.NO_ERROR,status);
  CaptureRequest request=createDefaultBuilder(true).build();
  status=mCameraUser.flush(null);
  assertEquals(CameraBinderTestUtils.NO_ERROR,status);
  int requestId1=submitCameraRequest(request,false);
  int requestId2=submitCameraRequest(request,false);
  int requestId3=submitCameraRequest(request,false);
  int requestId4=submitCameraRequest(request,false);
  int requestId5=submitCameraRequest(request,false);
  status=mCameraUser.flush(null);
  assertEquals(CameraBinderTestUtils.NO_ERROR,status);
  verify(mMockCb,timeout(WAIT_FOR_FLUSH_TIMEOUT_MS).times(1)).onDeviceIdle();
  int streamingId=submitCameraRequest(request,true);
  SystemClock.sleep(WAIT_FOR_WORK_MS);
  status=mCameraUser.flush(null);
  assertEquals(CameraBinderTestUtils.NO_ERROR,status);
  verify(mMockCb,timeout(WAIT_FOR_FLUSH_TIMEOUT_MS).times(2)).onDeviceIdle();
}
