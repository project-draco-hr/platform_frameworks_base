{
  final int N=mAmbientLightRingBuffer.size();
  for (int i=0; i < N; i++) {
    if (mAmbientLightRingBuffer.getLux(i) >= mDarkeningLuxThreshold) {
      long nextCheck;
      if (i + 1 < N) {
        nextCheck=mAmbientLightRingBuffer.getTime(i + 1) + AMBIENT_LIGHT_HORIZON;
      }
 else {
        nextCheck=time + DARKENING_LIGHT_DEBOUNCE;
      }
      if (DEBUG) {
        Slog.e(TAG,"{lux= " + mAmbientLightRingBuffer.getLux(i) + ", time= "+ mAmbientLightRingBuffer.getTime(i)+ "} is above darkening threshold, checking again in "+ TimeUtils.formatUptime(nextCheck));
      }
      return nextCheck;
    }
  }
  if (N == 0) {
    long nextCheck=time + DARKENING_LIGHT_DEBOUNCE;
    if (DEBUG) {
      Slog.e(TAG,"No data, checking again in " + TimeUtils.formatUptime(nextCheck));
    }
    return nextCheck;
  }
  if (time - mAmbientLightRingBuffer.getTime(0) < DARKENING_LIGHT_DEBOUNCE) {
    long nextCheck=mAmbientLightRingBuffer.getTime(0) + DARKENING_LIGHT_DEBOUNCE;
    if (DEBUG) {
      Slog.e(TAG,"{lux= " + mAmbientLightRingBuffer.getLux(0) + ", time= "+ mAmbientLightRingBuffer.getTime(0)+ "} hasn't passed debounce threshold, checking again in "+ TimeUtils.formatUptime(nextCheck));
    }
    return nextCheck;
  }
  return 0;
}
