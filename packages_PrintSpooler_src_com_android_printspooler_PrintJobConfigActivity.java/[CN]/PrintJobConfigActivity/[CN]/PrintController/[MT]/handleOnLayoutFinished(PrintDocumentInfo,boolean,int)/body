{
  if (mRequestCounter.get() != sequence) {
    return;
  }
  if (isCancelled()) {
    mEditor.updateUi();
    if (mEditor.isDone()) {
      PrintJobConfigActivity.this.finish();
    }
    return;
  }
  mControllerState=CONTROLLER_STATE_LAYOUT_COMPLETED;
  final boolean infoChanged=!equalsIgnoreSize(info,mDocument.info);
  if (infoChanged) {
    mDocument.info=info;
    PrintSpoolerService.peekInstance().setPrintJobPrintDocumentInfoNoPersistence(mPrintJobId,info);
  }
  if (infoChanged || layoutChanged) {
    mDocument.pages=null;
    PrintSpoolerService.peekInstance().setPrintJobPagesNoPersistence(mPrintJobId,null);
  }
  mRequestedPages=mEditor.getRequestedPages();
  if (mRequestedPages == null || mRequestedPages.length == 0) {
    mEditor.updateUi();
    if (mEditor.isDone()) {
      PrintJobConfigActivity.this.finish();
    }
    return;
  }
 else {
    if (!mEditor.isPrintConfirmed()) {
      if (ALL_PAGES_ARRAY.equals(mRequestedPages)) {
        mRequestedPages=new PageRange[]{new PageRange(0,0)};
      }
 else {
        final int firstPage=mRequestedPages[0].getStart();
        mRequestedPages=new PageRange[]{new PageRange(firstPage,firstPage)};
      }
    }
  }
  if (!infoChanged && !layoutChanged && PageRangeUtils.contains(mDocument.pages,mRequestedPages)) {
    updatePrintJobPages(mDocument.pages,mRequestedPages);
    mEditor.updateUi();
    if (mEditor.isDone()) {
      requestCreatePdfFileOrFinish();
    }
    return;
  }
  mEditor.updateUi();
  mControllerState=CONTROLLER_STATE_WRITE_STARTED;
  mRemotePrintAdapter.write(mRequestedPages,mWriteResultCallback,mRequestCounter.incrementAndGet());
}
