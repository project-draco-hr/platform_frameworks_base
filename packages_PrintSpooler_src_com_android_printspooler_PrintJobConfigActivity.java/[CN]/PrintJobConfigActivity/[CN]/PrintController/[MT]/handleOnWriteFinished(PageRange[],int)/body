{
  if (mRequestCounter.get() != sequence) {
    return;
  }
  if (isCancelled()) {
    if (mEditor.isDone()) {
      PrintJobConfigActivity.this.finish();
    }
    return;
  }
  mControllerState=CONTROLLER_STATE_WRITE_COMPLETED;
  mDocument.pages=PageRangeUtils.normalize(pages);
  if (DEBUG) {
    Log.i(LOG_TAG,"Requested: " + Arrays.toString(mRequestedPages) + " and got: "+ Arrays.toString(mDocument.pages));
  }
  if (Arrays.equals(mDocument.pages,mRequestedPages)) {
    mSpooler.setPrintJobPagesNoPersistence(mPrintJobId,ALL_PAGES_ARRAY);
  }
 else   if (Arrays.equals(mDocument.pages,ALL_PAGES_ARRAY)) {
    mSpooler.setPrintJobPagesNoPersistence(mPrintJobId,mRequestedPages);
  }
 else   if (PageRangeUtils.contains(mDocument.pages,mRequestedPages)) {
    final int offset=mDocument.pages[0].getStart() - pages[0].getStart();
    PageRange[] offsetPages=Arrays.copyOf(mDocument.pages,mDocument.pages.length);
    PageRangeUtils.offsetStart(offsetPages,offset);
    mSpooler.setPrintJobPagesNoPersistence(mPrintJobId,offsetPages);
  }
 else   if (Arrays.equals(mRequestedPages,ALL_PAGES_ARRAY) && mDocument.pages.length == 1 && mDocument.pages[0].getStart() == 0 && mDocument.pages[0].getEnd() == mDocument.info.getPageCount() - 1) {
    mSpooler.setPrintJobPagesNoPersistence(mPrintJobId,mDocument.pages);
  }
 else {
    mControllerState=CONTROLLER_STATE_FAILED;
    Log.e(LOG_TAG,"Received invalid pages from the app");
    PrintJobConfigActivity.this.finish();
  }
  if (mEditor.isDone()) {
    PrintJobConfigActivity.this.finish();
  }
}
