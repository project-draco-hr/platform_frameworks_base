{
  PrintAttributes defaults=capabilities.getDefaults();
  List<MediaSize> sortedMediaSizes=new ArrayList<MediaSize>(capabilities.getMediaSizes());
  Collections.sort(sortedMediaSizes,mMediaSizeComparator);
  MediaSize currMediaSize=mCurrPrintAttributes.getMediaSize();
  if (currMediaSize == null) {
    mCurrPrintAttributes.setMediaSize(defaults.getMediaSize());
  }
 else {
    MediaSize currMediaSizePortrait=currMediaSize.asPortrait();
    final int mediaSizeCount=sortedMediaSizes.size();
    for (int i=0; i < mediaSizeCount; i++) {
      MediaSize mediaSize=sortedMediaSizes.get(i);
      if (currMediaSizePortrait.equals(mediaSize.asPortrait())) {
        mCurrPrintAttributes.setMediaSize(currMediaSize);
        break;
      }
    }
  }
  final int colorMode=mCurrPrintAttributes.getColorMode();
  if ((capabilities.getColorModes() & colorMode) == 0) {
    mCurrPrintAttributes.setColorMode(colorMode);
  }
  Resolution resolution=mCurrPrintAttributes.getResolution();
  if (resolution == null || !capabilities.getResolutions().contains(resolution)) {
    mCurrPrintAttributes.setResolution(defaults.getResolution());
  }
  Margins margins=mCurrPrintAttributes.getMinMargins();
  if (margins == null) {
    mCurrPrintAttributes.setMinMargins(defaults.getMinMargins());
  }
 else {
    Margins minMargins=capabilities.getMinMargins();
    if (margins.getLeftMils() < minMargins.getLeftMils() || margins.getTopMils() < minMargins.getTopMils() || margins.getRightMils() > minMargins.getRightMils() || margins.getBottomMils() > minMargins.getBottomMils()) {
      mCurrPrintAttributes.setMinMargins(defaults.getMinMargins());
    }
  }
}
