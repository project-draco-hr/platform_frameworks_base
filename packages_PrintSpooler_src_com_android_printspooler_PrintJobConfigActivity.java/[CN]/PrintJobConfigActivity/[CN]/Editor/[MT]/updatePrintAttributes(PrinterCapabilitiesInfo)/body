{
  PrintAttributes defaults=mTempPrintAttributes;
  capabilities.getDefaults(defaults);
  MediaSize currMediaSize=mCurrPrintAttributes.getMediaSize();
  if (currMediaSize == null) {
    mCurrPrintAttributes.setMediaSize(defaults.getMediaSize());
  }
 else {
    MediaSize currMediaSizePortrait=currMediaSize.asPortrait();
    List<MediaSize> mediaSizes=capabilities.getMediaSizes();
    final int mediaSizeCount=mediaSizes.size();
    for (int i=0; i < mediaSizeCount; i++) {
      MediaSize mediaSize=mediaSizes.get(i);
      if (currMediaSizePortrait.equals(mediaSize.asPortrait())) {
        mCurrPrintAttributes.setMediaSize(mediaSize);
        break;
      }
    }
  }
  final int colorMode=mCurrPrintAttributes.getColorMode();
  if ((capabilities.getColorModes() & colorMode) == 0) {
    mCurrPrintAttributes.setColorMode(colorMode);
  }
  Resolution resolution=mCurrPrintAttributes.getResolution();
  if (resolution == null || !capabilities.getResolutions().contains(resolution)) {
    mCurrPrintAttributes.setResolution(defaults.getResolution());
  }
  Margins margins=mCurrPrintAttributes.getMargins();
  if (margins == null) {
    mCurrPrintAttributes.setMargins(defaults.getMargins());
  }
 else {
    Margins minMargins=capabilities.getMinMargins();
    if (margins.getLeftMils() < minMargins.getLeftMils() || margins.getTopMils() < minMargins.getTopMils() || margins.getRightMils() > minMargins.getRightMils() || margins.getBottomMils() > minMargins.getBottomMils()) {
      mCurrPrintAttributes.setMargins(defaults.getMargins());
    }
  }
}
