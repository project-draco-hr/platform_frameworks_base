{
  final byte[] reply=HexEncoding.decode(WORKING_VERSION4.toCharArray(),false);
  for (int i=0; i <= 7; i++) {
    final String logMsg="mode: " + i;
    reply[0]&=(byte)0xf8;
    reply[0]|=(byte)i;
    mServer.setServerReply(reply);
    final boolean rval=mClient.requestTime(mServer.getAddress(),mServer.getPort(),500);
switch (i) {
case NTP_MODE_SERVER:
case NTP_MODE_BROADCAST:
      assertTrue(logMsg,rval);
    break;
default :
  assertFalse(logMsg,rval);
break;
}
assertEquals(logMsg,1,mServer.numRequestsReceived());
assertEquals(logMsg,1,mServer.numRepliesSent());
}
}
