{
  if (intent.getAction().equals(TelephonyIntents.ACTION_ANY_DATA_CONNECTION_STATE_CHANGED)) {
    Phone.DataState state=getMobileDataState(intent);
    String reason=intent.getStringExtra(Phone.STATE_CHANGE_REASON_KEY);
    String apnName=intent.getStringExtra(Phone.DATA_APN_KEY);
    String apnTypeList=intent.getStringExtra(Phone.DATA_APN_TYPES_KEY);
    boolean unavailable=intent.getBooleanExtra(Phone.NETWORK_UNAVAILABLE_KEY,false);
    if (DBG)     Log.d(TAG,mApnType + " Received " + intent.getAction()+ " broadcast - state = "+ state+ ", unavailable = "+ unavailable+ ", reason = "+ (reason == null ? "(unspecified)" : reason));
    if ((!isApnTypeIncluded(apnTypeList)) || mEnabled == false) {
      if (DBG)       Log.e(TAG,"  dropped - mEnabled = " + mEnabled);
      return;
    }
    mNetworkInfo.setIsAvailable(!unavailable);
    if (mMobileDataState != state) {
      mMobileDataState=state;
switch (state) {
case DISCONNECTED:
        if (mTeardownRequested) {
          mEnabled=false;
          mTeardownRequested=false;
        }
      setDetailedState(DetailedState.DISCONNECTED,reason,apnName);
    if (mInterfaceName != null) {
      NetworkUtils.resetConnections(mInterfaceName);
    }
  mInterfaceName=null;
mDefaultGatewayAddr=0;
break;
case CONNECTING:
setDetailedState(DetailedState.CONNECTING,reason,apnName);
break;
case SUSPENDED:
setDetailedState(DetailedState.SUSPENDED,reason,apnName);
break;
case CONNECTED:
mInterfaceName=intent.getStringExtra(Phone.DATA_IFACE_NAME_KEY);
if (mInterfaceName == null) {
Log.d(TAG,"CONNECTED event did not supply interface name.");
}
setDetailedState(DetailedState.CONNECTED,reason,apnName);
break;
}
}
}
 else if (intent.getAction().equals(TelephonyIntents.ACTION_DATA_CONNECTION_FAILED)) {
mEnabled=false;
String reason=intent.getStringExtra(Phone.FAILURE_REASON_KEY);
String apnName=intent.getStringExtra(Phone.DATA_APN_KEY);
if (DBG) Log.d(TAG,"Received " + intent.getAction() + " broadcast"+ reason == null ? "" : "(" + reason + ")");
setDetailedState(DetailedState.FAILED,reason,apnName);
}
TelephonyManager tm=TelephonyManager.getDefault();
setRoamingStatus(tm.isNetworkRoaming());
setSubtype(tm.getNetworkType(),tm.getNetworkTypeName());
}
