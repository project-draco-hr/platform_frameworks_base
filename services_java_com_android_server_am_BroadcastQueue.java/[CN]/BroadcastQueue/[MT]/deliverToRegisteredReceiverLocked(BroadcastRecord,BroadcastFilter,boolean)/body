{
  boolean skip=false;
  if (filter.requiredPermission != null) {
    int perm=mService.checkComponentPermission(filter.requiredPermission,r.callingPid,r.callingUid,-1,true);
    if (perm != PackageManager.PERMISSION_GRANTED) {
      Slog.w(TAG,"Permission Denial: broadcasting " + r.intent.toString() + " from "+ r.callerPackage+ " (pid="+ r.callingPid+ ", uid="+ r.callingUid+ ")"+ " requires "+ filter.requiredPermission+ " due to registered receiver "+ filter);
      skip=true;
    }
  }
  if (!skip && r.requiredPermission != null) {
    int perm=mService.checkComponentPermission(r.requiredPermission,filter.receiverList.pid,filter.receiverList.uid,-1,true);
    if (perm != PackageManager.PERMISSION_GRANTED) {
      Slog.w(TAG,"Permission Denial: receiving " + r.intent.toString() + " to "+ filter.receiverList.app+ " (pid="+ filter.receiverList.pid+ ", uid="+ filter.receiverList.uid+ ")"+ " requires "+ r.requiredPermission+ " due to sender "+ r.callerPackage+ " (uid "+ r.callingUid+ ")");
      skip=true;
    }
  }
  if (r.appOp != AppOpsManager.OP_NONE) {
    int mode=mService.mAppOpsService.checkOperation(r.appOp,filter.receiverList.uid,filter.packageName);
    if (mode != AppOpsManager.MODE_ALLOWED) {
      if (DEBUG_BROADCAST)       Slog.v(TAG,"App op " + r.appOp + " not allowed for broadcast to uid "+ filter.receiverList.uid+ " pkg "+ filter.packageName);
      skip=true;
    }
  }
  if (!skip) {
    if (ordered) {
      r.receiver=filter.receiverList.receiver.asBinder();
      r.curFilter=filter;
      filter.receiverList.curBroadcast=r;
      r.state=BroadcastRecord.CALL_IN_RECEIVE;
      if (filter.receiverList.app != null) {
        r.curApp=filter.receiverList.app;
        filter.receiverList.app.curReceiver=r;
        mService.updateOomAdjLocked();
      }
    }
    try {
      if (DEBUG_BROADCAST_LIGHT) {
        int seq=r.intent.getIntExtra("seq",-1);
        Slog.i(TAG,"Delivering to " + filter + " (seq="+ seq+ "): "+ r);
      }
      performReceiveLocked(filter.receiverList.app,filter.receiverList.receiver,new Intent(r.intent),r.resultCode,r.resultData,r.resultExtras,r.ordered,r.initialSticky,r.userId);
      if (ordered) {
        r.state=BroadcastRecord.CALL_DONE_RECEIVE;
      }
    }
 catch (    RemoteException e) {
      Slog.w(TAG,"Failure sending broadcast " + r.intent,e);
      if (ordered) {
        r.receiver=null;
        r.curFilter=null;
        filter.receiverList.curBroadcast=null;
        if (filter.receiverList.app != null) {
          filter.receiverList.app.curReceiver=null;
        }
      }
    }
  }
}
