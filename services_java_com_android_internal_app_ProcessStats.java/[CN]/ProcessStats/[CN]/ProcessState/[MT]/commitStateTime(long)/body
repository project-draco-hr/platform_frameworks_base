{
  if (mCurState != STATE_NOTHING) {
    long dur=now - mStartTime;
    if (dur > 0) {
      int idx=binarySearch(mDurationsTable,mDurationsTableSize,mCurState);
      int off;
      if (idx >= 0) {
        off=mDurationsTable[idx];
      }
 else {
        mProcessStats.mAddLongTable=mDurationsTable;
        mProcessStats.mAddLongTableSize=mDurationsTableSize;
        off=mProcessStats.addLongData(~idx,mCurState,1);
        mDurationsTable=mProcessStats.mAddLongTable;
        mDurationsTableSize=mProcessStats.mAddLongTableSize;
      }
      long[] longs=mProcessStats.mLongs.get((off >> OFFSET_ARRAY_SHIFT) & OFFSET_ARRAY_MASK);
      longs[(off >> OFFSET_INDEX_SHIFT) & OFFSET_INDEX_MASK]+=dur;
    }
  }
  mStartTime=now;
}
