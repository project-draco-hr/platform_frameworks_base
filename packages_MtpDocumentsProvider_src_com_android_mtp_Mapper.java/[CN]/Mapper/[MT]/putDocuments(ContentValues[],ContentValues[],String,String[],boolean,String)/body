{
  final SQLiteDatabase database=mDatabase.getSQLiteDatabase();
  boolean added=false;
  database.beginTransaction();
  try {
    for (int i=0; i < valuesList.length; i++) {
      final ContentValues values=valuesList[i];
      final ContentValues rootExtraValues;
      if (rootExtraValuesList != null) {
        rootExtraValues=rootExtraValuesList[i];
      }
 else {
        rootExtraValues=null;
      }
      final Cursor candidateCursor=database.query(TABLE_DOCUMENTS,strings(Document.COLUMN_DOCUMENT_ID),selection + " AND " + COLUMN_ROW_STATE+ "=? AND "+ mappingKey+ "=?",DatabaseUtils.appendSelectionArgs(args,strings(ROW_STATE_INVALIDATED,values.getAsString(mappingKey))),null,null,null,"1");
      try {
        final long rowId;
        if (candidateCursor.getCount() == 0) {
          rowId=database.insert(TABLE_DOCUMENTS,null,values);
          added=true;
        }
 else         if (!heuristic) {
          candidateCursor.moveToNext();
          rowId=candidateCursor.getLong(0);
          database.update(TABLE_DOCUMENTS,values,SELECTION_DOCUMENT_ID,strings(rowId));
        }
 else {
          values.put(COLUMN_ROW_STATE,ROW_STATE_PENDING);
          rowId=database.insertOrThrow(TABLE_DOCUMENTS,null,values);
        }
        values.put(Document.COLUMN_DOCUMENT_ID,rowId);
        if (rootExtraValues != null) {
          rootExtraValues.put(Root.COLUMN_ROOT_ID,rowId);
          database.replace(TABLE_ROOT_EXTRA,null,rootExtraValues);
        }
      }
  finally {
        candidateCursor.close();
      }
    }
    database.setTransactionSuccessful();
    return added;
  }
  finally {
    database.endTransaction();
  }
}
