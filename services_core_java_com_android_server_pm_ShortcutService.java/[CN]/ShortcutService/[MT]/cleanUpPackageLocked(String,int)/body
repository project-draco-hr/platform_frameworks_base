{
  final boolean wasUserLoaded=isUserLoadedLocked(userId);
  final ShortcutUser mUser=getUserShortcutsLocked(userId);
  boolean doNotify=false;
  if (mUser.getPackages().remove(packageName) != null) {
    doNotify=true;
  }
  mUser.getLaunchers().remove(packageName);
  for (int i=mUser.getLaunchers().size() - 1; i >= 0; i--) {
    mUser.getLaunchers().valueAt(i).cleanUpPackage(packageName);
  }
  for (int i=mUser.getPackages().size() - 1; i >= 0; i--) {
    mUser.getPackages().valueAt(i).refreshPinnedFlags(this);
  }
  mUser.getPackageInfos().remove(packageName);
  scheduleSaveUser(userId);
  if (doNotify) {
    notifyListeners(packageName,userId);
  }
  if (!wasUserLoaded) {
    unloadUserLocked(userId);
  }
}
