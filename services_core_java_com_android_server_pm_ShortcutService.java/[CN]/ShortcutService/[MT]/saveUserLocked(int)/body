{
  final File path=new File(injectUserDataPath(userId),FILENAME_USER_PACKAGES);
  if (DEBUG) {
    Slog.i(TAG,"Saving to " + path);
  }
  path.mkdirs();
  final AtomicFile file=new AtomicFile(path);
  FileOutputStream outs=null;
  try {
    outs=file.startWrite();
    XmlSerializer out=new FastXmlSerializer();
    out.setOutput(outs,StandardCharsets.UTF_8.name());
    out.startDocument(null,true);
    out.startTag(null,TAG_ROOT);
    final ArrayMap<String,PackageShortcuts> packages=getUserShortcutsLocked(userId);
    for (int i=0; i < packages.size(); i++) {
      final String packageName=packages.keyAt(i);
      final PackageShortcuts packageShortcuts=packages.valueAt(i);
      packageShortcuts.saveToXml(out);
    }
    out.endTag(null,TAG_ROOT);
    out.endDocument();
    file.finishWrite(outs);
  }
 catch (  IOException|XmlPullParserException e) {
    Slog.e(TAG,"Failed to write to file " + file.getBaseFile(),e);
    file.failWrite(outs);
  }
}
