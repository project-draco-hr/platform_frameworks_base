{
  verifyCaller(packageName,userId);
  final List<ShortcutInfo> newShortcuts=(List<ShortcutInfo>)shortcutInfoList.getList();
  final int size=newShortcuts.size();
synchronized (mLock) {
    final ShortcutPackage ps=getPackageShortcutsLocked(packageName,userId);
    ps.ensureNotShadowAndSave(this);
    if (!ps.tryApiCall(this)) {
      return false;
    }
    for (int i=0; i < size; i++) {
      final ShortcutInfo source=newShortcuts.get(i);
      fixUpIncomingShortcutInfo(source,true);
      final ShortcutInfo target=ps.findShortcutById(source.getId());
      if (target != null) {
        final boolean replacingIcon=(source.getIcon() != null);
        if (replacingIcon) {
          removeIcon(userId,target);
        }
        target.copyNonNullFieldsFrom(source);
        if (replacingIcon) {
          saveIconAndFixUpShortcut(userId,target);
        }
      }
    }
  }
  userPackageChanged(packageName,userId);
  return true;
}
