{
  final boolean wasUserLoaded=isUserLoadedLocked(owningUserId);
  final ShortcutUser mUser=getUserShortcutsLocked(owningUserId);
  boolean doNotify=false;
  if (packageUserId == owningUserId) {
    if (mUser.getPackages().remove(packageName) != null) {
      doNotify=true;
    }
  }
  mUser.removeLauncher(packageUserId,packageName);
  final ArrayMap<PackageWithUser,ShortcutLauncher> launchers=mUser.getAllLaunchers();
  for (int i=launchers.size() - 1; i >= 0; i--) {
    launchers.valueAt(i).cleanUpPackage(packageName);
  }
  for (int i=mUser.getPackages().size() - 1; i >= 0; i--) {
    mUser.getPackages().valueAt(i).refreshPinnedFlags(this);
  }
  mUser.removePackageInfo(packageUserId,packageName);
  scheduleSaveUser(owningUserId);
  if (doNotify) {
    notifyListeners(packageName,owningUserId);
  }
  if (!wasUserLoaded) {
    unloadUserLocked(owningUserId);
  }
}
