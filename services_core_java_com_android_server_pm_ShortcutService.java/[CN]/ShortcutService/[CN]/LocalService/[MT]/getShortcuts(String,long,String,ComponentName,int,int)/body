{
  final ArrayList<ShortcutInfo> ret=new ArrayList<>();
  final int cloneFlag=((queryFlags & ShortcutQuery.FLAG_GET_KEY_FIELDS_ONLY) == 0) ? ShortcutInfo.CLONE_REMOVE_FOR_LAUNCHER : ShortcutInfo.CLONE_REMOVE_NON_KEY_INFO;
synchronized (mLock) {
    if (packageName != null) {
      getShortcutsInnerLocked(packageName,changedSince,componentName,queryFlags,userId,ret,cloneFlag);
    }
 else {
      final ArrayMap<String,PackageShortcuts> packages=getUserShortcutsLocked(userId).getPackages();
      for (int i=packages.size() - 1; i >= 0; i--) {
        getShortcutsInnerLocked(packages.keyAt(i),changedSince,componentName,queryFlags,userId,ret,cloneFlag);
      }
    }
  }
  return ret;
}
