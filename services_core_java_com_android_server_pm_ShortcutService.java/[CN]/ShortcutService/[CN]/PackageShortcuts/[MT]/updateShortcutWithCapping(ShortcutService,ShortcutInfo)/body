{
  final ShortcutInfo oldShortcut=mShortcuts.get(newShortcut.getId());
  int oldFlags=0;
  int newDynamicCount=mDynamicShortcutCount;
  if (oldShortcut != null) {
    oldFlags=oldShortcut.getFlags();
    if (oldShortcut.isDynamic()) {
      newDynamicCount--;
    }
  }
  if (newShortcut.isDynamic()) {
    newDynamicCount++;
  }
  s.enforceMaxDynamicShortcuts(newDynamicCount);
  newShortcut.addFlags(oldFlags);
  mShortcuts.put(newShortcut.getId(),newShortcut);
  mDynamicShortcutCount=newDynamicCount;
}
