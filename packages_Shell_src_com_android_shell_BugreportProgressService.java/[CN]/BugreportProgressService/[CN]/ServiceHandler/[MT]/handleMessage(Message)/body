{
  if (msg.what == MSG_POLL) {
    pollProgress();
    return;
  }
  if (msg.what != MSG_SERVICE_COMMAND) {
    Log.e(TAG,"Invalid message type: " + msg.what);
    return;
  }
  if (!(msg.obj instanceof Intent)) {
    Log.e(TAG,"Internal error: invalid msg.obj: " + msg.obj);
    return;
  }
  final Parcelable parcel=((Intent)msg.obj).getParcelableExtra(EXTRA_ORIGINAL_INTENT);
  if (!(parcel instanceof Intent)) {
    Log.e(TAG,"Internal error: msg.obj is missing extra " + EXTRA_ORIGINAL_INTENT);
    return;
  }
  final Intent intent=(Intent)parcel;
  final String action=intent.getAction();
  int pid=intent.getIntExtra(EXTRA_PID,0);
  int max=intent.getIntExtra(EXTRA_MAX,-1);
  String name=intent.getStringExtra(EXTRA_NAME);
  if (DEBUG)   Log.v(TAG,"action: " + action + ", name: "+ name+ ", pid: "+ pid+ ", max: "+ max);
switch (action) {
case INTENT_BUGREPORT_STARTED:
    if (!startProgress(name,pid,max)) {
      stopSelfWhenDone();
      return;
    }
  break;
case INTENT_BUGREPORT_FINISHED:
if (pid == -1) {
  Log.w(TAG,"Missing " + EXTRA_PID + " on intent "+ intent);
}
stopProgress(pid,intent);
break;
case INTENT_BUGREPORT_CANCEL:
cancel(pid);
break;
default :
Log.w(TAG,"Unsupported intent: " + action);
}
return;
}
