{
  if (delay > 0) {
    Log.d(TAG,"Taking screenshot for " + pid + " in "+ delay+ " seconds");
    final Message msg=mMainHandler.obtainMessage();
    msg.what=MSG_DELAYED_SCREENSHOT;
    msg.arg1=pid;
    msg.arg2=delay - 1;
    mMainHandler.sendMessageDelayed(msg,DateUtils.SECOND_IN_MILLIS);
    return;
  }
  final BugreportInfo info=getInfo(pid);
  if (info == null) {
    return;
  }
  final String screenshotPath=new File(mScreenshotsDir,info.getPathNextScreenshot()).getAbsolutePath();
  final Message requestMsg=new Message();
  requestMsg.what=MSG_SCREENSHOT_REQUEST;
  requestMsg.arg1=pid;
  requestMsg.obj=screenshotPath;
  mScreenshotHandler.sendMessage(requestMsg);
}
