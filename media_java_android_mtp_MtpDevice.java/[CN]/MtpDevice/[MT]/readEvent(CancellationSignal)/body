{
  final int handle=native_submit_event_request();
  if (handle < 0) {
    throw new IllegalStateException("Other thread is reading an event.");
  }
  if (signal != null) {
    signal.setOnCancelListener(new CancellationSignal.OnCancelListener(){
      @Override public void onCancel(){
        native_discard_event_request(handle);
      }
    }
);
  }
  try {
    return native_reap_event_request(handle);
  }
  finally {
    if (signal != null) {
      signal.setOnCancelListener(null);
    }
  }
}
