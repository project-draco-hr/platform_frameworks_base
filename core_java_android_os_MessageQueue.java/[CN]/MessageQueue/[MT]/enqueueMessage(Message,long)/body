{
  if (msg.when != 0) {
    throw new AndroidRuntimeException(msg + " This message is already in use.");
  }
  if (msg.target == null && !mQuitAllowed) {
    throw new RuntimeException("Main thread not allowed to quit");
  }
synchronized (this) {
    if (mQuiting) {
      RuntimeException e=new RuntimeException(msg.target + " sending message to a Handler on a dead thread");
      Log.w("MessageQueue",e.getMessage(),e);
      return false;
    }
 else     if (msg.target == null) {
      mQuiting=true;
    }
    msg.when=when;
    Message p=mMessages;
    if (p == null || when == 0 || when < p.when) {
      msg.next=p;
      mMessages=msg;
      this.notify();
    }
 else {
      Message prev=null;
      while (p != null && p.when <= when) {
        prev=p;
        p=p.next;
      }
      msg.next=prev.next;
      prev.next=msg;
      this.notify();
    }
  }
  return true;
}
