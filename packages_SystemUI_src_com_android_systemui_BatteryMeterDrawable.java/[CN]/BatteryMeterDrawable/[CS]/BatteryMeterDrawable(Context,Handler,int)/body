{
  mContext=context;
  mHandler=handler;
  final Resources res=context.getResources();
  TypedArray levels=res.obtainTypedArray(R.array.batterymeter_color_levels);
  TypedArray colors=res.obtainTypedArray(R.array.batterymeter_color_values);
  final int N=levels.length();
  mColors=new int[2 * N];
  for (int i=0; i < N; i++) {
    mColors[2 * i]=levels.getInt(i,0);
    mColors[2 * i + 1]=colors.getColor(i,0);
  }
  levels.recycle();
  colors.recycle();
  updateShowPercent();
  mWarningString=context.getString(R.string.battery_meter_very_low_overlay_symbol);
  mCriticalLevel=mContext.getResources().getInteger(com.android.internal.R.integer.config_criticalBatteryWarningLevel);
  mButtonHeightFraction=context.getResources().getFraction(R.fraction.battery_button_height_fraction,1,1);
  mSubpixelSmoothingLeft=context.getResources().getFraction(R.fraction.battery_subpixel_smoothing_left,1,1);
  mSubpixelSmoothingRight=context.getResources().getFraction(R.fraction.battery_subpixel_smoothing_right,1,1);
  mFramePaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  mFramePaint.setColor(frameColor);
  mFramePaint.setDither(true);
  mFramePaint.setStrokeWidth(0);
  mFramePaint.setStyle(Paint.Style.FILL_AND_STROKE);
  mBatteryPaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  mBatteryPaint.setDither(true);
  mBatteryPaint.setStrokeWidth(0);
  mBatteryPaint.setStyle(Paint.Style.FILL_AND_STROKE);
  mTextPaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  Typeface font=Typeface.create("sans-serif-condensed",Typeface.BOLD);
  mTextPaint.setTypeface(font);
  mTextPaint.setTextAlign(Paint.Align.CENTER);
  mWarningTextPaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  mWarningTextPaint.setColor(mColors[1]);
  font=Typeface.create("sans-serif",Typeface.BOLD);
  mWarningTextPaint.setTypeface(font);
  mWarningTextPaint.setTextAlign(Paint.Align.CENTER);
  mChargeColor=context.getColor(R.color.batterymeter_charge_color);
  mBoltPaint=new Paint(Paint.ANTI_ALIAS_FLAG);
  mBoltPaint.setColor(context.getColor(R.color.batterymeter_bolt_color));
  mBoltPoints=loadBoltPoints(res);
  mDarkModeBackgroundColor=context.getColor(R.color.dark_mode_icon_color_dual_tone_background);
  mDarkModeFillColor=context.getColor(R.color.dark_mode_icon_color_dual_tone_fill);
  mLightModeBackgroundColor=context.getColor(R.color.light_mode_icon_color_dual_tone_background);
  mLightModeFillColor=context.getColor(R.color.light_mode_icon_color_dual_tone_fill);
}
