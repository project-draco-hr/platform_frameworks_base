{
  if ((headsetState & headset) != (prevHeadsetState & headset)) {
    int state=0;
    if ((headsetState & headset) != 0) {
      state=1;
    }
    if ((headset == BIT_USB_HEADSET_ANLG) || (headset == BIT_USB_HEADSET_DGTL) || (headset == BIT_HDMI_AUDIO)) {
      Intent intent;
      if (headset == BIT_USB_HEADSET_ANLG) {
        intent=new Intent(Intent.ACTION_USB_ANLG_HEADSET_PLUG);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
        intent.putExtra("state",state);
        intent.putExtra("name",headsetName);
        ActivityManagerNative.broadcastStickyIntent(intent,null);
      }
 else       if (headset == BIT_USB_HEADSET_DGTL) {
        intent=new Intent(Intent.ACTION_USB_DGTL_HEADSET_PLUG);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
        intent.putExtra("state",state);
        intent.putExtra("name",headsetName);
        ActivityManagerNative.broadcastStickyIntent(intent,null);
      }
 else       if (headset == BIT_HDMI_AUDIO) {
        intent=new Intent(Intent.ACTION_HDMI_AUDIO_PLUG);
        intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
        intent.putExtra("state",state);
        intent.putExtra("name",headsetName);
        ActivityManagerNative.broadcastStickyIntent(intent,null);
      }
      if (LOG)       Slog.v(TAG,"Intent.ACTION_USB_HEADSET_PLUG: state: " + state + " name: "+ headsetName);
    }
    if ((headset == BIT_HEADSET) || (headset == BIT_HEADSET_NO_MIC)) {
      Intent intent=new Intent(Intent.ACTION_HEADSET_PLUG);
      intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
      int microphone=0;
      if ((headset & HEADSETS_WITH_MIC) != 0) {
        microphone=1;
      }
      intent.putExtra("state",state);
      intent.putExtra("name",headsetName);
      intent.putExtra("microphone",microphone);
      if (LOG)       Slog.v(TAG,"Intent.ACTION_HEADSET_PLUG: state: " + state + " name: "+ headsetName+ " mic: "+ microphone);
      ActivityManagerNative.broadcastStickyIntent(intent,null);
    }
  }
}
