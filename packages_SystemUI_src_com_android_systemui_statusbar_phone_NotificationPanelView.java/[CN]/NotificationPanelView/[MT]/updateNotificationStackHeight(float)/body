{
  float childOffset=getRelativeTop(mNotificationStackScroller) - mNotificationParent.getTranslationY();
  int newStackHeight=(int)(expandedHeight - childOffset);
  int itemHeight=mNotificationStackScroller.getItemHeight();
  int bottomStackPeekSize=mNotificationStackScroller.getBottomStackPeekSize();
  int minStackHeight=itemHeight + bottomStackPeekSize;
  if (newStackHeight >= minStackHeight) {
    mNotificationParent.setTranslationY(0);
    mNotificationStackScroller.setCurrentStackHeight(newStackHeight);
  }
 else {
    int translationY=(newStackHeight - minStackHeight);
    float partiallyThere=(float)newStackHeight / minStackHeight;
    partiallyThere=Math.max(0,partiallyThere);
    translationY+=(1 - partiallyThere) * bottomStackPeekSize;
    mNotificationParent.setTranslationY(translationY);
    mNotificationStackScroller.setCurrentStackHeight((int)(expandedHeight - (childOffset + translationY)));
  }
}
