{
  height=Math.min(Math.max(height,mQsMinExpansionHeight),mQsMaxExpansionHeight);
  mQsFullyExpanded=height == mQsMaxExpansionHeight && mQsMaxExpansionHeight != 0;
  if (height > mQsMinExpansionHeight && !mQsExpanded && !mStackScrollerOverscrolling) {
    setQsExpanded(true);
  }
 else   if (height <= mQsMinExpansionHeight && mQsExpanded) {
    setQsExpanded(false);
    if (mLastAnnouncementWasQuickSettings && !mTracking && !isCollapsing()) {
      announceForAccessibility(getKeyguardOrLockScreenString());
      mLastAnnouncementWasQuickSettings=false;
    }
  }
  mQsExpansionHeight=height;
  mHeader.setExpansion(getHeaderExpansionFraction());
  setQsTranslation(height);
  requestScrollerTopPaddingUpdate(false);
  updateNotificationScrim(height);
  if (mKeyguardShowing) {
    updateHeaderKeyguard();
  }
  if (mStatusBarState == StatusBarState.SHADE_LOCKED || mStatusBarState == StatusBarState.KEYGUARD) {
    updateKeyguardBottomAreaAlpha();
  }
  if (mStatusBarState == StatusBarState.SHADE && mQsExpanded && !mStackScrollerOverscrolling && mQsScrimEnabled) {
    mQsNavbarScrim.setAlpha(getQsExpansionFraction());
  }
  if (height != 0.0f && mQsFullyExpanded && !mLastAnnouncementWasQuickSettings) {
    announceForAccessibility(getContext().getString(R.string.accessibility_desc_quick_settings));
    mLastAnnouncementWasQuickSettings=true;
  }
  if (mQsFullyExpanded && mFalsingManager.shouldEnforceBouncer()) {
    mStatusBar.executeRunnableDismissingKeyguard(null,null,false,true);
  }
  if (DEBUG) {
    invalidate();
  }
}
