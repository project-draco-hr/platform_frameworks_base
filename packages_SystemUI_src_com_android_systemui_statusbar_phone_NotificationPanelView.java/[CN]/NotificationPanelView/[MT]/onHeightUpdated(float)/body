{
  if (!mQsExpanded) {
    positionClockAndNotifications();
  }
  if (mQsExpanded && !mQsTracking && mQsExpansionAnimator == null && !mQsExpansionFromOverscroll) {
    float panelHeightQsCollapsed=mNotificationStackScroller.getIntrinsicPadding() + mNotificationStackScroller.getMinStackHeight() + mNotificationStackScroller.getNotificationTopPadding();
    float panelHeightQsExpanded=calculatePanelHeightQsExpanded();
    float t=(expandedHeight - panelHeightQsCollapsed) / (panelHeightQsExpanded - panelHeightQsCollapsed);
    int qsTempMaxExpansion=mQsMaxExpansionHeight;
    if (mScrollYOverride != -1) {
      qsTempMaxExpansion-=mScrollYOverride;
    }
    setQsExpansion(mQsMinExpansionHeight + t * (qsTempMaxExpansion - mQsMinExpansionHeight));
  }
  mNotificationStackScroller.setStackHeight(expandedHeight);
  updateHeader();
  updateUnlockIcon();
  updateNotificationTranslucency();
}
