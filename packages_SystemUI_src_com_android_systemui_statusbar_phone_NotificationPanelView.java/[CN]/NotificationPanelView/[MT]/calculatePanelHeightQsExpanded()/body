{
  float notificationHeight=mNotificationStackScroller.getHeight() - mNotificationStackScroller.getEmptyBottomMargin() - mNotificationStackScroller.getTopPadding();
  if (mNotificationStackScroller.getNotGoneChildCount() == 0 && mShadeEmpty) {
    notificationHeight=mNotificationStackScroller.getEmptyShadeViewHeight() + mNotificationStackScroller.getBottomStackPeekSize() + mNotificationStackScroller.getCollapseSecondCardPadding();
  }
  float totalHeight=Math.max(mQsMaxExpansionHeight + mNotificationStackScroller.getNotificationTopPadding(),mStatusBarState == StatusBarState.KEYGUARD ? mClockPositionResult.stackScrollerPadding - mTopPaddingAdjustment : 0) + notificationHeight;
  if (totalHeight > mNotificationStackScroller.getHeight()) {
    float fullyCollapsedHeight=mQsMaxExpansionHeight + mNotificationStackScroller.getMinStackHeight() + mNotificationStackScroller.getNotificationTopPadding() - getScrollViewScrollY();
    totalHeight=Math.max(fullyCollapsedHeight,mNotificationStackScroller.getHeight());
  }
  return (int)totalHeight;
}
