{
  int oldState=mStatusBarState;
  boolean keyguardShowing=statusBarState == StatusBarState.KEYGUARD;
  setKeyguardStatusViewVisibility(statusBarState,keyguardFadingAway,goingToFullShade);
  setKeyguardBottomAreaVisibility(statusBarState,goingToFullShade);
  mStatusBarState=statusBarState;
  mKeyguardShowing=keyguardShowing;
  if (goingToFullShade || (oldState == StatusBarState.KEYGUARD && statusBarState == StatusBarState.SHADE_LOCKED)) {
    animateKeyguardStatusBarOut();
    animateHeaderSlidingIn();
  }
 else   if (oldState == StatusBarState.SHADE_LOCKED && statusBarState == StatusBarState.KEYGUARD) {
    animateKeyguardStatusBarIn(StackStateAnimator.ANIMATION_DURATION_STANDARD);
    animateHeaderSlidingOut();
  }
 else {
    mKeyguardStatusBar.setAlpha(1f);
    mKeyguardStatusBar.setVisibility(keyguardShowing ? View.VISIBLE : View.INVISIBLE);
  }
  updateQsState();
}
