{
  final int action=event.getActionMasked();
  if (action == MotionEvent.ACTION_DOWN && getExpandedFraction() == 1f && mStatusBar.getBarState() != StatusBarState.KEYGUARD && !mQsExpanded && mQsExpansionEnabled) {
    mQsTracking=true;
    mConflictingQsExpansionGesture=true;
    onQsExpansionStarted();
    mInitialHeightOnTouch=mQsExpansionHeight;
    mInitialTouchY=event.getX();
    mInitialTouchX=event.getY();
  }
  if (!isFullyCollapsed()) {
    handleQsDown(event);
  }
  if (!mQsExpandImmediate && mQsTracking) {
    onQsTouch(event);
    if (!mConflictingQsExpansionGesture) {
      return true;
    }
  }
  if (action == MotionEvent.ACTION_CANCEL || action == MotionEvent.ACTION_UP) {
    mConflictingQsExpansionGesture=false;
  }
  if (action == MotionEvent.ACTION_DOWN && isFullyCollapsed() && mQsExpansionEnabled) {
    mTwoFingerQsExpandPossible=true;
  }
  final int pointerCount=event.getPointerCount();
  final boolean twoFingerDrag=action == MotionEvent.ACTION_POINTER_DOWN && pointerCount == 2;
  final boolean stylusClickDrag=action == MotionEvent.ACTION_DOWN && pointerCount == 1 && event.getToolType(0) == MotionEvent.TOOL_TYPE_STYLUS && (event.isButtonPressed(MotionEvent.BUTTON_SECONDARY) || event.isButtonPressed(MotionEvent.BUTTON_TERTIARY));
  if (mTwoFingerQsExpandPossible && (twoFingerDrag || stylusClickDrag) && event.getY(event.getActionIndex()) < mStatusBarMinHeight) {
    mQsExpandImmediate=true;
    requestPanelHeightUpdate();
    setListening(true);
  }
  return false;
}
