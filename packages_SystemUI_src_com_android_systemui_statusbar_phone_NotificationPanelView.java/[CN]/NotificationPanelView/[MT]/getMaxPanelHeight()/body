{
  int min=mStatusBarMinHeight;
  if (mStatusBar.getBarState() != StatusBarState.KEYGUARD && mNotificationStackScroller.getNotGoneChildCount() == 0) {
    int minHeight=(int)((mQsMinExpansionHeight + getOverExpansionAmount()) * HEADER_RUBBERBAND_FACTOR);
    min=Math.max(min,minHeight);
  }
  int maxHeight;
  if (mQsExpanded || mIsExpanding && mQsExpandedWhenExpandingStarted) {
    maxHeight=(int)calculatePanelHeightQsExpanded();
  }
 else {
    int emptyBottomMargin=mNotificationStackScroller.getEmptyBottomMargin();
    maxHeight=mNotificationStackScroller.getHeight() - emptyBottomMargin - mTopPaddingAdjustment;
    maxHeight+=mNotificationStackScroller.getTopPaddingOverflow();
  }
  maxHeight=Math.max(maxHeight,min);
  return maxHeight;
}
