{
  Parcel current=Parcel.obtain();
  mWriteLock.lock();
  try {
synchronized (mAm) {
      mProcessStats.mTimePeriodEndRealtime=SystemClock.elapsedRealtime();
      mProcessStats.writeToParcel(current,0);
    }
    if (historic != null) {
      ArrayList<String> files=getCommittedFiles(0,true);
      if (files != null) {
        for (int i=files.size() - 1; i >= 0; i--) {
          try {
            ParcelFileDescriptor pfd=ParcelFileDescriptor.open(new File(files.get(i)),ParcelFileDescriptor.MODE_READ_ONLY);
            historic.add(pfd);
          }
 catch (          IOException e) {
            Slog.w(TAG,"Failure opening procstat file " + files.get(i),e);
          }
        }
      }
    }
  }
  finally {
    mWriteLock.unlock();
  }
  return current.marshall();
}
