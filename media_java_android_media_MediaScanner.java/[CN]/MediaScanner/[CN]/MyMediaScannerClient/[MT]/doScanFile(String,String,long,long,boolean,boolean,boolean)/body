{
  Uri result=null;
  try {
    FileEntry entry=beginFile(path,mimeType,lastModified,fileSize,isDirectory,noMedia);
    if (entry == null) {
      return null;
    }
    if (mMtpObjectHandle != 0) {
      entry.mRowId=0;
    }
    if (entry.mPath != null && ((!mDefaultNotificationSet && doesPathHaveFilename(entry.mPath,mDefaultNotificationFilename)) || (!mDefaultRingtoneSet && doesPathHaveFilename(entry.mPath,mDefaultRingtoneFilename)) || (!mDefaultAlarmSet && doesPathHaveFilename(entry.mPath,mDefaultAlarmAlertFilename)))) {
      Log.w(TAG,"forcing rescan of " + entry.mPath + "since ringtone setting didn't finish");
      scanAlways=true;
    }
    if (entry != null && (entry.mLastModifiedChanged || scanAlways)) {
      if (noMedia) {
        result=endFile(entry,false,false,false,false,false);
      }
 else {
        String lowpath=path.toLowerCase(Locale.ROOT);
        boolean ringtones=(lowpath.indexOf(RINGTONES_DIR) > 0);
        boolean notifications=(lowpath.indexOf(NOTIFICATIONS_DIR) > 0);
        boolean alarms=(lowpath.indexOf(ALARMS_DIR) > 0);
        boolean podcasts=(lowpath.indexOf(PODCAST_DIR) > 0);
        boolean music=(lowpath.indexOf(MUSIC_DIR) > 0) || (!ringtones && !notifications && !alarms&& !podcasts);
        boolean isaudio=MediaFile.isAudioFileType(mFileType);
        boolean isvideo=MediaFile.isVideoFileType(mFileType);
        boolean isimage=MediaFile.isImageFileType(mFileType);
        if (isaudio || isvideo || isimage) {
          path=Environment.maybeTranslateEmulatedPathToInternal(new File(path)).getAbsolutePath();
        }
        if (isaudio || isvideo) {
          processFile(path,mimeType,this);
        }
        if (isimage) {
          processImageFile(path);
        }
        result=endFile(entry,ringtones,notifications,alarms,music,podcasts);
      }
    }
  }
 catch (  RemoteException e) {
    Log.e(TAG,"RemoteException in MediaScanner.scanFile()",e);
  }
  return result;
}
