{
  if (System.currentTimeMillis() - mLastToggleTime < sMinToggleDelay) {
    return;
  }
  SystemServicesProxy ssp=mSystemServicesProxy;
  List<ActivityManager.RunningTaskInfo> tasks=ssp.getRunningTasks(1);
  boolean isTopTaskHome=false;
  if (!tasks.isEmpty()) {
    ActivityManager.RunningTaskInfo topTask=tasks.get(0);
    ComponentName topActivity=topTask.topActivity;
    if (topActivity.getPackageName().equals(sRecentsPackage) && topActivity.getClassName().equals(sRecentsActivity)) {
      try {
        Bundle data=new Bundle();
        Message msg=Message.obtain(null,MSG_TOGGLE_RECENTS,0,0);
        msg.setData(data);
        mService.send(msg);
        Console.logTraceTime(Constants.DebugFlags.App.TimeRecentsStartup,Constants.DebugFlags.App.TimeRecentsStartupKey,"sendToggleRecents");
        Console.logTraceTime(Constants.DebugFlags.App.TimeRecentsLaunchTask,Constants.DebugFlags.App.TimeRecentsLaunchKey,"sendToggleRecents");
      }
 catch (      RemoteException re) {
        re.printStackTrace();
      }
      mLastToggleTime=System.currentTimeMillis();
      return;
    }
    isTopTaskHome=ssp.isInHomeStack(topTask.id);
  }
  boolean hasMultipleTasks=hasMultipleRecentsTask();
  Rect taskRect=hasMultipleTasks ? mMultipleCountFirstTaskRect : mSingleCountFirstTaskRect;
  if (!isTopTaskHome && taskRect != null && taskRect.width() > 0 && taskRect.height() > 0) {
    Bitmap thumbnail;
    Bitmap firstThumbnail=loadFirstTaskThumbnail();
    if (firstThumbnail != null) {
      thumbnail=Bitmap.createBitmap(taskRect.width(),taskRect.height(),Bitmap.Config.ARGB_8888);
      int size=Math.min(firstThumbnail.getWidth(),firstThumbnail.getHeight());
      Canvas c=new Canvas(thumbnail);
      c.drawBitmap(firstThumbnail,new Rect(0,0,size,size),new Rect(0,0,taskRect.width(),taskRect.height()),null);
      c.setBitmap(null);
      firstThumbnail.recycle();
    }
 else {
      WindowManager wm=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
      Display display=wm.getDefaultDisplay();
      Bitmap screenshot=takeScreenshot(display);
      Resources res=mContext.getResources();
      int size=Math.min(screenshot.getWidth(),screenshot.getHeight());
      int statusBarHeight=res.getDimensionPixelSize(com.android.internal.R.dimen.status_bar_height);
      thumbnail=Bitmap.createBitmap(taskRect.width(),taskRect.height(),Bitmap.Config.ARGB_8888);
      Canvas c=new Canvas(thumbnail);
      c.drawBitmap(screenshot,new Rect(0,statusBarHeight,size,statusBarHeight + size),new Rect(0,0,taskRect.width(),taskRect.height()),null);
      c.setBitmap(null);
      screenshot.recycle();
    }
    ActivityOptions opts=ActivityOptions.makeThumbnailScaleDownAnimation(mStatusBarView,thumbnail,taskRect.left,taskRect.top,null);
    startAlternateRecentsActivity(opts,true);
  }
 else {
    ActivityOptions opts=ActivityOptions.makeCustomAnimation(mContext,R.anim.recents_from_launcher_enter,R.anim.recents_from_launcher_exit);
    startAlternateRecentsActivity(opts,false);
  }
  Console.logTraceTime(Constants.DebugFlags.App.TimeRecentsStartup,Constants.DebugFlags.App.TimeRecentsStartupKey,"startRecentsActivity");
  mLastToggleTime=System.currentTimeMillis();
}
