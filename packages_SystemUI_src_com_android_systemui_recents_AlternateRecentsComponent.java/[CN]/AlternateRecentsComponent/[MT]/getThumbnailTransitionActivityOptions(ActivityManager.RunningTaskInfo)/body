{
  consumeLastScreenshot();
  if (Constants.DebugFlags.App.EnableScreenshotAppTransition) {
    sLastScreenshot=mSystemServicesProxy.takeAppScreenshot();
    if (sLastScreenshot != null) {
      return ActivityOptions.makeCustomAnimation(mContext,R.anim.recents_from_app_enter,R.anim.recents_from_app_exit,mHandler,this);
    }
  }
  Bitmap firstThumbnail=mSystemServicesProxy.getTaskThumbnail(topTask.id);
  if (firstThumbnail != null) {
    Rect taskRect=getThumbnailTransitionRect(topTask.id);
    Bitmap thumbnail=Bitmap.createBitmap(taskRect.width(),taskRect.height(),Bitmap.Config.ARGB_8888);
    int size=Math.min(firstThumbnail.getWidth(),firstThumbnail.getHeight());
    Canvas c=new Canvas(thumbnail);
    c.drawBitmap(firstThumbnail,new Rect(0,0,size,size),new Rect(0,0,taskRect.width(),taskRect.height()),null);
    c.setBitmap(null);
    firstThumbnail.recycle();
    return ActivityOptions.makeThumbnailScaleDownAnimation(mStatusBarView,thumbnail,taskRect.left,taskRect.top,this);
  }
  return getUnknownTransitionActivityOptions();
}
