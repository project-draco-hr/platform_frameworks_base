{
  if (Constants.DebugFlags.App.EnableScreenshotAppTransition) {
    consumeLastScreenshot();
    sLastScreenshot=mSystemServicesProxy.takeAppScreenshot();
    if (sLastScreenshot != null) {
      return ActivityOptions.makeCustomAnimation(mContext,R.anim.recents_from_app_enter,R.anim.recents_from_app_exit,mHandler,this);
    }
  }
  Bitmap firstThumbnail=mSystemServicesProxy.getTaskThumbnail(topTask.id);
  if (firstThumbnail != null) {
    Rect toTaskRect=getThumbnailTransitionRect(topTask.id);
    if (toTaskRect.width() > 0 && toTaskRect.height() > 0) {
      Bitmap thumbnail=Bitmap.createBitmap(toTaskRect.width(),toTaskRect.height(),Bitmap.Config.ARGB_8888);
      int size=Math.min(firstThumbnail.getWidth(),firstThumbnail.getHeight());
      Canvas c=new Canvas(thumbnail);
      c.drawBitmap(firstThumbnail,new Rect(0,0,size,size),new Rect(0,0,toTaskRect.width(),toTaskRect.height()),null);
      c.setBitmap(null);
      firstThumbnail.recycle();
      return ActivityOptions.makeThumbnailScaleDownAnimation(mStatusBarView,thumbnail,toTaskRect.left,toTaskRect.top,this);
    }
  }
  return getUnknownTransitionActivityOptions();
}
