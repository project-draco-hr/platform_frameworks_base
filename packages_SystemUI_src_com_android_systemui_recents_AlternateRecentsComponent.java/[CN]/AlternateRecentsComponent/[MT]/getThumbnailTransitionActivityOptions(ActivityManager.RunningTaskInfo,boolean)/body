{
  if (Constants.DebugFlags.App.EnableScreenshotAppTransition) {
    consumeLastScreenshot();
    sLastScreenshot=mSystemServicesProxy.takeAppScreenshot();
    if (sLastScreenshot != null) {
      mStartAnimationTriggered=false;
      return ActivityOptions.makeCustomAnimation(mContext,R.anim.recents_from_app_enter,R.anim.recents_from_app_exit,mHandler,this);
    }
  }
  Task toTask=new Task();
  TaskViewTransform toTransform=getThumbnailTransitionTransform(topTask.id,isTopTaskHome,toTask);
  if (toTransform != null && toTask.key != null) {
    Rect toTaskRect=toTransform.rect;
    Bitmap thumbnail=Bitmap.createBitmap(toTaskRect.width(),toTaskRect.height(),Bitmap.Config.ARGB_8888);
    if (Constants.DebugFlags.App.EnableTransitionThumbnailDebugMode) {
      thumbnail.eraseColor(0xFFff0000);
    }
 else {
      Canvas c=new Canvas(thumbnail);
      c.scale(toTransform.scale,toTransform.scale);
      mHeaderBar.rebindToTask(toTask);
      mHeaderBar.draw(c);
      c.setBitmap(null);
    }
    mStartAnimationTriggered=false;
    return ActivityOptions.makeThumbnailAspectScaleDownAnimation(mStatusBarView,thumbnail,toTaskRect.left,toTaskRect.top,this);
  }
  return getUnknownTransitionActivityOptions();
}
