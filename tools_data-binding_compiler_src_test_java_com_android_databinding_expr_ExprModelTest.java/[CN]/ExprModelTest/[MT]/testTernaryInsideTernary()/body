{
  LayoutBinder lb=new LayoutBinder(null);
  mExprModel=lb.getModel();
  IdentifierExpr cond1=lb.addVariable("cond1","boolean");
  IdentifierExpr cond2=lb.addVariable("cond2","boolean");
  IdentifierExpr a=lb.addVariable("a","boolean");
  IdentifierExpr b=lb.addVariable("b","boolean");
  IdentifierExpr c=lb.addVariable("c","boolean");
  final TernaryExpr ternaryExpr=parse(lb,"cond1 ? cond2 ? a : b : c",TernaryExpr.class);
  final TernaryExpr innerTernary=(TernaryExpr)ternaryExpr.getIfTrue();
  mExprModel.seal();
  Iterable<Expr> toRead=getShouldRead();
  assertEquals(1,Iterables.size(toRead));
  assertEquals(ternaryExpr.getPred(),Iterables.getFirst(toRead,null));
  Iterable<Expr> readNow=getReadFirst(toRead);
  assertEquals(1,Iterables.size(readNow));
  assertEquals(ternaryExpr.getPred(),Iterables.getFirst(readNow,null));
  int cond1True=ternaryExpr.getRequirementFlagIndex(true);
  int cond1False=ternaryExpr.getRequirementFlagIndex(false);
  mExprModel.markBitsRead();
  toRead=getShouldRead();
  assertEquals(2,Iterables.size(toRead));
  assertExactMatch(toRead,ternaryExpr.getIfFalse(),innerTernary.getPred());
  assertFlags(ternaryExpr.getIfFalse(),cond1False);
  assertFlags(ternaryExpr.getIfTrue(),cond1True);
  mExprModel.markBitsRead();
  toRead=getShouldRead();
  assertExactMatch(toRead,innerTernary.getIfTrue(),innerTernary.getIfFalse(),ternaryExpr,innerTernary);
  assertFlags(innerTernary.getIfTrue(),innerTernary.getRequirementFlagIndex(true));
  assertFlags(innerTernary.getIfFalse(),innerTernary.getRequirementFlagIndex(false));
  assertFalse(mExprModel.markBitsRead());
}
