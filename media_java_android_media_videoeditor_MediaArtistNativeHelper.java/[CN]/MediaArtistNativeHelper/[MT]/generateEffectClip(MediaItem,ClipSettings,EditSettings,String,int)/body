{
  int err=0;
  EditSettings editSettings=null;
  String EffectClipPath=null;
  editSettings=new EditSettings();
  editSettings.clipSettingsArray=new ClipSettings[1];
  editSettings.clipSettingsArray[0]=lclipSettings;
  editSettings.backgroundMusicSettings=null;
  editSettings.transitionSettingsArray=null;
  editSettings.effectSettingsArray=e.effectSettingsArray;
  EffectClipPath=String.format(mProjectPath + "/" + "ClipEffectIntermediate"+ "_"+ lMediaItem.getId()+ uniqueId+ ".3gp");
  File tmpFile=new File(EffectClipPath);
  if (tmpFile.exists()) {
    tmpFile.delete();
  }
  if (lMediaItem instanceof MediaVideoItem) {
    MediaVideoItem m=(MediaVideoItem)lMediaItem;
    editSettings.audioFormat=AudioFormat.AAC;
    editSettings.audioChannels=2;
    editSettings.audioBitrate=Bitrate.BR_64_KBPS;
    editSettings.audioSamplingFreq=AudioSamplingFrequency.FREQ_32000;
    editSettings.videoBitrate=Bitrate.BR_5_MBPS;
    editSettings.videoFormat=VideoFormat.H264;
    editSettings.videoFrameRate=VideoFrameRate.FR_30_FPS;
    editSettings.videoFrameSize=findVideoResolution(mVideoEditor.getAspectRatio(),m.getHeight());
  }
 else {
    MediaImageItem m=(MediaImageItem)lMediaItem;
    editSettings.audioBitrate=Bitrate.BR_64_KBPS;
    editSettings.audioChannels=2;
    editSettings.audioFormat=AudioFormat.AAC;
    editSettings.audioSamplingFreq=AudioSamplingFrequency.FREQ_32000;
    editSettings.videoBitrate=Bitrate.BR_5_MBPS;
    editSettings.videoFormat=VideoFormat.H264;
    editSettings.videoFrameRate=VideoFrameRate.FR_30_FPS;
    editSettings.videoFrameSize=findVideoResolution(mVideoEditor.getAspectRatio(),m.getScaledHeight());
  }
  editSettings.outputFile=EffectClipPath;
  if (clipNo == 1) {
    mProcessingState=PROCESSING_INTERMEDIATE1;
  }
 else   if (clipNo == 2) {
    mProcessingState=PROCESSING_INTERMEDIATE2;
  }
  mProcessingObject=lMediaItem;
  err=generateClip(editSettings);
  mProcessingState=PROCESSING_NONE;
  if (err == 0) {
    lclipSettings.clipPath=EffectClipPath;
    lclipSettings.fileType=FileType.THREE_GPP;
    return EffectClipPath;
  }
 else {
    throw new RuntimeException("preview generation cannot be completed");
  }
}
