{
  if (image == null) {
    return true;
  }
  if (dx1 == dx2 || dy1 == dy2 || sx1 == sx2 || sy1 == sy2) {
    return true;
  }
  boolean done=false;
  boolean somebits=false;
  Surface srcSurf=null;
  if (image instanceof OffscreenImage) {
    OffscreenImage oi=(OffscreenImage)image;
    if ((oi.getState() & ImageObserver.ERROR) != 0) {
      return false;
    }
    done=oi.prepareImage(imageObserver);
    somebits=(oi.getState() & ImageObserver.SOMEBITS) != 0;
    srcSurf=oi.getImageSurface();
  }
 else {
    done=true;
    srcSurf=Surface.getImageSurface(image);
  }
  if (done || somebits) {
    int dstX=dx1;
    int dstY=dy1;
    int srcX=sx1;
    int srcY=sy1;
    int dstW=dx2 - dx1;
    int dstH=dy2 - dy1;
    int srcW=sx2 - sx1;
    int srcH=sy2 - sy1;
    if (srcW == dstW && srcH == dstH) {
      blitter.blit(srcX,srcY,srcSurf,dstX,dstY,dstSurf,srcW,srcH,(AffineTransform)transform.clone(),composite,bgcolor,clip);
    }
 else {
      AffineTransform xform=new AffineTransform();
      xform.setToScale((float)dstW / srcW,(float)dstH / srcH);
      blitter.blit(srcX,srcY,srcSurf,dstX,dstY,dstSurf,srcW,srcH,(AffineTransform)transform.clone(),xform,composite,bgcolor,clip);
    }
  }
  return done;
}
