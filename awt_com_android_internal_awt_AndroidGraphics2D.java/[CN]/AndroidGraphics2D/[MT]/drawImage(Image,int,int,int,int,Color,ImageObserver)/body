{
  if (image == null) {
    return true;
  }
  if (width == 0 || height == 0) {
    return true;
  }
  boolean done=false;
  boolean somebits=false;
  Surface srcSurf=null;
  if (image instanceof OffscreenImage) {
    OffscreenImage oi=(OffscreenImage)image;
    if ((oi.getState() & ImageObserver.ERROR) != 0) {
      return false;
    }
    done=oi.prepareImage(imageObserver);
    somebits=(oi.getState() & ImageObserver.SOMEBITS) != 0;
    srcSurf=oi.getImageSurface();
  }
 else {
    done=true;
    srcSurf=Surface.getImageSurface(image);
  }
  if (done || somebits) {
    int w=srcSurf.getWidth();
    int h=srcSurf.getHeight();
    if (w == width && h == height) {
      blitter.blit(0,0,srcSurf,x,y,dstSurf,w,h,(AffineTransform)transform.clone(),composite,bgcolor,clip);
    }
 else {
      AffineTransform xform=new AffineTransform();
      xform.setToScale((float)width / w,(float)height / h);
      blitter.blit(0,0,srcSurf,x,y,dstSurf,w,h,(AffineTransform)transform.clone(),xform,composite,bgcolor,clip);
    }
  }
  return done;
}
