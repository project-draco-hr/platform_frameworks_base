{
  long now=System.currentTimeMillis();
  if (mLastSaveTime != 0 && (now - mLastSaveTime < SAVE_FREQUENCY)) {
    return;
  }
  FileOutputStream ostream;
  File systemDir=new File(mDir);
  if (!systemDir.exists()) {
    if (!systemDir.mkdirs()) {
      Log.e(TAG,"Cache.save(): couldn't create directory");
      return;
    }
  }
  try {
    File f=new File(mDir,mFile);
    ostream=new FileOutputStream(f);
  }
 catch (  FileNotFoundException e) {
    Log.d(TAG,"Cache.save(): unable to create cache file",e);
    return;
  }
  DataOutputStream dataOut=new DataOutputStream(ostream);
  try {
    dataOut.writeShort(CACHE_DB_VERSION);
    dataOut.writeShort(size());
    for (Iterator iter=entrySet().iterator(); iter.hasNext(); ) {
      Map.Entry entry=(Map.Entry)iter.next();
      String key=(String)entry.getKey();
      LocationCache.Record record=(LocationCache.Record)entry.getValue();
      dataOut.writeUTF(key);
      record.write(dataOut);
    }
    dataOut.close();
    mLastSaveTime=now;
  }
 catch (  IOException e) {
    Log.e(TAG,"Cache.save(): unable to write cache",e);
  }
}
