{
  final PackageManagerInternal packageManagerInternal=LocalServices.getService(PackageManagerInternal.class);
  packageManagerInternal.setSmsAppPackagesProvider(new PackageManagerInternal.PackagesProvider(){
    @Override public String[] getPackages(    int userId){
      ComponentName smsComponent=SmsApplication.getDefaultSmsApplication(mContext,true);
      if (smsComponent != null) {
        return new String[]{smsComponent.getPackageName()};
      }
      return null;
    }
  }
);
  packageManagerInternal.setDialerAppPackagesProvider(new PackageManagerInternal.PackagesProvider(){
    @Override public String[] getPackages(    int userId){
      String packageName=DefaultDialerManager.getDefaultDialerApplication(mContext);
      if (packageName != null) {
        return new String[]{packageName};
      }
      return null;
    }
  }
);
}
