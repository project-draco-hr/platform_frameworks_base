{
  final int channelConfig=getChannelConfig(mChannelCount);
  int minBufferSizeInBytes=AudioTrack.getMinBufferSize(mSampleRateInHz,channelConfig,mAudioFormat);
  int bufferSizeInBytes=Math.max(MIN_AUDIO_BUFFER_SIZE,minBufferSizeInBytes);
  AudioFormat audioFormat=(new AudioFormat.Builder()).setChannelMask(channelConfig).setEncoding(mAudioFormat).setSampleRate(mSampleRateInHz).build();
  AudioTrack audioTrack=new AudioTrack(mAudioParams.mAudioAttributes,audioFormat,bufferSizeInBytes,AudioTrack.MODE_STREAM,mAudioParams.mSessionId);
  if (audioTrack.getState() != AudioTrack.STATE_INITIALIZED) {
    Log.w(TAG,"Unable to create audio track.");
    audioTrack.release();
    return null;
  }
  mAudioBufferSize=bufferSizeInBytes;
  setupVolume(audioTrack,mAudioParams.mVolume,mAudioParams.mPan);
  return audioTrack;
}
