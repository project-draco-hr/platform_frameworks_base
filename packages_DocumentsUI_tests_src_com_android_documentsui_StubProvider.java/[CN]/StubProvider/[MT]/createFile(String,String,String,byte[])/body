{
  Log.d(TAG,"Creating file " + rootId + ":"+ path);
  StubDocument root=mRoots.get(rootId).rootDocument;
  if (root == null) {
    throw new FileNotFoundException("No roots with the ID " + rootId + " were found");
  }
  File file=new File(root.file,path.substring(1));
  StubDocument parent=mStorage.get(getDocumentIdForFile(file.getParentFile()));
  if (parent == null) {
    parent=mStorage.get(createFile(rootId,file.getParentFile().getPath(),DocumentsContract.Document.MIME_TYPE_DIR,null));
    Log.d(TAG,"Created parent " + parent.documentId);
  }
 else {
    Log.d(TAG,"Found parent " + parent.documentId);
  }
  if (DocumentsContract.Document.MIME_TYPE_DIR.equals(mimeType)) {
    if (!file.mkdirs()) {
      throw new FileNotFoundException("Couldn't create directory " + file.getPath());
    }
  }
 else {
    if (!file.createNewFile()) {
      throw new FileNotFoundException("Couldn't create file " + file.getPath());
    }
    FileOutputStream fout=new FileOutputStream(file);
    fout.write(content);
    fout.close();
  }
  final StubDocument document=new StubDocument(file,mimeType,parent);
  return DocumentsContract.buildDocumentUri(mAuthority,document.documentId);
}
