{
  StubDocument oldDoc=mStorage.get(documentId);
  File before=oldDoc.file;
  File after=new File(before.getParentFile(),displayName);
  if (after.exists()) {
    throw new IllegalStateException("Already exists " + after);
  }
  boolean result=before.renameTo(after);
  if (!result) {
    throw new IllegalStateException("Failed to rename to " + after);
  }
  StubDocument newDoc=StubDocument.createRegularDocument(after,oldDoc.mimeType,mStorage.get(oldDoc.parentId));
  mStorage.remove(documentId);
  notifyParentChanged(oldDoc.parentId);
  getContext().getContentResolver().notifyChange(DocumentsContract.buildDocumentUri(mAuthority,oldDoc.documentId),null,false);
  mStorage.put(newDoc.documentId,newDoc);
  notifyParentChanged(newDoc.parentId);
  getContext().getContentResolver().notifyChange(DocumentsContract.buildDocumentUri(mAuthority,newDoc.documentId),null,false);
  if (!TextUtils.equals(documentId,newDoc.documentId)) {
    return newDoc.documentId;
  }
 else {
    return null;
  }
}
