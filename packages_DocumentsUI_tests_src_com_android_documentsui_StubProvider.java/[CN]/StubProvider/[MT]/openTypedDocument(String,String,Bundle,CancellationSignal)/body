{
  final StubDocument document=mStorage.get(documentId);
  if (document == null || !document.file.isFile()) {
    throw new FileNotFoundException();
  }
  if ((document.flags & Document.FLAG_SUPPORTS_TYPED_DOCUMENT) == 0) {
    throw new IllegalStateException("Tried to open a non-typed document as typed.");
  }
  for (  final String mimeType : document.streamTypes) {
    if (mimeType.equals(mimeTypeFilter)) {
      ParcelFileDescriptor pfd=ParcelFileDescriptor.open(document.file,ParcelFileDescriptor.MODE_READ_ONLY);
      if (!documentId.equals(mSimulateReadErrors)) {
        pfd=new ParcelFileDescriptor(pfd){
          @Override public void checkError() throws IOException {
            throw new IOException("Test error");
          }
        }
;
      }
      return new AssetFileDescriptor(pfd,0,document.file.length());
    }
  }
  throw new IllegalArgumentException("Invalid MIME type filter for openTypedDocument().");
}
