{
  boolean origMediaState=checkMediaState(Environment.MEDIA_MOUNTED);
  try {
    mountMedia();
    String outFileName="install.apk";
    int rawResId=R.raw.install;
    PackageManager pm=mContext.getPackageManager();
    File filesDir=mContext.getFilesDir();
    File outFile=new File(filesDir,outFileName);
    Uri packageURI=getInstallablePackage(rawResId,outFile);
    PackageParser.Package pkg=parsePackage(packageURI);
    assertNotNull(pkg);
    installFromRawResource(outFileName,rawResId,PackageManager.INSTALL_EXTERNAL,false,false,-1,PackageInfo.INSTALL_LOCATION_UNSPECIFIED);
    unmountMedia();
    installFromRawResource(outFileName,rawResId,PackageManager.INSTALL_REPLACE_EXISTING,false,false,-1,PackageInfo.INSTALL_LOCATION_UNSPECIFIED);
    mountMedia();
    assertInstall(pkg,0,PackageInfo.INSTALL_LOCATION_INTERNAL_ONLY);
  }
 catch (  Exception e) {
    failStr(e.getMessage());
  }
 finally {
    if (origMediaState) {
      mountMedia();
    }
 else {
      unmountMedia();
    }
  }
}
