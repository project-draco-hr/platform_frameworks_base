{
  PackageManager pm=mContext.getPackageManager();
  PackageParser.Package pkg=ip.pkg;
  Uri packageURI=ip.packageURI;
  if ((flags & PackageManager.INSTALL_REPLACE_EXISTING) == 0) {
    try {
      ApplicationInfo appInfo=pm.getApplicationInfo(pkg.packageName,PackageManager.GET_UNINSTALLED_PACKAGES);
      GenericReceiver receiver=new DeleteReceiver(pkg.packageName);
      invokeDeletePackage(pkg.packageName,0,receiver);
    }
 catch (    NameNotFoundException e) {
    }
  }
  try {
    if (fail) {
      invokeInstallPackageFail(packageURI,flags,result);
      if ((flags & PackageManager.INSTALL_REPLACE_EXISTING) == 0) {
        assertNotInstalled(pkg.packageName);
      }
    }
 else {
      InstallReceiver receiver=new InstallReceiver(pkg.packageName);
      invokeInstallPackage(packageURI,flags,receiver,true);
      assertInstall(pkg,flags,expInstallLocation);
    }
  }
  finally {
    if (cleanUp) {
      cleanUpInstall(ip);
    }
  }
}
