{
  PackageMoveObserver observer=new PackageMoveObserver();
  final boolean received=false;
  mContext.registerReceiver(receiver,receiver.filter);
  try {
synchronized (observer) {
synchronized (receiver) {
        getPm().movePackage(pkgName,observer,flags);
        long waitTime=0;
        while ((!observer.isDone()) && (waitTime < MAX_WAIT_TIME)) {
          observer.wait(WAIT_TIME_INCR);
          waitTime+=WAIT_TIME_INCR;
        }
        if (!observer.isDone()) {
          throw new Exception("Timed out waiting for pkgmove callback");
        }
        if (observer.returnCode != PackageManager.MOVE_SUCCEEDED) {
          return false;
        }
        waitTime=0;
        while ((!receiver.isDone()) && (waitTime < MAX_WAIT_TIME)) {
          receiver.wait(WAIT_TIME_INCR);
          waitTime+=WAIT_TIME_INCR;
        }
        if (!receiver.isDone()) {
          throw new Exception("Timed out waiting for MOVE notifications");
        }
        return receiver.received;
      }
    }
  }
  finally {
    mContext.unregisterReceiver(receiver);
  }
}
