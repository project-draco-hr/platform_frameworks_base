{
  InstallParams ip=null;
  boolean origMediaState=checkMediaState(Environment.MEDIA_MOUNTED);
  try {
    int iFlags=PackageManager.INSTALL_INTERNAL;
    int iApk=R.raw.install_decl_perm;
    ip=installFromRawResource("install.apk",iApk,iFlags,false,false,-1,PackageInfo.INSTALL_LOCATION_INTERNAL_ONLY);
    assertInstall(ip.pkg,iFlags,ip.pkg.installLocation);
    assertPermissions(BASE_PERMISSIONS_DEFINED);
    assertTrue(unmountMedia());
    mountMedia();
    assertPermissions(BASE_PERMISSIONS_DEFINED);
  }
  finally {
    if (ip != null) {
      cleanUpInstall(ip);
    }
  }
}
