{
  installFromRawResource("permDef.apk",R.raw.keyset_permdef_sa_unone,0,false,false,-1,PackageInfo.INSTALL_LOCATION_UNSPECIFIED);
  installFromRawResource("permUse.apk",R.raw.keyset_permuse_sb_ua_ub,0,false,false,-1,PackageInfo.INSTALL_LOCATION_UNSPECIFIED);
  PackageManager pm=getPm();
  String permPkgName="com.android.frameworks.coretests.keysets_permdef";
  String pkgName="com.android.frameworks.coretests.keysets";
  String permName="com.android.frameworks.coretests.keysets_permdef.keyset_perm";
  assertFalse("keyset permission granted to app without same signature!",pm.checkPermission(permName,pkgName) == PackageManager.PERMISSION_GRANTED);
  installFromRawResource("permUse2.apk",R.raw.keyset_permuse_sa_ua_ub,PackageManager.INSTALL_REPLACE_EXISTING,false,false,-1,PackageInfo.INSTALL_LOCATION_UNSPECIFIED);
  assertTrue("keyset permission not granted to app after upgrade to same sig",pm.checkPermission(permName,pkgName) == PackageManager.PERMISSION_GRANTED);
  cleanUpInstall(permPkgName);
  cleanUpInstall(pkgName);
}
