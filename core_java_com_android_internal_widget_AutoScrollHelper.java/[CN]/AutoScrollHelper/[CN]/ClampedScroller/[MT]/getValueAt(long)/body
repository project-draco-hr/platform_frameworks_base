{
  if (currentTime < mStartTime) {
    return 0f;
  }
 else   if (mStopTime < 0 || currentTime < mStopTime) {
    final long elapsedSinceStart=currentTime - mStartTime;
    return 0.5f * constrain(elapsedSinceStart / (float)mRampUpDuration,0,1);
  }
 else {
    final long elapsedSinceEnd=currentTime - mStopTime;
    return (1 - mStopValue) + mStopValue * constrain(elapsedSinceEnd / (float)mEffectiveRampDown,0,1);
  }
}
