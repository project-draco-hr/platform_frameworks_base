{
  byte[] rawAddr=null;
  if (firstPacket != null) {
    if (firstPacket.length >= 20 && (firstPacket[0] & 0xf0) == 0x40) {
      rawAddr=new byte[4];
      System.arraycopy(firstPacket,16,rawAddr,0,4);
    }
 else     if (firstPacket.length >= 40 && (firstPacket[0] & 0xf0) == 0x60) {
      rawAddr=new byte[16];
      System.arraycopy(firstPacket,24,rawAddr,0,16);
    }
  }
  final int uid=android.os.Process.myUid();
  String msg="Detected cleartext network traffic from UID " + uid;
  if (rawAddr != null) {
    try {
      msg="Detected cleartext network traffic from UID " + uid + " to "+ InetAddress.getByAddress(rawAddr);
    }
 catch (    UnknownHostException ignored) {
    }
  }
  final boolean forceDeath=(sVmPolicyMask & PENALTY_DEATH_ON_CLEARTEXT_NETWORK) != 0;
  onVmPolicyViolation(HexDump.dumpHexString(firstPacket).trim(),new Throwable(msg),forceDeath);
}
