{
  boolean doFlashes=!amTheSystemServerProcess() && SystemProperties.getBoolean(VISUAL_PROPERTY,IS_ENG_BUILD);
  if (IS_USER_BUILD && !doFlashes) {
    setCloseGuardEnabled(false);
    return false;
  }
  int threadPolicyMask=StrictMode.DETECT_DISK_WRITE | StrictMode.DETECT_DISK_READ | StrictMode.DETECT_NETWORK;
  if (!IS_USER_BUILD) {
    threadPolicyMask|=StrictMode.PENALTY_DROPBOX;
    if (IS_ENG_BUILD) {
      threadPolicyMask|=StrictMode.PENALTY_LOG;
    }
  }
  if (doFlashes) {
    threadPolicyMask|=StrictMode.PENALTY_FLASH;
  }
  StrictMode.setThreadPolicyMask(threadPolicyMask);
  if (IS_USER_BUILD) {
    setCloseGuardEnabled(false);
  }
 else {
    VmPolicy.Builder policyBuilder=new VmPolicy.Builder().detectAll().penaltyDropBox();
    if (IS_ENG_BUILD) {
      policyBuilder.penaltyLog();
    }
    setVmPolicy(policyBuilder.build());
    setCloseGuardEnabled(vmClosableObjectLeaksEnabled());
  }
  return true;
}
