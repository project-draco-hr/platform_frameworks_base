{
  boolean doFlashes=SystemProperties.getBoolean(VISUAL_PROPERTY,false) && !amTheSystemServerProcess();
  final boolean suppress=SystemProperties.getBoolean(DISABLE_PROPERTY,false);
  if (!doFlashes && (IS_USER_BUILD || suppress)) {
    setCloseGuardEnabled(false);
    return false;
  }
  if (IS_ENG_BUILD) {
    doFlashes=true;
  }
  int threadPolicyMask=StrictMode.DETECT_DISK_WRITE | StrictMode.DETECT_DISK_READ | StrictMode.DETECT_NETWORK;
  if (!IS_USER_BUILD) {
    threadPolicyMask|=StrictMode.PENALTY_DROPBOX;
  }
  if (doFlashes) {
    threadPolicyMask|=StrictMode.PENALTY_FLASH;
  }
  StrictMode.setThreadPolicyMask(threadPolicyMask);
  if (IS_USER_BUILD) {
    setCloseGuardEnabled(false);
  }
 else {
    VmPolicy.Builder policyBuilder=new VmPolicy.Builder().detectAll().penaltyDropBox();
    if (IS_ENG_BUILD) {
      policyBuilder.penaltyLog();
    }
    setVmPolicy(policyBuilder.build());
    setCloseGuardEnabled(vmClosableObjectLeaksEnabled());
  }
  return true;
}
