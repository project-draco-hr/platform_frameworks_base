{
  Looper looper=Looper.myLooper();
  if (looper == null) {
    info.durationMillis=-1;
    handleViolation(info);
    return;
  }
  MessageQueue queue=Looper.myQueue();
  final ArrayList<ViolationInfo> records=violationsBeingTimed.get();
  if (records.size() >= MAX_OFFENSES_PER_LOOP) {
    return;
  }
  records.add(info);
  if (records.size() > 1) {
    return;
  }
  final IWindowManager windowManager=(info.policy & PENALTY_FLASH) != 0 ? sWindowManager.get() : null;
  if (windowManager != null) {
    try {
      windowManager.showStrictModeViolation(true);
    }
 catch (    RemoteException unused) {
    }
  }
  queue.addIdleHandler(new MessageQueue.IdleHandler(){
    public boolean queueIdle(){
      long loopFinishTime=SystemClock.uptimeMillis();
      for (int n=0; n < records.size(); ++n) {
        ViolationInfo v=records.get(n);
        v.violationNumThisLoop=n + 1;
        v.durationMillis=(int)(loopFinishTime - v.violationUptimeMillis);
        handleViolation(v);
      }
      records.clear();
      if (windowManager != null) {
        try {
          windowManager.showStrictModeViolation(false);
        }
 catch (        RemoteException unused) {
        }
      }
      return false;
    }
  }
);
}
