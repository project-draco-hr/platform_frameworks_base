{
  Looper looper=Looper.myLooper();
  if (looper == null) {
    info.durationMillis=-1;
    handleViolation(info);
    return;
  }
  MessageQueue queue=Looper.myQueue();
  final ArrayList<ViolationInfo> records=violationsBeingTimed.get();
  if (records.size() >= 10) {
    return;
  }
  records.add(info);
  if (records.size() > 1) {
    return;
  }
  queue.addIdleHandler(new MessageQueue.IdleHandler(){
    public boolean queueIdle(){
      long loopFinishTime=SystemClock.uptimeMillis();
      for (int n=0; n < records.size(); ++n) {
        ViolationInfo v=records.get(n);
        v.violationNumThisLoop=n + 1;
        v.durationMillis=(int)(loopFinishTime - v.violationUptimeMillis);
        handleViolation(v);
      }
      records.clear();
      return false;
    }
  }
);
}
