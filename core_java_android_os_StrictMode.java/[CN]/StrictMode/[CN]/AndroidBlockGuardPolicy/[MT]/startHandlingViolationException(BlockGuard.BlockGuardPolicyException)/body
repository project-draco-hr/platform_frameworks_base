{
  e.fillInStackTrace();
  final ApplicationErrorReport.CrashInfo crashInfo=new ApplicationErrorReport.CrashInfo(e);
  crashInfo.durationMillis=-1;
  final int savedPolicy=mPolicyMask;
  Looper looper=Looper.myLooper();
  if (looper == null) {
    handleViolation(crashInfo,savedPolicy);
  }
 else {
    MessageQueue queue=Looper.myQueue();
    final long violationTime=SystemClock.uptimeMillis();
    queue.addIdleHandler(new MessageQueue.IdleHandler(){
      public boolean queueIdle(){
        long afterViolationTime=SystemClock.uptimeMillis();
        crashInfo.durationMillis=afterViolationTime - violationTime;
        handleViolation(crashInfo,savedPolicy);
        return false;
      }
    }
);
  }
}
