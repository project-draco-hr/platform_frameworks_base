{
  if (!mIsActionItemsStale) {
    return;
  }
  final ArrayList<MenuItemImpl> visibleItems=getVisibleItems();
  final int itemsSize=visibleItems.size();
  int maxActions=mMaxActionItems;
  for (int i=0; i < itemsSize; i++) {
    MenuItemImpl item=visibleItems.get(i);
    if (item.requiresActionButton()) {
      maxActions--;
    }
  }
  for (int i=0; i < itemsSize; i++) {
    MenuItemImpl item=visibleItems.get(i);
    if (item.requestsActionButton()) {
      item.setIsActionButton(maxActions > 0);
      maxActions--;
    }
  }
  mActionItems.clear();
  mNonActionItems.clear();
  for (int i=0; i < itemsSize; i++) {
    MenuItemImpl item=visibleItems.get(i);
    if (item.isActionButton()) {
      mActionItems.add(item);
    }
 else {
      mNonActionItems.add(item);
    }
  }
  mIsActionItemsStale=false;
}
