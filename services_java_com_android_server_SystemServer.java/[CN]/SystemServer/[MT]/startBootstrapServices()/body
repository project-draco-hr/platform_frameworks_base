{
  mInstaller=mSystemServiceManager.startService(Installer.class);
  mActivityManagerService=mSystemServiceManager.startService(ActivityManagerService.Lifecycle.class).getService();
  mActivityManagerService.setSystemServiceManager(mSystemServiceManager);
  mPowerManagerService=mSystemServiceManager.startService(PowerManagerService.class);
  mActivityManagerService.initPowerManagement();
  mDisplayManagerService=mSystemServiceManager.startService(DisplayManagerService.class);
  mSystemServiceManager.startBootPhase(SystemService.PHASE_WAIT_FOR_DEFAULT_DISPLAY);
  String cryptState=SystemProperties.get("vold.decrypt");
  if (ENCRYPTING_STATE.equals(cryptState)) {
    Slog.w(TAG,"Detected encryption in progress - only parsing core apps");
    mOnlyCore=true;
  }
 else   if (ENCRYPTED_STATE.equals(cryptState)) {
    Slog.w(TAG,"Device encrypted - only parsing core apps");
    mOnlyCore=true;
  }
  Slog.i(TAG,"Package Manager");
  mPackageManagerService=PackageManagerService.main(mSystemContext,mInstaller,mFactoryTestMode != FactoryTest.FACTORY_TEST_OFF,mOnlyCore);
  mFirstBoot=mPackageManagerService.isFirstBoot();
  mPackageManager=mSystemContext.getPackageManager();
  Slog.i(TAG,"User Service");
  ServiceManager.addService(Context.USER_SERVICE,UserManagerService.getInstance());
  AttributeCache.init(mSystemContext);
  mActivityManagerService.setSystemProcess();
}
