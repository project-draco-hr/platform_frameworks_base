{
  final String shutdownAction=SystemProperties.get(ShutdownThread.SHUTDOWN_ACTION_PROPERTY,"");
  if (shutdownAction != null && shutdownAction.length() > 0) {
    boolean reboot=(shutdownAction.charAt(0) == '1');
    final String reason;
    if (shutdownAction.length() > 1) {
      reason=shutdownAction.substring(1,shutdownAction.length());
    }
 else {
      reason=null;
    }
    if (PowerManager.REBOOT_RECOVERY_UPDATE.equals(reason)) {
      File packageFile=new File(UNCRYPT_PACKAGE_FILE);
      if (packageFile.exists()) {
        String filename=null;
        try {
          filename=FileUtils.readTextFile(packageFile,0,null);
        }
 catch (        IOException e) {
          Slog.e(TAG,"Error reading uncrypt package file",e);
        }
        if (filename != null && filename.startsWith("/data")) {
          if (!new File(BLOCK_MAP_FILE).exists()) {
            Slog.e(TAG,"Can't find block map file, uncrypt failed or " + "unexpected runtime restart?");
            return;
          }
        }
      }
    }
    ShutdownThread.rebootOrShutdown(null,reboot,reason);
  }
}
