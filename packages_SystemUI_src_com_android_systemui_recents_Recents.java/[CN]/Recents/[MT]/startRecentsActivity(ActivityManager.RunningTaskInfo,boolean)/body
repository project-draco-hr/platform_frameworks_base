{
  RecentsTaskLoader loader=RecentsTaskLoader.getInstance();
  RecentsConfiguration.reinitialize(mContext,mSystemServicesProxy);
  if (sInstanceLoadPlan == null) {
    sInstanceLoadPlan=loader.createLoadPlan(mContext);
  }
  if (mConfig.multiStackEnabled) {
    loader.preloadTasks(sInstanceLoadPlan,true);
    ArrayList<TaskStack> stacks=sInstanceLoadPlan.getAllTaskStacks();
    TaskStack stack=stacks.get(0);
    mDummyStackView.updateMinMaxScrollForStack(stack,mTriggeredFromAltTab,true);
    TaskStackViewLayoutAlgorithm.VisibilityReport stackVr=mDummyStackView.computeStackVisibilityReport();
    ActivityOptions opts=getUnknownTransitionActivityOptions();
    startAlternateRecentsActivity(topTask,opts,true,false,false,stackVr);
    return;
  }
  loader.preloadTasks(sInstanceLoadPlan,isTopTaskHome);
  ArrayList<TaskStack> stacks=sInstanceLoadPlan.getAllTaskStacks();
  TaskStack stack=stacks.get(0);
  mDummyStackView.updateMinMaxScrollForStack(stack,mTriggeredFromAltTab,isTopTaskHome);
  TaskStackViewLayoutAlgorithm.VisibilityReport stackVr=mDummyStackView.computeStackVisibilityReport();
  boolean hasRecentTasks=stack.getTaskCount() > 0;
  boolean useThumbnailTransition=(topTask != null) && !isTopTaskHome && hasRecentTasks;
  if (useThumbnailTransition) {
    RecentsTaskLoadPlan.Options launchOpts=new RecentsTaskLoadPlan.Options();
    launchOpts.runningTaskId=topTask.id;
    launchOpts.loadThumbnails=false;
    launchOpts.onlyLoadForCache=true;
    loader.loadTasks(mContext,sInstanceLoadPlan,launchOpts);
    ActivityOptions opts=getThumbnailTransitionActivityOptions(topTask,stack,mDummyStackView);
    if (opts != null) {
      startAlternateRecentsActivity(topTask,opts,false,false,true,stackVr);
    }
 else {
      useThumbnailTransition=false;
    }
  }
  if (!useThumbnailTransition) {
    if (hasRecentTasks) {
      String homeActivityPackage=mSystemServicesProxy.getHomeActivityPackageName();
      AppWidgetProviderInfo searchWidget=null;
      String searchWidgetPackage=null;
      if (mConfig.hasSearchBarAppWidget()) {
        searchWidget=mSystemServicesProxy.getAppWidgetInfo(mConfig.searchBarAppWidgetId);
      }
 else {
        searchWidget=mSystemServicesProxy.resolveSearchAppWidget();
      }
      if (searchWidget != null && searchWidget.provider != null) {
        searchWidgetPackage=searchWidget.provider.getPackageName();
      }
      boolean fromSearchHome=false;
      if (homeActivityPackage != null && searchWidgetPackage != null && homeActivityPackage.equals(searchWidgetPackage)) {
        fromSearchHome=true;
      }
      ActivityOptions opts=getHomeTransitionActivityOptions(fromSearchHome);
      startAlternateRecentsActivity(topTask,opts,true,fromSearchHome,false,stackVr);
    }
 else {
      ActivityOptions opts=getUnknownTransitionActivityOptions();
      startAlternateRecentsActivity(topTask,opts,true,false,false,stackVr);
    }
  }
  mLastToggleTime=SystemClock.elapsedRealtime();
}
