{
  Task toTask=new Task();
  TaskViewTransform toTransform=getThumbnailTransitionTransform(stack,stackView,topTask.id,toTask);
  if (toTransform != null && toTask.key != null) {
    Rect toTaskRect=toTransform.rect;
    int toHeaderWidth=(int)(mHeaderBar.getMeasuredWidth() * toTransform.scale);
    int toHeaderHeight=(int)(mHeaderBar.getMeasuredHeight() * toTransform.scale);
    Bitmap thumbnail=Bitmap.createBitmap(toHeaderWidth,toHeaderHeight,Bitmap.Config.ARGB_8888);
    if (Constants.DebugFlags.App.EnableTransitionThumbnailDebugMode) {
      thumbnail.eraseColor(0xFFff0000);
    }
 else {
      Canvas c=new Canvas(thumbnail);
      c.scale(toTransform.scale,toTransform.scale);
      mHeaderBar.rebindToTask(toTask);
      mHeaderBar.draw(c);
      c.setBitmap(null);
    }
    Bitmap thumbnailImmutable=thumbnail.createAshmemBitmap();
    mStartAnimationTriggered=false;
    return ActivityOptions.makeThumbnailAspectScaleDownAnimation(mDummyStackView,thumbnailImmutable,toTaskRect.left,toTaskRect.top,toTaskRect.width(),toTaskRect.height(),mHandler,this);
  }
  return getUnknownTransitionActivityOptions();
}
