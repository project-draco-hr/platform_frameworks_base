{
  PrintService.throwIfNotCalledOnMainThread();
  if (mIsDestroyed) {
    Log.w(LOG_TAG,"Not updating printers - session destroyed.");
    return;
  }
  if (mIsDiscoveryStarted) {
    List<PrinterInfo> updatedPrinters=new ArrayList<PrinterInfo>();
    final int updatedPrinterCount=printers.size();
    for (int i=0; i < updatedPrinterCount; i++) {
      PrinterInfo updatedPrinter=printers.get(i);
      PrinterInfo oldPrinter=mPrinters.get(updatedPrinter.getId());
      if (oldPrinter != null && !oldPrinter.equals(updatedPrinter)) {
        mPrinters.put(updatedPrinter.getId(),updatedPrinter);
        updatedPrinters.add(updatedPrinter);
      }
    }
    if (!updatedPrinters.isEmpty()) {
      sendUpdatedPrinters(mObserver,updatedPrinters);
    }
  }
 else {
    if (mLastSentPrinters == null) {
      mLastSentPrinters=new ArrayMap<PrinterId,PrinterInfo>(mPrinters);
    }
    final int updatedPrinterCount=printers.size();
    for (int i=0; i < updatedPrinterCount; i++) {
      PrinterInfo updatedPrinter=printers.get(i);
      PrinterInfo oldPrinter=mPrinters.get(updatedPrinter.getId());
      if (oldPrinter != null && !oldPrinter.equals(updatedPrinter)) {
        mPrinters.put(updatedPrinter.getId(),updatedPrinter);
      }
    }
  }
}
