{
  boolean changed=false;
  boolean rocking;
synchronized (mJobs) {
    if (mDeviceIdleMode != enabled) {
      changed=true;
    }
    rocking=mReadyToRock;
  }
  if (changed) {
    if (rocking) {
      for (int i=0; i < mControllers.size(); i++) {
        mControllers.get(i).deviceIdleModeChanged(enabled);
      }
    }
synchronized (mJobs) {
      mDeviceIdleMode=enabled;
      if (enabled) {
        for (int i=0; i < mActiveServices.size(); i++) {
          JobServiceContext jsc=mActiveServices.get(i);
          final JobStatus executing=jsc.getRunningJob();
          if (executing != null) {
            jsc.cancelExecutingJob(JobParameters.REASON_DEVICE_IDLE);
          }
        }
      }
 else {
        if (rocking) {
          if (mLocalDeviceIdleController != null) {
            if (!mReportedActive) {
              mReportedActive=true;
              mLocalDeviceIdleController.setJobsActive(true);
            }
          }
        }
        mHandler.obtainMessage(MSG_CHECK_JOB).sendToTarget();
      }
    }
  }
}
