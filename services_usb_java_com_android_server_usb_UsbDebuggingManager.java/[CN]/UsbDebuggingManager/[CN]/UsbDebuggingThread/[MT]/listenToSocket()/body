{
  try {
    byte[] buffer=new byte[BUFFER_SIZE];
    while (true) {
      int count=mInputStream.read(buffer);
      if (count < 0) {
        break;
      }
      if (buffer[0] == 'P' && buffer[1] == 'K') {
        String key=new String(Arrays.copyOfRange(buffer,2,count));
        Slog.d(TAG,"Received public key: " + key);
        Message msg=mHandler.obtainMessage(UsbDebuggingHandler.MESSAGE_ADB_CONFIRM);
        msg.obj=key;
        mHandler.sendMessage(msg);
      }
 else {
        Slog.e(TAG,"Wrong message: " + (new String(Arrays.copyOfRange(buffer,0,2))));
        break;
      }
    }
  }
  finally {
synchronized (this) {
      closeSocketLocked();
    }
  }
}
