{
synchronized (NfcAdapterExtras.class) {
    if (sSingleton == null) {
      try {
        sAdapter=adapter;
        sSingleton=new NfcAdapterExtras();
        sEmbeddedEe=new NfcExecutionEnvironment(sSingleton);
        sRouteOff=new CardEmulationRoute(CardEmulationRoute.ROUTE_OFF,null);
        sRouteOnWhenScreenOn=new CardEmulationRoute(CardEmulationRoute.ROUTE_ON_WHEN_SCREEN_ON,sEmbeddedEe);
        initService();
      }
  finally {
        if (sService == null) {
          sRouteOnWhenScreenOn=null;
          sRouteOff=null;
          sEmbeddedEe=null;
          sSingleton=null;
          sAdapter=null;
        }
      }
    }
    return sSingleton;
  }
}
