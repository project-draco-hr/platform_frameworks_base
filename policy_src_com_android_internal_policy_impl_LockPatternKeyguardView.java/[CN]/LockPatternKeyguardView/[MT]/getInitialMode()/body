{
  final IccCard.State simState=mUpdateMonitor.getSimState();
  if (stuckOnLockScreenBecauseSimMissing() || (simState == IccCard.State.PUK_REQUIRED && !mLockPatternUtils.isPukUnlockScreenEnable())) {
    return Mode.LockScreen;
  }
 else {
    final boolean usingLockPattern=mLockPatternUtils.getKeyguardStoredPasswordQuality() == DevicePolicyManager.PASSWORD_QUALITY_SOMETHING;
    boolean showLockBeforeUnlock=getResources().getBoolean(R.bool.config_enableLockBeforeUnlockScreen);
    if (isSecure() && (usingLockPattern || !showLockBeforeUnlock)) {
      return Mode.UnlockScreen;
    }
 else {
      return Mode.LockScreen;
    }
  }
}
