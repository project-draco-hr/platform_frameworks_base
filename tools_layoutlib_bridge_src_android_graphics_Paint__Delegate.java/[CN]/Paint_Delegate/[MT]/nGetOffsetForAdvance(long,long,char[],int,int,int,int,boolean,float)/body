{
  int count=end - start;
  float[] advances=new float[count];
  int bidiFlags=isRtl ? Paint.BIDI_FORCE_RTL : Paint.BIDI_FORCE_LTR;
  nGetTextAdvances(nativePaint,nativeTypeface,text,start,count,contextStart,contextEnd - contextStart,bidiFlags,advances,0);
  float sum=0;
  int i;
  for (i=0; i < count && sum < advance; i++) {
    sum+=advances[i];
  }
  float distanceToI=sum - advance;
  float distanceToIMinus1=advance - (sum - advances[i]);
  return distanceToI > distanceToIMinus1 ? i : i - 1;
}
