{
  long beginTime=XmlUtils.readLongAttribute(parser,BEGIN_TIME_ATTR);
  long endTime=XmlUtils.readLongAttribute(parser,END_TIME_ATTR);
  UsageStats stats=UsageStats.create(beginTime,endTime);
  XmlUtils.nextElement(parser);
  while (parser.getEventType() != XmlPullParser.END_DOCUMENT) {
    if (parser.getName().equals(PACKAGE_TAG)) {
      String name=parser.getAttributeValue(null,NAME_ATTR);
      if (name == null) {
        throw new ProtocolException("no " + NAME_ATTR + " attribute present");
      }
      PackageUsageStats pkgStats=stats.getOrCreatePackageUsageStats(name);
      pkgStats.mTotalTimeSpent=XmlUtils.readLongAttribute(parser,TOTAL_TIME_ACTIVE_ATTR);
      pkgStats.mLastTimeUsed=XmlUtils.readLongAttribute(parser,LAST_TIME_ACTIVE_ATTR);
      pkgStats.mLastEvent=XmlUtils.readIntAttribute(parser,LAST_EVENT_ATTR);
    }
    XmlUtils.skipCurrentTag(parser);
  }
  return stats;
}
