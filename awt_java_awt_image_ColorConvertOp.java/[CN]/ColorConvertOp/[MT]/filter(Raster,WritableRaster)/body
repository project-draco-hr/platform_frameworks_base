{
  if (conversionSequence.length < 2) {
    throw new IllegalArgumentException(Messages.getString("awt.25D"));
  }
  ICC_Profile srcPf=null, dstPf=null;
  int nSrcColorComps, nDstColorComps;
  Object first=conversionSequence[0];
  Object last=conversionSequence[conversionSequence.length - 1];
  if (isICC) {
    srcPf=(ICC_Profile)first;
    dstPf=(ICC_Profile)last;
    nSrcColorComps=srcPf.getNumComponents();
    nDstColorComps=dstPf.getNumComponents();
  }
 else {
    if (first instanceof ICC_Profile) {
      srcPf=(ICC_Profile)first;
      nSrcColorComps=srcPf.getNumComponents();
    }
 else {
      nSrcColorComps=((ColorSpace)first).getNumComponents();
    }
    if (last instanceof ICC_Profile) {
      dstPf=(ICC_Profile)last;
      nDstColorComps=dstPf.getNumComponents();
    }
 else {
      nDstColorComps=((ColorSpace)last).getNumComponents();
    }
  }
  if (src.getNumBands() != nSrcColorComps) {
    throw new IllegalArgumentException(Messages.getString("awt.25E"));
  }
  if (dst != null) {
    if (dst.getNumBands() != nDstColorComps) {
      throw new IllegalArgumentException(Messages.getString("awt.25F"));
    }
    if (src.getWidth() != dst.getWidth() || src.getHeight() != dst.getHeight()) {
      throw new IllegalArgumentException(Messages.getString("awt.260"));
    }
  }
 else {
    dst=createCompatibleDestRaster(src);
  }
  if (isICC) {
    ICC_Transform t=tCreator.getTransform(srcPf,dstPf,(ICC_Profile[])conversionSequence);
    cc.translateColor(t,src,dst);
  }
 else {
    Object[] sequence=tCreator.getSequence(null,null);
    ColorScaler scaler=new ColorScaler();
    scaler.loadScalingData(src,null);
    float tmpData[][]=scaler.scaleNormalize(src);
    ColorSpace srcCS=(srcPf == null) ? (ColorSpace)first : new ICC_ColorSpace(srcPf);
    ColorSpace dstCS=(dstPf == null) ? (ColorSpace)last : new ICC_ColorSpace(dstPf);
    applySequence(sequence,tmpData,srcCS,dstCS);
    scaler.loadScalingData(dst,null);
    scaler.unscaleNormalized(dst,tmpData);
  }
  return dst;
}
