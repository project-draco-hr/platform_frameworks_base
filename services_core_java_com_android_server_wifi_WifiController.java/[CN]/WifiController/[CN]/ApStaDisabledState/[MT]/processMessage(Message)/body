{
switch (msg.what) {
case CMD_WIFI_TOGGLED:
case CMD_AIRPLANE_TOGGLED:
    if (mSettingsStore.isWifiToggleEnabled()) {
      if (doDeferEnable(msg)) {
        if (mHaveDeferredEnable) {
          mDeferredEnableSerialNumber++;
        }
        mHaveDeferredEnable=!mHaveDeferredEnable;
        break;
      }
      if (mDeviceIdle == false) {
        transitionTo(mDeviceActiveState);
      }
 else {
        checkLocksAndTransitionWhenDeviceIdle();
      }
    }
  break;
case CMD_SCAN_ALWAYS_MODE_CHANGED:
if (mSettingsStore.isScanAlwaysAvailable()) {
  transitionTo(mStaDisabledWithScanState);
}
break;
case CMD_SET_AP:
if (msg.arg1 == 1) {
mWifiStateMachine.setHostApRunning((WifiConfiguration)msg.obj,true);
transitionTo(mApEnabledState);
}
break;
case CMD_DEFERRED_TOGGLE:
if (msg.arg1 != mDeferredEnableSerialNumber) {
log("DEFERRED_TOGGLE ignored due to serial mismatch");
break;
}
log("DEFERRED_TOGGLE handled");
sendMessage((Message)(msg.obj));
break;
default :
return NOT_HANDLED;
}
return HANDLED;
}
