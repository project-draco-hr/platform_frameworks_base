{
  mContext=context;
  mUserId=userId;
  mWindowManager=LocalServices.getService(WindowManagerInternal.class);
  mMultiTapTimeSlop=ViewConfiguration.getDoubleTapTimeout() + mContext.getResources().getInteger(com.android.internal.R.integer.config_screen_magnification_multi_tap_adjustment);
  mTapDistanceSlop=ViewConfiguration.get(context).getScaledTouchSlop();
  mMultiTapDistanceSlop=ViewConfiguration.get(context).getScaledDoubleTapSlop();
  mDetectingStateHandler=new DetectingStateHandler();
  mStateViewportDraggingHandler=new StateViewportDraggingHandler();
  mMagnifiedContentInteractonStateHandler=new MagnifiedContentInteractonStateHandler(context);
  mMagnificationController=service.getMagnificationController();
  mScreenStateObserver=new ScreenStateObserver(context,mMagnificationController);
  mWindowManager.setMagnificationCallbacks(this);
  transitionToState(STATE_DETECTING);
}
