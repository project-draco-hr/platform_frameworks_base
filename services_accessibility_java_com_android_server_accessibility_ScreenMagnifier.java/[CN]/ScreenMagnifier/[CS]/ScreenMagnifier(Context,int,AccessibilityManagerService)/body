{
  mContext=context;
  mWindowManager=LocalServices.getService(WindowManagerInternal.class);
  mAms=service;
  mLongAnimationDuration=context.getResources().getInteger(com.android.internal.R.integer.config_longAnimTime);
  mTapDistanceSlop=ViewConfiguration.get(context).getScaledTouchSlop();
  mMultiTapDistanceSlop=ViewConfiguration.get(context).getScaledDoubleTapSlop();
  mDetectingStateHandler=new DetectingStateHandler();
  mStateViewportDraggingHandler=new StateViewportDraggingHandler();
  mMagnifiedContentInteractonStateHandler=new MagnifiedContentInteractonStateHandler(context);
  mMagnificationController=new MagnificationController(mLongAnimationDuration);
  mScreenStateObserver=new ScreenStateObserver(context,mMagnificationController);
  mWindowManager.setMagnificationCallbacks(this);
  transitionToState(STATE_DETECTING);
}
