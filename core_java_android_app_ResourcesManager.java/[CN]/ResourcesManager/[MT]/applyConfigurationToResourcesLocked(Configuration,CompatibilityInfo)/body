{
  if (!mResConfiguration.isOtherSeqNewer(config) && compat == null) {
    if (DEBUG || DEBUG_CONFIGURATION)     Slog.v(TAG,"Skipping new config: curSeq=" + mResConfiguration.seq + ", newSeq="+ config.seq);
    return false;
  }
  int changes=mResConfiguration.updateFrom(config);
  mDisplays.clear();
  DisplayMetrics defaultDisplayMetrics=getDisplayMetrics();
  if (compat != null && (mResCompatibilityInfo == null || !mResCompatibilityInfo.equals(compat))) {
    mResCompatibilityInfo=compat;
    changes|=ActivityInfo.CONFIG_SCREEN_LAYOUT | ActivityInfo.CONFIG_SCREEN_SIZE | ActivityInfo.CONFIG_SMALLEST_SCREEN_SIZE;
  }
  Configuration localeAdjustedConfig=config;
  final LocaleList configLocales=config.getLocales();
  if (!configLocales.isEmpty()) {
    setDefaultLocalesLocked(configLocales);
    final LocaleList adjustedLocales=LocaleList.getAdjustedDefault();
    if (adjustedLocales != configLocales) {
      localeAdjustedConfig=new Configuration();
      localeAdjustedConfig.setTo(config);
      localeAdjustedConfig.setLocales(adjustedLocales);
      if (!mResConfiguration.getLocales().equals(adjustedLocales)) {
        mResConfiguration.setLocales(adjustedLocales);
        changes|=ActivityInfo.CONFIG_LOCALE;
      }
    }
  }
  Resources.updateSystemConfiguration(localeAdjustedConfig,defaultDisplayMetrics,compat);
  ApplicationPackageManager.configurationChanged();
  Configuration tmpConfig=null;
  for (int i=mResourceImpls.size() - 1; i >= 0; i--) {
    ResourcesKey key=mResourceImpls.keyAt(i);
    ResourcesImpl r=mResourceImpls.valueAt(i).get();
    if (r != null) {
      if (DEBUG || DEBUG_CONFIGURATION)       Slog.v(TAG,"Changing resources " + r + " config to: "+ localeAdjustedConfig);
      int displayId=key.mDisplayId;
      boolean isDefaultDisplay=(displayId == Display.DEFAULT_DISPLAY);
      DisplayMetrics dm=defaultDisplayMetrics;
      final boolean hasOverrideConfiguration=key.hasOverrideConfiguration();
      if (!isDefaultDisplay || hasOverrideConfiguration) {
        if (tmpConfig == null) {
          tmpConfig=new Configuration();
        }
        tmpConfig.setTo(localeAdjustedConfig);
        if (!isDefaultDisplay) {
          dm=getDisplayMetrics(displayId);
          applyNonDefaultDisplayMetricsToConfiguration(dm,tmpConfig);
        }
        if (hasOverrideConfiguration) {
          tmpConfig.updateFrom(key.mOverrideConfiguration);
        }
        r.updateConfiguration(tmpConfig,dm,compat);
      }
 else {
        r.updateConfiguration(localeAdjustedConfig,dm,compat);
      }
    }
 else {
      mResourceImpls.removeAt(i);
    }
  }
  return changes != 0;
}
