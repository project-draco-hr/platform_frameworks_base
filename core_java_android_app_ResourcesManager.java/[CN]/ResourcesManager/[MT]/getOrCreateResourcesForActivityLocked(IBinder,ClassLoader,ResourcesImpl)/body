{
  final ActivityResources activityResources=getOrCreateActivityResourcesStructLocked(activityToken);
  final int refCount=activityResources.activityResources.size();
  for (int i=0; i < refCount; i++) {
    WeakReference<Resources> weakResourceRef=activityResources.activityResources.get(i);
    Resources resources=weakResourceRef.get();
    if (resources != null && Objects.equals(resources.getClassLoader(),classLoader) && resources.getImpl() == impl) {
      if (DEBUG) {
        Slog.d(TAG,"- using existing ref=" + resources);
      }
      return resources;
    }
  }
  Resources resources=new Resources(classLoader);
  resources.setImpl(impl);
  activityResources.activityResources.add(new WeakReference<>(resources));
  if (DEBUG) {
    Slog.d(TAG,"- creating new ref=" + resources);
    Slog.d(TAG,"- setting ref=" + resources + " with impl="+ impl);
  }
  return resources;
}
