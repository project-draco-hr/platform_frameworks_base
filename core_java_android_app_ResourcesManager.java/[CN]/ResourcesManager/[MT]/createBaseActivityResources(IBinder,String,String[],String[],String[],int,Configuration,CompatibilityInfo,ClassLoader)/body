{
  try {
    Trace.traceBegin(Trace.TRACE_TAG_RESOURCES,"ResourcesManager#createBaseActivityResources");
    final ResourcesKey key=new ResourcesKey(resDir,splitResDirs,overlayDirs,libDirs,displayId,overrideConfig != null ? new Configuration(overrideConfig) : null,compatInfo);
    classLoader=classLoader != null ? classLoader : ClassLoader.getSystemClassLoader();
    if (DEBUG) {
      Slog.d(TAG,"createBaseActivityResources activity=" + activityToken + " with key="+ key);
    }
synchronized (this) {
      final ActivityResources activityResources=getOrCreateActivityResourcesStructLocked(activityToken);
      if (overrideConfig != null) {
        activityResources.overrideConfig.setTo(overrideConfig);
      }
 else {
        activityResources.overrideConfig.setToDefaults();
      }
    }
    updateResourcesForActivity(activityToken,overrideConfig);
    return getOrCreateResources(activityToken,key,classLoader);
  }
  finally {
    Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
  }
}
