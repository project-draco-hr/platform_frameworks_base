{
  Configuration config;
  final boolean isDefaultDisplay=(key.mDisplayId == Display.DEFAULT_DISPLAY);
  final boolean hasOverrideConfig=key.hasOverrideConfiguration();
  if (!isDefaultDisplay || hasOverrideConfig) {
    config=new Configuration(getConfiguration());
    if (!isDefaultDisplay) {
      applyNonDefaultDisplayMetricsToConfiguration(dm,config);
    }
    if (hasOverrideConfig) {
      config.updateFrom(key.mOverrideConfiguration);
      if (DEBUG)       Slog.v(TAG,"Applied overrideConfig=" + key.mOverrideConfiguration);
    }
  }
 else {
    config=getConfiguration();
  }
  return config;
}
