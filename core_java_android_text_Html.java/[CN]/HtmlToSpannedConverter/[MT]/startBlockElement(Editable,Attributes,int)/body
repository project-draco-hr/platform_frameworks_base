{
  final int len=text.length();
  if (margin > 0) {
    appendNewlines(text,margin);
    text.setSpan(new Newline(margin),len,len,Spannable.SPAN_INCLUSIVE_EXCLUSIVE);
  }
  String style=attributes.getValue("","style");
  if (style != null) {
    Matcher m=getTextAlignPattern().matcher(style);
    if (m.find()) {
      String alignment=m.group(1);
      if (alignment.equalsIgnoreCase("start")) {
        text.setSpan(new Alignment(Layout.Alignment.ALIGN_NORMAL),len,len,Spannable.SPAN_INCLUSIVE_EXCLUSIVE);
      }
 else       if (alignment.equalsIgnoreCase("center")) {
        text.setSpan(new Alignment(Layout.Alignment.ALIGN_CENTER),len,len,Spannable.SPAN_INCLUSIVE_EXCLUSIVE);
      }
 else       if (alignment.equalsIgnoreCase("end")) {
        text.setSpan(new Alignment(Layout.Alignment.ALIGN_OPPOSITE),len,len,Spannable.SPAN_INCLUSIVE_EXCLUSIVE);
      }
    }
  }
}
