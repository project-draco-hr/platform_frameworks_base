{
  final Map<String,Integer> packages=new ArrayMap<>();
  packages.put("com.example",66);
  packages.put("org.example",77);
  packages.put("net.example",78);
  setMockedPackages(packages);
  final Vpn vpn=createVpn(primaryUser.id);
  final UidRange user=UidRange.createForUser(primaryUser.id);
  final Set<UidRange> allow=vpn.createUserAndRestrictedProfilesRanges(primaryUser.id,new ArrayList<String>(packages.keySet()),null);
  assertEquals(new ArraySet<>(Arrays.asList(new UidRange[]{new UidRange(user.start + 66,user.start + 66),new UidRange(user.start + 77,user.start + 78)})),allow);
  final Set<UidRange> disallow=vpn.createUserAndRestrictedProfilesRanges(primaryUser.id,null,new ArrayList<String>(packages.keySet()));
  assertEquals(new ArraySet<>(Arrays.asList(new UidRange[]{new UidRange(user.start,user.start + 65),new UidRange(user.start + 67,user.start + 76),new UidRange(user.start + 79,user.stop)})),disallow);
}
