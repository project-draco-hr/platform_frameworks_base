{
  boolean success=false;
  try {
    mStorageManager.format(mVolumeId);
    success=true;
  }
 catch (  Exception e) {
    Slog.w(TAG,"Failed to format",e);
    Toast.makeText(ExternalStorageFormatter.this,R.string.format_error,Toast.LENGTH_LONG).show();
  }
  if (success) {
    if (mFactoryReset) {
      Intent intent=new Intent(Intent.ACTION_MASTER_CLEAR);
      intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
      intent.putExtra(Intent.EXTRA_REASON,mReason);
      sendBroadcast(intent);
      stopSelf();
      return;
    }
  }
  if (!success && mAlwaysReset) {
    Intent intent=new Intent(Intent.ACTION_MASTER_CLEAR);
    intent.addFlags(Intent.FLAG_RECEIVER_FOREGROUND);
    intent.putExtra(Intent.EXTRA_REASON,mReason);
    sendBroadcast(intent);
  }
 else {
    try {
      mStorageManager.mount(mVolumeId);
    }
 catch (    Exception e) {
      Slog.w(TAG,"Failed to mount",e);
    }
  }
  stopSelf();
}
