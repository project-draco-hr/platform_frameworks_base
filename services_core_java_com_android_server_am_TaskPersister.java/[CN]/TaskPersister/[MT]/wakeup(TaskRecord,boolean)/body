{
synchronized (this) {
    if (task != null) {
      int queueNdx;
      for (queueNdx=mWriteQueue.size() - 1; queueNdx >= 0; --queueNdx) {
        final WriteQueueItem item=mWriteQueue.get(queueNdx);
        if (item instanceof TaskWriteQueueItem && ((TaskWriteQueueItem)item).mTask == task) {
          if (!task.inRecents) {
            removeThumbnails(task);
          }
          break;
        }
      }
      if (queueNdx < 0) {
        mWriteQueue.add(new TaskWriteQueueItem(task));
      }
    }
 else {
      mWriteQueue.add(new WriteQueueItem());
    }
    if (flush || mWriteQueue.size() > MAX_WRITE_QUEUE_LENGTH) {
      mNextWriteTime=FLUSH_QUEUE;
    }
 else     if (mNextWriteTime == 0) {
      mNextWriteTime=SystemClock.uptimeMillis() + PRE_TASK_DELAY_MS;
    }
    if (DEBUG)     Slog.d(TAG,"wakeup: task=" + task + " flush="+ flush+ " mNextWriteTime="+ mNextWriteTime+ " mWriteQueue.size="+ mWriteQueue.size()+ " Callers="+ Debug.getCallers(4));
    notifyAll();
  }
  yieldIfQueueTooDeep();
}
