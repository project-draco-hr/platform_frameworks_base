{
  if (DBG)   Log.d(TAG,"getConnectedDevices");
  if (profile != BluetoothProfile.GATT && profile != BluetoothProfile.GATT_SERVER) {
    throw new IllegalArgumentException("Profile not supported: " + profile);
  }
  List<BluetoothDevice> connectedDevices=new ArrayList<BluetoothDevice>();
  try {
    IBluetoothManager managerService=mAdapter.getBluetoothManager();
    IBluetoothGatt iGatt=managerService.getBluetoothGatt();
    if (iGatt == null)     return connectedDevices;
    connectedDevices=iGatt.getDevicesMatchingConnectionStates(new int[]{BluetoothProfile.STATE_CONNECTED});
  }
 catch (  RemoteException e) {
    Log.e(TAG,"",e);
  }
  return connectedDevices;
}
