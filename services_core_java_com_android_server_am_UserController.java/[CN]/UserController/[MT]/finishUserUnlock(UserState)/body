{
  final int userId=uss.mHandle.getIdentifier();
synchronized (mService) {
    if (mStartedUsers.get(uss.mHandle.getIdentifier()) != uss)     return;
    if (!isUserKeyUnlocked(userId))     return;
    if (uss.state == UserState.STATE_RUNNING_LOCKED) {
      uss.setState(UserState.STATE_RUNNING);
      mHandler.sendMessage(mHandler.obtainMessage(SYSTEM_USER_UNLOCK_MSG,userId,0));
      final Intent unlockedIntent=new Intent(Intent.ACTION_USER_UNLOCKED);
      unlockedIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY | Intent.FLAG_RECEIVER_FOREGROUND);
      mService.broadcastIntentLocked(null,null,unlockedIntent,null,null,0,null,null,null,AppOpsManager.OP_NONE,null,false,false,MY_PID,SYSTEM_UID,userId);
      final Intent bootIntent=new Intent(Intent.ACTION_BOOT_COMPLETED,null);
      bootIntent.putExtra(Intent.EXTRA_USER_HANDLE,userId);
      bootIntent.addFlags(Intent.FLAG_RECEIVER_NO_ABORT | Intent.FLAG_RECEIVER_INCLUDE_BACKGROUND);
      mService.broadcastIntentLocked(null,null,bootIntent,null,null,0,null,null,new String[]{android.Manifest.permission.RECEIVE_BOOT_COMPLETED},AppOpsManager.OP_NONE,null,true,false,MY_PID,SYSTEM_UID,userId);
    }
  }
}
