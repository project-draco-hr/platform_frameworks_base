{
  if (mService.checkCallingPermission(INTERACT_ACROSS_USERS_FULL) != PackageManager.PERMISSION_GRANTED) {
    String msg="Permission Denial: unlockUser() from pid=" + Binder.getCallingPid() + ", uid="+ Binder.getCallingUid()+ " requires "+ INTERACT_ACROSS_USERS_FULL;
    Slog.w(TAG,msg);
    throw new SecurityException(msg);
  }
  final UserInfo userInfo=getUserInfo(userId);
  final IMountService mountService=IMountService.Stub.asInterface(ServiceManager.getService("mount"));
  try {
    mountService.unlockUserKey(userId,userInfo.serialNumber,token);
  }
 catch (  RemoteException e) {
    Slog.w(TAG,"Failed to unlock: " + e.getMessage());
    throw e.rethrowAsRuntimeException();
  }
synchronized (mService) {
    final UserState uss=mStartedUsers.get(userId);
    updateUserUnlockedState(uss);
  }
  return true;
}
