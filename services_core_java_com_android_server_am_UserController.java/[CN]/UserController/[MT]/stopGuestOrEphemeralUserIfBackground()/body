{
synchronized (mService) {
    final int num=mUserLru.size();
    for (int i=0; i < num; i++) {
      Integer oldUserId=mUserLru.get(i);
      UserState oldUss=mStartedUsers.get(oldUserId);
      if (oldUserId == UserHandle.USER_SYSTEM || oldUserId == mCurrentUserId || oldUss.state == UserState.STATE_STOPPING || oldUss.state == UserState.STATE_SHUTDOWN) {
        continue;
      }
      UserInfo userInfo=getUserInfo(oldUserId);
      if (userInfo.isEphemeral()) {
        LocalServices.getService(UserManagerInternal.class).onEphemeralUserStop(oldUserId);
      }
      if (userInfo.isGuest() || userInfo.isEphemeral()) {
        stopUsersLocked(oldUserId,true,null);
        break;
      }
    }
  }
}
