{
synchronized (mService) {
    final UserState uss=mStartedUsers.get(userId);
switch (uss.state) {
case STATE_RUNNING_UNLOCKING:
case STATE_RUNNING_UNLOCKED:
      progress.finish();
    return true;
}
}
if (!isUserKeyUnlocked(userId)) {
final UserInfo userInfo=getUserInfo(userId);
final IMountService mountService=getMountService();
try {
  mountService.unlockUserKey(userId,userInfo.serialNumber,token,secret);
}
 catch (RemoteException|RuntimeException e) {
  Slog.w(TAG,"Failed to unlock: " + e.getMessage());
  progress.finish();
  return false;
}
}
synchronized (mService) {
final UserState uss=mStartedUsers.get(userId);
finishUserUnlocking(uss,progress);
}
return true;
}
