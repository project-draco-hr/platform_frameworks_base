{
  boolean unfrozen=false;
synchronized (mService) {
    if (clearInitializing) {
      uss.initializing=false;
      getUserManager().makeInitialized(uss.mHandle.getIdentifier());
    }
    if (clearSwitching) {
      uss.switching=false;
    }
    if (!uss.switching && !uss.initializing) {
      mService.mWindowManager.stopFreezingScreen();
      unfrozen=true;
    }
  }
  if (unfrozen) {
    mHandler.removeMessages(REPORT_USER_SWITCH_COMPLETE_MSG);
    mHandler.sendMessage(mHandler.obtainMessage(REPORT_USER_SWITCH_COMPLETE_MSG,newUserId,0));
  }
  stopGuestUserIfBackground();
  stopBackgroundUsersIfEnforced(oldUserId);
}
