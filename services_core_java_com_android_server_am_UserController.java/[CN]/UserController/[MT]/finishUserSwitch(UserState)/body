{
synchronized (mService) {
    finishUserBoot(uss);
    startProfilesLocked();
    int num=mUserLru.size();
    int i=0;
    while (num > MAX_RUNNING_USERS && i < mUserLru.size()) {
      Integer oldUserId=mUserLru.get(i);
      UserState oldUss=mStartedUsers.get(oldUserId);
      if (oldUss == null) {
        mUserLru.remove(i);
        num--;
        continue;
      }
      if (oldUss.mState == UserState.STATE_STOPPING || oldUss.mState == UserState.STATE_SHUTDOWN) {
        num--;
        i++;
        continue;
      }
      if (oldUserId == UserHandle.USER_SYSTEM || oldUserId == mCurrentUserId) {
        if (UserInfo.isSystemOnly(oldUserId)) {
          num--;
        }
        i++;
        continue;
      }
      stopUserLocked(oldUserId,null);
      num--;
      i++;
    }
  }
}
