{
  int fileSize=10000000;
  byte[] blobData=generateData(fileSize,DataType.BINARY);
  long dlRequest=-1;
  boolean spaceAvailable=true;
  while (spaceAvailable) {
    dlRequest=doStandardEnqueue(blobData);
    waitForDownloadOrTimeout(dlRequest);
    StatFs fs=new StatFs(CACHE_DIR);
    Log.i(LOG_TAG,"getAvailableBlocks: " + fs.getAvailableBlocks());
    Log.i(LOG_TAG,"getBlockSize: " + fs.getBlockSize());
    int availableBytes=fs.getBlockSize() * fs.getAvailableBlocks();
    spaceAvailable=(availableBytes > fileSize) ? true : false;
  }
  dlRequest=doStandardEnqueue(blobData);
  waitForDownloadOrTimeout(dlRequest);
  Cursor cursor=getCursor(dlRequest);
  try {
    verifyInt(cursor,DownloadManager.COLUMN_REASON,DownloadManager.ERROR_INSUFFICIENT_SPACE);
  }
  finally {
    cursor.close();
  }
}
