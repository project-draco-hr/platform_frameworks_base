{
  String localDownloadDirectory=Environment.getExternalStorageDirectory().getPath();
  File downloadedFile=new File(localDownloadDirectory,DEFAULT_FILENAME);
  downloadedFile.delete();
  try {
    byte[] blobData=generateData(DEFAULT_FILE_SIZE,DataType.TEXT);
    enqueueResponse(HTTP_OK,blobData);
    Uri uri=getServerUri(DEFAULT_FILENAME);
    Request request=new Request(uri);
    Uri localUri=Uri.fromFile(downloadedFile);
    Log.i(LOG_TAG,"setting localUri to: " + localUri.getPath());
    request.setDestinationUri(localUri);
    long dlRequest=mDownloadManager.enqueue(request);
    waitForDownloadOrTimeout(dlRequest);
    verifyAndCleanupSingleFileDownload(dlRequest,blobData);
    assertEquals(1,mReceiver.numDownloadsCompleted());
  }
  finally {
    downloadedFile.delete();
  }
}
