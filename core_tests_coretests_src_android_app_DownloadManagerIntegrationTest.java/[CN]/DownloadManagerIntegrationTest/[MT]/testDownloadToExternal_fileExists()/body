{
  File existentFile=createFileOnSD(null,1,DataType.TEXT,null);
  byte[] blobData=generateData(DEFAULT_FILE_SIZE,DataType.TEXT);
  enqueueResponse(HTTP_OK,blobData);
  try {
    Uri uri=getServerUri(DEFAULT_FILENAME);
    Request request=new Request(uri);
    Uri localUri=Uri.fromFile(existentFile);
    Log.i(LOG_TAG,"setting localUri to: " + localUri.getPath());
    request.setDestinationUri(localUri);
    long dlRequest=mDownloadManager.enqueue(request);
    waitForDownloadOrTimeout(dlRequest);
    Cursor cursor=getCursor(dlRequest);
    try {
      verifyInt(cursor,DownloadManager.COLUMN_STATUS,DownloadManager.STATUS_FAILED);
      verifyInt(cursor,DownloadManager.COLUMN_REASON,DownloadManager.ERROR_FILE_ERROR);
    }
  finally {
      cursor.close();
    }
  }
  finally {
    existentFile.delete();
  }
}
