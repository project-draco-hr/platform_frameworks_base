{
  if (!isSystemReady) {
    final ArrayList<InputMethodInfo> retval=new ArrayList<>();
    for (int i=0; i < imis.size(); ++i) {
      final InputMethodInfo imi=imis.get(i);
      if (isSystemImeThatHasEnglishKeyboardSubtype(imi)) {
        retval.add(imi);
      }
    }
    return retval;
  }
  final ArrayList<InputMethodInfo> retval=new ArrayList<>();
  boolean auxilialyImeAdded=false;
  for (int i=0; i < imis.size(); ++i) {
    final InputMethodInfo imi=imis.get(i);
    if (isValidSystemDefaultIme(isSystemReady,imi,context) || isSystemImeThatHasEnglishKeyboardSubtype(imi)) {
      retval.add(imi);
      if (imi.isAuxiliaryIme()) {
        auxilialyImeAdded=true;
      }
    }
  }
  if (auxilialyImeAdded) {
    return retval;
  }
  for (int i=0; i < imis.size(); ++i) {
    final InputMethodInfo imi=imis.get(i);
    if (isSystemAuxilialyImeThatHasAutomaticSubtype(imi)) {
      retval.add(imi);
    }
  }
  return retval;
}
