{
  List<Pair<String,ArrayList<String>>> enabledImes=getEnabledInputMethodsAndSubtypeListLocked();
  List<Pair<String,String>> subtypeHistory=loadInputMethodAndSubtypeHistoryLocked();
  for (  Pair<String,String> imeAndSubtype : subtypeHistory) {
    final String imeInTheHistory=imeAndSubtype.first;
    if (TextUtils.isEmpty(imeId) || imeInTheHistory.equals(imeId)) {
      final String subtypeInTheHistory=imeAndSubtype.second;
      final String subtypeHashCode=getEnabledSubtypeHashCodeForInputMethodAndSubtypeLocked(enabledImes,imeInTheHistory,subtypeInTheHistory);
      if (!TextUtils.isEmpty(subtypeHashCode)) {
        if (DEBUG) {
          Slog.d(TAG,"Enabled subtype found in the history: " + subtypeHashCode);
        }
        return new Pair<>(imeInTheHistory,subtypeHashCode);
      }
    }
  }
  if (DEBUG) {
    Slog.d(TAG,"No enabled IME found in the history");
  }
  return null;
}
