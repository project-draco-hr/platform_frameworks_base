{
  mTarget=target;
  mIn=in;
  mOut=out;
  mErr=err;
  mArgs=args;
  mResultReceiver=resultReceiver;
  mCmd=args != null && args.length > 0 ? args[0] : null;
  mArgPos=1;
  mCurArgData=null;
  mOutPrintWriter=null;
  mErrPrintWriter=null;
  if (DEBUG)   Slog.d(TAG,"Starting command " + mCmd + " on "+ mTarget);
  int res=-1;
  try {
    res=onCommand(mCmd);
    if (DEBUG)     Slog.d(TAG,"Executed command " + mCmd + " on "+ mTarget);
  }
 catch (  SecurityException e) {
    PrintWriter eout=getErrPrintWriter();
    eout.println("Security exception: " + e.getMessage());
    eout.println();
    e.printStackTrace(eout);
  }
catch (  Throwable e) {
    PrintWriter eout=getErrPrintWriter();
    eout.println();
    eout.println("Exception occurred while dumping:");
    e.printStackTrace(eout);
  }
 finally {
    if (DEBUG)     Slog.d(TAG,"Flushing output streams on " + mTarget);
    if (mOutPrintWriter != null) {
      mOutPrintWriter.flush();
    }
    if (mErrPrintWriter != null) {
      mErrPrintWriter.flush();
    }
    if (DEBUG)     Slog.d(TAG,"Sending command result on " + mTarget);
    mResultReceiver.send(res,null);
  }
  if (DEBUG)   Slog.d(TAG,"Finished command " + mCmd + " on "+ mTarget);
  return res;
}
