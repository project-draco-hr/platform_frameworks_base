{
  int height=buildDropDown();
  int widthSpec=0;
  int heightSpec=0;
  boolean noInputMethod=mPopup.getInputMethodMode() == PopupWindow.INPUT_METHOD_NOT_NEEDED;
  if (mPopup.isShowing()) {
    if (mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT) {
      widthSpec=-1;
    }
 else     if (mDropDownWidth == ViewGroup.LayoutParams.WRAP_CONTENT) {
      widthSpec=getDropDownAnchorView().getWidth();
    }
 else {
      widthSpec=mDropDownWidth;
    }
    if (mDropDownHeight == ViewGroup.LayoutParams.FILL_PARENT) {
      heightSpec=noInputMethod ? height : ViewGroup.LayoutParams.FILL_PARENT;
      if (noInputMethod) {
        mPopup.setWindowLayoutMode(mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT ? ViewGroup.LayoutParams.FILL_PARENT : 0,0);
      }
 else {
        mPopup.setWindowLayoutMode(mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT ? ViewGroup.LayoutParams.FILL_PARENT : 0,ViewGroup.LayoutParams.FILL_PARENT);
      }
    }
 else     if (mDropDownHeight == ViewGroup.LayoutParams.WRAP_CONTENT) {
      heightSpec=height;
    }
 else {
      heightSpec=mDropDownHeight;
    }
    mPopup.update(getDropDownAnchorView(),mDropDownHorizontalOffset,mDropDownVerticalOffset,widthSpec,heightSpec);
  }
 else {
    if (mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT) {
      widthSpec=ViewGroup.LayoutParams.FILL_PARENT;
    }
 else {
      if (mDropDownWidth == ViewGroup.LayoutParams.WRAP_CONTENT) {
        mPopup.setWidth(getDropDownAnchorView().getWidth());
      }
 else {
        mPopup.setWidth(mDropDownWidth);
      }
    }
    if (mDropDownHeight == ViewGroup.LayoutParams.FILL_PARENT) {
      heightSpec=ViewGroup.LayoutParams.FILL_PARENT;
    }
 else {
      if (mDropDownHeight == ViewGroup.LayoutParams.WRAP_CONTENT) {
        mPopup.setHeight(height);
      }
 else {
        mPopup.setHeight(mDropDownHeight);
      }
    }
    mPopup.setWindowLayoutMode(widthSpec,heightSpec);
    mPopup.setInputMethodMode(PopupWindow.INPUT_METHOD_NEEDED);
    mPopup.setOutsideTouchable(true);
    mPopup.setTouchInterceptor(new PopupTouchIntercepter());
    mPopup.showAsDropDown(getDropDownAnchorView(),mDropDownHorizontalOffset,mDropDownVerticalOffset);
    mDropDownList.setSelection(ListView.INVALID_POSITION);
    clearListSelection();
    post(mHideSelector);
  }
}
