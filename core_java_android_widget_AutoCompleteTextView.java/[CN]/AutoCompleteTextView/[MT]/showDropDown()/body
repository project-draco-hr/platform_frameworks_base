{
  int height=buildDropDown();
  if (mPopup.isShowing()) {
    int widthSpec;
    if (mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT) {
      widthSpec=-1;
    }
 else     if (mDropDownWidth == ViewGroup.LayoutParams.WRAP_CONTENT) {
      widthSpec=getDropDownAnchorView().getWidth();
    }
 else {
      widthSpec=mDropDownWidth;
    }
    mPopup.update(getDropDownAnchorView(),mDropDownHorizontalOffset,mDropDownVerticalOffset,widthSpec,height);
  }
 else {
    if (mDropDownWidth == ViewGroup.LayoutParams.FILL_PARENT) {
      mPopup.setWindowLayoutMode(ViewGroup.LayoutParams.FILL_PARENT,0);
    }
 else {
      mPopup.setWindowLayoutMode(0,0);
      if (mDropDownWidth == ViewGroup.LayoutParams.WRAP_CONTENT) {
        mPopup.setWidth(getDropDownAnchorView().getWidth());
      }
 else {
        mPopup.setWidth(mDropDownWidth);
      }
    }
    mPopup.setHeight(height);
    mPopup.setInputMethodMode(PopupWindow.INPUT_METHOD_NEEDED);
    mPopup.setOutsideTouchable(!mDropDownAlwaysVisible);
    mPopup.setTouchInterceptor(new PopupTouchIntercepter());
    mPopup.showAsDropDown(getDropDownAnchorView(),mDropDownHorizontalOffset,mDropDownVerticalOffset);
    mDropDownList.setSelection(ListView.INVALID_POSITION);
    mDropDownList.hideSelector();
    mDropDownList.requestFocus();
    post(mHideSelector);
  }
}
