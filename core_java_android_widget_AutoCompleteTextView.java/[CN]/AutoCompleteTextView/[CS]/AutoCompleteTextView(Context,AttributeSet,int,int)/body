{
  super(context,attrs,defStyleAttr,defStyleRes);
  mPopup=new ListPopupWindow(context,attrs,defStyleAttr,defStyleRes);
  mPopup.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE);
  mPopup.setPromptPosition(ListPopupWindow.POSITION_PROMPT_BELOW);
  final TypedArray a=context.obtainStyledAttributes(attrs,R.styleable.AutoCompleteTextView,defStyleAttr,defStyleRes);
  mThreshold=a.getInt(R.styleable.AutoCompleteTextView_completionThreshold,2);
  mPopup.setListSelector(a.getDrawable(R.styleable.AutoCompleteTextView_dropDownSelector));
  mDropDownAnchorId=a.getResourceId(R.styleable.AutoCompleteTextView_dropDownAnchor,View.NO_ID);
  mPopup.setWidth(a.getLayoutDimension(R.styleable.AutoCompleteTextView_dropDownWidth,ViewGroup.LayoutParams.WRAP_CONTENT));
  mPopup.setHeight(a.getLayoutDimension(R.styleable.AutoCompleteTextView_dropDownHeight,ViewGroup.LayoutParams.WRAP_CONTENT));
  mHintResource=a.getResourceId(R.styleable.AutoCompleteTextView_completionHintView,R.layout.simple_dropdown_hint);
  mPopup.setOnItemClickListener(new DropDownItemClickListener());
  setCompletionHint(a.getText(R.styleable.AutoCompleteTextView_completionHint));
  int inputType=getInputType();
  if ((inputType & EditorInfo.TYPE_MASK_CLASS) == EditorInfo.TYPE_CLASS_TEXT) {
    inputType|=EditorInfo.TYPE_TEXT_FLAG_AUTO_COMPLETE;
    setRawInputType(inputType);
  }
  a.recycle();
  setFocusable(true);
  addTextChangedListener(new MyWatcher());
  mPassThroughClickListener=new PassThroughClickListener();
  super.setOnClickListener(mPassThroughClickListener);
}
