{
  SparseIntArray uidFirewallRules=getUidFirewallRules(chain);
  final int oldUidFirewallRule=uidFirewallRules.get(uid,FIREWALL_RULE_DEFAULT);
  if (DBG) {
    Slog.d(TAG,"oldRule = " + oldUidFirewallRule + ", newRule="+ rule+ " for uid="+ uid+ " on chain "+ chain);
  }
  if (oldUidFirewallRule == rule) {
    if (DBG)     Slog.d(TAG,"!!!!! Skipping change");
    return false;
  }
  String ruleName=getFirewallRuleName(chain,rule);
  String oldRuleName=getFirewallRuleName(chain,oldUidFirewallRule);
  if (rule == NetworkPolicyManager.FIREWALL_RULE_DEFAULT) {
    uidFirewallRules.delete(uid);
  }
 else {
    uidFirewallRules.put(uid,rule);
  }
  return !ruleName.equals(oldRuleName);
}
