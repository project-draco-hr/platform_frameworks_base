{
  final DisplayMetrics metrics=getContext().getResources().getDisplayMetrics();
  final boolean isPortrait=metrics.widthPixels < metrics.heightPixels;
  final int widthMode=getMode(widthMeasureSpec);
  super.onMeasure(widthMeasureSpec,heightMeasureSpec);
  int width=getMeasuredWidth();
  int height=getMeasuredHeight();
  boolean measure=false;
  final int widthSize=getSize(widthMeasureSpec);
  widthMeasureSpec=MeasureSpec.makeMeasureSpec(width,EXACTLY);
  heightMeasureSpec=MeasureSpec.makeMeasureSpec(height,EXACTLY);
  final float widthWeight=isPortrait ? mMinorWeight : mMajorWeight;
  if (widthMode == AT_MOST && widthWeight > 0.0f) {
    if (width < (widthSize * widthWeight)) {
      widthMeasureSpec=MeasureSpec.makeMeasureSpec((int)(widthSize * widthWeight),EXACTLY);
      measure=true;
    }
  }
  if (measure) {
    super.onMeasure(widthMeasureSpec,heightMeasureSpec);
  }
}
