{
  int i;
  final int NAT=mService.mAppTokens.size();
  for (i=0; i < NAT; i++) {
    final AppWindowAnimator appAnimator=mService.mAppTokens.get(i).mAppAnimator;
    final boolean wasAnimating=appAnimator.animation != null && appAnimator.animation != AppWindowAnimator.sDummyAnimation;
    if (appAnimator.stepAnimationLocked(mCurrentTime,mInnerDw,mInnerDh)) {
      mAnimating=true;
    }
 else     if (wasAnimating) {
      mPendingLayoutChanges|=WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER;
      if (WindowManagerService.DEBUG_LAYOUT_REPEATS) {
        mService.debugLayoutRepeats("appToken " + appAnimator.mAppToken + " done",mPendingLayoutChanges);
      }
    }
  }
  final int NEAT=mService.mExitingAppTokens.size();
  for (i=0; i < NEAT; i++) {
    final AppWindowAnimator appAnimator=mService.mExitingAppTokens.get(i).mAppAnimator;
    final boolean wasAnimating=appAnimator.animation != null && appAnimator.animation != AppWindowAnimator.sDummyAnimation;
    if (appAnimator.stepAnimationLocked(mCurrentTime,mInnerDw,mInnerDh)) {
      mAnimating=true;
    }
 else     if (wasAnimating) {
      mPendingLayoutChanges|=WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER;
      if (WindowManagerService.DEBUG_LAYOUT_REPEATS) {
        mService.debugLayoutRepeats("exiting appToken " + appAnimator.mAppToken + " done",mPendingLayoutChanges);
      }
    }
  }
  if (mScreenRotationAnimation != null && mScreenRotationAnimation.isAnimating()) {
    if (mScreenRotationAnimation.stepAnimationLocked(mCurrentTime)) {
      mAnimating=true;
    }
 else {
      mBulkUpdateParams|=SET_UPDATE_ROTATION;
      mScreenRotationAnimation.kill();
      mScreenRotationAnimation=null;
    }
  }
}
