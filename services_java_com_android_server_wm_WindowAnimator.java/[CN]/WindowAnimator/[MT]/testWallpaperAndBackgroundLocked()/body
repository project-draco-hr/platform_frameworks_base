{
  final WindowState detachedWallpaper=mInner.mDetachedWallpaper;
  if (mWindowDetachedWallpaper != detachedWallpaper) {
    if (WindowManagerService.DEBUG_WALLPAPER)     Slog.v(TAG,"Detached wallpaper changed from " + mWindowDetachedWallpaper + " to "+ detachedWallpaper);
    mWindowDetachedWallpaper=detachedWallpaper;
    mBulkUpdateParams|=SET_WALLPAPER_MAY_CHANGE;
  }
  if (mInner.mWindowAnimationBackgroundColor != 0) {
    WindowState target=mInner.mWindowAnimationBackground;
    if (mService.mWallpaperTarget == target || mService.mLowerWallpaperTarget == target || mService.mUpperWallpaperTarget == target) {
      final int N=mWinAnimators.size();
      for (int i=0; i < N; i++) {
        WindowStateAnimator winAnimator=mWinAnimators.get(i);
        if (winAnimator.mWin.mIsWallpaper) {
          target=winAnimator.mWin;
          break;
        }
      }
    }
    if (mWindowAnimationBackgroundSurface == null) {
      mWindowAnimationBackgroundSurface=new DimSurface(mService.mFxSession);
    }
    final int dw=mDw;
    final int dh=mDh;
    mWindowAnimationBackgroundSurface.show(dw,dh,target.mWinAnimator.mAnimLayer - WindowManagerService.LAYER_OFFSET_DIM,mInner.mWindowAnimationBackgroundColor);
  }
 else   if (mWindowAnimationBackgroundSurface != null) {
    mWindowAnimationBackgroundSurface.hide();
  }
}
