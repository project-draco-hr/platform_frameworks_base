{
  if (mWindowDetachedWallpaper != mDetachedWallpaper) {
    if (WindowManagerService.DEBUG_WALLPAPER)     Slog.v(TAG,"Detached wallpaper changed from " + mWindowDetachedWallpaper + " to "+ mDetachedWallpaper);
    mWindowDetachedWallpaper=mDetachedWallpaper;
    mBulkUpdateParams|=SET_WALLPAPER_MAY_CHANGE;
  }
  if (mWindowAnimationBackgroundColor != 0) {
    WindowState target=mWindowAnimationBackground;
    if (mService.mWallpaperTarget == target || mService.mLowerWallpaperTarget == target || mService.mUpperWallpaperTarget == target) {
      final int N=mService.mWindows.size();
      for (int i=0; i < N; i++) {
        WindowState w=mService.mWindows.get(i);
        if (w.mIsWallpaper) {
          target=w;
          break;
        }
      }
    }
    if (mWindowAnimationBackgroundSurface == null) {
      mWindowAnimationBackgroundSurface=new DimSurface(mService.mFxSession);
    }
    final int dw=mDw;
    final int dh=mDh;
    mWindowAnimationBackgroundSurface.show(dw,dh,target.mWinAnimator.mAnimLayer - WindowManagerService.LAYER_OFFSET_DIM,mWindowAnimationBackgroundColor);
  }
 else   if (mWindowAnimationBackgroundSurface != null) {
    mWindowAnimationBackgroundSurface.hide();
  }
}
