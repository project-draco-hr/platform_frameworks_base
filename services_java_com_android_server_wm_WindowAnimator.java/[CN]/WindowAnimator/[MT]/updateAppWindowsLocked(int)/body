{
  int i;
  final DisplayContent displayContent=mService.getDisplayContentLocked(displayId);
  final ArrayList<Task> tasks=displayContent.mTasks;
  final int numTasks=tasks.size();
  for (int taskNdx=0; taskNdx < numTasks; ++taskNdx) {
    final AppTokenList tokens=tasks.get(taskNdx).mAppTokens;
    final int numTokens=tokens.size();
    for (int tokenNdx=0; tokenNdx < numTokens; ++tokenNdx) {
      final AppWindowAnimator appAnimator=tokens.get(tokenNdx).mAppAnimator;
      final boolean wasAnimating=appAnimator.animation != null && appAnimator.animation != AppWindowAnimator.sDummyAnimation;
      if (appAnimator.stepAnimationLocked(mCurrentTime)) {
        mAnimating=true;
      }
 else       if (wasAnimating) {
        setAppLayoutChanges(appAnimator,WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER,"appToken " + appAnimator.mAppToken + " done");
        if (WindowManagerService.DEBUG_ANIM)         Slog.v(TAG,"updateWindowsApps...: done animating " + appAnimator.mAppToken);
      }
    }
  }
  final AppTokenList exitingAppTokens=displayContent.mExitingAppTokens;
  final int NEAT=exitingAppTokens.size();
  for (i=0; i < NEAT; i++) {
    final AppWindowAnimator appAnimator=exitingAppTokens.get(i).mAppAnimator;
    final boolean wasAnimating=appAnimator.animation != null && appAnimator.animation != AppWindowAnimator.sDummyAnimation;
    if (appAnimator.stepAnimationLocked(mCurrentTime)) {
      mAnimating=true;
    }
 else     if (wasAnimating) {
      setAppLayoutChanges(appAnimator,WindowManagerPolicy.FINISH_LAYOUT_REDO_WALLPAPER,"exiting appToken " + appAnimator.mAppToken + " done");
      if (WindowManagerService.DEBUG_ANIM)       Slog.v(TAG,"updateWindowsApps...: done animating exiting " + appAnimator.mAppToken);
    }
  }
}
