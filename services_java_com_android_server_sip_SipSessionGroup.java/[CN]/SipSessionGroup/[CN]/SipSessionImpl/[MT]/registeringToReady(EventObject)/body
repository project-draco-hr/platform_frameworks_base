{
  if (expectResponse(Request.REGISTER,evt)) {
    ResponseEvent event=(ResponseEvent)evt;
    Response response=event.getResponse();
    int statusCode=response.getStatusCode();
switch (statusCode) {
case Response.OK:
      SipSessionState state=mState;
    reset();
  onRegistrationDone((state == SipSessionState.REGISTERING) ? getExpiryTime(((ResponseEvent)evt).getResponse()) : -1);
mLastNonce=null;
mRPort=0;
return true;
case Response.UNAUTHORIZED:
case Response.PROXY_AUTHENTICATION_REQUIRED:
String nonce=getNonceFromResponse(response);
if (((nonce != null) && nonce.equals(mLastNonce)) || (nonce == mLastNonce)) {
Log.v(TAG,"Incorrect username/password");
reset();
onRegistrationFailed(createCallbackException(response));
}
 else {
mSipHelper.handleChallenge(event,getAccountManager());
mLastNonce=nonce;
}
return true;
default :
if (statusCode >= 500) {
reset();
onRegistrationFailed(createCallbackException(response));
return true;
}
}
}
return false;
}
