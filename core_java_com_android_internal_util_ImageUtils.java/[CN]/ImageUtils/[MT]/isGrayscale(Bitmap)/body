{
  int height=bitmap.getHeight();
  int width=bitmap.getWidth();
  if (height > COMPACT_BITMAP_SIZE || width > COMPACT_BITMAP_SIZE) {
    if (mTempCompactBitmap == null) {
      mTempCompactBitmap=Bitmap.createBitmap(COMPACT_BITMAP_SIZE,COMPACT_BITMAP_SIZE,Bitmap.Config.ARGB_8888);
      mTempCompactBitmapCanvas=new Canvas(mTempCompactBitmap);
      mTempCompactBitmapPaint=new Paint();
      mTempCompactBitmapPaint.setFilterBitmap(true);
    }
    mTempMatrix.reset();
    mTempMatrix.setScale((float)COMPACT_BITMAP_SIZE / width,(float)COMPACT_BITMAP_SIZE / height,0,0);
    mTempCompactBitmapCanvas.drawColor(0,PorterDuff.Mode.SRC);
    mTempCompactBitmapCanvas.drawBitmap(bitmap,mTempMatrix,mTempCompactBitmapPaint);
    bitmap=mTempCompactBitmap;
    width=height=COMPACT_BITMAP_SIZE;
  }
  final int size=height * width;
  ensureBufferSize(size);
  bitmap.getPixels(mTempBuffer,0,width,0,0,width,height);
  for (int i=0; i < size; i++) {
    if (!isGrayscale(mTempBuffer[i])) {
      return false;
    }
  }
  return true;
}
