{
  final int previousWifiApState=mWifiApState;
  if ((mWifiApState == WIFI_AP_STATE_FAILED) && (flag == DriverAction.DRIVER_UNLOAD)) {
    mWifiStateTracker.unloadDriver();
  }
  long ident=Binder.clearCallingIdentity();
  try {
    if (wifiAPState == WIFI_AP_STATE_ENABLED) {
      mBatteryStats.noteWifiOn();
    }
 else     if (wifiAPState == WIFI_AP_STATE_DISABLED) {
      mBatteryStats.noteWifiOff();
    }
  }
 catch (  RemoteException e) {
  }
 finally {
    Binder.restoreCallingIdentity(ident);
  }
  mWifiApState=wifiAPState;
  final Intent intent=new Intent(WifiManager.WIFI_AP_STATE_CHANGED_ACTION);
  intent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  intent.putExtra(WifiManager.EXTRA_WIFI_AP_STATE,wifiAPState);
  intent.putExtra(WifiManager.EXTRA_PREVIOUS_WIFI_AP_STATE,previousWifiApState);
  mContext.sendStickyBroadcast(intent);
}
