{
  enforceAccessPermission();
  String reply;
synchronized (mWifiStateTracker) {
    reply=WifiNative.scanResultsCommand();
  }
  if (reply == null) {
    return null;
  }
  List<ScanResult> scanList=new ArrayList<ScanResult>();
  int lineCount=0;
  int replyLen=reply.length();
  for (int lineBeg=0, lineEnd=0; lineEnd <= replyLen; ++lineEnd) {
    if (lineEnd == replyLen || reply.charAt(lineEnd) == '\n') {
      ++lineCount;
      if (lineCount == 1) {
        lineBeg=lineEnd + 1;
        continue;
      }
      if (lineEnd > lineBeg) {
        String line=reply.substring(lineBeg,lineEnd);
        ScanResult scanResult=parseScanResult(line);
        if (scanResult != null) {
          scanList.add(scanResult);
        }
 else         if (DBG) {
          Log.w(TAG,"misformatted scan result for: " + line);
        }
      }
      lineBeg=lineEnd + 1;
    }
  }
  mWifiStateTracker.setScanResultsList(scanList);
  return scanList;
}
