{
  boolean lockHeld=mLocks.hasLocks();
  int strongestLockMode=WifiManager.WIFI_MODE_FULL;
  boolean wifiShouldBeStarted=!mDeviceIdle || lockHeld;
  if (lockHeld) {
    strongestLockMode=mLocks.getStrongestLockMode();
  }
  if (!mDeviceIdle && strongestLockMode == WifiManager.WIFI_MODE_SCAN_ONLY) {
    strongestLockMode=WifiManager.WIFI_MODE_FULL;
  }
  if (mAirplaneModeOn.get()) {
    mWifiStateMachine.setWifiApEnabled(null,false);
  }
  if (shouldWifiBeEnabled()) {
    if (wifiShouldBeStarted) {
      reportStartWorkSource();
      mWifiStateMachine.setWifiEnabled(true);
      mWifiStateMachine.setScanOnlyMode(strongestLockMode == WifiManager.WIFI_MODE_SCAN_ONLY);
      mWifiStateMachine.setDriverStart(true);
      mWifiStateMachine.setHighPerfModeEnabled(strongestLockMode == WifiManager.WIFI_MODE_FULL_HIGH_PERF);
    }
 else {
      mWifiStateMachine.requestCmWakeLock();
      mWifiStateMachine.setDriverStart(false);
    }
  }
 else {
    mWifiStateMachine.setWifiEnabled(false);
  }
}
