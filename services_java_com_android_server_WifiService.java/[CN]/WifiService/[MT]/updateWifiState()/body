{
  boolean wifiEnabled=getPersistedWifiEnabled();
  boolean airplaneMode=isAirplaneModeOn() && !mAirplaneModeOverwridden.get();
  boolean lockHeld=mLocks.hasLocks();
  int strongestLockMode;
  boolean wifiShouldBeEnabled=wifiEnabled && !airplaneMode;
  boolean wifiShouldBeStarted=!mDeviceIdle || lockHeld;
  if (mDeviceIdle && lockHeld) {
    strongestLockMode=mLocks.getStrongestLockMode();
  }
 else {
    strongestLockMode=WifiManager.WIFI_MODE_FULL;
  }
  if (airplaneMode) {
    mWifiStateTracker.setWifiApEnabled(null,false);
  }
  if (wifiShouldBeEnabled) {
    if (wifiShouldBeStarted) {
      mWifiStateTracker.setWifiEnabled(true);
      mWifiStateTracker.setScanOnlyMode(strongestLockMode == WifiManager.WIFI_MODE_SCAN_ONLY);
      mWifiStateTracker.startWifi(true);
    }
 else {
      mWifiStateTracker.requestCmWakeLock();
      mWifiStateTracker.disconnectAndStop();
    }
  }
 else {
    mWifiStateTracker.setWifiEnabled(false);
  }
}
