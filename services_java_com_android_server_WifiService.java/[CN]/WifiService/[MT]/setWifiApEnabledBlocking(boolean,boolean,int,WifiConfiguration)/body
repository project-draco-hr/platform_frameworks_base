{
  final int eventualWifiApState=enable ? WIFI_AP_STATE_ENABLED : WIFI_AP_STATE_DISABLED;
  if (mWifiApState == eventualWifiApState) {
    return true;
  }
  setWifiApEnabledState(enable ? WIFI_AP_STATE_ENABLING : WIFI_AP_STATE_DISABLING,uid);
  if (enable && (mWifiState == WIFI_STATE_ENABLED)) {
    setWifiEnabledBlocking(false,true,Process.myUid());
  }
  if (enable) {
    if (!mWifiStateTracker.loadDriver()) {
      Slog.e(TAG,"Failed to load Wi-Fi driver for AP mode");
      setWifiApEnabledState(WIFI_AP_STATE_FAILED,uid);
      return false;
    }
    try {
      nwService.startAccessPoint();
    }
 catch (    Exception e) {
      Slog.e(TAG,"Exception in startAccessPoint()");
    }
  }
 else {
    try {
      nwService.stopAccessPoint();
    }
 catch (    Exception e) {
      Slog.e(TAG,"Exception in stopAccessPoint()");
    }
    if (!mWifiStateTracker.unloadDriver()) {
      Slog.e(TAG,"Failed to unload Wi-Fi driver for AP mode");
      setWifiApEnabledState(WIFI_AP_STATE_FAILED,uid);
      return false;
    }
  }
  if (persist) {
    persistWifiApEnabled(enable);
  }
  setWifiApEnabledState(eventualWifiApState,uid);
  return true;
}
