{
  boolean wifiTethered=false;
  boolean wifiAvailable=false;
  IBinder b=ServiceManager.getService(Context.NETWORKMANAGEMENT_SERVICE);
  INetworkManagementService service=INetworkManagementService.Stub.asInterface(b);
  mCm=(ConnectivityManager)mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
  mWifiRegexs=mCm.getTetherableWifiRegexs();
  for (  String intf : available) {
    for (    String regex : mWifiRegexs) {
      if (intf.matches(regex)) {
        InterfaceConfiguration ifcg=null;
        try {
          ifcg=service.getInterfaceConfig(intf);
          if (ifcg != null) {
            ifcg.ipAddr=(169 << 24) + (254 << 16) + (2 << 8)+ 2;
            ifcg.netmask=(255 << 24) + (255 << 16) + (255 << 8)+ 0;
            ifcg.interfaceFlags="up";
            service.setInterfaceConfig(intf,ifcg);
          }
        }
 catch (        Exception e) {
          Slog.e(TAG,"Error configuring interface " + intf + ", :"+ e);
          setWifiApEnabledState(WIFI_AP_STATE_FAILED,0,DriverAction.DRIVER_UNLOAD);
          return;
        }
        if (mCm.tether(intf) != ConnectivityManager.TETHER_ERROR_NO_ERROR) {
          Slog.e(TAG,"Error tethering " + intf);
          setWifiApEnabledState(WIFI_AP_STATE_FAILED,0,DriverAction.DRIVER_UNLOAD);
        }
        break;
      }
    }
  }
}
