{
  enforceChangePermission();
  if (DBG) {
    Slog.e(TAG,"Invoking mWifiStateMachine.setWifiEnabled\n");
  }
  if (enable) {
    reportStartWorkSource();
  }
  mWifiStateMachine.setWifiEnabled(enable);
  long ident=Binder.clearCallingIdentity();
  handleWifiToggled(enable);
  Binder.restoreCallingIdentity(ident);
  if (enable) {
    if (!mIsReceiverRegistered) {
      registerForBroadcasts();
      mIsReceiverRegistered=true;
    }
  }
 else   if (mIsReceiverRegistered) {
    mContext.unregisterReceiver(mReceiver);
    mIsReceiverRegistered=false;
  }
  return true;
}
