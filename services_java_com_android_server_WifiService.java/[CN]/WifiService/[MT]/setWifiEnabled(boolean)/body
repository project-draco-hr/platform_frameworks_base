{
  enforceChangePermission();
  Slog.d(TAG,"setWifiEnabled: " + enable + " pid="+ Binder.getCallingPid()+ ", uid="+ Binder.getCallingUid());
  if (DBG) {
    Slog.e(TAG,"Invoking mWifiStateMachine.setWifiEnabled\n");
  }
  if (enable) {
    reportStartWorkSource();
  }
  mWifiStateMachine.setWifiEnabled(enable);
  if (enable != mWifiEnabled) {
    long ident=Binder.clearCallingIdentity();
    persistWifiState(enable);
    Binder.restoreCallingIdentity(ident);
  }
  if (enable) {
    if (!mIsReceiverRegistered) {
      registerForBroadcasts();
      mIsReceiverRegistered=true;
    }
  }
 else   if (mIsReceiverRegistered) {
    mContext.unregisterReceiver(mReceiver);
    mIsReceiverRegistered=false;
  }
  return true;
}
