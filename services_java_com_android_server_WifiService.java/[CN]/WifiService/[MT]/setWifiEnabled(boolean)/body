{
  enforceChangePermission();
  if (DBG) {
    Slog.e(TAG,"Invoking mWifiStateMachine.setWifiEnabled\n");
  }
  if (enable && isAirplaneModeOn() && isAirplaneToggleable()) {
    mAirplaneModeOverwridden.set(true);
  }
  mWifiStateMachine.setWifiEnabled(enable);
  long ident=Binder.clearCallingIdentity();
  persistWifiEnabled(enable);
  Binder.restoreCallingIdentity(ident);
  if (enable) {
    if (!mIsReceiverRegistered) {
      registerForBroadcasts();
      mIsReceiverRegistered=true;
    }
  }
 else   if (mIsReceiverRegistered) {
    mContext.unregisterReceiver(mReceiver);
    mIsReceiverRegistered=false;
  }
  return true;
}
