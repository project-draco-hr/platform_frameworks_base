{
  mHandler.post(new Runnable(){
    @Override public void run(){
      EventLogTags.writeNotificationCancel(callingUid,callingPid,pkg,id,tag,userId,mustHaveFlags,mustNotHaveFlags,reason,listener == null ? null : listener.component.toShortString());
synchronized (mNotificationList) {
        int index=indexOfNotificationLocked(pkg,tag,id,userId);
        if (index >= 0) {
          NotificationRecord r=mNotificationList.get(index);
          if (reason == REASON_DELEGATE_CLICK) {
            mUsageStats.registerClickedByUser(r);
          }
          if ((r.getNotification().flags & mustHaveFlags) != mustHaveFlags) {
            return;
          }
          if ((r.getNotification().flags & mustNotHaveFlags) != 0) {
            return;
          }
          mNotificationList.remove(index);
          mNotificationsByKey.remove(r.sbn.getKey());
          cancelNotificationLocked(r,sendDelete,reason);
          updateLightsLocked();
        }
      }
    }
  }
);
}
