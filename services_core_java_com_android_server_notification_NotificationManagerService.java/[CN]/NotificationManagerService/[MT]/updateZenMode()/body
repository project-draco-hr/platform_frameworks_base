{
  mZenMode=Settings.Global.getInt(getContext().getContentResolver(),Settings.Global.ZEN_MODE,Settings.Global.ZEN_MODE_OFF);
  if (DBG)   Slog.d(TAG,"updateZenMode " + Settings.Global.zenModeToString(mZenMode));
  if (mAudioManager != null) {
    if (mZenMode == Settings.Global.ZEN_MODE_FULL) {
      mPreZenRingerMode=mAudioManager.getRingerMode();
      if (DBG)       Slog.d(TAG,"Muting calls mPreZenRingerMode=" + mPreZenRingerMode);
      mAudioManager.setStreamMute(AudioManager.STREAM_RING,true);
      mAudioManager.setRingerMode(AudioManager.RINGER_MODE_SILENT);
      mPreZenAlarmVolume=mAudioManager.getStreamVolume(AudioManager.STREAM_ALARM);
      if (DBG)       Slog.d(TAG,"Muting alarms mPreZenAlarmVolume=" + mPreZenAlarmVolume);
      mAudioManager.setStreamMute(AudioManager.STREAM_ALARM,true);
      mAudioManager.setStreamVolume(AudioManager.STREAM_ALARM,0,0);
    }
 else {
      if (DBG)       Slog.d(TAG,"Unmuting calls");
      mAudioManager.setStreamMute(AudioManager.STREAM_RING,false);
      if (mPreZenRingerMode != -1) {
        if (DBG)         Slog.d(TAG,"Restoring ringer mode to " + mPreZenRingerMode);
        mAudioManager.setRingerMode(mPreZenRingerMode);
        mPreZenRingerMode=-1;
      }
      if (DBG)       Slog.d(TAG,"Unmuting alarms");
      mAudioManager.setStreamMute(AudioManager.STREAM_ALARM,false);
      if (mPreZenAlarmVolume != -1) {
        if (DBG)         Slog.d(TAG,"Restoring STREAM_ALARM to " + mPreZenAlarmVolume);
        mAudioManager.setStreamVolume(AudioManager.STREAM_ALARM,mPreZenAlarmVolume,0);
        mPreZenAlarmVolume=-1;
      }
    }
  }
}
