{
  final int mode=Settings.Global.getInt(getContext().getContentResolver(),Settings.Global.ZEN_MODE,Settings.Global.ZEN_MODE_OFF);
  if (mode != mZenMode) {
    Slog.d(TAG,String.format("updateZenMode: %s -> %s",Settings.Global.zenModeToString(mZenMode),Settings.Global.zenModeToString(mode)));
  }
  mZenMode=mode;
  final String[] exceptionPackages=null;
  final boolean muteCalls=mZenMode != Settings.Global.ZEN_MODE_OFF;
  mAppOps.setRestriction(AppOpsManager.OP_VIBRATE,AudioManager.STREAM_RING,muteCalls ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  mAppOps.setRestriction(AppOpsManager.OP_PLAY_AUDIO,AudioManager.STREAM_RING,muteCalls ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  final boolean muteAlarms=false;
  mAppOps.setRestriction(AppOpsManager.OP_VIBRATE,AudioManager.STREAM_ALARM,muteAlarms ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  mAppOps.setRestriction(AppOpsManager.OP_PLAY_AUDIO,AudioManager.STREAM_ALARM,muteAlarms ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
  mAppOps.setRestriction(AppOpsManager.OP_VIBRATE,AudioManager.USE_DEFAULT_STREAM_TYPE,(muteAlarms || muteCalls) ? AppOpsManager.MODE_IGNORED : AppOpsManager.MODE_ALLOWED,exceptionPackages);
}
