{
  ArrayMap<Integer,ArrayList<String>> packageBans=new ArrayMap<>();
  ArrayList<String> packageNames=new ArrayList<>();
  for (  UserInfo user : UserManager.get(getContext()).getUsers()) {
    final int userId=user.getUserHandle().getIdentifier();
    final PackageManager packageManager=getContext().getPackageManager();
    List<PackageInfo> packages=packageManager.getInstalledPackages(0,userId);
    final int packageCount=packages.size();
    for (int p=0; p < packageCount; p++) {
      final String packageName=packages.get(p).packageName;
      if (filter == null || filter.matches(packageName)) {
        final int uid=packageManager.getPackageUid(packageName,userId);
        if (!checkNotificationOp(packageName,uid)) {
          packageNames.add(packageName);
        }
      }
    }
    if (!packageNames.isEmpty()) {
      packageBans.put(userId,packageNames);
      packageNames=new ArrayList<>();
    }
  }
  return packageBans;
}
