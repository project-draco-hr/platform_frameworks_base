{
  if (adjustment.getSignals() != null) {
    Bundle.setDefusable(adjustment.getSignals(),true);
    if (adjustment.getSignals().getBoolean(Adjustment.NEEDS_AUTOGROUPING_KEY,false)) {
      final String newAutoBundleKey=adjustment.getSignals().getString(Adjustment.GROUP_KEY_OVERRIDE_KEY,null);
      int userId=-1;
      NotificationRecord summaryRecord=null;
synchronized (mNotificationList) {
        if (!mAutobundledSummaries.containsKey(adjustment.getPackage()) && newAutoBundleKey != null) {
          final StatusBarNotification adjustedSbn=mNotificationsByKey.get(adjustment.getKey()).sbn;
          final ApplicationInfo appInfo=adjustedSbn.getNotification().extras.getParcelable(Notification.EXTRA_BUILDER_APPLICATION_INFO);
          final Bundle extras=new Bundle();
          extras.putParcelable(Notification.EXTRA_BUILDER_APPLICATION_INFO,appInfo);
          final Notification summaryNotification=new Notification.Builder(getContext()).setSmallIcon(adjustedSbn.getNotification().getSmallIcon()).setGroupSummary(true).setGroup(newAutoBundleKey).setFlag(Notification.FLAG_AUTOGROUP_SUMMARY,true).setFlag(Notification.FLAG_GROUP_SUMMARY,true).build();
          summaryNotification.extras.putAll(extras);
          final StatusBarNotification summarySbn=new StatusBarNotification(adjustedSbn.getPackageName(),adjustedSbn.getOpPkg(),Integer.MAX_VALUE,Adjustment.GROUP_KEY_OVERRIDE_KEY,adjustedSbn.getUid(),adjustedSbn.getInitialPid(),summaryNotification,adjustedSbn.getUser(),newAutoBundleKey,System.currentTimeMillis());
          summaryRecord=new NotificationRecord(getContext(),summarySbn);
          mAutobundledSummaries.put(adjustment.getPackage(),summarySbn.getKey());
          userId=adjustedSbn.getUser().getIdentifier();
        }
      }
      if (summaryRecord != null) {
        mHandler.post(new EnqueueNotificationRunnable(userId,summaryRecord));
      }
    }
  }
}
