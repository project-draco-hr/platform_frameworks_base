{
  EventLogTags.writeNotificationCancelAll(callingUid,callingPid,pkg,userId,mustHaveFlags,mustNotHaveFlags,reason,listener == null ? null : listener.component.toShortString());
synchronized (mNotificationList) {
    final int N=mNotificationList.size();
    boolean canceledSomething=false;
    for (int i=N - 1; i >= 0; --i) {
      NotificationRecord r=mNotificationList.get(i);
      if (!notificationMatchesUserId(r,userId)) {
        continue;
      }
      if (r.getUserId() == UserHandle.USER_ALL && pkg == null) {
        continue;
      }
      if ((r.getFlags() & mustHaveFlags) != mustHaveFlags) {
        continue;
      }
      if ((r.getFlags() & mustNotHaveFlags) != 0) {
        continue;
      }
      if (pkg != null && !r.sbn.getPackageName().equals(pkg)) {
        continue;
      }
      canceledSomething=true;
      if (!doit) {
        return true;
      }
      mNotificationList.remove(i);
      mNotificationsByKey.remove(r.sbn.getKey());
      cancelNotificationLocked(r,false);
    }
    if (canceledSomething) {
      updateLightsLocked();
    }
    return canceledSomething;
  }
}
