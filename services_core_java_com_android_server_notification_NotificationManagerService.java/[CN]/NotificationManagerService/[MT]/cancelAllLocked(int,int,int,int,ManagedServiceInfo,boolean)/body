{
  String listenerName=listener == null ? null : listener.component.toShortString();
  EventLogTags.writeNotificationCancelAll(callingUid,callingPid,null,userId,0,0,reason,listenerName);
  ArrayList<NotificationRecord> canceledNotifications=null;
  final int N=mNotificationList.size();
  for (int i=N - 1; i >= 0; i--) {
    NotificationRecord r=mNotificationList.get(i);
    if (includeCurrentProfiles) {
      if (!notificationMatchesCurrentProfiles(r,userId)) {
        continue;
      }
    }
 else {
      if (!notificationMatchesUserId(r,userId)) {
        continue;
      }
    }
    if ((r.getFlags() & (Notification.FLAG_ONGOING_EVENT | Notification.FLAG_NO_CLEAR)) == 0) {
      mNotificationList.remove(i);
      mNotificationsByKey.remove(r.sbn.getKey());
      cancelNotificationLocked(r,true,reason);
      if (canceledNotifications == null) {
        canceledNotifications=new ArrayList<>();
      }
      canceledNotifications.add(r);
    }
  }
  int M=canceledNotifications != null ? canceledNotifications.size() : 0;
  for (int i=0; i < M; i++) {
    cancelGroupChildrenLocked(canceledNotifications.get(i),callingUid,callingPid,listenerName);
  }
  updateLightsLocked();
}
