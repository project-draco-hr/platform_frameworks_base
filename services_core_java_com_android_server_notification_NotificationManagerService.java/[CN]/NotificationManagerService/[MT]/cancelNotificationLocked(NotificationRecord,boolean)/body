{
  if (sendDelete) {
    if (r.getNotification().deleteIntent != null) {
      try {
        r.getNotification().deleteIntent.send();
      }
 catch (      PendingIntent.CanceledException ex) {
        Slog.w(TAG,"canceled PendingIntent for " + r.sbn.getPackageName(),ex);
      }
    }
  }
  if (r.getNotification().icon != 0) {
    final long identity=Binder.clearCallingIdentity();
    try {
      mStatusBar.removeNotification(r.statusBarKey);
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
    r.statusBarKey=null;
    notifyRemovedLocked(r);
  }
  if (mSoundNotification == r) {
    mSoundNotification=null;
    final long identity=Binder.clearCallingIdentity();
    try {
      final IRingtonePlayer player=mAudioManager.getRingtonePlayer();
      if (player != null) {
        player.stopAsync();
      }
    }
 catch (    RemoteException e) {
    }
 finally {
      Binder.restoreCallingIdentity(identity);
    }
  }
  if (mVibrateNotification == r) {
    mVibrateNotification=null;
    long identity=Binder.clearCallingIdentity();
    try {
      mVibrator.cancel();
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
  }
  mLights.remove(r);
  if (mLedNotification == r) {
    mLedNotification=null;
  }
  mArchive.record(r.sbn);
}
