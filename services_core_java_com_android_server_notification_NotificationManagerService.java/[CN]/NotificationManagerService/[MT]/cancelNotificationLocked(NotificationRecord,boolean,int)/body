{
  if (sendDelete) {
    if (r.getNotification().deleteIntent != null) {
      try {
        r.getNotification().deleteIntent.send();
      }
 catch (      PendingIntent.CanceledException ex) {
        Slog.w(TAG,"canceled PendingIntent for " + r.sbn.getPackageName(),ex);
      }
    }
  }
  if (r.getNotification().icon != 0) {
    final long identity=Binder.clearCallingIdentity();
    try {
      mStatusBar.removeNotification(r.getKey());
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
    r.isCanceled=true;
    mListeners.notifyRemovedLocked(r.sbn);
  }
  if (mSoundNotification == r) {
    mSoundNotification=null;
    final long identity=Binder.clearCallingIdentity();
    try {
      final IRingtonePlayer player=mAudioManager.getRingtonePlayer();
      if (player != null) {
        player.stopAsync();
      }
    }
 catch (    RemoteException e) {
    }
 finally {
      Binder.restoreCallingIdentity(identity);
    }
  }
  if (mVibrateNotification == r) {
    mVibrateNotification=null;
    long identity=Binder.clearCallingIdentity();
    try {
      mVibrator.cancel();
    }
  finally {
      Binder.restoreCallingIdentity(identity);
    }
  }
  mLights.remove(r.getKey());
  if (mLedNotification == r) {
    mLedNotification=null;
  }
switch (reason) {
case REASON_DELEGATE_CANCEL:
case REASON_DELEGATE_CANCEL_ALL:
case REASON_LISTENER_CANCEL:
case REASON_LISTENER_CANCEL_ALL:
    mUsageStats.registerDismissedByUser(r);
  break;
case REASON_NOMAN_CANCEL:
case REASON_NOMAN_CANCEL_ALL:
mUsageStats.registerRemovedByApp(r);
break;
case REASON_DELEGATE_CLICK:
mUsageStats.registerCancelDueToClick(r);
break;
default :
mUsageStats.registerCancelUnknown(r);
break;
}
mArchive.record(r.sbn);
}
