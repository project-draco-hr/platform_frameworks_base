{
  Slog.d(TAG,"handleSavePolicyFile");
synchronized (mPolicyFile) {
    final FileOutputStream stream;
    try {
      stream=mPolicyFile.startWrite();
    }
 catch (    IOException e) {
      Slog.w(TAG,"Failed to save policy file",e);
      return;
    }
    try {
      final XmlSerializer out=new FastXmlSerializer();
      out.setOutput(stream,"utf-8");
      out.startDocument(null,true);
      out.startTag(null,TAG_BODY);
      out.attribute(null,ATTR_VERSION,Integer.toString(DB_VERSION));
      mZenModeHelper.writeXml(out);
      mRankingHelper.writeXml(out);
      out.endTag(null,TAG_BODY);
      out.endDocument();
      mPolicyFile.finishWrite(stream);
    }
 catch (    IOException e) {
      Slog.w(TAG,"Failed to save policy file, restoring backup",e);
      mPolicyFile.failWrite(stream);
    }
  }
}
