{
  StatusBarNotification sbnClone=null;
  StatusBarNotification sbnCloneLight=null;
  for (  final ManagedServiceInfo info : mServices) {
    boolean sbnVisible=isVisibleToListener(sbn,info);
    boolean oldSbnVisible=oldSbn != null ? isVisibleToListener(oldSbn,info) : false;
    if (!oldSbnVisible && !sbnVisible) {
      continue;
    }
    final NotificationRankingUpdate update=makeRankingUpdateLocked(info);
    if (oldSbnVisible && !sbnVisible) {
      final StatusBarNotification oldSbnLightClone=oldSbn.cloneLight();
      mHandler.post(new Runnable(){
        @Override public void run(){
          notifyRemoved(info,oldSbnLightClone,update);
        }
      }
);
      continue;
    }
    final int trim=mListeners.getOnNotificationPostedTrim(info);
    if (trim == TRIM_LIGHT && sbnCloneLight == null) {
      sbnCloneLight=sbn.cloneLight();
    }
 else     if (trim == TRIM_FULL && sbnClone == null) {
      sbnClone=sbn.clone();
    }
    final StatusBarNotification sbnToPost=(trim == TRIM_FULL) ? sbnClone : sbnCloneLight;
    mHandler.post(new Runnable(){
      @Override public void run(){
        notifyPosted(info,sbnToPost,update);
      }
    }
);
  }
}
