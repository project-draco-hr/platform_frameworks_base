{
  setRegistered(!mSubscriptions.isEmpty());
  final long now=System.currentTimeMillis();
  long nextAlarmTime=0;
  for (  Uri conditionId : mSubscriptions) {
    final ScheduleCalendar cal=toScheduleCalendar(conditionId);
    if (cal != null && cal.isInSchedule(now)) {
      notifyCondition(conditionId,Condition.STATE_TRUE,"meetsSchedule");
    }
 else {
      notifyCondition(conditionId,Condition.STATE_FALSE,"!meetsSchedule");
    }
    if (cal != null) {
      final long nextChangeTime=cal.getNextChangeTime(now);
      if (nextChangeTime > 0 && nextChangeTime > now) {
        if (nextAlarmTime == 0 || nextChangeTime < nextAlarmTime) {
          nextAlarmTime=nextChangeTime;
        }
      }
    }
  }
  updateAlarm(now,nextAlarmTime);
}
