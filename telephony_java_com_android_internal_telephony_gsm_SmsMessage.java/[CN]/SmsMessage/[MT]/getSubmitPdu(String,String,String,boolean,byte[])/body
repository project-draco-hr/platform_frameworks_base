{
  if (message == null || destinationAddress == null) {
    return null;
  }
  SubmitPdu ret=new SubmitPdu();
  byte mtiByte=(byte)(0x01 | (header != null ? 0x40 : 0x00));
  ByteArrayOutputStream bo=getSubmitPduHead(scAddress,destinationAddress,mtiByte,statusReportRequested,ret);
  try {
    byte[] userData=GsmAlphabet.stringToGsm7BitPackedWithHeader(message,header);
    if ((0xff & userData[0]) > MAX_USER_DATA_SEPTETS) {
      return null;
    }
    bo.write(0x00);
    bo.write(userData,0,userData.length);
  }
 catch (  EncodeException ex) {
    byte[] userData, textPart;
    try {
      textPart=message.getBytes("utf-16be");
    }
 catch (    UnsupportedEncodingException uex) {
      Log.e(LOG_TAG,"Implausible UnsupportedEncodingException ",uex);
      return null;
    }
    if (header != null) {
      userData=new byte[header.length + textPart.length];
      System.arraycopy(header,0,userData,0,header.length);
      System.arraycopy(textPart,0,userData,header.length,textPart.length);
    }
 else {
      userData=textPart;
    }
    if (userData.length > MAX_USER_DATA_BYTES) {
      return null;
    }
    bo.write(0x0b);
    bo.write(userData.length);
    bo.write(userData,0,userData.length);
  }
  ret.encodedMessage=bo.toByteArray();
  return ret;
}
