{
  if (message == null || destinationAddress == null) {
    return null;
  }
  SubmitPdu ret=new SubmitPdu();
  byte mtiByte=(byte)(0x01 | (header != null ? 0x40 : 0x00));
  ByteArrayOutputStream bo=getSubmitPduHead(scAddress,destinationAddress,mtiByte,statusReportRequested,ret);
  byte[] userData;
  if (encoding == ENCODING_UNKNOWN) {
    encoding=ENCODING_7BIT;
  }
  try {
    if (encoding == ENCODING_7BIT) {
      userData=GsmAlphabet.stringToGsm7BitPackedWithHeader(message,header,languageTable,languageShiftTable);
    }
 else {
      try {
        userData=encodeUCS2(message,header);
      }
 catch (      UnsupportedEncodingException uex) {
        Log.e(LOG_TAG,"Implausible UnsupportedEncodingException ",uex);
        return null;
      }
    }
  }
 catch (  EncodeException ex) {
    try {
      userData=encodeUCS2(message,header);
      encoding=ENCODING_16BIT;
    }
 catch (    UnsupportedEncodingException uex) {
      Log.e(LOG_TAG,"Implausible UnsupportedEncodingException ",uex);
      return null;
    }
  }
  if (encoding == ENCODING_7BIT) {
    if ((0xff & userData[0]) > MAX_USER_DATA_SEPTETS) {
      return null;
    }
    bo.write(0x00);
  }
 else {
    if ((0xff & userData[0]) > MAX_USER_DATA_BYTES) {
      return null;
    }
    bo.write(0x08);
  }
  bo.write(userData,0,userData.length);
  ret.encodedMessage=bo.toByteArray();
  return ret;
}
