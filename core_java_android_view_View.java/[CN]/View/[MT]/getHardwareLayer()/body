{
  if (mAttachInfo == null || mAttachInfo.mHardwareRenderer == null || !mAttachInfo.mHardwareRenderer.isEnabled()) {
    return null;
  }
  final int width=mRight - mLeft;
  final int height=mBottom - mTop;
  if (width == 0 || height == 0) {
    return null;
  }
  if ((mPrivateFlags & PFLAG_DRAWING_CACHE_VALID) == 0 || mHardwareLayer == null) {
    if (mHardwareLayer == null) {
      mHardwareLayer=mAttachInfo.mHardwareRenderer.createDisplayListLayer(width,height);
      mLocalDirtyRect.set(0,0,width,height);
    }
 else     if (mHardwareLayer.isValid()) {
      computeOpaqueFlags();
      if (mHardwareLayer.prepare(width,height,isOpaque())) {
        mLocalDirtyRect.set(0,0,width,height);
      }
    }
    mHardwareLayer.flushChanges();
    if (!mHardwareLayer.isValid()) {
      return null;
    }
    mHardwareLayer.setLayerPaint(mLayerPaint);
    DisplayList displayList=mHardwareLayer.startRecording();
    if (getDisplayList(displayList,true) != displayList) {
      throw new IllegalStateException("getDisplayList() didn't return" + " the input displaylist for a hardware layer!");
    }
    mHardwareLayer.endRecording(mLocalDirtyRect);
    mLocalDirtyRect.setEmpty();
  }
  return mHardwareLayer;
}
