{
  if (mAttachInfo == null || mAttachInfo.mHardwareRenderer == null || !mAttachInfo.mHardwareRenderer.isEnabled()) {
    return null;
  }
  if (!mAttachInfo.mHardwareRenderer.validate())   return null;
  final int width=mRight - mLeft;
  final int height=mBottom - mTop;
  if (width == 0 || height == 0) {
    return null;
  }
  if ((mPrivateFlags & PFLAG_DRAWING_CACHE_VALID) == 0 || mHardwareLayer == null) {
    if (mHardwareLayer == null) {
      mHardwareLayer=mAttachInfo.mHardwareRenderer.createHardwareLayer(width,height,isOpaque());
      mLocalDirtyRect.set(0,0,width,height);
    }
 else {
      if (mHardwareLayer.getWidth() != width || mHardwareLayer.getHeight() != height) {
        if (mHardwareLayer.resize(width,height)) {
          mLocalDirtyRect.set(0,0,width,height);
        }
      }
      computeOpaqueFlags();
      final boolean opaque=isOpaque();
      if (mHardwareLayer.isValid() && mHardwareLayer.isOpaque() != opaque) {
        mHardwareLayer.setOpaque(opaque);
        mLocalDirtyRect.set(0,0,width,height);
      }
    }
    if (!mHardwareLayer.isValid()) {
      return null;
    }
    mHardwareLayer.setLayerPaint(mLayerPaint);
    mHardwareLayer.redrawLater(getHardwareLayerDisplayList(mHardwareLayer),mLocalDirtyRect);
    ViewRootImpl viewRoot=getViewRootImpl();
    if (viewRoot != null)     viewRoot.pushHardwareLayerUpdate(mHardwareLayer);
    mLocalDirtyRect.setEmpty();
  }
  return mHardwareLayer;
}
