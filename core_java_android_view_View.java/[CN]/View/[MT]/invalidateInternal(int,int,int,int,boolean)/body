{
  if (skipInvalidate()) {
    return;
  }
  final boolean wasDrawn=(mPrivateFlags & (PFLAG_DRAWN | PFLAG_HAS_BOUNDS)) == (PFLAG_DRAWN | PFLAG_HAS_BOUNDS);
  final boolean hasValidCache=(mPrivateFlags & PFLAG_DRAWING_CACHE_VALID) != 0;
  final boolean invalidated=(mPrivateFlags & PFLAG_INVALIDATED) != 0;
  final boolean opacityChanged=isOpaque() != mLastIsOpaque;
  if (wasDrawn || (invalidateCache && hasValidCache) || !invalidated|| opacityChanged) {
    mLastIsOpaque=isOpaque();
    mPrivateFlags&=~PFLAG_DRAWN;
    mPrivateFlags|=PFLAG_DIRTY;
    if (invalidateCache) {
      mPrivateFlags|=PFLAG_INVALIDATED;
      mPrivateFlags&=~PFLAG_DRAWING_CACHE_VALID;
    }
    final AttachInfo ai=mAttachInfo;
    final ViewParent p=mParent;
    if (p != null && ai != null && l < r && t < b) {
      final Rect damage=ai.mTmpInvalRect;
      damage.set(l,t,r,b);
      p.invalidateChild(this,damage);
    }
    if (mBackground != null && mBackground.isProjected()) {
      final View receiver=getProjectionReceiver();
      if (receiver != null) {
        receiver.damageInParent();
      }
    }
  }
}
