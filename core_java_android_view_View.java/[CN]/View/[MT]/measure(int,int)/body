{
  boolean optical=isLayoutModeOptical(this);
  if (optical != isLayoutModeOptical(mParent)) {
    Insets insets=getOpticalInsets();
    int oWidth=insets.left + insets.right;
    int oHeight=insets.top + insets.bottom;
    widthMeasureSpec=MeasureSpec.adjust(widthMeasureSpec,optical ? -oWidth : oWidth);
    heightMeasureSpec=MeasureSpec.adjust(heightMeasureSpec,optical ? -oHeight : oHeight);
  }
  if ((mPrivateFlags & PFLAG_FORCE_LAYOUT) == PFLAG_FORCE_LAYOUT || widthMeasureSpec != mOldWidthMeasureSpec || heightMeasureSpec != mOldHeightMeasureSpec) {
    mPrivateFlags&=~PFLAG_MEASURED_DIMENSION_SET;
    resolveRtlPropertiesIfNeeded();
    onMeasure(widthMeasureSpec,heightMeasureSpec);
    if ((mPrivateFlags & PFLAG_MEASURED_DIMENSION_SET) != PFLAG_MEASURED_DIMENSION_SET) {
      throw new IllegalStateException("onMeasure() did not set the" + " measured dimension by calling" + " setMeasuredDimension()");
    }
    mPrivateFlags|=PFLAG_LAYOUT_REQUIRED;
  }
  mOldWidthMeasureSpec=widthMeasureSpec;
  mOldHeightMeasureSpec=heightMeasureSpec;
}
