{
  if (DEBUG)   Log.v(TAG,"attach: " + fragment);
  if (fragment.mDetached) {
    fragment.mDetached=false;
    if (!fragment.mAdded) {
      if (mAdded == null) {
        mAdded=new ArrayList<Fragment>();
      }
      if (mAdded.contains(fragment)) {
        throw new IllegalStateException("Fragment already added: " + fragment);
      }
      if (DEBUG)       Log.v(TAG,"add from attach: " + fragment);
      mAdded.add(fragment);
      fragment.mAdded=true;
      if (fragment.mHasMenu && fragment.mMenuVisible) {
        mNeedMenuInvalidate=true;
      }
      moveToState(fragment,mCurState,transition,transitionStyle,false);
    }
  }
}
