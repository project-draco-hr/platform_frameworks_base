{
  if (mAdded == null) {
    mAdded=new ArrayList<Fragment>();
  }
  if (DEBUG)   Log.v(TAG,"add: " + fragment);
  makeActive(fragment);
  if (!fragment.mDetached) {
    if (mAdded.contains(fragment)) {
      throw new IllegalStateException("Fragment already added: " + fragment);
    }
    mAdded.add(fragment);
    fragment.mAdded=true;
    fragment.mRemoving=false;
    if (fragment.mHasMenu && fragment.mMenuVisible) {
      mNeedMenuInvalidate=true;
    }
    if (moveToStateNow) {
      moveToState(fragment);
    }
  }
}
