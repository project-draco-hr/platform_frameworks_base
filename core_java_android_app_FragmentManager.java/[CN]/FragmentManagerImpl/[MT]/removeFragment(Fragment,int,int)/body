{
  if (DEBUG)   Log.v(TAG,"remove: " + fragment + " nesting="+ fragment.mBackStackNesting);
  final boolean inactive=!fragment.isInBackStack();
  if (!fragment.mDetached || inactive) {
    mAdded.remove(fragment);
    if (fragment.mHasMenu) {
      mNeedMenuInvalidate=true;
    }
    fragment.mAdded=false;
    fragment.mRemoving=true;
    moveToState(fragment,inactive ? Fragment.INITIALIZING : Fragment.CREATED,transition,transitionStyle);
    if (inactive) {
      makeInactive(fragment);
    }
  }
}
