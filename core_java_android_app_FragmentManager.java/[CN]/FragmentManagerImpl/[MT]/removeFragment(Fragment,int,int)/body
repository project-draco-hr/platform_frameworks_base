{
  if (DEBUG)   Log.v(TAG,"remove: " + fragment + " nesting="+ fragment.mBackStackNesting);
  final boolean inactive=!fragment.isInBackStack();
  if (!fragment.mDetached || inactive) {
    if (false) {
      if (!mAdded.contains(fragment)) {
        throw new IllegalStateException("Fragment not added: " + fragment);
      }
    }
    if (mAdded != null) {
      mAdded.remove(fragment);
    }
    if (fragment.mHasMenu && fragment.mMenuVisible) {
      mNeedMenuInvalidate=true;
    }
    fragment.mAdded=false;
    fragment.mRemoving=true;
    moveToState(fragment,inactive ? Fragment.INITIALIZING : Fragment.CREATED,transition,transitionStyle,false);
  }
}
