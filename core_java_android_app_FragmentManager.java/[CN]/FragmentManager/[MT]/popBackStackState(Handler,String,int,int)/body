{
  if (mBackStack == null) {
    return false;
  }
  if (name == null && id < 0 && (flags & Activity.POP_BACK_STACK_INCLUSIVE) == 0) {
    int last=mBackStack.size() - 1;
    if (last < 0) {
      return false;
    }
    final BackStackEntry bss=mBackStack.remove(last);
    enqueueAction(new Runnable(){
      public void run(){
        if (DEBUG)         Log.v(TAG,"Popping back stack state: " + bss);
        bss.popFromBackStack();
        moveToState(mCurState,reverseTransit(bss.getTransition()),bss.getTransitionStyle(),true);
      }
    }
);
  }
 else {
    int index=-1;
    if (name != null || id >= 0) {
      index=mBackStack.size() - 1;
      while (index >= 0) {
        BackStackEntry bss=mBackStack.get(index);
        if (name != null && name.equals(bss.getName())) {
          break;
        }
        if (id >= 0 && id == bss.mIndex) {
          break;
        }
        index--;
      }
      if (index < 0) {
        return false;
      }
      if ((flags & Activity.POP_BACK_STACK_INCLUSIVE) != 0) {
        index--;
        while (index >= 0) {
          BackStackEntry bss=mBackStack.get(index);
          if ((name != null && name.equals(bss.getName())) || (id >= 0 && id == bss.mIndex)) {
            index--;
            continue;
          }
          break;
        }
      }
    }
    if (index == mBackStack.size() - 1) {
      return false;
    }
    final ArrayList<BackStackEntry> states=new ArrayList<BackStackEntry>();
    for (int i=mBackStack.size() - 1; i > index; i--) {
      states.add(mBackStack.remove(i));
    }
    enqueueAction(new Runnable(){
      public void run(){
        for (int i=0; i < states.size(); i++) {
          if (DEBUG)           Log.v(TAG,"Popping back stack state: " + states.get(i));
          states.get(i).popFromBackStack();
        }
        moveToState(mCurState,true);
      }
    }
);
  }
  return true;
}
