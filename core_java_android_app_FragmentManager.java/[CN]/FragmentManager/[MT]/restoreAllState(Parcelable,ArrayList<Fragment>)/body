{
  if (state == null)   return;
  FragmentManagerState fms=(FragmentManagerState)state;
  if (fms.mActive == null)   return;
  if (nonConfig != null) {
    for (int i=0; i < nonConfig.size(); i++) {
      Fragment f=nonConfig.get(i);
      FragmentState fs=fms.mActive[f.mIndex];
      fs.mInstance=f;
      f.mSavedViewState=null;
      f.mBackStackNesting=0;
      f.mAdded=false;
      if (fs.mSavedFragmentState != null) {
        f.mSavedViewState=fs.mSavedFragmentState.getSparseParcelableArray(FragmentState.VIEW_STATE_TAG);
      }
    }
  }
  mActive=new ArrayList<Fragment>(fms.mActive.length);
  if (mAvailIndices != null) {
    mAvailIndices.clear();
  }
  for (int i=0; i < fms.mActive.length; i++) {
    FragmentState fs=fms.mActive[i];
    if (fs != null) {
      mActive.add(fs.instantiate(mActivity));
    }
 else {
      mActive.add(null);
      if (mAvailIndices == null) {
        mAvailIndices=new ArrayList<Integer>();
      }
      mAvailIndices.add(i);
    }
  }
  if (fms.mAdded != null) {
    mAdded=new ArrayList<Fragment>(fms.mAdded.length);
    for (int i=0; i < fms.mAdded.length; i++) {
      Fragment f=mActive.get(fms.mAdded[i]);
      if (f == null) {
        throw new IllegalStateException("No instantiated fragment for index #" + fms.mAdded[i]);
      }
      f.mAdded=true;
      f.mImmediateActivity=mActivity;
      mAdded.add(f);
    }
  }
 else {
    mAdded=null;
  }
  if (fms.mBackStack != null) {
    mBackStack=new ArrayList<BackStackEntry>(fms.mBackStack.length);
    for (int i=0; i < fms.mBackStack.length; i++) {
      BackStackEntry bse=fms.mBackStack[i].instantiate(this);
      mBackStack.add(bse);
    }
  }
 else {
    mBackStack=null;
  }
}
