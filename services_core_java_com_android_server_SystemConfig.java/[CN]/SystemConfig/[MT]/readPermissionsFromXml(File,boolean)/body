{
  FileReader permReader=null;
  try {
    permReader=new FileReader(permFile);
  }
 catch (  FileNotFoundException e) {
    Slog.w(TAG,"Couldn't find or open permissions file " + permFile);
    return;
  }
  try {
    XmlPullParser parser=Xml.newPullParser();
    parser.setInput(permReader);
    int type;
    while ((type=parser.next()) != parser.START_TAG && type != parser.END_DOCUMENT) {
      ;
    }
    if (type != parser.START_TAG) {
      throw new XmlPullParserException("No start tag found");
    }
    if (!parser.getName().equals("permissions") && !parser.getName().equals("config")) {
      throw new XmlPullParserException("Unexpected start tag: found " + parser.getName() + ", expected 'permissions' or 'config'");
    }
    while (true) {
      XmlUtils.nextElement(parser);
      if (parser.getEventType() == XmlPullParser.END_DOCUMENT) {
        break;
      }
      String name=parser.getName();
      if ("group".equals(name) && !onlyFeatures) {
        String gidStr=parser.getAttributeValue(null,"gid");
        if (gidStr != null) {
          int gid=android.os.Process.getGidForName(gidStr);
          mGlobalGids=appendInt(mGlobalGids,gid);
        }
 else {
          Slog.w(TAG,"<group> without gid at " + parser.getPositionDescription());
        }
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
 else       if ("permission".equals(name) && !onlyFeatures) {
        String perm=parser.getAttributeValue(null,"name");
        if (perm == null) {
          Slog.w(TAG,"<permission> without name at " + parser.getPositionDescription());
          XmlUtils.skipCurrentTag(parser);
          continue;
        }
        perm=perm.intern();
        readPermission(parser,perm);
      }
 else       if ("assign-permission".equals(name) && !onlyFeatures) {
        String perm=parser.getAttributeValue(null,"name");
        if (perm == null) {
          Slog.w(TAG,"<assign-permission> without name at " + parser.getPositionDescription());
          XmlUtils.skipCurrentTag(parser);
          continue;
        }
        String uidStr=parser.getAttributeValue(null,"uid");
        if (uidStr == null) {
          Slog.w(TAG,"<assign-permission> without uid at " + parser.getPositionDescription());
          XmlUtils.skipCurrentTag(parser);
          continue;
        }
        int uid=Process.getUidForName(uidStr);
        if (uid < 0) {
          Slog.w(TAG,"<assign-permission> with unknown uid \"" + uidStr + "\" at "+ parser.getPositionDescription());
          XmlUtils.skipCurrentTag(parser);
          continue;
        }
        perm=perm.intern();
        ArraySet<String> perms=mSystemPermissions.get(uid);
        if (perms == null) {
          perms=new ArraySet<String>();
          mSystemPermissions.put(uid,perms);
        }
        perms.add(perm);
        XmlUtils.skipCurrentTag(parser);
      }
 else       if ("library".equals(name) && !onlyFeatures) {
        String lname=parser.getAttributeValue(null,"name");
        String lfile=parser.getAttributeValue(null,"file");
        if (lname == null) {
          Slog.w(TAG,"<library> without name at " + parser.getPositionDescription());
        }
 else         if (lfile == null) {
          Slog.w(TAG,"<library> without file at " + parser.getPositionDescription());
        }
 else {
          mSharedLibraries.put(lname,lfile);
        }
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
 else       if ("feature".equals(name)) {
        String fname=parser.getAttributeValue(null,"name");
        if (fname == null) {
          Slog.w(TAG,"<feature> without name at " + parser.getPositionDescription());
        }
 else {
          FeatureInfo fi=new FeatureInfo();
          fi.name=fname;
          mAvailableFeatures.put(fname,fi);
        }
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
 else       if ("allow-in-power-save".equals(name)) {
        String pkgname=parser.getAttributeValue(null,"package");
        if (pkgname == null) {
          Slog.w(TAG,"<allow-in-power-save> without package at " + parser.getPositionDescription());
        }
 else {
          mAllowInPowerSave.add(pkgname);
        }
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
 else       if ("fixed-ime-app".equals(name)) {
        String pkgname=parser.getAttributeValue(null,"package");
        if (pkgname == null) {
          Slog.w(TAG,"<fixed-ime-app> without package at " + parser.getPositionDescription());
        }
 else {
          mFixedImeApps.add(pkgname);
        }
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
 else {
        XmlUtils.skipCurrentTag(parser);
        continue;
      }
    }
    permReader.close();
  }
 catch (  XmlPullParserException e) {
    Slog.w(TAG,"Got execption parsing permissions.",e);
  }
catch (  IOException e) {
    Slog.w(TAG,"Got execption parsing permissions.",e);
  }
}
