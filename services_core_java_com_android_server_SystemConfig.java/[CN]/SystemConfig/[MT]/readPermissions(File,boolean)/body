{
  if (!libraryDir.exists() || !libraryDir.isDirectory()) {
    if (!onlyFeatures) {
      Slog.w(TAG,"No directory " + libraryDir + ", skipping");
    }
    return;
  }
  if (!libraryDir.canRead()) {
    Slog.w(TAG,"Directory " + libraryDir + " cannot be read");
    return;
  }
  File platformFile=null;
  for (  File f : libraryDir.listFiles()) {
    if (f.getPath().endsWith("etc/permissions/platform.xml")) {
      platformFile=f;
      continue;
    }
    if (!f.getPath().endsWith(".xml")) {
      Slog.i(TAG,"Non-xml file " + f + " in "+ libraryDir+ " directory, ignoring");
      continue;
    }
    if (!f.canRead()) {
      Slog.w(TAG,"Permissions library file " + f + " cannot be read");
      continue;
    }
    readPermissionsFromXml(f,onlyFeatures);
  }
  if (platformFile != null) {
    readPermissionsFromXml(platformFile,onlyFeatures);
  }
}
