{
  checkManageUsersPermission("Only system can modify the restrictions pin");
  int userId=UserHandle.getCallingUserId();
synchronized (mPackagesLock) {
    RestrictionsPinState pinState=mRestrictionsPinStates.get(userId);
    if (pinState == null) {
      pinState=new RestrictionsPinState();
    }
    if (newPin == null) {
      pinState.salt=0;
      pinState.pinHash=null;
    }
 else {
      try {
        pinState.salt=SecureRandom.getInstance("SHA1PRNG").nextLong();
      }
 catch (      NoSuchAlgorithmException e) {
        pinState.salt=(long)(Math.random() * Long.MAX_VALUE);
      }
      pinState.pinHash=passwordToHash(newPin,pinState.salt);
      pinState.failedAttempts=0;
    }
    mRestrictionsPinStates.put(userId,pinState);
    writeUserLocked(mUsers.get(userId));
  }
  return true;
}
