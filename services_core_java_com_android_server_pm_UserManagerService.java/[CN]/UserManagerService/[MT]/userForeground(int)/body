{
synchronized (mPackagesLock) {
    UserInfo user=mUsers.get(userId);
    long now=System.currentTimeMillis();
    if (user == null || user.partial) {
      Slog.w(LOG_TAG,"userForeground: unknown user #" + userId);
      return;
    }
    if (now > EPOCH_PLUS_30_YEARS) {
      user.lastLoggedInTime=now;
      writeUserLocked(user);
    }
    RestrictionsPinState pinState=mRestrictionsPinStates.get(userId);
    final long salt=pinState == null ? 0 : pinState.salt;
    cleanAppRestrictions(userId,(!user.isRestricted() && salt == 0));
  }
}
