{
  if (UserHandle.getCallingUserId() != userId || !UserHandle.isSameApp(Binder.getCallingUid(),getUidForPackage(packageName))) {
    checkManageUsersPermission("Only system can set restrictions for other users/apps");
  }
synchronized (mPackagesLock) {
    if (restrictions == null || restrictions.isEmpty()) {
      cleanAppRestrictionsForPackage(packageName,userId);
    }
 else {
      writeApplicationRestrictionsLocked(packageName,restrictions,userId);
    }
  }
  if (isPackageInstalled(packageName,userId)) {
    Intent changeIntent=new Intent(Intent.ACTION_APPLICATION_RESTRICTIONS_CHANGED);
    changeIntent.setPackage(packageName);
    changeIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
    mContext.sendBroadcastAsUser(changeIntent,new UserHandle(userId));
  }
}
