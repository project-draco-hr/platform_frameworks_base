{
  ArrayList<UserInfo> partials=new ArrayList<>();
synchronized (mUsersLock) {
    final int userSize=mUsers.size();
    for (int i=0; i < userSize; i++) {
      UserInfo ui=mUsers.valueAt(i).info;
      if ((ui.partial || ui.guestToRemove || ui.isEphemeral()) && i != 0) {
        partials.add(ui);
      }
    }
  }
  final int partialsSize=partials.size();
  for (int i=0; i < partialsSize; i++) {
    UserInfo ui=partials.get(i);
    Slog.w(LOG_TAG,"Removing partially created user " + ui.id + " (name="+ ui.name+ ")");
    removeUserState(ui.id);
  }
  mAppOpsService=IAppOpsService.Stub.asInterface(ServiceManager.getService(Context.APP_OPS_SERVICE));
synchronized (mRestrictionsLock) {
    applyUserRestrictionsLR(UserHandle.USER_SYSTEM);
  }
  UserInfo currentGuestUser=findCurrentGuestUser();
  if (currentGuestUser != null && !hasUserRestriction(UserManager.DISALLOW_CONFIG_WIFI,currentGuestUser.id)) {
    setUserRestriction(UserManager.DISALLOW_CONFIG_WIFI,true,currentGuestUser.id);
  }
  mContext.registerReceiver(mDisableQuietModeCallback,new IntentFilter(ACTION_DISABLE_QUIET_MODE_AFTER_UNLOCK),null,mHandler);
}
