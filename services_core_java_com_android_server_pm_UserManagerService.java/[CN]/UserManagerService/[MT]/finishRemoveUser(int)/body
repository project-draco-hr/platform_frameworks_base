{
  if (DBG)   Slog.i(LOG_TAG,"finishRemoveUser " + userHandle);
  long ident=Binder.clearCallingIdentity();
  try {
    final boolean isManaged=getUserInfo(userHandle).isManagedProfile();
    Intent addedIntent=new Intent(Intent.ACTION_USER_REMOVED);
    addedIntent.putExtra(Intent.EXTRA_USER_HANDLE,userHandle);
    mContext.sendOrderedBroadcastAsUser(addedIntent,UserHandle.ALL,android.Manifest.permission.MANAGE_USERS,new BroadcastReceiver(){
      @Override public void onReceive(      Context context,      Intent intent){
        if (DBG) {
          Slog.i(LOG_TAG,"USER_REMOVED broadcast sent, cleaning up user data " + userHandle);
        }
        new Thread(){
          public void run(){
synchronized (mInstallLock) {
synchronized (mPackagesLock) {
                removeUserStateLocked(userHandle);
              }
            }
            if (isManaged) {
              sendProfileRemovedBroadcast(userHandle);
            }
          }
        }
.start();
      }
    }
,null,Activity.RESULT_OK,null,null);
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
}
