{
  checkManageUsersPermission("Only the system can remove users");
  if (getUserRestrictions(UserHandle.getCallingUserId()).getBoolean(UserManager.DISALLOW_REMOVE_USER,false)) {
    Log.w(LOG_TAG,"Cannot remove user. DISALLOW_REMOVE_USER is enabled.");
    return false;
  }
  long ident=Binder.clearCallingIdentity();
  try {
    final UserData userData;
synchronized (mPackagesLock) {
synchronized (mUsersLock) {
        userData=mUsers.get(userHandle);
        if (userHandle == 0 || userData == null || mRemovingUserIds.get(userHandle)) {
          return false;
        }
      }
      if (!userData.info.isGuest()) {
        return false;
      }
      userData.info.guestToRemove=true;
      userData.info.flags|=UserInfo.FLAG_DISABLED;
      writeUserLP(userData);
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
  return true;
}
