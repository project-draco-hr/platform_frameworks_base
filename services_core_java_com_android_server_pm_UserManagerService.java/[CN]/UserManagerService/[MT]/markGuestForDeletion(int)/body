{
  checkManageUsersPermission("Only the system can remove users");
  if (getUserRestrictions(UserHandle.getCallingUserId()).getBoolean(UserManager.DISALLOW_REMOVE_USER,false)) {
    Log.w(LOG_TAG,"Cannot remove user. DISALLOW_REMOVE_USER is enabled.");
    return false;
  }
  long ident=Binder.clearCallingIdentity();
  try {
    final UserInfo user;
synchronized (mPackagesLock) {
      user=mUsers.get(userHandle);
      if (userHandle == 0 || user == null || mRemovingUserIds.get(userHandle)) {
        return false;
      }
      if (!user.isGuest()) {
        return false;
      }
      user.partial=true;
      user.flags|=UserInfo.FLAG_DISABLED;
      user.flags&=~UserInfo.FLAG_GUEST;
      writeUserLocked(user);
    }
  }
  finally {
    Binder.restoreCallingIdentity(ident);
  }
  return true;
}
