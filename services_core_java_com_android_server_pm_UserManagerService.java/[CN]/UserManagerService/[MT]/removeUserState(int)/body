{
  try {
    mContext.getSystemService(StorageManager.class).destroyUserKey(userHandle);
  }
 catch (  IllegalStateException e) {
    Slog.i(LOG_TAG,"Destroying key for user " + userHandle + " failed, continuing anyway",e);
  }
  try {
    final IGateKeeperService gk=GateKeeper.getService();
    if (gk != null) {
      gk.clearSecureUserId(userHandle);
    }
  }
 catch (  Exception ex) {
    Slog.w(LOG_TAG,"unable to clear GK secure user id");
  }
  mPm.cleanUpUser(this,userHandle);
  mPm.destroyUserData(userHandle,StorageManager.FLAG_STORAGE_DE | StorageManager.FLAG_STORAGE_CE);
synchronized (mUsersLock) {
    mUsers.remove(userHandle);
    mIsUserManaged.delete(userHandle);
  }
synchronized (mUserStates) {
    mUserStates.delete(userHandle);
  }
synchronized (mRestrictionsLock) {
    mBaseUserRestrictions.remove(userHandle);
    mAppliedUserRestrictions.remove(userHandle);
    mCachedEffectiveUserRestrictions.remove(userHandle);
    mDevicePolicyLocalUserRestrictions.remove(userHandle);
  }
synchronized (mPackagesLock) {
    writeUserListLP();
  }
  AtomicFile userFile=new AtomicFile(new File(mUsersDir,userHandle + XML_SUFFIX));
  userFile.delete();
  updateUserIds();
}
