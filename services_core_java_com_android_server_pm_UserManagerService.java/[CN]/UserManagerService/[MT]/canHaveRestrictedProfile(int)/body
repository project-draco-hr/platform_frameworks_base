{
  checkManageUsersPermission("canHaveRestrictedProfile");
synchronized (mPackagesLock) {
    final UserInfo userInfo=getUserInfoLocked(userId);
    if (userInfo == null || !userInfo.canHaveProfile()) {
      return false;
    }
    if (!userInfo.isAdmin()) {
      return false;
    }
  }
  DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
  return dpm.getDeviceOwner() == null && dpm.getProfileOwnerAsUser(userId) == null;
}
