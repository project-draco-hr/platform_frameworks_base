{
  DimLayer newDimLayer;
  final boolean previousFullscreen=mDimLayer != null && sSharedFullscreenDimLayers.indexOfValue(mDimLayer) > -1;
  final int displayId=mStack.getDisplayContent().getDisplayId();
  if (mFullscreen) {
    if (previousFullscreen) {
      return;
    }
    newDimLayer=sSharedFullscreenDimLayers.get(displayId);
    if (newDimLayer == null) {
      if (mDimLayer != null) {
        newDimLayer=mDimLayer;
      }
 else {
        newDimLayer=new DimLayer(mService,this,displayId);
      }
      newDimLayer.setBounds(mBounds);
      sSharedFullscreenDimLayers.put(displayId,newDimLayer);
    }
 else     if (mDimLayer != null) {
      mDimLayer.destroySurface();
    }
  }
 else {
    newDimLayer=(mDimLayer == null || previousFullscreen) ? new DimLayer(mService,this,displayId) : mDimLayer;
    newDimLayer.setBounds(mBounds);
  }
  mDimLayer=newDimLayer;
}
