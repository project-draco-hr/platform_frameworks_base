{
  final ArrayList<NativeDaemonEvent> events=Lists.newArrayList();
  final StringBuilder sentCommand=makeCommand(cmd,args);
  final int cmdNumber=sendCommand(sentCommand);
  NativeDaemonEvent event=null;
  cmd=sentCommand.toString();
  do {
    event=mResponseQueue.remove(cmdNumber,timeout,cmd);
    if (event == null) {
      loge("timed-out waiting for response to " + cmdNumber + " "+ cmd);
      throw new NativeDaemonFailureException(cmd,event);
    }
    events.add(event);
  }
 while (event.isClassContinue());
  if (event.isClassClientError()) {
    throw new NativeDaemonArgumentException(cmd,event);
  }
  if (event.isClassServerError()) {
    throw new NativeDaemonFailureException(cmd,event);
  }
  return events.toArray(new NativeDaemonEvent[events.size()]);
}
