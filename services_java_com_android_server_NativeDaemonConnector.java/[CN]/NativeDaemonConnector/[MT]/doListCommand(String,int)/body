{
  final ArrayList<String> list=Lists.newArrayList();
  final NativeDaemonEvent[] events=executeForList(cmd);
  for (int i=0; i < events.length - 1; i++) {
    final NativeDaemonEvent event=events[i];
    final int code=event.getCode();
    if (code == expectedCode) {
      list.add(event.getMessage());
    }
 else {
      throw new NativeDaemonConnectorException("unexpected list response " + code + " instead of "+ expectedCode);
    }
  }
  final NativeDaemonEvent finalEvent=events[events.length - 1];
  if (!finalEvent.isClassOk()) {
    throw new NativeDaemonConnectorException("unexpected final event: " + finalEvent);
  }
  return list.toArray(new String[list.size()]);
}
