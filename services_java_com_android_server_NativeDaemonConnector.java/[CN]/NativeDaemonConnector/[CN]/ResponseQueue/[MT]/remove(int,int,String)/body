{
  long endTime=SystemClock.uptimeMillis() + timeoutMs;
  long nowTime;
  Response found=null;
  while (true) {
synchronized (mResponses) {
      for (      Response response : mResponses) {
        if (response.cmdNum == cmdNum) {
          found=response;
switch (response.responses.size()) {
case 0:
            break;
case 1:
          mResponses.remove(response);
default :
        response.request=origCmd;
      return response.responses.remove();
  }
}
}
nowTime=SystemClock.uptimeMillis();
if (endTime <= nowTime) {
Slog.e("NativeDaemonConnector.ResponseQueue","Timeout waiting for response");
return null;
}
if (found == null) {
found=new Response(cmdNum,origCmd);
mResponses.add(found);
}
}
try {
synchronized (found) {
found.wait(endTime - nowTime);
}
}
 catch (InterruptedException e) {
}
}
}
