{
  draw(nativeCanvas,paint,false,false,new GcSnapshot.Drawable(){
    public void draw(    Graphics2D graphics,    Paint_Delegate paint){
      float x=startX;
      float y=startY;
      if (paint.getTextAlign() != Paint.Align.LEFT.nativeInt) {
        float m=paint.measureText(text,index,count);
        if (paint.getTextAlign() == Paint.Align.CENTER.nativeInt) {
          x-=m / 2;
        }
 else         if (paint.getTextAlign() == Paint.Align.RIGHT.nativeInt) {
          x-=m;
        }
      }
      List<FontInfo> fonts=paint.getFonts();
      if (fonts.size() > 0) {
        FontInfo mainFont=fonts.get(0);
        int i=index;
        int lastIndex=index + count;
        while (i < lastIndex) {
          int upTo=mainFont.mFont.canDisplayUpTo(text,i,lastIndex);
          if (upTo == -1) {
            graphics.setFont(mainFont.mFont);
            graphics.drawChars(text,i,lastIndex - i,(int)x,(int)y);
            return;
          }
 else           if (upTo > 0) {
            graphics.setFont(mainFont.mFont);
            graphics.drawChars(text,i,upTo - i,(int)x,(int)y);
            x+=mainFont.mMetrics.charsWidth(text,i,upTo - i);
            i=upTo;
          }
          boolean foundFont=false;
          for (int f=1; f < fonts.size(); f++) {
            FontInfo fontInfo=fonts.get(f);
            int charCount=Character.isHighSurrogate(text[i]) ? 2 : 1;
            upTo=fontInfo.mFont.canDisplayUpTo(text,i,i + charCount);
            if (upTo == -1) {
              graphics.setFont(fontInfo.mFont);
              graphics.drawChars(text,i,charCount,(int)x,(int)y);
              x+=fontInfo.mMetrics.charsWidth(text,i,charCount);
              i+=charCount;
              foundFont=true;
              break;
            }
          }
          if (foundFont == false) {
            int charCount=Character.isHighSurrogate(text[i]) ? 2 : 1;
            graphics.setFont(mainFont.mFont);
            graphics.drawChars(text,i,charCount,(int)x,(int)y);
            x+=mainFont.mMetrics.charsWidth(text,i,charCount);
            i+=charCount;
          }
        }
      }
    }
  }
);
}
