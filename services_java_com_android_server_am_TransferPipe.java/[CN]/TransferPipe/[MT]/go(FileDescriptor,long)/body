{
  try {
synchronized (this) {
      mOutFd=out;
      mEndTime=SystemClock.uptimeMillis() + timeout;
      if (DEBUG)       Slog.i(TAG,"read=" + getReadFd() + " write="+ getWriteFd()+ " out="+ out);
      closeFd(1);
      mThread.start();
      while (mFailure == null && !mComplete) {
        long waitTime=mEndTime - SystemClock.uptimeMillis();
        if (waitTime <= 0) {
          if (DEBUG)           Slog.i(TAG,"TIMEOUT!");
          mThread.interrupt();
          throw new IOException("Timeout");
        }
        try {
          wait(waitTime);
        }
 catch (        InterruptedException e) {
        }
      }
      if (DEBUG)       Slog.i(TAG,"Finished: " + mFailure);
      if (mFailure != null) {
        throw new IOException(mFailure);
      }
    }
  }
  finally {
    kill();
  }
}
