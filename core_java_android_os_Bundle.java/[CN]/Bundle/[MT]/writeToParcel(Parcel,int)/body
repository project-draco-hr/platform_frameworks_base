{
  final boolean oldAllowFds=parcel.pushAllowFds(mAllowFds);
  try {
    if (mParcelledData != null) {
      if (mParcelledData == EMPTY_PARCEL) {
        parcel.writeInt(0);
      }
 else {
        int length=mParcelledData.dataSize();
        parcel.writeInt(length);
        parcel.writeInt(BUNDLE_MAGIC);
        parcel.appendFrom(mParcelledData,0,length);
      }
    }
 else {
      if (mMap == null || mMap.size() <= 0) {
        parcel.writeInt(0);
        return;
      }
      int lengthPos=parcel.dataPosition();
      parcel.writeInt(-1);
      parcel.writeInt(BUNDLE_MAGIC);
      int startPos=parcel.dataPosition();
      parcel.writeArrayMapInternal(mMap);
      int endPos=parcel.dataPosition();
      parcel.setDataPosition(lengthPos);
      int length=endPos - startPos;
      parcel.writeInt(length);
      parcel.setDataPosition(endPos);
    }
  }
  finally {
    parcel.restoreAllowFds(oldAllowFds);
  }
}
