{
  if (!mRunning) {
    return;
  }
  int targetIndex=0;
  Intent intent=new Intent(RemoteDisplayState.SERVICE_INTERFACE);
  for (  ResolveInfo resolveInfo : mPackageManager.queryIntentServicesAsUser(intent,0,mUserId)) {
    ServiceInfo serviceInfo=resolveInfo.serviceInfo;
    if (serviceInfo != null && verifyServiceTrusted(serviceInfo)) {
      int sourceIndex=findProvider(serviceInfo.packageName,serviceInfo.name);
      if (sourceIndex < 0) {
        RemoteDisplayProviderProxy provider=new RemoteDisplayProviderProxy(mContext,new ComponentName(serviceInfo.packageName,serviceInfo.name),mUserId);
        provider.start();
        mProviders.add(targetIndex++,provider);
        mCallback.addProvider(provider);
      }
 else       if (sourceIndex >= targetIndex) {
        RemoteDisplayProviderProxy provider=mProviders.get(sourceIndex);
        provider.start();
        provider.rebindIfDisconnected();
        Collections.swap(mProviders,sourceIndex,targetIndex++);
      }
    }
  }
  if (targetIndex < mProviders.size()) {
    for (int i=mProviders.size() - 1; i >= targetIndex; i--) {
      RemoteDisplayProviderProxy provider=mProviders.get(i);
      mCallback.removeProvider(provider);
      mProviders.remove(provider);
      provider.stop();
    }
  }
}
