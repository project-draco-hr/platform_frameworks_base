{
  validateIncomingUri(uri);
  uri=getUriWithoutUserId(uri);
  if (enforceReadPermission(callingPkg,uri,null) != AppOpsManager.MODE_ALLOWED) {
    if (projection != null) {
      return new MatrixCursor(projection,0);
    }
    Cursor cursor=ContentProvider.this.query(uri,projection,selection,selectionArgs,sortOrder,CancellationSignal.fromTransport(cancellationSignal));
    final int columnCount=cursor.getCount();
    String[] allColumns=new String[columnCount];
    for (int i=0; i < columnCount; i++) {
      allColumns[i]=cursor.getColumnName(i);
    }
    return new MatrixCursor(allColumns,0);
  }
  final String original=setCallingPackage(callingPkg);
  try {
    return ContentProvider.this.query(uri,projection,selection,selectionArgs,sortOrder,CancellationSignal.fromTransport(cancellationSignal));
  }
  finally {
    setCallingPackage(original);
  }
}
