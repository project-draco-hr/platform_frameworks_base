{
  try {
    bm=BitmapFactory.decodeStream(inputStream);
    if (bm == null) {
      throw new IOException("Input stream empty and no image cached");
    }
    imageWidth=bm.getWidth();
    imageHeight=bm.getHeight();
    if (imageWidth < 0 || imageHeight < 0) {
      throw new RuntimeException("Illegal image size: " + imageWidth + ", "+ imageHeight);
    }
    setDimensions(imageWidth,imageHeight);
    model=createColorModel();
    setColorModel(model);
    setHints(hintflags);
    setProperties(new Hashtable<Object,Object>());
    sendPixels(NB_OF_LINES_PER_CHUNK != 0 ? NB_OF_LINES_PER_CHUNK : imageHeight);
    imageComplete(ImageConsumer.STATICIMAGEDONE);
  }
 catch (  IOException e) {
    throw e;
  }
catch (  RuntimeException e) {
    imageComplete(ImageConsumer.IMAGEERROR);
    throw e;
  }
 finally {
    closeStream();
  }
}
