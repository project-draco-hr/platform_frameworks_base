{
  boolean newDbExists=ceDatabaseFile.exists();
  if (Log.isLoggable(TAG,Log.VERBOSE)) {
    Log.v(TAG,"CeDatabaseHelper.create userId=" + userId + " oldDbExists="+ preNDatabaseFile.exists()+ " newDbExists="+ newDbExists);
  }
  boolean removeOldDb=false;
  if (!newDbExists && preNDatabaseFile.exists()) {
    removeOldDb=migratePreNDbToCe(preNDatabaseFile,ceDatabaseFile);
  }
  CeDatabaseHelper ceHelper=new CeDatabaseHelper(context,ceDatabaseFile.getPath());
  ceHelper.getWritableDatabase();
  ceHelper.close();
  if (removeOldDb) {
    Slog.i(TAG,"Migration complete - removing pre-N db " + preNDatabaseFile);
    if (!SQLiteDatabase.deleteDatabase(preNDatabaseFile)) {
      Slog.e(TAG,"Cannot remove pre-N db " + preNDatabaseFile);
    }
  }
  return ceHelper;
}
