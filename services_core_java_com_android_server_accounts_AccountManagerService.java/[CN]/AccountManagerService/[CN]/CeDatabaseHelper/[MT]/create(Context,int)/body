{
  File oldDatabaseFile=new File(getPreNDatabaseName(userId));
  File ceDatabaseFile=new File(getCeDatabaseName(userId));
  boolean newDbExists=ceDatabaseFile.exists();
  if (Log.isLoggable(TAG,Log.VERBOSE)) {
    Log.v(TAG,"CeDatabaseHelper.create userId=" + userId + " oldDbExists="+ oldDatabaseFile.exists()+ " newDbExists="+ newDbExists);
  }
  boolean removeOldDb=false;
  if (!newDbExists && oldDatabaseFile.exists()) {
    removeOldDb=migratePreNDbToCe(oldDatabaseFile,ceDatabaseFile);
  }
  CeDatabaseHelper ceHelper=new CeDatabaseHelper(context,userId);
  ceHelper.getWritableDatabase();
  ceHelper.close();
  if (removeOldDb) {
    Log.i(TAG,"Migration complete - creating backup of old db " + oldDatabaseFile);
    renameToBakFile(oldDatabaseFile);
  }
  return ceHelper;
}
