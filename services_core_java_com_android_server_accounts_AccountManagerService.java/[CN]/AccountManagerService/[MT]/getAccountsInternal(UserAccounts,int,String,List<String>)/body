{
synchronized (userAccounts.cacheLock) {
    ArrayList<Account> visibleAccounts=new ArrayList<>();
    for (    String visibleType : visibleAccountTypes) {
      Account[] accountsForType=getAccountsFromCacheLocked(userAccounts,visibleType,callingUid,callingPackage);
      if (accountsForType != null) {
        visibleAccounts.addAll(Arrays.asList(accountsForType));
      }
    }
    Account[] result=new Account[visibleAccounts.size()];
    for (int i=0; i < visibleAccounts.size(); i++) {
      result[i]=visibleAccounts.get(i);
    }
    return result;
  }
}
