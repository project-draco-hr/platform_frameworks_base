{
synchronized (mUsers) {
    UserAccounts accounts=mUsers.get(userId);
    boolean validateAccounts=false;
    if (accounts == null) {
      accounts=new UserAccounts(mContext,userId);
      initializeDebugDbSizeAndCompileSqlStatementForLogging(accounts.openHelper.getWritableDatabase(),accounts);
      mUsers.append(userId,accounts);
      purgeOldGrants(accounts);
      validateAccounts=true;
    }
    if (!accounts.openHelper.isCeDatabaseAttached() && mUnlockedUsers.get(userId)) {
      Log.i(TAG,"User " + userId + " is unlocked - opening CE database");
synchronized (accounts.cacheLock) {
        CeDatabaseHelper.create(mContext,userId);
        accounts.openHelper.attachCeDatabase();
      }
      syncDeCeAccountsLocked(accounts);
    }
    if (validateAccounts) {
      validateAccountsInternal(accounts,true);
    }
    return accounts;
  }
}
