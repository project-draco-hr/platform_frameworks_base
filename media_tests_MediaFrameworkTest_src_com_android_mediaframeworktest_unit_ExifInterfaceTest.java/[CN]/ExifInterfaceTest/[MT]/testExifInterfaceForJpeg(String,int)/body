{
  ExpectedValue expectedValue=new ExpectedValue(getContext().getResources().obtainTypedArray(typedArrayResourceId));
  File imageFile=new File(Environment.getExternalStorageDirectory(),fileName);
  ExifInterface exifInterface=new ExifInterface(imageFile.getAbsolutePath());
  if (VERBOSE) {
    printExifTagsAndValues(fileName,exifInterface);
  }
  compareWithExpectedValue(exifInterface,expectedValue);
  FileInputStream in=null;
  try {
    in=new FileInputStream(imageFile.getAbsolutePath());
    exifInterface=new ExifInterface(in);
    if (VERBOSE) {
      printExifTagsAndValues(fileName,exifInterface);
    }
    compareWithExpectedValue(exifInterface,expectedValue);
  }
  finally {
    IoUtils.closeQuietly(in);
  }
  try {
    FileDescriptor fd=Os.open(imageFile.getAbsolutePath(),OsConstants.O_RDONLY,0600);
    exifInterface=new ExifInterface(fd);
    if (VERBOSE) {
      printExifTagsAndValues(fileName,exifInterface);
    }
    compareWithExpectedValue(exifInterface,expectedValue);
  }
 catch (  ErrnoException e) {
    e.rethrowAsIOException();
  }
  try {
    FileDescriptor fd=Os.open(imageFile.getAbsolutePath(),OsConstants.O_RDWR,0600);
    exifInterface=new ExifInterface(fd);
    exifInterface.saveAttributes();
    exifInterface=new ExifInterface(fd);
    if (VERBOSE) {
      printExifTagsAndValues(fileName,exifInterface);
    }
    compareWithExpectedValue(exifInterface,expectedValue);
  }
 catch (  ErrnoException e) {
    e.rethrowAsIOException();
  }
  exifInterface=new ExifInterface(imageFile.getAbsolutePath());
  exifInterface.setAttribute(ExifInterface.TAG_MAKE,"abc");
  exifInterface.saveAttributes();
  exifInterface=new ExifInterface(imageFile.getAbsolutePath());
  if (VERBOSE) {
    printExifTagsAndValues(fileName,exifInterface);
  }
  assertEquals("abc",exifInterface.getAttribute(ExifInterface.TAG_MAKE));
}
