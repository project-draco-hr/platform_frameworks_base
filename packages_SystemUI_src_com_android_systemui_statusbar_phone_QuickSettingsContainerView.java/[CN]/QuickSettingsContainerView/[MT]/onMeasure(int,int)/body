{
  int width=MeasureSpec.getSize(widthMeasureSpec);
  int height=MeasureSpec.getSize(heightMeasureSpec);
  int availableWidth=(int)(width - getPaddingLeft() - getPaddingRight()- (mNumColumns - 1) * mCellGap);
  float cellWidth=(float)Math.ceil(((float)availableWidth) / mNumColumns);
  int N=getChildCount();
  int cellHeight=0;
  int cursor=0;
  for (int i=0; i < N; ++i) {
    QuickSettingsTileView v=(QuickSettingsTileView)getChildAt(i);
    ViewGroup.MarginLayoutParams lp=(ViewGroup.MarginLayoutParams)v.getLayoutParams();
    int colSpan=v.getColumnSpan();
    lp.width=(int)((colSpan * cellWidth) + (colSpan - 1) * mCellGap);
    int newWidthSpec=MeasureSpec.makeMeasureSpec(lp.width,MeasureSpec.EXACTLY);
    int newHeightSpec=MeasureSpec.makeMeasureSpec(lp.height,MeasureSpec.EXACTLY);
    v.measure(newWidthSpec,newHeightSpec);
    if (cellHeight <= 0) {
      cellHeight=v.getMeasuredHeight();
    }
    cursor+=colSpan;
  }
  int numRows=(int)Math.ceil((float)cursor / mNumColumns);
  int newHeight=(int)((numRows * cellHeight) + ((numRows - 1) * mCellGap)) + getPaddingTop() + getPaddingBottom();
  setMeasuredDimension(width,newHeight);
}
