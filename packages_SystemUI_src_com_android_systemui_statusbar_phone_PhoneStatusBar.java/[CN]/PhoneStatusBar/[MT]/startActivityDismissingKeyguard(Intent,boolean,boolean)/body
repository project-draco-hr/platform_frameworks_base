{
  if (onlyProvisioned && !isDeviceProvisioned())   return;
  final boolean afterKeyguardGone=PreviewInflater.wouldLaunchResolverActivity(mContext,intent,mCurrentUserId);
  final boolean keyguardShowing=mStatusBarKeyguardViewManager.isShowing();
  dismissKeyguardThenExecute(new OnDismissAction(){
    @Override public boolean onDismiss(){
      AsyncTask.execute(new Runnable(){
        public void run(){
          try {
            if (keyguardShowing && !afterKeyguardGone) {
              ActivityManagerNative.getDefault().keyguardWaitingForActivityDrawn();
            }
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
            mContext.startActivityAsUser(intent,new UserHandle(UserHandle.USER_CURRENT));
            overrideActivityPendingAppTransition(keyguardShowing && !afterKeyguardGone);
          }
 catch (          RemoteException e) {
          }
        }
      }
);
      if (dismissShade) {
        if (PhoneStatusBar.DEBUG_EMPTY_KEYGUARD) {
          Log.i(TAG,"Collapsing panel startActivityDismissKeyguard after keyguard" + "dismiss");
        }
        animateCollapsePanels(CommandQueue.FLAG_EXCLUDE_NONE,true);
      }
      return true;
    }
  }
,afterKeyguardGone);
}
