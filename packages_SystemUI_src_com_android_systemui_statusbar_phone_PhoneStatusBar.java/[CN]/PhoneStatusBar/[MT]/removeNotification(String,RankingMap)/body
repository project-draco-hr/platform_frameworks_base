{
  if (ENABLE_HEADS_UP && mHeadsUpNotificationView.getEntry() != null && key.equals(mHeadsUpNotificationView.getEntry().notification.getKey())) {
    mHeadsUpNotificationView.clear();
  }
  StatusBarNotification old=removeNotificationViews(key,ranking);
  if (SPEW)   Log.d(TAG,"removeNotification key=" + key + " old="+ old);
  if (old != null) {
    if (mTickerEnabled) {
      mTicker.removeEntry(old);
    }
    updateExpandedViewPos(EXPANDED_LEAVE_ALONE);
    if (CLOSE_PANEL_WHEN_EMPTIED && !hasActiveNotifications() && !mNotificationPanel.isTracking()) {
      if (mState == StatusBarState.SHADE) {
        animateCollapsePanels();
      }
 else       if (mState == StatusBarState.SHADE_LOCKED) {
        goToKeyguard();
      }
    }
  }
  setAreThereNotifications();
}
