{
  mKeyguardShowing=showKeyguard;
  if (updateWindowFlags) {
    WindowManager.LayoutParams lp=(WindowManager.LayoutParams)mStatusBarWindow.getLayoutParams();
    if (showKeyguard) {
      lp.flags|=WindowManager.LayoutParams.FLAG_SHOW_WALLPAPER;
      lp.privateFlags|=WindowManager.LayoutParams.PRIVATE_FLAG_KEYGUARD;
    }
 else {
      lp.flags&=~WindowManager.LayoutParams.FLAG_SHOW_WALLPAPER;
      lp.privateFlags&=~WindowManager.LayoutParams.PRIVATE_FLAG_KEYGUARD;
    }
    mWindowManager.updateViewLayout(mStatusBarWindow,lp);
  }
  if (!showKeyguard) {
    mKeyguard.setVisibility(View.GONE);
    mKeyguard.removeAllViews();
    contractWindow();
  }
 else {
    expandWindow();
    mKeyguard.setVisibility(View.VISIBLE);
    KeyguardSimpleHostView view=(KeyguardSimpleHostView)LayoutInflater.from(mContext).inflate(R.layout.keyguard_simple_host_view,mKeyguard,false);
    mKeyguard.addView(view);
    view.setOnDismissAction(new KeyguardHostView.OnDismissAction(){
      @Override public boolean onDismiss(){
        contractWindow();
        if (mKeyguardService != null) {
          mKeyguardService.dismissKeyguard();
        }
        return false;
      }
    }
);
    view.show();
  }
  if (callback != null) {
    mStatusBarView.getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener(){
      @Override public boolean onPreDraw(){
        mStatusBarView.getViewTreeObserver().removeOnPreDrawListener(this);
        mStatusBarView.post(new Runnable(){
          @Override public void run(){
            try {
              callback.onShown(mStatusBarWindow.getWindowToken());
            }
 catch (            RemoteException e) {
              Log.e(TAG,"Could not call show callback",e);
            }
          }
        }
);
        return true;
      }
    }
);
  }
}
