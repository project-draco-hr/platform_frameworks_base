{
  if (SPEW) {
    Slog.d(TAG,"updateExpandedViewPos before expandedPosition=" + expandedPosition + " mTrackingPosition="+ mTrackingPosition);
  }
  int panelh=0;
  final int disph=mDisplayMetrics.heightPixels;
  if (!mExpandedVisible) {
    updateExpandedInvisiblePosition();
    return;
  }
  int pos;
  if (expandedPosition == EXPANDED_FULL_OPEN) {
    panelh=disph;
  }
 else   if (expandedPosition == EXPANDED_LEAVE_ALONE) {
    panelh=mTrackingPosition;
  }
 else {
    if (expandedPosition <= disph) {
      panelh=expandedPosition;
    }
 else {
      panelh=disph;
    }
  }
  if (panelh > disph || (panelh < disph && !mTracking && !mAnimating)) {
    panelh=disph;
  }
 else   if (panelh < 0) {
    panelh=0;
  }
  mTrackingPosition=panelh;
  final View cropView=mNotificationPanel;
  ViewGroup.LayoutParams lp=cropView.getLayoutParams();
  lp.height=panelh;
  if (SPEW) {
    Slog.v(TAG,"updated cropView height=" + panelh);
  }
  cropView.setLayoutParams(lp);
  final int barh=getCloseViewHeight() + getStatusBarHeight();
  final float frac=saturate((float)(panelh - barh) / (disph - barh));
  final int color=((int)(0xB0 * Math.sin(frac * 1.57f))) << 24;
  mStatusBarWindow.setBackgroundColor(color);
}
