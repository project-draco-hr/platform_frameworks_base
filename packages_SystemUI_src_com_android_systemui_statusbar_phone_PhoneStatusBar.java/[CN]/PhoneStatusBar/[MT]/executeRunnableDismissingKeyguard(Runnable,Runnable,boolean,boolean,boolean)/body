{
  final boolean keyguardShowing=mStatusBarKeyguardViewManager.isShowing();
  dismissKeyguardThenExecute(new OnDismissAction(){
    @Override public boolean onDismiss(){
      AsyncTask.execute(new Runnable(){
        public void run(){
          try {
            if (keyguardShowing && !afterKeyguardGone) {
              ActivityManagerNative.getDefault().keyguardWaitingForActivityDrawn();
            }
            if (runnable != null) {
              runnable.run();
            }
          }
 catch (          RemoteException e) {
          }
        }
      }
);
      if (dismissShade) {
        animateCollapsePanels(CommandQueue.FLAG_EXCLUDE_RECENTS_PANEL,true,true);
      }
      return deferred;
    }
  }
,cancelAction,afterKeyguardGone);
}
