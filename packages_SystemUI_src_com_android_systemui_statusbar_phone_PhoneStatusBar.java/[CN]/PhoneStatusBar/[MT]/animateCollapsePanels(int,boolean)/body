{
  if (!force && (mState == StatusBarState.KEYGUARD || mState == StatusBarState.SHADE_LOCKED)) {
    runPostCollapseRunnables();
    return;
  }
  if (SPEW) {
    Log.d(TAG,"animateCollapse():" + " mExpandedVisible=" + mExpandedVisible + " flags="+ flags);
  }
  if ((flags & CommandQueue.FLAG_EXCLUDE_RECENTS_PANEL) == 0) {
    if (!mHandler.hasMessages(MSG_HIDE_RECENT_APPS)) {
      mHandler.removeMessages(MSG_HIDE_RECENT_APPS);
      mHandler.sendEmptyMessage(MSG_HIDE_RECENT_APPS);
    }
  }
  if ((flags & CommandQueue.FLAG_EXCLUDE_SEARCH_PANEL) == 0) {
    mHandler.removeMessages(MSG_CLOSE_SEARCH_PANEL);
    mHandler.sendEmptyMessage(MSG_CLOSE_SEARCH_PANEL);
  }
  if (mStatusBarWindow != null) {
    mStatusBarWindowManager.setStatusBarFocusable(false);
    mStatusBarWindow.cancelExpandHelper();
    if (DEBUG_EMPTY_KEYGUARD) {
      Log.i(TAG,"Collapsing panel from animateCollapsePanels:" + " force=" + force + " mState="+ mState);
    }
    mStatusBarView.collapseAllPanels(true);
  }
}
