{
  if (!force && (mState == StatusBarState.KEYGUARD || mState == StatusBarState.SHADE_LOCKED)) {
    if (mPostCollapseCleanup != null) {
      mPostCollapseCleanup.run();
      mPostCollapseCleanup=null;
    }
    return;
  }
  if (SPEW) {
    Log.d(TAG,"animateCollapse():" + " mExpandedVisible=" + mExpandedVisible + " flags="+ flags);
  }
  if ((flags & CommandQueue.FLAG_EXCLUDE_RECENTS_PANEL) == 0) {
    mHandler.removeMessages(MSG_HIDE_RECENT_APPS);
    mHandler.sendEmptyMessage(MSG_HIDE_RECENT_APPS);
  }
  if ((flags & CommandQueue.FLAG_EXCLUDE_SEARCH_PANEL) == 0) {
    mHandler.removeMessages(MSG_CLOSE_SEARCH_PANEL);
    mHandler.sendEmptyMessage(MSG_CLOSE_SEARCH_PANEL);
  }
  if (mStatusBarWindow != null) {
    mStatusBarWindowManager.setStatusBarFocusable(false);
    mStatusBarWindow.cancelExpandHelper();
    mStatusBarView.collapseAllPanels(true);
  }
}
