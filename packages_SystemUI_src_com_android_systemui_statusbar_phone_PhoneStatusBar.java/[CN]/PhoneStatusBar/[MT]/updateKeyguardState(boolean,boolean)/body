{
  if (mState == StatusBarState.KEYGUARD) {
    mKeyguardIndicationController.setVisible(true);
    mNotificationPanel.resetViews();
    if (mKeyguardUserSwitcher != null) {
      mKeyguardUserSwitcher.setKeyguard(true,fromShadeLocked);
    }
    mStatusBarView.removePendingHideExpandedRunnables();
  }
 else {
    mKeyguardIndicationController.setVisible(false);
    if (mKeyguardUserSwitcher != null) {
      mKeyguardUserSwitcher.setKeyguard(false,goingToFullShade || mState == StatusBarState.SHADE_LOCKED || fromShadeLocked);
    }
  }
  if (mState == StatusBarState.KEYGUARD || mState == StatusBarState.SHADE_LOCKED) {
    mScrimController.setKeyguardShowing(true);
    mIconPolicy.setKeyguardShowing(true);
  }
 else {
    mScrimController.setKeyguardShowing(false);
    mIconPolicy.setKeyguardShowing(false);
  }
  if (mFullscreenUserSwitcher != null) {
    if (mState == StatusBarState.FULLSCREEN_USER_SWITCHER) {
      mFullscreenUserSwitcher.show();
    }
 else {
      mFullscreenUserSwitcher.hide();
    }
  }
  mNotificationPanel.setBarState(mState,mKeyguardFadingAway,goingToFullShade);
  updateDozingState();
  updatePublicMode();
  updateStackScrollerState(goingToFullShade);
  updateNotifications();
  checkBarModes();
  updateMediaMetaData(false);
  mKeyguardMonitor.notifyKeyguardState(mStatusBarKeyguardViewManager.isShowing(),mStatusBarKeyguardViewManager.isSecure());
}
