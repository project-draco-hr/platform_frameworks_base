{
  boolean staying=mLeaveOpenOnKeyguardHide;
  setBarState(StatusBarState.SHADE);
  if (mLeaveOpenOnKeyguardHide) {
    mLeaveOpenOnKeyguardHide=false;
    mNotificationPanel.animateToFullShade(calculateGoingToFullShadeDelay());
    if (mDraggedDownRow != null) {
      mDraggedDownRow.setUserLocked(false);
      mDraggedDownRow=null;
    }
  }
 else {
    instantCollapseNotificationPanel();
  }
  updateKeyguardState(staying);
  return staying;
}
