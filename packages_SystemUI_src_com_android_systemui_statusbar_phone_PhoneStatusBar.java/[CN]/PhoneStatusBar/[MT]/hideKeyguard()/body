{
  boolean staying=mLeaveOpenOnKeyguardHide;
  setBarState(StatusBarState.SHADE);
  if (mLeaveOpenOnKeyguardHide) {
    mLeaveOpenOnKeyguardHide=false;
    mNotificationPanel.animateToFullShade(calculateGoingToFullShadeDelay());
    if (mDraggedDownRow != null) {
      mDraggedDownRow.setUserLocked(false);
      mDraggedDownRow=null;
    }
  }
 else {
    instantCollapseNotificationPanel();
  }
  updateKeyguardState(staying,false);
  if (mQSPanel != null) {
    mQSPanel.refreshAllTiles();
  }
  mHandler.removeMessages(MSG_LAUNCH_TRANSITION_TIMEOUT);
  return staying;
}
