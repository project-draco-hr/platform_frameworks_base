{
  userActivity();
  if (mSettingsClosing && mFlipSettingsViewAnim != null && mFlipSettingsViewAnim.isRunning()) {
    return true;
  }
  if (mSettingsTracker != null) {
    mSettingsTracker.addMovement(event);
  }
  final int slop=ViewConfiguration.get(mContext).getScaledTouchSlop();
  if (event.getAction() == MotionEvent.ACTION_DOWN) {
    mSettingsTracker=VelocityTracker.obtain();
    mSettingsDownY=event.getY();
    mSettingsCancelled=false;
    mSettingsStarted=false;
    mSettingsClosing=mFlipSettingsView.getVisibility() == View.VISIBLE;
    if (mSettingsClosing) {
      mStackScroller.setVisibility(View.VISIBLE);
    }
 else {
      mFlipSettingsView.setTranslationY(-mNotificationPanel.getMeasuredHeight());
    }
    dispatchSettingsEvent(event);
  }
 else   if (mSettingsTracker != null && (event.getAction() == MotionEvent.ACTION_UP || event.getAction() == MotionEvent.ACTION_CANCEL)) {
    final float dy=event.getY() - mSettingsDownY;
    final FlipperButton flipper=mState == StatusBarState.KEYGUARD ? mKeyguardFlipper : mHeaderFlipper;
    final boolean inButton=flipper.inHolderBounds(event);
    final boolean qsTap=mSettingsClosing && Math.abs(dy) < slop;
    if (!qsTap && !inButton) {
      mSettingsTracker.computeCurrentVelocity(1000);
      final float vy=mSettingsTracker.getYVelocity();
      final boolean animate=true;
      if (dy <= slop || vy <= 0) {
        flipToNotifications(animate);
      }
 else {
        flipToSettings(animate);
      }
    }
    mSettingsTracker.recycle();
    mSettingsTracker=null;
    dispatchSettingsEvent(event);
  }
 else   if (mSettingsTracker != null && event.getAction() == MotionEvent.ACTION_MOVE) {
    final float dy=event.getY() - mSettingsDownY;
    if (mSettingsClosing) {
      positionSettings(dy);
      final boolean qsTap=Math.abs(dy) < slop;
      if (!mSettingsCancelled && !qsTap) {
        MotionEvent cancelEvent=MotionEvent.obtainNoHistory(event);
        cancelEvent.setAction(MotionEvent.ACTION_CANCEL);
        dispatchSettingsEvent(cancelEvent);
        mSettingsCancelled=true;
      }
    }
 else {
      if (!mSettingsStarted && dy > slop) {
        mSettingsStarted=true;
        mFlipSettingsView.setVisibility(View.VISIBLE);
        mStackScroller.setVisibility(View.VISIBLE);
      }
      if (mSettingsStarted) {
        positionSettings(dy);
      }
      dispatchSettingsEvent(event);
    }
  }
  return true;
}
