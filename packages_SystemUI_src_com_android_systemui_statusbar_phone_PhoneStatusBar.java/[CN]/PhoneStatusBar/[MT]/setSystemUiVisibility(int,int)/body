{
  final int oldVal=mSystemUiVisibility;
  final int newVal=(oldVal & ~mask) | (vis & mask);
  final int diff=newVal ^ oldVal;
  if (diff != 0) {
    mSystemUiVisibility=newVal;
    if (0 != (diff & View.SYSTEM_UI_FLAG_LOW_PROFILE)) {
      final boolean lightsOut=(0 != (vis & View.SYSTEM_UI_FLAG_LOW_PROFILE));
      if (lightsOut) {
        animateCollapsePanels();
        if (mTicking) {
          haltTicker();
        }
      }
      if (mNavigationBarView != null) {
        mNavigationBarView.setLowProfile(lightsOut);
      }
      setStatusBarLowProfile(lightsOut);
    }
    if (0 != (diff & View.STATUS_BAR_OVERLAY)) {
      boolean overlay=0 != (vis & View.STATUS_BAR_OVERLAY);
      if (overlay) {
        setTransparent(true);
        scheduleAutohide();
      }
 else {
        setTransparent(false);
        cancelAutohide();
      }
    }
    notifyUiVisibilityChanged(mSystemUiVisibility);
  }
}
