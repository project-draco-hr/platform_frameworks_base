{
  if (inPinnedMode) {
    mStatusBarWindowManager.setHeadsUpShowing(true);
    mStatusBarWindowManager.setForceStatusBarVisible(true);
    if (mNotificationPanel.isFullyCollapsed()) {
      mNotificationPanel.requestLayout();
      mStatusBarWindowManager.setForceWindowCollapsed(true);
      mNotificationPanel.post(new Runnable(){
        @Override public void run(){
          mStatusBarWindowManager.setForceWindowCollapsed(false);
        }
      }
);
    }
  }
 else {
    if (!mNotificationPanel.isFullyCollapsed() || mNotificationPanel.isTracking()) {
      mStatusBarWindowManager.setHeadsUpShowing(false);
    }
 else {
      mHeadsUpManager.setHeadsUpGoingAway(true);
      mStackScroller.runAfterAnimationFinished(new Runnable(){
        @Override public void run(){
          if (!mHeadsUpManager.hasPinnedHeadsUp()) {
            mStatusBarWindowManager.setHeadsUpShowing(false);
            mHeadsUpManager.setHeadsUpGoingAway(false);
          }
        }
      }
);
    }
  }
}
