{
  NotificationManager notificationManager=(NotificationManager)mContext.getSystemService(Context.NOTIFICATION_SERVICE);
  if (notificationManager == null) {
    return;
  }
  String title=getNotifTitle(notif,mContext);
  String message=getNotifMessage(notif,mContext);
  if (DEBUG)   Log.d(TAG,"setNiNotification, notifyId: " + notif.notificationId + ", title: "+ title+ ", message: "+ message);
  if (mNiNotification == null) {
    mNiNotification=new Notification();
    mNiNotification.icon=com.android.internal.R.drawable.stat_sys_gps_on;
    mNiNotification.when=0;
  }
  if (mPlaySounds) {
    mNiNotification.defaults|=Notification.DEFAULT_SOUND;
  }
 else {
    mNiNotification.defaults&=~Notification.DEFAULT_SOUND;
  }
  mNiNotification.flags=Notification.FLAG_ONGOING_EVENT | Notification.FLAG_AUTO_CANCEL;
  mNiNotification.tickerText=getNotifTicker(notif,mContext);
  Intent intent=!mPopupImmediately ? getDlgIntent(notif) : new Intent();
  PendingIntent pi=PendingIntent.getBroadcast(mContext,0,intent,0);
  mNiNotification.setLatestEventInfo(mContext,title,message,pi);
  if (visible) {
    notificationManager.notify(notif.notificationId,mNiNotification);
  }
 else {
    notificationManager.cancel(notif.notificationId);
  }
}
