{
  final AppButtonData appButtonData=(AppButtonData)appIcon.getTag();
  Menu menu=mPopupMenu.getMenu();
  if (appButtonData.pinned) {
    menu.add("Unpin").setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
      @Override public boolean onMenuItemClick(      MenuItem item){
        appButtonData.pinned=false;
        removeView(appIcon);
        if (!appButtonData.isEmpty()) {
          addView(appIcon);
        }
        updateState(appIcon);
        return true;
      }
    }
);
  }
 else {
    menu.add("Pin").setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
      @Override public boolean onMenuItemClick(      MenuItem item){
        appButtonData.pinned=true;
        removeView(appIcon);
        addView(appIcon,getNewAppIndex(getChildCount(),true));
        updateState(appIcon);
        return true;
      }
    }
);
  }
}
