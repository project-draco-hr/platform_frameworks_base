{
  sProxyInfoLock.readLock().lock();
  try {
    if (sGlobalProxyChangedObserver == null) {
      registerContentObserversReadLocked(ctx);
      parseGlobalProxyInfoReadLocked(ctx);
    }
    if (sGlobalProxySpec != null) {
      if (isURLInExclusionListReadLocked(url,sGlobalProxySpec.exclusionList)) {
        return java.net.Proxy.NO_PROXY;
      }
      java.net.Proxy retProxy=new java.net.Proxy(java.net.Proxy.Type.HTTP,sGlobalProxySpec.proxyAddress);
      sProxyInfoLock.readLock().unlock();
      if (isLocalHost(url)) {
        return java.net.Proxy.NO_PROXY;
      }
      sProxyInfoLock.readLock().lock();
      return retProxy;
    }
 else {
      if (!isNetworkWifi(ctx)) {
        java.net.Proxy retProxy=getDefaultProxy(url);
        sProxyInfoLock.readLock().unlock();
        if (isLocalHost(url)) {
          return java.net.Proxy.NO_PROXY;
        }
        sProxyInfoLock.readLock().lock();
        return retProxy;
      }
 else {
        return java.net.Proxy.NO_PROXY;
      }
    }
  }
  finally {
    sProxyInfoLock.readLock().unlock();
  }
}
