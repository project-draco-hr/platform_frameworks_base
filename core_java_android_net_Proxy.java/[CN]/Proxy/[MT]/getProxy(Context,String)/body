{
  sProxyInfoLock.readLock().lock();
  java.net.Proxy retval;
  try {
    if (sGlobalProxyChangedObserver == null) {
      registerContentObserversReadLocked(ctx);
      parseGlobalProxyInfoReadLocked(ctx);
    }
    if (sGlobalProxySpec != null) {
      if (isURLInExclusionList(url,sGlobalProxySpec.exclusionList)) {
        retval=java.net.Proxy.NO_PROXY;
      }
 else {
        retval=new java.net.Proxy(java.net.Proxy.Type.HTTP,sGlobalProxySpec.address);
      }
    }
 else {
      retval=getDefaultProxy(ctx,url);
    }
  }
  finally {
    sProxyInfoLock.readLock().unlock();
  }
  if ((retval != java.net.Proxy.NO_PROXY) && (isLocalHost(url))) {
    retval=java.net.Proxy.NO_PROXY;
  }
  return retval;
}
