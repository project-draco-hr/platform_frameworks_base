{
  sProxyInfoLock.readLock().lock();
  java.net.Proxy retval;
  try {
    if (sGlobalProxyChangedObserver == null) {
      registerContentObserversReadLocked(ctx);
      parseGlobalProxyInfoReadLocked(ctx);
    }
    if (sGlobalProxySpec != null) {
      if (isURLInExclusionListReadLocked(url,sGlobalProxySpec.exclusionList)) {
        retval=java.net.Proxy.NO_PROXY;
      }
 else {
        java.net.Proxy retProxy=new java.net.Proxy(java.net.Proxy.Type.HTTP,sGlobalProxySpec.proxyAddress);
        sProxyInfoLock.readLock().unlock();
        if (isLocalHost(url)) {
          sProxyInfoLock.readLock().lock();
          retval=java.net.Proxy.NO_PROXY;
        }
 else {
          sProxyInfoLock.readLock().lock();
          retval=retProxy;
        }
      }
    }
 else {
      if (!isNetworkWifi(ctx)) {
        java.net.Proxy retProxy=getDefaultProxy(url);
        sProxyInfoLock.readLock().unlock();
        if (isLocalHost(url)) {
          sProxyInfoLock.readLock().lock();
          retval=java.net.Proxy.NO_PROXY;
        }
 else {
          sProxyInfoLock.readLock().lock();
          retval=retProxy;
        }
      }
 else {
        retval=java.net.Proxy.NO_PROXY;
      }
    }
  }
  finally {
    sProxyInfoLock.readLock().unlock();
  }
  return retval;
}
