{
  ContentResolver contentResolver=ctx.getContentResolver();
  String proxyHost=Settings.Secure.getString(contentResolver,Settings.Secure.HTTP_PROXY);
  if (proxyHost == null) {
    return;
  }
  String exclusionListSpec=Settings.Secure.getString(contentResolver,Settings.Secure.HTTP_PROXY_EXCLUSION_LIST);
  String host=parseHost(proxyHost);
  int port=parsePort(proxyHost);
  if (proxyHost != null) {
    sGlobalProxySpec=new ProxySpec();
    sGlobalProxySpec.proxyAddress=new InetSocketAddress(host,port);
    if (exclusionListSpec != null) {
      String[] exclusionListEntries=exclusionListSpec.toLowerCase().split(",");
      String[] processedEntries=new String[exclusionListEntries.length];
      for (int i=0; i < exclusionListEntries.length; i++) {
        String entry=exclusionListEntries[i].trim();
        if (entry.startsWith(".")) {
          entry=entry.substring(1);
        }
        processedEntries[i]=entry;
      }
      sProxyInfoLock.readLock().unlock();
      sProxyInfoLock.writeLock().lock();
      sGlobalProxySpec.exclusionList=processedEntries;
    }
 else {
      sProxyInfoLock.readLock().unlock();
      sProxyInfoLock.writeLock().lock();
      sGlobalProxySpec.exclusionList=null;
    }
  }
 else {
    sProxyInfoLock.readLock().unlock();
    sProxyInfoLock.writeLock().lock();
    sGlobalProxySpec=null;
  }
  sProxyInfoLock.readLock().lock();
  sProxyInfoLock.writeLock().unlock();
}
