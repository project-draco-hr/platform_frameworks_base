{
  final int paddingTop=mPaddingTop;
  int childTop;
  int childLeft=mPaddingLeft;
  final int height=mBottom - mTop;
  int childBottom=height - mPaddingBottom;
  int childSpace=height - paddingTop - mPaddingBottom;
  final int count=getVirtualChildCount();
  final int majorGravity=mGravity & Gravity.HORIZONTAL_GRAVITY_MASK;
  final int minorGravity=mGravity & Gravity.VERTICAL_GRAVITY_MASK;
  final boolean baselineAligned=mBaselineAligned;
  final int[] maxAscent=mMaxAscent;
  final int[] maxDescent=mMaxDescent;
  if (majorGravity != Gravity.LEFT) {
switch (majorGravity) {
case Gravity.RIGHT:
      childLeft=mRight - mLeft + mPaddingLeft - mTotalLength;
    break;
case Gravity.CENTER_HORIZONTAL:
  childLeft+=((mRight - mLeft) - mTotalLength) / 2;
break;
}
}
for (int i=0; i < count; i++) {
final View child=getVirtualChildAt(i);
if (child == null) {
childLeft+=measureNullChild(i);
}
 else if (child.getVisibility() != GONE) {
final int childWidth=child.getMeasuredWidth();
final int childHeight=child.getMeasuredHeight();
int childBaseline=-1;
final LinearLayout.LayoutParams lp=(LinearLayout.LayoutParams)child.getLayoutParams();
if (baselineAligned && lp.height != LayoutParams.MATCH_PARENT) {
childBaseline=child.getBaseline();
}
int gravity=lp.gravity;
if (gravity < 0) {
gravity=minorGravity;
}
switch (gravity & Gravity.VERTICAL_GRAVITY_MASK) {
case Gravity.TOP:
childTop=paddingTop + lp.topMargin;
if (childBaseline != -1) {
childTop+=maxAscent[INDEX_TOP] - childBaseline;
}
break;
case Gravity.CENTER_VERTICAL:
childTop=paddingTop + ((childSpace - childHeight) / 2) + lp.topMargin - lp.bottomMargin;
break;
case Gravity.BOTTOM:
childTop=childBottom - childHeight - lp.bottomMargin;
if (childBaseline != -1) {
int descent=child.getMeasuredHeight() - childBaseline;
childTop-=(maxDescent[INDEX_BOTTOM] - descent);
}
break;
default :
childTop=paddingTop;
break;
}
if (hasDividerBeforeChildAt(i)) {
childLeft+=mDividerWidth;
}
childLeft+=lp.leftMargin;
setChildFrame(child,childLeft + getLocationOffset(child),childTop,childWidth,childHeight);
childLeft+=childWidth + lp.rightMargin + getNextLocationOffset(child);
i+=getChildrenSkipCount(child,i);
}
}
}
