{
  final boolean showDividerBeginning=(mShowDividers & SHOW_DIVIDER_BEGINNING) == SHOW_DIVIDER_BEGINNING;
  final boolean showDividerMiddle=(mShowDividers & SHOW_DIVIDER_MIDDLE) == SHOW_DIVIDER_MIDDLE;
  final boolean showDividerEnd=(mShowDividers & SHOW_DIVIDER_END) == SHOW_DIVIDER_END;
  final int count=getVirtualChildCount();
  int top=getPaddingTop();
  boolean firstVisible=true;
  for (int i=0; i < count; i++) {
    final View child=getVirtualChildAt(i);
    if (child == null) {
      top+=measureNullChild(i);
    }
 else     if (child.getVisibility() != GONE) {
      if (firstVisible) {
        firstVisible=false;
        if (showDividerBeginning) {
          drawHorizontalDivider(canvas,top);
          top+=mDividerHeight;
        }
      }
 else       if (showDividerMiddle) {
        drawHorizontalDivider(canvas,top);
        top+=mDividerHeight;
      }
      LayoutParams lp=(LayoutParams)child.getLayoutParams();
      top+=lp.topMargin + child.getHeight() + lp.bottomMargin;
    }
  }
  if (showDividerEnd) {
    drawHorizontalDivider(canvas,top);
  }
}
