{
  boolean ret=true;
  String privKeyName=Credentials.USER_PRIVATE_KEY + name;
  String userCertName=Credentials.USER_CERTIFICATE + name;
  String caCertName=Credentials.CA_CERTIFICATE + name;
  if (mClientCertificate != null) {
    byte[] privKeyData=mClientPrivateKey.getEncoded();
    ret=keyStore.importKey(privKeyName,privKeyData,Process.WIFI_UID,KeyStore.FLAG_ENCRYPTED);
    if (ret == false) {
      return ret;
    }
    ret=putCertInKeyStore(keyStore,userCertName,mClientCertificate);
    if (ret == false) {
      keyStore.delKey(privKeyName,Process.WIFI_UID);
      return ret;
    }
  }
  if (mCaCert != null) {
    ret=putCertInKeyStore(keyStore,caCertName,mCaCert);
    if (ret == false) {
      if (mClientCertificate != null) {
        keyStore.delKey(privKeyName,Process.WIFI_UID);
        keyStore.delete(userCertName,Process.WIFI_UID);
      }
      return ret;
    }
  }
  if (mClientCertificate != null) {
    setClientCertificateAlias(name);
    mClientPrivateKey=null;
    mClientCertificate=null;
  }
  if (mCaCert != null) {
    setCaCertificateAlias(name);
    mCaCert=null;
  }
  return ret;
}
