{
  if (TRACE_FOR_PRELOAD) {
    if ((id >>> 24) == 0x1) {
      final String name=getResourceName(id);
      if (name != null) {
        Log.d("PreloadDrawable",name);
      }
    }
  }
  boolean isColorDrawable=false;
  if (value.type >= TypedValue.TYPE_FIRST_COLOR_INT && value.type <= TypedValue.TYPE_LAST_COLOR_INT) {
    isColorDrawable=true;
  }
  final long key=isColorDrawable ? value.data : (((long)value.assetCookie) << 32) | value.data;
  Drawable dr=getCachedDrawable(isColorDrawable ? mColorDrawableCache : mDrawableCache,key);
  if (dr != null) {
    return dr;
  }
  Drawable.ConstantState cs;
  if (isColorDrawable) {
    cs=sPreloadedColorDrawables.get(key);
  }
 else {
    cs=sPreloadedDrawables[mConfiguration.getLayoutDirection()].get(key);
  }
  if (cs != null) {
    dr=cs.newDrawable(this);
  }
 else {
    if (isColorDrawable) {
      dr=new ColorDrawable(value.data);
    }
    if (dr == null) {
      if (value.string == null) {
        throw new NotFoundException("Resource is not a Drawable (color or path): " + value);
      }
      String file=value.string.toString();
      if (TRACE_FOR_MISS_PRELOAD) {
        if ((id >>> 24) == 0x1) {
          final String name=getResourceName(id);
          if (name != null)           android.util.Log.d(TAG,"Loading framework drawable #" + Integer.toHexString(id) + ": "+ name+ " at "+ file);
        }
      }
      if (DEBUG_LOAD)       Log.v(TAG,"Loading drawable for cookie " + value.assetCookie + ": "+ file);
      if (file.endsWith(".xml")) {
        Trace.traceBegin(Trace.TRACE_TAG_RESOURCES,file);
        try {
          XmlResourceParser rp=loadXmlResourceParser(file,id,value.assetCookie,"drawable");
          dr=Drawable.createFromXml(this,rp);
          rp.close();
        }
 catch (        Exception e) {
          Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
          NotFoundException rnf=new NotFoundException("File " + file + " from drawable resource ID #0x"+ Integer.toHexString(id));
          rnf.initCause(e);
          throw rnf;
        }
        Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
      }
 else {
        Trace.traceBegin(Trace.TRACE_TAG_RESOURCES,file);
        try {
          InputStream is=mAssets.openNonAsset(value.assetCookie,file,AssetManager.ACCESS_STREAMING);
          dr=Drawable.createFromResourceStream(this,value,is,file,null);
          is.close();
        }
 catch (        Exception e) {
          Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
          NotFoundException rnf=new NotFoundException("File " + file + " from drawable resource ID #0x"+ Integer.toHexString(id));
          rnf.initCause(e);
          throw rnf;
        }
        Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
      }
    }
  }
  if (dr != null) {
    dr.setChangingConfigurations(value.changingConfigurations);
    cs=dr.getConstantState();
    if (cs != null) {
      if (mPreloading) {
        final int changingConfigs=cs.getChangingConfigurations();
        if (isColorDrawable) {
          if (verifyPreloadConfig(changingConfigs,0,value.resourceId,"drawable")) {
            sPreloadedColorDrawables.put(key,cs);
          }
        }
 else {
          if (verifyPreloadConfig(changingConfigs,LAYOUT_DIR_CONFIG,value.resourceId,"drawable")) {
            if ((changingConfigs & LAYOUT_DIR_CONFIG) == 0) {
              sPreloadedDrawables[0].put(key,cs);
              sPreloadedDrawables[1].put(key,cs);
            }
 else {
              final LongSparseArray<Drawable.ConstantState> preloads=sPreloadedDrawables[mConfiguration.getLayoutDirection()];
              preloads.put(key,cs);
            }
          }
        }
      }
 else {
synchronized (mAccessLock) {
          if (isColorDrawable) {
            mColorDrawableCache.put(key,new WeakReference<Drawable.ConstantState>(cs));
          }
 else {
            mDrawableCache.put(key,new WeakReference<Drawable.ConstantState>(cs));
          }
        }
      }
    }
  }
  return dr;
}
