{
synchronized (mAccessLock) {
    if (false) {
      Slog.i(TAG,"**** Updating config of " + this + ": old config is "+ mConfiguration+ " old compat is "+ mCompatibilityInfo);
      Slog.i(TAG,"**** Updating config of " + this + ": new config is "+ config+ " new compat is "+ compat);
    }
    if (compat != null) {
      mCompatibilityInfo=compat;
    }
    if (metrics != null) {
      mMetrics.setTo(metrics);
    }
    mCompatibilityInfo.applyToDisplayMetrics(mMetrics);
    int configChanges=calcConfigChanges(config);
    if (mConfiguration.locale == null) {
      mConfiguration.locale=Locale.getDefault();
      mConfiguration.setLayoutDirection(mConfiguration.locale);
    }
    if (mConfiguration.densityDpi != Configuration.DENSITY_DPI_UNDEFINED) {
      mMetrics.densityDpi=mConfiguration.densityDpi;
      mMetrics.density=mConfiguration.densityDpi * DisplayMetrics.DENSITY_DEFAULT_SCALE;
    }
    mMetrics.scaledDensity=mMetrics.density * mConfiguration.fontScale;
    String locale=null;
    if (mConfiguration.locale != null) {
      locale=adjustLanguageTag(mConfiguration.locale.toLanguageTag());
    }
    int width, height;
    if (mMetrics.widthPixels >= mMetrics.heightPixels) {
      width=mMetrics.widthPixels;
      height=mMetrics.heightPixels;
    }
 else {
      width=mMetrics.heightPixels;
      height=mMetrics.widthPixels;
    }
    int keyboardHidden=mConfiguration.keyboardHidden;
    if (keyboardHidden == Configuration.KEYBOARDHIDDEN_NO && mConfiguration.hardKeyboardHidden == Configuration.HARDKEYBOARDHIDDEN_YES) {
      keyboardHidden=Configuration.KEYBOARDHIDDEN_SOFT;
    }
    mAssets.setConfiguration(mConfiguration.mcc,mConfiguration.mnc,locale,mConfiguration.orientation,mConfiguration.touchscreen,mConfiguration.densityDpi,mConfiguration.keyboard,keyboardHidden,mConfiguration.navigation,width,height,mConfiguration.smallestScreenWidthDp,mConfiguration.screenWidthDp,mConfiguration.screenHeightDp,mConfiguration.screenLayout,mConfiguration.uiMode,Build.VERSION.RESOURCES_SDK_INT);
    if (DEBUG_CONFIG) {
      Slog.i(TAG,"**** Updating config of " + this + ": final config is "+ mConfiguration+ " final compat is "+ mCompatibilityInfo);
    }
    clearDrawableCachesLocked(mDrawableCache,configChanges);
    clearDrawableCachesLocked(mColorDrawableCache,configChanges);
    mColorStateListCache.onConfigurationChange(configChanges);
    mAnimatorCache.onConfigurationChange(configChanges);
    mStateListAnimatorCache.onConfigurationChange(configChanges);
    flushLayoutCache();
  }
synchronized (sSync) {
    if (mPluralRule != null) {
      mPluralRule=NativePluralRules.forLocale(config.locale);
    }
  }
}
