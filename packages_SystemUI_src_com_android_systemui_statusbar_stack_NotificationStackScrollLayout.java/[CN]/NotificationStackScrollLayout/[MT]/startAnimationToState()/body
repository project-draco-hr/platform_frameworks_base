{
  if (mNeedsAnimation) {
    generateChildHierarchyEvents();
    mNeedsAnimation=false;
  }
  if (!mAnimationEvents.isEmpty() || isCurrentlyAnimating()) {
    setAnimationRunning(true);
    mStateAnimator.startAnimationForEvents(mAnimationEvents,mCurrentStackScrollState,mGoToFullShadeDelay);
    mAnimationEvents.clear();
    updateBackground();
    updateViewShadows();
  }
 else {
    applyCurrentState();
  }
  mGoToFullShadeDelay=0;
}
