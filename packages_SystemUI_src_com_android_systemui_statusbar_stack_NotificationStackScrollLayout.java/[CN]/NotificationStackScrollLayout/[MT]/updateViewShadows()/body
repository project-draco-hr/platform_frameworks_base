{
  for (int i=0; i < getChildCount(); i++) {
    ExpandableView child=(ExpandableView)getChildAt(i);
    if (child.getVisibility() != GONE) {
      mTmpSortedChildren.add(child);
    }
  }
  Collections.sort(mTmpSortedChildren,mViewPositionComparator);
  ExpandableView previous=null;
  for (int i=0; i < mTmpSortedChildren.size(); i++) {
    ExpandableView expandableView=mTmpSortedChildren.get(i);
    float translationZ=expandableView.getTranslationZ();
    float otherZ=previous == null ? translationZ : previous.getTranslationZ();
    float diff=otherZ - translationZ;
    if (diff <= 0.0f || diff >= FakeShadowView.SHADOW_SIBLING_TRESHOLD) {
      expandableView.setFakeShadowIntensity(0.0f,0.0f,0,0);
    }
 else {
      float yLocation=previous.getTranslationY() + previous.getActualHeight() - expandableView.getTranslationY() - previous.getExtraBottomPadding();
      expandableView.setFakeShadowIntensity(diff / FakeShadowView.SHADOW_SIBLING_TRESHOLD,previous.getOutlineAlpha(),(int)yLocation,previous.getOutlineTranslation());
    }
    previous=expandableView;
  }
  mTmpSortedChildren.clear();
}
