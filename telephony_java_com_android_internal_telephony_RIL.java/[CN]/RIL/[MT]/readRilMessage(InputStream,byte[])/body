{
  int countRead;
  int offset;
  int remaining;
  int messageLength;
  offset=0;
  remaining=4;
  do {
    countRead=is.read(buffer,offset,remaining);
    if (countRead < 0) {
      Log.e(LOG_TAG,"Hit EOS reading message length");
      return -1;
    }
    offset+=countRead;
    remaining-=countRead;
  }
 while (remaining > 0);
  messageLength=((buffer[0] & 0xff) << 24) | ((buffer[1] & 0xff) << 16) | ((buffer[2] & 0xff) << 8)| (buffer[3] & 0xff);
  offset=0;
  remaining=messageLength;
  do {
    countRead=is.read(buffer,offset,remaining);
    if (countRead < 0) {
      Log.e(LOG_TAG,"Hit EOS reading message.  messageLength=" + messageLength + " remaining="+ remaining);
      return -1;
    }
    offset+=countRead;
    remaining-=countRead;
  }
 while (remaining > 0);
  return messageLength;
}
