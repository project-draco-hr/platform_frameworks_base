{
  if (mWin == null)   return vis;
  if (mTransientBarState == TRANSIENT_BAR_SHOWING) {
    if (allowed) {
      vis|=mTransientFlag;
      if ((oldVis & mTransientFlag) == 0) {
        vis|=mUnhideFlag;
      }
    }
 else {
      setTransientBarState(TRANSIENT_BAR_NONE);
    }
  }
  if (mTransientBarState != TRANSIENT_BAR_NONE) {
    vis|=mTransientFlag;
    vis&=~View.SYSTEM_UI_FLAG_LOW_PROFILE;
  }
  if ((vis & mTransparentFlag) != 0 || (oldVis & mTransparentFlag) != 0) {
    mLastTransparent=SystemClock.uptimeMillis();
  }
  return vis;
}
