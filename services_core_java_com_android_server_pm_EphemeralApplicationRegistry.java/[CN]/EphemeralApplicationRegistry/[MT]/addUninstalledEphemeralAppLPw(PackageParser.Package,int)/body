{
  EphemeralApplicationInfo uninstalledApp=createEphemeralAppInfoForPackage(pkg,userId);
  if (uninstalledApp == null) {
    return;
  }
  if (mUninstalledEphemeralApps == null) {
    mUninstalledEphemeralApps=new SparseArray<>();
  }
  List<UninstalledEphemeralAppState> uninstalledAppStates=mUninstalledEphemeralApps.get(userId);
  if (uninstalledAppStates == null) {
    uninstalledAppStates=new ArrayList<>();
    mUninstalledEphemeralApps.put(userId,uninstalledAppStates);
  }
  UninstalledEphemeralAppState uninstalledAppState=new UninstalledEphemeralAppState(uninstalledApp,System.currentTimeMillis());
  uninstalledAppStates.add(uninstalledAppState);
  writeUninstalledEphemeralAppMetadata(uninstalledApp,userId);
  writeEphemeralApplicationIconLPw(pkg,userId);
}
