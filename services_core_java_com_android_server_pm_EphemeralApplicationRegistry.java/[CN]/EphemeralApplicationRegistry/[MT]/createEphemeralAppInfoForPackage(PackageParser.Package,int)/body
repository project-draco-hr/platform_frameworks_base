{
  PackageSetting ps=(PackageSetting)pkg.mExtras;
  if (ps == null) {
    return null;
  }
  PackageUserState userState=ps.readUserState(userId);
  if (userState == null || !userState.installed || userState.hidden) {
    return null;
  }
  String[] requestedPermissions=new String[pkg.requestedPermissions.size()];
  pkg.requestedPermissions.toArray(requestedPermissions);
  Set<String> permissions=ps.getPermissionsState().getPermissions(userId);
  String[] grantedPermissions=new String[permissions.size()];
  permissions.toArray(grantedPermissions);
  return new EphemeralApplicationInfo(pkg.applicationInfo,requestedPermissions,grantedPermissions);
}
