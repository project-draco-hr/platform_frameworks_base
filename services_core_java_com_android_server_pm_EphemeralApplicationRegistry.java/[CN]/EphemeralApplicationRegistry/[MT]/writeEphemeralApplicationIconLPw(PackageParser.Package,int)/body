{
  File appDir=getEphemeralApplicationDir(pkg.packageName,userId);
  if (!appDir.exists()) {
    return;
  }
  Drawable icon=pkg.applicationInfo.loadIcon(mService.mContext.getPackageManager());
  final Bitmap bitmap;
  if (icon instanceof BitmapDrawable) {
    bitmap=((BitmapDrawable)icon).getBitmap();
  }
 else {
    bitmap=Bitmap.createBitmap(icon.getIntrinsicWidth(),icon.getIntrinsicHeight(),Bitmap.Config.ARGB_8888);
    Canvas canvas=new Canvas(bitmap);
    icon.draw(canvas);
  }
  File iconFile=new File(getEphemeralApplicationDir(pkg.packageName,userId),EPHEMERAL_APP_ICON_FILE);
  try (FileOutputStream out=new FileOutputStream(iconFile)){
    bitmap.compress(Bitmap.CompressFormat.PNG,100,out);
  }
 catch (  Exception e) {
    Slog.e(LOG_TAG,"Error writing ephemeral app icon",e);
  }
}
