{
synchronized (this) {
    if (mService == null) {
      Slog.w(TAG,"MmsService not connected. Try connecting...");
      mConnectionHandler.sendMessage(mConnectionHandler.obtainMessage(MSG_TRY_CONNECTING));
      final long shouldEnd=SystemClock.elapsedRealtime() + SERVICE_CONNECTION_WAIT_TIME_MS;
      long waitTime=SERVICE_CONNECTION_WAIT_TIME_MS;
      while (waitTime > 0) {
        try {
          this.wait(waitTime);
        }
 catch (        InterruptedException e) {
          Slog.w(TAG,"Connection wait interrupted",e);
        }
        if (mService != null) {
          return;
        }
        waitTime=shouldEnd - SystemClock.elapsedRealtime();
      }
      Slog.e(TAG,"Can not connect to MmsService (timed out)");
      throw new RuntimeException("Timed out in connecting to MmsService");
    }
  }
}
