{
synchronized (mLock) {
    if (mConfigSource != null) {
      return mConfigSource;
    }
    int targetSdkVersion=mInfo.targetSdkVersion;
    int configResourceId=0;
    if (mInfo != null) {
      configResourceId=mInfo.networkSecurityConfigRes;
    }
    ConfigSource source;
    if (configResourceId != 0) {
      boolean debugBuild=(mInfo.flags & ApplicationInfo.FLAG_DEBUGGABLE) != 0;
      if (DBG) {
        Log.d(LOG_TAG,"Using Network Security Config from resource " + mContext.getResources().getResourceEntryName(configResourceId) + " debugBuild: "+ debugBuild);
      }
      source=new XmlConfigSource(mContext,configResourceId,debugBuild,targetSdkVersion);
    }
 else {
      if (DBG) {
        Log.d(LOG_TAG,"No Network Security Config specified, using platform default");
      }
      boolean usesCleartextTraffic=(mInfo.flags & ApplicationInfo.FLAG_USES_CLEARTEXT_TRAFFIC) != 0;
      source=new DefaultConfigSource(usesCleartextTraffic,targetSdkVersion);
    }
    mConfigSource=source;
    return mConfigSource;
  }
}
