{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    ensureUidStatsLoadedLocked();
    final long packed=packUidAndTag(uid,tag);
    final NetworkStatsHistory combined=new NetworkStatsHistory(mSettings.getUidBucketDuration(),estimateUidBuckets());
    for (    NetworkIdentitySet ident : mUidStats.keySet()) {
      if (templateMatches(template,ident)) {
        final NetworkStatsHistory history=mUidStats.get(ident).get(packed);
        if (history != null) {
          combined.recordEntireHistory(history);
        }
      }
    }
    return combined;
  }
}
