{
  mContext.enforceCallingOrSelfPermission(DUMP,TAG);
  final HashSet<String> argSet=new HashSet<String>();
  for (  String arg : args) {
    argSet.add(arg);
  }
  final boolean fullHistory=argSet.contains("full");
synchronized (mStatsLock) {
    if (argSet.contains("generate")) {
      generateRandomLocked();
      pw.println("Generated stub stats");
      return;
    }
    if (argSet.contains("poll")) {
      performPollLocked(true,true);
      pw.println("Forced poll");
      return;
    }
    pw.println("Active interfaces:");
    for (    String iface : mActiveIfaces.keySet()) {
      final NetworkIdentitySet ident=mActiveIfaces.get(iface);
      pw.print("  iface=");
      pw.print(iface);
      pw.print(" ident=");
      pw.println(ident.toString());
    }
    pw.println("Known historical stats:");
    for (    NetworkIdentitySet ident : mNetworkStats.keySet()) {
      final NetworkStatsHistory history=mNetworkStats.get(ident);
      pw.print("  ident=");
      pw.println(ident.toString());
      history.dump("  ",pw,fullHistory);
    }
    if (argSet.contains("detail")) {
      ensureUidStatsLoadedLocked();
      pw.println("Detailed UID stats:");
      for (      NetworkIdentitySet ident : mUidStats.keySet()) {
        pw.print("  ident=");
        pw.println(ident.toString());
        final LongSparseArray<NetworkStatsHistory> uidStats=mUidStats.get(ident);
        for (int i=0; i < uidStats.size(); i++) {
          final long packed=uidStats.keyAt(i);
          final int uid=unpackUid(packed);
          final int tag=unpackTag(packed);
          final NetworkStatsHistory history=uidStats.valueAt(i);
          pw.print("    UID=");
          pw.print(uid);
          pw.print(" tag=0x");
          pw.println(Integer.toHexString(tag));
          history.dump("    ",pw,fullHistory);
        }
      }
    }
  }
}
