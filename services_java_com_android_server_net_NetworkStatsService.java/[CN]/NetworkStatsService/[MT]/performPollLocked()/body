{
  if (LOGD)   Slog.v(TAG,"performPollLocked()");
  if (mTime.getCacheAge() > TIME_CACHE_MAX_AGE) {
    mTime.forceRefresh();
  }
  final long currentTime=mTime.hasCache() ? mTime.currentTimeMillis() : System.currentTimeMillis();
  final NetworkStats summary;
  final NetworkStats detail;
  try {
    summary=mNetworkManager.getNetworkStatsSummary();
    detail=mNetworkManager.getNetworkStatsDetail();
  }
 catch (  RemoteException e) {
    Slog.w(TAG,"problem reading network stats");
    return;
  }
  performSummaryPollLocked(summary,currentTime);
  performDetailPollLocked(detail,currentTime);
  final NetworkStats persistDelta=computeStatsDelta(mLastSummaryPersist,summary);
  final long persistThreshold=mPersistThreshold.get();
  for (  String iface : persistDelta.getUniqueIfaces()) {
    final int index=persistDelta.findIndex(iface,UID_ALL);
    if (persistDelta.rx[index] > persistThreshold || persistDelta.tx[index] > persistThreshold) {
      writeStatsLocked();
      mLastSummaryPersist=summary;
      break;
    }
  }
}
