{
  if (LOGV)   Slog.v(TAG,"writeUidStatsLocked()");
  FileOutputStream fos=null;
  try {
    fos=mUidFile.startWrite();
    final DataOutputStream out=new DataOutputStream(fos);
    out.writeInt(FILE_MAGIC);
    out.writeInt(VERSION_CURRENT);
    final int size=mUidStats.size();
    out.writeInt(size);
    for (int i=0; i < size; i++) {
      final int uid=mUidStats.keyAt(i);
      final NetworkStatsHistory history=mUidStats.valueAt(i);
      out.writeInt(uid);
      history.writeToStream(out);
    }
    mUidFile.finishWrite(fos);
  }
 catch (  IOException e) {
    if (fos != null) {
      mUidFile.failWrite(fos);
    }
  }
}
