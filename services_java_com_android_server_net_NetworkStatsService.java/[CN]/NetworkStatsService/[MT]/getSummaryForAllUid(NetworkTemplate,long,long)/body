{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    ensureUidStatsLoadedLocked();
    final NetworkStats stats=new NetworkStats(end - start,24);
    long[] total=new long[2];
    for (    NetworkIdentitySet ident : mUidStats.keySet()) {
      if (templateMatches(template,ident)) {
        final SparseArray<NetworkStatsHistory> uidStats=mUidStats.get(ident);
        for (int i=0; i < uidStats.size(); i++) {
          final int uid=uidStats.keyAt(i);
          final NetworkStatsHistory history=uidStats.valueAt(i);
          total=history.getTotalData(start,end,total);
          stats.combineEntry(IFACE_ALL,uid,TAG_NONE,total[0],total[1]);
        }
      }
    }
    return stats;
  }
}
