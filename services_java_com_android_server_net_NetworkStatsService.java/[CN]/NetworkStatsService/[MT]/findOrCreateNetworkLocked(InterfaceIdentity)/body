{
  final long bucketDuration=mSettings.getNetworkBucketDuration();
  final NetworkStatsHistory existing=mNetworkStats.get(ident);
  NetworkStatsHistory updated=null;
  if (existing == null) {
    updated=new NetworkStatsHistory(bucketDuration);
  }
 else   if (existing.bucketDuration != bucketDuration) {
    updated=new NetworkStatsHistory(bucketDuration);
    updated.recordEntireHistory(existing);
  }
  if (updated != null) {
    mNetworkStats.put(ident,updated);
    return updated;
  }
 else {
    return existing;
  }
}
