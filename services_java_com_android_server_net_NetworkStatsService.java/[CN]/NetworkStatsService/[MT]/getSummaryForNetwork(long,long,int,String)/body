{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    long rx=0;
    long tx=0;
    long[] networkTotal=new long[2];
    for (    InterfaceIdentity ident : mNetworkStats.keySet()) {
      final NetworkStatsHistory history=mNetworkStats.get(ident);
      if (ident.matchesTemplate(networkTemplate,subscriberId)) {
        networkTotal=history.getTotalData(start,end,networkTotal);
        rx+=networkTotal[0];
        tx+=networkTotal[1];
      }
    }
    final NetworkStats stats=new NetworkStats(end - start,1);
    stats.addEntry(IFACE_ALL,UID_ALL,tx,tx);
    return stats;
  }
}
