{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    long rx=0;
    long tx=0;
    long[] networkTotal=new long[2];
    for (    NetworkIdentitySet ident : mNetworkStats.keySet()) {
      if (templateMatches(template,ident)) {
        final NetworkStatsHistory history=mNetworkStats.get(ident);
        networkTotal=history.getTotalData(start,end,networkTotal);
        rx+=networkTotal[0];
        tx+=networkTotal[1];
      }
    }
    final NetworkStats stats=new NetworkStats(end - start,1);
    stats.addEntry(IFACE_ALL,UID_ALL,TAG_NONE,rx,tx);
    return stats;
  }
}
