{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    final NetworkStats stats=new NetworkStats(end - start,1);
    final NetworkStats.Entry entry=new NetworkStats.Entry();
    long[] total=new long[2];
    for (    NetworkIdentitySet ident : mNetworkStats.keySet()) {
      if (templateMatches(template,ident)) {
        final NetworkStatsHistory history=mNetworkStats.get(ident);
        total=history.getTotalData(start,end,total);
        entry.iface=IFACE_ALL;
        entry.uid=UID_ALL;
        entry.tag=TAG_NONE;
        entry.rxBytes=total[0];
        entry.txBytes=total[1];
        stats.combineValues(entry);
      }
    }
    return stats;
  }
}
