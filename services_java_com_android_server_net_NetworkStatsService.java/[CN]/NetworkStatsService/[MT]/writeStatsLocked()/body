{
  if (LOGD)   Slog.v(TAG,"writeStatsLocked()");
  FileOutputStream fos=null;
  try {
    fos=mSummaryFile.startWrite();
    final DataOutputStream out=new DataOutputStream(fos);
    out.writeInt(FILE_MAGIC);
    out.writeInt(VERSION_CURRENT);
    out.writeInt(mSummaryStats.size());
    for (    InterfaceIdentity ident : mSummaryStats.keySet()) {
      final NetworkStatsHistory history=mSummaryStats.get(ident);
      ident.writeToStream(out);
      history.writeToStream(out);
    }
    mSummaryFile.finishWrite(fos);
  }
 catch (  IOException e) {
    if (fos != null) {
      mSummaryFile.failWrite(fos);
    }
  }
}
