{
  final long largestBucketSize=Math.max(mSettings.getNetworkBucketDuration(),mSettings.getUidBucketDuration());
  final long now=mTime.hasCache() ? mTime.currentTimeMillis() : System.currentTimeMillis();
  final long end=now - (now % largestBucketSize) + largestBucketSize;
  final long start=end - largestBucketSize;
  NetworkTemplate template=null;
  NetworkStats.Entry ifaceTotal=null;
  NetworkStats.Entry uidTotal=null;
  template=buildTemplateMobileAll(getActiveSubscriberId(mContext));
  ifaceTotal=getSummaryForNetwork(template,start,end).getTotal(ifaceTotal);
  uidTotal=getSummaryForAllUid(template,start,end,false).getTotal(uidTotal);
  EventLogTags.writeNetstatsMobileSample(ifaceTotal.rxBytes,ifaceTotal.rxPackets,ifaceTotal.txBytes,ifaceTotal.txPackets,uidTotal.rxBytes,uidTotal.rxPackets,uidTotal.txBytes,uidTotal.txPackets);
  template=buildTemplateWifi();
  ifaceTotal=getSummaryForNetwork(template,start,end).getTotal(ifaceTotal);
  uidTotal=getSummaryForAllUid(template,start,end,false).getTotal(uidTotal);
  EventLogTags.writeNetstatsWifiSample(ifaceTotal.rxBytes,ifaceTotal.rxPackets,ifaceTotal.txBytes,ifaceTotal.txPackets,uidTotal.rxBytes,uidTotal.rxPackets,uidTotal.txBytes,uidTotal.txPackets);
}
