{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    final int size=mDetailStats.size();
    final NetworkStats.Builder stats=new NetworkStats.Builder(end - start,size);
    long[] total=new long[2];
    for (int i=0; i < size; i++) {
      final int uid=mDetailStats.keyAt(i);
      final NetworkStatsHistory history=mDetailStats.valueAt(i);
      total=history.getTotalData(start,end,total);
      stats.addEntry(IFACE_ALL,uid,total[0],total[1]);
    }
    return stats.build();
  }
}
