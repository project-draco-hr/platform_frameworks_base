{
  ensureUidStatsLoadedLocked();
  final NetworkStats delta=computeStatsDelta(mLastUidPoll,uidStats);
  final long timeStart=currentTime - delta.elapsedRealtime;
  final long maxHistory=mSettings.getUidMaxHistory();
  for (  int uid : delta.getUniqueUids()) {
    final int index=delta.findIndex(IFACE_ALL,uid);
    if (index != -1) {
      final long rx=delta.rx[index];
      final long tx=delta.tx[index];
      final NetworkStatsHistory history=findOrCreateUidLocked(uid);
      history.recordData(timeStart,currentTime,rx,tx);
      history.removeBucketsBefore(currentTime - maxHistory);
    }
  }
  mLastUidPoll=uidStats;
}
