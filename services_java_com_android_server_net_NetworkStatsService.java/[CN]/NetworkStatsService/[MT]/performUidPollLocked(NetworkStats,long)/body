{
  ensureUidStatsLoadedLocked();
  final NetworkStats delta=computeStatsDelta(mLastUidPoll,uidStats);
  final long timeStart=currentTime - delta.elapsedRealtime;
  final long maxHistory=mSettings.getUidMaxHistory();
  for (int i=0; i < delta.size; i++) {
    final String iface=delta.iface[i];
    final NetworkIdentitySet ident=mActiveIfaces.get(iface);
    if (ident == null) {
      continue;
    }
    final int uid=delta.uid[i];
    final long rx=delta.rx[i];
    final long tx=delta.tx[i];
    final NetworkStatsHistory history=findOrCreateUidStatsLocked(ident,uid);
    history.recordData(timeStart,currentTime,rx,tx);
    history.removeBucketsBefore(currentTime - maxHistory);
  }
  mLastUidPoll=uidStats;
}
