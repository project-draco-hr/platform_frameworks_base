{
  mContext.enforceCallingOrSelfPermission(UPDATE_DEVICE_STATS,TAG);
synchronized (mStatsLock) {
    final int size=mDetailStats.size();
    final NetworkStats.Builder stats=new NetworkStats.Builder(end - start,size);
    final long[] total=new long[2];
    for (int i=0; i < size; i++) {
      final int uid=mDetailStats.keyAt(i);
      final NetworkStatsHistory history=mDetailStats.valueAt(i);
      history.getTotalData(start,end,total);
      stats.addEntry(IFACE_ALL,uid,total[0],total[1]);
    }
    return stats.build();
  }
}
