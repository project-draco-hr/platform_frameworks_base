{
  mContext.enforceCallingOrSelfPermission(READ_NETWORK_USAGE_HISTORY,TAG);
synchronized (mStatsLock) {
    final String subscriberId=getActiveSubscriberId();
    final NetworkStatsHistory combined=new NetworkStatsHistory(mSettings.getNetworkBucketDuration(),estimateNetworkBuckets());
    for (    InterfaceIdentity ident : mNetworkStats.keySet()) {
      final NetworkStatsHistory history=mNetworkStats.get(ident);
      if (ident.matchesTemplate(networkTemplate,subscriberId)) {
        combined.recordEntireHistory(history);
      }
    }
    return combined;
  }
}
