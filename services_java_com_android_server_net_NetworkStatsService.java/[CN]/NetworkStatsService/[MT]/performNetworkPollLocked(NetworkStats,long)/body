{
  final HashSet<String> unknownIface=Sets.newHashSet();
  final NetworkStats delta=computeStatsDelta(mLastNetworkSnapshot,networkSnapshot);
  final long timeStart=currentTime - delta.getElapsedRealtime();
  NetworkStats.Entry entry=null;
  for (int i=0; i < delta.size(); i++) {
    entry=delta.getValues(i,entry);
    final NetworkIdentitySet ident=mActiveIfaces.get(entry.iface);
    if (ident == null) {
      unknownIface.add(entry.iface);
      continue;
    }
    final NetworkStatsHistory history=findOrCreateNetworkStatsLocked(ident);
    history.recordData(timeStart,currentTime,entry.rxBytes,entry.txBytes);
  }
  final long maxHistory=mSettings.getNetworkMaxHistory();
  for (  NetworkStatsHistory history : mNetworkStats.values()) {
    history.removeBucketsBefore(currentTime - maxHistory);
  }
  mLastNetworkSnapshot=networkSnapshot;
  if (LOGD && unknownIface.size() > 0) {
    Slog.w(TAG,"unknown interfaces " + unknownIface.toString() + ", ignoring those stats");
  }
}
