{
  final ArrayList<String> unknownIface=Lists.newArrayList();
  final NetworkStats delta=computeStatsDelta(mLastNetworkPoll,networkStats);
  final long timeStart=currentTime - delta.elapsedRealtime;
  final long maxHistory=mSettings.getNetworkMaxHistory();
  for (  String iface : delta.getUniqueIfaces()) {
    final InterfaceIdentity ident=mActiveIface.get(iface);
    if (ident == null) {
      unknownIface.add(iface);
      continue;
    }
    final int index=delta.findIndex(iface,UID_ALL);
    final long rx=delta.rx[index];
    final long tx=delta.tx[index];
    final NetworkStatsHistory history=findOrCreateNetworkLocked(ident);
    history.recordData(timeStart,currentTime,rx,tx);
    history.removeBucketsBefore(currentTime - maxHistory);
  }
  mLastNetworkPoll=networkStats;
  if (LOGD && unknownIface.size() > 0) {
    Slog.w(TAG,"unknown interfaces " + unknownIface.toString() + ", ignoring those stats");
  }
}
