{
  final HashSet<String> unknownIface=Sets.newHashSet();
  final NetworkStats delta=computeStatsDelta(mLastNetworkSnapshot,networkSnapshot);
  final long timeStart=currentTime - delta.elapsedRealtime;
  for (int i=0; i < delta.size; i++) {
    final String iface=delta.iface[i];
    final NetworkIdentitySet ident=mActiveIfaces.get(iface);
    if (ident == null) {
      unknownIface.add(iface);
      continue;
    }
    final long rx=delta.rx[i];
    final long tx=delta.tx[i];
    final NetworkStatsHistory history=findOrCreateNetworkStatsLocked(ident);
    history.recordData(timeStart,currentTime,rx,tx);
  }
  final long maxHistory=mSettings.getNetworkMaxHistory();
  for (  NetworkStatsHistory history : mNetworkStats.values()) {
    history.removeBucketsBefore(currentTime - maxHistory);
  }
  mLastNetworkSnapshot=networkSnapshot;
  if (LOGD && unknownIface.size() > 0) {
    Slog.w(TAG,"unknown interfaces " + unknownIface.toString() + ", ignoring those stats");
  }
}
