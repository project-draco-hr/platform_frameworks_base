{
  super(TAG);
  mContext=context;
  mConnService=cs;
  IntentFilter filter=new IntentFilter();
  filter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);
  mContext.registerReceiver(mReceiver,filter);
  mServer=Settings.Secure.getString(mContext.getContentResolver(),Settings.Secure.CAPTIVE_PORTAL_SERVER);
  if (mServer == null)   mServer=DEFAULT_SERVER;
  mIsCaptivePortalCheckEnabled=Settings.Secure.getInt(mContext.getContentResolver(),Settings.Secure.CAPTIVE_PORTAL_DETECTION_ENABLED,1) == 1;
  addState(mDefaultState);
  addState(mNoActiveNetworkState,mDefaultState);
  addState(mActiveNetworkState,mDefaultState);
  addState(mDelayedCaptiveCheckState,mActiveNetworkState);
  setInitialState(mNoActiveNetworkState);
}
