{
  super(TAG);
  mContext=context;
  mConnService=cs;
  mTelephonyManager=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  mProvisioningObserver=new ProvisioningObserver();
  IntentFilter filter=new IntentFilter();
  filter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);
  filter.addAction(ConnectivityManager.CONNECTIVITY_ACTION_IMMEDIATE);
  mContext.registerReceiver(mReceiver,filter);
  mServer=Settings.Global.getString(mContext.getContentResolver(),Settings.Global.CAPTIVE_PORTAL_SERVER);
  if (mServer == null)   mServer=DEFAULT_SERVER;
  mIsCaptivePortalCheckEnabled=Settings.Global.getInt(mContext.getContentResolver(),Settings.Global.CAPTIVE_PORTAL_DETECTION_ENABLED,1) == 1;
  addState(mDefaultState);
  addState(mNoActiveNetworkState,mDefaultState);
  addState(mActiveNetworkState,mDefaultState);
  addState(mDelayedCaptiveCheckState,mActiveNetworkState);
  setInitialState(mNoActiveNetworkState);
}
