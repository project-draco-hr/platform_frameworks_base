{
  mContext=context;
  mNetworkInfo=info;
  mConnService=cs;
  HandlerThread handlerThread=new HandlerThread("CaptivePortalThread");
  handlerThread.start();
  mHandler=new InternalHandler(handlerThread.getLooper());
  mHandler.obtainMessage(DETECT_PORTAL).sendToTarget();
  IntentFilter filter=new IntentFilter();
  filter.addAction(ACTION_SWITCH_TO_CAPTIVE_PORTAL);
  filter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);
  mContext.registerReceiver(mReceiver,filter);
  mServer=Settings.Secure.getString(mContext.getContentResolver(),Settings.Secure.CAPTIVE_PORTAL_SERVER);
  if (mServer == null)   mServer=DEFAULT_SERVER;
  mIsCaptivePortalCheckEnabled=Settings.Secure.getInt(mContext.getContentResolver(),Settings.Secure.CAPTIVE_PORTAL_DETECTION_ENABLED,1) == 1;
}
