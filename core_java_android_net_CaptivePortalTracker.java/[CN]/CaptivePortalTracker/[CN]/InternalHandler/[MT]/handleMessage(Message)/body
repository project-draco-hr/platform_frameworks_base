{
switch (msg.what) {
case DETECT_PORTAL:
    InetAddress server=lookupHost(mServer);
  if (server != null) {
    requestRouteToHost(server);
    if (isCaptivePortal(server)) {
      if (DBG)       log("Captive portal " + mNetworkInfo);
      setNotificationVisible(true);
      mIsCaptivePortal=true;
      break;
    }
  }
notifyPortalCheckComplete();
quit();
break;
case HANDLE_CONNECT:
NetworkInfo info=(NetworkInfo)msg.obj;
if (info.getType() != mNetworkInfo.getType()) break;
if (info.getState() == NetworkInfo.State.CONNECTED || info.getState() == NetworkInfo.State.DISCONNECTED) {
setNotificationVisible(false);
}
if (info.getState() == NetworkInfo.State.CONNECTED && mIsCaptivePortal) {
launchBrowser();
quit();
}
break;
default :
loge("Unhandled message " + msg);
break;
}
}
