{
  HttpURLConnection urlConnection=null;
  if (!mIsCaptivePortalCheckEnabled)   return false;
  mUrl="http://" + server.getHostAddress() + "/generate_204";
  if (DBG)   log("Checking " + mUrl);
  try {
    URL url=new URL(mUrl);
    urlConnection=(HttpURLConnection)url.openConnection();
    urlConnection.setInstanceFollowRedirects(false);
    urlConnection.setConnectTimeout(SOCKET_TIMEOUT_MS);
    urlConnection.setReadTimeout(SOCKET_TIMEOUT_MS);
    urlConnection.setUseCaches(false);
    urlConnection.getInputStream();
    return urlConnection.getResponseCode() != 204;
  }
 catch (  IOException e) {
    if (DBG)     log("Probably not a portal: exception " + e);
    return false;
  }
 finally {
    if (urlConnection != null) {
      urlConnection.disconnect();
    }
  }
}
