{
synchronized (this) {
    int index=findViewLocked(view,true);
    ViewRootImpl root=mRoots[index];
    View curView=root.getView();
    root.mAddNesting=0;
    if (view != null) {
      InputMethodManager imm=InputMethodManager.getInstance(view.getContext());
      if (imm != null) {
        imm.windowDismissed(mViews[index].getWindowToken());
      }
    }
    root.die(true);
    finishRemoveViewLocked(curView,index);
    if (curView == view) {
      return;
    }
    throw new IllegalStateException("Calling with view " + view + " but the ViewAncestor is attached to "+ curView);
  }
}
