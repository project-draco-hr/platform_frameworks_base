{
  final Iterator<Transition> it=mTransitions.iterator();
  while (it.hasNext()) {
    final Transition t=it.next();
    if (t.getAfterMediaItem() == transition.getAfterMediaItem() || t.getBeforeMediaItem() == transition.getBeforeMediaItem()) {
      it.remove();
      t.invalidate();
      break;
    }
  }
  mTransitions.add(transition);
  final MediaItem afterMediaItem=transition.getAfterMediaItem();
  if (afterMediaItem != null) {
    afterMediaItem.setEndTransition(transition);
  }
  final MediaItem beforeMediaItem=transition.getBeforeMediaItem();
  if (beforeMediaItem != null) {
    beforeMediaItem.setBeginTransition(transition);
  }
  computeTimelineDuration();
}
