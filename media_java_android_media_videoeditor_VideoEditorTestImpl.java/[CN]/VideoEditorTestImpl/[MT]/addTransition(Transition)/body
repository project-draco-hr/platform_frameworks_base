{
  mTransitions.add(transition);
  final MediaItem beforeMediaItem=transition.getBeforeMediaItem();
  final MediaItem afterMediaItem=transition.getAfterMediaItem();
  if (afterMediaItem != null) {
    if (afterMediaItem.getEndTransition() != null) {
      afterMediaItem.getEndTransition().invalidate();
    }
    afterMediaItem.setEndTransition(transition);
  }
  if (beforeMediaItem != null) {
    if (beforeMediaItem.getBeginTransition() != null) {
      beforeMediaItem.getBeginTransition().invalidate();
    }
    beforeMediaItem.setBeginTransition(transition);
  }
  computeTimelineDuration();
}
