{
  if (count > buffer.length - offset || count < 0 || offset < 0) {
    throw new IndexOutOfBoundsException();
  }
  if (count == 0) {
    return 0;
  }
  if (pos >= length) {
    return -1;
  }
  if (count + pos > length) {
    count=(int)(length - pos);
  }
  byte[] block=blocks.get((int)(pos >> BLOCK_SHIFT));
  int nbytes=Math.min(count,BLOCK_SIZE - (int)(pos & BLOCK_MASK));
  System.arraycopy(block,(int)(pos & BLOCK_MASK),buffer,offset,nbytes);
  return nbytes;
}
