{
  if (count > buffer.length - offset || count < 0 || offset < 0) {
    throw new IndexOutOfBoundsException();
  }
  if (count == 0) {
    return;
  }
  long lastPos=pos + count - 1;
  if (lastPos >= length) {
    grow(lastPos);
  }
  while (count > 0) {
    byte[] block=blocks.get((int)(pos >> BLOCK_SHIFT));
    int blockOffset=(int)(pos & BLOCK_MASK);
    int toCopy=Math.min(BLOCK_SIZE - blockOffset,count);
    System.arraycopy(buffer,offset,block,blockOffset,toCopy);
    pos+=toCopy;
    count-=toCopy;
    offset+=toCopy;
  }
}
