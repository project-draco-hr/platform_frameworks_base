{
  FileOutputStream of=new FileOutputStream(cache);
  BufferedOutputStream bout=new BufferedOutputStream(of,32 * 1024);
  DataOutputStream out=new DataOutputStream(bout);
  out.writeInt(ANCESTRAL_RECORD_VERSION);
  out.writeInt(mStoredSdkVersion);
  out.writeUTF(mStoredIncrementalVersion);
  out.writeInt(mRestoredSignatures.size());
  if (mRestoredSignatures.size() > 0) {
    Set<Entry<String,Metadata>> entries=mRestoredSignatures.entrySet();
    for (    Entry<String,Metadata> i : entries) {
      final Metadata m=i.getValue();
      final int nHashes=(m.sigHashes != null) ? m.sigHashes.size() : 0;
      out.writeUTF(i.getKey());
      out.writeInt(m.versionCode);
      out.writeInt(nHashes);
      for (int h=0; h < nHashes; h++) {
        byte[] hash=m.sigHashes.get(h);
        out.writeInt(hash.length);
        if (hash.length > 0) {
          out.write(hash);
        }
      }
    }
  }
  out.flush();
  IoUtils.closeQuietly(out);
}
