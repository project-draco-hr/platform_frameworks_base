{
  LayoutTestsAutoRunner runner=(LayoutTestsAutoRunner)getInstrumentation();
  if (runner.mPageCyclerSuite != null) {
    if (runner.mPageCyclerForwardHost == null) {
      throw new RuntimeException("no forwarder information provided");
    }
    runner.mTestPath=setUpForwarding(runner.mPageCyclerForwardHost,runner.mPageCyclerSuite,runner.mPageCyclerIteration);
    Log.d(LOGTAG,"using path: " + runner.mTestPath);
  }
  if (runner.mTestPath == null) {
    throw new RuntimeException("No test specified");
  }
  final TestShellActivity activity=(TestShellActivity)getActivity();
  Log.v(LOGTAG,"About to run tests, calling gc first...");
  freeMem();
  runTestAndWaitUntilDone(activity,runner.mTestPath,runner.mTimeoutInMillis,runner.mGetDrawTime,runner.mSaveImagePath);
  getInstrumentation().runOnMainSync(new Runnable(){
    @Override public void run(){
      activity.clearCache();
    }
  }
);
  if (mForwardServer != null) {
    mForwardServer.stop();
    mForwardServer=null;
  }
  try {
    Thread.sleep(5000);
  }
 catch (  InterruptedException e) {
  }
  dumpMemoryInfo();
  activity.finish();
}
