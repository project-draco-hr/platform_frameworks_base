{
  activity.setCallback(new TestShellCallback(){
    @Override public void finished(){
synchronized (LoadTestsAutoTest.this) {
        mFinished=true;
        LoadTestsAutoTest.this.notifyAll();
      }
    }
    @Override public void timedOut(    String url){
    }
    @Override public void dumpResult(    String webViewDump){
      String lines[]=webViewDump.split("\\r?\\n");
      for (      String line : lines) {
        line=line.trim();
        if (line.startsWith("totals:")) {
          line=line.substring(7).trim();
          String[] numbers=line.split("\\s+");
          if (numbers.length == 4) {
            Bundle b=new Bundle();
            b.putString("mean",numbers[2]);
            getInstrumentation().sendStatus(Activity.RESULT_FIRST_USER,b);
          }
        }
      }
    }
  }
);
  mFinished=false;
  Intent intent=new Intent(Intent.ACTION_VIEW);
  intent.setClass(activity,TestShellActivity.class);
  intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
  intent.putExtra(TestShellActivity.TEST_URL,url);
  intent.putExtra(TestShellActivity.TIMEOUT_IN_MILLIS,timeout);
  intent.putExtra(TestShellActivity.RESULT_FILE,LOAD_TEST_RESULT);
  activity.startActivity(intent);
synchronized (this) {
    while (!mFinished) {
      try {
        this.wait();
      }
 catch (      InterruptedException e) {
      }
    }
  }
}
