{
  if (mLayer == null) {
    if (mAttachInfo == null || mAttachInfo.mHardwareRenderer == null) {
      return null;
    }
    mLayer=mAttachInfo.mHardwareRenderer.createHardwareLayer(mOpaque);
    if (!mUpdateSurface) {
      mSurface=mAttachInfo.mHardwareRenderer.createSurfaceTexture(mLayer);
    }
    nSetDefaultBufferSize(mSurface,getWidth(),getHeight());
    nCreateNativeWindow(mSurface);
    mUpdateListener=new SurfaceTexture.OnFrameAvailableListener(){
      @Override public void onFrameAvailable(      SurfaceTexture surfaceTexture){
synchronized (mLock) {
          mUpdateLayer=true;
        }
        postInvalidate();
      }
    }
;
    mSurface.setOnFrameAvailableListener(mUpdateListener);
    if (mListener != null && !mUpdateSurface) {
      mListener.onSurfaceTextureAvailable(mSurface,getWidth(),getHeight());
    }
  }
  if (mUpdateSurface) {
    mUpdateSurface=false;
    mAttachInfo.mHardwareRenderer.setSurfaceTexture(mLayer,mSurface);
    nSetDefaultBufferSize(mSurface,getWidth(),getHeight());
  }
  applyUpdate();
  applyTransformMatrix();
  return mLayer;
}
