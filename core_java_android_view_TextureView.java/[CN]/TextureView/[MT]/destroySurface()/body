{
  if (mLayer != null) {
    mLayer.detachSurfaceTexture(mSurface);
    boolean shouldRelease=true;
    if (mListener != null) {
      shouldRelease=mListener.onSurfaceTextureDestroyed(mSurface);
    }
synchronized (mNativeWindowLock) {
      nDestroyNativeWindow();
    }
    mLayer.destroy();
    if (shouldRelease)     mSurface.release();
    mSurface=null;
    mLayer=null;
    mHadSurface=true;
  }
}
