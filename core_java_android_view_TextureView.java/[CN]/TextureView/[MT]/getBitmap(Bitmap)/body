{
  if (bitmap != null && isAvailable()) {
    AttachInfo info=mAttachInfo;
    if (info != null && info.mHardwareRenderer != null && info.mHardwareRenderer.isEnabled()) {
      if (!info.mHardwareRenderer.validate()) {
        throw new IllegalStateException("Could not acquire hardware rendering context");
      }
    }
    applyUpdate();
    applyTransformMatrix();
    if (mLayer == null && mUpdateSurface) {
      getHardwareLayer();
    }
    if (mLayer != null) {
      mLayer.copyInto(bitmap);
    }
  }
  return bitmap;
}
