{
synchronized (mTasks) {
    int idleCount=0;
    int connectivityCount=0;
    List<TaskStatus> runnableTasks=new ArrayList<TaskStatus>();
    for (    TaskStatus ts : mTasks.getTasks()) {
      final boolean criteriaSatisfied=ts.isReady();
      final boolean isRunning=isCurrentlyActive(ts);
      if (criteriaSatisfied && !isRunning) {
        if (ts.hasIdleConstraint()) {
          idleCount++;
        }
        if (ts.hasConnectivityConstraint() || ts.hasMeteredConstraint()) {
          connectivityCount++;
        }
        runnableTasks.add(ts);
      }
 else       if (!criteriaSatisfied && isRunning) {
        cancelTaskOnServiceContext(ts);
      }
    }
    if (idleCount >= MIN_IDLE_COUNT || connectivityCount >= MIN_CONNECTIVITY_COUNT || runnableTasks.size() >= MIN_READY_TASKS_COUNT) {
      for (      TaskStatus ts : runnableTasks) {
synchronized (mPendingTasks) {
          mPendingTasks.add(ts);
        }
      }
    }
  }
}
