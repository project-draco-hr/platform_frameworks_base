{
  int ret;
  int contextLen=contextEnd - contextStart;
  if (contextEnd <= mGapStart) {
    ret=p.getTextRunCursor(mText,contextStart,contextLen,dir,offset,cursorOpt);
  }
 else   if (contextStart >= mGapStart) {
    ret=p.getTextRunCursor(mText,contextStart + mGapLength,contextLen,dir,offset + mGapLength,cursorOpt) - mGapLength;
  }
 else {
    char[] buf=TextUtils.obtain(contextLen);
    getChars(contextStart,contextEnd,buf,0);
    ret=p.getTextRunCursor(buf,0,contextLen,dir,offset - contextStart,cursorOpt) + contextStart;
    TextUtils.recycle(buf);
  }
  return ret;
}
