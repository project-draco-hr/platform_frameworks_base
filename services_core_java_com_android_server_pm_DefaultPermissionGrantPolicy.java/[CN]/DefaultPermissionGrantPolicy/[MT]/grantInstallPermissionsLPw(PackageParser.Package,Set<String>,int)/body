{
  List<String> requestedPermissions=pkg.requestedPermissions;
  if (pkg.isUpdatedSystemApp()) {
    PackageSetting sysPs=mService.mSettings.getDisabledSystemPkgLPr(pkg.packageName);
    if (sysPs != null) {
      requestedPermissions=sysPs.pkg.requestedPermissions;
    }
  }
  final int permissionCount=requestedPermissions.size();
  for (int i=0; i < permissionCount; i++) {
    String permission=requestedPermissions.get(i);
    if (permissions.contains(permission)) {
      final int flags=mService.getPermissionFlags(permission,pkg.packageName,userId);
      if (flags == 0) {
        mService.grantInstallPermissionLPw(permission,pkg);
        if (DEBUG) {
          Log.i(TAG,"Granted install " + permission + " to "+ pkg.packageName);
        }
      }
    }
  }
}
