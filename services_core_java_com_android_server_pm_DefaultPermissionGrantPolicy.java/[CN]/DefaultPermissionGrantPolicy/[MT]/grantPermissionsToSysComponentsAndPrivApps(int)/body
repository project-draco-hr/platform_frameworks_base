{
  Log.i(TAG,"Granting permissions to platform components for user " + userId);
synchronized (mService.mPackages) {
    for (    PackageParser.Package pkg : mService.mPackages.values()) {
      if (!isSysComponentOrPersistentPlatformSignedPrivAppLPr(pkg) || !doesPackageSupportRuntimePermissions(pkg) || pkg.requestedPermissions.isEmpty()) {
        continue;
      }
      Set<String> permissions=new ArraySet<>();
      final int permissionCount=pkg.requestedPermissions.size();
      for (int i=0; i < permissionCount; i++) {
        String permission=pkg.requestedPermissions.get(i);
        BasePermission bp=mService.mSettings.mPermissions.get(permission);
        if (bp != null && bp.isRuntime()) {
          permissions.add(permission);
        }
      }
      if (!permissions.isEmpty()) {
        grantRuntimePermissionsLPw(pkg,permissions,true,userId);
      }
    }
  }
}
