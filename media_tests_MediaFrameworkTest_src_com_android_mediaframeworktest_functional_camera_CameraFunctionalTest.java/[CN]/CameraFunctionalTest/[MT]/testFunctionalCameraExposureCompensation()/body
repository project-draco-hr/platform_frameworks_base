{
  try {
    SurfaceHolder surfaceHolder=MediaFrameworkTest.mSurfaceView.getHolder();
    Parameters params=mCameraTestHelper.getCameraParameters();
    int min=params.getMinExposureCompensation();
    int max=params.getMaxExposureCompensation();
    assertFalse("Adjusting exposure not supported",(max == 0 && min == 0));
    float step=params.getExposureCompensationStep();
    int stepsPerEV=(int)Math.round(Math.pow((double)step,-1));
    for (int i=min; i <= max; i+=stepsPerEV) {
      runOnLooper(new Runnable(){
        @Override public void run(){
          mCameraTestHelper.setupCameraTest();
        }
      }
);
      Log.v(TAG,"Setting exposure compensation index to " + i);
      params.setExposureCompensation(i);
      mCameraTestHelper.setParameters(params);
      mCameraTestHelper.startCameraPreview(surfaceHolder);
      mCameraTestHelper.capturePhoto();
    }
    mCameraTestHelper.cleanupTestImages();
  }
 catch (  Exception e) {
    Log.e(TAG,e.toString());
    fail("Camera exposure compensation test Exception");
  }
}
