{
  boolean success=false;
  DhcpResults dhcpResults=new DhcpResults();
  if (dhcpAction == DhcpAction.START) {
    NetworkUtils.stopDhcp(mInterfaceName);
    if (DBG)     Log.d(TAG,"DHCP request on " + mInterfaceName);
    success=NetworkUtils.runDhcp(mInterfaceName,dhcpResults);
  }
 else   if (dhcpAction == DhcpAction.RENEW) {
    if (DBG)     Log.d(TAG,"DHCP renewal on " + mInterfaceName);
    success=NetworkUtils.runDhcpRenew(mInterfaceName,dhcpResults);
    if (success)     dhcpResults.updateFromDhcpRequest(mDhcpResults);
  }
  if (success) {
    if (DBG)     Log.d(TAG,"DHCP succeeded on " + mInterfaceName);
    long leaseDuration=dhcpResults.leaseDuration;
    if (leaseDuration >= 0) {
      if (leaseDuration < MIN_RENEWAL_TIME_SECS) {
        leaseDuration=MIN_RENEWAL_TIME_SECS;
      }
      mAlarmManager.setExact(AlarmManager.ELAPSED_REALTIME_WAKEUP,SystemClock.elapsedRealtime() + leaseDuration * 480,mDhcpRenewalIntent);
    }
 else {
    }
    mDhcpResults=dhcpResults;
    mController.obtainMessage(CMD_POST_DHCP_ACTION,DHCP_SUCCESS,0,dhcpResults).sendToTarget();
  }
 else {
    Log.e(TAG,"DHCP failed on " + mInterfaceName + ": "+ NetworkUtils.getDhcpError());
    NetworkUtils.stopDhcp(mInterfaceName);
    mController.obtainMessage(CMD_POST_DHCP_ACTION,DHCP_FAILURE,0).sendToTarget();
  }
  return success;
}
