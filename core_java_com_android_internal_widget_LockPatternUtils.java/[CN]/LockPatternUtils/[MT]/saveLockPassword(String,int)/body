{
  final byte[] hash=passwordToHash(password);
  try {
    RandomAccessFile raf=new RandomAccessFile(sLockPasswordFilename,"rw");
    if (password == null) {
      raf.setLength(0);
    }
 else {
      raf.write(hash,0,hash.length);
    }
    raf.close();
    if (password != null) {
      int textMode=TextUtils.isDigitsOnly(password) ? MODE_PIN : MODE_PASSWORD;
      if (textMode > mode) {
        mode=textMode;
      }
      setLong(PASSWORD_TYPE_KEY,mode);
      DevicePolicyManager dpm=(DevicePolicyManager)mContext.getSystemService(Context.DEVICE_POLICY_SERVICE);
      dpm.setActivePasswordState(mode,password.length());
    }
  }
 catch (  FileNotFoundException fnfe) {
    Log.e(TAG,"Unable to save lock pattern to " + sLockPasswordFilename);
  }
catch (  IOException ioe) {
    Log.e(TAG,"Unable to save lock pattern to " + sLockPasswordFilename);
  }
}
