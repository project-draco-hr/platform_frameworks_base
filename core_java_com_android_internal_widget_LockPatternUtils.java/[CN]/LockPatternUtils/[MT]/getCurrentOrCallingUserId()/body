{
  int callingUid=Binder.getCallingUid();
  if (callingUid == android.os.Process.SYSTEM_UID) {
    return getCurrentUser();
  }
 else {
    return UserHandle.getUserId(callingUid);
  }
}
