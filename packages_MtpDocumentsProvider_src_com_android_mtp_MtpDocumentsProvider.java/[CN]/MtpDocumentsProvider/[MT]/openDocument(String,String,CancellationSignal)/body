{
  final Identifier identifier=mDatabase.createIdentifier(documentId);
  try {
    openDevice(identifier.mDeviceId);
switch (mode) {
case "r":
      final long fileSize=getFileSize(documentId);
    if (fileSize <= 0xffffffffl) {
      return mAppFuse.openFile(Integer.parseInt(documentId));
    }
 else {
      return getPipeManager(identifier).readDocument(mMtpManager,identifier);
    }
case "w":
  return getPipeManager(identifier).writeDocument(getContext(),mMtpManager,identifier);
case "rw":
throw new UnsupportedOperationException("The provider does not support 'rw' mode.");
default :
throw new IllegalArgumentException("Unknown mode for openDocument: " + mode);
}
}
 catch (IOException error) {
Log.e(MtpDocumentsProvider.TAG,"openDocument",error);
throw new FileNotFoundException(error.getMessage());
}
}
