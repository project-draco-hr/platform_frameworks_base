{
  if (DEBUG) {
    Log.d(TAG,"openDocument: " + documentId);
  }
  final Identifier identifier=mDatabase.createIdentifier(documentId);
  try {
    openDevice(identifier.mDeviceId);
    final MtpDeviceRecord device=getDeviceToolkit(identifier.mDeviceId).mDeviceRecord;
switch (mode) {
case "r":
      long fileSize;
    try {
      fileSize=getFileSize(documentId);
    }
 catch (    UnsupportedOperationException exception) {
      fileSize=-1;
    }
  if (MtpDeviceRecord.isPartialReadSupported(device.operationsSupported,fileSize)) {
    return mAppFuse.openFile(Integer.parseInt(documentId),ParcelFileDescriptor.MODE_READ_ONLY);
  }
 else {
    return getPipeManager(identifier).readDocument(mMtpManager,identifier);
  }
case "w":
if (MtpDeviceRecord.isWritingSupported(device.operationsSupported)) {
  return getPipeManager(identifier).writeDocument(getContext(),mMtpManager,identifier,device.operationsSupported);
}
 else {
  throw new UnsupportedOperationException("The device does not support writing operation.");
}
case "rw":
throw new UnsupportedOperationException("The provider does not support 'rw' mode.");
default :
throw new IllegalArgumentException("Unknown mode for openDocument: " + mode);
}
}
 catch (IOException error) {
Log.e(MtpDocumentsProvider.TAG,"openDocument",error);
throw new FileNotFoundException(error.getMessage());
}
}
