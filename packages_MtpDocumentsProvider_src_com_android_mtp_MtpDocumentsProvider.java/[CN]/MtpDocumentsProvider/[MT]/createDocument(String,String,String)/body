{
  if (DEBUG) {
    Log.d(TAG,"createDocument: " + displayName);
  }
  try {
    final Identifier parentId=mDatabase.createIdentifier(parentDocumentId);
    openDevice(parentId.mDeviceId);
    final MtpDeviceRecord record=getDeviceToolkit(parentId.mDeviceId).mDeviceRecord;
    if (!MtpDeviceRecord.isWritingSupported(record.operationsSupported)) {
      throw new UnsupportedOperationException();
    }
    final ParcelFileDescriptor pipe[]=ParcelFileDescriptor.createReliablePipe();
    pipe[0].close();
    final int formatCode=Document.MIME_TYPE_DIR.equals(mimeType) ? MtpConstants.FORMAT_ASSOCIATION : MediaFile.getFormatCode(displayName,mimeType);
    final MtpObjectInfo info=new MtpObjectInfo.Builder().setStorageId(parentId.mStorageId).setParent(parentId.mObjectHandle).setFormat(formatCode).setName(displayName).build();
    final int objectHandle=mMtpManager.createDocument(parentId.mDeviceId,info,pipe[1]);
    final MtpObjectInfo infoWithHandle=new MtpObjectInfo.Builder(info).setObjectHandle(objectHandle).build();
    final String documentId=mDatabase.putNewDocument(parentId.mDeviceId,parentDocumentId,infoWithHandle);
    getDocumentLoader(parentId).clearTask(parentId);
    notifyChildDocumentsChange(parentDocumentId);
    return documentId;
  }
 catch (  IOException error) {
    Log.e(TAG,"createDocument",error);
    throw new FileNotFoundException(error.getMessage());
  }
}
