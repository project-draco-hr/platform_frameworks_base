{
  final String country="us";
  final String provider="Good";
  long timeout=1000;
  TestCountryDetector detector=new TestCountryDetector(country,provider,timeout);
  CountryListenerImpl countryListener=new CountryListenerImpl();
  detector.setCountryListener(countryListener);
  detector.detectCountry();
  assertEquals(detector.getListenersCount(),TestCountryDetector.TOTAL_PROVIDERS);
  waitForTimerReset(detector);
  assertEquals(detector.getListenersCount(),0);
  Thread queryThread=waitForQueryThreadLaunched(detector);
  detector.notifyCountryFound();
  waitForThreadEnding(queryThread);
  assertNull(detector.getQueryThread());
  assertTrue(countryListener.notified());
  assertEquals(countryListener.getCountry(),country);
}
