{
  if (mMemoryFormat != null) {
    return false;
  }
  if (inputFormat.getWidth() == FrameFormat.SIZE_UNSPECIFIED || inputFormat.getHeight() == FrameFormat.SIZE_UNSPECIFIED) {
    throw new RuntimeException("Attempting to process input frame with unknown size");
  }
  mMaskFormat=inputFormat.mutableCopy();
  int maskWidth=(int)Math.pow(2,mMaskWidthExp);
  int maskHeight=(int)Math.pow(2,mMaskHeightExp);
  mMaskFormat.setDimensions(maskWidth,maskHeight);
  mPyramidDepth=Math.max(mMaskWidthExp,mMaskHeightExp);
  mMemoryFormat=mMaskFormat.mutableCopy();
  int widthExp=Math.max(mMaskWidthExp,pyramidLevel(inputFormat.getWidth()));
  int heightExp=Math.max(mMaskHeightExp,pyramidLevel(inputFormat.getHeight()));
  mPyramidDepth=Math.max(widthExp,heightExp);
  int memWidth=Math.max(maskWidth,(int)Math.pow(2,widthExp));
  int memHeight=Math.max(maskHeight,(int)Math.pow(2,heightExp));
  mMemoryFormat.setDimensions(memWidth,memHeight);
  mSubsampleLevel=mPyramidDepth - Math.max(mMaskWidthExp,mMaskHeightExp);
  if (mLogVerbose) {
    Log.v(TAG,"Mask frames size " + maskWidth + " x "+ maskHeight);
    Log.v(TAG,"Pyramid levels " + widthExp + " x "+ heightExp);
    Log.v(TAG,"Memory frames size " + memWidth + " x "+ memHeight);
  }
  mAverageFormat=inputFormat.mutableCopy();
  mAverageFormat.setDimensions(1,1);
  return true;
}
