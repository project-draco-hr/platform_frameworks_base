{
  int virtualHeight=height;
  final View root=getRootView();
  if (root != null) {
    virtualHeight=mDisplayMetrics.heightPixels - root.getPaddingTop() - mInsets.top;
  }
  if (lp.childType == LayoutParams.CHILD_TYPE_WIDGET || lp.childType == LayoutParams.CHILD_TYPE_USER_SWITCHER) {
    return virtualHeight - heightUsed;
  }
 else   if (lp.childType == LayoutParams.CHILD_TYPE_PAGE_DELETE_DROP_TARGET) {
    return height;
  }
  return Math.min(virtualHeight - heightUsed,height);
}
