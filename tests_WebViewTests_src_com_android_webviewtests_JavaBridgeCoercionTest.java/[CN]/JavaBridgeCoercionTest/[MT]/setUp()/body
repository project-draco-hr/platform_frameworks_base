{
  super.setUp();
  mTestObject=new TestObject();
  final WebViewStubActivity activity=getActivity();
  final TestWebViewClient webViewClient=new TestWebViewClient();
  try {
    runTestOnUiThread(new Runnable(){
      @Override public void run(){
        WebView webView=activity.getWebView();
        webView.addJavascriptInterface(mTestObject,"testObject");
        webView.getSettings().setJavaScriptEnabled(true);
        webView.setWebViewClient(webViewClient);
        webView.loadData("<html><head></head><body></body></html>","text/html",null);
      }
    }
);
    webViewClient.waitForOnPageFinished();
  }
 catch (  Throwable e) {
    throw new RuntimeException("Failed to set up WebView: " + Log.getStackTraceString(e));
  }
}
