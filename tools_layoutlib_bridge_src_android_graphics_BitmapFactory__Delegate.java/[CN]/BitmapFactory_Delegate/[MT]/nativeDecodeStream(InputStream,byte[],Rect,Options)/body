{
  Bitmap bm=null;
  Density density=Density.MEDIUM;
  Set<BitmapCreateFlags> bitmapCreateFlags=EnumSet.of(BitmapCreateFlags.MUTABLE);
  if (opts != null) {
    density=Density.getEnum(opts.inDensity);
    if (opts.inPremultiplied) {
      bitmapCreateFlags.add(BitmapCreateFlags.PREMULTIPLIED);
    }
    opts.inScaled=false;
  }
  try {
    if (is instanceof NinePatchInputStream) {
      NinePatchInputStream npis=(NinePatchInputStream)is;
      npis.disableFakeMarkSupport();
      com.android.ninepatch.NinePatch ninePatch=com.android.ninepatch.NinePatch.load(npis,true,false);
      bm=Bitmap_Delegate.createBitmap(ninePatch.getImage(),bitmapCreateFlags,density);
      NinePatchChunk chunk=ninePatch.getChunk();
      bm.setNinePatchChunk(NinePatch_Delegate.serialize(chunk));
      if (padding != null) {
        int[] paddingArray=chunk.getPadding();
        padding.left=paddingArray[0];
        padding.top=paddingArray[1];
        padding.right=paddingArray[2];
        padding.bottom=paddingArray[3];
      }
    }
 else {
      bm=Bitmap_Delegate.createBitmap(is,bitmapCreateFlags,density);
    }
  }
 catch (  IOException e) {
    Bridge.getLog().error(null,"Failed to load image",e,null);
  }
  return bm;
}
