{
  final IBinder binder=client.asBinder();
  ClientRecord clientRecord=mAllClientRecords.get(binder);
  if (clientRecord == null) {
    boolean newUser=false;
    UserRecord userRecord=mUserRecords.get(userId);
    if (userRecord == null) {
      userRecord=new UserRecord(userId);
      newUser=true;
    }
    clientRecord=new ClientRecord(userRecord,client,pid,packageName);
    try {
      binder.linkToDeath(clientRecord,0);
    }
 catch (    RemoteException ex) {
      throw new RuntimeException("Media router client died prematurely.",ex);
    }
    if (newUser) {
      mUserRecords.put(userId,userRecord);
      initializeUserLocked(userRecord);
    }
    userRecord.mClientRecords.add(clientRecord);
    mAllClientRecords.put(binder,clientRecord);
    initializeClientLocked(clientRecord);
  }
}
