{
  if (srcInfo.authority.equals(dstDirInfo.authority)) {
switch (mode) {
case TRANSFER_MODE_COPY:
      if ((srcInfo.flags & Document.FLAG_SUPPORTS_COPY) != 0) {
        if (DocumentsContract.copyDocument(mSrcClient,srcInfo.derivedUri,dstDirInfo.derivedUri) == null) {
          mFailedFiles.add(srcInfo);
        }
        return false;
      }
    break;
case TRANSFER_MODE_MOVE:
  if ((srcInfo.flags & Document.FLAG_SUPPORTS_MOVE) != 0) {
    if (DocumentsContract.moveDocument(mSrcClient,srcInfo.derivedUri,dstDirInfo.derivedUri) == null) {
      mFailedFiles.add(srcInfo);
    }
    return false;
  }
break;
default :
throw new IllegalArgumentException("Unknown transfer mode.");
}
}
final Uri dstUri=DocumentsContract.createDocument(mDstClient,dstDirInfo.derivedUri,srcInfo.mimeType,srcInfo.displayName);
if (dstUri == null) {
mFailedFiles.add(srcInfo);
return false;
}
DocumentInfo dstInfo=null;
try {
dstInfo=DocumentInfo.fromUri(getContentResolver(),dstUri);
}
 catch (FileNotFoundException e) {
mFailedFiles.add(srcInfo);
return false;
}
final boolean success;
if (Document.MIME_TYPE_DIR.equals(srcInfo.mimeType)) {
success=copyDirectoryHelper(srcInfo,dstInfo,mode);
}
 else {
success=copyFileHelper(srcInfo,dstInfo,mode);
}
if (mode == TRANSFER_MODE_MOVE && success) {
try {
DocumentsContract.deleteDocument(mSrcClient,srcInfo.derivedUri);
}
 catch (RemoteException e) {
Log.w(TAG,"Failed to delete source after moving: " + srcInfo.derivedUri,e);
throw e;
}
}
return success;
}
