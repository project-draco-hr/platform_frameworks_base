{
  if (DEBUG && mFile != null)   Slog.d(TAG,"Safely resetting state of " + mFile.getBaseFile());
  resetCommon();
  long now=SystemClock.uptimeMillis();
  ArrayMap<String,SparseArray<ProcessState>> procMap=mProcesses.getMap();
  for (int ip=procMap.size() - 1; ip >= 0; ip--) {
    SparseArray<ProcessState> uids=procMap.valueAt(ip);
    for (int iu=uids.size() - 1; iu >= 0; iu--) {
      uids.valueAt(iu).resetSafely(now);
    }
  }
  ArrayMap<String,SparseArray<PackageState>> pkgMap=mPackages.getMap();
  for (int ip=pkgMap.size() - 1; ip >= 0; ip--) {
    SparseArray<PackageState> uids=pkgMap.valueAt(ip);
    for (int iu=uids.size() - 1; iu >= 0; iu--) {
      PackageState pkgState=uids.valueAt(iu);
      for (int iproc=pkgState.mProcesses.size() - 1; iproc >= 0; iproc--) {
        pkgState.mProcesses.valueAt(iproc).resetSafely(now);
      }
      for (int isvc=pkgState.mServices.size() - 1; isvc >= 0; isvc--) {
        ServiceState ss=pkgState.mServices.valueAt(isvc);
        if (ss.isActive()) {
          pkgState.mServices.valueAt(isvc).resetSafely(now);
        }
 else {
          pkgState.mServices.removeAt(isvc);
        }
      }
    }
  }
  mStartTime=SystemClock.uptimeMillis();
  if (DEBUG && mFile != null)   Slog.d(TAG,"State reset; now " + mFile.getBaseFile());
}
