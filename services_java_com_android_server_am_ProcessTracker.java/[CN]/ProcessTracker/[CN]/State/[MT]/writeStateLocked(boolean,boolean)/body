{
synchronized (mPendingWriteLock) {
    long now=SystemClock.uptimeMillis();
    mPendingWrite=Parcel.obtain();
    mTimePeriodEndRealtime=SystemClock.elapsedRealtime();
    writeToParcel(mPendingWrite);
    mLastWriteTime=SystemClock.uptimeMillis();
    Slog.i(TAG,"Prepared write state in " + (SystemClock.uptimeMillis() - now) + "ms");
    if (!sync) {
      BackgroundThread.getHandler().post(new Runnable(){
        @Override public void run(){
          performWriteState(commit);
        }
      }
);
      return;
    }
  }
  performWriteState(commit);
}
