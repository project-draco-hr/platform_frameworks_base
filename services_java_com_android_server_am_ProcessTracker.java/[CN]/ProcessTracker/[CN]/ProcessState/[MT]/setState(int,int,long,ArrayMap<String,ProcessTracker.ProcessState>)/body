{
  if (state != STATE_NOTHING) {
    state+=memFactor * STATE_COUNT;
  }
  if (mCommonProcess != null) {
    mCommonProcess.setState(state,now);
    if (!mCommonProcess.mMultiPackage) {
      return;
    }
  }
  for (int ip=pkgList.size() - 1; ip >= 0; ip--) {
    ProcessState proc=pkgList.valueAt(ip);
    if (proc.mMultiPackage) {
      proc=mState.mPackages.get(pkgList.keyAt(ip),proc.mUid).mProcesses.get(proc.mName);
      if (proc == null) {
        throw new IllegalStateException("Didn't create per-package process");
      }
      pkgList.setValueAt(ip,proc);
    }
    proc.setState(state,now);
  }
}
