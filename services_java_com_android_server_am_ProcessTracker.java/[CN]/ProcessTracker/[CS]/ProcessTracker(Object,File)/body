{
  mLock=lock;
  mBaseDir=file;
  mBaseDir.mkdirs();
  mState=new State(mBaseDir,this);
  mState.mRunning=true;
  SystemProperties.addChangeCallback(new Runnable(){
    @Override public void run(){
synchronized (mLock) {
        if (mState.evaluateSystemProperties(false)) {
          mState.mFlags|=State.FLAG_SYSPROPS;
          mState.writeStateLocked(true,true);
          mState.evaluateSystemProperties(true);
        }
      }
    }
  }
);
}
