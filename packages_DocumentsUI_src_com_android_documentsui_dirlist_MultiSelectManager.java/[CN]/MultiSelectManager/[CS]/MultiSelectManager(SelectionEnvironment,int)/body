{
  mEnvironment=checkNotNull(environment,"'environment' cannot be null.");
  mSingleSelect=mode == MODE_SINGLE;
  mEnvironment.registerDataObserver(new RecyclerView.AdapterDataObserver(){
    private List<String> mModelIds=new ArrayList<>();
    @Override public void onChanged(){
      mSelection.clear();
      mModelIds.clear();
      for (int i=0; i < mEnvironment.getItemCount(); ++i) {
        mModelIds.add(mEnvironment.getModelIdFromAdapterPosition(i));
      }
    }
    @Override public void onItemRangeChanged(    int startPosition,    int itemCount,    Object payload){
    }
    @Override public void onItemRangeInserted(    int startPosition,    int itemCount){
      mSelection.cancelProvisionalSelection();
    }
    @Override public void onItemRangeRemoved(    int startPosition,    int itemCount){
      checkState(startPosition >= 0);
      checkState(itemCount > 0);
      mSelection.cancelProvisionalSelection();
      int endPosition=startPosition + itemCount;
      for (int i=startPosition; i < endPosition; i++) {
        String id=mModelIds.get(i);
        mSelection.remove(id);
        mModelIds.remove(i);
      }
    }
    @Override public void onItemRangeMoved(    int fromPosition,    int toPosition,    int itemCount){
      throw new UnsupportedOperationException();
    }
  }
);
}
