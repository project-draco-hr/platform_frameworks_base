{
  mEnvironment=checkNotNull(environment,"'environment' cannot be null.");
  mAdapter=checkNotNull(adapter,"'adapter' cannot be null.");
  mSingleSelect=mode == MODE_SINGLE;
  mAdapter.registerAdapterDataObserver(new RecyclerView.AdapterDataObserver(){
    private List<String> mModelIds;
    @Override public void onChanged(){
      mSelection.clear();
      mModelIds=mAdapter.getModelIds();
    }
    @Override public void onItemRangeChanged(    int startPosition,    int itemCount,    Object payload){
    }
    @Override public void onItemRangeInserted(    int startPosition,    int itemCount){
      mSelection.cancelProvisionalSelection();
    }
    @Override public void onItemRangeRemoved(    int startPosition,    int itemCount){
      checkState(startPosition >= 0);
      checkState(itemCount > 0);
      mSelection.cancelProvisionalSelection();
      mSelection.intersect(mModelIds);
    }
    @Override public void onItemRangeMoved(    int fromPosition,    int toPosition,    int itemCount){
      throw new UnsupportedOperationException();
    }
  }
);
}
