{
  mContext=context;
  mPm=pm;
  mInstallThread=new HandlerThread(TAG);
  mInstallThread.start();
  mInstallHandler=new Handler(mInstallThread.getLooper());
  mCallbacks=new Callbacks(mInstallThread.getLooper());
  mSessionsFile=new AtomicFile(new File(Environment.getDataSystemDirectory(),"install_sessions.xml"));
  mSessionsDir=new File(Environment.getDataSystemDirectory(),"install_sessions");
  mSessionsDir.mkdirs();
synchronized (mSessions) {
    readSessionsLocked();
    reconcileStagesLocked(StorageManager.UUID_PRIVATE_INTERNAL,false);
    reconcileStagesLocked(StorageManager.UUID_PRIVATE_INTERNAL,true);
    final ArraySet<File> unclaimedIcons=newArraySet(mSessionsDir.listFiles());
    for (int i=0; i < mSessions.size(); i++) {
      final PackageInstallerSession session=mSessions.valueAt(i);
      unclaimedIcons.remove(buildAppIconFile(session.sessionId));
    }
    for (    File icon : unclaimedIcons) {
      Slog.w(TAG,"Deleting orphan icon " + icon);
      icon.delete();
    }
  }
}
