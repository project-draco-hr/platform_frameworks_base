{
  mContext=context;
  mPm=pm;
  mAppOps=(AppOpsManager)mContext.getSystemService(Context.APP_OPS_SERVICE);
  mStorage=StorageManager.from(mContext);
  mStagingDir=stagingDir;
  mInstallThread=new HandlerThread(TAG);
  mInstallThread.start();
  mCallbacks=new Callbacks(mInstallThread.getLooper());
  mSessionsFile=new AtomicFile(new File(Environment.getSystemSecureDirectory(),"install_sessions.xml"));
synchronized (mSessions) {
    readSessionsLocked();
    final ArraySet<File> unclaimed=Sets.newArraySet(mStagingDir.listFiles(sStageFilter));
    for (int i=0; i < mSessions.size(); i++) {
      final PackageInstallerSession session=mSessions.valueAt(i);
      unclaimed.remove(session.stageDir);
    }
    for (    File stage : unclaimed) {
      Slog.w(TAG,"Deleting orphan stage " + stage);
      if (stage.isDirectory()) {
        FileUtils.deleteContents(stage);
      }
      stage.delete();
    }
  }
}
