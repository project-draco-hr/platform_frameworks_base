{
  int n=0;
  int sessionId;
  do {
    sessionId=mRandom.nextInt(Integer.MAX_VALUE - 1) + 1;
    if (mSessions.get(sessionId) == null && mHistoricalSessions.get(sessionId) == null && !mLegacySessions.get(sessionId,false)) {
      return sessionId;
    }
  }
 while (n++ < 32);
  throw new IllegalStateException("Failed to allocate session ID");
}
