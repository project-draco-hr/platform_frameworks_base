{
  final int sessionId=readIntAttribute(in,ATTR_SESSION_ID);
  final int userId=readIntAttribute(in,ATTR_USER_ID);
  final String installerPackageName=readStringAttribute(in,ATTR_INSTALLER_PACKAGE_NAME);
  final int installerUid=readIntAttribute(in,ATTR_INSTALLER_UID,mPm.getPackageUid(installerPackageName,userId));
  final long createdMillis=readLongAttribute(in,ATTR_CREATED_MILLIS);
  final String stageDirRaw=readStringAttribute(in,ATTR_SESSION_STAGE_DIR);
  final File stageDir=(stageDirRaw != null) ? new File(stageDirRaw) : null;
  final String stageCid=readStringAttribute(in,ATTR_SESSION_STAGE_CID);
  final boolean prepared=readBooleanAttribute(in,ATTR_PREPARED,true);
  final boolean sealed=readBooleanAttribute(in,ATTR_SEALED);
  final SessionParams params=new SessionParams(SessionParams.MODE_INVALID);
  params.mode=readIntAttribute(in,ATTR_MODE);
  params.installFlags=readIntAttribute(in,ATTR_INSTALL_FLAGS);
  params.installLocation=readIntAttribute(in,ATTR_INSTALL_LOCATION);
  params.sizeBytes=readLongAttribute(in,ATTR_SIZE_BYTES);
  params.appPackageName=readStringAttribute(in,ATTR_APP_PACKAGE_NAME);
  params.appIcon=readBitmapAttribute(in,ATTR_APP_ICON);
  params.appLabel=readStringAttribute(in,ATTR_APP_LABEL);
  params.originatingUri=readUriAttribute(in,ATTR_ORIGINATING_URI);
  params.originatingUid=readIntAttribute(in,ATTR_ORIGINATING_UID,SessionParams.UID_UNKNOWN);
  params.referrerUri=readUriAttribute(in,ATTR_REFERRER_URI);
  params.abiOverride=readStringAttribute(in,ATTR_ABI_OVERRIDE);
  params.volumeUuid=readStringAttribute(in,ATTR_VOLUME_UUID);
  params.grantedRuntimePermissions=readGrantedRuntimePermissions(in);
  final File appIconFile=buildAppIconFile(sessionId);
  if (appIconFile.exists()) {
    params.appIcon=BitmapFactory.decodeFile(appIconFile.getAbsolutePath());
    params.appIconLastModified=appIconFile.lastModified();
  }
  return new PackageInstallerSession(mInternalCallback,mContext,mPm,mInstallThread.getLooper(),sessionId,userId,installerPackageName,installerUid,params,createdMillis,stageDir,stageCid,prepared,sealed);
}
