{
  MockPerformanceResultsWriter writer=new MockPerformanceResultsWriter();
  mPerfCollector.setPerformanceResultsWriter(writer);
  mPerfCollector.beginSnapshot("testEndSnapshot");
  sleepForRandomLongPeriod();
  Bundle snapshot1=mPerfCollector.endSnapshot();
  Bundle snapshot2=writer.snapshotResults;
  assertTrue(snapshot1.equals(snapshot2));
  verifySnapshotBundle(snapshot1);
}
