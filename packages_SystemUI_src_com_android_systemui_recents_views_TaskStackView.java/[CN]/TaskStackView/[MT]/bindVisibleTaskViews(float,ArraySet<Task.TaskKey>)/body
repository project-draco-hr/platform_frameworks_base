{
  final int[] visibleStackRange=mTmpVisibleRange;
  final ArrayList<Task> tasks=mStack.getStackTasks();
  final boolean isValidVisibleRange=computeVisibleTaskTransforms(mCurrentTaskTransforms,tasks,mStackScroller.getStackScroll(),targetStackScroll,visibleStackRange,ignoreTasksSet);
  mTmpTaskViewMap.clear();
  List<TaskView> taskViews=getTaskViews();
  int lastFocusedTaskIndex=-1;
  int taskViewCount=taskViews.size();
  for (int i=taskViewCount - 1; i >= 0; i--) {
    TaskView tv=taskViews.get(i);
    Task task=tv.getTask();
    int taskIndex=mStack.indexOfStackTask(task);
    if (ignoreTasksSet.contains(task.key)) {
      continue;
    }
    if (task.isFreeformTask() || visibleStackRange[1] <= taskIndex && taskIndex <= visibleStackRange[0]) {
      mTmpTaskViewMap.put(task.key,tv);
    }
 else {
      if (mTouchExplorationEnabled) {
        lastFocusedTaskIndex=taskIndex;
        resetFocusedTask(task);
      }
      mViewPool.returnViewToPool(tv);
    }
  }
  int lastVisStackIndex=isValidVisibleRange ? visibleStackRange[1] : 0;
  for (int i=tasks.size() - 1; i >= lastVisStackIndex; i--) {
    Task task=tasks.get(i);
    TaskViewTransform transform=mCurrentTaskTransforms.get(i);
    if (ignoreTasksSet.contains(task.key)) {
      continue;
    }
    if (!task.isFreeformTask() && !transform.visible) {
      continue;
    }
    TaskView tv=mTmpTaskViewMap.get(task.key);
    if (tv == null) {
      tv=mViewPool.pickUpViewFromPool(task,task);
      if (task.isFreeformTask()) {
        tv.updateViewPropertiesToTaskTransform(transform,AnimationProps.IMMEDIATE,mRequestUpdateClippingListener);
      }
 else {
        if (transform.rect.top <= mLayoutAlgorithm.mStackRect.top) {
          tv.updateViewPropertiesToTaskTransform(mLayoutAlgorithm.getBackOfStackTransform(),AnimationProps.IMMEDIATE,mRequestUpdateClippingListener);
        }
 else {
          tv.updateViewPropertiesToTaskTransform(mLayoutAlgorithm.getFrontOfStackTransform(),AnimationProps.IMMEDIATE,mRequestUpdateClippingListener);
        }
      }
    }
 else {
      final int taskIndex=mStack.indexOfStackTask(task);
      final int insertIndex=findTaskViewInsertIndex(task,taskIndex);
      if (insertIndex != getTaskViews().indexOf(tv)) {
        detachViewFromParent(tv);
        attachViewToParent(tv,insertIndex,tv.getLayoutParams());
        updateTaskViewsList();
      }
    }
  }
  if (lastFocusedTaskIndex != -1) {
    if (lastFocusedTaskIndex < visibleStackRange[1]) {
      setFocusedTask(visibleStackRange[1],false,true);
    }
 else {
      setFocusedTask(visibleStackRange[0],false,true);
    }
  }
}
