{
  int newFocusedTaskIndex=mStack.getStackTaskCount() > 0 ? Math.max(0,Math.min(mStack.getStackTaskCount() - 1,taskIndex)) : -1;
  final Task newFocusedTask=(newFocusedTaskIndex != -1) ? mStack.getStackTasks().get(newFocusedTaskIndex) : null;
  if (mFocusedTask != null) {
    resetFocusedTask(mFocusedTask);
  }
  boolean willScroll=false;
  mFocusedTask=newFocusedTask;
  if (newFocusedTask != null) {
    Runnable focusTaskRunnable=new Runnable(){
      @Override public void run(){
        TaskView tv=getChildViewForTask(newFocusedTask);
        if (tv != null) {
          tv.setFocusedState(true,animated,requestViewFocus);
        }
      }
    }
;
    if (scrollToTask) {
      float newScroll=mLayoutAlgorithm.getStackScrollForTask(newFocusedTask);
      if (Float.compare(newScroll,mStackScroller.getStackScroll()) != 0) {
        mStackScroller.animateScroll(mStackScroller.getStackScroll(),newScroll,focusTaskRunnable);
        willScroll=true;
        if (!mEnterAnimationComplete) {
          final List<TaskView> taskViews=getTaskViews();
          for (          TaskView tv : taskViews) {
            tv.cancelEnterRecentsAnimation();
          }
        }
      }
 else {
        focusTaskRunnable.run();
      }
      mLayoutAlgorithm.animateFocusState(TaskStackLayoutAlgorithm.STATE_FOCUSED);
    }
 else {
      focusTaskRunnable.run();
    }
  }
  return willScroll;
}
