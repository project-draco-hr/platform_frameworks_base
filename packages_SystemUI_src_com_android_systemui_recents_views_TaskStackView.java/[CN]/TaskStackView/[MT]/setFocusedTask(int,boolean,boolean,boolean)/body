{
  int newFocusedTaskIndex=mStack.getTaskCount() > 0 ? Math.max(0,Math.min(mStack.getTaskCount() - 1,taskIndex)) : -1;
  final Task newFocusedTask=(newFocusedTaskIndex != -1) ? mStack.getTasks().get(newFocusedTaskIndex) : null;
  if (mFocusedTaskIndex != -1) {
    Task focusedTask=mStack.getTasks().get(mFocusedTaskIndex);
    if (focusedTask != newFocusedTask) {
      resetFocusedTask();
    }
  }
  mFocusedTaskIndex=newFocusedTaskIndex;
  if (mFocusedTaskIndex != -1) {
    Runnable focusTaskRunnable=new Runnable(){
      @Override public void run(){
        TaskView tv=getChildViewForTask(newFocusedTask);
        if (tv != null) {
          tv.setFocusedState(true,animated,requestViewFocus);
        }
      }
    }
;
    if (scrollToTask) {
      float newScroll=mLayoutAlgorithm.getStackScrollForTask(newFocusedTask) - 0.5f;
      newScroll=mStackScroller.getBoundedStackScroll(newScroll);
      mStackScroller.animateScroll(mStackScroller.getStackScroll(),newScroll,focusTaskRunnable);
    }
 else {
      focusTaskRunnable.run();
    }
  }
}
