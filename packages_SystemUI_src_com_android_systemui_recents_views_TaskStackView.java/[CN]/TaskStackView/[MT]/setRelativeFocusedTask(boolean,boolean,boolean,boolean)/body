{
  int newIndex=-1;
  if (mFocusedTaskIndex != -1) {
    if (stackTasksOnly) {
      List<Task> tasks=mStack.getTasks();
      newIndex=mFocusedTaskIndex;
      Task task=tasks.get(mFocusedTaskIndex);
      if (task.isFreeformTask()) {
        TaskView tv=getFrontMostTaskView(stackTasksOnly);
        if (tv != null) {
          newIndex=mStack.indexOfTask(tv.getTask());
        }
      }
 else {
        int tmpNewIndex=mFocusedTaskIndex + (forward ? -1 : 1);
        if (0 <= tmpNewIndex && tmpNewIndex < tasks.size()) {
          Task t=tasks.get(tmpNewIndex);
          if (!t.isFreeformTask()) {
            newIndex=tmpNewIndex;
          }
        }
      }
    }
 else {
      int taskCount=mStack.getTaskCount();
      newIndex=(mFocusedTaskIndex + (forward ? -1 : 1) + taskCount) % taskCount;
    }
  }
 else {
    TaskView tv=getFrontMostTaskView(stackTasksOnly);
    if (tv != null) {
      newIndex=mStack.indexOfTask(tv.getTask());
    }
  }
  if (newIndex != -1) {
    boolean willScroll=setFocusedTask(newIndex,true,animated);
    if (willScroll && cancelWindowAnimations) {
      EventBus.getDefault().send(new CancelEnterRecentsWindowAnimationEvent(null));
    }
  }
}
