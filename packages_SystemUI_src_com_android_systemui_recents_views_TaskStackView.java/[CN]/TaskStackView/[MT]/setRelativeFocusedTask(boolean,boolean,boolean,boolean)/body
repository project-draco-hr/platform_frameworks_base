{
  int newIndex=mStack.indexOfStackTask(mFocusedTask);
  if (mFocusedTask != null) {
    if (stackTasksOnly) {
      List<Task> tasks=mStack.getStackTasks();
      if (mFocusedTask.isFreeformTask()) {
        TaskView tv=getFrontMostTaskView(stackTasksOnly);
        if (tv != null) {
          newIndex=mStack.indexOfStackTask(tv.getTask());
        }
      }
 else {
        int tmpNewIndex=newIndex + (forward ? -1 : 1);
        if (0 <= tmpNewIndex && tmpNewIndex < tasks.size()) {
          Task t=tasks.get(tmpNewIndex);
          if (!t.isFreeformTask()) {
            newIndex=tmpNewIndex;
          }
        }
      }
    }
 else {
      int taskCount=mStack.getStackTaskCount();
      newIndex=(newIndex + (forward ? -1 : 1) + taskCount) % taskCount;
    }
  }
 else {
    TaskView tv=getFrontMostTaskView(stackTasksOnly);
    if (tv != null) {
      newIndex=mStack.indexOfStackTask(tv.getTask());
    }
  }
  if (newIndex != -1) {
    boolean willScroll=setFocusedTask(newIndex,true,true);
    if (willScroll && cancelWindowAnimations) {
      EventBus.getDefault().send(new CancelEnterRecentsWindowAnimationEvent(null));
    }
  }
}
