{
  if (Console.Enabled) {
    Console.log(Constants.Log.UI.MeasureAndLayout,"[TaskStackView|layout]","" + new Rect(left,top,right,bottom),Console.AnsiGreen);
  }
  if (Constants.Log.UI.MeasureAndLayout) {
    Console.log("  [TaskStack|fullRect] " + mStackAlgorithm.mRect);
    Console.log("  [TaskStack|stackRect] " + mStackAlgorithm.mStackRect);
    Console.log("  [TaskStack|stackRectSansPeek] " + mStackAlgorithm.mStackRectSansPeek);
    Console.log("  [TaskStack|taskRect] " + mStackAlgorithm.mTaskRect);
  }
  int childCount=getChildCount();
  for (int i=0; i < childCount; i++) {
    TaskView t=(TaskView)getChildAt(i);
    t.layout(mStackAlgorithm.mTaskRect.left,mStackAlgorithm.mStackRectSansPeek.top,mStackAlgorithm.mTaskRect.right,mStackAlgorithm.mStackRectSansPeek.top + mStackAlgorithm.mTaskRect.height());
  }
  if (mAwaitingFirstLayout) {
    mAwaitingFirstLayout=false;
    mUIDozeTrigger.startDozing();
    int offsetTopAlign=-mStackAlgorithm.mTaskRect.top;
    int offscreenY=mStackAlgorithm.mRect.bottom - (mStackAlgorithm.mTaskRect.top - mStackAlgorithm.mRect.top);
    for (int i=childCount - 1; i >= 0; i--) {
      TaskView tv=(TaskView)getChildAt(i);
      tv.prepareEnterRecentsAnimation((i == (getChildCount() - 1)),offsetTopAlign,offscreenY,mStackAlgorithm.mTaskRect);
    }
    if (mStartEnterAnimationRequestedAfterLayout) {
      startEnterRecentsAnimation(mStartEnterAnimationContext);
      mStartEnterAnimationRequestedAfterLayout=false;
      mStartEnterAnimationContext=null;
    }
    if (mConfig.launchedWithAltTab) {
      focusTask(Math.max(0,mStack.getTaskCount() - 2),false);
    }
  }
}
