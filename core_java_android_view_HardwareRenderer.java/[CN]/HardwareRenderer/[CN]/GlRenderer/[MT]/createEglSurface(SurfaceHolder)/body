{
  if (sEgl == null) {
    throw new RuntimeException("egl not initialized");
  }
  if (sEglDisplay == null) {
    throw new RuntimeException("eglDisplay not initialized");
  }
  if (sEglConfig == null) {
    throw new RuntimeException("eglConfig not initialized");
  }
  if (Thread.currentThread() != sEglThread) {
    throw new IllegalStateException("HardwareRenderer cannot be used " + "from multiple threads");
  }
  if (mEglSurface != null && mEglSurface != EGL10.EGL_NO_SURFACE) {
    sEgl.eglMakeCurrent(sEglDisplay,EGL10.EGL_NO_SURFACE,EGL10.EGL_NO_SURFACE,EGL10.EGL_NO_CONTEXT);
    sEgl.eglDestroySurface(sEglDisplay,mEglSurface);
  }
  mEglSurface=sEgl.eglCreateWindowSurface(sEglDisplay,sEglConfig,holder,null);
  if (mEglSurface == null || mEglSurface == EGL10.EGL_NO_SURFACE) {
    int error=sEgl.eglGetError();
    if (error == EGL10.EGL_BAD_NATIVE_WINDOW) {
      Log.e(LOG_TAG,"createWindowSurface returned EGL_BAD_NATIVE_WINDOW.");
      return null;
    }
    throw new RuntimeException("createWindowSurface failed " + getEGLErrorString(error));
  }
  if (!sEgl.eglMakeCurrent(sEglDisplay,mEglSurface,mEglSurface,sEglContext)) {
    throw new RuntimeException("eglMakeCurrent failed " + getEGLErrorString(sEgl.eglGetError()));
  }
  if (mDirtyRegions) {
    if (!GLES20Canvas.preserveBackBuffer()) {
      Log.w(LOG_TAG,"Backbuffer cannot be preserved");
    }
  }
  return sEglContext.getGL();
}
