{
  if (canDraw()) {
    if (!hasDirtyRegions()) {
      dirty=null;
    }
    attachInfo.mIgnoreDirtyState=true;
    attachInfo.mDrawingTime=SystemClock.uptimeMillis();
    view.mPrivateFlags|=View.PFLAG_DRAWN;
    final int surfaceState=checkCurrent();
    if (surfaceState != SURFACE_STATE_ERROR) {
      HardwareCanvas canvas=mCanvas;
      attachInfo.mHardwareCanvas=canvas;
      if (mProfileEnabled) {
        mProfileLock.lock();
      }
      dirty=beginFrame(canvas,dirty,surfaceState);
      int saveCount=0;
      int status=DisplayList.STATUS_DONE;
      try {
        view.mRecreateDisplayList=(view.mPrivateFlags & View.PFLAG_INVALIDATED) == View.PFLAG_INVALIDATED;
        view.mPrivateFlags&=~View.PFLAG_INVALIDATED;
        long buildDisplayListStartTime=startBuildDisplayListProfiling();
        canvas.clearLayerUpdates();
        DisplayList displayList=buildDisplayList(view);
        status=prepareFrame(dirty);
        saveCount=canvas.save();
        callbacks.onHardwarePreDraw(canvas);
        endBuildDisplayListProfiling(buildDisplayListStartTime);
        if (displayList != null) {
          status=drawDisplayList(attachInfo,canvas,displayList,status);
        }
 else {
          view.draw(canvas);
        }
      }
  finally {
        callbacks.onHardwarePostDraw(canvas);
        canvas.restoreToCount(saveCount);
        view.mRecreateDisplayList=false;
        mFrameCount++;
        debugDirtyRegions(dirty,canvas);
        drawProfileData(attachInfo);
      }
      onPostDraw();
      swapBuffers(status);
      if (mProfileEnabled) {
        mProfileLock.unlock();
      }
      attachInfo.mIgnoreDirtyState=false;
      return dirty == null;
    }
  }
  return false;
}
