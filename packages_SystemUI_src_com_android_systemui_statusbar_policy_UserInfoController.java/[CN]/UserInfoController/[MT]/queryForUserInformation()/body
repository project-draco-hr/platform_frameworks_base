{
  Context currentUserContext;
  UserInfo userInfo;
  try {
    userInfo=ActivityManagerNative.getDefault().getCurrentUser();
    currentUserContext=mContext.createPackageContextAsUser("android",0,new UserHandle(userInfo.id));
  }
 catch (  PackageManager.NameNotFoundException e) {
    Log.e(TAG,"Couldn't create user context",e);
    throw new RuntimeException(e);
  }
catch (  RemoteException e) {
    Log.e(TAG,"Couldn't get user info",e);
    throw new RuntimeException(e);
  }
  final int userId=userInfo.id;
  final boolean isGuest=userInfo.isGuest();
  final String userName=userInfo.name;
  final Resources res=mContext.getResources();
  final int avatarSize=Math.max(res.getDimensionPixelSize(R.dimen.multi_user_avatar_expanded_size),res.getDimensionPixelSize(R.dimen.multi_user_avatar_keyguard_size));
  final Context context=currentUserContext;
  mUserInfoTask=new AsyncTask<Void,Void,Pair<String,Drawable>>(){
    @Override protected Pair<String,Drawable> doInBackground(    Void... params){
      final UserManager um=UserManager.get(mContext);
      String name=userName;
      Drawable avatar=null;
      Bitmap rawAvatar=um.getUserIcon(userId);
      if (rawAvatar != null) {
        avatar=new UserIconDrawable(avatarSize).setIcon(rawAvatar).setBadgeIfManagedUser(mContext,userId).bake();
      }
 else {
        avatar=UserIcons.getDefaultUserIcon(isGuest ? UserHandle.USER_NULL : userId,true);
      }
      if (um.getUsers().size() <= 1) {
        final Cursor cursor=context.getContentResolver().query(ContactsContract.Profile.CONTENT_URI,new String[]{ContactsContract.CommonDataKinds.Phone._ID,ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME},null,null,null);
        if (cursor != null) {
          try {
            if (cursor.moveToFirst()) {
              name=cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME));
            }
          }
  finally {
            cursor.close();
          }
        }
      }
      return new Pair<String,Drawable>(name,avatar);
    }
    @Override protected void onPostExecute(    Pair<String,Drawable> result){
      mUserName=result.first;
      mUserDrawable=result.second;
      mUserInfoTask=null;
      notifyChanged();
    }
  }
;
  mUserInfoTask.execute();
}
