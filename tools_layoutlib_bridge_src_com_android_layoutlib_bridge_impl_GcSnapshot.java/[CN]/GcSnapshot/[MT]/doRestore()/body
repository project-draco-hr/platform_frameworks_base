{
  if (mPrevious != null) {
    boolean forceAllSave=false;
    if (mLocalLayer != null) {
      forceAllSave=true;
      for (int i=0; i < mLayers.size() - 1; i++) {
        Layer layer=mLayers.get(i);
        Graphics2D baseGfx=layer.getImage().createGraphics();
        BufferedImage originalCopy=layer.getOriginalCopy();
        if (originalCopy != null) {
          Graphics2D g=(Graphics2D)baseGfx.create();
          g.setComposite(AlphaComposite.Src);
          g.drawImage(originalCopy,mLocalLayerRegion.left,mLocalLayerRegion.top,mLocalLayerRegion.right,mLocalLayerRegion.bottom,0,0,mLocalLayerRegion.width(),mLocalLayerRegion.height(),null);
          g.dispose();
        }
        Graphics2D g=createCustomGraphics(baseGfx,mLocalLayerPaint,true);
        g.drawImage(mLocalLayer.getImage(),mLocalLayerRegion.left,mLocalLayerRegion.top,mLocalLayerRegion.right,mLocalLayerRegion.bottom,mLocalLayerRegion.left,mLocalLayerRegion.top,mLocalLayerRegion.right,mLocalLayerRegion.bottom,null);
        g.dispose();
        baseGfx.dispose();
      }
    }
    if (forceAllSave == false && (mFlags & Canvas.MATRIX_SAVE_FLAG) == 0) {
      AffineTransform mtx=getTransform();
      for (      Layer layer : mPrevious.mLayers) {
        layer.getGraphics().setTransform(mtx);
      }
    }
    if (forceAllSave == false && (mFlags & Canvas.CLIP_SAVE_FLAG) == 0) {
      Shape clip=getClip();
      for (      Layer layer : mPrevious.mLayers) {
        layer.getGraphics().setClip(clip);
      }
    }
  }
  for (  Layer layer : mLayers) {
    layer.getGraphics().dispose();
  }
  return mPrevious;
}
