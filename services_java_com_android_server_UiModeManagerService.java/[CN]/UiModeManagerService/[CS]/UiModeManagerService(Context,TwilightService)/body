{
  mContext=context;
  mTwilightService=twilight;
  ServiceManager.addService(Context.UI_MODE_SERVICE,this);
  mContext.registerReceiver(mDockModeReceiver,new IntentFilter(Intent.ACTION_DOCK_EVENT));
  mContext.registerReceiver(mBatteryReceiver,new IntentFilter(Intent.ACTION_BATTERY_CHANGED));
  mPowerManager=(PowerManager)context.getSystemService(Context.POWER_SERVICE);
  mWakeLock=mPowerManager.newWakeLock(PowerManager.FULL_WAKE_LOCK,TAG);
  mConfiguration.setToDefaults();
  mDefaultUiModeType=context.getResources().getInteger(com.android.internal.R.integer.config_defaultUiModeType);
  mCarModeKeepsScreenOn=(context.getResources().getInteger(com.android.internal.R.integer.config_carDockKeepsScreenOn) == 1);
  mDeskModeKeepsScreenOn=(context.getResources().getInteger(com.android.internal.R.integer.config_deskDockKeepsScreenOn) == 1);
  mTelevision=context.getPackageManager().hasSystemFeature(PackageManager.FEATURE_TELEVISION);
  mNightMode=Settings.Secure.getInt(mContext.getContentResolver(),Settings.Secure.UI_NIGHT_MODE,UiModeManager.MODE_NIGHT_AUTO);
  mTwilightService.registerListener(mTwilightListener,mHandler);
}
