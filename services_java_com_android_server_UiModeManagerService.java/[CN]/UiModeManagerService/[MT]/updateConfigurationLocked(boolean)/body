{
  int uiMode=0;
  if (mCarModeEnabled) {
    uiMode=Configuration.UI_MODE_TYPE_CAR;
  }
 else   if (mDockState == Intent.EXTRA_DOCK_STATE_DESK) {
    uiMode=Configuration.UI_MODE_TYPE_DESK;
  }
  if (mCarModeEnabled) {
    if (mNightMode == UiModeManager.MODE_NIGHT_AUTO) {
      updateTwilightLocked();
      uiMode|=mComputedNightMode ? Configuration.UI_MODE_NIGHT_YES : Configuration.UI_MODE_NIGHT_NO;
    }
 else {
      uiMode|=mNightMode << 4;
    }
  }
 else {
    uiMode=Configuration.UI_MODE_TYPE_NORMAL | Configuration.UI_MODE_NIGHT_NO;
  }
  mCurUiMode=uiMode;
  if (!mHoldingConfiguration && uiMode != mSetUiMode) {
    mSetUiMode=uiMode;
    mConfiguration.uiMode=uiMode;
    if (sendIt) {
      try {
        ActivityManagerNative.getDefault().updateConfiguration(mConfiguration);
      }
 catch (      RemoteException e) {
        Slog.w(TAG,"Failure communicating with activity manager",e);
      }
    }
  }
}
