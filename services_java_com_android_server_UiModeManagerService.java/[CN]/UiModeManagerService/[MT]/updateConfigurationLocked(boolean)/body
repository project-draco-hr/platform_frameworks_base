{
  int uiMode=mTelevision ? Configuration.UI_MODE_TYPE_TELEVISION : mDefaultUiModeType;
  if (mCarModeEnabled) {
    uiMode=Configuration.UI_MODE_TYPE_CAR;
  }
 else   if (isDeskDockState(mDockState)) {
    uiMode=Configuration.UI_MODE_TYPE_DESK;
  }
  if (mCarModeEnabled) {
    if (mNightMode == UiModeManager.MODE_NIGHT_AUTO) {
      updateComputedNightModeLocked();
      uiMode|=mComputedNightMode ? Configuration.UI_MODE_NIGHT_YES : Configuration.UI_MODE_NIGHT_NO;
    }
 else {
      uiMode|=mNightMode << 4;
    }
  }
 else {
    uiMode=(uiMode & ~Configuration.UI_MODE_NIGHT_MASK) | Configuration.UI_MODE_NIGHT_NO;
  }
  if (LOG) {
    Slog.d(TAG,"updateConfigurationLocked: mDockState=" + mDockState + "; mCarMode="+ mCarModeEnabled+ "; mNightMode="+ mNightMode+ "; uiMode="+ uiMode);
  }
  mCurUiMode=uiMode;
  if (!mHoldingConfiguration && uiMode != mSetUiMode) {
    mSetUiMode=uiMode;
    mConfiguration.uiMode=uiMode;
    if (sendIt) {
      try {
        ActivityManagerNative.getDefault().updateConfiguration(mConfiguration);
      }
 catch (      RemoteException e) {
        Slog.w(TAG,"Failure communicating with activity manager",e);
      }
    }
  }
}
