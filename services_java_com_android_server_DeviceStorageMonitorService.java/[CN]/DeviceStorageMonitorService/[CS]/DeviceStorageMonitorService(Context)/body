{
  mLastReportedFreeMemTime=0;
  mContext=context;
  mResolver=mContext.getContentResolver();
  mDataFileStats=new StatFs(DATA_PATH.getAbsolutePath());
  mSystemFileStats=new StatFs(SYSTEM_PATH.getAbsolutePath());
  mCacheFileStats=new StatFs(CACHE_PATH.getAbsolutePath());
  mTotalMemory=(long)mDataFileStats.getBlockCount() * mDataFileStats.getBlockSize();
  mStorageLowIntent=new Intent(Intent.ACTION_DEVICE_STORAGE_LOW);
  mStorageLowIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  mStorageOkIntent=new Intent(Intent.ACTION_DEVICE_STORAGE_OK);
  mStorageOkIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  mStorageFullIntent=new Intent(Intent.ACTION_DEVICE_STORAGE_FULL);
  mStorageFullIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  mStorageNotFullIntent=new Intent(Intent.ACTION_DEVICE_STORAGE_NOT_FULL);
  mStorageNotFullIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY_BEFORE_BOOT);
  final StorageManager sm=StorageManager.from(context);
  mMemLowThreshold=sm.getStorageLowBytes(DATA_PATH);
  mMemFullThreshold=sm.getStorageFullBytes(DATA_PATH);
  mMemCacheStartTrimThreshold=((mMemLowThreshold * 3) + mMemFullThreshold) / 4;
  mMemCacheTrimToThreshold=mMemLowThreshold + ((mMemLowThreshold - mMemCacheStartTrimThreshold) * 2);
  mFreeMemAfterLastCacheClear=mTotalMemory;
  checkMemory(true);
  mCacheFileDeletedObserver=new CacheFileDeletedObserver();
  mCacheFileDeletedObserver.startWatching();
}
