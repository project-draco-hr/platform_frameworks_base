{
  if (cryptoPrimitive == null) {
    throw new NullPointerException();
  }
  Object spi;
  if (cryptoPrimitive instanceof Mac) {
    spi=((Mac)cryptoPrimitive).getSpi();
  }
 else   if (cryptoPrimitive instanceof Cipher) {
    spi=((Cipher)cryptoPrimitive).getSpi();
  }
 else {
    throw new IllegalArgumentException("Unsupported crypto primitive: " + cryptoPrimitive);
  }
  if (!(spi instanceof KeyStoreCryptoOperation)) {
    throw new IllegalArgumentException("Crypto primitive not backed by AndroidKeyStore: " + cryptoPrimitive + ", spi: "+ spi);
  }
  return ((KeyStoreCryptoOperation)spi).getOperationHandle();
}
