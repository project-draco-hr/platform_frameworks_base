{
  ArrayList<DbStats> dbStatsList=new ArrayList<DbStats>();
  for (  WeakReference<SQLiteDatabase> w : ActiveDatabases.getInstance().mActiveDatabases) {
    SQLiteDatabase db=w.get();
    if (db == null || !db.isOpen()) {
      continue;
    }
    int lookasideUsed=db.native_getDbLookaside();
    String path=db.getPath();
    int indx=path.lastIndexOf("/");
    String lastnode=path.substring((indx != -1) ? ++indx : 0);
    ArrayList<Pair<String,String>> attachedDbs=getAttachedDbs(db);
    if (attachedDbs == null) {
      continue;
    }
    for (int i=0; i < attachedDbs.size(); i++) {
      Pair<String,String> p=attachedDbs.get(i);
      long pageCount=getPragmaVal(db,p.first + ".page_count;");
      String dbName;
      if (i == 0) {
        dbName=lastnode;
      }
 else {
        lookasideUsed=0;
        dbName="  (attached) " + p.first;
        if (p.second.trim().length() > 0) {
          int idx=p.second.lastIndexOf("/");
          dbName+=" : " + p.second.substring((idx != -1) ? ++idx : 0);
        }
      }
      if (pageCount > 0) {
        dbStatsList.add(new DbStats(dbName,pageCount,db.getPageSize(),lookasideUsed,db.mNumCacheHits,db.mNumCacheMisses,db.mCompiledQueries.size()));
      }
    }
  }
  return dbStatsList;
}
