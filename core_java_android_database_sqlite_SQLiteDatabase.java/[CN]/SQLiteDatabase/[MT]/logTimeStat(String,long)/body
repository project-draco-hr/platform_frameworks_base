{
  int samplePercent;
  long durationMillis=SystemClock.uptimeMillis() - beginMillis;
  if (durationMillis >= QUERY_LOG_TIME_IN_MILLIS) {
    samplePercent=100;
  }
 else {
    samplePercent=(int)(100 * durationMillis / QUERY_LOG_TIME_IN_MILLIS) + 1;
    if (mRandom.nextInt(100) >= samplePercent)     return;
  }
  if (sql.length() > QUERY_LOG_SQL_LENGTH)   sql=sql.substring(0,QUERY_LOG_SQL_LENGTH);
  String blockingPackage=ActivityThread.currentPackageName();
  if (blockingPackage == null)   blockingPackage="";
  EventLog.writeEvent(EVENT_DB_OPERATION,mPath,sql,durationMillis,blockingPackage,samplePercent);
}
