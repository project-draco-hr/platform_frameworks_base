{
  int samplePercent;
  long durationMillis=SystemClock.uptimeMillis() - beginMillis;
  if (durationMillis == 0 && prefix == GET_LOCK_LOG_PREFIX) {
    return;
  }
  if (sQueryLogTimeInMillis == 0) {
    sQueryLogTimeInMillis=SystemProperties.getInt("db.db_operation.threshold_ms",500);
  }
  if (durationMillis >= sQueryLogTimeInMillis) {
    samplePercent=100;
  }
 else {
    samplePercent=(int)(100 * durationMillis / sQueryLogTimeInMillis) + 1;
    if (mRandom.nextInt(100) >= samplePercent)     return;
  }
  if (prefix != null) {
    sql=prefix + sql;
  }
  if (sql.length() > QUERY_LOG_SQL_LENGTH)   sql=sql.substring(0,QUERY_LOG_SQL_LENGTH);
  String blockingPackage=AppGlobals.getInitialPackage();
  if (blockingPackage == null)   blockingPackage="";
  EventLog.writeEvent(EVENT_DB_OPERATION,getPathForLogs(),sql,durationMillis,blockingPackage,samplePercent);
}
