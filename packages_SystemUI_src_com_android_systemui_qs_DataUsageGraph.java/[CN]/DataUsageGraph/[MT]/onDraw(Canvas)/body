{
  super.onDraw(canvas);
  final RectF r=mTmpRect;
  final Paint p=mTmpPaint;
  final int w=getWidth();
  final int h=getHeight();
  r.set(0,0,w,h);
  p.setColor(mTrackColor);
  canvas.drawRect(r,p);
  final boolean hasLimit=mLimitLevel > 0;
  final boolean overLimit=hasLimit && mUsageLevel > mLimitLevel;
  final long maxLevel=hasLimit ? Math.max(mUsageLevel,mLimitLevel) : mMaxLevel;
  final long usageLevel=hasLimit ? Math.min(mUsageLevel,mLimitLevel) : mUsageLevel;
  float usageRight=w * (usageLevel / (float)maxLevel);
  if (overLimit) {
    usageRight-=(mMarkerWidth / 2);
    usageRight=Math.min(usageRight,w - mMarkerWidth * 2);
    usageRight=Math.max(usageRight,mMarkerWidth);
  }
  r.set(0,0,usageRight,h);
  p.setColor(mUsageColor);
  canvas.drawRect(r,p);
  if (overLimit) {
    r.set(usageRight,0,usageRight + mMarkerWidth,h);
    p.setColor(mBackgroundColor);
    canvas.drawRect(r,p);
    r.set(usageRight + mMarkerWidth,0,w,h);
    p.setColor(mOverlimitColor);
    canvas.drawRect(r,p);
  }
}
