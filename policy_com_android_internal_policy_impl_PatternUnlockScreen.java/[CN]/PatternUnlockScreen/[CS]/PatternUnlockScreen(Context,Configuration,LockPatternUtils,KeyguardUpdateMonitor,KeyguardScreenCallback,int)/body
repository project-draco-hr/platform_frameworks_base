{
  super(context);
  mLockPatternUtils=lockPatternUtils;
  mUpdateMonitor=updateMonitor;
  mCallback=callback;
  mTotalFailedPatternAttempts=totalFailedAttempts;
  mFailedPatternAttemptsSinceLastTimeout=totalFailedAttempts % LockPatternUtils.FAILED_ATTEMPTS_BEFORE_TIMEOUT;
  if (DEBUG)   Log.d(TAG,"UnlockScreen() ctor: totalFailedAttempts=" + totalFailedAttempts + ", mFailedPat...="+ mFailedPatternAttemptsSinceLastTimeout);
  mCreationOrientation=configuration.orientation;
  LayoutInflater inflater=LayoutInflater.from(context);
  if (mCreationOrientation != Configuration.ORIENTATION_LANDSCAPE) {
    inflater.inflate(R.layout.keyguard_screen_unlock_portrait,this,true);
  }
 else {
    inflater.inflate(R.layout.keyguard_screen_unlock_landscape,this,true);
  }
  mCarrier=(TextView)findViewById(R.id.carrier);
  mDate=(TextView)findViewById(R.id.date);
  mDateFormatString=getContext().getString(R.string.full_wday_month_day_no_year);
  refreshTimeAndDateDisplay();
  mStatus1=(TextView)findViewById(R.id.status1);
  mStatusSep=(TextView)findViewById(R.id.statusSep);
  mStatus2=(TextView)findViewById(R.id.status2);
  resetStatusInfo();
  mLockPatternView=(LockPatternView)findViewById(R.id.lockPattern);
  mFooterNormal=(ViewGroup)findViewById(R.id.footerNormal);
  mFooterForgotPattern=(ViewGroup)findViewById(R.id.footerForgotPattern);
  final OnClickListener emergencyClick=new OnClickListener(){
    public void onClick(    View v){
      mCallback.takeEmergencyCallAction();
    }
  }
;
  mEmergencyAlone=(Button)findViewById(R.id.emergencyCallAlone);
  mEmergencyAlone.setFocusable(false);
  mEmergencyAlone.setOnClickListener(emergencyClick);
  mEmergencyTogether=(Button)findViewById(R.id.emergencyCallTogether);
  mEmergencyTogether.setFocusable(false);
  mEmergencyTogether.setOnClickListener(emergencyClick);
  refreshEmergencyButtonText();
  mForgotPatternButton=(Button)findViewById(R.id.forgotPattern);
  mForgotPatternButton.setText(R.string.lockscreen_forgot_pattern_button_text);
  mForgotPatternButton.setOnClickListener(new OnClickListener(){
    public void onClick(    View v){
      mCallback.forgotPattern(true);
    }
  }
);
  setDefaultTouchRecepient(mLockPatternView);
  mLockPatternView.setSaveEnabled(false);
  mLockPatternView.setFocusable(false);
  mLockPatternView.setOnPatternListener(new UnlockPatternListener());
  mLockPatternView.setInStealthMode(!mLockPatternUtils.isVisiblePatternEnabled());
  mLockPatternView.setTactileFeedbackEnabled(mLockPatternUtils.isTactileFeedbackEnabled());
  updateFooter(FooterMode.Normal);
  updateMonitor.registerInfoCallback(this);
  updateMonitor.registerSimStateCallback(this);
  setFocusableInTouchMode(true);
  mCarrier.setSelected(true);
  mCarrier.setTextColor(0xffffffff);
  mCarrier.setText(LockScreen.getCarrierString(mUpdateMonitor.getTelephonyPlmn(),mUpdateMonitor.getTelephonySpn()));
}
