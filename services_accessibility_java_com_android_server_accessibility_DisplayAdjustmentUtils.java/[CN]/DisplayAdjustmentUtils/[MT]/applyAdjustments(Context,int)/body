{
  final ContentResolver cr=context.getContentResolver();
  float[] colorMatrix=new float[16];
  float[] outputMatrix=new float[16];
  boolean hasColorTransform=false;
  Matrix.setIdentityM(colorMatrix,0);
  final boolean inversionEnabled=Settings.Secure.getIntForUser(cr,Settings.Secure.ACCESSIBILITY_DISPLAY_INVERSION_ENABLED,0,userId) == 1;
  if (inversionEnabled) {
    final float[] inversionMatrix=INVERSION_MATRIX_VALUE_ONLY;
    Matrix.multiplyMM(outputMatrix,0,colorMatrix,0,inversionMatrix,0);
    colorMatrix=outputMatrix;
    outputMatrix=colorMatrix;
    hasColorTransform=true;
  }
  final boolean daltonizerEnabled=Settings.Secure.getIntForUser(cr,Settings.Secure.ACCESSIBILITY_DISPLAY_DALTONIZER_ENABLED,0,userId) != 0;
  if (daltonizerEnabled) {
    final int daltonizerMode=Settings.Secure.getIntForUser(cr,Settings.Secure.ACCESSIBILITY_DISPLAY_DALTONIZER,DEFAULT_DISPLAY_DALTONIZER,userId);
    if (daltonizerMode == AccessibilityManager.DALTONIZER_SIMULATE_MONOCHROMACY) {
      Matrix.multiplyMM(outputMatrix,0,colorMatrix,0,GRAYSCALE_MATRIX,0);
      final float[] temp=colorMatrix;
      colorMatrix=outputMatrix;
      outputMatrix=temp;
      hasColorTransform=true;
      nativeSetDaltonizerMode(AccessibilityManager.DALTONIZER_DISABLED);
    }
 else {
      nativeSetDaltonizerMode(daltonizerMode);
    }
  }
 else {
    nativeSetDaltonizerMode(AccessibilityManager.DALTONIZER_DISABLED);
  }
  if (hasColorTransform) {
    nativeSetColorTransform(colorMatrix);
  }
 else {
    nativeSetColorTransform(null);
  }
}
