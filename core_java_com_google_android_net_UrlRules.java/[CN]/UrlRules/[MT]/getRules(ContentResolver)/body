{
  String digest=Settings.Gservices.getString(resolver,Settings.Gservices.PROVISIONING_DIGEST);
  if (sCachedDigest != null && sCachedDigest.equals(digest)) {
    return sCachedRules;
  }
  Cursor cursor=resolver.query(Settings.Gservices.CONTENT_URI,new String[]{Settings.Gservices.NAME,Settings.Gservices.VALUE},Settings.Gservices.NAME + " like \"url:%\"",null,Settings.Gservices.NAME);
  try {
    ArrayList<Rule> rules=new ArrayList<Rule>();
    while (cursor.moveToNext()) {
      try {
        String name=cursor.getString(0).substring(4);
        String value=cursor.getString(1);
        if (value == null || value.length() == 0)         continue;
        rules.add(new Rule(name,value));
      }
 catch (      RuleFormatException e) {
        Log.e("UrlRules","Invalid rule from Gservices",e);
        Checkin.logEvent(resolver,Checkin.Events.Tag.GSERVICES_ERROR,e.toString());
      }
    }
    sCachedRules=new UrlRules(rules.toArray(new Rule[rules.size()]));
    sCachedDigest=digest;
  }
  finally {
    cursor.close();
  }
  return sCachedRules;
}
