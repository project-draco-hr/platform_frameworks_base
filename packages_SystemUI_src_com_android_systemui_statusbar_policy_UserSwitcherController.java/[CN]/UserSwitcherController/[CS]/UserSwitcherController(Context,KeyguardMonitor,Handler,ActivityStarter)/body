{
  mContext=context;
  mGuestResumeSessionReceiver.register(context);
  mKeyguardMonitor=keyguardMonitor;
  mHandler=handler;
  mActivityStarter=activityStarter;
  mUserManager=UserManager.get(context);
  IntentFilter filter=new IntentFilter();
  filter.addAction(Intent.ACTION_USER_ADDED);
  filter.addAction(Intent.ACTION_USER_REMOVED);
  filter.addAction(Intent.ACTION_USER_INFO_CHANGED);
  filter.addAction(Intent.ACTION_USER_SWITCHED);
  filter.addAction(Intent.ACTION_USER_STOPPED);
  filter.addAction(Intent.ACTION_USER_UNLOCKED);
  mContext.registerReceiverAsUser(mReceiver,UserHandle.SYSTEM,filter,null,null);
  mSecondaryUserServiceIntent=new Intent(context,SystemUISecondaryUserService.class);
  filter=new IntentFilter();
  filter.addAction(ACTION_REMOVE_GUEST);
  filter.addAction(ACTION_LOGOUT_USER);
  mContext.registerReceiverAsUser(mReceiver,UserHandle.SYSTEM,filter,PERMISSION_SELF,null);
  mContext.getContentResolver().registerContentObserver(Settings.Global.getUriFor(SIMPLE_USER_SWITCHER_GLOBAL_SETTING),true,mSettingsObserver);
  mContext.getContentResolver().registerContentObserver(Settings.Global.getUriFor(Settings.Global.ADD_USERS_WHEN_LOCKED),true,mSettingsObserver);
  mContext.getContentResolver().registerContentObserver(Settings.Global.getUriFor(Settings.Global.ALLOW_USER_SWITCHING_WHEN_SYSTEM_USER_LOCKED),true,mSettingsObserver);
  mSettingsObserver.onChange(false);
  keyguardMonitor.addCallback(mCallback);
  listenForCallState();
  refreshUsers(UserHandle.USER_NULL);
}
