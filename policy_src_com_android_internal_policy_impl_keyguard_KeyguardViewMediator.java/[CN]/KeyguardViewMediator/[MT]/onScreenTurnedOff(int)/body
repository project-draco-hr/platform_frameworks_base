{
synchronized (this) {
    mScreenOn=false;
    if (DEBUG)     Log.d(TAG,"onScreenTurnedOff(" + why + ")");
    mKeyguardDonePending=false;
    final boolean lockImmediately=mLockPatternUtils.getPowerButtonInstantlyLocks() || !mLockPatternUtils.isSecure();
    if (mExitSecureCallback != null) {
      if (DEBUG)       Log.d(TAG,"pending exit secure callback cancelled");
      mExitSecureCallback.onKeyguardExitResult(false);
      mExitSecureCallback=null;
      if (!mExternallyEnabled) {
        hideLocked();
      }
    }
 else     if (mShowing) {
      notifyScreenOffLocked();
      resetStateLocked(null);
    }
 else     if (why == WindowManagerPolicy.OFF_BECAUSE_OF_TIMEOUT || (why == WindowManagerPolicy.OFF_BECAUSE_OF_USER && !lockImmediately)) {
      doKeyguardLaterLocked();
    }
 else     if (why == WindowManagerPolicy.OFF_BECAUSE_OF_PROX_SENSOR) {
    }
 else {
      doKeyguardLocked();
    }
  }
}
