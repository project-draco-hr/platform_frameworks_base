{
  super.onAttachedToWindow();
  initGestureDetector();
  if (mHandler == null) {
    mHandler=new Handler(){
      @Override public void handleMessage(      Message msg){
switch (msg.what) {
case MSG_SHOW_PREVIEW:
          showKey(msg.arg1);
        break;
case MSG_REMOVE_PREVIEW:
      mPreviewText.setVisibility(INVISIBLE);
    break;
case MSG_REPEAT:
  if (repeatKey()) {
    Message repeat=Message.obtain(this,MSG_REPEAT);
    sendMessageDelayed(repeat,REPEAT_INTERVAL);
  }
break;
case MSG_LONGPRESS:
openPopupIfRequired((MotionEvent)msg.obj);
break;
}
}
}
;
}
}
