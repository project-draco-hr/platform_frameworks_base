{
  if (mAccessibilityManager.isEnabled()) {
    AccessibilityEvent event=AccessibilityEvent.obtain(eventType);
    onInitializeAccessibilityEvent(event);
    String text=null;
    final boolean speakPassword=Settings.Secure.getIntForUser(mContext.getContentResolver(),Settings.Secure.ACCESSIBILITY_SPEAK_PASSWORD,0,UserHandle.USER_CURRENT_OR_SELF) != 0;
    if (speakPassword || mAudioManager.isBluetoothA2dpOn() || mAudioManager.isWiredHeadsetOn()) {
switch (code) {
case Keyboard.KEYCODE_ALT:
        text=mContext.getString(R.string.keyboardview_keycode_alt);
      break;
case Keyboard.KEYCODE_CANCEL:
    text=mContext.getString(R.string.keyboardview_keycode_cancel);
  break;
case Keyboard.KEYCODE_DELETE:
text=mContext.getString(R.string.keyboardview_keycode_delete);
break;
case Keyboard.KEYCODE_DONE:
text=mContext.getString(R.string.keyboardview_keycode_done);
break;
case Keyboard.KEYCODE_MODE_CHANGE:
text=mContext.getString(R.string.keyboardview_keycode_mode_change);
break;
case Keyboard.KEYCODE_SHIFT:
text=mContext.getString(R.string.keyboardview_keycode_shift);
break;
case '\n':
text=mContext.getString(R.string.keyboardview_keycode_enter);
break;
default :
text=String.valueOf((char)code);
}
}
 else if (!mHeadsetRequiredToHearPasswordsAnnounced) {
if (eventType == AccessibilityEvent.TYPE_VIEW_HOVER_EXIT) {
mHeadsetRequiredToHearPasswordsAnnounced=true;
}
text=mContext.getString(R.string.keyboard_headset_required_to_hear_password);
}
 else {
text=mContext.getString(R.string.keyboard_password_character_no_headset);
}
event.getText().add(text);
mAccessibilityManager.sendAccessibilityEvent(event);
}
}
