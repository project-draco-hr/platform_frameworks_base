{
  final Rect ci=mAttachInfo.mContentInsets;
  final Rect vi=mAttachInfo.mVisibleInsets;
  int scrollY=0;
  boolean handled=false;
  if (vi.left > ci.left || vi.top > ci.top || vi.right > ci.right || vi.bottom > ci.bottom) {
    scrollY=mScrollY;
    final View focus=mView.findFocus();
    if (focus == null) {
      return false;
    }
    View lastScrolledFocus=(mLastScrolledFocus != null) ? mLastScrolledFocus.get() : null;
    if (focus != lastScrolledFocus) {
      rectangle=null;
    }
    if (DEBUG_INPUT_RESIZE)     Log.v(mTag,"Eval scroll: focus=" + focus + " rectangle="+ rectangle+ " ci="+ ci+ " vi="+ vi);
    if (focus == lastScrolledFocus && !mScrollMayChange && rectangle == null) {
      if (DEBUG_INPUT_RESIZE)       Log.v(mTag,"Keeping scroll y=" + mScrollY + " vi="+ vi.toShortString());
    }
 else {
      mLastScrolledFocus=new WeakReference<View>(focus);
      mScrollMayChange=false;
      if (DEBUG_INPUT_RESIZE)       Log.v(mTag,"Need to scroll?");
      if (focus.getGlobalVisibleRect(mVisRect,null)) {
        if (DEBUG_INPUT_RESIZE)         Log.v(mTag,"Root w=" + mView.getWidth() + " h="+ mView.getHeight()+ " ci="+ ci.toShortString()+ " vi="+ vi.toShortString());
        if (rectangle == null) {
          focus.getFocusedRect(mTempRect);
          if (DEBUG_INPUT_RESIZE)           Log.v(mTag,"Focus " + focus + ": focusRect="+ mTempRect.toShortString());
          if (mView instanceof ViewGroup) {
            ((ViewGroup)mView).offsetDescendantRectToMyCoords(focus,mTempRect);
          }
          if (DEBUG_INPUT_RESIZE)           Log.v(mTag,"Focus in window: focusRect=" + mTempRect.toShortString() + " visRect="+ mVisRect.toShortString());
        }
 else {
          mTempRect.set(rectangle);
          if (DEBUG_INPUT_RESIZE)           Log.v(mTag,"Request scroll to rect: " + mTempRect.toShortString() + " visRect="+ mVisRect.toShortString());
        }
        if (mTempRect.intersect(mVisRect)) {
          if (DEBUG_INPUT_RESIZE)           Log.v(mTag,"Focus window visible rect: " + mTempRect.toShortString());
          if (mTempRect.height() > (mView.getHeight() - vi.top - vi.bottom)) {
            if (DEBUG_INPUT_RESIZE)             Log.v(mTag,"Too tall; leaving scrollY=" + scrollY);
          }
 else           if (mTempRect.top < vi.top) {
            scrollY=mTempRect.top - vi.top;
            if (DEBUG_INPUT_RESIZE)             Log.v(mTag,"Top covered; scrollY=" + scrollY);
          }
 else           if (mTempRect.bottom > (mView.getHeight() - vi.bottom)) {
            scrollY=mTempRect.bottom - (mView.getHeight() - vi.bottom);
            if (DEBUG_INPUT_RESIZE)             Log.v(mTag,"Bottom covered; scrollY=" + scrollY);
          }
 else {
            scrollY=0;
          }
          handled=true;
        }
      }
    }
  }
  if (scrollY != mScrollY) {
    if (DEBUG_INPUT_RESIZE)     Log.v(mTag,"Pan scroll changed: old=" + mScrollY + " , new="+ scrollY);
    if (!immediate) {
      if (mScroller == null) {
        mScroller=new Scroller(mView.getContext());
      }
      mScroller.startScroll(0,mScrollY,0,scrollY - mScrollY);
    }
 else     if (mScroller != null) {
      mScroller.abortAnimation();
    }
    mScrollY=scrollY;
  }
  return handled;
}
