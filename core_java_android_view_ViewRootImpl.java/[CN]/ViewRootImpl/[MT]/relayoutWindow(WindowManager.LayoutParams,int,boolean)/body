{
  float appScale=mAttachInfo.mApplicationScale;
  boolean restore=false;
  if (params != null && mTranslator != null) {
    restore=true;
    params.backup();
    mTranslator.translateWindowLayout(params);
  }
  if (params != null) {
    if (DBG)     Log.d(TAG,"WindowLayout in layoutWindow:" + params);
  }
  mPendingConfiguration.seq=0;
  if (params != null && mOrigWindowType != params.type) {
    if (mTargetSdkVersion < Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
      Slog.w(TAG,"Window type can not be changed after " + "the window is added; ignoring change of " + mView);
      params.type=mOrigWindowType;
    }
  }
  int relayoutResult=mWindowSession.relayout(mWindow,mSeq,params,(int)(mView.getMeasuredWidth() * appScale + 0.5f),(int)(mView.getMeasuredHeight() * appScale + 0.5f),viewVisibility,insetsPending ? WindowManagerGlobal.RELAYOUT_INSETS_PENDING : 0,mWinFrame,mPendingOverscanInsets,mPendingContentInsets,mPendingVisibleInsets,mPendingStableInsets,mPendingConfiguration,mSurface);
  if (restore) {
    params.restore();
  }
  if (mTranslator != null) {
    mTranslator.translateRectInScreenToAppWinFrame(mWinFrame);
    mTranslator.translateRectInScreenToAppWindow(mPendingOverscanInsets);
    mTranslator.translateRectInScreenToAppWindow(mPendingContentInsets);
    mTranslator.translateRectInScreenToAppWindow(mPendingVisibleInsets);
    mTranslator.translateRectInScreenToAppWindow(mPendingStableInsets);
  }
  return relayoutResult;
}
