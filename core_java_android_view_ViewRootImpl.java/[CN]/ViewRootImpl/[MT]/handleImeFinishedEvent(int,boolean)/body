{
  QueuedInputEvent q=mCurrentInputEventHead;
  if (q != null && q.mEvent.getSequenceNumber() == seq) {
    dequeueCurrentInputEvent();
    if (DEBUG_IMF) {
      Log.v(TAG,"IME finished event: seq=" + seq + " handled="+ handled+ " event="+ q);
    }
    if (!handled) {
      if (!mAttachInfo.mHasWindowFocus && !isTerminalInputEvent(q.mEvent)) {
        Slog.w(TAG,"Dropping event due to no window focus: " + q.mEvent);
      }
 else {
        final int result=deliverInputEventPostIme(q);
        if (result == EVENT_HANDLED) {
          handled=true;
        }
      }
    }
    finishInputEvent(q,handled);
    while (mCurrentInputEventHead != null && (mCurrentInputEventHead.mFlags & QueuedInputEvent.FLAG_DELIVER_POST_IME) != 0) {
      q=dequeueCurrentInputEvent();
      final int result=deliverInputEventPostIme(q);
      finishInputEvent(q,result == EVENT_HANDLED);
    }
  }
 else {
    if (DEBUG_IMF) {
      Log.v(TAG,"IME finished event: seq=" + seq + " handled="+ handled+ ", event not found!");
    }
  }
}
