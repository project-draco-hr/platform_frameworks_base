{
  final ArrayList<AccountAndUser> runningAccounts=Lists.newArrayList();
synchronized (mUsers) {
    for (    int userId : userIds) {
      UserAccounts userAccounts=getUserAccounts(userId);
      if (userAccounts == null)       continue;
synchronized (userAccounts.cacheLock) {
        Account[] accounts=getAccountsFromCacheLocked(userAccounts,null);
        for (int a=0; a < accounts.length; a++) {
          runningAccounts.add(new AccountAndUser(accounts[a],userId));
        }
      }
    }
  }
  AccountAndUser[] accountsArray=new AccountAndUser[runningAccounts.size()];
  return runningAccounts.toArray(accountsArray);
}
