{
  String mainDir;
  String filesDir;
  String dbDir;
  String spDir;
  String cacheDir;
  String libDir;
  String efDir=null;
  String filePath;
  ApplicationInfo appInfo=getApplicationInfo();
  try {
    mainDir=new File(appInfo.dataDir).getCanonicalPath();
    filesDir=getFilesDir().getCanonicalPath();
    dbDir=getDatabasePath("foo").getParentFile().getCanonicalPath();
    spDir=getSharedPrefsFile("foo").getParentFile().getCanonicalPath();
    cacheDir=getCacheDir().getCanonicalPath();
    libDir=(appInfo.nativeLibraryDir == null) ? null : new File(appInfo.nativeLibraryDir).getCanonicalPath();
    if (Process.myUid() != Process.SYSTEM_UID) {
      File efLocation=getExternalFilesDir(null);
      if (efLocation != null) {
        efDir=efLocation.getCanonicalPath();
      }
    }
    filePath=file.getCanonicalPath();
  }
 catch (  IOException e) {
    Log.w(TAG,"Unable to obtain canonical paths");
    return;
  }
  if (filePath.startsWith(cacheDir) || filePath.startsWith(libDir)) {
    Log.w(TAG,"lib and cache files are not backed up");
    return;
  }
  final String domain;
  String rootpath=null;
  if (filePath.startsWith(dbDir)) {
    domain=FullBackup.DATABASE_TREE_TOKEN;
    rootpath=dbDir;
  }
 else   if (filePath.startsWith(spDir)) {
    domain=FullBackup.SHAREDPREFS_TREE_TOKEN;
    rootpath=spDir;
  }
 else   if (filePath.startsWith(filesDir)) {
    domain=FullBackup.DATA_TREE_TOKEN;
    rootpath=filesDir;
  }
 else   if (filePath.startsWith(mainDir)) {
    domain=FullBackup.ROOT_TREE_TOKEN;
    rootpath=mainDir;
  }
 else   if ((efDir != null) && filePath.startsWith(efDir)) {
    domain=FullBackup.MANAGED_EXTERNAL_TREE_TOKEN;
    rootpath=efDir;
  }
 else {
    Log.w(TAG,"File " + filePath + " is in an unsupported location; skipping");
    return;
  }
  Log.i(TAG,"backupFile() of " + filePath + " => domain="+ domain+ " rootpath="+ rootpath);
  FullBackup.backupToTar(getPackageName(),domain,null,rootpath,filePath,output.getData());
}
