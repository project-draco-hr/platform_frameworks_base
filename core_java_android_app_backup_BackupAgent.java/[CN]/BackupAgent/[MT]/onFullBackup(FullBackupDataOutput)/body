{
  FullBackup.BackupScheme backupScheme=FullBackup.getBackupScheme(this);
  if (!backupScheme.isFullBackupContentEnabled()) {
    return;
  }
  Map<String,Set<String>> manifestIncludeMap;
  ArraySet<String> manifestExcludeSet;
  try {
    manifestIncludeMap=backupScheme.maybeParseAndGetCanonicalIncludePaths();
    manifestExcludeSet=backupScheme.maybeParseAndGetCanonicalExcludePaths();
  }
 catch (  IOException|XmlPullParserException e) {
    if (Log.isLoggable(FullBackup.TAG_XML_PARSER,Log.VERBOSE)) {
      Log.v(FullBackup.TAG_XML_PARSER,"Exception trying to parse fullBackupContent xml file!" + " Aborting full backup.",e);
    }
    return;
  }
  final String packageName=getPackageName();
  final ApplicationInfo appInfo=getApplicationInfo();
  String rootDir=new File(appInfo.dataDir).getCanonicalPath();
  String filesDir=getFilesDir().getCanonicalPath();
  String nobackupDir=getNoBackupFilesDir().getCanonicalPath();
  String databaseDir=getDatabasePath("foo").getParentFile().getCanonicalPath();
  String sharedPrefsDir=getSharedPrefsFile("foo").getParentFile().getCanonicalPath();
  String cacheDir=getCacheDir().getCanonicalPath();
  String codeCacheDir=getCodeCacheDir().getCanonicalPath();
  String libDir=(appInfo.nativeLibraryDir != null) ? new File(appInfo.nativeLibraryDir).getCanonicalPath() : null;
  final ArraySet<String> traversalExcludeSet=new ArraySet<String>();
  traversalExcludeSet.add(cacheDir);
  traversalExcludeSet.add(codeCacheDir);
  traversalExcludeSet.add(nobackupDir);
  if (libDir != null) {
    traversalExcludeSet.add(libDir);
  }
  traversalExcludeSet.add(databaseDir);
  traversalExcludeSet.add(sharedPrefsDir);
  traversalExcludeSet.add(filesDir);
  applyXmlFiltersAndDoFullBackupForDomain(packageName,FullBackup.ROOT_TREE_TOKEN,manifestIncludeMap,manifestExcludeSet,traversalExcludeSet,data);
  traversalExcludeSet.add(rootDir);
  traversalExcludeSet.remove(filesDir);
  applyXmlFiltersAndDoFullBackupForDomain(packageName,FullBackup.DATA_TREE_TOKEN,manifestIncludeMap,manifestExcludeSet,traversalExcludeSet,data);
  traversalExcludeSet.add(filesDir);
  traversalExcludeSet.remove(databaseDir);
  applyXmlFiltersAndDoFullBackupForDomain(packageName,FullBackup.DATABASE_TREE_TOKEN,manifestIncludeMap,manifestExcludeSet,traversalExcludeSet,data);
  traversalExcludeSet.add(databaseDir);
  traversalExcludeSet.remove(sharedPrefsDir);
  applyXmlFiltersAndDoFullBackupForDomain(packageName,FullBackup.SHAREDPREFS_TREE_TOKEN,manifestIncludeMap,manifestExcludeSet,traversalExcludeSet,data);
  traversalExcludeSet.add(sharedPrefsDir);
  if (Process.myUid() != Process.SYSTEM_UID) {
    File efLocation=getExternalFilesDir(null);
    if (efLocation != null) {
      applyXmlFiltersAndDoFullBackupForDomain(packageName,FullBackup.MANAGED_EXTERNAL_TREE_TOKEN,manifestIncludeMap,manifestExcludeSet,traversalExcludeSet,data);
    }
  }
}
