{
  if (mSurfaceSession == null) {
    mSurfaceSession=new SurfaceSession();
  }
  Surface.openTransaction();
  try {
    if (mSurface == null) {
      try {
        int flags;
        if (mMode == MODE_FADE) {
          flags=Surface.FX_SURFACE_DIM | Surface.HIDDEN;
        }
 else {
          flags=Surface.OPAQUE | Surface.HIDDEN;
        }
        mSurface=new Surface(mSurfaceSession,"ElectronBeam",mDisplayWidth,mDisplayHeight,PixelFormat.OPAQUE,flags);
      }
 catch (      Surface.OutOfResourcesException ex) {
        Slog.e(TAG,"Unable to create surface.",ex);
        return false;
      }
    }
    mSurface.setLayerStack(mDisplayLayerStack);
    mSurface.setSize(mDisplayWidth,mDisplayHeight);
switch (mDisplayRotation) {
case Surface.ROTATION_0:
      mSurface.setPosition(0,0);
    mSurface.setMatrix(1,0,0,1);
  break;
case Surface.ROTATION_90:
mSurface.setPosition(0,mDisplayWidth);
mSurface.setMatrix(0,-1,1,0);
break;
case Surface.ROTATION_180:
mSurface.setPosition(mDisplayWidth,mDisplayHeight);
mSurface.setMatrix(-1,0,0,-1);
break;
case Surface.ROTATION_270:
mSurface.setPosition(mDisplayHeight,0);
mSurface.setMatrix(0,1,-1,0);
break;
}
}
  finally {
Surface.closeTransaction();
}
return true;
}
