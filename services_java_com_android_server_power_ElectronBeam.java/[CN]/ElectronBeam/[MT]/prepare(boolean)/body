{
  if (DEBUG) {
    Slog.d(TAG,"prepare: warmUp=" + warmUp);
  }
  mWarmUp=warmUp;
  Display display=WindowManagerImpl.getDefault().getDefaultDisplay();
  display.getDisplayInfo(mDisplayInfo);
  mDisplayLayerStack=display.getDisplayId();
  mDisplayRotation=mDisplayInfo.rotation;
  if (mDisplayRotation == Surface.ROTATION_90 || mDisplayRotation == Surface.ROTATION_270) {
    mDisplayWidth=mDisplayInfo.logicalHeight;
    mDisplayHeight=mDisplayInfo.logicalWidth;
  }
 else {
    mDisplayWidth=mDisplayInfo.logicalWidth;
    mDisplayHeight=mDisplayInfo.logicalHeight;
  }
  if (!createEglContext() || !createEglSurface() || !captureScreenshotTextureAndSetViewport()) {
    dismiss();
    return false;
  }
  mPrepared=true;
  return true;
}
