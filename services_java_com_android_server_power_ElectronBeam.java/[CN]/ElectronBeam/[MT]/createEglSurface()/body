{
  if (mSurfaceSession == null) {
    mSurfaceSession=new SurfaceSession();
  }
  Surface.openTransaction();
  try {
    if (mSurface == null) {
      try {
        mSurface=new Surface(mSurfaceSession,Process.myPid(),"ElectronBeam",mDisplayLayerStack,mDisplayWidth,mDisplayHeight,PixelFormat.OPAQUE,Surface.OPAQUE | Surface.HIDDEN);
      }
 catch (      Surface.OutOfResourcesException ex) {
        Slog.e(TAG,"Unable to create surface.",ex);
        return false;
      }
    }
    mSurface.setSize(mDisplayWidth,mDisplayHeight);
switch (mDisplayRotation) {
case Surface.ROTATION_0:
      mSurface.setPosition(0,0);
    mSurface.setMatrix(1,0,0,1);
  break;
case Surface.ROTATION_90:
mSurface.setPosition(0,mDisplayWidth);
mSurface.setMatrix(0,-1,1,0);
break;
case Surface.ROTATION_180:
mSurface.setPosition(mDisplayWidth,mDisplayHeight);
mSurface.setMatrix(-1,0,0,-1);
break;
case Surface.ROTATION_270:
mSurface.setPosition(mDisplayHeight,0);
mSurface.setMatrix(0,1,-1,0);
break;
}
}
  finally {
Surface.closeTransaction();
}
if (mEglSurface == null) {
int[] eglSurfaceAttribList=new int[]{EGL14.EGL_NONE};
mEglSurface=EGL14.eglCreateWindowSurface(mEglDisplay,mEglConfig,mSurface,eglSurfaceAttribList,0);
if (mEglSurface == null) {
logEglError("eglCreateWindowSurface");
return false;
}
}
return true;
}
