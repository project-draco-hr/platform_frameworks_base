{
  mGroupLabelCache=new HashMap<String,CharSequence>();
  mGroupLabelCache.put(mDefaultGrpName,mDefaultGrpLabel);
  mNewMap=new HashMap<String,CharSequence>();
  mDangerousMap=new HashMap<String,CharSequence>();
  mNormalMap=new HashMap<String,CharSequence>();
  Map<String,List<MyPermissionInfo>> newMap=new HashMap<String,List<MyPermissionInfo>>();
  Map<String,List<MyPermissionInfo>> dangerousMap=new HashMap<String,List<MyPermissionInfo>>();
  Map<String,List<MyPermissionInfo>> normalMap=new HashMap<String,List<MyPermissionInfo>>();
  PermissionInfoComparator permComparator=new PermissionInfoComparator(mPm);
  if (permList != null) {
    for (    MyPermissionInfo pInfo : permList) {
      if (localLOGV)       Log.i(TAG,"Processing permission:" + pInfo.name);
      if (!isDisplayablePermission(pInfo,pInfo.mNewReqFlags,pInfo.mExistingReqFlags)) {
        if (localLOGV)         Log.i(TAG,"Permission:" + pInfo.name + " is not displayable");
        continue;
      }
      Map<String,List<MyPermissionInfo>> permInfoMap;
      if (pInfo.mNew) {
        permInfoMap=newMap;
      }
 else       if ((pInfo.protectionLevel & PermissionInfo.PROTECTION_MASK_BASE) == PermissionInfo.PROTECTION_DANGEROUS) {
        permInfoMap=dangerousMap;
      }
 else {
        permInfoMap=normalMap;
      }
      String grpName=(pInfo.group == null) ? mDefaultGrpName : pInfo.group;
      if (localLOGV)       Log.i(TAG,"Permission:" + pInfo.name + " belongs to group:"+ grpName);
      List<MyPermissionInfo> grpPermsList=permInfoMap.get(grpName);
      if (grpPermsList == null) {
        grpPermsList=new ArrayList<MyPermissionInfo>();
        permInfoMap.put(grpName,grpPermsList);
        grpPermsList.add(pInfo);
      }
 else {
        int idx=Collections.binarySearch(grpPermsList,pInfo,permComparator);
        if (localLOGV)         Log.i(TAG,"idx=" + idx + ", list.size="+ grpPermsList.size());
        if (idx < 0) {
          idx=-idx - 1;
          grpPermsList.add(idx,pInfo);
        }
      }
    }
    aggregateGroupDescs(newMap,mNewMap,true);
    aggregateGroupDescs(dangerousMap,mDangerousMap,false);
    aggregateGroupDescs(normalMap,mNormalMap,false);
  }
  mCurrentState=State.NO_PERMS;
  if (mNewMap.size() > 0 || mDangerousMap.size() > 0) {
    mCurrentState=(mNormalMap.size() > 0) ? State.BOTH : State.DANGEROUS_ONLY;
  }
 else   if (mNormalMap.size() > 0) {
    mCurrentState=State.NORMAL_ONLY;
  }
  if (localLOGV)   Log.i(TAG,"mCurrentState=" + mCurrentState);
  showPermissions();
}
