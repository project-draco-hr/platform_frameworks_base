{
  List<ApplicationInfo> restoredApps=new ArrayList<ApplicationInfo>();
  HashMap<String,Metadata> sigMap=new HashMap<String,Metadata>();
  while (data.readNextHeader()) {
    int dataSize=data.getDataSize();
    byte[] buf=new byte[dataSize];
    data.readEntityData(buf,0,dataSize);
    ByteArrayInputStream bufStream=new ByteArrayInputStream(buf);
    DataInputStream in=new DataInputStream(bufStream);
    int versionCode=in.readInt();
    Signature[] sigs=unflattenSignatureArray(in);
    String pkg=data.getKey();
    if (DEBUG) {
      Log.i(TAG,"+ restored metadata for " + pkg + " versionCode="+ versionCode+ " sigs="+ sigs);
    }
    ApplicationInfo app=new ApplicationInfo();
    app.packageName=pkg;
    restoredApps.add(app);
    sigMap.put(pkg,new Metadata(versionCode,sigs));
  }
  mRestoredSignatures=sigMap;
}
