{
  Frame input=pullInput("image");
  FrameFormat inputFormat=input.getFormat();
  if (mProgram == null || inputFormat.getTarget() != mTarget) {
    initProgram(context,inputFormat.getTarget());
  }
  if (inputFormat.getWidth() != mWidth || inputFormat.getHeight() != mHeight) {
    mWidth=inputFormat.getWidth();
    mHeight=inputFormat.getHeight();
    int[] buffer=new int[mWidth * mHeight];
    for (int i=0; i < mWidth * mHeight; ++i) {
      buffer[i]=mRandom.nextInt(255);
    }
    FrameFormat format=ImageFormat.create(mWidth,mHeight,ImageFormat.COLORSPACE_RGBA,FrameFormat.TARGET_GPU);
    if (mNoiseFrame != null) {
      mNoiseFrame.release();
    }
    mNoiseFrame=context.getFrameManager().newFrame(format);
    mNoiseFrame.setInts(buffer);
    initParameters();
  }
  if (mNoiseFrame != null && (mNoiseFrame.getFormat().getWidth() != mWidth || mNoiseFrame.getFormat().getHeight() != mHeight)) {
    throw new RuntimeException("Random map and imput image size mismatch!");
  }
  Frame output=context.getFrameManager().newFrame(inputFormat);
  Frame[] inputs={input,mNoiseFrame};
  mProgram.process(inputs,output);
  pushOutput("image",output);
  output.release();
}
