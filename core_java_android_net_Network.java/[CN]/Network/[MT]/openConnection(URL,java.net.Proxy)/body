{
  if (proxy == null)   throw new IllegalArgumentException("proxy is null");
  maybeInitHttpClient();
  String protocol=url.getProtocol();
  OkUrlFactory okUrlFactory;
  if (protocol.equals("http")) {
    okUrlFactory=HttpHandler.createHttpOkUrlFactory(proxy);
  }
 else   if (protocol.equals("https")) {
    okUrlFactory=HttpsHandler.createHttpsOkUrlFactory(proxy);
  }
 else {
    throw new MalformedURLException("Invalid URL or unrecognized protocol " + protocol);
  }
  OkHttpClient client=okUrlFactory.client();
  client.setSocketFactory(getSocketFactory()).setConnectionPool(mConnectionPool);
  client.setDns(mDns);
  return okUrlFactory.open(url);
}
