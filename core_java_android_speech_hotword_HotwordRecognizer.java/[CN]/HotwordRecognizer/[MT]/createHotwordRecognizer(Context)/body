{
  ComponentName serviceComponent=null;
  final List<ResolveInfo> list=context.getPackageManager().queryIntentServices(new Intent(HotwordRecognitionService.SERVICE_INTERFACE),0);
  for (int i=0; i < list.size(); i++) {
    final ResolveInfo ri=list.get(i);
    if (!ri.serviceInfo.enabled) {
      continue;
    }
    if ((ri.serviceInfo.applicationInfo.flags & ApplicationInfo.FLAG_SYSTEM) != PackageManager.MATCH_DEFAULT_ONLY) {
      serviceComponent=new ComponentName(ri.serviceInfo.packageName,ri.serviceInfo.name);
      break;
    }
  }
  if (serviceComponent == null && !list.isEmpty()) {
    serviceComponent=new ComponentName(list.get(0).serviceInfo.packageName,list.get(0).serviceInfo.name);
  }
  return createHotwordRecognizer(context,serviceComponent);
}
