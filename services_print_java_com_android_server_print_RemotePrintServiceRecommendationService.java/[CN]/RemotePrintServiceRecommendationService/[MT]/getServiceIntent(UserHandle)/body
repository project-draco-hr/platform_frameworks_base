{
  List<ResolveInfo> installedServices=mContext.getPackageManager().queryIntentServicesAsUser(new Intent(android.printservice.recommendation.RecommendationService.SERVICE_INTERFACE),GET_SERVICES | GET_META_DATA | MATCH_DEBUG_TRIAGED_MISSING,userHandle.getIdentifier());
  if (installedServices.size() != 1) {
    throw new Exception(installedServices.size() + " instead of exactly one service found");
  }
  ResolveInfo installedService=installedServices.get(0);
  ComponentName serviceName=new ComponentName(installedService.serviceInfo.packageName,installedService.serviceInfo.name);
  ApplicationInfo appInfo=mContext.getPackageManager().getApplicationInfo(installedService.serviceInfo.packageName,0);
  if (appInfo == null) {
    throw new Exception("Cannot read appInfo for service");
  }
  if ((appInfo.flags & ApplicationInfo.FLAG_SYSTEM) == 0) {
    throw new Exception("Service is not part of the system");
  }
  if (!android.Manifest.permission.BIND_PRINT_RECOMMENDATION_SERVICE.equals(installedService.serviceInfo.permission)) {
    throw new Exception("Service " + serviceName.flattenToShortString() + " does not require permission "+ android.Manifest.permission.BIND_PRINT_RECOMMENDATION_SERVICE);
  }
  Intent serviceIntent=new Intent();
  serviceIntent.setComponent(serviceName);
  return serviceIntent;
}
