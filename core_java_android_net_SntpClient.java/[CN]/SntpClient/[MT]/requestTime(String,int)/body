{
  try {
    DatagramSocket socket=new DatagramSocket();
    socket.setSoTimeout(timeout);
    InetAddress address=InetAddress.getByName(host);
    byte[] buffer=new byte[NTP_PACKET_SIZE];
    DatagramPacket request=new DatagramPacket(buffer,buffer.length,address,NTP_PORT);
    buffer[0]=NTP_MODE_CLIENT | (NTP_VERSION << 3);
    long requestTime=System.currentTimeMillis();
    long requestTicks=SystemClock.elapsedRealtime();
    writeTimeStamp(buffer,TRANSMIT_TIME_OFFSET,requestTime);
    socket.send(request);
    DatagramPacket response=new DatagramPacket(buffer,buffer.length);
    socket.receive(response);
    long responseTicks=SystemClock.elapsedRealtime();
    long responseTime=requestTime + (responseTicks - requestTicks);
    socket.close();
    long originateTime=readTimeStamp(buffer,ORIGINATE_TIME_OFFSET);
    long receiveTime=readTimeStamp(buffer,RECEIVE_TIME_OFFSET);
    long transmitTime=readTimeStamp(buffer,TRANSMIT_TIME_OFFSET);
    long roundTripTime=responseTicks - requestTicks - (transmitTime - receiveTime);
    long clockOffset=(receiveTime - originateTime) + (transmitTime - responseTime);
    if (Config.LOGD)     Log.d(TAG,"round trip: " + roundTripTime + " ms");
    if (Config.LOGD)     Log.d(TAG,"clock offset: " + clockOffset + " ms");
    mNtpTime=requestTime + clockOffset;
    mNtpTimeReference=requestTicks;
    mRoundTripTime=roundTripTime;
  }
 catch (  Exception e) {
    if (Config.LOGD)     Log.d(TAG,"request time failed: " + e);
    return false;
  }
  return true;
}
