{
  if (mChunkedStreamer != null) {
    return;
  }
  if (mKey == null) {
    throw new IllegalStateException("Not initialized");
  }
  KeymasterArguments keymasterArgs=new KeymasterArguments();
  keymasterArgs.addInt(KeymasterDefs.KM_TAG_ALGORITHM,KeymasterDefs.KM_ALGORITHM_HMAC);
  keymasterArgs.addInt(KeymasterDefs.KM_TAG_DIGEST,mKeymasterDigest);
  OperationResult opResult=mKeyStore.begin(mKey.getAlias(),KeymasterDefs.KM_PURPOSE_SIGN,true,keymasterArgs,null,new KeymasterArguments());
  if (opResult == null) {
    throw new KeyStoreConnectException();
  }
 else   if (opResult.resultCode != KeyStore.NO_ERROR) {
    throw KeyStore.getCryptoOperationException(opResult.resultCode);
  }
  if (opResult.token == null) {
    throw new CryptoOperationException("Keystore returned null operation token");
  }
  mOperationToken=opResult.token;
  mOperationHandle=opResult.operationHandle;
  mChunkedStreamer=new KeyStoreCryptoOperationChunkedStreamer(new KeyStoreCryptoOperationChunkedStreamer.MainDataStream(mKeyStore,mOperationToken));
}
