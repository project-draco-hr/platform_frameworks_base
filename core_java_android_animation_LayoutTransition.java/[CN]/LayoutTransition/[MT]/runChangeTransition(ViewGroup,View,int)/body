{
  staggerDelay=0;
  final ViewTreeObserver observer=parent.getViewTreeObserver();
  int numChildren=parent.getChildCount();
  for (int i=0; i < numChildren; ++i) {
    final View child=parent.getChildAt(i);
    if (child != newView) {
      Animatable currentAnimation=currentAnimations.get(child);
      if (currentAnimation != null) {
        currentAnimation.cancel();
        currentAnimations.remove(child);
      }
      final Animatable anim=(changeReason == APPEARING) ? mChangingAppearingAnim.clone() : mChangingDisappearingAnim.clone();
      anim.setTarget(child);
      anim.setupStartValues();
      View.OnLayoutChangeListener listener=new View.OnLayoutChangeListener(){
        public void onLayoutChange(        View v,        int left,        int top,        int right,        int bottom,        int oldLeft,        int oldTop,        int oldRight,        int oldBottom){
          currentAnimations.put(child,anim);
          anim.setupEndValues();
          long startDelay;
          long duration;
          if (changeReason == APPEARING) {
            startDelay=mChangingAppearingDelay + staggerDelay;
            staggerDelay+=mChangingAppearingStagger;
            duration=mChangingAppearingDuration;
          }
 else {
            startDelay=mChangingDisappearingDelay + staggerDelay;
            staggerDelay+=mChangingDisappearingStagger;
            duration=mChangingDisappearingDuration;
          }
          anim.setStartDelay(startDelay);
          anim.setDuration(duration);
          anim.addListener(new AnimatableListenerAdapter(){
            private boolean canceled=false;
            public void onAnimationCancel(            Animatable animatable){
              canceled=true;
            }
            public void onAnimationEnd(            Animatable animatable){
              if (!canceled) {
                currentAnimations.remove(child);
              }
            }
          }
);
          if (anim instanceof PropertyAnimator) {
            ((PropertyAnimator)anim).setCurrentPlayTime(0);
          }
          anim.start();
          child.removeOnLayoutChangeListener(this);
          layoutChangeListenerMap.remove(child);
        }
      }
;
      child.addOnLayoutChangeListener(listener);
      layoutChangeListenerMap.put(child,listener);
    }
  }
  observer.addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener(){
    public boolean onPreDraw(){
      observer.removeOnPreDrawListener(this);
      int numChildren=parent.getChildCount();
      for (int i=0; i < numChildren; ++i) {
        final View child=parent.getChildAt(i);
        child.removeOnLayoutChangeListener(layoutChangeListenerMap.get(child));
      }
      layoutChangeListenerMap.clear();
      return true;
    }
  }
);
}
