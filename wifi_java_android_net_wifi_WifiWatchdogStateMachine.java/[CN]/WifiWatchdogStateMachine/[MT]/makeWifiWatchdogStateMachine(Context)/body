{
  ContentResolver contentResolver=context.getContentResolver();
  ConnectivityManager cm=(ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);
  sWifiOnly=(cm.isNetworkSupported(ConnectivityManager.TYPE_MOBILE) == false);
  putSettingsGlobalBoolean(contentResolver,Settings.Global.WIFI_WATCHDOG_ON,true);
  if (sWifiOnly) {
    logd("Disabling poor network avoidance for wi-fi only device");
    putSettingsGlobalBoolean(contentResolver,Settings.Global.WIFI_WATCHDOG_POOR_NETWORK_TEST_ENABLED,false);
  }
  WifiWatchdogStateMachine wwsm=new WifiWatchdogStateMachine(context);
  wwsm.start();
  return wwsm;
}
