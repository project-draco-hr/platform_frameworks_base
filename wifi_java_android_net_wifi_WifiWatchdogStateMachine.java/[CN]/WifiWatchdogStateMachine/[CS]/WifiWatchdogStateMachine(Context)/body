{
  super(WWSM_TAG);
  mContext=context;
  mContentResolver=context.getContentResolver();
  mWifiManager=(WifiManager)context.getSystemService(Context.WIFI_SERVICE);
  mDnsPinger=new DnsPinger("WifiWatchdogServer.DnsPinger",context,ConnectivityManager.TYPE_WIFI);
  setupNetworkReceiver();
  registerForSettingsChanges();
  registerForWatchdogToggle();
  addState(mDefaultState);
  addState(mWatchdogDisabledState,mDefaultState);
  addState(mWatchdogEnabledState,mDefaultState);
  addState(mNotConnectedState,mWatchdogEnabledState);
  addState(mConnectedState,mWatchdogEnabledState);
  addState(mDnsCheckingState,mConnectedState);
  addState(mDnsCheckFailureState,mConnectedState);
  addState(mWalledGardenState,mConnectedState);
  addState(mBlacklistedApState,mConnectedState);
  addState(mOnlineWatchState,mConnectedState);
  setInitialState(mWatchdogDisabledState);
  updateSettings();
  mShowDisabledNotification=getSettingsBoolean(mContentResolver,Settings.Secure.WIFI_WATCHDOG_SHOW_DISABLED_NETWORK_POPUP,true);
}
