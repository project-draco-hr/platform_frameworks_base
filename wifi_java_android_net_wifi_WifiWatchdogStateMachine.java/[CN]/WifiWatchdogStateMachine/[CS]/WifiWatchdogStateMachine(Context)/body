{
  super(TAG);
  mContext=context;
  mContentResolver=context.getContentResolver();
  mWifiManager=(WifiManager)context.getSystemService(Context.WIFI_SERVICE);
  mWsmChannel.connectSync(mContext,getHandler(),mWifiManager.getWifiStateMachineMessenger());
  setupNetworkReceiver();
  registerForSettingsChanges();
  registerForWatchdogToggle();
  addState(mDefaultState);
  addState(mWatchdogDisabledState,mDefaultState);
  addState(mWatchdogEnabledState,mDefaultState);
  addState(mNotConnectedState,mWatchdogEnabledState);
  addState(mVerifyingLinkState,mWatchdogEnabledState);
  addState(mConnectedState,mWatchdogEnabledState);
  addState(mOnlineWatchState,mConnectedState);
  addState(mLinkMonitoringState,mConnectedState);
  addState(mOnlineState,mConnectedState);
  if (isWatchdogEnabled()) {
    setInitialState(mNotConnectedState);
  }
 else {
    setInitialState(mWatchdogDisabledState);
  }
  setLogRecSize(25);
  setLogOnlyTransitions(true);
  updateSettings();
}
