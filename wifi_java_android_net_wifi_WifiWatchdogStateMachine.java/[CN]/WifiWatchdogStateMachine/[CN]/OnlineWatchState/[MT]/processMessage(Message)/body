{
switch (msg.what) {
case EVENT_RSSI_CHANGE:
    int signalLevel=WifiManager.calculateSignalLevel(msg.arg1,WifiManager.RSSI_LEVELS);
  if (DBG)   log("RSSI change old: " + mCurrentSignalLevel + "new: "+ signalLevel);
mCurrentSignalLevel=signalLevel;
handleRssiChange();
break;
case CMD_ARP_CHECK:
if (msg.arg1 == mArpToken) {
if (doArpTest(SINGLE_ARP_CHECK) != true) {
if (DBG) log("single ARP fail, full ARP check");
if (doArpTest(FULL_ARP_CHECK) != true) {
if (DBG) log("notify full ARP fail, level: " + mCurrentSignalLevel);
mWsmChannel.sendMessage(POOR_LINK_DETECTED);
}
}
if (mCurrentSignalLevel <= RSSI_LEVEL_MONITOR) {
if (DBG) log("Continue ARP check, rssi level: " + mCurrentSignalLevel);
sendMessageDelayed(obtainMessage(CMD_ARP_CHECK,++mArpToken,0),mArpCheckIntervalMs);
}
}
break;
default :
return NOT_HANDLED;
}
return HANDLED;
}
