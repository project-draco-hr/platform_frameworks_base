{
  if (msg.what != DnsPinger.DNS_PING_RESULT) {
    return NOT_HANDLED;
  }
  int pingID=msg.arg1;
  int pingResponseTime=msg.arg2;
  Integer dnsServerId=idDnsMap.get(pingID);
  if (dnsServerId == null) {
    loge("Received a Dns response with unknown ID!");
    return HANDLED;
  }
  idDnsMap.remove(pingID);
  if (pingResponseTime >= 0)   dnsCheckSuccesses[dnsServerId]++;
  if (DBG) {
    if (pingResponseTime >= 0) {
      dnsResponseStrs[dnsServerId]+="|" + pingResponseTime;
    }
 else {
      dnsResponseStrs[dnsServerId]+="|x";
    }
  }
  if (dnsCheckSuccesses[dnsServerId] >= mMinDnsResponses) {
    if (DBG) {
      log(makeLogString() + "  SUCCESS");
    }
    if (!shouldCheckWalledGarden()) {
      transitionTo(mOnlineWatchState);
      return HANDLED;
    }
    mLastWalledGardenCheckTime=SystemClock.elapsedRealtime();
    if (isWalledGardenConnection()) {
      if (DBG)       log("Walled garden test complete - walled garden detected");
      transitionTo(mWalledGardenState);
    }
 else {
      if (DBG)       log("Walled garden test complete - online");
      transitionTo(mOnlineWatchState);
    }
    return HANDLED;
  }
  if (idDnsMap.isEmpty()) {
    if (DBG) {
      log(makeLogString() + "  FAILURE");
    }
    transitionTo(mDnsCheckFailureState);
    return HANDLED;
  }
  return HANDLED;
}
