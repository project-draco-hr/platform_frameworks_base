{
  if (msg.what != DnsPinger.DNS_PING_RESULT) {
    return NOT_HANDLED;
  }
  int pingID=msg.arg1;
  int pingResponseTime=msg.arg2;
  if (!ids.contains(pingID)) {
    Slog.w(WWSM_TAG,"Received a Dns response with unknown ID!");
    return HANDLED;
  }
  ids.remove(pingID);
  dnsCheckTries++;
  if (pingResponseTime >= 0)   dnsCheckSuccesses++;
  if (DBG) {
    if (pingResponseTime >= 0) {
      dnsCheckLogStr+="|" + pingResponseTime;
    }
 else {
      dnsCheckLogStr+="|x";
    }
  }
  if (VDBG) {
    Slog.v(WWSM_TAG,dnsCheckLogStr);
  }
  if (dnsCheckSuccesses >= mMinDnsResponses) {
    if (DBG) {
      Slog.d(WWSM_TAG,dnsCheckLogStr + "|  SUCCESS");
    }
    if (!shouldCheckWalledGarden()) {
      transitionTo(mOnlineWatchState);
      return HANDLED;
    }
    mLastWalledGardenCheckTime=SystemClock.elapsedRealtime();
    if (isWalledGardenConnection()) {
      if (DBG)       Slog.d(WWSM_TAG,"Walled garden test complete - walled garden detected");
      transitionTo(mWalledGardenState);
    }
 else {
      if (DBG)       Slog.d(WWSM_TAG,"Walled garden test complete - online");
      transitionTo(mOnlineWatchState);
    }
    return HANDLED;
  }
  int remainingChecks=mNumDnsPings - dnsCheckTries;
  if (remainingChecks + dnsCheckSuccesses < mMinDnsResponses) {
    if (DBG) {
      Slog.d(WWSM_TAG,dnsCheckLogStr + "|  FAILURE");
    }
    transitionTo(mDnsCheckFailureState);
    return HANDLED;
  }
  return HANDLED;
}
