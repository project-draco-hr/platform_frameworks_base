{
  if (msg.what != MESSAGE_HANDLE_BAD_AP) {
    return NOT_HANDLED;
  }
  if (msg.arg1 != mNetEventCounter) {
    if (VDBG) {
      Slog.v(WWSM_TAG,"Msg out of sync, ignoring...");
    }
    return HANDLED;
  }
  if (mDisableAPNextFailure || mNumFullDNSchecks >= MAX_CHECKS_PER_SSID) {
    Slog.i(WWSM_TAG,"Disabling current SSID " + wifiInfoToStr(mInitialConnInfo) + ".  "+ "numChecks "+ mNumFullDNSchecks+ ", numAPs "+ mBssids.size());
    mWifiManager.disableNetwork(mInitialConnInfo.getNetworkId());
    transitionTo(mNotConnectedState);
  }
 else {
    Slog.i(WWSM_TAG,"Blacklisting current BSSID.  " + wifiInfoToStr(mInitialConnInfo) + "numChecks "+ mNumFullDNSchecks+ ", numAPs "+ mBssids.size());
    mWifiManager.addToBlacklist(mInitialConnInfo.getBSSID());
    mWifiManager.reassociate();
    transitionTo(mBlacklistedApState);
  }
  return HANDLED;
}
