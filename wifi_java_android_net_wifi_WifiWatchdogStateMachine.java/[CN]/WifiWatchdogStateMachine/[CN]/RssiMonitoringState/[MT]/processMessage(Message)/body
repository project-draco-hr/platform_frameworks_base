{
switch (msg.what) {
case EVENT_RSSI_CHANGE:
    mCurrentSignalLevel=calculateSignalLevel(msg.arg1);
  if (mCurrentSignalLevel <= RSSI_LEVEL_MONITOR) {
  }
 else {
    transitionTo(mOnlineWatchState);
  }
break;
case CMD_RSSI_FETCH:
if (msg.arg1 == mRssiFetchToken) {
mWsmChannel.sendMessage(RSSI_FETCH);
sendMessageDelayed(obtainMessage(CMD_RSSI_FETCH,++mRssiFetchToken,0),mRssiFetchIntervalMs);
}
break;
case RSSI_FETCH_SUCCEEDED:
int rssi=msg.arg1;
if (DBG) log("RSSI_FETCH_SUCCEEDED: " + rssi);
if (msg.arg1 < RSSI_MONITOR_THRESHOLD) {
mRssiMonitorCount++;
}
 else {
mRssiMonitorCount=0;
}
if (mRssiMonitorCount > RSSI_MONITOR_COUNT) {
sendPoorLinkDetected();
++mRssiFetchToken;
}
break;
case RSSI_FETCH_FAILED:
if (DBG) log("RSSI_FETCH_FAILED");
break;
default :
return NOT_HANDLED;
}
return HANDLED;
}
