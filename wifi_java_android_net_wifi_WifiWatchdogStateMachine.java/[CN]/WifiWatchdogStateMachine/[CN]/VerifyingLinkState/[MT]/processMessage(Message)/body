{
switch (msg.what) {
case EVENT_WATCHDOG_SETTINGS_CHANGE:
    updateSettings();
  if (!mPoorNetworkDetectionEnabled) {
    mWsmChannel.sendMessage(GOOD_LINK_DETECTED);
  }
break;
case EVENT_RSSI_CHANGE:
mCurrentSignalLevel=calculateSignalLevel(msg.arg1);
handleRssiChange();
break;
case CMD_ARP_CHECK:
if (msg.arg1 == mArpToken) {
boolean success=ArpPeer.doArp(mWifiInfo.getMacAddress(),mLinkProperties,mArpPingTimeoutMs,mNumArpPings,mMinArpResponses);
if (success) {
if (DBG) log("Notify link is good " + mCurrentSignalLevel);
mWsmChannel.sendMessage(GOOD_LINK_DETECTED);
}
 else {
if (DBG) log("Continue ARP check, rssi level: " + mCurrentSignalLevel);
sendMessageDelayed(obtainMessage(CMD_ARP_CHECK,++mArpToken,0),mArpCheckIntervalMs);
}
}
break;
default :
return NOT_HANDLED;
}
return HANDLED;
}
