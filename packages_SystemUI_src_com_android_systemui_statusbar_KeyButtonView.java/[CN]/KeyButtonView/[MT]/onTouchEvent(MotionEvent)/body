{
  final int action=ev.getAction();
  int x, y;
switch (action) {
case MotionEvent.ACTION_DOWN:
    mDownTime=SystemClock.uptimeMillis();
  mRepeat=0;
mSending=true;
sendEvent(KeyEvent.ACTION_DOWN,KeyEvent.FLAG_FROM_SYSTEM | KeyEvent.FLAG_SOFT_KEYBOARD,mDownTime);
setPressed(true);
break;
case MotionEvent.ACTION_MOVE:
if (mSending) {
x=(int)ev.getX();
y=(int)ev.getY();
if (x < 0 || x >= getWidth() || y < 0 || y >= getHeight()) {
mSending=false;
sendEvent(KeyEvent.ACTION_UP,KeyEvent.FLAG_FROM_SYSTEM | KeyEvent.FLAG_SOFT_KEYBOARD | KeyEvent.FLAG_CANCELED);
setPressed(false);
}
}
break;
case MotionEvent.ACTION_UP:
case MotionEvent.ACTION_CANCEL:
if (mSending) {
mSending=false;
sendEvent(KeyEvent.ACTION_UP,KeyEvent.FLAG_FROM_SYSTEM | KeyEvent.FLAG_SOFT_KEYBOARD);
setPressed(false);
}
break;
}
return true;
}
