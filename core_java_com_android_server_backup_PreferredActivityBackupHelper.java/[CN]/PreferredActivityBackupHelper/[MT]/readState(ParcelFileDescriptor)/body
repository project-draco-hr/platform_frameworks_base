{
  FileInputStream fis=new FileInputStream(oldStateFd.getFileDescriptor());
  BufferedInputStream bis=new BufferedInputStream(fis);
  @SuppressWarnings("resource") DataInputStream in=new DataInputStream(bis);
  byte[] oldState=null;
  try {
    int version=in.readInt();
    if (version == STATE_VERSION) {
      int size=in.readInt();
      if (size > 0) {
        if (size > 200 * 1024) {
          Slog.w(TAG,"Suspiciously large state blog; ignoring.  N=" + size);
        }
 else {
          oldState=new byte[size];
          in.read(oldState);
        }
      }
    }
 else {
      Slog.w(TAG,"Prior state from unrecognized version " + version);
    }
  }
 catch (  EOFException e) {
    oldState=null;
  }
catch (  Exception e) {
    Slog.w(TAG,"Error examing prior backup state " + e.getMessage());
    oldState=null;
  }
  return oldState;
}
