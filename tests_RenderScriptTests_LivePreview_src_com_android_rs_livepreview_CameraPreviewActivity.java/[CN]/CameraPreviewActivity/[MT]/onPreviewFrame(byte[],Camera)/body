{
  if (mProcessInProgress || mState != STATE_PREVIEW) {
    mCamera.addCallbackBuffer(data);
    return;
  }
  if (data == null) {
    return;
  }
  int expectedBytes=mPreviewSize.width * mPreviewSize.height * ImageFormat.getBitsPerPixel(ImageFormat.NV21) / 8;
  if (expectedBytes != data.length) {
    Log.e(TAG,"Mismatched size of buffer! Expected ");
    mState=STATE_NO_CALLBACKS;
    mCamera.setPreviewCallbackWithBuffer(null);
    return;
  }
  mProcessInProgress=true;
  if ((mFilterYuv == null) || (mPreviewSize.width != mFilterYuv.getWidth()) || (mPreviewSize.height != mFilterYuv.getHeight())) {
    mFilterYuv.reset(mPreviewSize.width,mPreviewSize.height);
  }
  mProcessInProgress=true;
  new ProcessPreviewDataTask().execute(data);
}
