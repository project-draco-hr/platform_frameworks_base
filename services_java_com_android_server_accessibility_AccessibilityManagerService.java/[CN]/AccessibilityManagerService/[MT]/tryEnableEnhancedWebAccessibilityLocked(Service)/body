{
  if (!service.canReceiveEventsLocked() || !service.mRequestEnhancedWebAccessibility) {
    return false;
  }
  UserState userState=getUserStateLocked(service.mUserId);
  if (userState.mIsEnhancedWebAccessibilityEnabled) {
    return false;
  }
  if (service.mIsAutomation || mContext.getPackageManager().checkPermission(android.Manifest.permission.CAN_REQUEST_ENHANCED_WEB_ACCESSIBILITY,service.mComponentName.getPackageName()) == PackageManager.PERMISSION_GRANTED) {
    userState.mIsEnhancedWebAccessibilityEnabled=true;
    Settings.Secure.putIntForUser(mContext.getContentResolver(),Settings.Secure.ACCESSIBILITY_SCRIPT_INJECTION,1,userState.mUserId);
    return true;
  }
  return false;
}
