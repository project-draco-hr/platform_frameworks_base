{
  mSecurityPolicy.enforceCallingPermission(Manifest.permission.RETRIEVE_WINDOW_CONTENT,FUNCTION_REGISTER_UI_TEST_AUTOMATION_SERVICE);
  accessibilityServiceInfo.setComponentName(sFakeAccessibilityServiceComponentName);
synchronized (mLock) {
    UserState userState=getCurrentUserStateLocked();
    if (userState.mUiAutomationService != null) {
      throw new IllegalStateException("UiAutomationService " + serviceClient + "already registered!");
    }
    userState.mUiAutomationServiceClient=serviceClient;
    userState.mIsAccessibilityEnabled=true;
    userState.mIsTouchExplorationEnabled=false;
    userState.mIsEnhancedWebAccessibilityEnabled=false;
    userState.mIsDisplayMagnificationEnabled=false;
    userState.mInstalledServices.add(accessibilityServiceInfo);
    userState.mEnabledServices.clear();
    userState.mEnabledServices.add(sFakeAccessibilityServiceComponentName);
    userState.mTouchExplorationGrantedServices.add(sFakeAccessibilityServiceComponentName);
    onUserStateChangedLocked(userState);
  }
}
