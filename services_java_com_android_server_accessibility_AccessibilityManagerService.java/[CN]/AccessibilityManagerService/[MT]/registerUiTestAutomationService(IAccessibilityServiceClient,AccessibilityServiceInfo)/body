{
  mSecurityPolicy.enforceCallingPermission(Manifest.permission.RETRIEVE_WINDOW_CONTENT,FUNCTION_REGISTER_UI_TEST_AUTOMATION_SERVICE);
  ComponentName componentName=new ComponentName("foo.bar","AutomationAccessibilityService");
synchronized (mLock) {
    if (mUiAutomationService != null) {
      throw new IllegalStateException("UiAutomationService " + serviceClient + "already registered!");
    }
    UserState userState=getCurrentUserStateLocked();
    unbindAllServicesLocked(userState);
    if (!userState.mIsAccessibilityEnabled) {
      userState.mIsAccessibilityEnabled=true;
    }
    userState.mIsTouchExplorationEnabled=false;
    userState.mIsEnhancedWebAccessibilityEnabled=false;
    mUiAutomationService=new Service(mCurrentUserId,componentName,accessibilityServiceInfo,true);
    mUiAutomationService.onServiceConnected(componentName,serviceClient.asBinder());
    scheduleUpdateInputFilter(userState);
    scheduleSendStateToClientsLocked(userState);
  }
}
