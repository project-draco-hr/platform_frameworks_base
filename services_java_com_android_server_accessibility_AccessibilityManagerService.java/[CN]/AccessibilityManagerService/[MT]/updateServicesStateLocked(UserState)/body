{
  Map<ComponentName,Service> componentNameToServiceMap=userState.mComponentNameToServiceMap;
  boolean isEnabled=userState.mIsAccessibilityEnabled;
  int enabledInstalledServices=0;
  for (int i=0, count=userState.mInstalledServices.size(); i < count; i++) {
    AccessibilityServiceInfo installedService=userState.mInstalledServices.get(i);
    ComponentName componentName=ComponentName.unflattenFromString(installedService.getId());
    Service service=componentNameToServiceMap.get(componentName);
    if (isEnabled) {
      if (userState.mEnabledServices.contains(componentName)) {
        if (service == null) {
          service=new Service(userState.mUserId,componentName,installedService,false);
        }
        service.bind();
        enabledInstalledServices++;
      }
 else {
        if (service != null) {
          service.unbind();
        }
      }
    }
 else {
      if (service != null) {
        service.unbind();
      }
    }
  }
  return enabledInstalledServices;
}
