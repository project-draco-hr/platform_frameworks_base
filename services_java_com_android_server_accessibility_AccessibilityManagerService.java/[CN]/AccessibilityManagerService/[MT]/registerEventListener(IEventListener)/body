{
  mSecurityPolicy.enforceCallingPermission(Manifest.permission.RETRIEVE_WINDOW_CONTENT,FUNCTION_REGISTER_EVENT_LISTENER);
  ComponentName componentName=new ComponentName("foo.bar","AutomationAccessibilityService");
synchronized (mLock) {
    final int runningServiceCount=mServices.size();
    for (int i=0; i < runningServiceCount; i++) {
      Service runningService=mServices.get(i);
      runningService.unbind();
    }
    if (!mIsAccessibilityEnabled) {
      mIsAccessibilityEnabled=true;
      sendStateToClientsLocked();
    }
  }
  AccessibilityServiceInfo accessibilityServiceInfo=new AccessibilityServiceInfo();
  accessibilityServiceInfo.eventTypes=AccessibilityEvent.TYPES_ALL_MASK;
  accessibilityServiceInfo.feedbackType=AccessibilityServiceInfo.FEEDBACK_GENERIC;
  Service service=new Service(componentName,accessibilityServiceInfo,true);
  service.onServiceConnected(componentName,listener.asBinder());
  return service;
}
