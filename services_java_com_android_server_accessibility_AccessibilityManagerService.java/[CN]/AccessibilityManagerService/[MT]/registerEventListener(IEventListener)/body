{
  mSecurityPolicy.enforceCallingPermission(Manifest.permission.RETRIEVE_WINDOW_CONTENT,FUNCTION_REGISTER_EVENT_LISTENER);
  ComponentName componentName=new ComponentName("foo.bar","AutomationAccessibilityService");
synchronized (mLock) {
    Service oldService=mComponentNameToServiceMap.get(componentName);
    if (oldService != null) {
      tryRemoveServiceLocked(oldService);
    }
    Settings.Secure.putInt(mContext.getContentResolver(),Settings.Secure.ACCESSIBILITY_ENABLED,1);
    Settings.Secure.putString(mContext.getContentResolver(),Settings.Secure.ENABLED_ACCESSIBILITY_SERVICES,"");
  }
  AccessibilityServiceInfo accessibilityServiceInfo=new AccessibilityServiceInfo();
  accessibilityServiceInfo.eventTypes=AccessibilityEvent.TYPES_ALL_MASK;
  accessibilityServiceInfo.feedbackType=AccessibilityServiceInfo.FEEDBACK_GENERIC;
  Service service=new Service(componentName,accessibilityServiceInfo,true);
  service.onServiceConnected(componentName,listener.asBinder());
  return service;
}
