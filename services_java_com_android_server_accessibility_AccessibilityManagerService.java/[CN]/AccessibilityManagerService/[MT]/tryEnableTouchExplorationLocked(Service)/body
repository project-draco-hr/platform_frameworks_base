{
  if (!service.canReceiveEventsLocked() || !service.mRequestTouchExplorationMode) {
    return false;
  }
  UserState userState=getUserStateLocked(service.mUserId);
  if (userState.mIsTouchExplorationEnabled) {
    return false;
  }
  if (service.mIsAutomation) {
    userState.mIsTouchExplorationEnabled=true;
    Settings.Secure.putIntForUser(mContext.getContentResolver(),Settings.Secure.TOUCH_EXPLORATION_ENABLED,1,service.mUserId);
    return true;
  }
  if (service.mResolveInfo.serviceInfo.applicationInfo.targetSdkVersion <= Build.VERSION_CODES.JELLY_BEAN_MR1) {
    if (!userState.mTouchExplorationGrantedServices.contains(service.mComponentName)) {
      if (mEnableTouchExplorationDialog == null || (mEnableTouchExplorationDialog != null && !mEnableTouchExplorationDialog.isShowing())) {
        mMainHandler.obtainMessage(MainHandler.MSG_SHOW_ENABLED_TOUCH_EXPLORATION_DIALOG,service).sendToTarget();
      }
    }
 else {
      userState.mIsTouchExplorationEnabled=true;
      Settings.Secure.putIntForUser(mContext.getContentResolver(),Settings.Secure.TOUCH_EXPLORATION_ENABLED,1,service.mUserId);
      return true;
    }
  }
 else {
    if (mContext.getPackageManager().checkPermission(android.Manifest.permission.CAN_REQUEST_TOUCH_EXPLORATION_MODE,service.mComponentName.getPackageName()) == PackageManager.PERMISSION_GRANTED) {
      userState.mIsTouchExplorationEnabled=true;
      Settings.Secure.putIntForUser(mContext.getContentResolver(),Settings.Secure.TOUCH_EXPLORATION_ENABLED,1,service.mUserId);
      return true;
    }
  }
  return false;
}
