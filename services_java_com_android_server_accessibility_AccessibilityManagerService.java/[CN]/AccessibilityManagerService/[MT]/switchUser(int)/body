{
synchronized (mLock) {
    if (userId == mCurrentUserId) {
      return;
    }
    UserState oldUserState=getUserStateLocked(mCurrentUserId);
    unbindAllServicesLocked(oldUserState);
    if (oldUserState.mClients.getRegisteredCallbackCount() > 0) {
      mMainHandler.obtainMessage(MainHandler.MSG_SEND_CLEARED_STATE_TO_CLIENTS_FOR_USER,oldUserState.mUserId,0).sendToTarget();
    }
    mCurrentUserId=userId;
    mMainHandler.obtainMessage(MainHandler.MSG_SEND_RECREATE_INTERNAL_STATE,mCurrentUserId,0).sendToTarget();
    if (mUiAutomationService != null) {
      unregisterUiTestAutomationService(mUiAutomationService.mServiceInterface);
      SomeArgs args=SomeArgs.obtain();
      args.arg1=mUiAutomationService.mServiceInterface;
      args.arg2=mUiAutomationService.mAccessibilityServiceInfo;
      mMainHandler.obtainMessage(MainHandler.MSG_REGISTER_UI_TEST_AUTOMATION_SERVICE,args).sendToTarget();
    }
  }
}
