{
synchronized (mLock) {
    mTempStateChangeForCurrentUserMemento.clear();
    UserState oldUserState=getUserStateLocked(mCurrentUserId);
    unbindAllServicesLocked(oldUserState);
    if (oldUserState.mClients.getRegisteredCallbackCount() > 0) {
      mMainHandler.obtainMessage(MainHandler.MSG_SEND_CLEARED_STATE_TO_CLIENTS_FOR_USER,oldUserState.mUserId,0).sendToTarget();
    }
    UserManager userManager=(UserManager)mContext.getSystemService(Context.USER_SERVICE);
    final boolean announceNewUser=userManager.getUsers().size() > 1;
    mCurrentUserId=userId;
    mMainHandler.obtainMessage(MainHandler.MSG_SEND_RECREATE_INTERNAL_STATE,mCurrentUserId,0).sendToTarget();
    if (announceNewUser) {
      mMainHandler.sendEmptyMessageDelayed(MainHandler.MSG_ANNOUNCE_NEW_USER_IF_NEEDED,WAIT_FOR_USER_STATE_FULLY_INITIALIZED_MILLIS);
    }
  }
}
