{
  final int installedServiceCount=userState.mInstalledServices.size();
  for (int i=0; i < installedServiceCount; i++) {
    AccessibilityServiceInfo serviceInfo=userState.mInstalledServices.get(i);
    ResolveInfo resolveInfo=serviceInfo.getResolveInfo();
    if ((serviceInfo.getCapabilities() & AccessibilityServiceInfo.CAPABILITY_CAN_REQUEST_TOUCH_EXPLORATION) == 0 && resolveInfo.serviceInfo.applicationInfo.targetSdkVersion <= Build.VERSION_CODES.JELLY_BEAN_MR1) {
      ComponentName componentName=new ComponentName(resolveInfo.serviceInfo.packageName,resolveInfo.serviceInfo.name);
      if (userState.mTouchExplorationGrantedServices.contains(componentName)) {
        serviceInfo.setCapabilities(serviceInfo.getCapabilities() | AccessibilityServiceInfo.CAPABILITY_CAN_REQUEST_TOUCH_EXPLORATION);
      }
    }
  }
}
