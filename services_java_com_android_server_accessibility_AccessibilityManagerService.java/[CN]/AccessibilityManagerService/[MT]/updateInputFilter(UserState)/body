{
  boolean setInputFilter=false;
  AccessibilityInputFilter inputFilter=null;
synchronized (mLock) {
    if (userState.mIsAccessibilityEnabled) {
      if (!mHasInputFilter) {
        mHasInputFilter=true;
        if (mInputFilter == null) {
          mInputFilter=new AccessibilityInputFilter(mContext,AccessibilityManagerService.this);
        }
        inputFilter=mInputFilter;
        setInputFilter=true;
      }
      int flags=0;
      if (userState.mIsDisplayMagnificationEnabled) {
        flags|=AccessibilityInputFilter.FLAG_FEATURE_SCREEN_MAGNIFIER;
      }
      if (userState.mIsTouchExplorationEnabled) {
        flags|=AccessibilityInputFilter.FLAG_FEATURE_TOUCH_EXPLORATION;
      }
      mInputFilter.setEnabledFeatures(flags);
    }
 else {
      if (mHasInputFilter) {
        mHasInputFilter=false;
        mInputFilter.reset();
        inputFilter=null;
        setInputFilter=true;
      }
    }
  }
  if (setInputFilter) {
    try {
      mWindowManagerService.setInputFilter(inputFilter);
    }
 catch (    RemoteException re) {
    }
  }
}
