{
synchronized (mLock) {
    final int resolvedUserId=mSecurityPolicy.resolveCallingUserIdEnforcingPermissionsLocked(userId);
    UserState userState=getUserStateLocked(resolvedUserId);
    if (mSecurityPolicy.isCallerInteractingAcrossUsers(userId)) {
      mGlobalClients.register(client);
      return getClientState(userState);
    }
 else {
      userState.mClients.register(client);
      return (resolvedUserId == mCurrentUserId) ? getClientState(userState) : 0;
    }
  }
}
