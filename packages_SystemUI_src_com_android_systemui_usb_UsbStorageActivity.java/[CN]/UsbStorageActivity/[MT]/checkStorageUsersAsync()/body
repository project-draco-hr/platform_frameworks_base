{
  IMountService ims=getMountService();
  if (ims == null) {
    showDialogInner(DLG_ERROR_SHARING);
  }
  String extStoragePath=Environment.getExternalStorageDirectory().toString();
  boolean showDialog=false;
  try {
    int[] stUsers=ims.getStorageUsers(extStoragePath);
    if (stUsers != null && stUsers.length > 0) {
      showDialog=true;
    }
 else {
      ActivityManager am=(ActivityManager)getSystemService(Context.ACTIVITY_SERVICE);
      List<ApplicationInfo> infoList=am.getRunningExternalApplications();
      if (infoList != null && infoList.size() > 0) {
        showDialog=true;
      }
    }
  }
 catch (  RemoteException e) {
    showDialogInner(DLG_ERROR_SHARING);
  }
  if (showDialog) {
    showDialogInner(DLG_CONFIRM_KILL_STORAGE_USERS);
  }
 else {
    if (localLOGV)     Log.i(TAG,"Enabling UMS");
    switchUsbMassStorage(true);
  }
}
