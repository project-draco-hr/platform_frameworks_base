{
  if (outputs != null) {
    for (    Surface output : outputs) {
      if (output == null) {
        Log.e(TAG,"configureOutputs - null outputs are not allowed");
        return BAD_VALUE;
      }
      StreamConfigurationMap streamConfigurations=mStaticCharacteristics.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);
      try {
        Size s=getSurfaceSize(output);
        int surfaceType=detectSurfaceType(output);
        Size[] sizes=streamConfigurations.getOutputSizes(surfaceType);
        if (sizes == null) {
          if ((surfaceType >= LegacyMetadataMapper.HAL_PIXEL_FORMAT_RGBA_8888 && surfaceType <= LegacyMetadataMapper.HAL_PIXEL_FORMAT_BGRA_8888)) {
            sizes=streamConfigurations.getOutputSizes(ImageFormat.YUV_420_888);
          }
 else           if (surfaceType == LegacyMetadataMapper.HAL_PIXEL_FORMAT_BLOB) {
            sizes=streamConfigurations.getOutputSizes(ImageFormat.JPEG);
          }
        }
        if (!ArrayUtils.contains(sizes,s)) {
          String reason=(sizes == null) ? "format is invalid." : ("size not in valid set: " + Arrays.toString(sizes));
          Log.e(TAG,String.format("Surface with size (w=%d, h=%d) and format 0x%x is" + " not valid, %s",s.getWidth(),s.getHeight(),surfaceType,reason));
          return BAD_VALUE;
        }
      }
 catch (      BufferQueueAbandonedException e) {
        Log.e(TAG,"Surface bufferqueue is abandoned, cannot configure as output: ",e);
        return BAD_VALUE;
      }
    }
  }
  int error=mDeviceState.setConfiguring();
  if (error == NO_ERROR) {
    mRequestThreadManager.configure(outputs);
    error=mDeviceState.setIdle();
  }
  if (error == NO_ERROR) {
    mConfiguredSurfaces=outputs != null ? new ArrayList<>(outputs) : null;
  }
  return error;
}
