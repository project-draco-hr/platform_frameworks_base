{
  List<Arc> spanToSize=new ArrayList<Arc>();
  PackedMap<Interval,MutableInt> spanSizes=getSpanSizes();
  for (int i=0; i < spanSizes.keys.length; i++) {
    Interval key=spanSizes.keys[i];
    MutableInt value=spanSizes.values[i];
    include2(spanToSize,key,value,value,accommodateBothMinAndMax);
  }
  boolean[] used=findUsed(spanToSize);
  for (int i=0; i < getCount(); i++) {
    if (!used[i]) {
      Interval span=new Interval(i,i + 1);
      include(spanToSize,span,new MutableInt(0));
      include(spanToSize,span.inverse(),new MutableInt(0));
    }
  }
  if (mOrderPreserved) {
    for (int i=0; i < getCount(); i++) {
      if (used[i]) {
        include2(spanToSize,new Interval(i,i + 1),0,0,false);
      }
    }
  }
 else {
    for (    Interval gap : getSpacers()) {
      include2(spanToSize,gap,0,0,false);
    }
  }
  Arc[] arcs=spanToSize.toArray(new Arc[spanToSize.size()]);
  return topologicalSort(arcs,0);
}
