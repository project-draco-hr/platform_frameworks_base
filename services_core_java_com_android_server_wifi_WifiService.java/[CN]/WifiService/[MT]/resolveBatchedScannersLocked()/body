{
  BatchedScanSettings setting=new BatchedScanSettings();
  WorkSource responsibleWorkSource=null;
  int responsibleUid=0;
  double responsibleCsph=0;
  if (mBatchedScanners.size() == 0) {
    mWifiStateMachine.setBatchedScanSettings(null,0,0,null);
    return;
  }
  for (  BatchedScanRequest r : mBatchedScanners) {
    BatchedScanSettings s=r.settings;
    int currentChannelCount;
    int currentScanInterval;
    double currentCsph;
    if (s.channelSet == null || s.channelSet.isEmpty()) {
      currentChannelCount=9 + 11;
    }
 else {
      currentChannelCount=s.channelSet.size();
      if (s.channelSet.contains("A"))       currentChannelCount+=(9 - 1);
      if (s.channelSet.contains("B"))       currentChannelCount+=(11 - 1);
    }
    if (s.scanIntervalSec == BatchedScanSettings.UNSPECIFIED) {
      currentScanInterval=BatchedScanSettings.DEFAULT_INTERVAL_SEC;
    }
 else {
      currentScanInterval=s.scanIntervalSec;
    }
    currentCsph=60 * 60 * currentChannelCount / currentScanInterval;
    if (currentCsph > responsibleCsph) {
      responsibleUid=r.uid;
      responsibleWorkSource=r.workSource;
      responsibleCsph=currentCsph;
    }
    if (s.maxScansPerBatch != BatchedScanSettings.UNSPECIFIED && s.maxScansPerBatch < setting.maxScansPerBatch) {
      setting.maxScansPerBatch=s.maxScansPerBatch;
    }
    if (s.maxApPerScan != BatchedScanSettings.UNSPECIFIED && (setting.maxApPerScan == BatchedScanSettings.UNSPECIFIED || s.maxApPerScan > setting.maxApPerScan)) {
      setting.maxApPerScan=s.maxApPerScan;
    }
    if (s.scanIntervalSec != BatchedScanSettings.UNSPECIFIED && s.scanIntervalSec < setting.scanIntervalSec) {
      setting.scanIntervalSec=s.scanIntervalSec;
    }
    if (s.maxApForDistance != BatchedScanSettings.UNSPECIFIED && (setting.maxApForDistance == BatchedScanSettings.UNSPECIFIED || s.maxApForDistance > setting.maxApForDistance)) {
      setting.maxApForDistance=s.maxApForDistance;
    }
    if (s.channelSet != null && s.channelSet.size() != 0) {
      if (setting.channelSet == null || setting.channelSet.size() != 0) {
        if (setting.channelSet == null)         setting.channelSet=new ArrayList<String>();
        for (        String i : s.channelSet) {
          if (setting.channelSet.contains(i) == false)           setting.channelSet.add(i);
        }
      }
    }
 else {
      if (setting.channelSet == null || setting.channelSet.size() != 0) {
        setting.channelSet=new ArrayList<String>();
      }
    }
  }
  setting.constrain();
  mWifiStateMachine.setBatchedScanSettings(setting,responsibleUid,(int)responsibleCsph,responsibleWorkSource);
}
